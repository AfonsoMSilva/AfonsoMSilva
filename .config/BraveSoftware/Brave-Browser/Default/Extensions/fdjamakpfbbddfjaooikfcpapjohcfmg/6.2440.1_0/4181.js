"use strict";(self.webpackChunk_dashlane_leeloo=self.webpackChunk_dashlane_leeloo||[]).push([[4181],{38182:(e,t,a)=>{a.r(t),a.d(t,{CredentialAddPanel:()=>M});var s=a(96832),n=a(33354),i=a(18108),o=a(30894),l=a(26849),r=a(50756),u=a(14900),c=a(30309),d=a(87279),m=a(82598),p=a(46525),w=a(91871),g=a(86342),S=a(39431),h=a(55989),I=a(13252),f=a(88203),L=a(86498),P=a(45272),y=a(8403),E=a(92077),U=a(6697),v=a(19122),C=a(63520),A=a(98149),b=a(99975),V=a(83849),k=a.n(V);var _=a(44110);const D=()=>{const{translate:e}=(0,f.Z)();return(0,_.tZ)(C.V9,{icon:(0,_.tZ)("div",{className:k()("icon--gEZfcCvjSg","dummyIcon--ix6eIwyFEN")}),title:e("webapp_credential_addition_website")})};var R,N=a(50094);const q=["name","website"],Z={name:"itemName",website:"URL"},x=({activeSpaces:e,onClose:t,protectedItemsUnlockerShown:a,openProtectedItemsUnlocker:n,areProtectedItemsUnlocked:i})=>{var o,V;const k=(0,s.createRef)(),[x,M]=(0,s.useState)(!1),{routes:O}=(0,E.Xo)(),{currentSpaceId:T}=(0,v.fV)(),B=(0,L.V)(),{translate:X}=(0,f.Z)(),F=(0,y.v0)(),H=!F.isLoading&&F.shouldShowAtOrOverLimitContent,{openDialog:z,shouldShowFrozenStateDialog:W}=(0,U.Ub)(),{createCollection:j,updateCollection:G}=(0,m.u)(p.v),{addItemsToCollections:J}=(0,m.u)(h.a),{createVaultItem:K}=(0,m.u)(w.L),{updateCredentialPreferences:Y}=(0,m.u)(N.I),[Q,$]=(0,s.useState)(!1),[ee,te]=(0,s.useState)(!1),ae=(0,E.TH)(),se=(0,s.useRef)(ae.state?.previouslyGeneratedPassword),[ne,ie]=(0,s.useState)(Boolean(se.current)),[oe,le]=(0,s.useState)(!1),re=(()=>{const e=(0,E.CN)();return q.reduce(((t,a)=>(t[Z[a]||a]=e.get(a),t)),{})})(),ue={alternativeUsername:"",email:"",itemName:"",linkedURLs:[],note:"",otpURL:"",password:null!=(o=se.current)?o:"",spaceId:e.length>0&&!e[0].info?.personalSpaceEnabled?e[0].teamId:null!=T?T:"",username:"",...re,URL:null!=(V=ae.state?.website)?V:re.URL,onlyAutofillExactDomain:!1,requireMasterPassword:!1,useAutoLogin:!0},[ce,de]=(0,s.useState)(ue);(0,s.useEffect)((()=>{const{onlyAutofillExactDomain:e,requireMasterPassword:t,useAutoLogin:a,...s}=ce,{onlyAutofillExactDomain:n,requireMasterPassword:i,useAutoLogin:o,...r}=ue,u=!(0,l.equals)(ce,ue)&&!H;ie(u),le(!(0,l.equals)(s,r))}),[ce]);const me=()=>{$(!0)};(0,s.useEffect)((()=>{H&&me(),W&&(z(),t())}),[H,W]),(0,s.useEffect)((()=>{(0,P.Nc)(r.PageView.ItemCredentialCreate)}),[]);const pe=()=>B.showAlert(X("_common_generic_error"),u.BLW.ERROR),we=()=>{(0,P.Nc)(r.PageView.ItemCredentialList),Q?(0,E.uX)(O.userCredentials):t?t():(0,E.uX)(O.userCredentials)};return F.isLoading||null===W?null:(0,_.BX)(C.zI,{isUsingNewDesign:!0,isViewingExistingItem:!1,isSomeDialogOpen:ee,itemHasBeenEdited:ne,onSubmit:async()=>{Boolean(k.current?.isFormValid())&&(M(!0),await(async()=>{const e=k.current?.getVaultItemCollections(),{onlyAutofillExactDomain:t,useAutoLogin:a,requireMasterPassword:s,...n}=ce,i=t!==ue.onlyAutofillExactDomain||a!==ue.useAutoLogin||s!==ue.requireMasterPassword;try{const o=await K({vaultItemType:S.U.Credential,content:n,shouldSkipSync:!!i});if(!(0,d.d6)(o))return void pe();const l=(0,d.db)(o).id,r=[];i&&r.push(Y({credentialId:l,credentialUrl:n.URL,onlyAutofillExactDomain:t,useAutoLogin:a,requireMasterPassword:s,shouldSkipSync:e?.some((e=>e.isShared))})),e?.length&&r.push((async(e,t)=>{const a=[];for(const n of t){var s;n.isShared?a.push({collectionId:n.id,permission:null!=(s=n.itemPermission)?s:I.y3.Limited}):(n.vaultItems=[{id:e,type:c.dJ.KWAuthentifiant,url:ce.URL}],n.id?await G({id:n.id,collection:n,operationType:g.C.APPEND_VAULT_ITEMS}):await j({content:n}))}a.length&&await J({collectionPermissions:a,itemIds:[e]})})(l,e)),await Promise.all(r)}catch(e){pe()}})(),H?me():we())},onNavigateOut:we,formId:"add_credential_panel",header:R||(R=(0,_.tZ)(D,{})),submitPending:x,children:[(0,_.tZ)(A.S,{ref:k,editableValues:ce,setEditableValues:de,readonlyValues:{id:"",limitedPermissions:!1,linkedURLs:[]},isNewItem:!0,signalEditedValues:()=>ie(!0),activeSpaces:e,areProtectedItemsUnlocked:i,openProtectedItemsUnlocker:n,protectedItemsUnlockerShown:a,setHasOpenedDialogs:te}),Q&&(0,_.tZ)(b.e,{isVisible:Q,handleDismiss:we})]})},M=e=>{const t=(0,i.E)(),a=(0,o.tY)();return t.status!==n.rq.Success?null:(0,_.tZ)(x,{...e,activeSpaces:t.data,...a})}}}]);