"use strict";(globalThis.webpackChunk_dashlane_amphora=globalThis.webpackChunk_dashlane_amphora||[]).push([[433],{43866:(e,t,r)=>{r.d(t,{d:()=>s});class s{constructor(){this.shutdownHooks=[],this.externalComponentReadyConditions=[],this.appReadyHooks=[]}addExternalComponentReadyCondition(e){this.externalComponentReadyConditions.push(e)}addAppReadyHook(e){this.appReadyHooks.push(e)}addShutdownHook(e){this.shutdownHooks.push(e)}removeShutdownHook(e){const t=this.shutdownHooks.indexOf(e);t>=0&&this.shutdownHooks.splice(t,1)}startup(){const e=this.waitAndTriggerAppReady();if(!this.externalComponentReadyConditions.length)return e;this.addShutdownHook((async()=>await e))}async shutDown(){for(;this.shutdownHooks.length>0;){const e=this.shutdownHooks.pop();e&&await e()}}async waitAndTriggerAppReady(){await Promise.all(this.externalComponentReadyConditions.map((e=>e()))),await this.executeStartupHooks(this.appReadyHooks)}async executeStartupHooks(e){for(;e.length>0;){const t=e.shift();if(t){const e=await t();e&&this.addShutdownHook(e)}}}}},21904:(e,t,r)=>{r.d(t,{O:()=>c,r:()=>d});var s=r(60399),a=r(24966),n=r(87065),i=r(41842),o=r(58376);class c{async waitTimeout(e){await(0,s.z)(this.createObservableTimer(e,e))}}class d extends c{constructor(){super(...arguments),this.subscribers$=new a.X(new Set),this.time=0,this.pendingTimerCount$=this.subscribers$.pipe((0,n.U)((e=>e.size)))}fireTimer(e=1){this.time+=e,[...this.subscribers$.value].forEach((e=>{e.next(this.time)}))}async allSubscribersDisconnected(){await(0,s.z)(this.pendingTimerCount$.pipe((0,i.h)((e=>!e))))}createObservableTimer(){return new o.y((e=>(this.subscribers$.next(new Set([...this.subscribers$.value,e])),()=>{this.subscribers$.next(new Set([...this.subscribers$.value].filter((t=>t!==e))))})))}}},96259:(e,t,r)=>{r.d(t,{t:()=>a,u:()=>n});var s=r(8987);const a=(e,t)=>(()=>{const e=t=>({define:()=>t,with:r=>{const s={api:r.module,main:r.on,queryOnly:r.queryOnly??[]},a={[r.module.name]:s};return e({...t,...a})}});return e({})})().with({module:s.t$,on:e}),n=a("node",[])},26457:(e,t,r)=>{r.d(t,{V:()=>s,W:()=>a});class s{}class a extends s{log(){}error(){}warn(){}trace(){}}},84065:(e,t,r)=>{r.d(t,{b:()=>R});var s=r(1484),a=r(31408),n=r(42949),i=r(94189),o=r(96917),c=r(16855),d=r(83081),l=r(43866),u=r(26457),p=r(88802),m=r(17988),h=r(10514);const g={name:"api",commands:{},events:{},queries:{}};var v=r(25029),f=r(95087),y=r(21869),b=r(22838);let _=class{constructor(e,t){this.introspection=e,this.moduleRef=t}async execute(e){const t=s.ContextIdFactory.getByRequest(e),{type:r}=e;if(!(e.module in this.introspection.modules))throw new Error("Unknown module "+e.module);const a=this.introspection.modules[e.module],n=a.api??g,i=a.handlers??b.TB;switch(r){case h.Y.Query:{const{queries:r}=n;if(e.name in r){const s=new(0,r[e.name])(e.body),a=i.queries[e.name];return{result:(await this.moduleRef.resolve(a,t,{strict:!1})).execute(s,{name:e.name})}}throw new Error("Unknown query "+e.name)}case h.Y.Command:{const{commands:r}=n;if(e.name in r){const s=new(0,r[e.name])(e.body),a=i.commands[e.name],n=await this.moduleRef.resolve(a,t,{strict:!1});return{result:await n.execute(s,{name:e.name})}}throw new Error("Unknown command "+e.name)}case h.Y.Event:{const{events:r}=n;if(e.name in r){const s=new(0,r[e.name])(e.body),a=Object.values(this.introspection.modules).flatMap((t=>(t.handlers??b.TB).events[e.module]?.events[e.name])),n=await Promise.all(a.filter((e=>this.introspection.supportedEventHandlers.has(e))).map((async e=>await this.moduleRef.resolve(e,t,{strict:!1}))));return void await Promise.all(n.map((e=>e.handle(s))))}throw new Error("Unknown event "+e.name)}case h.Y.Cron:{const r=(a.crons??[]).find((t=>t.name===e.name));if(!r)throw new Error("unknown cron "+e.name);if(r.scope===v.F.User){if(!e.context.getOrFail(y.l.UserName,{errorMessage:`Expected ${y.l.UserName} to be set in the request context`}))return{result:!1}}const s=await this.moduleRef.resolve(r.handler,t,{strict:!1});return s.isRunnable&&!await s.isRunnable()?{result:!1}:(await s.run(),{result:!0})}}return(0,f.U)(r)}};(0,p.__decorate)([(0,m.All)(),(0,p.__param)(0,(0,m.Req)()),(0,p.__metadata)("design:type",Function),(0,p.__metadata)("design:paramtypes",[Object]),(0,p.__metadata)("design:returntype",Promise)],_.prototype,"execute",null),_=(0,p.__decorate)([(0,m.Controller)({scope:m.Scope.REQUEST,durable:!1}),(0,p.__metadata)("design:paramtypes",[b.Q1,s.ModuleRef])],_);var S=r(21904),w=r(11053),E=r(38144),C=r(23711),T=r(43702),F=r(10722),N=r(91199),I=r(4603),U=r(75994),P=r(9671),A=r(71949),x=r(56860);let D=class{catch(e,t){t.switchToHttp().getResponse().fail(e)}};D=(0,p.__decorate)([(0,m.Catch)(Error)],D);const O={provide:y.f,scope:m.Scope.REQUEST,inject:[s.REQUEST],useFactory:e=>{const t=(()=>{switch(e.type){case h.Y.Command:case h.Y.Event:case h.Y.Query:case h.Y.Cron:return e.context;case h.Y.Init:return new y.f;default:(0,f.U)(e)}})();return t.getOrAdd(y.l.UseCaseId,(()=>String(s.ContextIdFactory.getByRequest(e).id))),t}};var k=r(97631);class R{static addGlobalNestInterceptor(e){this.globalInterceptors.push(e)}static create({brokers:e,configProviders:t,keyValueStorageInfrastructure:r,lifeCycle:p,logger:m,modules:h,nodeConfiguration:g,storeInfrastructureFactory:v,timers:f,jsonFetcher:L,defaultDeviceStorageEncryptionCodecProvider:M,defaultUserStorageEncryptionCodecProvider:j,storeList:V,interceptors:z,introspection:B,moduleClientsProviders:$,userUseCaseScopeProvider:q}){return{module:R,providers:[a.ExplorerService,{provide:N.QI,useValue:r},{provide:l.d,useValue:p},{provide:c.$,useValue:g},{provide:n.d,useValue:e.cqrs},{provide:o.a,useValue:e.event},{provide:U.X,useValue:L},i.w,i.m,...t,{provide:u.V,useValue:m},O,{provide:d.G,useValue:v},{provide:S.O,useValue:f},w.u1,{provide:I.u,useValue:new I.u(r)},C.z,M,j,T.b,F.E,{provide:b.Q1,useValue:B},{provide:x.D,useValue:V},A.X,P.J,{provide:s.APP_FILTER,useClass:D},...[...this.globalInterceptors,...z].flatMap((e=>[{provide:s.APP_INTERCEPTOR,useClass:e},e])),...$,q],imports:[...h],exports:[l.d,c.$,n.d,o.a,i.w,i.m,...t.map((({provide:e})=>e)),u.V,y.f,d.G,S.O,w.u1,C.z,E.h,E.s,T.b,F.E,I.u,N.QI,U.X,A.X,P.J,b.Q1,...$.map((({provide:e})=>e)),k.g],controllers:[_],global:!0}}}R.globalInterceptors=[]},10514:(e,t,r)=>{r.d(t,{H:()=>n,Y:()=>s});r(65192);var s,a=r(21869);!function(e){e.Command="command",e.Query="query",e.Event="event",e.Init="init",e.Cron="cron"}(s||(s={}));const n={body:void 0,context:new a.f,module:"module",name:"command",type:s.Command}},49208:(e,t,r)=>{r.d(t,{u:()=>ye,W:()=>be});var s=r(72742),a=r(10722),n=r(41842),i=r(60399),o=r(1484),c=r(28489);var d=r(84065),l=r(17988),u=r(87279),p=r(95087),m=r(24966),h=r(17350),g=r(162),v=r(46420),f=r(10514),y=r(21869);const b=()=>{},_=()=>{throw new Error("Not supported")};class S{constructor(e,t,r){this.cqrsBroker=e,this.eventsBroker=t,this.cronsBroker=r,this.isListening$=new m.X(!1),this.use=_,this.get=_,this.post=_,this.head=_,this.delete=_,this.put=_,this.options=_,this.patch=_,this.end=_,this.applyVersionFilter=_,this.disconnect=b,this.close=b,this.status=_,this.render=_,this.redirect=_,this.setHeader=_,this.enableCors=_,this.initHttpServer=_,this.registerParserMiddleware=_,this.createMiddlewareFactory=_}isHeadersSent(){return!1}bindHandler(e){if(this.cqrsCallbacks||this.eventCallbacks)throw new Error("Handler already registered");this.cqrsCallbacks={onCommand:(t,r,s,a)=>new Promise(((n,i)=>{e({type:f.Y.Command,module:t,name:r,body:s,context:a},{type:f.Y.Command,value:{result:(0,u.Vp)(void 0)},reply:e=>n(e),fail:e=>i(e)})})),onQuery:(t,r,s,a)=>{const n=new Promise(((n,i)=>{e({type:f.Y.Query,module:t,name:r,body:s,context:a},{type:f.Y.Query,value:{result:h.E},reply:e=>n(e),fail:e=>i(e)})}));return(0,g.D)(n).pipe((0,v.J)())}},this.eventCallbacks={onLocalEvent:(t,r,s,a,n)=>new Promise(((r,i)=>{e({type:f.Y.Event,body:a,context:n,name:s,module:t},{type:f.Y.Event,reply:()=>r(),fail:e=>i(e)})}))},this.cronCallbacks=(t,r)=>new Promise(((s,a)=>{e({type:f.Y.Cron,context:new y.f,module:t,name:r},{type:f.Y.Cron,value:{result:!1},reply:e=>s(e),fail:e=>a(e)})}))}all(e,t){if(!t)throw new Error("Provide a handler");return this.bindHandler(t)}async listen(){if(!this.cqrsCallbacks||!this.eventCallbacks||!this.cronCallbacks)throw new Error("Please call `all(path, handler)` first");const e=await this.cqrsBroker.connect(this.cqrsCallbacks).start(),t=await this.eventsBroker.connect(this.eventCallbacks).start(),r=await this.cronsBroker.connect(this.cronCallbacks).start(),{isListening$:s}=this;this.disconnect=()=>{e.stop(),t.stop(),r.stop(),s.complete()},this.close=this.disconnect,this.isListening$.next(!0)}reply(e,t){switch(e.type){case f.Y.Query:case f.Y.Command:e.reply(t.result);break;case f.Y.Event:e.reply();break;case f.Y.Cron:e.reply(t.result);break;default:(0,p.U)(e)}}getInstance(){return this}getHttpServer(){return{once:b,address:()=>"",removeListener:b}}getType(){return"AppCoreNode"}}const w=()=>{};class E extends o.AbstractHttpAdapter{constructor(e,t,r){super(new S(e,t,r)),this.createMiddlewareFactory=this.instance.createMiddlewareFactory,this.close=this.instance.close,this.reply=this.instance.reply,this.useStaticAssets=w,this.setViewEngine=w,this.getRequestHostname=w,this.status=w,this.render=w,this.redirect=w,this.setNotFoundHandler=w,this.setHeader=w,this.registerParserMiddleware=w,this.enableCors=w,this.setErrorHandler=w,this.end=w,this.isListening$=this.instance.isListening$}initHttpServer(){this.setHttpServer({once:w,address:()=>"",removeListener:w})}getRequestMethod(){return l.RequestMethod.ALL}getRequestUrl(){return"/"}getType(){return"CoreApp"}isHeadersSent(){return!1}applyVersionFilter(){throw new Error("Versioning not supported")}}var C=r(43866),T=r(96917),F=r(42949),N=r(40945),I=r(73018),U=r(79063),P=r(22838);const A=(e,t)=>t.reduce(((t,r)=>{const s=Reflect.getMetadata(U.o,r.module);if(!(0,P.Vy)(s))return t;s.onFrameworkInit&&(s.onFrameworkInit instanceof Array?t.onFrameworkInits=t.onFrameworkInits.concat(s.onFrameworkInit):t.onFrameworkInits.push(s.onFrameworkInit));const a=s.api?.name??s.sharedModuleName??"unnamed";return t.configProviders.push(...function(e,t,r,s){if(!r.configurations)return[];const{configurations:a}=r,n=[];return Object.keys(a).forEach((e=>{const r=a[e].token,i=s.configurations?.[e];if(!i)throw new Error(`Missing '${e}' configuration for '${t}' module`);n.push({...i,provide:r})})),Object.keys(s.configurations??{}).forEach((s=>{r.configurations?.[s]||e.error(`Unknown '${s}' configuration for '${t}' module will be unused`)})),n}(e,a,s,r)),s.api?.name&&t.modulesMetadata.set(s.api.name,s),t.modules.push(r.module),s.crons&&t.crons.push(...s.crons.map((e=>({...e,moduleName:a})))),s.handlers?.events&&t.eventHandlers.push(...Object.values(s.handlers.events).flatMap((e=>Object.values(e.events)))),s.stores&&t.stores.push(...s.stores),t.allDeclarations[a]=s,t}),{configProviders:new Array,modules:new Array,modulesMetadata:new Map,onFrameworkInits:new Array,crons:new Array,eventHandlers:new Array,stores:new Array,allDeclarations:(0,c.Ay)({})});var x=r(54452),D=r(16855),O=r(38144),k=r(15524),R=r(83081),L=r(69594),M=r(17321),j=r(65192);function V(e){const{parameterProvider:t,token:r}=e;switch(t.type){case M.j.CLASS_PROVIDER:return{provide:r,useClass:t.useClass};case M.j.VALUE_PROVIDER:return{provide:r,useValue:t.useValue};default:(0,p.U)(t)}}var z=r(56860),B=r(6903),$=r(10955),q=r(88802),G=r(43978),K=r(69885),H=r(25313),Q=r(82567),W=r(87065),Y=r(25029),X=r(8987),Z=r(94189);const J={tag:""};let ee=class{constructor(e,t,r){this.clients=e,this.config=t,this.introspection=r}intercept(e,t){const r=e.switchToHttp().getRequest(),{appDefinition:s}=this.config;if(r.type===f.Y.Cron)return this.checkCronActiveUser(t,r);if(!(r.module in s))return t.handle();const a=s[r.module].api;switch(r.type){case f.Y.Query:return this.checkQueryActiveUser(t,r,a);case f.Y.Command:return this.checkCommandActiveUser(t,r,a);case f.Y.Event:return this.checkEventActiveUser(t,r,a);default:(0,p.U)(r)}}checkCronActiveUser(e,t){const r=(this.introspection.modules[t.module].crons??[]).find((e=>e.name===t.name));if(!r)throw new Error("No such cron "+t.name);return r.scope===Y.F.Device?e.handle():this.checkActiveUserPromise(e,t.context,{noUserError:J,scope:Y.F.User},"Cron")}checkQueryActiveUser(e,t,r){const{queries:s}=r;if(t.name in s){const r=s[t.name],{metadata:a}=r;return this.checkActiveUserObservable(e,t.context,a,`Query ${t.module}.${t.name}`)}return e.handle()}checkCommandActiveUser(e,t,r){const{commands:s}=r;if(t.name in s){const r=s[t.name],{metadata:a}=r;return this.checkActiveUserPromise(e,t.context,a,`Command ${t.module}.${t.name}`)}return e.handle()}checkEventActiveUser(e,t,r){const{events:s}=r;if(t.name in s){const r=s[t.name],{metadata:a}=r;return this.checkActiveUserPromise(e,t.context,a,`Event ${t.module}.${t.name}`)}return e.handle()}checkActiveUserPromise(e,t,r,s){if(r.scope!==Y.F.User)return e.handle();const{noUserError:a}=r;return(0,g.D)(t.getOrAdd(y.l.UserName,(()=>this.queryUserName()))).pipe((0,G.w)((t=>{if(t)return e.handle();if(a)return(0,K.of)({result:(0,u.Rn)(a)});throw new Error(`Not logged in : ${s}`)})))}checkActiveUserObservable(e,t,r,s){if(r.scope!==Y.F.User)return e.handle();const{noUserError:a}=r;return(0,K.of)({result:a?this.createResultObservable(e,t,(()=>new m.X((0,u.Rn)(a)))):this.createResultObservable(e,t,(()=>(0,H._)((()=>new Error(`Not logged in : ${s}`)))))})}createResultObservable(e,t,r){return this.queryUserName$().pipe((0,Q.b)((e=>{t.set(y.l.UserName,e)})),(0,G.w)((t=>t?e.handle().pipe((0,G.w)((({result:e})=>e))):r())))}queryUserName$(){return this.clients.getClient(X.t$).queries.activeUser().pipe((0,W.U)((e=>{if((0,u.d6)(e)&&(0,u.db)(e).userName)return e.data.userName})))}queryUserName(){return(0,i.z)(this.queryUserName$())}};ee=(0,q.__decorate)([(0,l.Injectable)(),(0,q.__metadata)("design:paramtypes",[Z.m,D.$,P.Q1])],ee);class te{constructor(e,t){this.storage=e,this.storageKey=`crons.${t}`}async setState(e){await this.storage.set(this.storageKey,JSON.stringify(e))}async getState(){const e=await this.storage.get(this.storageKey);if(!e)return{entries:[]};const t=JSON.parse(e);return(r=t)&&"object"==typeof r&&"entries"in r&&Array.isArray(r.entries)&&r.entries.every((e=>function(e){return!!e&&"object"==typeof e&&"dueTimestamp"in e&&"moduleName"in e&&"name"in e&&"string"==typeof e.name&&"string"==typeof e.moduleName&&"number"==typeof e.dueTimestamp}(e)))?t:{entries:[]};var r}}var re=r(34987);const se=6e4;function ae(e){return Math.ceil(e/se)*se}function ne(e){return Math.floor(e/se)*se}class ie{constructor(e,t){this.infra=e,this.definitions=t}async init(){const e=ae(this.infra.timers.time),t=await this.infra.repository.getState(),r=this.definitions.filter((e=>!t.entries.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),s={entries:[...t.entries.filter((e=>this.definitions.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),...r.map((t=>({...t,dueTimestamp:e+t.periodInMinutes*se})))]};await this.infra.repository.setState(s)}connect(e){const{infra:t,definitions:r}=this;return{start:async()=>{await this.init();const s=t.cronSource.alarm$.pipe((0,re.b)((async()=>{const s=await t.repository.getState(),a=ae(t.timers.time),n=ne(t.timers.time),i=s.entries.filter((e=>e.dueTimestamp<=a));await Promise.allSettled(i.map((a=>{const i=r.find((e=>e.moduleName===a.moduleName&&e.name===a.name));if(!i)throw new Error("we should have a declaration");return async function(r,s,a,n){let i=!1;try{i=await e(a.moduleName,a.name)}finally{i&&(a.dueTimestamp=ne(r+n.periodInMinutes*se),await t.repository.setState(s))}}(n,s,a,i)})))}))).subscribe();return{stop:()=>{s.unsubscribe()}}}}}}var oe=r(428);let ce=class{constructor(e,t){this.request=e,this.useCaseStacktraceRepo=t}intercept(e,t){return this.useCaseStacktraceRepo.append(this.request.name),t.handle()}};ce=(0,q.__decorate)([(0,l.Injectable)({scope:l.Scope.REQUEST}),(0,q.__param)(0,(0,l.Inject)(o.REQUEST)),(0,q.__metadata)("design:paramtypes",[Object,oe.F])],ce);var de=r(57924);class le{constructor(e,t){this.client=e.getClient(t)}get commands(){return this.client.commands}get queries(){return this.client.queries}}var ue=r(69008),pe=r(97631),me=r(33920);let he;function ge(e){return function(e){return"module"in e}(e)?e:{module:e}}var ve=r(73656);const fe=[ce,ee],ye=async({appDefinition:e,channels:t,currentNode:r,implementations:l,otherModules:u=[],logger:p=new I.Mn,storeInfrastructureFactory:m=new R.N,channelsListener:h=x.y,timers:g=new I.mZ,keyValueStorageInfrastructure:v=new k.s,jsonFetcher:b=new I.kl,cronSource:_=new L._C(g),defaultDeviceStorageEncryptionCodec:S={type:M.j.CLASS_PROVIDER,useClass:a.E},defaultUserStorageEncryptionCodec:w={type:M.j.CLASS_PROVIDER,useClass:a.E},exceptionLogging:U=$.I})=>{const q=()=>{throw new Error("Aborted")};ve.abort=q,ve.exit=q;const G={...e,[s.P.name]:{api:s.P,main:r,queryOnly:[]}},K=[...[B.G.configure(U)],...u,...Object.keys(l).map((e=>e)).map((e=>l[e]))].map(ge),{configProviders:H,modules:Q,modulesMetadata:W,onFrameworkInits:Y,crons:X,eventHandlers:J,stores:ee,allDeclarations:re}=A(p,K),se=new z.D;ee.forEach((e=>{se.registerClass(e)})),((e,t,r)=>{const s=new Set([...r.keys()]),a=new Set(Object.values(e).filter((e=>e.main===t||e.queryOnly.includes(t))).map((e=>e.api.name))),n=[...a].filter((e=>!s.has(e))),i=[...s].filter((e=>!a.has(e)));if(n.length>0)throw new Error("These APIs are not implemented "+JSON.stringify(n));if(i.length>0)throw new Error("Some implementations do not have APIS "+JSON.stringify(i))})(G,r,W);const ae=(e=>[...e.entries()].reduce(((e,[t,r])=>{const s=r.handlers?.events??{};return e[t]=Object.values(s).reduce(((e,t)=>t.name?(e[t.name]=Object.keys(t.events),e):e),(0,c.Ay)({})),e}),(0,c.Ay)({})))(W),ne=new D.$({appDefinition:G,channels:t,channelsListener:h,currentNode:r,subscriptions:ae}),oe=new F.d(ne),ce=new T.a(ne),ye=new ie({cronSource:_,repository:new te(v,r),timers:g},X),be=new E(oe,ce,ye),_e=V({token:O.h,parameterProvider:S}),Se=V({token:O.s,parameterProvider:w}),we=new C.d,Ee=new P.Q1(new Set(J),re),Ce=function(e){const t=[];return Object.values(e).forEach((e=>{const{api:r}=e,{ClientClass:s}=r;s&&((0,de.GS)()(s),t.push({provide:s,useFactory:e=>new le(e,r),inject:[Z.w]}))})),t}(G),Te={useFactory:(e,t,r)=>{const s=e.get(y.l.UserName);if(s)return he&&he.status!==me.p.Closed||(he=new pe.g(s,r,t)),Promise.resolve(he)},provide:pe.g,inject:[y.f,ue.Q,C.d]},Fe=d.b.create({nodeConfiguration:ne,brokers:{cqrs:oe,event:ce},modules:Q,configProviders:H,logger:p,lifeCycle:we,storeInfrastructureFactory:m,timers:g,keyValueStorageInfrastructure:v,jsonFetcher:b,defaultDeviceStorageEncryptionCodecProvider:_e,defaultUserStorageEncryptionCodecProvider:Se,storeList:se,interceptors:fe,introspection:Ee,moduleClientsProviders:Ce,userUseCaseScopeProvider:Te}),Ne=await o.NestFactory.create(Fe,be,{logger:p}),Ie=await Ne.init();await async function(e,t){const r=Object.freeze({id:-1}),s=e.map((async e=>{const s={type:f.Y.Init,[j.REQUEST_CONTEXT_ID]:r};t.registerRequestByContextId(s,r);const a=await t.resolve(e,r,{strict:!1});await a.onFrameworkInit()}));await Promise.all(s)}(Y,Ie),Ne.listen("");const Ue=be.isListening$.pipe((0,n.h)((e=>!!e)));return await(0,i.z)(Ue),we.addShutdownHook((()=>Ne.close())),await we.startup(),{stop:()=>we.shutDown(),createClient:()=>(0,N.R)(G,oe),sendEvent:(e,t,r,s)=>ce.publishEvent(e,t,r,s??new y.f)}},be=e=>ye({...e,appDefinition:e.appDefinition,channels:{},currentNode:"node"})},42949:(e,t,r)=>{r.d(t,{d:()=>g});var s=r(162),a=r(60399),n=r(41842),i=r(87065),o=r(17350),c=r(95087),d=r(28489);const l=e=>"response"===e.type,u=(e,t,r,s)=>Object.keys(e).reduce(((a,n)=>{const{commandMailbox:i,queryMailbox:o}=(a=>{const{main:n,queryOnly:i}=e[a],o={type:"local",onMessage:s};if(n===t)return{commandMailbox:o,queryMailbox:o};const c={type:"remote",channel:r[n]};return{commandMailbox:c,queryMailbox:t&&i.includes(t)?o:c}})(n);return a[`command-${n}`]=i,a[`query-${n}`]=o,a}),(0,d.Ay)({}));var p=r(65488),m=r(21869);const h=()=>(0,s.D)([]);class g{constructor(e){this.config=e}async sendCommand(e,t,r,s){if(!this.broker)throw new Error("call connect() first");return await(0,a.z)(this.broker.sendMessage(`command-${e}`,{type:"command",module:e,commandName:String(t),command:r,context:s.toSerializable()}).pipe((0,n.h)(l),(0,i.U)((e=>e.response))))}sendQuery(e,t,r,s){if(!this.broker)throw new Error("call connect() first");return this.broker.sendMessage(`query-${e}`,{type:"query",module:e,queryName:String(t),query:r,context:s.toSerializable()}).pipe((0,n.h)(l),(0,i.U)((e=>e.response)))}connect(e){const t=e?(t,r,a)=>{switch(r.type){case"response":return o.E;case"command":return(0,s.D)(e.onCommand(r.module,r.commandName,r.command,m.f.fromSerializable(r.context),{isReminder:a.isReminder})).pipe((0,i.U)((e=>({type:"response",response:e}))));case"query":return(0,s.D)(e.onQuery(r.module,r.queryName,r.query,m.f.fromSerializable(r.context))).pipe((0,i.U)((e=>({type:"response",response:e}))))}(0,c.U)(r)}:h,r=u(this.config.appDefinition,this.config.currentNode,this.config.channels,t);return this.broker=new p.U(r),this.broker.connect(Object.values(this.config.channels),this.config.channelsListener)}}},94189:(e,t,r)=>{r.d(t,{m:()=>l,w:()=>d});var s=r(88802),a=r(57924),n=r(16855),i=r(42949),o=r(40945),c=r(21869);let d=class{constructor(e,t,r){this.broker=e,this.configuration=t,this.context=r}getClient(e){return(0,o.c)(this.configuration.appDefinition,this.broker,e.name,this.context)}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.d,n.$,c.f])],d);let l=class{constructor(e,t){this.configuration=e,this.broker=t}getClient(e){return(0,o.c)(this.configuration.appDefinition,this.broker,e.name)}};l=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.$,i.d])],l)},40945:(e,t,r)=>{r.d(t,{R:()=>i,c:()=>n});var s=r(28489),a=r(21869);function n(e,t,r,n){return{commands:Object.keys(e[r].api.commands).reduce(((e,s)=>(e[s]=e=>{const i=n??new a.f;return t.sendCommand(r,s,e,i)},e)),(0,s.Ay)({})),queries:(()=>{const i=e[r].api.queries;return Object.keys(i).reduce(((e,s)=>(e[s]=e=>{const i=n??new a.f;return t.sendQuery(r,s,e,i)},e)),(0,s.Ay)({}))})()}}function i(e,t){return Object.keys(e).map((e=>e)).reduce(((r,s)=>(r[s]=n(e,t,s),r)),{})}},81459:(e,t,r)=>{r.d(t,{C:()=>l,f:()=>d});var s=r(88802),a=r(17988),n=r(57924),i=r(93417),o=r(96917),c=r(21869);let d=class{constructor(e,t,r){this.apiName=e,this.broker=t,this.context=r}sendEvent(e,t){return this.broker.publishEvent(this.apiName,e,t,this.context)}};d=(0,s.__decorate)([(0,n.GS)(),(0,s.__param)(0,(0,a.Inject)(i.r)),(0,s.__metadata)("design:paramtypes",[Object,o.a,c.f])],d);let l=class{constructor(e,t){this.apiName=e,this.broker=t}sendEvent(e,t,r){return this.broker.publishEvent(this.apiName,e,t,r??new c.f)}};l=(0,s.__decorate)([(0,n.GS)(),(0,s.__param)(0,(0,a.Inject)(i.r)),(0,s.__metadata)("design:paramtypes",[Object,o.a])],l)},96917:(e,t,r)=>{r.d(t,{a:()=>b});var s=r(88802),a=r(162),n=r(87065),i=r(17350),o=r(69885),c=r(12768),d=r(3497),l=r(40548),u=r(85270),p=r(65488),m=r(28489);const h={type:"ask"},g={type:"eventResponse"};var v=r(57924),f=r(16855),y=r(21869);let b=class{constructor(e){this.regenerateReverseSubscriptionMap=()=>{const{configuration:e,subscriberToEvent:t}=this,r=e.getModuleNames().reduce(((e,t)=>({...e,[t]:new Map})),{});return e.getNodeList().reduce(((e,r)=>{const s=t[r];return Object.entries(s).forEach((([t,s])=>{const a=e[t];s.forEach((e=>{const t=[...a.get(e)??[],r];a.set(e,t)}))})),e}),r)},this.configuration=e;const t=Object.entries(e.appDefinition).reduce(((e,[t,r])=>(e[t]=Object.keys(r.api.events),e)),{});this.subscriberToEvent=this.configuration.getNodeList().reduce(((e,r)=>(e[r]={...t},e)),{}),this.eventToSubscriber=this.regenerateReverseSubscriptionMap()}async publishEvent(e,t,r,s){const{broker:a,eventToSubscriber:n}=this;if(!a)throw new Error("Not started");const i=(n[e].get(t)??[]).map((a=>({type:"event",context:s.toSerializable(),event:r,eventName:t,moduleSource:e,nodeDestination:a})));await Promise.all(i.map((async e=>{await a.trySendMessage(`event-${e.nodeDestination}`,e)})))}connect(e){const{configuration:t}=this,r=Object.keys(t.subscriptions).reduce(((e,r)=>{const s=t.subscriptions[r];return(0,c.Z)((0,d.Z)(l.Z,u.Z),e,s)}),(0,m.Ay)({})),s={type:"subscriptions",nodeName:t.currentNode,subscribesTo:r},v=((e,t)=>e.getNodeList().reduce(((r,s)=>(s===e.currentNode?r[`event-${s}`]={type:"local",onMessage:t}:r[`event-${s}`]={type:"remote",channel:e.channels[s]},r)),(0,m.Ay)({})))(this.configuration,((t,r,c)=>{switch(r.type){case"event":return(0,a.D)(e.onLocalEvent(r.moduleSource,r.nodeDestination,r.eventName,r.event,y.f.fromSerializable(r.context),c)).pipe((0,n.U)((()=>g)));case"eventResponse":return i.E;case"subscriptions":return this.subscriberToEvent[r.nodeName]=r.subscribesTo,this.eventToSubscriber=this.regenerateReverseSubscriptionMap(),(0,o.of)(g);case"ask":return(0,o.of)(s)}})),f=new p.U(v);return t.getNodeList().map((async e=>{await f.trySendMessage(`event-${e}`,s),await f.trySendMessage(`event-${e}`,h)})),this.broker=f,f.connect(Object.values(t.channels),t.channelsListener)}};b=(0,s.__decorate)([(0,v.GS)(),(0,s.__metadata)("design:paramtypes",[f.$])],b)},63663:(e,t,r)=>{r.d(t,{W:()=>a});var s=r(57924);function a(e){const t=(0,s.GS)();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}},11053:(e,t,r)=>{r.d(t,{Tx:()=>u,b2:()=>l,u1:()=>p});var s=r(88802),a=r(6220),n=r(7074),i=r(58376),o=r(57924),c=r(21904),d=r(94189);function l(e){return e}class u{constructor(e,t,{args:r,commandName:s}){const i=t.commands[s];this.refreshObservable$=e.pipe((0,a.z)((async()=>{await i(r)})),(0,n.B)({}))}withRefresh(){return e=>new i.y((t=>{const r=this.refreshObservable$.subscribe();return r.add(e.subscribe(t)),r}))}}let p=class{constructor(e,t){this.timers=e,this.cqrsClient=t,this.map=new WeakMap}getRefresher(e){const t=this.map.get(e);if(t)return t;return new u(this.timers.createObservableTimer(e.period,e.period),this.cqrsClient.getClient(e.api),e)}};p=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[c.O,d.m])],p)},68307:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(57924);function a(e){const t=(0,s.GS)();return r=>{if(Reflect.hasMetadata("dl-handlers",e)){const t=Reflect.getMetadata("dl-handlers",e);Reflect.defineMetadata("dl-handlers",[...t,r],e)}else Reflect.defineMetadata("dl-handlers",[r],e);t(r)}}},20754:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(57924);function a(e){const t=(0,s.GS)();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}},79063:(e,t,r)=>{r.d(t,{o:()=>s});const s="dl-module"},38679:(e,t,r)=>{r.d(t,{H:()=>c});var s=r(1484),a=r(78776),n=r(57924),i=r(64987),o=r(43866);const c=(e,t)=>{const r=t.token??(0,a.Z)();class c{constructor(){this.mutex=new i.WU}getOrCreate(e,t){return this.mutex.runExclusive((async()=>(this.instance||(t.addShutdownHook((()=>{this.invalidate()})),this.instance=await e()),this.instance)))}invalidate(){this.instance=void 0}}(0,n.GS)()(c);const d=c,l={token:e,inject:[c,o.d,s.ModuleRef,s.REQUEST],asyncFactory:(e,t,a,n)=>{const i=s.ContextIdFactory.getByRequest(n);return e.getOrCreate((()=>a.resolve(r,i)),t)}};return[{...t,token:r},d,l]}},57924:(e,t,r)=>{r.d(t,{GS:()=>n,ar:()=>i,xB:()=>a});var s=r(17988);function a(){return(0,s.Global)()}function n(e){return(0,s.Injectable)({scope:e?.neverReuseInstance?s.Scope.TRANSIENT:s.Scope.DEFAULT})}const i=()=>n()},99634:(e,t,r)=>{r.d(t,{Yl:()=>y,g4:()=>v});r(60171);var s=r(79063),a=r(17988),n=r(93417),i=r(88802),o=r(43702),c=r(23711),d=r(91199),l=r(21869);const u=new o.b,p=new c.z;let m=class{constructor(e,t,r){this.kv=e,this.prefix=`batch-storage.${r}.${t.get(l.l.UserName)}`}async getBatchState(e){const t=await this.kv.get(`${this.prefix}.${e}`);return t?this.stringToState(t):{queue:[]}}async setBatchState(e,t){const r=this.stateToString(t);return await this.kv.set(`${this.prefix}.${e}`,r)}stateToString(e){const t=u.encode(e);return p.encode(t)}stringToState(e){const t=p.decode(e);return u.decode(t)}};m=(0,i.__decorate)([(0,i.__param)(2,(0,a.Inject)(n.r)),(0,i.__metadata)("design:paramtypes",[d.QI,l.f,String])],m);class h{getProviders(e){if(!e.length)return[];return[...e.map((e=>({provide:e,inject:[m,e.Definition.chunkProcessor],useFactory:(t,r)=>new e(t,r)}))),...e.map((({Definition:{chunkProcessor:e}})=>e)),m]}}var g=r(5711);const v=(e,t)=>({[e.name]:{name:e.name,events:t}}),f=(e,t)=>{const{exports:r=[],imports:s=[],providers:a=[],onFrameworkInit:n=[],stores:i=[],crons:o=[]}=e,c=[n,t.onFrameworkInit??[]].flat();return{...e,exports:r.concat(t.exports??[]),imports:s.concat(t.imports??[]),providers:a.concat(t.providers??[]),onFrameworkInit:c,stores:i.concat(t.stores??[]),crons:o.concat(t.crons??[])}};function y(e){const{composes:t=[]}=e;e=t.reduce(((e,t)=>f(e,t)),e);const{exports:r=[],imports:i=[],handlers:o={commands:{},events:{},queries:{}},providers:c=[],onFrameworkInit:d=[],stores:l,batchExecutors:u,crons:p}=e,m=e.api?.name??e.sharedModuleName,v=m?(0,g.N)(...l??[]):[],y=m?(new h).getProviders(u??[]):[],b=[...c,...(p??[]).map((e=>e.handler)),...v,...y,...Object.values(o.commands),...Object.values(o.queries),...Object.values(o.events).map((e=>Object.values(e.events))).reduce(((e,t)=>[...e,...t]),new Array),...d instanceof Array?d:[d],{provide:n.r,useValue:m}],{asyncProviders:_,basicClassProviders:S}=b.reduce(((e,t)=>{return"object"==typeof(r=t)&&"token"in r&&"asyncFactory"in r&&"function"==typeof r.asyncFactory?{asyncProviders:[...e.asyncProviders,t],basicClassProviders:e.basicClassProviders}:{asyncProviders:e.asyncProviders,basicClassProviders:[...e.basicClassProviders,t]};var r}),{asyncProviders:new Array,basicClassProviders:new Array}),w=[...S,..._.map((e=>({provide:e.token,useFactory:e.asyncFactory,inject:e.inject})))],E=(0,a.Module)({exports:r,imports:i,providers:w});return t=>(Reflect.defineMetadata(s.o,e,t),E(t))}var b;!function(e){e.PROVIDERS="providers",e.IMPORTS="imports"}(b||(b={}))},93417:(e,t,r)=>{r.d(t,{r:()=>s});const s="frameworkModuleName"},22838:(e,t,r)=>{r.d(t,{Q1:()=>n,TB:()=>s,Vy:()=>a});const s={commands:{},events:{},queries:{}},a=e=>!(!e||"object"!=typeof e)&&(!(e.api&&!(e.api.commands&&e.api.events&&e.api.name&&e.api.queries&&e.handlers))&&(!(e.exports&&!Array.isArray(e.exports))&&(!(e.handlers&&!e.api)&&(!(e.imports&&!Array.isArray(e.imports))&&!(e.providers&&!Array.isArray(e.providers))))));class n{constructor(e,t){this.supportedEventHandlers=e,this.modules=t}}},31638:(e,t,r)=>{r.d(t,{$:()=>n,z:()=>a});var s=r(17321);function a(e){return{type:s.j.VALUE_PROVIDER,useValue:e}}function n(e){return{type:s.j.CLASS_PROVIDER,useClass:e}}},17321:(e,t,r)=>{var s;r.d(t,{j:()=>s}),function(e){e.VALUE_PROVIDER="value_provider",e.CLASS_PROVIDER="class_provider"}(s||(s={}))},63411:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(25029),a=r(95087),n=r(38679),i=r(97956);const o=(e,t,r)=>{switch(e){case s.F.Device:return(0,n.H)(t,r);case s.F.User:return(0,i.M)(t,r);default:(0,a.U)(e)}}},97956:(e,t,r)=>{r.d(t,{M:()=>c});var s=r(1484),a=r(78776),n=r(64987),i=r(21869),o=r(97631);const c=(e,t)=>{const r=t.token??(0,a.Z)();class c{constructor(){this.instances=new Map,this.mutex=new n.WU}getOrCreate(e,t,r){return this.mutex.runExclusive((async()=>{const s=this.instances.get(e);if(s)return s;r.addCloseHook((()=>{this.invalidate(e)}));const a=await t();return this.instances.set(e,a),a}))}invalidate(e){this.instances.delete(e)}}const d=c,l={token:e,inject:[c,i.f,s.ModuleRef,s.REQUEST,o.g],asyncFactory:(t,a,n,o,c)=>{const d=s.ContextIdFactory.getByRequest(o),l=a.getOrDefault(i.l.UserName,"");if(""===l)throw new Error(`Provider ${e} is a user-scoped singleton but there is no user`);if(!c)throw new Error("No user scope available");return t.getOrCreate(l,(()=>n.resolve(r,d)),c)}};return[{token:r,asyncFactory:t.asyncFactory,inject:[...t.inject??[],i.f]},d,l]}},9671:(e,t,r)=>{r.d(t,{J:()=>b,f:()=>_});var s=r(88802),a=r(1484),n=r(17988),i=r(60399),o=r(87065),c=r(89618),d=r(37182),l=r(69885),u=r(21242),p=r(87279),m=r(10514),h=r(43004),g=r(37920),v=r(21869),f=r(68475),y=r(428);let b=class{constructor(e,t,r,s){this.request=e,this.logger=t,this.useCaseStacktraceRepo=r,this.featureFlips=s}async do(...e){return(await Promise.all(e.map((e=>this.doOne(e))))).every((e=>!!e))}async doOne(e,t="method"){try{const r=await e();if((0,p.AZ)(r)&&(0,p.hx)(r))throw new Error(`Allowed to fail ${t} has failed`);return!0}catch(e){const{request:t,useCaseStacktraceRepo:r}=this,[s,a]=e instanceof f.c?[e.exception,e.useCaseStacktrace]:[e,r.read()];try{await Promise.race([new Promise((e=>setTimeout(e,100))),this.logger.captureException(s,{moduleName:t?.module,useCaseId:t?.context.get(v.l.UseCaseId),useCaseName:t?.name,useCaseStacktrace:a,featureFlips:await this.getUserFeatureFlips()},h.w.WARNING)])}catch(e){}return!1}}async conditionallyAllowToFailOne(e,t){return t?this.doOne(e):(await e(),!0)}getUserFeatureFlips(){const{userFeatureFlips:e}=this.featureFlips.queries;return(0,i.z)(e().pipe((0,o.U)((e=>(0,p.d6)(e)?(0,p.db)(e):{})),(0,c.V)(50),(0,d.K)((()=>(0,l.of)({})))))}};function _(){return new b(m.H,(0,g.G)(),y.U,{getClient:()=>({queries:{userFeatureFlips:()=>(0,l.of)((0,p.Vp)({}))}})})}b=(0,s.__decorate)([(0,s.__param)(0,(0,n.Inject)(a.REQUEST)),(0,s.__metadata)("design:paramtypes",[Object,g.v,y.F,u.P])],b)},46434:(e,t,r)=>{r.d(t,{o:()=>s});class s{}},64606:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(88802),a=r(26457),n=r(57924),i=r(46434);let o=class{constructor(e,t){this.logger=e,this.emitterChannel=t}downloadFile(e,t,r){this.logger.log(`downloading file ${e}`),this.emitterChannel.send(e,t,r)}};o=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[a.V,i.o])],o)},38085:(e,t,r)=>{r.d(t,{l:()=>c});var s=r(88802),a=r(52387),n=r(99634),i=r(64606),o=r(46434);let c=class{};c=(0,s.__decorate)([(0,n.Yl)({api:a.L,configurations:{fileDownloadEmitterChannel:{token:o.o}},handlers:{commands:{},events:{},queries:{}},stores:[],providers:[i._],exports:[i._],domainName:"framework"})],c)},73774:(e,t,r)=>{r.d(t,{e:()=>h});var s=r(88802),a=r(69885),n=r(34987),i=r(97280),o=r(48844),c=r(95087);class d{constructor(e,t){this.pipeline=this.initPipeline(e,this.dedupeInterceptorsById(t))}handle(e){return this.pipeline.handle(e)}dedupeInterceptorsById(e){const t=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);return Array.from(t.values())}initPipeline(e,t){return t.reduceRight(((e,t)=>({handle:r=>t.intercept(r,e.handle.bind(e))})),e)}}var l=r(4043);class u{constructor(e){this.backend=e,this.interceptors=new Map}addInterceptor(e){this.interceptors.set(e.id,e)}request(...e){return this.makeRequest(...e)}delete(e,t){return this.makeRequest("DELETE",e,t)}get(e,t){return this.makeRequest("GET",e,t)}head(e,t){return this.makeRequest("HEAD",e,t)}options(e,t){return this.makeRequest("OPTIONS",e,t)}patch(e,t,r){return this.makeRequest("PATCH",e,{body:t,...r})}post(e,t,r){return this.makeRequest("POST",e,{body:t,...r})}put(e,t,r){return this.makeRequest("PUT",e,{body:t,...r})}makeRequest(...e){let t,r,s;if(1===e.length)t=e[0],r="response";else{const[a,n,i]=e;t=new l.a(a,n,void 0!==i.body?i.body:null,{headers:i.headers,params:i.params,responseType:i.responseType??"json",withCredentials:i.withCredentials}),r=i.observe??"body","json"===i.responseType&&"body"===i.observe&&(s=i.responseBodyDecoder)}const u=new d(this.backend,Array.from(this.interceptors.values())),p=(0,a.of)(this.addContentTypeRequestHeader(t)).pipe((0,n.b)((e=>u.handle(e))),(0,i.d)(1));switch(r){case"body":switch(t.responseType){case"arraybuffer":return p.pipe((0,o.Gx)((e=>e.arrayBuffer())));case"text":return p.pipe((0,o.Gx)((e=>e.text())));case"json":return p.pipe((0,o.Gx)((e=>e.json(s))));default:(0,c.U)(t.responseType)}break;case"response":return p;default:(0,c.U)(r)}}addContentTypeRequestHeader(e){if(!e.headers.has("content-type")){const t=e.detectContentTypeHeader();if(t)return e.clone({headers:e.headers.set("content-type",t)})}return e}}var p=r(22253),m=r(57924);let h=class extends u{constructor(e){super(e)}};h=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[p.j])],h)},25504:(e,t,r)=>{r.d(t,{X:()=>l});var s,a=r(88802),n=r(1484),i=r(22253),o=r(73774),c=r(99634);const d=[];let l=s=class{static configure(e){return{module:s,configurations:{infrastructure:e}}}static addGlobalInterceptor(e){d.push(e)}};l=s=(0,a.__decorate)([(0,c.Yl)({providers:[{asyncFactory:async(e,t)=>{const r=new o.e(e);return(await Promise.all(d.map((e=>t.create(e))))).forEach((e=>r.addInterceptor(e))),r},token:o.e,inject:[i.j,n.ModuleRef]}],configurations:{infrastructure:{token:i.j}},exports:[o.e],sharedModuleName:"http",domainName:"framework"})],l)},52737:(e,t,r)=>{r.r(t),r.d(t,{AcknowledgedChannel:()=>q.N,AllowedToFail:()=>Ie.J,AppLifeCycle:()=>i.d,AppLogger:()=>a.V,AppTimers:()=>o.O,BadStatus:()=>I.R,BaseEventEmitter:()=>se.f,ChannelMessageBroker:()=>z.U,ChannelState:()=>B.D,CommandHandler:()=>H.W,CommandRefresherFactory:()=>Y.u1,ConcurrencyTestTimers:()=>h,ContextLessCqrsClient:()=>re.m,ContextlessBaseEventEmitter:()=>se.C,CqrsBroker:()=>X.d,CqrsClient:()=>re.w,CqrsCommandRefresher:()=>Y.Tx,CronLowLevelSource:()=>Te.R_,DefaultEncryptionCodecForDeviceData:()=>pe.h,DefaultEncryptionCodecForUserData:()=>pe.s,DefaultLogger:()=>Pe.Mn,DefaultTimers:()=>Pe.mZ,EventHandler:()=>W.b,ExceptionCriticality:()=>R.w,ExceptionLogger:()=>M.v,ExceptionLoggingModule:()=>j.G,ExceptionLoggingSink:()=>L.qD,FetchFailedError:()=>I.a,FileDownloadEmitterChannel:()=>xe.o,FileDownloadListenerChannel:()=>Ae,FileDownloadModule:()=>Oe.l,FileDownloadService:()=>De._,FrameworkInit:()=>y.ar,FrameworkRequestContextValues:()=>Ue.l,Global:()=>y.xB,HttpBackend:()=>E.j,HttpClient:()=>P.e,HttpHeaders:()=>C.W,HttpModule:()=>A.X,HttpParams:()=>T.L,HttpRequest:()=>F.a,HttpResponse:()=>U.Z,HttpStatusCode:()=>N.W,Injectable:()=>y.GS,JsonApplicationResourceFetcher:()=>Fe.X,JsonApplicationResourceLoader:()=>Ne.K,KeyValueStorageFactory:()=>ue.u,KeyValueStorageInfrastructure:()=>le.QI,MV3ExtensionHttpInterceptor:()=>x.I,MV3ExtensionResilienceModule:()=>D.f,MV3LongRunningTaskInterceptor:()=>O.V,MV3ServiceWorkerExtenderBase:()=>k.g,ManualTriggeredTimers:()=>o.r,MemoryChannel:()=>B.q,MemoryKeyValueStorageInfrastructure:()=>me.s,MemoryStoreInfrastructureFactory:()=>he.N,Module:()=>f.Yl,NoDynamicChannels:()=>$.y,NodeConfiguration:()=>K.$,NodeEventBroker:()=>Z.a,NodeModulesIntrospection:()=>b.Q1,NodeToModuleEventBroker:()=>ee,NullCronTaskHandler:()=>Te.ql,NullLogger:()=>a.W,NullStorage:()=>le.hL,ParameterProviderType:()=>g.j,QueryHandler:()=>Q.e,RequestContext:()=>Ue.f,RequestContextModule:()=>de.q,SingleNodeAppBuilder:()=>n.u,Store:()=>be.y,StoreCapacity:()=>ve.Y,StoreFlusher:()=>ye.X,StoreInfrastructureFactory:()=>he.G,TaskTrackingModule:()=>V.c,ThrowJsonFetcher:()=>Pe.kl,TimerBasedCronSource:()=>Te._C,UncaughtErrorSource:()=>L.fW,VerboseLogger:()=>Pe.IO,createApplicationClient:()=>ae,createCqrsClient:()=>te.c,createCqrsClients:()=>te.R,createNullAllowedToFail:()=>Ie.f,createNullExceptionLogger:()=>M.G,createSingleChannelListener:()=>$.v,defineApplication:()=>n.t,defineBatchExecutor:()=>Ce,defineStore:()=>ge.Q,deviceScopedSingletonProvider:()=>w.H,getQueryValue:()=>ce,getStoresProviders:()=>fe.N,isExceptionLogEntry:()=>R.h,isSendMessageRequest:()=>G.F,isVersionedData:()=>le.Ot,mockTimer:()=>m,provideClass:()=>v.$,provideValue:()=>v.z,refresherCreationToken:()=>Y.b2,scopedSingleton:()=>S.B,sendMessageRequest:()=>G.k,startApplicationNode:()=>s.u,startSingleApplicationNode:()=>s.W,useEventsOfModule:()=>f.g4,userScopedSingletonProvider:()=>_.M});var s=r(49208),a=r(26457),n=r(96259),i=r(43866),o=r(21904),c=r(98187),d=r(83695),l=r(78263),u=r(87065),p=r(6220);function m(e,t,r,s){const a=[];if(t<r)return[];if(e<r){if(a.push(r),0===s)return a;let e=r+s;for(;e<=t;)a.push(e),e+=s;return a}if(s<=0)return[];let n=r+(Math.trunc((e-r)/s)+1)*s;for(;n<=t;)a.push(n),n+=s;return a}class h extends o.O{constructor(){super(...arguments),this.source$=new c.x,this.time=0}fireTimer(e=1){this.time=this.time+e,this.source$.next(this.time)}createObservableTimer(e,t){return this.source$.pipe((0,d.O)(0),(0,l.G)(),(0,u.U)((([r,s])=>m(r,s,e,t))),(0,p.z)((e=>e)))}}var g=r(17321),v=r(31638),f=r(99634),y=r(57924),b=r(22838),_=r(97956),S=r(63411),w=r(38679),E=r(22253),C=r(85260),T=r(61223),F=r(4043),N=r(25994),I=r(73155),U=r(12964),P=r(73774),A=r(25504),x=r(25123),D=r(54193),O=r(56656),k=r(95237),R=r(43004),L=r(63364),M=r(37920),j=r(6903),V=r(7876),z=r(65488),B=r(15572),$=r(54452),q=r(58649),G=r(45244),K=r(16855),H=r(63663),Q=r(20754),W=r(68307),Y=r(11053),X=r(42949),Z=r(96917),J=r(28489);class ee{constructor(e){this.publishEvent=(e,t,r,s)=>this.broker.publishEvent(e,t,r,s),this.broker=new Z.a(e);const t=e.getModuleNames().reduce(((t,r)=>({...t,[r]:Object.keys(e.appDefinition[r].api.events).reduce(((e,t)=>(e[t]=[],e)),(0,J.Ay)({}))})),(0,J.Ay)({}));this.localSubscribersMap=Object.keys(e.subscriptions).map((e=>e)).reduce(((t,r)=>{const s=e.subscriptions[r];return Object.keys(s).map((e=>e)).forEach((e=>{const a=s[e]??[],n=t[e];a.forEach((e=>{n[e].push(r)}))})),t}),t)}connect(e){const{localSubscribersMap:t,broker:r}=this;return r.connect({onLocalEvent:async(r,s,a,n,i,o)=>{const c=t[r][a];await Promise.all(c.map((async t=>{await e.onEvent(r,t,a,n,i,o)})))}})}}var te=r(40945),re=r(94189),se=r(81459);function ae({appDefinition:e,channels:t,channelsListener:r}){const s=new K.$({appDefinition:e,channels:t,channelsListener:r,currentNode:null,subscriptions:{}}),a=new X.d(s),n=()=>{throw new Error("Unexpected request received by detached application client")},i=a.connect({onCommand:n,onQuery:n}).start();return{client:(0,te.R)(e,a),stop:async()=>(await i).stop()}}var ne=r(27149),ie=r(60399),oe=r(89618);async function ce(e,t=1e4){if(!(0,ne.b)(e))throw new Error("Error in getQueryValue: the argument is not an observable");try{return await(0,ie.z)(e.pipe((0,oe.V)({first:t})))}catch(e){throw new Error("Error in getQueryValue: "+e)}}var de=r(23370),le=r(91199),ue=r(4603),pe=r(38144),me=r(15524),he=r(83081),ge=r(95681),ve=r(23347),fe=r(5711),ye=r(71949),be=r(76072),_e=r(64987);const Se=16,we=.5,Ee=1.3;function Ce(e){var t;const{chunkControl:{decrement:r=we,increment:s=Ee,initialSize:a=Se}={decrement:we,increment:Ee,initialSize:Se}}=e;const n=new _e.WU;return(t=class{constructor(e,t){this.repository=e,this.processor=t}async dispatchBatch(e){await n.runExclusive((async()=>{const t=await this.pushItemsInQueue(e);for(;t.queue.length>0;)await this.processOneChunkFromQueue(t)}))}async pushItemsInQueue(t){const r=await this.repository.getBatchState(e.name),s=t.filter((e=>!r.queue.find((t=>t===e))));return s.length&&(r.queue.push(...s),await this.repository.setBatchState(e.name,r)),r}async processOneChunkFromQueue(t){const n=function(e){const{lastStartedChunkFirstId:t,lastStartedChunkSize:n=a}=e;if(!t)return a;const i=!e.queue.find((e=>e===t));return Math.max(1,i?Math.ceil(n*s):Math.floor(n*r))}(t),i=Math.min(n,t.queue.length);if(!i)throw new Error("Should have something to process");await this.repository.setBatchState(e.name,{...t,lastStartedChunkSize:i,lastStartedChunkFirstId:t.queue[0]});const o=t.queue.splice(0,i);await this.processor.processChunk(o),await this.repository.setBatchState(e.name,t)}}).Definition=e,t}var Te=r(69594),Fe=r(75994),Ne=r(67978),Ie=r(9671),Ue=r(21869),Pe=r(73018);class Ae{}var xe=r(46434),De=r(64606),Oe=r(38085)},37920:(e,t,r)=>{r.d(t,{G:()=>d,v:()=>c});var s=r(88802),a=r(17988),n=r(26457),i=r(63364),o=r(43004);let c=class{constructor(e,t){this.sink=e,this.logger=t}captureException(e,t,r=o.w.CRITICAL){try{const s=e instanceof Error?e:new Error("Invalid exception type"),a=this.createExceptionLogEntry(t,s,r);return this.sink.logException(a)}catch(r){this.logger.error("Failed to capture exception",r,e,t)}return Promise.resolve()}createExceptionLogEntry(e,t,r){return{callStack:t.stack??"",criticality:r,featuresFlipped:this.mapFeatures(e.featureFlips??{}),fileLocation:e.fileLocation,lineNumber:e.lineNumber,message:t.message,moduleName:e.moduleName,domainName:e.domainName,origin:e.origin,timestamp:Date.now(),useCaseId:e.useCaseId,useCaseName:e.useCaseName,useCaseStacktrace:e.useCaseStacktrace,cause:JSON.stringify(t.cause)}}mapFeatures(e){return Object.keys(e).reduce(((t,r)=>e[r]?[r,...t]:t),[])}};function d(){return new c(new i.p$,new n.W)}c=(0,s.__decorate)([(0,a.Injectable)(),(0,s.__metadata)("design:paramtypes",[i.qD,n.V])],c)},10955:(e,t,r)=>{r.d(t,{I:()=>o});var s=r(17350),a=r(31638),n=r(63364);class i extends n.fW{constructor(){super(s.E)}}const o={sink:(0,a.z)(new class{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}),uncaughtErrorSource:(0,a.z)(new i)}},63364:(e,t,r)=>{r.d(t,{fW:()=>n,p$:()=>a,qD:()=>s});class s{}class a extends s{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}class n{constructor(e){this.events$=e}}},68475:(e,t,r)=>{r.d(t,{c:()=>f,x:()=>y});var s=r(88802),a=r(17988),n=r(25313),i=r(60399),o=r(37182),c=r(87065),d=r(70493),l=r(69008),u=r(87279),p=r(21869),m=r(37920),h=r(428),g=r(94189),v=r(22838);class f extends Error{constructor(e,t){super("ApplicationRequestError"),this.exception=e,this.useCaseStacktrace=t}}let y=class{constructor(e,t,r,s,a){this.logger=e,this.useCaseStacktraceRepo=t,this.cqrsClient=r,this.requestContextClient=s,this.nodeModulesIntrospection=a}intercept(e,t){const r=e.getArgByIndex(0);return t.handle().pipe((0,o.K)(this.handleException(r)))}handleException(e){const{useCaseStacktraceRepo:t}=this;return r=>{if(t.isInitialUseCase()){const[s,a]=r instanceof f?[r.exception,r.useCaseStacktrace]:[r,t.read()];return this.captureException(e,s,a),(0,n._)((()=>s))}const s=r instanceof f?r:new f(r,t.read());return(0,n._)((()=>s))}}async getUserFeatureFlips(){if(!await(0,i.z)(this.requestContextClient.queries.activeUser().pipe((0,c.U)((e=>(0,u.d6)(e)&&!!(0,u.db)(e).userName)))))return Promise.resolve({});const{queries:{userFeatureFlips:e}}=this.cqrsClient.getClient(d.cV);return await(0,i.z)(e().pipe((0,c.U)((e=>(0,u.d6)(e)?(0,u.db)(e):{}))))}async captureException(e,t,r){const s=e.module,a=this.nodeModulesIntrospection.modules[s].domainName??"unknown";this.logger.captureException(t,{domainName:a,moduleName:s,useCaseName:e.name,useCaseId:e.context.get(p.l.UseCaseId),featureFlips:await this.getUserFeatureFlips(),useCaseStacktrace:r})}};y=(0,s.__decorate)([(0,a.Injectable)({scope:a.Scope.REQUEST}),(0,s.__metadata)("design:paramtypes",[m.v,h.F,g.w,l.Q,v.Q1])],y)},6903:(e,t,r)=>{r.d(t,{G:()=>I});var s=r(88802),a=r(1484),n=r(72742),i=r(99634),o=r(37920),c=r(10955),d=r(63364),l=r(43866),u=r(57924),p=r(68475),m=r(43004);let h=class{constructor(e){this.logger=e}handle(e){const{error:t,fileLocation:r,lineNumber:s,origin:a}=e,[n,i]=t instanceof p.c?[t.exception,t.useCaseStacktrace]:[t];return this.logger.captureException(n,{fileLocation:r,lineNumber:s,origin:a,useCaseStacktrace:i},m.w.CRITICAL)}};h=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[o.v])],h);let g=class{constructor(e,t,r,s){this.sink=e,this.lifeCycle=t,this.moduleRef=r,this.uncaughtErrorsSource=s}onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const{stop:e}=await this.sink.start(),t=this.uncaughtErrorsSource.events$.subscribe(this.onUncaughtErrorEvent.bind(this));return()=>{t.unsubscribe(),e()}}))}onUncaughtErrorEvent(e){this.moduleRef.get(h).handle(e)}};g=(0,s.__decorate)([(0,u.ar)(),(0,s.__metadata)("design:paramtypes",[d.qD,l.d,a.ModuleRef,d.fW])],g);var v=r(428),f=r(743),y=r(21242),b=r(87279),_=r(63663),S=r(60399),w=r(87065),E=r(89618),C=r(37182),T=r(69885);let F=class{constructor(e,t){this.logger=e,this.featureFlips=t}async execute({body:e}){const{exception:t}=e,r={featureFlips:await this.getUserFeatureFlips()};return this.logger.captureException(t,r),Promise.resolve((0,b.Vp)(void 0))}getUserFeatureFlips(){const{userFeatureFlips:e}=this.featureFlips.queries;return(0,S.z)(e().pipe((0,w.U)((e=>(0,b.d6)(e)?(0,b.db)(e):{})),(0,E.V)(50),(0,C.K)((()=>(0,T.of)({})))))}};var N;F=(0,s.__decorate)([(0,_.W)(f.b),(0,s.__metadata)("design:paramtypes",[o.v,y.P])],F);let I=N=class{static configure(e){return{module:N,configurations:{...c.I,sink:e.sink,...e.uncaughtErrorSource?{uncaughtErrorSource:e.uncaughtErrorSource}:{}}}}};I=N=(0,s.__decorate)([(0,i.Yl)({api:n.P,handlers:{commands:{sendExceptionLog:F},events:{},queries:{}},providers:[o.v,{provide:a.APP_INTERCEPTOR,useClass:p.x},v.F,h],configurations:{sink:{token:d.qD},uncaughtErrorSource:{token:d.fW}},exports:[o.v,v.F],onFrameworkInit:g,requiredFeatureFlips:[],domainName:"framework"})],I)},43004:(e,t,r)=>{var s;function a(e){return!(!e||"object"!=typeof e)&&("criticality"in e&&"timestamp"in e&&"message"in e&&"callStack"in e&&((e.criticality===s.CRITICAL||e.criticality===s.WARNING)&&"string"==typeof e.message&&"string"==typeof e.callStack))}r.d(t,{h:()=>a,w:()=>s}),function(e){e.WARNING="warning",e.CRITICAL="critical"}(s||(s={}))},428:(e,t,r)=>{r.d(t,{F:()=>o,U:()=>c});var s=r(88802),a=r(17988),n=r(21869);const i="USE_CASE_STACKTRACE";let o=class{constructor(e){this.requestContext=e}isInitialUseCase(){return(this.requestContext.get(i)??[]).length<=1}read(){return this.requestContext.getOrAddSync(i,(()=>[]))??[]}append(e){const{requestContext:t}=this,r=t.get(i)??[];t.set(i,[...r,e])}};o=(0,s.__decorate)([(0,a.Injectable)(),(0,s.__metadata)("design:paramtypes",[n.f])],o);const c=new o(new n.f)},7876:(e,t,r)=>{r.d(t,{c:()=>E});var s=r(88802),a=r(49329),n=r(99634),i=r(42339),o=r(87279),c=r(63663),d=r(25029),l=r(95681),u=r(23347);const p=e=>"object"==typeof e&&null!==e&&"swStartTime"in e&&"taskTrackingList"in e&&"string"==typeof e.swStartTime&&"object"==typeof e.taskTrackingList;class m extends((0,l.Q)({persist:!1,initialValue:{swStartTime:"",taskTrackingList:{}},scope:d.F.Device,storeName:"task-tracking",storeTypeGuard:p,capacity:u.Y._001KB})){}let h=class{constructor(e){this.store=e}async execute({body:e}){const t=(new Date).toISOString(),{taskName:r,feature:s,businessDomain:a}=e,n={taskName:r,feature:s,businessDomain:a,startTime:t,serviceWorkerInterruptionCount:0},i=await this.store.getState();return await this.store.set({...i,taskTrackingList:{...i.taskTrackingList,[t]:n}}),Promise.resolve((0,o.Vp)({id:t}))}};h=(0,s.__decorate)([(0,c.W)(i.g),(0,s.__metadata)("design:paramtypes",[m])],h);var g=r(86252),v=r(21877),f=r(43866),y=r(57924);let b=class{constructor(e,t,r){this.store=e,this.carbonLegacyClient=t,this.appLifecycle=r}onFrameworkInit(){this.appLifecycle.addAppReadyHook((async()=>{const e=await this.store.getState(),t={...e.taskTrackingList},r=Object.keys(e.taskTrackingList).map((async r=>{const{taskName:s,feature:a,businessDomain:n,startTime:i}=e.taskTrackingList[r],o=new v.UserMv3ExtensionTaskInterruptionEvent({businessDomain:n,feature:a,taskName:s,taskStartDateTime:i,serviceWorkerStartDateTime:e.swStartTime}),c=this.carbonLegacyClient;await c.commands.carbon({name:"logEvent",args:[{event:o}]}),delete t[r]}));await Promise.all(r),await this.store.set({swStartTime:(new Date).toISOString(),taskTrackingList:t})}))}};b=(0,s.__decorate)([(0,y.ar)(),(0,s.__metadata)("design:paramtypes",[m,g._,f.d])],b);var _=r(29876),S=r(26457);let w=class{constructor(e,t,r){this.store=e,this.carbonLegacyClient=t,this.logger=r}async execute({body:e}){const{taskTrackingId:t}=e,r=await this.store.getState(),s=r.taskTrackingList[t];if(!s)return this.logger.trace("Trying to track a task that does not exist"),(0,o.Vp)(void 0);const{taskName:a,feature:n,businessDomain:i,startTime:c,serviceWorkerInterruptionCount:d}=s,l=new v.UserMv3ExtensionTaskReportEvent({businessDomain:i,feature:n,serviceWorkerInterruptionCount:d,serviceWorkerStartDateTime:r.swStartTime,taskName:a,taskStartDateTime:c,taskEndDateTime:(new Date).toISOString()}),u=this.carbonLegacyClient;await u.commands.carbon({name:"logEvent",args:[{event:l}]});const p={...r.taskTrackingList};return delete p[t],await this.store.set({swStartTime:r.swStartTime,taskTrackingList:p}),(0,o.Vp)(void 0)}};w=(0,s.__decorate)([(0,c.W)(_.y),(0,s.__metadata)("design:paramtypes",[m,g._,S.V])],w);let E=class{};E=(0,s.__decorate)([(0,n.Yl)({api:a.e,handlers:{commands:{startTaskTracking:h,terminateTaskTracking:w},events:{},queries:{}},stores:[m],onFrameworkInit:b,providers:[],domainName:"framework"})],E)},58649:(e,t,r)=>{r.d(t,{N:()=>y});var s=r(6136),a=r(98187),n=r(15023),i=r(41842),o=r(16433),c=r(89618),d=r(37182),l=r(17350),u=r(97280),p=r(42946),m=r(162),h=r(2049),g=r(6220),v=r(7074),f=r(78776);class y{constructor(e,t=3e4){const r=e.status$.pipe((0,s.x)());let y=!1;const b=new a.x,_=b.pipe((0,g.z)((async s=>{const a=(0,f.Z)();let g=!1;const v=e.messages$.pipe((0,n.o)((()=>!y)),(0,i.h)((e=>"acknowledgement"===e.type&&e.id===a)),(0,o.q)(1),(0,c.V)(t),(0,d.K)((()=>l.E)),(0,u.d)(1)),b=v.subscribe((()=>{g=!0,b.unsubscribe()})),_=r.pipe((0,n.o)((()=>!g&&!y)),(0,p.z)((()=>(0,m.D)(e.sendMessage({type:"send",id:a,message:s.message}))))).subscribe();try{await(0,h.n)(v),_.unsubscribe(),s.resolve()}catch(e){_.unsubscribe(),s.reject(e)}}))).subscribe();this.stop=()=>(y=!0,_.unsubscribe(),e.stop()),this.send=e=>new Promise(((t,r)=>{const s={message:e,resolve:t,reject:r};b.next(s)})),this.channelState$=e.status$,this.receivedMessages$=e.messages$.pipe((0,i.h)((e=>"send"===e.type)),(0,g.z)((async t=>{if("send"===t.type)return await e.sendMessage({type:"acknowledgement",id:t.id}),t.message})),(0,v.B)())}}},65488:(e,t,r)=>{r.d(t,{U:()=>E});var s=r(24966),a=r(2049),n=r(41842),i=r(6220),o=r(162),c=r(87065),d=r(37182),l=r(69885),u=r(64659);const p=e=>{if(!e||"object"!=typeof e)return!1;return"unSubscription"===e.type},m=(e,t,r)=>{const s=new Set(r),a=new Map,m=t.receivedMessages$.pipe((0,n.h)(p)).subscribe((e=>{const t=a.get(e.id);t?.unsubscribe(),a.delete(e.id)})),h=t.receivedMessages$.pipe((0,n.h)((e=>{return!(!(t=e)||"object"!=typeof t)&&"start"===t.type&&s.has(e.definition.destination)&&!a.has(e.definition.id);var t})),(0,i.z)((e=>(0,o.D)((async e=>(a.set(e.definition.id,{unsubscribe:()=>{}}),await t.send({type:"initial-acknowledgement",id:e.definition.id}),e))(e))))).subscribe((r=>{const s=r.definition.destination,n=e(s,r.definition.content,r.metadata),p={type:"end",id:r.definition.id},m=n.pipe((0,c.U)((e=>({id:r.definition.id,data:e,type:"data"}))),(0,d.K)((e=>{const t={id:r.definition.id,type:"error",errorMessage:e.message};return(0,l.of)(t)})),(0,u.l)(p),(0,i.z)((e=>(0,o.D)(t.send(e))))).subscribe();a.set(r.definition.id,{unsubscribe:()=>{m.unsubscribe()}})}));return{unsubscribe:()=>{h.unsubscribe(),m.unsubscribe();for(const e of a.values())e.unsubscribe()}}};var h=r(58376),g=r(85390),v=r(15023),f=r(6136),y=r(42946),b=r(60399),_=r(15572),S=r(78776);var w=r(28489);class E{constructor(e){this.stopped$=new s.X(!1);const t={routes:(0,w.Ay)({})};this.routes=(()=>{const{routes:r}=Object.keys(e).reduce(((t,r)=>{const s=e[r];if("local"===s.type&&(t.routes[r]={send:s.onMessage,trySend:async(...e)=>(await(0,a.n)(s.onMessage(...e)),!0)}),"remote"===s.type){const e=((e,t)=>{const r=(r,s,a)=>{const i={content:s,destination:String(r),id:(0,S.Z)()};return new h.y((r=>{let s={type:"start",definition:i,metadata:a};const d=(0,g.a)({message:e.receivedMessages$,stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,c.U)((({message:e})=>e))).subscribe((e=>{var t;(t=e)&&"object"==typeof t&&"initial-acknowledgement"===t.type&&e.id===i.id?s={...s,metadata:{...s.metadata,isReminder:!0}}:(e=>!(!e||"object"!=typeof e)&&"data"===e.type)(e)&&e.id===i.id?r.next(e.data):(e=>!(!e||"object"!=typeof e)&&"error"===e.type)(e)&&e.id===i.id?r.error(new Error(e.errorMessage)):(e=>!(!e||"object"!=typeof e)&&"end"===e.type)(e)&&e.id===i.id&&r.complete()})),l=(0,g.a)({sendTimes:e.channelState$.pipe((0,f.x)(),(0,n.h)((e=>e===_.D.Connected))),stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,y.z)((()=>(0,o.D)(e.send(s))))).subscribe();return()=>{e.send({type:"unSubscription",id:i.id}),l.unsubscribe(),d.unsubscribe()}}))};return{send:r,trySend:async(t,s,n)=>await(0,b.z)(e.channelState$)===_.D.Connected&&(await(0,a.n)(r(t,s,n)),!0)}})(s.channel,this.stopped$);t.routes[r]=e}return t}),t);return r})()}connect(e,t){let r=!1;return{start:()=>{if(r)throw new Error("Already started");r=!0;const s=e=>m(((e,t,r)=>this.routes[e].send(e,t,r)),e,Object.keys(this.routes)),a=e.map(s),n=new Map,i=t.connectedChannels$.subscribe((e=>{const t=[...n.entries()].filter((([t])=>!(t in e))),r=Object.keys(e).filter((e=>!n.has(e)));t.forEach((([e,t])=>{n.delete(e),t.unsubscribe()})),r.forEach((t=>{const r=e[t],a=s(r);n.set(t,a)}))}));return Promise.resolve({stop:()=>([...a,i,...n.values()].forEach((e=>e.unsubscribe())),this.stopped$.next(!0),Promise.resolve())})}}}ensureMessageSerializable(e,t){0}sendMessage(e,t){return this.ensureMessageSerializable(e,t),this.routes[e].send(e,t,{isReminder:!1})}trySendMessage(e,t){return this.ensureMessageSerializable(e,t),this.routes[e].trySend(e,t,{isReminder:!1})}}},15572:(e,t,r)=>{r.d(t,{D:()=>s,q:()=>i});var s,a=r(98187),n=r(24966);!function(e){e.Connected="Connected",e.Disconnected="Disconnected"}(s||(s={}));class i{constructor(){this.sentMessages$=new a.x,this.receivedMessagesSubject$=new a.x,this.channelStateSubject$=new n.X(s.Disconnected)}send(e){if(this.channelStateSubject$.value!==s.Connected)throw new Error("Channel is not connected");return this.sentMessages$.next(e),Promise.resolve()}get receivedMessages$(){return this.receivedMessagesSubject$}get channelState$(){return this.channelStateSubject$}stop(){this.receivedMessages$.complete()}connect(e){if(this.channelStateSubject$.value===s.Connected)return{disconnect:()=>{}};const t=this.sentMessages$.subscribe((t=>{e.receivedMessages$.next(t)}));return this.channelState$.next(s.Connected),{disconnect:()=>{this.channelState$.next(s.Disconnected),t.unsubscribe()}}}}},54452:(e,t,r)=>{r.d(t,{v:()=>n,y:()=>a});var s=r(24966);const a={connectedChannels$:new s.X({})},n=e=>({connectedChannels$:new s.X({channel:e})})},45244:(e,t,r)=>{r.d(t,{F:()=>a,k:()=>s});const s=({channelName:e,message:t})=>({channelName:e,message:t,type:"graphene-message"}),a=e=>{if(!e||"object"!=typeof e)return!1;return"graphene-message"===e.type}},16855:(e,t,r)=>{r.d(t,{$:()=>s});class s{constructor(e){this.appDefinition=e.appDefinition,this.currentNode=e.currentNode,this.channels=e.channels,this.subscriptions=e.subscriptions,this.channelsListener=e.channelsListener}getNodeList(){return this.currentNode?[...this.getRemoteNodeList(),this.currentNode]:this.getRemoteNodeList()}getRemoteNodeList(){return Object.keys(this.channels)}getModuleNames(){return Object.keys(this.appDefinition)}}},25123:(e,t,r)=>{r.d(t,{I:()=>u});var s=r(88802),a=r(97280),n=r(83896),i=r(16433),o=r(17988),c=r(21904),d=r(95237);const l=2e4;let u=class{constructor(e,t){this.timers=e,this.mv3ServiceWorkerExtender=t,this.id="MV3ExtensionHttpInterceptor"}intercept(e,t){if(e.timeout<3e4)return t(e);const r=t(e).pipe((0,a.d)(1));return this.timers.createObservableTimer(l,l).pipe((0,n.R)(r),(0,i.q)(Math.trunc(e.timeout/l))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),r}};u=(0,s.__decorate)([(0,o.Injectable)(),(0,s.__metadata)("design:paramtypes",[c.O,d.g])],u)},54193:(e,t,r)=>{r.d(t,{f:()=>u});var s,a=r(88802),n=r(25504),i=r(99634),o=r(25123),c=r(95237),d=r(56656),l=r(84065);let u=s=class{static configure(e){return n.X.addGlobalInterceptor(o.I),l.b.addGlobalNestInterceptor(d.V),{module:s,configurations:{mv3SwExtend:e}}}};u=s=(0,a.__decorate)([(0,i.Yl)({sharedModuleName:"mv3ExtensionResilience",configurations:{mv3SwExtend:{token:c.g}},providers:[o.I,d.V],exports:[o.I,d.V],domainName:"framework"})],u)},56656:(e,t,r)=>{r.d(t,{V:()=>p});var s=r(88802),a=r(97280),n=r(83896),i=r(16433),o=r(17988),c=r(21904),d=r(95237),l=r(10514);const u=2e4;let p=class{constructor(e,t){this.timers=e,this.mv3ServiceWorkerExtender=t}intercept(e,t){const r=e.switchToHttp().getRequest();if(r.type===l.Y.Command||r.type===l.Y.Cron||r.type===l.Y.Event){const e=t.handle().pipe((0,a.d)(1));return this.timers.createObservableTimer(u,u).pipe((0,n.R)(e),(0,i.q)(Math.trunc(45))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),e}return t.handle()}};p=(0,s.__decorate)([(0,o.Injectable)(),(0,s.__metadata)("design:paramtypes",[c.O,d.g])],p)},95237:(e,t,r)=>{r.d(t,{g:()=>s});class s{}},21869:(e,t,r)=>{r.d(t,{f:()=>a,l:()=>s});const s={UseCaseId:"USE_CASE_ID",UserName:"USER_NAME"};class a{constructor(){this.entries={}}get(e){return this.entries[e]}getOrDefault(e,t){return this.entries[e]??t}getOrFail(e,t){if(!this.has(e)){throw new Error(t?.errorMessage??`No ${e} in request context`)}return this.entries[e]}has(e){return e in this.entries}async getOrAdd(e,t){return this.has(e)||this.set(e,await t()),this.get(e)}getOrAddSync(e,t){return this.has(e)||this.set(e,t()),this.get(e)}set(e,t){this.entries[e]=t}toSerializable(){return this.entries}static fromSerializable(e){const t=new a;for(const[r,s]of Object.entries(e))t.entries[r]=s;return t}clone(){return a.fromSerializable(JSON.parse(JSON.stringify(this.toSerializable())))}withValue(e,t){return this.set(e,t),this}}},75994:(e,t,r)=>{r.d(t,{X:()=>s});class s{}},67978:(e,t,r)=>{r.d(t,{K:()=>c});var s=r(88802),a=r(162),n=r(25859),i=r(57924),o=r(75994);let c=class{constructor(e,t){this.url=e,this.fetcher=t,this.value$=(0,a.D)((0,n.P)((()=>this.get())))}async load(){await this.get()}async get(){const{value:e}=this;if(e)return e;const t=await this.fetcher.fetch(this.url),r=await this.loadResource(t);return this.value=r,r}};c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[String,o.X])],c)},23370:(e,t,r)=>{r.d(t,{q:()=>S});var s=r(88802),a=r(87279),n=r(8987),i=r(87065),o=r(6136),c=r(25029),d=r(95681),l=r(23347);const u=e=>!(!e||"object"!=typeof e)&&"userName"in e;class p extends((0,d.Q)({initialValue:{userName:void 0},persist:!1,scope:c.F.Device,storeName:"active-user-store",storeTypeGuard:u,capacity:l.Y._001KB})){}var m=r(20754),h=r(63663),g=r(81459),v=r(57924);let f=class extends g.f{};f=(0,s.__decorate)([(0,v.GS)()],f);let y=class{constructor(e){this.activeUserStore=e}execute(){return this.activeUserStore.state$.pipe((0,i.U)((e=>e.userName)),(0,o.x)(),(0,i.U)((e=>(0,a.Vp)({userName:e}))))}};y=(0,s.__decorate)([(0,m.e)(n.p),(0,s.__metadata)("design:paramtypes",[p])],y);let b=class{constructor(e,t){this.activeUserStore=e,this.eventEmitter=t}async execute({body:{userName:e}}){return(await this.activeUserStore.getState()).userName===e||(await this.activeUserStore.set({userName:e}),e&&this.eventEmitter.sendEvent("activeUserSet",{userName:e})),(0,a.Vp)(void 0)}};b=(0,s.__decorate)([(0,h.W)(n.r$),(0,s.__metadata)("design:paramtypes",[p,f])],b);var _=r(99634);let S=class{};S=(0,s.__decorate)([(0,_.Yl)({api:n.t$,handlers:{commands:{setActiveUser:b},events:{},queries:{activeUser:y}},stores:[p],providers:[f],domainName:"framework"})],S)},73018:(e,t,r)=>{r.d(t,{IO:()=>c,Mn:()=>o,kl:()=>l,mZ:()=>d});var s=r(90171),a=r(21904),n=r(26457),i=r(75994);class o extends n.V{log(){}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class c extends n.V{log(e,...t){return console.log(e,t)}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class d extends a.O{get time(){return Date.now()}createObservableTimer(e,t){return(0,s.H)(e,t)}}class l extends i.X{fetch(){return Promise.reject(new Error("Please add a jsonFetcher to the application. Probably you are seing that in unit tests.\nIf this is the case, please mock whatever service is requiring to fetch the data"))}}},38144:(e,t,r)=>{r.d(t,{h:()=>n,s:()=>i});var s=r(88802),a=r(17988);let n=class{};n=(0,s.__decorate)([(0,a.Injectable)()],n);let i=class{};i=(0,s.__decorate)([(0,a.Injectable)()],i)},4603:(e,t,r)=>{r.d(t,{u:()=>a});class s{constructor(e,t,r){this.storage=e,this.baseKey=t,this.initialValueFactory=r}clear(){return this.storage.remove(this.baseKey)}async read(){const e=await this.storage.get(this.baseKey);return!e&&this.initialValueFactory?await this.initialValueFactory():e}async write(e){await this.storage.set(this.baseKey,e)}}class a{constructor(e){this.storage=e}createBackend(e,t,r,a){const n=r?`${e}.${t}.${r}`:`${e}.${t}`;return new s(this.storage,n,a)}}},15524:(e,t,r)=>{r.d(t,{s:()=>s});class s{constructor(){this.memory=new Map}set(e,t){return this.memory.set(e,t),Promise.resolve()}getAllKeys(){return Promise.resolve([...this.memory.keys()])}remove(e){return this.memory.get(e)?(this.memory.delete(e),Promise.resolve()):Promise.resolve()}get(e){return Promise.resolve(this.memory.get(e))}}},91199:(e,t,r)=>{function s(e){return null!==e&&"object"==typeof e&&"version"in e&&"number"==typeof e.version&&"content"in e}r.d(t,{Ot:()=>s,QI:()=>n,hL:()=>a});const a={read:()=>Promise.resolve(void 0),write:()=>Promise.resolve(),clear:()=>Promise.resolve()};class n{}},95681:(e,t,r)=>{r.d(t,{Q:()=>p});var s=r(57924),a=r(49499),n=r(10722),i=r(91199);class o{constructor(e,t,r,s,i){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=s,this.definition=i,this.codec=(0,a.x)(r,e,t);const o=new n.E;this.bypassedDecryptionDecoder=(0,a.x)(r,o,t)}async read(){const e=await this.backend.read();if(!e)return;const{decoded:t,hasBypassedDecryption:r}=await this.decodeData(e),{definition:s}=this,{storageName:a}=s;if(!(0,i.Ot)(t))throw new Error(`Unable to read storage data that isn't versioned (storage name: ${a}, data shape: ${this.printDataShapeInfo(t)})`);const{content:n}=t,o=t.version,c=s.schemaVersion;if(o<c){if(!s.migrateStorageSchema)throw r&&await this.rawWrite(t),new Error(`Missing storage schema migration function prevents from reading old version data (storage name: ${a})`);const e=s.migrateStorageSchema(t);if(!s.typeGuard(e))throw new Error(`Unable to migrate storage data due to typeguard failure (storage name: ${a}, data shape: ${this.printDataShapeInfo(e)})`);return await this.writeWithVersion(e),e}if(o>c)throw new Error(`Unable to read storage data with a more recent version than current schema (storage name: ${a})`);if(!s.typeGuard(n))throw new Error(`Unable to read storage data due to typeguard failure (storage name: ${a}, data shape: ${this.printDataShapeInfo(n)})`);return r&&await this.writeWithVersion(n),n}write(e){if(!this.definition.typeGuard(e)){const{storageName:t}=this.definition;throw new Error(`Failed to write storage data due to typeguard failure (storage name: ${t}, data shape: ${this.printDataShapeInfo(e)})`)}return this.writeWithVersion(e)}clear(){return this.backend.clear()}async writeWithVersion(e){const t={version:this.definition.schemaVersion,content:e};await this.rawWrite(t)}async rawWrite(e){const t=await this.codec.encode(e);await this.backend.write(t)}async decodeData(e){const{codec:t,bypassedDecryptionDecoder:r}=this;try{return{decoded:await t.decode(e),hasBypassedDecryption:!1}}catch(t){try{return{decoded:await r.decode(e),hasBypassedDecryption:!0}}catch{throw t}}}printDataShapeInfo(e){if(e&&"object"==typeof e){const t=e,r=Object.keys(t).reduce(((e,r)=>(e[r]=typeof t[r],e)),{});return JSON.stringify(r).substring(0,40)}return void 0===e?"undefined":null===e?"null":typeof e}}const c=e=>{var t;return(t=class extends o{constructor(t,r,s,a){super(t,r,s,a,e)}}).Definition=e,t};var d=r(23347),l=r(76072);const u=e=>e.persist?{persist:!0,codec:e.codec,scope:e.scope,storeName:e.storeName,storeTypeGuard:e.storeTypeGuard,isCache:e.isCache,storage:c({...e.storage,storageName:e.storeName}),capacity:(0,d.C)(e)?e.capacity:void 0}:{persist:!1,initialValue:e.initialValue,scope:e.scope,storeName:e.storeName,capacity:(0,d.C)(e)?e.capacity:void 0};function p(e){var t;const r=u(e),a=((t=class extends l.y{constructor(e,t,r,s,a,n,i){super(e,t,r,s,a,n,i)}}).Definition=r,t);return(0,s.GS)()(a),a}},23347:(e,t,r)=>{var s;function a(e){return"object"==typeof e&&null!==e&&"capacity"in e}r.d(t,{C:()=>a,Y:()=>s}),function(e){e._001KB="1KB",e._010KB="10KB",e._100KB="100KB",e._001MB="1MB",e.Unlimited="Unlimited"}(s||(s={}))},71949:(e,t,r)=>{r.d(t,{X:()=>o});var s=r(88802),a=r(17988),n=r(1484),i=r(56860);let o=class{constructor(e,t,r){this.moduleRef=e,this.request=t,this.storeList=r}async prepare(){const e=n.ContextIdFactory.getByRequest(this.request);this.storeList.instances=await Promise.all(this.storeList.classes.map((t=>this.moduleRef.resolve(t,e,{strict:!1}))))}async flush(){const{instances:e}=this.storeList;if(!e.length)throw new Error("Stores not instantiated");const t=e.map((e=>e.persist()));await Promise.all(t)}};o=(0,s.__decorate)([(0,a.Injectable)(),(0,s.__param)(1,(0,a.Inject)(n.REQUEST)),(0,s.__metadata)("design:paramtypes",[n.ModuleRef,Object,i.D])],o)},83081:(e,t,r)=>{r.d(t,{N:()=>i,G:()=>n});var s=r(24966);class a{constructor(e){this.initValue=e,this.getLimit=()=>Promise.resolve(void 0),this.state$=new s.X(e)}set(e){return this.state$.next(e),Promise.resolve()}init(e){return this.state$.next(e),Promise.resolve()}stop(){this.state$.complete()}getState(){return Promise.resolve(this.state$.value)}clear(){return this.state$.next(this.initValue),Promise.resolve()}clearStorage(){return Promise.resolve()}update(e){return this.set(e(this.state$.value)),Promise.resolve()}persist(){return Promise.resolve()}load(){return Promise.resolve()}}class n{}class i extends n{createUserScopedInfrastructure(){return new a({timestamp:void 0})}createDeviceScopedInfrastructure(){return new a({timestamp:void 0})}}},56860:(e,t,r)=>{r.d(t,{D:()=>s});class s{constructor(){this.registeredClasses=[],this.preparedInstances=[]}get classes(){return this.registeredClasses}get instances(){return this.preparedInstances}set instances(e){this.preparedInstances=e}registerClass(e){this.registeredClasses.push(e)}}},5711:(e,t,r)=>{r.d(t,{N:()=>_});var s=r(1484),a=r(78776),n=r(25029),i=r(43866),o=r(63411),c=r(83081),d=r(93417),l=r(43702),u=r(23711),p=r(38144),m=r(4603),h=r(21869),g=r(26457);const v={[n.F.Device]:p.h,[n.F.User]:p.s};var f=r(9671),y=r(97631);function b(e){const t=e.Definition.persist?function(e,t,r){const{EncryptionCodec:s=v[t],SerializationCodec:i=l.b,TransportStorageCodec:c=u.z,initialValue:p,schemaVersion:f}=r.Definition;class y{constructor(e,t,r,s){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=s}}class b extends r{constructor(e){super(e.encryptionCodec,e.serializationCodec,e.transportStorageCodec,e.backend)}}const _={token:(0,a.Z)(),inject:[y],asyncFactory:e=>Promise.resolve(new b(e))};return[{token:y,inject:[d.r,s,i,c,m.u,g.V,...t===n.F.User?[h.f]:[]],asyncFactory:async(r,s,a,i,o,c,d)=>{const l=await o.createBackend(r,e,(t===n.F.User?d?.get(h.l.UserName):"")??"",(async()=>{const e={version:f,content:p},t=await a.encode(e),r=await s.encode(t);return await i.encode(r)}));return new y(s,a,i,l)}},...(0,o.B)(t,r,_)]}(e.Definition.storeName,e.Definition.scope,e.Definition.storage):[],r={token:(0,a.Z)(),inject:[d.r,i.d,c.G,e.Definition.scope===n.F.User?h.f:s.REQUEST,f.J,y.g,...e.Definition.persist?[e.Definition.storage,e.Definition.codec]:[]],asyncFactory:async(t,r,s,a,i,o,c,d)=>{const l=new e(t,e.Definition,s,(e.Definition.scope===n.F.User?a.get(h.l.UserName):"")??"",i,c,d),u=async()=>{await l.clear(),l.stop()};if(e.Definition.scope===n.F.User){if(!o)throw new Error("No user scope available");o.addCloseHook(u)}else r.addShutdownHook(u);return await l.load(),l}};return[...t,...(0,o.B)(e.Definition.scope,e,r)]}function _(...e){return e.flatMap((e=>b(e)))}},76072:(e,t,r)=>{r.d(t,{y:()=>p});var s=r(24966),a=r(85390),n=r(87065),i=r(6136),o=r(41842),c=r(60399),d=r(25029),l=r(23347);class u{constructor(e,t,r,s){switch(this.conf=t,this.set=async e=>{if(!await this.quickMemoryInfrastructure.getLimit()||this.conf.capacity!==l.Y.Unlimited||!this.conf.persist)return this.quickMemoryInfrastructure.set(e)},this.getState=()=>this.quickMemoryInfrastructure.getState(),this.init=e=>this.quickMemoryInfrastructure.init(e),this.update=async e=>this.set(e(await this.getState())),this.clearStorage=()=>this.quickMemoryInfrastructure.clearStorage(),this.clear=()=>this.quickMemoryInfrastructure.clear(),this.persist=()=>this.quickMemoryInfrastructure.persist(),this.load=()=>this.quickMemoryInfrastructure.load(),this.stop=()=>this.quickMemoryInfrastructure.stop(),this.getLimit=()=>Promise.reject(new Error("not implemented")),t.scope){case d.F.Device:this.quickMemoryInfrastructure=r.createDeviceScopedInfrastructure(e,t.storeName,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}`;break;case d.F.User:if(!s)throw new Error("Attempting to create a user-scoped store without a user");this.quickMemoryInfrastructure=r.createUserScopedInfrastructure(e,t.storeName,s,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}.${s}`}this.state$=this.quickMemoryInfrastructure.state$}}class p{constructor(e,t,r,c,d,l,p){this.conf=t,this.allowedToFail=d,this.storage=l,this.codec=p,this.getLimit=()=>Promise.reject(new Error("not implemented")),this.infrastructure=new u(e,t,r,c),this.timeGetter=()=>Date.now(),this.localState$=new s.X({timestamp:void 0}),this.mergedState$=(0,a.a)({infra:this.infrastructure.state$,current:this.localState$}).pipe((0,n.U)((({current:e,infra:t})=>t.timestamp&&(!e.timestamp||t.timestamp>e.timestamp)?t:e)),(0,i.x)());const m=t.persist?void 0:t.initialValue;this.state$=this.mergedState$.pipe((0,o.h)((e=>!t.persist||!!e.timestamp)),(0,n.U)((e=>e.data??m)))}getState(){return(0,c.z)(this.state$)}async set(e){try{await this.setWithoutPersist(e)}finally{await this.persist()}}async setWithoutPersist(e){const t={data:e,timestamp:this.timeGetter()};let r;this.localState$.next(t);if(!await this.allowedToFail.doOne((()=>this.infrastructure.set(t).catch((e=>{throw r=new Error(`${this.conf.storeName}: ${e.message}`),r})))))return this.conf.persist?this.infrastructure.clear():Promise.reject(r)}init(e){const t={data:e,timestamp:0};return this.localState$.next(t),Promise.resolve()}async clear(){this.localState$.next({timestamp:void 0}),await this.infrastructure.clear()}async clearStorage(){if(!this.storage)throw new Error("Persisted stores should have storage");await this.storage.clear()}stop(){this.localState$.complete()}async update(e){const t=await this.getState();await this.set(e(t))}async load(){const e=await this.infrastructure.getState();if(e.timestamp)return void this.localState$.next(e);const{conf:t,codec:r,storage:s}=this;if(!t.persist)return;if(!r||!s)throw new Error("Persisted stores should have conf/storage");await this.allowedToFail.conditionallyAllowToFailOne((async()=>{const e=await s.read()??t.storage.Definition.initialValue,a=await r.decode(e);await this.setWithoutPersist(a)}),!!t.isCache)||await this.setWithoutPersist(await r.decode(t.storage.Definition.initialValue))}async persist(){const{conf:e,codec:t,storage:r}=this;if(!e.persist)return;if(!t||!r)throw new Error("Persisted stores should have conf/storage");const s=await this.getState(),a=await t.encode(s);await r.write(a)}}},69594:(e,t,r)=>{r.d(t,{R_:()=>a,_C:()=>n,ql:()=>s});class s{run(){return Promise.resolve()}isRunnable(){return!1}}class a{}class n extends a{constructor(e){super(),this.alarm$=e.createObservableTimer(6e4,6e4)}}},33920:(e,t,r)=>{r.d(t,{F:()=>a,p:()=>s});const s={Open:"open",Closed:"closed"};class a{constructor(e){this.lifecycle=e,this.status=s.Open,this.onAppShutdown=()=>this.close(),this.closeHooks=[],e.addShutdownHook(this.onAppShutdown)}async close(){for(;this.closeHooks.length>0;){const e=this.closeHooks.pop();e&&await e()}this.status=s.Closed,this.lifecycle.removeShutdownHook(this.onAppShutdown)}addCloseHook(e){this.closeHooks.push(e)}}},97631:(e,t,r)=>{r.d(t,{g:()=>p});var s=r(88802),a=r(78263),n=r(41842),i=r(16433),o=r(17988),c=r(87279),d=r(69008),l=r(33920),u=r(43866);let p=class extends l.F{constructor(e,t,r){super(t),r.queries.activeUser().pipe((0,a.G)(),(0,n.h)(this.thisUserGotDeactivated(e)),(0,i.q)(1)).subscribe((()=>{this.close()}))}thisUserGotDeactivated(e){return([t,r])=>{if(!(0,c.d6)(t)||!(0,c.d6)(r))return!1;const s=(0,c.db)(t).userName,a=(0,c.db)(r).userName;return s===e&&void 0===a}}};p=(0,s.__decorate)([(0,o.Injectable)(),(0,s.__metadata)("design:paramtypes",[String,u.d,d.Q])],p)},89067:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticsClient=void 0;const s=r(23767),a=r(37204);class n extends((0,s.defineModuleClient)(a.analyticsApi)){}t.AnalyticsClient=n,(0,s.registerModuleClient)(a.analyticsApi,n)},37204:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.analyticsApi=t.TrackPageViewCommand=t.TrackEventCommand=void 0;const s=r(85888),a=r(70986);class n extends((0,a.defineCommand)({scope:a.UseCaseScope.Device})){}t.TrackEventCommand=n;class i extends((0,a.defineCommand)({scope:a.UseCaseScope.Device})){}t.TrackPageViewCommand=i,t.analyticsApi=(0,s.defineModuleApi)({commands:{TrackEventCommand:n,TrackPageViewCommand:i},events:{},name:"analytics",queries:{}})},7022:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},52389:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(37204),t),a(r(7022),t),a(r(89067),t)},67202:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},54072:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandMessage=void 0;const s=r(98653);class a extends s.RequestMessage{constructor(e){super(),this.body=e}}t.CommandMessage=a},98653:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UseCaseScope=t.RequestMessage=void 0;t.RequestMessage=class{},function(e){e.User="user",e.Device="device"}(t.UseCaseScope||(t.UseCaseScope={}))},85088:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_QUERY_RESULT=t.PAGINATION_START_PAGE_INDEX=t.FilterOperationName=void 0,function(e){e.Equals="equals",e.Differs="differs",e.Matches="matches",e.In="in",e.Contains="contains"}(t.FilterOperationName||(t.FilterOperationName={})),t.PAGINATION_START_PAGE_INDEX=1,t.EMPTY_QUERY_RESULT={items:[],itemCount:0,page:t.PAGINATION_START_PAGE_INDEX,pageCount:1}},77939:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineCarbonCommand=t.defineCommand=void 0;const s=r(54072),a=r(98653);t.defineCommand=(...[e={scope:a.UseCaseScope.User}])=>{var t;return(t=class extends s.CommandMessage{}).metadata=e,t};t.defineCarbonCommand=(e={scope:a.UseCaseScope.User})=>{var t;return(t=class extends s.CommandMessage{}).metadata=e,t}},1941:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineQuery=void 0;const s=r(70522),a=r(98653);t.defineQuery=(e={scope:a.UseCaseScope.User})=>{var t;return(t=class extends s.QueryMessage{}).metadata=e,t}},70986:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineQuery=t.defineCarbonCommand=t.defineCommand=t.UseCaseScope=t.FilterOperationName=t.EMPTY_QUERY_RESULT=t.QueryMessage=t.CommandMessage=void 0;var s=r(54072);Object.defineProperty(t,"CommandMessage",{enumerable:!0,get:function(){return s.CommandMessage}});var a=r(70522);Object.defineProperty(t,"QueryMessage",{enumerable:!0,get:function(){return a.QueryMessage}});var n=r(85088);Object.defineProperty(t,"EMPTY_QUERY_RESULT",{enumerable:!0,get:function(){return n.EMPTY_QUERY_RESULT}}),Object.defineProperty(t,"FilterOperationName",{enumerable:!0,get:function(){return n.FilterOperationName}});var i=r(98653);Object.defineProperty(t,"UseCaseScope",{enumerable:!0,get:function(){return i.UseCaseScope}});var o=r(77939);Object.defineProperty(t,"defineCommand",{enumerable:!0,get:function(){return o.defineCommand}}),Object.defineProperty(t,"defineCarbonCommand",{enumerable:!0,get:function(){return o.defineCarbonCommand}});var c=r(1941);Object.defineProperty(t,"defineQuery",{enumerable:!0,get:function(){return c.defineQuery}})},70522:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QueryMessage=void 0;const s=r(98653);class a extends s.RequestMessage{constructor(e){super(),this.body=e}}t.QueryMessage=a},49631:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventMessage=t.defineEvent=void 0;var s=r(84776);Object.defineProperty(t,"defineEvent",{enumerable:!0,get:function(){return s.defineEvent}}),Object.defineProperty(t,"EventMessage",{enumerable:!0,get:function(){return s.EventMessage}})},84776:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineEvent=t.EventMessage=void 0;const s=r(98653);class a{constructor(e){this.body=e}}t.EventMessage=a;t.defineEvent=(e={scope:s.UseCaseScope.User})=>{var t;return(t=class extends a{}).metadata=e,t}},22936:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.iconsApi=void 0;const s=r(85888),a=r(14532),n=r(8300);t.iconsApi=(0,s.defineModuleApi)({name:"icons",commands:{fetchIconForDomain:n.FetchIconForDomainCommand},events:{},queries:{getIconForDomain:a.GetIconForDomainQuery}})},8300:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FetchIconForDomainCommand=void 0;const s=r(70986);class a extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.FetchIconForDomainCommand=a},13959:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(22936),t),a(r(8300),t),a(r(14532),t),a(r(74428),t)},14532:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetIconForDomainQuery=t.createGetIconForDomainQueryNotFoundError=t.GetIconForDomainQueryErrorTypes=void 0;const s=r(45051),a=r(70986);var n;!function(e){e.NotFound="notFound"}(n=t.GetIconForDomainQueryErrorTypes||(t.GetIconForDomainQueryErrorTypes={})),t.createGetIconForDomainQueryNotFoundError=(0,s.defineFunctionalError)(n.NotFound,"Icon not found");class i extends((0,a.defineQuery)({scope:a.UseCaseScope.User})){}t.GetIconForDomainQuery=i},74428:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},90693:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(52389),t),a(r(70986),t),a(r(35079),t),a(r(85888),t),a(r(49631),t),a(r(67202),t),a(r(22396),t),a(r(28601),t),a(r(13959),t)},10844:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exceptionLoggingApi=void 0;const s=r(85888),a=r(32345);t.exceptionLoggingApi=(0,s.defineModuleApi)({name:"exceptionLogging",commands:{sendExceptionLog:a.SendExceptionLogCommand},events:{},queries:{}})},57066:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(32345),t)},32345:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SendExceptionLogCommand=void 0;const s=r(70986);class a extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.SendExceptionLogCommand=a},85201:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.exceptionLoggingApi=void 0;var n=r(10844);Object.defineProperty(t,"exceptionLoggingApi",{enumerable:!0,get:function(){return n.exceptionLoggingApi}}),a(r(57066),t)},35079:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(36518),t),a(r(85201),t)},82397:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.taskTrackingApi=void 0;const s=r(85888),a=r(96609),n=r(7797);t.taskTrackingApi=(0,s.defineModuleApi)({name:"taskTracking",commands:{startTaskTracking:a.StartTaskTrackingCommand,terminateTaskTracking:n.TerminateTaskTrackingCommand},events:{},queries:{}})},39948:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(96609),t),a(r(7797),t)},96609:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartTaskTrackingCommand=void 0;const s=r(70986);class a extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.StartTaskTrackingCommand=a},7797:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TerminateTaskTrackingCommand=void 0;const s=r(70986);class a extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.TerminateTaskTrackingCommand=a},36518:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.taskTrackingApi=void 0;var n=r(82397);Object.defineProperty(t,"taskTrackingApi",{enumerable:!0,get:function(){return n.taskTrackingApi}}),a(r(39948),t)},17286:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},24164:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.featureFlipsApi=t.ToggleLabCommand=t.RefreshAvailableLabsCommand=t.UserFeatureFlipQuery=t.UserAvailableLabsQuery=t.UserFeatureFlipsQuery=void 0;const s=r(70986),a=r(8369);class n extends((0,s.defineQuery)({scope:s.UseCaseScope.User})){}t.UserFeatureFlipsQuery=n;class i extends((0,s.defineQuery)({scope:s.UseCaseScope.User})){}t.UserAvailableLabsQuery=i;class o extends((0,s.defineQuery)({scope:s.UseCaseScope.User})){}t.UserFeatureFlipQuery=o;class c extends((0,s.defineCommand)({scope:s.UseCaseScope.User})){}t.RefreshAvailableLabsCommand=c;class d extends((0,s.defineCommand)({scope:s.UseCaseScope.User})){}t.ToggleLabCommand=d,t.featureFlipsApi=(0,a.defineModuleApi)({events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:n,UserFeatureFlipQuery:o,UserAvailableLabsQuery:i},commands:{RefreshAvailableLabsCommand:c,ToggleLabCommand:d}})},71057:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureFlipsClient=void 0;const s=r(23767),a=r(24164);class n extends((0,s.defineModuleClient)(a.featureFlipsApi)){}t.FeatureFlipsClient=n,(0,s.registerModuleClient)(a.featureFlipsApi,n)},56534:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fileDownloadApi=void 0;const s=r(8369);t.fileDownloadApi=(0,s.defineModuleApi)({events:{},name:"file-download",queries:{},commands:{}})},68791:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileDownloadClient=void 0;const s=r(23767),a=r(56534);class n extends((0,s.defineModuleClient)(a.fileDownloadApi)){}t.FileDownloadClient=n,(0,s.registerModuleClient)(a.fileDownloadApi,n)},85888:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(8369),t),a(r(21697),t),a(r(17286),t),a(r(6964),t),a(r(23767),t),a(r(24164),t),a(r(71057),t),a(r(56534),t),a(r(68791),t),a(r(27646),t)},23767:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.registerModuleClient=t.defineModuleClient=void 0,t.defineModuleClient=function(e){var t;return(t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}}).api=e,t},t.registerModuleClient=function(e,t){e.ClientClass=t}},8369:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineModuleApi=void 0;const r=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=s,e)),{});t.defineModuleApi=e=>({name:e.name,commands:r(e.commands,"Command"),queries:r(e.queries,"Query"),events:r(e.events,"Event")})},6964:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.requestContextApi=t.ActiveUserSetEvent=t.SetActiveUserCommand=t.ActiveUserQuery=void 0;const s=r(70986),a=r(49631),n=r(8369);class i extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.ActiveUserQuery=i;class o extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.SetActiveUserCommand=o;class c extends((0,a.defineEvent)({scope:s.UseCaseScope.User})){}t.ActiveUserSetEvent=c,t.requestContextApi=(0,n.defineModuleApi)({commands:{SetActiveUserCommand:o},events:{activeUserSet:c},name:"requestContext",queries:{ActiveUserQuery:i}})},27646:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestContextClient=void 0;const s=r(23767),a=r(6964);class n extends((0,s.defineModuleClient)(a.requestContextApi)){}t.RequestContextClient=n,(0,s.registerModuleClient)(a.requestContextApi,n)},21697:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullModuleApi=void 0,t.NullModuleApi={name:"api",commands:{},events:{},queries:{}}},48304:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.platformInfoApi=t.PlatformInfoQuery=void 0;const s=r(70986),a=r(85888);class n extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.PlatformInfoQuery=n,t.platformInfoApi=(0,a.defineModuleApi)({name:"platformInfo",commands:{},events:{},queries:{PlatformInfoQuery:n}})},24199:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformInfoClient=void 0;const s=r(85888),a=r(48304);class n extends((0,s.defineModuleClient)(a.platformInfoApi)){}t.PlatformInfoClient=n,(0,s.registerModuleClient)(a.platformInfoApi,n)},22396:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(48304),t),a(r(24199),t),a(r(84289),t)},84289:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationBuildType=void 0,function(e){e.DEV="DEV",e.QA="QA",e.NIGHTLY="NIGHTLY",e.BETA="BETA",e.PRODUCTION="PRODUCTION"}(t.ApplicationBuildType||(t.ApplicationBuildType={}))},38783:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.webServicesApi=t.EditSettingsForStagingCommand=t.SettingsForStagingQuery=void 0;const s=r(70986),a=r(85888);class n extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.SettingsForStagingQuery=n;class i extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.EditSettingsForStagingCommand=i,t.webServicesApi=(0,a.defineModuleApi)({commands:{EditSettingsForStagingCommand:i},events:{},name:"webServices",queries:{SettingsForStagingQuery:n}})},56651:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebServicesClient=void 0;const s=r(85888),a=r(38783);class n extends((0,s.defineModuleClient)(a.webServicesApi)){}t.WebServicesClient=n,(0,s.registerModuleClient)(a.webServicesApi,n)},28601:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(38783),t),a(r(56651),t)},73512:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(67837),a=r(20587);class n extends((0,s.E)(a.Yu)){}(0,s.K)(a.Yu,n)},20587:(e,t,r)=>{r.d(t,{L5:()=>i,Yu:()=>c,mf:()=>o});var s=r(86952),a=r(74354),n=r(25029);class i extends((0,a.g)({scope:n.F.Device})){}class o extends((0,a.g)({scope:n.F.Device})){}const c=(0,s.Q)({commands:{TrackEventCommand:i,TrackPageViewCommand:o},events:{},name:"analytics",queries:{}})},25029:(e,t,r)=>{r.d(t,{F:()=>a,z:()=>s});class s{}var a;!function(e){e.User="user",e.Device="device"}(a||(a={}))},74354:(e,t,r)=>{r.d(t,{A:()=>i,g:()=>n});var s=r(25029);class a extends s.z{constructor(e){super(),this.body=e}}const n=(...[e={scope:s.F.User}])=>{var t;return(t=class extends a{}).metadata=e,t},i=(e={scope:s.F.User})=>{var t;return(t=class extends a{}).metadata=e,t}},99059:(e,t,r)=>{r.d(t,{k:()=>n});var s=r(25029);class a extends s.z{constructor(e){super(),this.body=e}}const n=(e={scope:s.F.User})=>{var t;return(t=class extends a{}).metadata=e,t}},88885:(e,t,r)=>{r.d(t,{d:()=>n});var s=r(25029);class a{constructor(e){this.body=e}}const n=(e={scope:s.F.User})=>{var t;return(t=class extends a{}).metadata=e,t}},37765:(e,t,r)=>{r.d(t,{T:()=>i});var s=r(86952),a=r(26538),n=r(7986);const i=(0,s.Q)({name:"icons",commands:{fetchIconForDomain:n.F},events:{},queries:{getIconForDomain:a.el}})},7986:(e,t,r)=>{r.d(t,{F:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},26538:(e,t,r)=>{r.d(t,{el:()=>c,xF:()=>o});var s,a=r(96168),n=r(99059),i=r(25029);!function(e){e.NotFound="notFound"}(s||(s={}));const o=(0,a.Vj)(s.NotFound,"Icon not found");class c extends((0,n.k)({scope:i.F.User})){}},72742:(e,t,r)=>{r.d(t,{P:()=>n});var s=r(86952),a=r(743);const n=(0,s.Q)({name:"exceptionLogging",commands:{sendExceptionLog:a.b},events:{},queries:{}})},743:(e,t,r)=>{r.d(t,{b:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},49329:(e,t,r)=>{r.d(t,{e:()=>i});var s=r(86952),a=r(42339),n=r(29876);const i=(0,s.Q)({name:"taskTracking",commands:{startTaskTracking:a.g,terminateTaskTracking:n.y},events:{},queries:{}})},42339:(e,t,r)=>{r.d(t,{g:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},29876:(e,t,r)=>{r.d(t,{y:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.Device})){}},70493:(e,t,r)=>{r.d(t,{YM:()=>u,_l:()=>c,_x:()=>l,cV:()=>p,fV:()=>d,r6:()=>o});var s=r(99059),a=r(25029),n=r(74354),i=r(86952);class o extends((0,s.k)({scope:a.F.User})){}class c extends((0,s.k)({scope:a.F.User})){}class d extends((0,s.k)({scope:a.F.User})){}class l extends((0,n.g)({scope:a.F.User})){}class u extends((0,n.g)({scope:a.F.User})){}const p=(0,i.Q)({events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:o,UserFeatureFlipQuery:d,UserAvailableLabsQuery:c},commands:{RefreshAvailableLabsCommand:l,ToggleLabCommand:u}})},21242:(e,t,r)=>{r.d(t,{P:()=>n});var s=r(67837),a=r(70493);class n extends((0,s.E)(a.cV)){}(0,s.K)(a.cV,n)},52387:(e,t,r)=>{r.d(t,{L:()=>s});const s=(0,r(86952).Q)({events:{},name:"file-download",queries:{},commands:{}})},67837:(e,t,r)=>{function s(e){var t;return(t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}}).api=e,t}function a(e,t){e.ClientClass=t}r.d(t,{E:()=>s,K:()=>a})},86952:(e,t,r)=>{r.d(t,{Q:()=>a});const s=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=s,e)),{}),a=e=>({name:e.name,commands:s(e.commands,"Command"),queries:s(e.queries,"Query"),events:s(e.events,"Event")})},8987:(e,t,r)=>{r.d(t,{W_:()=>l,p:()=>c,r$:()=>d,t$:()=>u});var s=r(99059),a=r(25029),n=r(74354),i=r(88885),o=r(86952);class c extends((0,s.k)({scope:a.F.Device})){}class d extends((0,n.g)({scope:a.F.Device})){}class l extends((0,i.d)({scope:a.F.User})){}const u=(0,o.Q)({commands:{SetActiveUserCommand:d},events:{activeUserSet:l},name:"requestContext",queries:{ActiveUserQuery:c}})},69008:(e,t,r)=>{r.d(t,{Q:()=>n});var s=r(67837),a=r(8987);class n extends((0,s.E)(a.t$)){}(0,s.K)(a.t$,n)},50540:(e,t,r)=>{r.d(t,{J:()=>o,a:()=>i});var s=r(99059),a=r(25029),n=r(86952);class i extends((0,s.k)({scope:a.F.Device})){}const o=(0,n.Q)({name:"platformInfo",commands:{},events:{},queries:{PlatformInfoQuery:i}})},55300:(e,t,r)=>{r.d(t,{c:()=>n});var s=r(67837),a=r(50540);class n extends((0,s.E)(a.J)){}(0,s.K)(a.J,n)},59894:(e,t,r)=>{var s;r.d(t,{P:()=>s}),function(e){e.DEV="DEV",e.QA="QA",e.NIGHTLY="NIGHTLY",e.BETA="BETA",e.PRODUCTION="PRODUCTION"}(s||(s={}))},97191:(e,t,r)=>{r.d(t,{Dm:()=>d,Lt:()=>o,bH:()=>c});var s=r(99059),a=r(25029),n=r(74354),i=r(86952);class o extends((0,s.k)({scope:a.F.Device})){}class c extends((0,n.g)({scope:a.F.Device})){}const d=(0,i.Q)({commands:{EditSettingsForStagingCommand:c},events:{},name:"webServices",queries:{SettingsForStagingQuery:o}})},1665:(e,t,r)=>{r.d(t,{I:()=>m});var s=r(88802),a=r(20587),n=r(99634),i=r(63663),o=r(87279),c=r(86252),d=r(57924);let l=class{constructor(e){this.carbonLegacyClient=e}async trackEvent(e){const{carbon:t}=this.carbonLegacyClient.commands,r=await t({name:"logEvent",args:[{event:e}]});if((0,o.hx)(r))throw new Error("TrackEvent from carbon failed")}async trackPageView(e,t){const{carbon:r}=this.carbonLegacyClient.commands,s=await r({name:"logPageView",args:[{pageView:e,browseComponent:t}]});if((0,o.hx)(s))throw new Error("TrackPageView from carbon failed")}};l=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[c._])],l);let u=class{constructor(e){this.analyticsService=e}async execute({body:{event:e}}){return await this.analyticsService.trackEvent(e),(0,o.Vp)(void 0)}};u=(0,s.__decorate)([(0,i.W)(a.L5),(0,s.__metadata)("design:paramtypes",[l])],u);let p=class{constructor(e){this.analyticsService=e}async execute({body:{pageView:e,browseComponent:t}}){return await this.analyticsService.trackPageView(e,t),(0,o.Vp)(void 0)}};p=(0,s.__decorate)([(0,i.W)(a.mf),(0,s.__metadata)("design:paramtypes",[l])],p);let m=class{};m=(0,s.__decorate)([(0,n.Yl)({api:a.Yu,providers:[l],handlers:{commands:{trackEvent:u,trackPageView:p},events:{},queries:{}},domainName:"framework"})],m)},79256:(e,t,r)=>{r.d(t,{y:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}async derive(e,t,r){const{deriveKeyArgon2d:s}=this.config.crypto;return await s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},114:(e,t,r)=>{r.d(t,{i:()=>i});var s=r(88802),a=r(57924);const n={computeHash:()=>Promise.resolve(new ArrayBuffer(32)),decryptAes256:(e,t,r)=>Promise.resolve(r),deriveKeyArgon2d:()=>Promise.resolve(new ArrayBuffer(32)),deriveKeyPbkdf2:()=>Promise.resolve(new ArrayBuffer(32)),encryptAes256:(e,t,r)=>Promise.resolve(r),generateKeyAes256:()=>Promise.resolve(new ArrayBuffer(32)),generateKeyPairRsaOaep:()=>Promise.resolve({privateKey:new ArrayBuffer(32),publicKey:new ArrayBuffer(32)}),getRandomValues:e=>new Uint8Array(e),signHmacSha:()=>Promise.resolve(new ArrayBuffer(32)),unsafeComputeMd5Hash:()=>new ArrayBuffer(1),verifyHmacSha:()=>Promise.resolve(!0),decryptRsaOaep:function(e,t){return Promise.resolve(t)},encryptRsaOaep:function(e,t){return Promise.resolve(t)},signRsassaPkcs1:function(e,t){return Promise.resolve(t)},verifyRsassaPkcs1:()=>Promise.resolve(!0)};let i=class{constructor(e){this.crypto=e}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[Object])],i);new i(n)},37935:(e,t,r)=>{r.d(t,{D:()=>Y});var s=r(88802),a=r(99634),n=r(79256),i=r(114),o=r(31186),c=r(25594),d=r(56268),l=r(31222),u=r(57924),p=r(74017);let m=class{constructor(e){this.config=e}async verify(e,t,r,s=p.x){const{verifyHmacSha:a}=this.config.crypto;return await a(e,t,r,s)}};m=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[i.i])],m);var h=r(92258),g=r(72580),v=r(83919),f=r(56130),y=r(86381),b=r(40369),_=r(12554),S=r(77970),w=r(40173),E=r(28008),C=r(22513),T=r(60733),F=r(19603),N=r(95087),I=r(89685);const U="flexible";var P=r(69591);const A="KWC3",x=0;var D=r(38291);const O=32,k=4;function R(e){const t=e.slice(O,O+k),r=(0,I.v)(t);var s;if(s=r,[A,D.PD].includes(s))return r}function L(e){const t=R(e);return t||(function(e){const t=new Uint8Array(e).slice(0,1);return(0,I.v)(t.buffer)===P.F}(e)?U:void 0)}var M=r(60745),j=r(82933),V=r(94805),z=r(16698);const B={type:A,derivation:V.Yi,cipher:z.No};function $(e){const t=function({transportableData:e,marker:t}){const{derivation:r,type:s}=t,{saltLength:a}=r,n=x+a+s.length;return{salt:e.slice(x,x+a),encipheredContents:e.slice(n)}}({transportableData:e,marker:B});return{salt:t.salt,type:A,encipheredContents:t.encipheredContents,derivationConfig:V.Yi,cipherConfig:z.No}}var q=r(12087);async function G(e,t,r,s){const a=$(s),{deriveKeyPbkdf2:n}=t,{derivationConfig:i,salt:o}=a,c=await(0,q.E)(n,r,i,e,o),{computeHash:d}=t,{cipherConfig:{ivLength:l,bytesToKey:{iterations:u,keyLength:p}}}=a,m=await async function(e,t,r,s,a,n){const i=(0,j.K)(t,n.slice(0,8));let o=i,c=new ArrayBuffer(0);for(let t=0;t<r;t++){const t=await e(o,"SHA-1");c=(0,j.K)(c,t),o=(0,j.K)(t,i)}const d=a+s;return Promise.resolve(c.slice(a,d))}(d,c,u,l,p,o),{decryptAes256:h}=t,{encipheredContents:g}=a;return h(c,m,g)}var K=r(7449);let H=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return async function(e,t,r,s){const a=L(s);if(!a)throw new Error("Cannot find marker type");switch(a){case A:return await G(e,t,r,s);case D.PD:return await(0,K.I)(e,t,s);case U:return(0,M.F)(e,t,r,s);default:(0,N.U)(a)}}(e,this.config.crypto,this.derivationCache,t)}};H=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[i.i,o.E])],H);var Q=r(708),W=r(47415);let Y=class{};Y=(0,s.__decorate)([(0,a.Yl)({sharedModuleName:"cryptography",configurations:{infrastructure:{token:i.i}},providers:[n.y,o.E,c.a,d._,Q.y,l.q,m,h.c,g.$,v.o,f.k,y.n,b.F,F.Y,_.g,S.H,w.e,E.k,W.u,C.Z,H,T.f],exports:[n.y,o.E,c.a,d._,Q.y,l.q,m,h.c,g.$,v.o,f.k,y.n,b.F,F.Y,_.g,S.H,w.e,E.k,W.u,C.Z,H,T.f],domainName:"framework"})],Y)},31186:(e,t,r)=>{r.d(t,{E:()=>c});var s=r(88802),a=r(57924),n=r(82933),i=r(10370);class o{constructor(){this.derivateKeyCache=new Map}getCacheKey(...e){const t=e.reduce(((e,t)=>(0,n.K)(e,t)),new ArrayBuffer(0));return(0,i.s)(t)}getCachedDerivation(e){return this.derivateKeyCache.get(e)}setCachedDerivation({cacheKey:e,data:t}){this.getCachedDerivation(e)||this.derivateKeyCache.set(e,t)}}let c=class extends o{};c=(0,s.__decorate)([(0,a.GS)()],c)},25594:(e,t,r)=>{r.d(t,{a:()=>c});var s=r(88802),a=r(57924),n=r(60745),i=r(114),o=r(31186);let c=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return(0,n.F)(e,this.config.crypto,this.derivationCache,t)}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i,o.E])],c)},56268:(e,t,r)=>{r.d(t,{_:()=>b});var s=r(88802),a=r(57924),n=r(82933),i=r(95087),o=r(54066),c=r(69591),d=r(33055),l=r(94805);function u(e){const t=c.F+e.join(c.F)+c.F;return(0,o.u)(t)}function p({cipher:e,derivation:t}){const{algorithm:r}=t;switch(r){case"argon2d":return function({cipher:e,derivation:t}){const{count:r,index:s}=d.ARGON2D_MARKER_SCHEMA,a=new Array(r);return a[s.version]=c.g,a[s.derivation]=t.algorithm,a[s.saltLength]=t.saltLength,a[s.tCost]=t.tCost,a[s.mCost]=t.mCost,a[s.parallelism]=t.parallelism,a[s.cipher]=e.algorithm,a[s.mode]=e.mode,a[s.ivLength]=e.ivLength,u(a)}({cipher:e,derivation:t});case"pbkdf2":return function({cipher:e,derivation:t}){const{count:r,index:s}=d.PBKDF2_MARKER_SCHEMA,a=new Array(r);return a[s.version]=c.g,a[s.derivation]=t.algorithm,a[s.saltLength]=t.saltLength,a[s.iterations]=t.iterations,a[s.hashAlgorithm]=t.hashAlgorithm,a[s.cipher]=e.algorithm,a[s.mode]=e.mode,a[s.ivLength]=e.ivLength,u(a)}({cipher:e,derivation:t});case"noderivation":return function({cipher:e,derivation:t}){const{count:r,index:s}=d.NODERIVATION_MARKER_SCHEMA,a=new Array(r);return a[s.version]=c.g,a[s.derivation]=t.algorithm,a[s.cipher]=e.algorithm,a[s.mode]=e.mode,a[s.ivLength]=e.ivLength,u(a)}({cipher:e,derivation:t});default:(0,i.U)(r)}}var m=r(58396),h=r(6424),g=r(6752);async function v(e,t,r,s,a,i,o){const{algorithm:c}=r,d="pbkdf2"===c||"argon2d"===c;if(d&&!o?.salt)throw new Error("Need salt for derivation");const{deriveKeyArgon2d:u,deriveKeyPbkdf2:v}=t,f=d&&o?.salt?await(0,g.b)(e,o.salt,v,u,r,s):e,{mode:y}=a,{computeHash:b}=t,{encryptionKey:_,signatureKey:S}="cbchmac64"===y?await(0,m.U)(f):await(0,h.Y)(f,b),{getRandomValues:w}=t,E=w(a.ivLength),{encryptAes256:C}=t,T=await C(_,E,i),{signHmacSha:F}=t,N=(0,n.K)(E,T),I=await F(S,N);return function(e){const{encipheredContents:t,cipherConfig:r,derivationConfig:s,salt:a,signature:i,iv:o}=e;if((a?.byteLength??0)!==(0,l.m9)(s))throw new Error(`Salt length ${a?.byteLength??0} does not match derivation algorithm ${s.algorithm} expectation`);const c=p({cipher:r,derivation:s});return a&&"noderivation"!==s.algorithm?(0,n.K)(c,a,o,i,t):(0,n.K)(c,o,i,t)}({type:"flexible",version:1,derivationConfig:r,cipherConfig:a,salt:o?.salt,iv:E,signature:I,encipheredContents:T})}var f=r(114),y=r(31186);let b=class{constructor(e,t){this.config=e,this.derivationCache=t}async encrypt(e,t,r,s,a){return await v(e,this.config.crypto,r,this.derivationCache,s,t,a)}};b=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[f.i,y.E])],b)},708:(e,t,r)=>{r.d(t,{y:()=>c});var s=r(88802),a=r(57924),n=r(60745);var i=r(114),o=r(31186);let c=class{constructor(e,t){this.config=e,this.derivationCache=t}verifySignature(e,t){return async function(e,t,r,s){const{verifyHmacSha:a}=t,{signatureKey:i,signature:o,dataToSign:c}=await(0,n.V)(e,t,r,s);return a(i,o,c)}(e,this.config.crypto,this.derivationCache,t)}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i,o.E])],c)},31222:(e,t,r)=>{r.d(t,{q:()=>o});var s=r(88802),a=r(57924),n=r(74017),i=r(114);let o=class{constructor(e){this.config=e}async sign(e,t,r=n.x){const{signHmacSha:s}=this.config.crypto;return await s(e,t,r)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i])],o)},92258:(e,t,r)=>{r.d(t,{c:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}generate(){const{generateKeyAes256:e}=this.config.crypto;return e()}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},72580:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(88802),a=r(57924),n=r(7449),i=r(114);let o=class{constructor(e){this.config=e}decrypt(e,t){return(0,n.I)(e,this.config.crypto,t)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i])],o)},83919:(e,t,r)=>{r.d(t,{o:()=>m});var s=r(88802),a=r(57924),n=r(16698),i=r(82933),o=r(54066),c=r(38291);var d=r(6424);async function l(e,t,r,s,a,n){const{computeHash:l}=t,{encryptionKey:u,signatureKey:p}=await(0,d.Y)(e,l),{getRandomValues:m}=t,{ivLength:h}=s,g=m(h),{encryptAes256:v}=t,f=await v(u,g,a),{signHmacSha:y}=t,b=(0,i.K)(g,f),_={type:"KWC5",derivationConfig:r,cipherConfig:s,iv:g,signature:await y(p,b),encipheredContents:f},{padding:S}=n;return function({secureData:e,randomValues:t}){if(t.byteLength!==c.en)throw new Error("Encoding kwc5 requires 16 random bytes");const{encipheredContents:r,iv:s,type:a,signature:n}=e,d=(0,o.u)(a);return(0,i.K)(s,t,d,n,r)}({secureData:_,randomValues:S})}var u=r(94805),p=r(114);let m=class{constructor(e){this.config=e}encrypt(e,t){const{getRandomValues:r}=this.config.crypto,s={padding:r(n.BU.padding)};return l(e,this.config.crypto,u.oo,n.BU,t,s)}};m=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[p.i])],m)},55119:(e,t,r)=>{function s(){return new Uint32Array([57920321,977424202,1999259334,3390546403,3917439743,16505144,3027631148,3235565160,2643335823,1420105356,998514539,2704347781,1011257802,823882961,790991339,3929284516]).buffer}r.d(t,{S:()=>s})},56130:(e,t,r)=>{r.d(t,{k:()=>o});var s=r(88802),a=r(57924),n=r(25594),i=r(55119);let o=class{constructor(e){this.flexibleDecryptor=e}async decrypt(e){const t=(0,i.S)();return await this.flexibleDecryptor.decrypt(t,e)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.a])],o)},86381:(e,t,r)=>{r.d(t,{n:()=>c});var s=r(88802),a=r(57924),n=r(89685),i=r(56130),o=r(40369);let c=class{constructor(e,t){this.obfuscationKeyDecryptor=e,this.obfuscationKeyEncryptor=t}async encode(e){return await this.obfuscationKeyEncryptor.encrypt(e)}async decode(e){return(0,n.v)(e).startsWith("$1$noderivation$aes256$cbchmac64$16$")?await this.obfuscationKeyDecryptor.decrypt(e):e}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.k,o.F])],c)},40369:(e,t,r)=>{r.d(t,{F:()=>d});var s=r(88802),a=r(57924),n=r(94805),i=r(16698),o=r(56268),c=r(55119);let d=class{constructor(e){this.flexibleEncryptor=e}async encrypt(e){const t=(0,c.S)();return await this.flexibleEncryptor.encrypt(t,e,n.oo,i.gO)}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o._])],d)},19603:(e,t,r)=>{r.d(t,{Y:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}get(e){const{getRandomValues:t}=this.config.crypto;return t(e).buffer}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},12554:(e,t,r)=>{r.d(t,{g:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}decrypt(e,t,r="SHA-256"){const{decryptRsaOaep:s}=this.config.crypto;return s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},77970:(e,t,r)=>{r.d(t,{H:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}encrypt(e,t,r="SHA-256"){const{encryptRsaOaep:s}=this.config.crypto;return s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},40173:(e,t,r)=>{r.d(t,{e:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}generate(e="SHA-256"){const{generateKeyPairRsaOaep:t}=this.config.crypto;return t(e)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},28008:(e,t,r)=>{r.d(t,{k:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}async sign(e,t,r="SHA-256"){const{signRsassaPkcs1:s}=this.config.crypto;return await s(e,t,r)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},47415:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(88802),a=r(57924),n=r(83407),i=r(114);let o=class{constructor(e){this.config=e}async verify(e,t,r,s=n.Tt){const{verifyRsassaPkcs1:a}=this.config.crypto;return await a(e,t,r,s)}};o=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i.i])],o)},22513:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}async compute(e,t){const{computeHash:r}=this.config.crypto;return await r(e,t)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},60733:(e,t,r)=>{r.d(t,{f:()=>i});var s=r(88802),a=r(57924),n=r(114);let i=class{constructor(e){this.config=e}compute(e){const{unsafeComputeMd5Hash:t}=this.config.crypto;return t(e)}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.i])],i)},65255:(e,t,r)=>{r.d(t,{w:()=>s});const s={AuthsyncExtensionArkRelease:"authsync_extension_ark_release",BBCOM238Duo:"BBCOM-238-duo",CollectionsPageEnabled:"vault_web_collectionpage_dev",SAEXSendSharing:"SAEXSendSharing",DwiMultipleDomainsProd:"dwi_multiple_domains_prod",DisableSecureNotes:"disableSecureNotes",EcommerceWebB2BDiscontinuationDev:"ecommerce_web_b2bDiscontinuation_dev",ItadminSAEXCryptoMigrationPhase3V1:"itadmin_SAEX_CryptoMigration_Phase3_v1",ItadminTacEncryptionserviceSSOmigrationReset:"itadmin_tac_encryptionservice_SSOmigration_reset",SaexSecureNoteAttachmentsForrelease:"saex_SecureNoteAttachments_forrelease",SearchRevamp:"onboarding_web_search_revamp_dev",TechWeekWebDisplayLabs:"techWeek_web_displayLabs",TechweekWebAttachmentsForIdsV1:"techweek_web_attachmentsForIds_v1",TechweekWebExpiredLabelforIDDev:"techweek_web_expiredLabelforID_dev",WebplatformWebPrideColors:"webplatform_web_prideColors",WebproductExtensionActivateChangeMasterPasswordRelease:"webproduct_extension_ActivateChangeMasterPassword_release",WebproductExtensionShowUserConsentOptions:"webproduct_extension_ShowUserConsentOptions",SupportMarkdownInSecureNotes:"webproduct_extension_securenotesmarkdown_dev",SharingVaultOtpSetupDev:"sharingVault_web_otp_setup_dev",SecretManagementProd_1:"ace_secrets_vault_1"}},1777:(e,t,r)=>{r.d(t,{k:()=>Y});var s=r(88802),a=r(99634),n=r(22838),i=r(70493),o=r(8987),c=r(93850),d=r(85390),l=r(16433),u=r(87065),p=r(41842),m=r(68307),h=r(9671),g=r(20754),v=r(63663),f=r(69008),y=r(87279),b=r(60399),_=r(57924),S=r(48844),w=r(87113);let E=class{constructor(e){this.serverApiClient=e}getFeatureFlipsForActiveUser(e){return(0,b.z)(this.serverApiClient.v1.features.getAndEvaluateForUser({features:e}).pipe((0,S.nb)({success:e=>e.data.enabledFeatures,failure:()=>{throw new Error("Unable to fetch enabled feature flips for the active user")}})))}getAvailableFeatureFlips(){return(0,b.z)(this.serverApiClient.v1.features.listAvailableFeatureFlips({}).pipe((0,S.nb)({success:e=>e.data.features.map((e=>e.name)),failure:()=>{throw new Error("Unable to fetch available feature flips")}})))}};E=(0,s.__decorate)([(0,_.GS)(),(0,s.__metadata)("design:paramtypes",[w.l])],E);var C=r(95681),T=r(23347),F=r(25029),N=r(10722);const I=e=>!(!e||"object"!=typeof e)&&"featureFlips"in e;class U extends((0,C.Q)({persist:!0,scope:F.F.Device,storeName:"feature-flip-store",capacity:T.Y._010KB,codec:N.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:I}})){}class P extends((0,C.Q)({persist:!0,scope:F.F.User,storeName:"feature-flip-store",capacity:T.Y._010KB,codec:N.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:I}})){}var A;!function(e){e.Success="Success",e.Pending="Pending",e.Loading="Loading",e.Cache="Cache"}(A||(A={}));class x extends((0,C.Q)({persist:!1,initialValue:{refreshStatus:A.Pending},scope:F.F.Device,storeName:"feature-flip-refresh-store",capacity:T.Y._001KB})){}function D(e,t){return!(!(0,y.d6)(e)||(0,y.db)(e).userName)||(!(0,y.d6)(e)||!(0,y.db)(e).userName||[A.Success,A.Cache].includes(t))}const O=(e,t)=>Object.keys(e).reduce(((r,s)=>{const a=t[s];return r[s]=void 0!==a?a.isActivated:e[s],r}),{});var k=r(28489);const R=e=>"object"==typeof e&&null!==e&&(0,k.l$)(e,"availableLabs")&&"object"==typeof e.availableLabs&&null!==e.availableLabs;class L extends((0,C.Q)({persist:!0,scope:F.F.User,storeName:"labs-store",capacity:T.Y._001KB,codec:N.E,storage:{initialValue:{availableLabs:{}},schemaVersion:1,typeGuard:R}})){}var M=r(96168);class j extends((0,M.Hu)("refresh_available_labs_failed","Unable to refresh available labs for the active user")){}class V extends((0,M.Hu)("fetch_available_labs_failed","Unable to fetch labs for the active user")){}let z=class{constructor(e,t,r,s){this.serverApiClient=e,this.introspection=t,this.featureFlipsStore=r,this.labsStore=s}async refreshAvailableLabs(){const e=await this.getAvailableLabs();if((0,y.hx)(e))return(0,y.Rn)(new j);const t=await this.labsStore.getState(),r=(0,y.db)(e).reduce(((e,r)=>(e[r.featureName]={...r,isActivated:!!t.availableLabs[r.featureName]?.isActivated},e)),{});return await this.labsStore.set({availableLabs:r}),(0,y.Vp)(void 0)}async getAvailableLabs(){const e=this.getRequiredFeatures(),{featureFlips:t}=await this.featureFlipsStore.getState();return(0,b.z)(this.serverApiClient.v1.features.listAvailableLabs({}).pipe((0,S.DZ)((()=>new V)),(0,S.lk)((r=>(0,y.Vp)(r.data.labs.filter((t=>e.has(t.featureName))).filter((e=>!1===t[e.featureName])))))))}getRequiredFeatures(){const e=this.introspection.modules;return Object.keys(e).reduce(((t,r)=>{const s=e[r];if(s.requiredFeatureFlips)for(const e of s.requiredFeatureFlips)t.add(e);return t}),new Set)}};z=(0,s.__decorate)([(0,_.GS)(),(0,s.__metadata)("design:paramtypes",[w.l,n.Q1,P,L])],z);let B=class{constructor(e,t,r,s,a,n,i){this.allowedToFailForGetAvailableFeatureFlips=e,this.allowedToFailForGetFeatureFlipsForActiveUser=t,this.allowedToFailForGetAvailableLabs=r,this.featureFlipsService=s,this.featureFlipsStore=a,this.featureFlipsRefreshStore=n,this.labsService=i}async handle({body:e}){if(!e.userName)return await this.featureFlipsRefreshStore.set({refreshStatus:A.Pending}),void await this.featureFlipsStore.set({featureFlips:{}});await this.featureFlipsRefreshStore.set({refreshStatus:A.Loading});const t=this.labsService.getRequiredFeatures(),r=Array.from(t);let s=[];await this.allowedToFailForGetAvailableFeatureFlips.doOne((()=>this.featureFlipsService.getAvailableFeatureFlips().then((e=>{s=e.filter((e=>t.has(e)))}))));const a=0===s.length?r:s;await this.allowedToFailForGetFeatureFlipsForActiveUser.doOne((async()=>{try{const e=await this.featureFlipsService.getFeatureFlipsForActiveUser(a),t=new Set(e),n=new Set(s),i=r.reduce(((e,r)=>(e[r]=t.has(r)||!n.has(r)&&void 0,e)),{});await this.featureFlipsStore.set({featureFlips:i}),await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),await this.featureFlipsRefreshStore.set({refreshStatus:A.Success})}catch(e){throw await this.featureFlipsRefreshStore.set({refreshStatus:A.Cache}),e}}))}};B=(0,s.__decorate)([(0,m.b)(o.W_),(0,s.__metadata)("design:paramtypes",[h.J,h.J,h.J,E,P,x,z])],B);let $=class{constructor(e,t,r,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r,this.labsStore=s}execute(){return(0,d.a)([this.requestContextClient.queries.activeUser().pipe((0,l.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,u.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,u.U)((e=>e.featureFlips))),this.labsStore.state$.pipe((0,u.U)((e=>e.availableLabs)))]).pipe((0,p.h)((([e,t])=>D(e,t))),(0,u.U)((([e,,t,r])=>{if((0,y.d6)(e)){if(!(0,y.db)(e).userName)return(0,y.Vp)({});const s=O(t,r);return(0,y.Vp)(s)}throw new Error("Cannot determine if user is logged in")})))}};$=(0,s.__decorate)([(0,g.e)(i.r6),(0,s.__metadata)("design:paramtypes",[P,x,f.Q,L])],$);let q=class{constructor(e,t,r,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r,this.labsStore=s}execute({body:e}){const{featureFlip:t}=e;return(0,d.a)([this.requestContextClient.queries.activeUser().pipe((0,l.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,u.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,u.U)((e=>e.featureFlips))),this.labsStore.state$.pipe((0,u.U)((e=>e.availableLabs)))]).pipe((0,p.h)((([e,t])=>D(e,t))),(0,u.U)((([e,,r,s])=>{if((0,y.d6)(e)){if(!(0,y.db)(e).userName)return(0,y.Vp)(void 0);const a=O(r,s);return(0,y.Vp)(a[t])}throw new Error("Cannot determine if user is logged in")})))}};q=(0,s.__decorate)([(0,g.e)(i.fV),(0,s.__metadata)("design:paramtypes",[P,x,f.Q,L])],q);let G=class{constructor(e,t,r){this.labsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r}execute(){return(0,d.a)([this.requestContextClient.queries.activeUser().pipe((0,l.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,u.U)((e=>e.refreshStatus))),this.labsStore.state$.pipe((0,u.U)((e=>e.availableLabs)))]).pipe((0,p.h)((([e,t])=>D(e,t))),(0,u.U)((([e,,t])=>{if((0,y.d6)(e))return(0,y.db)(e).userName?(0,y.Vp)(t):(0,y.Vp)({});throw new Error("Cannot determine if user is logged in")})))}};G=(0,s.__decorate)([(0,g.e)(i._l),(0,s.__metadata)("design:paramtypes",[L,x,f.Q])],G);let K=class{constructor(e,t){this.allowedToFailForGetAvailableLabs=e,this.labsService=t}async execute(){return await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),(0,y.Vp)(void 0)}};K=(0,s.__decorate)([(0,v.W)(i._x),(0,s.__metadata)("design:paramtypes",[h.J,z])],K);let H=class{constructor(e){this.labsStore=e}async execute({body:e}){const{id:t,isActivated:r}=e,s=await this.labsStore.getState(),a={...s,availableLabs:{...s.availableLabs,[t]:{...s.availableLabs[t],isActivated:r}}};return await this.labsStore.set(a),(0,y.Vp)(void 0)}};H=(0,s.__decorate)([(0,v.W)(i.YM),(0,s.__metadata)("design:paramtypes",[L])],H);var Q=r(65255);let W=class{constructor(e){this.featureFlipsStoreLegacy=e}onFrameworkInit(){this.featureFlipsStoreLegacy.clearStorage()}};W=(0,s.__decorate)([(0,_.ar)(),(0,s.__metadata)("design:paramtypes",[U])],W);let Y=class{};Y=(0,s.__decorate)([(0,a.Yl)({api:i.cV,providers:[E,z],imports:[c.n,n.Q1],exports:[E],handlers:{commands:{refreshAvailableLabs:K,toggleLab:H},queries:{userFeatureFlips:$,userFeatureFlip:q,userAvailableLabs:G},events:{...(0,a.g4)(o.t$,{activeUserSet:B})}},stores:[U,P,x,L],requiredFeatureFlips:Object.values(Q.w),onFrameworkInit:W,domainName:"framework"})],Y)},94113:(e,t,r)=>{r.d(t,{p:()=>D});var s=r(88802),a=r(99634),n=r(38679),i=r(37765),o=r(63663),c=r(87279),d=r(7986),l=r(60399),u=r(57924),p=r(96303),m=r(87113),h=r(22513),g=r(95681),v=r(23347),f=r(25029),y=r(10722);const b=e=>null!==e&&"object"==typeof e&&("cachedIcons"in e&&null!==e.cachedIcons&&"object"==typeof e.cachedIcons);class _ extends((0,g.Q)({persist:!0,storage:{schemaVersion:1,initialValue:{cachedIcons:{}},typeGuard:b},scope:f.F.Device,storeName:"icons-store",capacity:v.Y._100KB,codec:y.E})){}const S=e=>e<0?0:24*e*60*60*1e3,w=e=>null!==e&&"object"==typeof e&&"validity"in e&&"updatedAt"in e&&"domainURL"in e,E=e=>e.hash.slice(0,6);let C=class{constructor(e,t,r,s){this.hasher=e,this.serverApiClient=t,this.store=r,this.domainsToFetch=s,this.requestDomains=async e=>{0!==e.length&&this.serverApiClient.v1.icons.requestIcons({domains:e.map((e=>e.domainURL))})},this.fetchDomains=async e=>{const t=e.map(E);return await(0,l.z)(this.serverApiClient.v1.icons.getIcons({hashes:t}))},this.fetchAndRequestDomains=((e,t)=>{let r=!1;return(...s)=>{r||(r=!0,setTimeout((()=>{r=!1,e(...s)}),t))}})((async()=>{const e=(await this.store.getState()).cachedIcons,t=Object.values(this.domainsToFetch).filter((t=>{const r=void 0===e[t.domainURL]?void 0:e[t.domainURL],s=(e=>null!==e&&"object"==typeof e&&"updatedAt"in e&&"domainURL"in e&&!w(e))(r)?S(1):S(14);return((e,t)=>!(e&&Date.now()<e.updatedAt+t))(r,s)}));if(0===t.length)return;const r=await this.fetchDomains(t),s=(0,c.d6)(r)?(0,c.db)(r).data.icons:[],a=t.map((e=>{const t=s.find((t=>t.hash===e.hash));return{...t||{},hash:e.hash,domainURL:e.domainURL,updatedAt:Date.now()}}));await this.updateIconsCacheEntries(a);const n=a.filter((e=>!e.url));await this.requestDomains(n),this.domainsToFetch={}}),100)}async updateIconsCacheEntries(e){const t=await this.store.getState();await this.store.set({...t,cachedIcons:{...t.cachedIcons,...e.reduce(((e,t)=>(e[t.domainURL]=t,e)),{})}})}async computeDomainHash(e){const t=await this.hasher.compute((new TextEncoder).encode(e),"SHA-256");return(0,p.k)(t)}async fetchIconForDomain(e){const t=await this.computeDomainHash(e);this.domainsToFetch[e]={hash:t,domainURL:e},this.fetchAndRequestDomains()}};C=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[h.Z,m.l,_,Object])],C);let T=class{constructor(e){this.iconsService=e}execute({body:{domainURL:e}}){return this.iconsService.fetchIconForDomain(e),Promise.resolve((0,c.Vp)(void 0))}};T=(0,s.__decorate)([(0,o.W)(d.F),(0,s.__metadata)("design:paramtypes",[C])],T);var F=r(87065),N=r(6136),I=r(20754),U=r(26538);let P=class{constructor(e){this.store=e}execute(e){const{domainURL:t}=e.body;return this.store.state$.pipe((0,F.U)((e=>{const r=e.cachedIcons[t];return w(r)&&(e=>"valid"===e.validity&&Boolean(e.url))(r)?r:null})),(0,N.x)(),(0,F.U)((e=>e?(0,c.Vp)(e):(0,c.Rn)((0,U.xF)()))))}};P=(0,s.__decorate)([(0,I.e)(U.el),(0,s.__metadata)("design:paramtypes",[_])],P);var A=r(93850),x=r(37935);let D=class{};D=(0,s.__decorate)([(0,a.Yl)({api:i.T,imports:[x.D,A.n],providers:[...(0,n.H)(C,{inject:[h.Z,m.l,_],asyncFactory:(e,t,r)=>Promise.resolve(new C(e,t,r,{}))})],stores:[_],handlers:{commands:{fetchIconForDomain:T},events:{},queries:{getIconForDomain:P}}})],D)},43673:(e,t,r)=>{r.d(t,{i:()=>p});var s=r(88802),a=r(50540),n=r(99634),i=r(58895),o=r(86252),c=r(20754),d=r(48844),l=r(87279);let u=class{constructor(e){this.carbon=e}execute(){return this.carbon.queries.getPlatformInfo().pipe((0,d.lk)((e=>(0,l.Vp)(e))))}};u=(0,s.__decorate)([(0,c.e)(a.a),(0,s.__metadata)("design:paramtypes",[o._])],u);let p=class{};p=(0,s.__decorate)([(0,n.Yl)({api:a.J,providers:[i.t],exports:[i.t],handlers:{commands:{},events:{},queries:{platformInfo:u}},domainName:"framework"})],p)},58895:(e,t,r)=>{r.d(t,{t:()=>l});var s=r(88802),a=r(60399),n=r(57924),i=r(94189),o=r(48844),c=r(20195),d=r(6936);let l=class{constructor(e){this.client=e}getPlatformInfo(){return(0,a.z)(this.client.getClient(d.W).queries.getPlatformInfo().pipe((0,o.nb)({success:e=>e,failure:c.j})))}};l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[i.m])],l)},29659:(e,t,r)=>{r.d(t,{c:()=>l});var s=r(88802),a=r(57924),n=r(26457),i=r(87279),o=r(86252),c=r(21877),d=r(88268);let l=class extends d.tI{constructor(e,t){super(),this.carbonLegacyClient=e,this.appLogger=t}async decipher(e,t){const{carbon:r}=this.carbonLegacyClient.commands,s=await r({name:"decipherRemoteFile",args:[{cipheredFileContent:e,fileMetaData:t}]});if((0,i.hx)(s))return(0,i.Rn)(c.RemoteFileUpdateError.DecipherError);const{carbonResult:a}=(0,i.db)(s);return(e=>"object"==typeof e&&null!==e&&Object.entries(e).some((([e,t])=>"decipheredFile"===e&&t instanceof ArrayBuffer)))(a)?(0,i.Vp)(a.decipheredFile):(0,i.Rn)(c.RemoteFileUpdateError.DecipherError)}};l=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o._,n.V])],l)},39995:(e,t,r)=>{r.d(t,{Q:()=>c});var s=r(88802),a=r(57924),n=r(7537),i=r(58376),o=r(60399);let c=class{constructor(){this.filesToCheck={},this.publishSubscriber=new n.t,this.updatedFileStream$=new i.y((e=>{this.publishSubscriber.next(e),this.publishSubscriber.complete()}))}publish(e){(0,o.z)(this.publishSubscriber).then((t=>t.next(e)))}fileSubscription(e){return this.filesToCheck={...this.filesToCheck,...e},this.updatedFileStream$}getFilesToCheck(){return this.filesToCheck}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[])],c)},47190:(e,t,r)=>{r.d(t,{P:()=>y});var s=r(88802),a=r(87279),n=r(48844),i=r(18533),o=r(21877),c=r(57924),d=r(73774),l=r(69885),u=r(60399),p=r(87065),m=r(87113),h=r(88268),g=r(94143),v=r(25994);const f=e=>e[1].status===g.nQ;let y=class extends h.gG{constructor(e,t){super(),this.httpClient=e,this.serverApiClient=t}async downloadRemoteFileUpdate(e){if(0===Object.keys(e.files).length)return[];const t=await this._getFileMeta(e);return(0,a.hx)(t)?[(0,l.of)(t)]:this._retrieveFilesFromServer((0,a.db)(t))}_getFileMeta(e){return(0,u.z)(this.serverApiClient.v1.file.getFileMetaV2(e).pipe((0,p.U)((e=>{if((0,a.hx)(e))return(0,a.Rn)(o.RemoteFileUpdateError.ServerError);const t=(0,a.db)(e);return"fileInfos"in(r=t.data)&&Object.values(r.fileInfos).every((e=>"object"==typeof e&&null!==e&&"status"in e&&void 0!==e.status&&null!==e.status&&g.PQ.has(e.status)))?(0,a.Vp)(t.data.fileInfos):(0,a.Rn)(o.RemoteFileUpdateError.ServerError);var r}))))}_retrieveFilesFromServer(e){return Object.entries(e).filter(f).map((([e,t])=>this._getBufferFromURL(e,t)))}_getBufferFromURL(e,t){return this.httpClient.get(t.url,{observe:"body",responseType:"arraybuffer"}).pipe((0,n.Qn)(this._handleSuccess(e,t)),(0,n.DZ)(this._handleFailure))}_handleFailure(e){return(0,i.EQ)(e,{BadStatus:e=>e.response.status===v.W.NotModified?g.ek:o.RemoteFileUpdateError.DownloadError,FetchFailedError:()=>o.RemoteFileUpdateError.DownloadError})}_handleSuccess(e,t){return r=>({fileName:e,buffer:r,updatedFile:t})}};y=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:paramtypes",[d.e,m.l])],y)},76946:(e,t,r)=>{r.d(t,{u:()=>u,w:()=>l});var s=r(26457),a=r(43702),n=r(25859),i=r(6220),o=r(41842),c=r(87065),d=r(39995);class l{constructor(e,t,r,s){this.settings=e,this.store=t,this.appLogger=r,this.rfuDispatcher=s;const{fileName:o}=e;this.jsonSerializerCodec=new a.b,this.newlyUpdatedFiles$=(0,n.P)((async()=>{const e=await this.store.getState();return{[o]:e.revision}})).pipe((0,i.z)((e=>this.rfuDispatcher.fileSubscription(e))))}initFileObservation(){this.newlyUpdatedFiles$.subscribe(this._handleRFUDownload.bind(this))}streamFileUpdate(){return this.store.state$.pipe((0,o.h)((e=>0!==e.revision)),(0,c.U)((e=>e.data)),(0,o.h)((e=>this.settings.typeguard(e))))}async _handleRFUDownload(e){const{fileName:t}=this.settings;if(!(t in e))return;const r=e[t],s=this.jsonSerializerCodec.decode(r.buffer);this.settings.typeguard(s)&&(await this.store.set({filename:r.fileName,data:s,revision:r.revision,lastDownloadTimestamp:r.lastDownloadTimestamp}),this.rfuDispatcher.fileSubscription({[t]:r.revision}))}}function u(e){return{token:l,asyncFactory:(t,r,s)=>Promise.resolve(new l(e,t,r,s)),inject:[e.storeClass,s.V,d.Q]}}},31366:(e,t,r)=>{r.d(t,{Q:()=>h});var s=r(88802),a=r(57924),n=r(76946),i=r(73881),o=r(95681),c=r(23347),d=r(10722),l=r(25029);const u=e=>!("object"!=typeof e||null===e)&&("filename"in e&&null!==e.filename&&void 0!==e.filename&&"string"==typeof e.filename&&"revision"in e&&null!==e.revision&&void 0!==e.revision&&"number"==typeof e.revision),p=e=>({filename:e,revision:0,data:{},lastDownloadTimestamp:Date.now()});let m=class{constructor(e){this.rfuClient=e}onFrameworkInit(){this.rfuClient.initFileObservation()}};m=(0,s.__decorate)([(0,a.ar)(),(0,s.__metadata)("design:paramtypes",[n.w])],m);const h=(e,t)=>{const r=(e=>class extends((0,o.Q)({storeName:"RFUStore",persist:!0,storage:{schemaVersion:1,initialValue:p(e),typeGuard:u},codec:d.E,storeTypeGuard:u,capacity:c.Y._010KB,scope:l.F.Device,isCache:!0})){})(e);return{providers:[(0,n.u)({fileName:e,storeClass:r,typeguard:t})],onFrameworkInit:[m],imports:[i.Q],stores:[r]}}},88268:(e,t,r)=>{r.d(t,{gG:()=>s,pF:()=>n,tI:()=>a});class s{}class a{}class n{}},73881:(e,t,r)=>{r.d(t,{Q:()=>f});var s=r(88802),a=r(99634),n=r(25504),i=r(25029),o=r(47190),c=r(1777),d=r(57924),l=r(39995),u=r(88268);let p=class{constructor(e,t){this.remoteFileUpdateService=e,this.dispatcherService=t}run(){const e=this.dispatcherService.getFilesToCheck();this.remoteFileUpdateService.observeRemoteFileUpdates(e).subscribe((e=>{this.dispatcherService.publish(e)})),this.remoteFileUpdateService.downloadAndDecipherRemoteFiles()}};p=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[u.pF,l.Q])],p);var m=r(93850),h=r(29659),g=r(83958),v=r(1665);let f=class{};f=(0,s.__decorate)([(0,a.Yl)({sharedModuleName:"RemoteFileUpdateModule",configurations:{remoteFileUpdateInfrastructure:{token:u.pF},remoteFileUpdateDownloaderInfrastructure:{token:u.gG},decipherInfrastructure:{token:u.tI}},crons:[{handler:p,periodInMinutes:30,name:"RFUCron",scope:i.F.User}],providers:[g.U,h.c,o.P,l.Q],imports:[c.k,n.X,m.n,v.I],exports:[g.U,h.c,o.P,l.Q],domainName:"framework"})],f)},83958:(e,t,r)=>{r.d(t,{U:()=>_});var s=r(88802),a=r(57924),n=r(26457),i=r(94189),o=r(87279),c=r(7537),d=r(58376),l=r(91501),u=r(6220),p=r(87065),m=r(60399),h=r(20587),g=r(29659),v=r(47190),f=r(88268),y=r(94143),b=r(21877);let _=class extends f.pF{constructor(e,t,r,s){super(),this.appLogger=e,this.rfuDownloaderService=t,this.rfuDecipheringService=r,this.cqrsClient=s,this._filesToCheck={files:{}},this._emitDownloadedFilesUpdate$=new c.t,this._downloadedFileStream$=new d.y((e=>{this._emitDownloadedFilesUpdate$.next((t=>{e.next(t)})),this._emitDownloadedFilesUpdate$.complete()}))}observeRemoteFileUpdates(e){return this._filesToCheck={files:{...this._filesToCheck.files,...e}},this._downloadedFileStream$}async downloadAndDecipherRemoteFiles(){const e=(await this.rfuDownloaderService.downloadRemoteFileUpdate(this._filesToCheck)).map((e=>this._downloadAndDecipherSingleFile(e)));(0,l.D)(e).subscribe((e=>{const t=e.reduce(((e,t)=>{if((0,o.hx)(t)){const r=(0,o.Yv)(t);return r===y.ek||this.sendRFUEvents(b.FlowStep.Error,r),e}const r=(0,o.db)(t);return this.sendRFUEvents(b.FlowStep.Complete),{...e,[r.fileName]:r}}),{});this._callEmitDownloadedFilesUpdate(t)}))}async _applyDecipheringStep(e){const t=e.updatedFile.key?await this.rfuDecipheringService.decipher(e.buffer,e.updatedFile):(0,o.Vp)(e.buffer);return(0,o.d6)(t)?(0,o.Vp)({...e,buffer:(0,o.db)(t)}):t}_downloadAndDecipherSingleFile(e){return e.pipe((0,u.z)((e=>(0,o.d6)(e)?this._applyDecipheringStep((0,o.db)(e)):Promise.resolve(e))),(0,p.U)((e=>{if((0,o.hx)(e))return e;const{fileName:t,updatedFile:r,buffer:s}=(0,o.db)(e);return(0,o.Vp)({fileName:t,revision:r.revision,buffer:s,lastDownloadTimestamp:Date.now()})})))}_callEmitDownloadedFilesUpdate(e){return(0,m.z)(this._emitDownloadedFilesUpdate$).then((t=>{t(e)}))}sendRFUEvents(e,t=undefined){const{trackEvent:r}=this.cqrsClient.getClient(h.Yu).commands;r({event:new b.UserReceiveRemoteFileUpdateEvent({flowStep:e,remoteFileUpdateError:t,packageSource:b.PackageSource.Graphene})})}};_=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.V,v.P,g.c,i.w])],_)},94143:(e,t,r)=>{r.d(t,{PQ:()=>a,ek:()=>n,nQ:()=>s});const s="update_available",a=new Set([s,"not_updated","not_found","error_server"]),n="not_modified"},16988:(e,t,r)=>{r.d(t,{L:()=>s});class s{}},32697:(e,t,r)=>{r.d(t,{u:()=>x});var s=r(88802),a=r(24966),n=r(60399),i=r(41842),o=r(87065),c=r(6136),d=r(34987),l=r(14888),u=r(43004),p=r(57924),m=r(73774),h=r(91199),g=r(26457),v=r(43702);var f,y=r(23711),b=r(49499),_=r(87279),S=r(58895),w=r(16988),E=r(61223);function C(e){switch(e){case u.w.CRITICAL:return f.ERROR;case u.w.WARNING:return f.WARNING}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(f||(f={}));const T=(e,t)=>({action:"logOnline",code:C(t.criticality),type:e.platformName,version:e.appVersion,additionalInfo:JSON.stringify({manifestVersion:e.manifestVersion,buildType:e.buildType,...t.origin?{origin:t.origin}:{},cause:t.cause,domainName:t.domainName??"unknown"}),browser:e.browser,browserVersion:e.browserVersion,exceptiontype:t.exceptionType??"grapheneException",message:t.message,os:e.os,osVersion:e.osVersion,sessionId:t.sessionId,stack:t.callStack,initialUseCaseModule:t.moduleName,initialUseCaseName:t.useCaseName,errorCount:1,featureFlips:(t.featuresFlipped??[]).join(","),line:t.lineNumber,file:t.fileLocation});function F(e,t){return new E.L("string"==typeof(r=T(e,t))?r:Object.keys(r).reduce(((e,t)=>{const s=r[t];return void 0===s||(e[t]="string"==typeof s?s:JSON.stringify(s)),e}),{}));var r}const N={"Content-Type":"application/x-www-form-urlencoded"},I=".graphene.exceptionLogs",U=new v.b,P=new class{constructor(e){this.typeGuard=e}decode(e){if(this.typeGuard(e))return e;throw new Error("Bad type")}encode(e){return e}}((e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.keys(e).every((e=>"string"==typeof e))&&Object.values(e).every((e=>{return!!((t=e)&&"object"==typeof t&&"entry"in t&&"id"in t&&"date"in t)&&"string"==typeof t.id&&"number"==typeof t.date&&(0,u.h)(t.entry);var t}))))),A=new y.z;let x=class{constructor(e,t,r,s,n){this.httpClient=e,this.kvStore=t,this.logger=r,this.settings=s,this.platformInfoService=n,this.queue$=new a.X({}),this.logExceptionsCount={},this.platformInfo=null,this.url=`${this.settings.serverEndpoint??"https://kck3hlb9.dashlane.com"}/1/softwarelog/create`,this.codec=(0,b.x)(A,U,P)}async logException(e){console.error(e);const t=this.settings.maxExceptionCountPerSession??10,r=e.message.length?e.message:"UNKNOWN_EXCEPTION";if(r in this.logExceptionsCount){const e=this.logExceptionsCount[r];if(e===t)return Promise.resolve();this.logExceptionsCount[r]=e+1}else this.logExceptionsCount[r]=1;const s=await this.enqueue(e);await(0,n.z)(this.queue$.pipe((0,i.h)((e=>!(s in e)||!!e[s].error))))}async start(){this.platformInfo=await this.platformInfoService.getPlatformInfo(),await this.loadQueue();const e=this.settings.retryDelay??6e4,t=this.queue$.pipe((0,o.U)((e=>Object.keys(e))),(0,c.x)(((e,t)=>t.every((t=>e.includes(t))))),(0,d.b)((()=>this.processQueue())),(0,l.X)({delay:e})).subscribe();return{stop:async()=>{t.unsubscribe(),await this.saveQueue()}}}async ignoreError(e){try{return await e(),!0}catch(e){return this.logger.error("failed to send error log",e),!1}}async saveQueue(){await this.ignoreError((async()=>{const e=await this.codec.encode(this.queue$.value);await this.kvStore.set(I,e)}))}async loadQueue(){await this.ignoreError((async()=>{const e=await this.kvStore.get(I);if(!e||""===e)return void this.queue$.next({});const t=await this.codec.decode(e),r=Date.now()-(this.settings.durationInQueue??864e5);for(const e of Object.keys(t))t[e].date<r&&delete t[e];this.queue$.next(t)}))}async enqueue(e){const t={date:Date.now(),entry:e,id:`${Date.now()}-${Math.random()}`};return this.queue$.value[t.id]=t,await this.saveQueue(),this.queue$.next(this.queue$.value),t.id}async processQueue(){const e=this.platformInfo;if(!e)throw new Error("No platform info");for(;Object.keys(this.queue$.value).length>0;){const t=Object.keys(this.queue$.value)[0],r=this.queue$.value[t];if(!await this.ignoreError((async()=>{const t=await(0,n.z)(this.httpClient.post(this.url,F(e,r.entry),{headers:{...N,"Client-Agent":(s=e,`version:${s.appVersion},platform:${s.platformName}}`)},observe:"response"}));var s;if(!(0,_.d6)(t))throw new Error("Failed to send log")})))throw this.queue$.value[t].error=!0,this.queue$.next(this.queue$.value),new Error("failed to send an item from the queue");delete this.queue$.value[t],await this.saveQueue()}this.queue$.next(this.queue$.value)}};x=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[m.e,h.QI,g.V,w.L,S.t])],x)},64555:(e,t,r)=>{r.d(t,{F:()=>d});var s=r(88802),a=r(99634),n=r(25504),i=r(43673),o=r(32697),c=r(16988);let d=class{};d=(0,s.__decorate)([(0,a.Yl)({sharedModuleName:"software-exception-sink",imports:[n.X,i.i],providers:[o.u],exports:[o.u],configurations:{settings:{token:c.L}},domainName:"framework"})],d)},71993:(e,t,r)=>{r.d(t,{t:()=>d});var s=r(10722),a=r(25029),n=r(95681),i=r(23347);const o={drift:null},c=e=>!(!e||"object"!=typeof e||!("drift"in e))&&(null===e.drift||"number"==typeof e.drift);class d extends((0,n.Q)({storeTypeGuard:c,storeName:"clocksync",storage:{initialValue:o,schemaVersion:1,typeGuard:c},scope:a.F.Device,isCache:!0,persist:!0,capacity:i.Y._001KB,codec:s.E})){}},68259:(e,t,r)=>{r.d(t,{E:()=>$,F:()=>q});var s=r(88802),a=r(60399),n=r(89618),i=r(57924),o=r(73774),c=r(9671),d=r(71937),l=r(58895);class u{constructor(e){this.store=e}async getServerToClientClockDrift(){const{drift:e}=await this.store.getState();return e}storeServerToClientClockDrift(e){return this.store.update((()=>({drift:e})))}}var p=r(18590),m=r(71993),h=r(54404),g=r(77837),v=r(33027),f=r(51402),y=r(9536),b=r(69865),_=r(99082),S=r(62361),w=r(1117),E=r(34838),C=r(4119),T=r(37703),F=r(59091),N=r(18535),I=r(52839),U=r(55127),P=r(7181),A=r(91406),x=r(73873),D=r(84626),O=r(42882),k=r(32739);const R={v1:{account:h.m,accountrecovery:g.u,authentication:v.V,communication:f.g,darkwebmonitoring:y.D,features:b.A,feedback:_.x,file:S.$,icons:w.P,integration:E.Y,invitation:C.R,massdeployment:T.W,payments:F.H,premium:N.j,pwleak:I.J,sharingUserdevice:U.b,secretTransfer:P.V,teams:A.p,time:x.q,useractivity:D.V,userconsents:O.G,vpn:k.V}};var L=r(31222),M=r(22513);const j="CF-Access-Client-Id",V="CF-Access-Client-Secret";class z{constructor(e){this.cloudflareKeys=e,this.id="ServerApiForStagingInterceptor"}intercept(e,t){if(e.url.startsWith("https://api.dashlane.com/")||!this.cloudflareKeys)return t(e);if(!e.headers.has(j)&&!e.headers.has(V)){const{cloudflareAccessKey:r,cloudflareSecretKey:s}=this.cloudflareKeys;return t(e.clone({headers:e.headers.set(j,r).set(V,s)}))}return t(e)}}var B=r(86758);let $=class{constructor(e,t,r,s,a,n,i,o){this.serverApiConfig=e,this.httpClient=t,this.clockDriftStore=r,this.hmacSigner=s,this.secureHasher=a,this.platformInfoService=n,this.allowedToFail=i,this.settingsForStagingStore=o}async init(){const{clockDriftStore:e,serverApiConfig:t,secureHasher:r,httpClient:s,hmacSigner:a}=this,n=new u(e),i=await this.platformInfoService.getPlatformInfo(),{appKeys:o}=t,c=await this.settingsForStagingStore.getState();this.baseUrl=this.initBaseUrl(c,t);const l=this.initCloudflareKeys(c,t);s.addInterceptor(new z(l));const p=(0,d.d)({secureHasher:r,httpClient:s,timeSyncStore:n,hmacSigner:a,apis:R,config:{appKeys:o,baseUrl:this.baseUrl,platformInfo:{platformName:i.platformName,version:i.appVersion||"unknown",osversion:i.osVersion||"unknown",language:i.lang||"unknown"}}});await this.initClockDrift(p),this.rawSdk=p}get sdk(){if(!this.rawSdk)throw new Error("ConfiguredServerSdk not initialized");return this.rawSdk}get url(){if(!this.baseUrl)throw new Error("ConfiguredServerSdk base url not found");return this.baseUrl}initBaseUrl(e,t){const r=e.api;return r.override?r.baseUrlOverride:t.baseUrl}initCloudflareKeys(e,t){const r=e.api;return r.override?{cloudflareAccessKey:r.cloudflareAccessKeyOverride,cloudflareSecretKey:r.cloudflareSecretKeyOverride}:t.cloudflareKeys}async initClockDrift(e){await this.allowedToFail.doOne((async()=>{const{drift:t}=await this.clockDriftStore.getState();null===t&&await(0,a.z)(e.refreshClockDrift().pipe((0,n.V)({first:5e3})))}))}};function q(){return{token:$,asyncFactory:async(e,t,r,s,a,n,i,o)=>{const c=new $(e,t,r,s,a,n,i,o);return await c.init(),c},inject:[p.$y,o.e,m.t,L.q,M.Z,l.t,c.J,B.L]}}$=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[p.$y,o.e,m.t,L.q,M.Z,l.t,c.J,B.L])],$)},63281:(e,t,r)=>{r.d(t,{B:()=>i});var s=r(88802),a=r(57924),n=r(68259);let i=class{constructor(e){this.configuredServerSdk=e}get v1(){return this.configuredServerSdk.sdk.v1}};i=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[n.E])],i)},34903:(e,t,r)=>{r.d(t,{c:()=>u});var s=r(88802),a=r(60399),n=r(162),i=r(37182),o=r(69885),c=r(87065),d=r(57924),l=r(15043);let u=class{getMassDeployedTeamKey(){return(0,a.z)((0,n.D)((0,l.U)("MassDeployedTeamKey")).pipe((0,i.K)((()=>(0,o.of)(void 0))),(0,c.U)((e=>{if(!e||"object"!=typeof e||!("MassDeployedTeamKey"in e))throw new Error('No "MassDeployedTeamKey" found in managed storage');const[t,r]=e.MassDeployedTeamKey.split("-");return{massDeployedTeamAccessKey:t,massDeployedTeamSecretKey:r}}))))}};u=(0,s.__decorate)([(0,d.GS)()],u)},6939:(e,t,r)=>{r.d(t,{J:()=>a});var s=r(20195);const a={FetchFailedError:n=()=>(0,s.j)("Error calling server API"),InternalServerError:n,InvalidRequest:n,RateLimited:n,ServiceUnavailable:n,UnspecifiedBadStatus:n};var n},87113:(e,t,r)=>{r.d(t,{l:()=>l});var s=r(88802),a=r(34987),n=r(57924),i=r(64839),o=r(88290),c=r(68259),d=r(21534);let l=class{constructor(e,t){this.appliedV1Services=this.buildInjectedServices("v1",e.sdk),this.credentialsService=t,this._baseUrl=e.url}get baseUrl(){return this._baseUrl}get v1(){return this.appliedV1Services}buildInjectedServices(e,t){return Object.keys(t[e]).reduce(((r,s)=>({...r,[s]:this.buildInjectedApiServices(e,t,s)})),{})}buildInjectedApiServices(e,t,r){return Object.getOwnPropertyNames(Object.getPrototypeOf(t.v1[r])).filter((e=>"constructor"!==e)).reduce(((s,a)=>({...s,[a]:this.buildInjectedRouteService(t,e,r,a)})),{})}buildInjectedRouteService(e,t,r,s){const n=o.t[r][s];if(!n)throw new Error("Unable to find endpoint descriptor");const{authType:c}=n;return(...n)=>{const o=e[t][r],d=o[s].bind(o);if(c===i.d.USER_DEVICE)return this.credentialsService.getActiveUserDeviceCredentials().pipe((0,a.b)((e=>d(e,...n))));if(c===i.d.MASS_DEPLOYED_TEAM_KEY)return this.credentialsService.getMassDeployTeamKeyCredentials().pipe((0,a.b)((e=>d(e,...n))));if([i.d.NONE,i.d.APP].includes(c))return d(...n);throw new Error("Not supported")}}};l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[c.E,d.n])],l)},21534:(e,t,r)=>{r.d(t,{n:()=>g});var s=r(88802),a=r(162),n=r(37182),i=r(69885),o=r(87065),c=r(34987),d=r(87279),l=r(57924),u=r(94189),p=r(26457),m=r(8987),h=r(18590);let g=class{constructor(e,t,r,s){this.cqrsClient=e,this.serverApiCredentialsInfra=t,this.massDeployedTeamKeyCredentialsInfra=r,this.logger=s}getMassDeployTeamKeyCredentials(){return(0,a.D)(this.massDeployedTeamKeyCredentialsInfra.getMassDeployedTeamKey()).pipe((0,n.K)((e=>(this.logger.trace("Failed to get mass deployed team key",e),(0,i.of)({massDeployedTeamAccessKey:"",massDeployedTeamSecretKey:""})))))}getActiveUserDeviceCredentials(){const{queries:{activeUser:e}}=this.cqrsClient.getClient(m.t$);return e().pipe((0,o.U)((e=>{if((0,d.d6)(e))return(0,d.db)(e);throw new Error("Failed to get active user")})),(0,c.b)((({userName:e})=>{if(!e)throw new Error("No active user available");return this.serverApiCredentialsInfra.getDeviceCredentialsForUser(e)})))}};g=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[u.w,h.se,h.xA,p.V])],g)},18590:(e,t,r)=>{r.d(t,{$y:()=>s,se:()=>a,xA:()=>n});class s{constructor(e){this.baseUrl=e.baseUrl,this.appKeys=e.appKeys,this.cloudflareKeys=e.cloudflareKeys}}class a{}new class extends a{getDeviceCredentialsForUser(e){return Promise.resolve({deviceAccessKey:"",deviceSecretKey:"",login:e})}};class n{}},93850:(e,t,r)=>{r.d(t,{n:()=>w});var s=r(88802),a=r(99634),n=r(25504),i=r(97191),o=r(43673),c=r(87113),d=r(63281),l=r(18590),u=r(71993),p=r(21534),m=r(68259),h=r(37935),g=r(86758),v=r(87279),f=r(63663);let y=class{constructor(e){this.store=e}async execute(e){const t=await this.store.getState();return await this.store.set({...t,...e.body}),(0,v.Vp)(void 0)}};y=(0,s.__decorate)([(0,f.W)(i.bH),(0,s.__metadata)("design:paramtypes",[g.L])],y);var b=r(87065),_=r(20754);let S=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,b.U)((e=>(0,v.Vp)(e))))}};S=(0,s.__decorate)([(0,_.e)(i.Lt),(0,s.__metadata)("design:paramtypes",[g.L])],S);let w=class{};w=(0,s.__decorate)([(0,a.Yl)({api:i.Dm,handlers:{commands:{editSettingsForStaging:y},queries:{settingsForStaging:S},events:{}},providers:[d.B,c.l,p.n,(0,m.F)()],exports:[d.B,c.l],configurations:{serverApi:{token:l.$y},serverApiInfrastructure:{token:l.se},massDeploymentInfrastructure:{token:l.xA}},stores:[u.t,g.L],imports:[h.D,n.X,o.i],domainName:"framework"})],w)},86758:(e,t,r)=>{r.d(t,{L:()=>c});var s=r(10722),a=r(25029),n=r(95681),i=r(23347);const o={api:{override:!1},nitro:{override:!1}};class c extends((0,n.Q)({storeTypeGuard:e=>!0,storeName:"webServicesSettingsForStaging",storage:{initialValue:o,schemaVersion:1,typeGuard:e=>!0},scope:a.F.Device,persist:!0,isCache:!1,capacity:i.Y._001KB,codec:s.E})){}},10370:(e,t,r)=>{r.d(t,{s:()=>n});var s=r(46041);function a(e){const t=e.length,r=[];for(let a=0;a<t;a+=3)r.push(s.T[e[a]>>2]),r.push(s.T[(3&e[a])<<4|e[a+1]>>4]),r.push(s.T[(15&e[a+1])<<2|e[a+2]>>6]),r.push(s.T[63&e[a+2]]);return r.join("")}function n(e,t=s.V){const r=new Uint8Array(e),n=r.length,i=t%3,o=0===i?t:t+(3-i),c=Math.ceil(n/o);let d="",l=-1;for(;l++<c;){const e=l*o,t=l===c-1?n:(l+1)*o,s=a(r.slice(e,t));d=d.concat(s)}return n%3==2?d.substring(0,d.length-1)+"=":n%3==1?d.substring(0,d.length-2)+"==":d}},89685:(e,t,r)=>{r.d(t,{v:()=>a});const s=Math.pow(2,14)-1;function a(e){const t=new Uint8Array(e),r=t.length;let a="",n=s;for(let e=0;e<r;e+=n){e+n>r&&(n=r-e);const s=t.subarray(e,e+n);a+=String.fromCharCode(...s)}return a}},68376:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(46803);function a(e){const t=new Uint8Array(e),r=[];for(let e=0;e<t.byteLength;e++)r[e>>>2]|=t[e]<<24-e%4*8;return s.lib.WordArray.create(r,t.byteLength)}},76884:(e,t,r)=>{r.d(t,{K:()=>n});const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("").reduce(((e,t,r)=>({...e,[t]:r})),{});function a(e){const t=s[e];if(void 0===t)throw new Error(`Invalid character found: ${e}`);return t}function n(e){const t=e.replaceAll("=","").trim().length;let r=0,s=0,n=0;const i=new Uint8Array(5*t/8|0);for(let o=0;o<t;o++)s=s<<5|a(e[o]),r+=5,r>=8&&(i[n++]=s>>>r-8&255,r-=8);return i.buffer}},7502:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(46041);const a=new Uint8Array(256);for(let e=0;e<s.T.length;e++)a[s.T.charCodeAt(e)]=e;function n(e){let t=.75*e.length;const r=e.length;let s,n,i,o,c,d=0;e.endsWith("=")&&(t--,"="===e[e.length-2]&&t--);const l=new ArrayBuffer(t),u=new Uint8Array(l);for(s=0;s<r;s+=4)n=a[e.charCodeAt(s)],i=a[e.charCodeAt(s+1)],o=a[e.charCodeAt(s+2)],c=a[e.charCodeAt(s+3)],u[d++]=n<<2|i>>4,u[d++]=(15&i)<<4|o>>2,u[d++]=(3&o)<<6|63&c;return l}},60198:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(7502);function a(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,a=t.padEnd(t.length+r,"=");return(0,s.R)(a)}},96303:(e,t,r)=>{function s(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}r.d(t,{k:()=>s})},21131:(e,t,r)=>{r.d(t,{n:()=>i});var s=r(93347),a=r.n(s),n=r(82933);function i(e){const t=new Uint8Array([0,0,0,0]).buffer,r=new Uint8Array(e),s=a().deflate(r,{level:7}).buffer;return(0,n.K)(t,s)}},82933:(e,t,r)=>{function s(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(t);return e.reduce(((e,t)=>(r.set(new Uint8Array(t),e),e+t.byteLength)),0),r.buffer}r.d(t,{K:()=>s})},46041:(e,t,r)=>{r.d(t,{T:()=>a,V:()=>s});const s=Math.pow(10,6),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},58859:(e,t,r)=>{function s(e){return e.replace(/(?:\\[r]|[\r\n]+)+/g,"\n")}r.d(t,{Y:()=>s})},40767:(e,t,r)=>{r.d(t,{p:()=>a});var s=r(76465);function a(e){return(0,s.Jx)(new Uint8Array(e))}},76746:(e,t,r)=>{r.d(t,{d:()=>a});var s=r(76465);function a(e){return(0,s.cv)(e)}},7573:(e,t,r)=>{r.d(t,{i:()=>s});const s=e=>{const t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map((e=>parseInt(e,16)))).buffer:(new Uint8Array).buffer}},97112:(e,t,r)=>{function s(e){const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e)),t}r.d(t,{n:()=>s})},83168:(e,t,r)=>{r.d(t,{B:()=>i});var s=r(3417),a=r.n(s),n=r(54066);function i(e){const{asn1:t,pki:r}=a(),s=r.privateKeyFromPem(e),i=r.privateKeyToAsn1(s),o=r.wrapRsaPrivateKey(i),c=t.toDer(o).getBytes();return(0,n.u)(c)}},4761:(e,t,r)=>{r.d(t,{M:()=>i});var s=r(3417),a=r.n(s),n=r(54066);function i(e){const{asn1:t,pki:r}=a(),s=r.publicKeyFromPem(e),i=r.publicKeyToAsn1(s),o=t.toDer(i).getBytes();return(0,n.u)(o)}},86286:(e,t,r)=>{r.d(t,{R:()=>i});var s=r(3417),a=r.n(s),n=r(58859);function i(e){const{asn1:t,pki:r,util:s}=a(),i=s.createBuffer(e),o=t.fromDer(i),c=r.privateKeyFromAsn1(o),d=r.privateKeyToPem(c);return(0,n.Y)(d)}},9034:(e,t,r)=>{r.d(t,{y:()=>i});var s=r(3417),a=r.n(s),n=r(58859);function i(e){const{asn1:t,pki:r,util:s}=a(),i=s.createBuffer(e),o=t.fromDer(i),c=r.publicKeyFromAsn1(o),d=r.publicKeyToRSAPublicKeyPem(c);return(0,n.Y)(d)}},54066:(e,t,r)=>{function s(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return t}r.d(t,{u:()=>s})},43293:(e,t,r)=>{r.d(t,{N:()=>n});var s=r(30543),a=r(46041);function n(e,t=a.V){const r=e.length;if(0===r)return"";let n="",i=0,o=Math.min(i+t,r);for(;o<=r;){const a=e.charCodeAt(o-1);if(a>=55296&&a<=56319){if(o++,o>r)throw new Error("Invalid string provided to utf8ChunkEncode");continue}const c=e.slice(i,o),d=s.encode(c);if(n=n.concat(d),o===r)break;i=o,o=Math.min(i+t,r)}return n}},69806:(e,t,r)=>{function s(e){const{sigBytes:t,words:r}=e,s=new Uint8Array(t);let a=0,n=0;for(;a!==t;){const e=r[n++];if(s[a++]=(4278190080&e)>>>24,a===t)break;if(s[a++]=(16711680&e)>>>16,a===t)break;if(s[a++]=(65280&e)>>>8,a===t)break;s[a++]=255&e}return s.buffer}r.d(t,{o:()=>s})},84473:(e,t,r)=>{r.d(t,{W:()=>n});var s=r(75994),a=r(92204);class n extends s.X{async fetch(e){const t=(0,a.A)(e);return(await fetch(t)).json()}}},37298:(e,t,r)=>{r.d(t,{j:()=>a});var s=r(58376);class a{constructor(e,t){this.source=e,this.filter=t;let r=[];const a=new Set;this.listener=(e,t)=>{if(!this.filter(e,t))return!1;a.size?a.forEach((r=>r.next([e,t]))):r.push([e,t])},this.events$=new s.y((e=>(a.size||(r.forEach((t=>e.next(t))),r=[]),a.add(e),()=>{a.delete(e)}))),this.source.addListener(this.listener)}stop(){this.source.removeListener(this.listener)}}},28849:(e,t,r)=>{var s;r.d(t,{PortNames:()=>s}),function(e){e.PopupCarbon="Popup",e.PopupCarbonLoader="PopupCarbonLoader",e.OptionsCarbon="OptionsCarbon",e.WebappCarbon="leeloo"}(s||(s={}))},37572:(e,t,r)=>{r.d(t,{P:()=>n,y:()=>a});var s=r(30504);class a extends s.GenericChannel{constructor(){super(...arguments),this.isConnected=!1,this.onMessage=null}connect(e){this.onMessage=t=>{e.receive(t)},this.isConnected=!0,this._connected()}receive(e){this._messageReceived(e)}send(e){if(!this.isConnected)throw new Error("Channel not connected");if(!this.onMessage)throw new Error("onMessage handler not set");this.onMessage(e)}}const n=(e,t)=>{e.connect(t),t.connect(e)}},79952:(e,t,r)=>{r.d(t,{Y:()=>i});var s=r(30504),a=r(37101),n=r(20500);class i extends s.GenericChannel{constructor(e,t=5e3){super(t),this.onConnectListener=e=>{if(e.name.startsWith(this.name)){if(this.currentPorts.has(e.name))throw new Error("Port already connected");if(!(0,a.k)(e))throw new Error("Sender origin not trusted");this.setup(e)}},this.onDisconnectListener=e=>{const t=this.currentPorts.get(e.name);if(t&&(t.onMessage.removeListener(this.onMessageListener),t.onDisconnect.removeListener(this.onDisconnectListener),this.currentPorts.delete(e.name)),this._disconnected(),chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(e)}},this.onMessageListener=e=>{this._messageReceived(e)},this.name=e,this.currentPorts=new Map}listen(){n.b.addListener(this.onConnectListener)}send(e){if(!this.currentPorts.size)throw new Error("No port to send message");this.currentPorts.forEach((t=>t.postMessage(e)))}setup(e){const t=this.currentPorts.get(e.name);t&&(t.disconnect(),this.onDisconnectListener(t)),e.onMessage.addListener(this.onMessageListener),e.onDisconnect.addListener(this.onDisconnectListener),this.currentPorts.set(e.name,e),this._connected()}}},4792:(e,t,r)=>{r.d(t,{s:()=>i});var s=r(30504),a=r(37101),n=r(20500);class i extends s.GenericChannel{constructor(e,t=5e3){super(t),this.onConnectListener=e=>{if(e.name===this.name){if(!(0,a.k)(e))throw new Error("Sender origin not trusted");this.setup(e)}},this.onDisconnectListener=()=>{if(this.port&&(this.port.onMessage.removeListener(this.onMessageListener),this.port.onDisconnect.removeListener(this.onDisconnectListener),this.port=void 0),this._disconnected(),chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(e)}},this.onMessageListener=e=>{this._messageReceived(e)},this.name=e}listen(){this.port&&(this.port.disconnect(),this.onDisconnectListener()),n.b.addListener(this.onConnectListener)}send(e){if(!this.port)throw new Error("No port to send message");this.port.postMessage(e)}setup(e){this.port=e,this.port.onMessage.addListener(this.onMessageListener),this.port.onDisconnect.addListener(this.onDisconnectListener),this._connected()}}},37101:(e,t,r)=>{r.d(t,{k:()=>i});var s=r(92204),a=r(48593);function n(e){const t=function(e){return e.sender?.origin??new URL(e.sender?.url??e.sender?.tab?.url??"").origin}(e);return new URL((0,s.A)("")).origin===t}function i(e){return!!function(e){return(e.sender?.id??"")===(0,a.z)()}(e)||!!n(e)}},64391:(e,t,r)=>{r.d(t,{x:()=>o});var s=r(5900),a=r.n(s),n=r(68376),i=r(69806);function o(e,t){if(self.crypto.subtle)return self.crypto.subtle.digest({name:t},e);if("SHA-1"===t){const t=(0,n.L)(e),r=(0,i.o)(a()(t));return Promise.resolve(r)}return Promise.reject(new Error("Unsupported hash method"))}},13972:(e,t,r)=>{r.d(t,{$:()=>n});var s=r(22609),a=r(83961);async function n(e,t,r){const n=await(0,a.Y)(e);return self.crypto.subtle.decrypt({name:s.z,iv:t},n,r)}},39560:(e,t,r)=>{r.d(t,{G:()=>a});var s=r(83407);async function a(e,t,r){const a={name:s.$k,hash:{name:r}},n=await self.crypto.subtle.importKey("pkcs8",e,a,!1,["decrypt"]);return self.crypto.subtle.decrypt(a,n,t)}},76254:(e,t,r)=>{r.d(t,{f:()=>n});var s=r(35558),a=r.n(s);async function n(e,t,r){const{tCost:n,mCost:i,parallelism:o}=r,{hash:c}=await a().hash({pass:new Uint8Array(e),salt:new Uint8Array(t),time:n,mem:i,hashLen:32,parallelism:o,type:s.ArgonType.Argon2d});return c.buffer}},80954:(e,t,r)=>{r.d(t,{x:()=>a});var s=r(22609);async function a(e,t,r){const a=await self.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),n={name:s.z,length:256},{iterations:i,hashType:o}=r,c={name:"PBKDF2",salt:t,iterations:i,hash:{name:o}},d=await self.crypto.subtle.deriveKey(c,a,n,!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",d)}},48264:(e,t,r)=>{r.d(t,{P:()=>n});var s=r(22609),a=r(83961);async function n(e,t,r){const n=await(0,a.Y)(e);return self.crypto.subtle.encrypt({name:s.z,iv:t},n,r)}},64396:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(83407);async function a(e,t,r){const a={name:s.$k,hash:{name:r}},n=await self.crypto.subtle.importKey("spki",e,a,!1,["encrypt"]);return self.crypto.subtle.encrypt(a,n,t)}},420:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(22609);async function a(){const e=await self.crypto.subtle.generateKey({name:s.z,length:s.N},!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",e)}},26857:(e,t,r)=>{r.d(t,{Y:()=>n});var s=r(83407);const a=new Uint8Array([1,0,1]);async function n(e){const t=await self.crypto.subtle.generateKey({name:s.$k,modulusLength:2048,publicExponent:a,hash:{name:e}},!0,["encrypt","decrypt"]),{privateKey:r,publicKey:n}=t;return{privateKey:await self.crypto.subtle.exportKey("pkcs8",r),publicKey:await self.crypto.subtle.exportKey("spki",n)}}},39911:(e,t,r)=>{function s(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t)}r.d(t,{P:()=>s})},83961:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(22609);function a(e){return self.crypto.subtle.importKey("raw",e,s.z,!1,["encrypt","decrypt"])}},48297:(e,t,r)=>{function s(e,t){return self.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign","verify"])}r.d(t,{r:()=>s})},43838:(e,t,r)=>{r.d(t,{n:()=>n});var s=r(74017),a=r(48297);async function n(e,t,r=s.x){const n=await(0,a.r)(e,r);return self.crypto.subtle.sign({name:"HMAC",hash:{name:r}},n,t)}},39387:(e,t,r)=>{r.d(t,{f:()=>a});var s=r(83407);async function a(e,t,r){const a={name:s.xJ,hash:{name:r}},n=await self.crypto.subtle.importKey("pkcs8",e,a,!1,["sign"]);return self.crypto.subtle.sign(a,n,t)}},396:(e,t,r)=>{r.d(t,{H:()=>o});var s=r(90278),a=r.n(s),n=r(68376),i=r(69806);function o(e){const t=(0,n.L)(e);return(0,i.o)(a()(t))}},57487:(e,t,r)=>{r.d(t,{o:()=>n});var s=r(74017),a=r(48297);async function n(e,t,r,n=s.x){const i=await(0,a.r)(e,n);return self.crypto.subtle.verify({name:"HMAC",hash:{name:n}},i,t,r)}},852:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(83407);async function a(e,t,r,a){const n={name:s.xJ,hash:{name:a}},i=await self.crypto.subtle.importKey("spki",e,n,!1,["verify"]);return self.crypto.subtle.verify(n,i,t,r)}},8434:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(84318);function a(){return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.getManifest&&3===(0,s.W)().manifest_version}},79274:(e,t,r)=>{r.d(t,{m:()=>c});var s=r(46434),a=r(92204);const n="file-download";class i extends s.o{async send(e,t,r){try{if(!("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope))throw new Error("File Download Emitter Channel - Wrong environment. Not in a service worker.");const s=(0,a.A)("").replace(/\/$/,""),i=(await self.clients.matchAll()).find((e=>e.url.includes(s)));i?.postMessage({fileName:e,mimeType:t,fileContent:r,type:n},[r])}catch(e){console.error(e)}}}class o extends s.o{async send(e,t,r){try{if(!chrome?.extension?.getBackgroundPage())throw new Error("Wrong environment. Missing background page.");const s=(0,a.A)("").replace(/\/$/,"");window.postMessage({fileName:e,mimeType:t,fileContent:r,type:n},s,[r])}catch(e){console.error(e)}}}class c{makeFileDownloadEmitterChannel(){if("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope)return new i;if(chrome?.extension?.getBackgroundPage())return new o;throw new Error("unsupported environment. This module should only be used in a service worker or a background page.")}}},83074:(e,t,r)=>{r.d(t,{A:()=>h});var s=r(87065),a=r(93192),n=r(90171),i=r(47968),o=r(37182),c=r(69885),d=r(51992),l=r(73155),u=r(12964),p=r(85260),m=r(87279);class h{constructor(){this.toHttpResult=e=>e instanceof l.a?(0,m.Rn)(e):e.ok?(0,m.Vp)(e):(0,m.Rn)(new l.R(e)),this.toHttpResponse=e=>e instanceof l.a?e:new u.Z({body:e.body,url:e.url,status:e.status,statusText:e.statusText,headers:this.mapToHttpHeaders(e.headers)})}handle(e){const t=this.getTimeout$(e.timeout),r=this.doFetch(e).pipe((0,s.U)(this.toHttpResponse),(0,s.U)(this.toHttpResult));return(0,a.S)(t,r)}getTimeout$(e){return e?(0,n.H)(e).pipe((0,s.U)((()=>(0,m.Rn)(new l.a)))):i.C}doFetch(e){return(0,d.U)(e.url,{method:e.method,body:e.serializeBody(),headers:this.getHeaders(e),credentials:e.withCredentials?"include":"omit",mode:e.mode}).pipe((0,o.K)((e=>{if(!(e instanceof TypeError))throw e;return(0,c.of)(new l.a)})))}mapToHttpHeaders(e){const t=new p.W;return e.forEach(((e,r)=>t.set(r,e))),t}getHeaders(e){return e.headers.keys().reduce(((t,r)=>({...t,[r]:e.headers.get(r)})),{})}}},40532:(e,t,r)=>{r.d(t,{D:()=>n});var s=r(9244),a=r(95237);class n extends a.g{extendServiceWorkerLifetime(){(0,s.t)({"last-heartbeat":(new Date).getTime()})}}},9980:(e,t,r)=>{r.d(t,{D:()=>o});var s=r(30754),a=r(82324),n=r(81805);const i=" ";async function o(){const e=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((e=>async function(e,t){try{const{levelOfControl:t}=await(0,s.U)(e);if("controllable_by_this_extension"!==t&&"controlled_by_this_extension"!==t){const r=[`Impossible to change browser setting: ${e}.`,`Extension prevented from changing: ${t}`].join(i);throw new Error(r)}}catch(t){if((0,a.b)(t))throw new Error(`Browser setting not supported: ${e}`);if((0,a.I)(t))throw t.runtimeError;throw t}try{await(0,n.t)(e,t)}catch(e){throw(0,a.I)(e)?e.runtimeError:e}}(e,!1)));await Promise.allSettled(e)}},26662:(e,t,r)=>{r.d(t,{F:()=>o});var s=r(84318),a=r(16241);const n={beta:"icon_beta_auth",mv2:"icon_auth",nightly:"icon_nightly_auth"},i="icon_not_auth";async function o({isUserAuthenticated:e}){const t=`icons/action/${e?function(){const e=(0,s.W)();return e.name.includes("Nightly")?n.nightly:e.name.includes("Beta")?n.beta:n.mv2}():i}`,r={16:`${t}.png`,32:`${t}@2x.png`};await(0,a.B)(r)}},15348:(e,t,r)=>{r.d(t,{$:()=>i});var s=r(329),a=r(98641);function n(e){return`${"http"+(e.secure?"s":"")}://${e.domain.startsWith(".")?e.domain.substring(1):e.domain}${e.path}`}async function i(e){const t=await(0,s.g)({domain:e});return Promise.all(t.map((e=>(0,a.O)({url:n(e),name:e.name}))))}},65124:(e,t,r)=>{r.d(t,{j:()=>n});var s=r(39680),a=r(41808);async function n(e){if((0,s.G)()){return await(0,s.y)(e)>0}const t=await(0,a.U)(e),r=void 0===t[e],n=null===t[e];return!r&&!n}},81017:(e,t,r)=>{r.d(t,{b:()=>m});var s=r(92204),a=r(24715),n=r(72733),i=r(57306),o=r(31460),c=r(61222);async function d(){const e=await(0,c.I)({}),t=(0,s.A)("");return e.filter((e=>"string"==typeof e.url&&e.url.startsWith(t))).filter((e=>""!==e.url))}const l="index.html";function u(){return`${(0,s.A)("")}${l}`}function p({identifier:e,queryInfo:t,name:r}){const s=u();if(!r)return s;const a=e?`#${r}/${e}`:`#${r}`,n=t?`?${function(e){return Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}(t)}`:"";return encodeURI(`${s}${a}${n}`)}async function m({id:e,query:t,route:r}){const s=p({identifier:e,queryInfo:t,name:r}),c=await d();c.length?await async function({path:e,tabs:t}){const r=await(0,n.T)(),s=function({existingTabs:e,focusedWindow:t}){const r=e.filter((e=>e.active)),s=r.find((e=>e.windowId===t.id)),a=r.pop(),n=e.pop();return s??a??n}({existingTabs:t,focusedWindow:r});if(!s)return;if(s.windowId!==r.id&&(0,i.V)(s.windowId,{focused:!0}),!s.id)return;const a={active:!0,...e===u()?{}:{url:e}};await(0,o.V)(s.id,a)}({path:s,tabs:c}):await async function(e){const t={url:e};await(0,a.U)(t)}(s)}},10026:(e,t,r)=>{r.d(t,{e:()=>b});var s=r(83081),a=r(32012),n=r(58376),i=r(7074),o=r(24966),c=r(85390),d=r(15023),l=r(87065),u=r(26603),p=r(56847),m=r(52477),h=r(15026);function g(e){return JSON.parse(JSON.stringify(e))}class v{constructor(){this.events$=new n.y((e=>{const t=t=>{e.next(t)};return u.r.addListener(t),()=>u.r.removeListener(t)})).pipe((0,i.B)())}}class f{constructor(e,t,r){this.stopped$=new o.X(!1),this.key=t,this.typeGuard=r??(e=>!0);const s=new n.y((r=>{this.getState().then((e=>{r.next(e)}));const s=e.events$.subscribe((e=>{if(t in e){const{newValue:s}=e[t];return r.next(this.asDataWithTimestamp(s))}}));return()=>s.unsubscribe()}));this.state$=(0,c.a)({state:s,isStopped:this.stopped$}).pipe((0,d.o)((({isStopped:e})=>!e),!1),(0,l.U)((({state:e})=>e)))}async update(e){return this.set(e(await this.getState()))}persist(){return Promise.resolve()}load(){return Promise.resolve()}set(e){return(0,p.t)(g({[this.key]:e}))}init(e){return(0,p.t)(g({[this.key]:e}))}clear(){return(0,m.O)(this.key)}clearStorage(){return Promise.resolve()}stop(){this.stopped$.next(!0)}getLimit(){return Promise.resolve(9e6)}async getState(){const e=(await(0,h.U)(this.key))[this.key];return this.asDataWithTimestamp(e)}asDataWithTimestamp(e){return e&&"object"==typeof e&&"timestamp"in e&&"number"==typeof e.timestamp&&e.timestamp&&"data"in e&&this.typeGuard(e.data)?{timestamp:e.timestamp,data:e.data}:{timestamp:void 0}}}class y extends s.G{constructor(){super(...arguments),this.source=new v}createUserScopedInfrastructure(e,t,r,s){const a=`graphene.${e}.${t}.${r}`;return new f(this.source,a,s)}createDeviceScopedInfrastructure(e,t,r){const s=`graphene.${e}.${t}`;return new f(this.source,s,r)}}function b(){return(0,a.G)()?new y:new s.N}},62853:(e,t,r)=>{r.d(t,{e:()=>i});var s=r(41808),a=r(9244),n=r(45441);class i{async getAllKeys(){return Object.keys(await(0,s.U)(null))}async get(e){const t=(await(0,s.U)([e]))[e];if(t){if("string"!=typeof t)throw new Error(`[ChromeLocalStorage] - cannot read content of ${e} properly. Type is\n        ${typeof t} but should be 'string'`);return t}}async set(e,t){await(0,a.t)({[e]:t})}async remove(e){await(0,n.O)([e])}}},3460:(e,t,r)=>{r.d(t,{y:()=>u});var s=r(69594),a=r(58376),n=r(97280),i=r(31034),o=r(18477),c=r(65496);const d="cron-source",l=()=>(0,c.G)()?new a.y((e=>{const t=t=>{t.name===d&&e.next()};return(0,i.U)(d,{delayInMinutes:1,periodInMinutes:1}),o.i.addListener(t),()=>{o.i.removeListener(t)}})):new a.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}));class u extends s.R_{constructor(){super(...arguments),this.alarm$=l().pipe((0,n.d)(1)),this.subscription=this.alarm$.subscribe()}stop(){this.subscription.unsubscribe()}}},66917:(e,t,r)=>{r.d(t,{P:()=>p});var s=r(78776),a=r(24966),n=r(58376),i=r(87065),o=r(45244),c=r(15572),d=r(58649),l=r(20500),u=r(37298);class p{constructor(e){this.connectedChannels$=new a.X({});const t=new n.y((t=>{const r={},n=n=>{const l=(0,s.Z)();if(n.name!==e)return;const p=new u.j({addListener:e=>n.onMessage.addListener(e),removeListener:e=>n.onMessage.removeListener(e)},(t=>(0,o.F)(t)&&t.channelName===e)),m=new Promise((e=>{const t=()=>{n.onDisconnect.removeListener(t),e(null)};n.onDisconnect.addListener(t)})),h=new a.X(c.D.Connected);m.then((()=>{p.stop(),h.next(c.D.Disconnected),delete r[l],t.next(r)}));const g={messages$:p.events$.pipe((0,i.U)((([e])=>e.message))),sendMessage:t=>(n.postMessage((0,o.k)({channelName:e,message:t})),Promise.resolve()),stop:()=>(n.disconnect(),Promise.resolve()),status$:h},v=new d.N(g);r[l]=v,t.next(r)};return l.b.addListener(n),()=>{l.b.removeListener(n)}}));this.subscription=t.subscribe((e=>this.connectedChannels$.next(e)))}stop(){this.subscription.unsubscribe()}}},23711:(e,t,r)=>{r.d(t,{z:()=>n});var s=r(7502),a=r(10370);class n{decode(e){return(0,s.R)(e)}encode(e){return(0,a.s)(e)}}},49499:(e,t,r)=>{function s(...e){const t=[...e].reverse();return{decode:async t=>{for(const r of e)t=await r.decode(t);return t},encode:async e=>{for(const r of t)e=await r.encode(e);return e}}}r.d(t,{x:()=>s})},43702:(e,t,r)=>{r.d(t,{b:()=>s});class s{decode(e){return JSON.parse((new TextDecoder).decode(e))}encode(e){return(new TextEncoder).encode(JSON.stringify(e))}}},10722:(e,t,r)=>{r.d(t,{E:()=>a});const s=e=>e;class a{constructor(){this.encode=s,this.decode=s}}},16698:(e,t,r)=>{r.d(t,{BU:()=>n,No:()=>i,Nw:()=>s,gO:()=>a});const s={algorithm:"aes256",mode:"cbchmac",ivLength:16},a={algorithm:"aes256",mode:"cbchmac64",ivLength:16},n={algorithm:"aes256",mode:"cbchmac",ivLength:16,padding:16,bytesToKey:0,reuseSalt:!1},i={algorithm:"aes256",mode:"cbc",ivLength:16,saltLength:32,padding:0,bytesToKey:{algorithm:"sha1",iterations:3,keyLength:32}}},94805:(e,t,r)=>{r.d(t,{E1:()=>n,Yi:()=>o,b9:()=>c,m9:()=>d,mr:()=>a,oo:()=>i});var s=r(95087);const a={algorithm:"argon2d",saltLength:16,tCost:3,mCost:32768,parallelism:2},n={algorithm:"pbkdf2",saltLength:16,iterations:2e5,hashAlgorithm:"sha256"},i={algorithm:"noderivation"},o={algorithm:"pbkdf2",saltLength:32,iterations:10204,hashAlgorithm:"sha1"};function c(e){return["argon2d","pbkdf2","noderivation"].some((t=>t===e))}function d(e){switch(e.algorithm){case"argon2d":case"pbkdf2":return e.saltLength;case"noderivation":return 0;default:(0,s.U)(e)}}},69591:(e,t,r)=>{r.d(t,{F:()=>s,g:()=>a});const s="$",a=1},33055:(e,t,r)=>{r.d(t,{ARGON2D_MARKER_SCHEMA:()=>s,NODERIVATION_MARKER_SCHEMA:()=>n,PBKDF2_MARKER_SCHEMA:()=>a});const s={count:9,index:{version:0,derivation:1,saltLength:2,tCost:3,mCost:4,parallelism:5,cipher:6,mode:7,ivLength:8}},a={count:8,index:{version:0,derivation:1,saltLength:2,iterations:3,hashAlgorithm:4,cipher:5,mode:6,ivLength:7}},n={count:5,index:{version:0,derivation:1,cipher:2,mode:3,ivLength:4}}},38291:(e,t,r)=>{r.d(t,{PD:()=>s,RB:()=>i,en:()=>a,jK:()=>n});const s="KWC5",a=16,n=32,i=0},6752:(e,t,r)=>{r.d(t,{b:()=>n});var s=r(54066);var a=r(12087);function n(e,t,r,n,i,o){if(0===e.byteLength)throw new Error("Attempting to derivate a key from an empty input");return"pbkdf2"===i.algorithm?(0,a.E)(r,o,i,e,t):async function(e,t,r,a,n){const{tCost:i,mCost:o,parallelism:c}=r,d=(0,s.u)(Object.values(r).join("")),l=t.getCacheKey(a,n,d),u=t.getCachedDerivation(l);if(u)return u;const p={tCost:i,mCost:o,parallelism:c},m=await e(a,n,p);return t.setCachedDerivation({cacheKey:l,data:m}),m}(n,o,i,e,t)}},12087:(e,t,r)=>{r.d(t,{E:()=>n});var s=r(54066),a=r(95087);async function n(e,t,r,n,i){const o=(0,s.u)(Object.values(r).join("")),c=t.getCacheKey(n,i,o),d=t.getCachedDerivation(c);if(d)return d;const l=function(e){switch(e){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:(0,a.U)(e)}}(r.hashAlgorithm),u=await e(n,i,{iterations:r.iterations,hashType:l});return t.setCachedDerivation({cacheKey:c,data:u}),u}},60745:(e,t,r)=>{r.d(t,{F:()=>j,V:()=>M});var s=r(82933),a=r(89685),n=r(95087),i=r(94805);function o({transportableData:e,marker:t,metadata:r}){const s=t.length+r.length;return e.substring(s)}var c=r(54066);function d({encipheredContents:e,marker:t,metadata:r}){const{derivation:s,cipher:a,type:n,version:i}=t,{iv:o,salt:d,signature:l}=r;return{type:n,version:i,derivationConfig:s,cipherConfig:a,salt:(0,c.u)(d),signature:(0,c.u)(l),iv:(0,c.u)(o),encipheredContents:(0,c.u)(e)}}function l({str:e,substr:t,occurrence:r}){if(r<1)return-1;let s=0,a=-1;for(;s<r;){if(a=e.indexOf(t,a+1),a<0)return a;s++}return a}var u=r(69591);function p({transportableData:e,makeMarker:t,schema:r}){const s=r.count+1,a=l({str:e,substr:u.F,occurrence:s}),n=e.substring(1,a).split(u.F);if(n.length!==r.count)throw new Error("Marker and schema length mismatch");return t({bytes:a+1,markerSchema:r,values:n})}var m=r(7165);const h=m.z.object({algorithm:m.z.literal("aes256"),mode:m.z.literal("cbchmac"),ivLength:m.z.literal(16)}),g=m.z.object({algorithm:m.z.literal("aes256"),mode:m.z.literal("cbchmac64"),ivLength:m.z.literal(16)}),v=m.z.union([h,g]),f=m.z.object({algorithm:m.z.literal("argon2d"),saltLength:m.z.literal(16),tCost:m.z.number(),mCost:m.z.number(),parallelism:m.z.number()}),y=m.z.object({algorithm:m.z.literal("pbkdf2"),saltLength:m.z.union([m.z.literal(16),m.z.literal(32)]),iterations:m.z.number(),hashAlgorithm:m.z.enum(["sha1","sha256"])}),b=m.z.object({algorithm:m.z.literal("noderivation")}),_=m.z.literal("flexible"),S=m.z.object({version:m.z.literal(1),type:_,length:m.z.number(),derivation:f,cipher:h});function w({bytes:e,markerSchema:t,values:r}){const{version:s,derivation:a,saltLength:n,tCost:i,mCost:o,parallelism:c,cipher:d,mode:l,ivLength:u}=t.index,p=S.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:r[a],saltLength:Number(r[n]),tCost:Number(r[i]),mCost:Number(r[o]),parallelism:Number(r[c])},cipher:{algorithm:r[d],mode:r[l],ivLength:Number(r[u])}});if(!p.success)throw new Error(p.error.message);return p.data}var E=r(33055);const C=32;function T({transportableData:e,marker:t}){const{length:r,derivation:s,cipher:a}=t,n=s.saltLength,{ivLength:i}=a,o=r+0,c=o+n,d=c+i;return{iv:e.substring(c,c+i),length:n+i+C,salt:e.substring(o,o+n),signature:e.substring(d,d+C)}}const F=m.z.object({version:m.z.literal(1),type:_,length:m.z.number(),derivation:b,cipher:v});function N({bytes:e,markerSchema:t,values:r}){const{version:s,cipher:a,mode:n,ivLength:i}=t.index,o=F.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:"noderivation"},cipher:{algorithm:r[a],mode:r[n],ivLength:Number(r[i])}});if(!o.success)throw new Error(o.error.message);return o.data}function I(){return e=>{const t=p({transportableData:e,makeMarker:N,schema:E.NODERIVATION_MARKER_SCHEMA}),r=function({transportableData:e,marker:t}){const{length:r,cipher:s}=t,{ivLength:a}=s,n=r+0,i=n+a;return{iv:e.substring(n,n+a),length:a+C,signature:e.substring(i,i+C)}}({transportableData:e,marker:t});return function({encipheredContents:e,marker:t,metadata:r}){const{derivation:s,cipher:a,type:n,version:i}=t,{iv:o,signature:d}=r;return{type:n,version:i,derivationConfig:s,cipherConfig:a,signature:(0,c.u)(d),iv:(0,c.u)(o),encipheredContents:(0,c.u)(e)}}({encipheredContents:o({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})}}const U=m.z.object({version:m.z.literal(1),type:_,length:m.z.number(),derivation:y,cipher:h});function P({bytes:e,markerSchema:t,values:r}){const{version:s,derivation:a,saltLength:n,iterations:i,hashAlgorithm:o,cipher:c,mode:d,ivLength:l}=t.index,u=U.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:r[a],saltLength:Number(r[n]),iterations:Number(r[i]),hashAlgorithm:r[o]},cipher:{algorithm:r[c],mode:r[d],ivLength:Number(r[l])}});if(!u.success)throw new Error(u.error.message);return u.data}function A({transportableData:e,index:t}){const r=t+1,s=l({str:e,substr:u.F,occurrence:r}),a=l({str:e,substr:u.F,occurrence:r+1});if(-1===s||-1===a)throw new Error("Marker info indices not found");return e.substring(s+1,a)}const x=0,D=1;function O(e){switch(e){case"argon2d":return e=>{const t=p({transportableData:e,makeMarker:w,schema:E.ARGON2D_MARKER_SCHEMA}),r=T({transportableData:e,marker:t});return d({encipheredContents:o({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"pbkdf2":return e=>{const t=p({transportableData:e,makeMarker:P,schema:E.PBKDF2_MARKER_SCHEMA}),r=T({transportableData:e,marker:t});return d({encipheredContents:o({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"noderivation":return I();default:(0,n.U)(e)}}var k=r(6424),R=r(58396),L=r(6752);async function M(e,t,r,n){const o=function(e){const t=(0,a.v)(e),r=A({transportableData:t,index:x});if(Number(r)!==u.g)throw new Error("Marker version not supported");const s=A({transportableData:t,index:D});if(!(0,i.b9)(s))throw new Error("Derivation algorithm not supported");return O(s)(t)}(n),{deriveKeyArgon2d:c,deriveKeyPbkdf2:d}=t,{derivationConfig:l,salt:p}=o,{algorithm:m}=l,h="pbkdf2"===m||"argon2d"===m;if(h&&!p)throw new Error("Need salt for derivation");const g=h&&p?await(0,L.b)(e,p,d,c,l,r):e,{mode:v}=o.cipherConfig,{computeHash:f}=t,{encryptionKey:y,signatureKey:b}="cbchmac64"===v?await(0,R.U)(g):await(0,k.Y)(g,f),{iv:_,encipheredContents:S}=o,w=(0,s.K)(_,S),{signature:E}=o;return{signatureKey:b,signature:E,dataToSign:w,encryptionKey:y,iv:_,encipheredContents:S}}async function j(e,t,r,s){const{verifyHmacSha:a}=t,{signatureKey:n,signature:i,dataToSign:o,encryptionKey:c,iv:d,encipheredContents:l}=await M(e,t,r,s);if(!await a(n,i,o))throw new Error("Signature cannot be verified");const{decryptAes256:u}=t;return u(c,d,l)}},7449:(e,t,r)=>{r.d(t,{I:()=>l});var s=r(82933),a=r(94805),n=r(16698),i=r(38291);const o={type:"KWC5",derivation:a.oo,cipher:n.BU};function c(e){const t=function({transportableData:e,marker:t}){const{cipher:r,type:s}=t,{ivLength:a}=r,n=i.RB+a+i.en+s.length,o=n+i.jK;return{iv:e.slice(i.RB,i.RB+a),signature:e.slice(n,n+i.jK),encipheredContents:e.slice(o)}}({transportableData:e,marker:o});return{iv:t.iv,type:i.PD,signature:t.signature,encipheredContents:t.encipheredContents,derivationConfig:a.oo,cipherConfig:n.BU}}var d=r(6424);async function l(e,t,r){const a=c(r),{computeHash:n}=t,{encryptionKey:i,signatureKey:o}=await(0,d.Y)(e,n),{iv:l,encipheredContents:u}=a,p=(0,s.K)(l,u),{verifyHmacSha:m}=t,{signature:h}=a;if(!await m(o,h,p))throw new Error("Signature cannot be verified");const{decryptAes256:g}=t;return g(i,l,u)}},58396:(e,t,r)=>{function s(e){const t=new Uint8Array(e),r=e.byteLength/2,s=t.slice(0,r),a=t.slice(r);return Promise.resolve({encryptionKey:s.buffer,signatureKey:a.buffer})}r.d(t,{U:()=>s})},6424:(e,t,r)=>{r.d(t,{Y:()=>a});const s="SHA-512";async function a(e,t){const r=await t(e,s),a=new Uint8Array(r),n=r.byteLength/2,i=a.slice(0,n),o=a.slice(n,r.byteLength);return{encryptionKey:i.buffer,signatureKey:o.buffer}}},22609:(e,t,r)=>{r.d(t,{N:()=>a,z:()=>s});const s="AES-CBC",a=256},74017:(e,t,r)=>{r.d(t,{x:()=>s});const s="SHA-256"},83407:(e,t,r)=>{r.d(t,{$k:()=>s,Tt:()=>n,xJ:()=>a});const s="RSA-OAEP",a="RSASSA-PKCS1-v1_5",n="SHA-256"},22253:(e,t,r)=>{r.d(t,{j:()=>s});class s{}},85260:(e,t,r)=>{var s;r.d(t,{W:()=>a}),function(e){e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE",e[e.DELETE_MULTIPLE=3]="DELETE_MULTIPLE"}(s||(s={}));class a{constructor(e){this.headers=new Map,this.normalizedNames=new Map,"string"==typeof e?this.initFromString(e):e&&this.initFromObject(e)}has(e){return this.headers.has(e.toLowerCase())}get(e){const t=this.headers.get(e.toLowerCase());return t?.[0]??null}keys(){return Array.from(this.normalizedNames.values())}getAll(e){return this.headers.get(e.toLowerCase())??null}append(e,t){return this.clone({name:e,value:t,op:s.APPEND})}set(e,t){return this.clone({name:e,value:t,op:s.SET})}delete(e,t){return this.clone({name:e,value:t,op:s.DELETE})}deleteMultiple(e){return this.clone({names:e,op:s.DELETE_MULTIPLE})}toObject(){return Object.fromEntries(this.headers)}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}clone(e){const t=new a;return t.initFromOther(this),t.applyUpdate(e),t}applyUpdate(e){switch(e.op){case s.APPEND:case s.SET:{const t=e.name.toLowerCase();let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const a=(e.op===s.APPEND?this.headers.get(t):void 0)??[];a.push(...r),this.headers.set(t,a)}break;case s.DELETE:{const t=e.name.toLowerCase(),r=e.value;if(r){let e=this.headers.get(t);if(!e)return;const s=Array.isArray(r)?r:[r];e=e.filter((e=>!s.includes(e))),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}break;case s.DELETE_MULTIPLE:e.names.forEach((e=>{const t=e.toLowerCase();this.headers.delete(t),this.normalizedNames.delete(t)}))}}initFromOther(e){Array.from(e.headers.keys()).forEach((t=>{this.headers.set(t,[...e.headers.get(t)]),this.normalizedNames.set(t,e.normalizedNames.get(t))}))}initFromObject(e){Object.keys(e).forEach((t=>{let r=e[t];const s=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(s,r),this.maybeSetNormalizedName(t,s))}))}initFromString(e){e.split("\n").forEach((e=>{const t=e.indexOf(":");if(t>0){const r=e.slice(0,t),s=r.toLowerCase(),a=e.slice(t+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(a):this.headers.set(s,[a])}}))}}},61223:(e,t,r)=>{r.d(t,{L:()=>n});class s{encodeKey(e){return this.standardEncoding(e)}encodeValue(e){return this.standardEncoding(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}standardEncoding(e){return encodeURIComponent(e).replace(s.STANDARD_ENCODING_REGEX,((e,t)=>s.STANDARD_ENCODING_REPLACEMENTS[t]??e))}}var a;s.STANDARD_ENCODING_REGEX=/%(\d[a-f0-9])/gi,s.STANDARD_ENCODING_REPLACEMENTS={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"},function(e){e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE"}(a||(a={}));class n{constructor(e={},t={}){this.map=new Map,this.encoder=t.encoder??new s,"string"==typeof e?this.initFromString(e):this.initFromObject(e)}has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?.[0]??null}getAll(e){return this.map.get(e)??null}keys(){return Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:a.APPEND})}appendAll(e){const t=[];return Object.keys(e).forEach((r=>{const s=e[r];Array.isArray(s)?s.forEach((e=>{t.push({param:r,value:e,op:a.APPEND})})):t.push({param:r,value:s,op:a.APPEND})})),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:a.SET})}delete(e,t){return this.clone({param:e,value:t,op:a.DELETE})}toString(){return this.keys().map((e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map((e=>t+"="+this.encoder.encodeValue(e))).join("&")})).filter((e=>""!==e)).join("&")}clone(e){const t=new n({},{encoder:this.encoder});return t.initFromOther(this),t.applyUpdates(Array.isArray(e)?e:[e]),t}initFromOther(e){e.keys().forEach((t=>this.map.set(t,[...e.map.get(t)])))}initFromObject(e){Object.keys(e).forEach((t=>{const r=e[t],s=n.isValueArray(r)?r.map(n.valueToString):[n.valueToString(r)];this.map.set(t,s)}))}initFromString(e){const{encoder:t}=this;if(e.length>0){e.replace(/^\?/,"").split("&").forEach((e=>{const r=e.indexOf("="),[s,a]=-1===r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],n=this.map.get(s)??[];n.push(a),this.map.set(s,n)}))}}applyUpdates(e){e.forEach((e=>{switch(e.op){case a.APPEND:case a.SET:{const t=(e.op===a.APPEND?this.map.get(e.param):void 0)??[];t.push(n.valueToString(e.value)),this.map.set(e.param,t);break}case a.DELETE:if(void 0===e.value){this.map.delete(e.param);break}{const t=this.map.get(e.param)??[],r=t.indexOf(n.valueToString(e.value));-1!==r&&t.splice(r,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}))}static valueToString(e){return`${e}`}static isValueArray(e){return Array.isArray(e)}}},4043:(e,t,r)=>{r.d(t,{a:()=>n});var s=r(85260),a=r(61223);class n{constructor(e,t,r,i){this.body=null,this.headers=new s.W,this.withCredentials=!1,this.timeout=6e4,this.responseType="json",this.params=new a.L({}),this.url=t,this.method=e,n.mightHaveBody(this.method)&&(this.body=r??null),i&&(this.withCredentials=Boolean(i.withCredentials),i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=this.getHeadersFromOptions(i.headers)),i.params&&(this.params=this.getParamsFromOptions(i.params)),i.timeout&&i.timeout>0&&(this.timeout=i.timeout),i.mode&&(this.mode=i.mode)),this.urlWithParams=this.initUrlWithParams()}serializeBody(){return null===this.body?null:n.isArrayBuffer(this.body)||"string"==typeof this.body?this.body:this.body instanceof a.L?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||n.isArrayBuffer(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof a.L?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method??this.method,r=e.url??this.url,s=e.responseType??this.responseType,a=void 0!==e.body?e.body:this.body,i=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,o=void 0!==e.timeout?e.timeout:this.timeout,c=e.mode??this.mode;let d=e.headers?this.getHeadersFromOptions(e.headers):this.headers,l=e.params?this.getParamsFromOptions(e.params):this.params;const u=e.setHeaders;u&&(d=Object.keys(u).reduce(((e,t)=>e.set(t,u[t])),d));const p=e.setParams;return p&&(l=Object.keys(p).reduce(((e,t)=>e.set(t,p[t])),l)),new n(t,r,a,{params:l,headers:d,responseType:s,withCredentials:i,timeout:o,mode:c})}getHeadersFromOptions(e){return e instanceof s.W?e:new s.W(e)}getParamsFromOptions(e){return e instanceof a.L?e:new a.L(e)}initUrlWithParams(){const e=this.params.toString();if(0===e.length)return this.url;const t=this.url.indexOf("?"),r=-1===t?"?":t<this.url.length-1?"&":"";return this.url+r+e}static mightHaveBody(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":return!1;default:return!0}}static isArrayBuffer(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}}},12964:(e,t,r)=>{r.d(t,{Z:()=>c});var s=r(91174),a=r(85260),n=r(25994);async function i(e){const t=e.getReader();let r=new Uint8Array(0),s=await t.read();for(;!s.done;){const e=new Uint8Array(r.byteLength+s.value.byteLength);e.set(r,0),e.set(s.value,r.byteLength),r=e,s=await t.read()}return r}class o{constructor(e){this.bytesRead=0,this.data=e}pull(e){const{bytesRead:t,data:r}=this;if(t>=r.byteLength)return void e.close();const s=Math.min(r.byteLength-t,e.desiredSize??1/0);if(s>0){const a=new Uint8Array(r,t,s);e.enqueue(a),this.bytesRead+=s}t>=r.byteLength&&e.close()}}class c{constructor(e={},t=n.W.Ok,r="OK"){this.headers=e.headers instanceof a.W?e.headers:new a.W(e.headers),this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText??r,this.url=e.url??null,this.ok=this.status>=200&&this.status<300,this.body=void 0!==e.body?e.body:null}clone(e={}){return new c({body:void 0!==e.body?e.body:null===this.body?null:this.body instanceof s.Pz?this.body.tee()[0]:this.body,headers:e.headers??this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText??this.statusText,url:e.url??this.url??void 0})}isBodyReadableStream(){return!!this.body&&"object"==typeof this.body&&"ReadableStream"===this.body.constructor.name}async arrayBuffer(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){return(await i(this.body)).buffer}if(!(this.body instanceof ArrayBuffer))throw new Error("Unexpected body type, not an ArrayBuffer");return this.body}async text(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const e=await i(this.body);return(new TextDecoder).decode(e.buffer)}if("string"!=typeof this.body)throw new Error("Unexpected body type, not a string");return this.body}async json(e){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const t=await i(this.body),r=(new TextDecoder).decode(t.buffer);try{const t=JSON.parse(r);return e.decode(t)}catch(e){throw new Error("Failed to parse response body JSON")}}if(this.body instanceof ArrayBuffer||"string"==typeof this.body)throw new Error("Unexpected body type");return e.decode(this.body)}bodyStream(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name)return this.body;const e=new TextEncoder;if("string"==typeof this.body)return new s.Pz(new o(e.encode(this.body).buffer));if(this.body instanceof ArrayBuffer)return new s.Pz(new o(this.body));const t=JSON.stringify(this.body);return new s.Pz(new o(e.encode(t).buffer))}}},25994:(e,t,r)=>{var s;r.d(t,{W:()=>s}),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(s||(s={}))},73155:(e,t,r)=>{r.d(t,{R:()=>a,a:()=>n});var s=r(96168);class a extends((0,s.Hu)("BadStatus","The HTTP response has a non-successful status code (not 2XX)")){constructor(e){super(),this.response=e}}class n extends((0,s.Hu)("FetchFailedError","Something happened while communicating to the server")){}},10493:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toFunctionalErrorCode=t.isFunctionalErrorOfType=t.FunctionalError=t.defineFunctionalError=void 0;t.defineFunctionalError=(e,t="")=>()=>({tag:e,message:t});t.FunctionalError=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}},t.isFunctionalErrorOfType=function(e,t){return t.includes(e.tag)};t.toFunctionalErrorCode=e=>e.tag},6689:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.panic=t.toFunctionalErrorCode=t.isFunctionalErrorOfType=t.FunctionalError=t.defineFunctionalError=void 0;var s=r(10493);Object.defineProperty(t,"defineFunctionalError",{enumerable:!0,get:function(){return s.defineFunctionalError}}),Object.defineProperty(t,"FunctionalError",{enumerable:!0,get:function(){return s.FunctionalError}}),Object.defineProperty(t,"isFunctionalErrorOfType",{enumerable:!0,get:function(){return s.isFunctionalErrorOfType}}),Object.defineProperty(t,"toFunctionalErrorCode",{enumerable:!0,get:function(){return s.toFunctionalErrorCode}});var a=r(85400);Object.defineProperty(t,"panic",{enumerable:!0,get:function(){return a.panic}})},85400:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.panic=void 0,t.panic=function(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}},45051:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(6689),t),a(r(73637),t),a(r(40965),t)},78057:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.assertUnreachable=void 0,t.assertUnreachable=function(e,t){throw new Error(t??`Unreachable code detected (${e})`)}},73637:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.matchMap=t.switchMatchResult=t.switchMapSuccess=t.switchMapFailure=t.matchResultObservable=t.mapSuccessResultObservable=t.mapResultObservable=t.mapSuccessObservable=t.mapFailureObservable=t.concatMatchResult=t.concatMapSuccess=t.concatMapFailure=t.isResult=t.matchResult=t.mapSuccess=t.mapFailure=t.success=t.getSuccess=t.getFailure=t.failure=t.isSuccess=t.isFailure=t.isMatchable=t.match=t.createMatchable=t.assertUnreachable=void 0;var s=r(78057);Object.defineProperty(t,"assertUnreachable",{enumerable:!0,get:function(){return s.assertUnreachable}});var a=r(13757);Object.defineProperty(t,"createMatchable",{enumerable:!0,get:function(){return a.createMatchable}}),Object.defineProperty(t,"match",{enumerable:!0,get:function(){return a.match}}),Object.defineProperty(t,"isMatchable",{enumerable:!0,get:function(){return a.isMatchable}});var n=r(4964);Object.defineProperty(t,"isFailure",{enumerable:!0,get:function(){return n.isFailure}}),Object.defineProperty(t,"isSuccess",{enumerable:!0,get:function(){return n.isSuccess}}),Object.defineProperty(t,"failure",{enumerable:!0,get:function(){return n.failure}}),Object.defineProperty(t,"getFailure",{enumerable:!0,get:function(){return n.getFailure}}),Object.defineProperty(t,"getSuccess",{enumerable:!0,get:function(){return n.getSuccess}}),Object.defineProperty(t,"success",{enumerable:!0,get:function(){return n.success}}),Object.defineProperty(t,"mapFailure",{enumerable:!0,get:function(){return n.mapFailure}}),Object.defineProperty(t,"mapSuccess",{enumerable:!0,get:function(){return n.mapSuccess}}),Object.defineProperty(t,"matchResult",{enumerable:!0,get:function(){return n.matchResult}}),Object.defineProperty(t,"isResult",{enumerable:!0,get:function(){return n.isResult}});var i=r(26047);Object.defineProperty(t,"concatMapFailure",{enumerable:!0,get:function(){return i.concatMapFailure}}),Object.defineProperty(t,"concatMapSuccess",{enumerable:!0,get:function(){return i.concatMapSuccess}}),Object.defineProperty(t,"concatMatchResult",{enumerable:!0,get:function(){return i.concatMatchResult}}),Object.defineProperty(t,"mapFailureObservable",{enumerable:!0,get:function(){return i.mapFailureObservable}}),Object.defineProperty(t,"mapSuccessObservable",{enumerable:!0,get:function(){return i.mapSuccessObservable}}),Object.defineProperty(t,"mapResultObservable",{enumerable:!0,get:function(){return i.mapResultObservable}}),Object.defineProperty(t,"mapSuccessResultObservable",{enumerable:!0,get:function(){return i.mapSuccessResultObservable}}),Object.defineProperty(t,"matchResultObservable",{enumerable:!0,get:function(){return i.matchResultObservable}}),Object.defineProperty(t,"switchMapFailure",{enumerable:!0,get:function(){return i.switchMapFailure}}),Object.defineProperty(t,"switchMapSuccess",{enumerable:!0,get:function(){return i.switchMapSuccess}}),Object.defineProperty(t,"switchMatchResult",{enumerable:!0,get:function(){return i.switchMatchResult}});var o=r(79020);Object.defineProperty(t,"matchMap",{enumerable:!0,get:function(){return o.matchMap}})},79020:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.matchMap=void 0;t.matchMap=(e,t)=>t[e]()},13757:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMatchable=t.match=t.createMatchable=void 0;t.createMatchable=(e,t)=>({tag:e,...t});t.match=(e,t)=>{const r=e.tag,s=r in t?t[r]:null;if(!s)throw new Error("Unmatchable case");return s(e)};t.isMatchable=(e,...t)=>{if("object"!=typeof e||!e)return!1;return"tag"in e&&t.includes(e.tag)}},26047:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.switchMatchResult=t.switchMapFailure=t.switchMapSuccess=t.concatMatchResult=t.concatMapFailure=t.concatMapSuccess=t.mapSuccessResultObservable=t.mapResultObservable=t.mapFailureObservable=t.mapSuccessObservable=t.matchResultObservable=void 0;const s=r(18948),a=r(4964),n=r(13757);t.matchResultObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,n.match)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))},t.mapSuccessObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,a.isFailure)(t)?t:(0,a.success)(e(t.data)))))},t.mapFailureObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,a.isSuccess)(t)?t:(0,a.failure)(e(t.error)))))},t.mapResultObservable=function(e,t){return r=>r.pipe((0,s.map)((r=>(0,a.isFailure)(r)?t?t(r.error):r:e(r.data))))},t.mapSuccessResultObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,a.isFailure)(t)?t:e(t.data))))},t.concatMapSuccess=function(e){return t=>t.pipe((0,s.concatMap)((async t=>(0,a.isFailure)(t)?t:(0,a.success)(await e(t.data)))))},t.concatMapFailure=function(e){return t=>t.pipe((0,s.concatMap)((async t=>(0,a.isSuccess)(t)?t:(0,a.failure)(await e(t.error)))))},t.concatMatchResult=function(e){return t=>t.pipe((0,s.concatMap)((t=>(0,a.matchResult)(t,e))))},t.switchMapSuccess=function(e){return t=>t.pipe((0,s.switchMap)((async t=>(0,a.isFailure)(t)?t:(0,a.success)(await e(t.data)))))},t.switchMapFailure=function(e){return t=>t.pipe((0,s.switchMap)((async t=>(0,a.isSuccess)(t)?t:(0,a.failure)(await e(t.error)))))},t.switchMatchResult=function(e){return t=>t.pipe((0,s.switchMap)((t=>(0,a.matchResult)(t,e))))}},4964:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapFailure=t.mapSuccess=t.getFailure=t.getSuccess=t.isResult=t.isFailure=t.isSuccess=t.matchResult=t.failure=t.success=void 0;const s=r(13757),a=r(38307);t.success=e=>(0,s.createMatchable)("success",{data:e});t.failure=e=>(0,s.createMatchable)("failure",{error:e});t.matchResult=(e,t)=>(0,s.match)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)});t.isSuccess=e=>e.tag===a.SuccessTag;t.isFailure=e=>e.tag===a.FailureTag;t.isResult=e=>(0,s.isMatchable)(e,a.SuccessTag,a.FailureTag);t.getSuccess=e=>e.data;t.getFailure=e=>e.error;t.mapSuccess=(e,r)=>(0,t.isFailure)(e)?e:(0,t.success)(r(e.data));t.mapFailure=(e,r)=>(0,t.isSuccess)(e)?e:(0,t.failure)(r(e.error))},38307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FailureTag=t.SuccessTag=void 0,t.SuccessTag="success",t.FailureTag="failure"},40965:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),a(r(97622),t)},97622:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasProperty=t.safeCast=t.getBrander=void 0;t.getBrander=e=>t=>Object.assign(t,{brand:e});t.safeCast=e=>e,t.hasProperty=function(e,t){return t in e}},96168:(e,t,r)=>{r.d(t,{Hu:()=>a,Vj:()=>s});const s=(e,t="")=>()=>({tag:e,message:t}),a=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}}},20195:(e,t,r)=>{function s(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}r.d(t,{j:()=>s})},95087:(e,t,r)=>{function s(e,t){throw new Error(t??`Unreachable code detected (${e})`)}r.d(t,{U:()=>s})},25535:(e,t,r)=>{r.d(t,{G:()=>s});const s=(e,t)=>t[e]()},18533:(e,t,r)=>{r.d(t,{EQ:()=>a,H6:()=>s,cw:()=>n});const s=(e,t)=>({tag:e,...t}),a=(e,t)=>{const r=e.tag,s=r in t?t[r]:null;if(!s)throw new Error("Unmatchable case");return s(e)},n=(e,...t)=>{if("object"!=typeof e||!e)return!1;return"tag"in e&&t.includes(e.tag)}},48844:(e,t,r)=>{r.d(t,{DZ:()=>d,Gx:()=>u,Qn:()=>c,RW:()=>p,lk:()=>l,nb:()=>o});var s=r(87065),a=r(34987),n=r(87279),i=r(18533);function o(e){return t=>t.pipe((0,s.U)((t=>(0,i.EQ)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))}function c(e){return t=>t.pipe((0,s.U)((t=>(0,n.hx)(t)?t:(0,n.Vp)(e(t.data)))))}function d(e){return t=>t.pipe((0,s.U)((t=>(0,n.d6)(t)?t:(0,n.Rn)(e(t.error)))))}function l(e){return t=>t.pipe((0,s.U)((t=>(0,n.hx)(t)?t:e(t.data))))}function u(e){return t=>t.pipe((0,a.b)((async t=>(0,n.hx)(t)?t:(0,n.Vp)(await e(t.data)))))}function p(e){return t=>t.pipe((0,a.b)((t=>(0,n.f2)(t,e))))}},87279:(e,t,r)=>{r.d(t,{Rn:()=>o,Yv:()=>m,db:()=>p,hx:()=>l,AZ:()=>u,d6:()=>d,ty:()=>h,f2:()=>c,Vp:()=>i});var s=r(18533);const a="success",n="failure",i=e=>(0,s.H6)("success",{data:e}),o=e=>(0,s.H6)("failure",{error:e}),c=(e,t)=>(0,s.EQ)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)}),d=e=>e.tag===a,l=e=>e.tag===n,u=e=>(0,s.cw)(e,a,n),p=e=>e.data,m=e=>e.error,h=(e,t)=>l(e)?e:i(t(e.data))},28489:(e,t,r)=>{r.d(t,{Ay:()=>s,l$:()=>a});const s=e=>e;function a(e,t){return t in e}},58605:(e,t,r)=>{r.d(t,{$:()=>a});var s=r(96168);class a extends((0,s.Hu)("UserIsNotAdmin","User is not an admin")){}},11512:(e,t,r)=>{r.d(t,{t:()=>o});var s=r(86952),a=r(85187),n=r(71379),i=r(43613);const o=(0,s.Q)({name:"inviteLink",commands:{toggleInviteLink:a.s,requestUserInviteTokenSending:n.T},events:{},queries:{inviteLinkData:i.$}})},71379:(e,t,r)=>{r.d(t,{T:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},85187:(e,t,r)=>{r.d(t,{s:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},43613:(e,t,r)=>{r.d(t,{$:()=>i,D:()=>s});var s,a=r(99059),n=r(25029);!function(e){e.NOT_LOADED="not_loaded",e.NOT_CREATED="not_created",e.READY="ready"}(s||(s={}));class i extends((0,a.k)({scope:n.F.User})){}},58164:(e,t,r)=>{r.d(t,{t:()=>F});var s=r(86952),a=r(96209),n=r(36486),i=r(93595),o=r(23578),c=r(14485),d=r(61358),l=r(81940),u=r(4093),p=r(69877),m=r(56859),h=r(56276),g=r(59875),v=r(54860),f=r(92179),y=r(91206),b=r(66385),_=r(16883),S=r(75178),w=r(74629),E=r(31432),C=r(75008),T=r(97786);const F=(0,s.Q)({name:"teamAdminNotifications",commands:{markActivityLogsInfoboxSeen:a.o,markB2BPlanDiscontinuedSeen:n.q,markIdPFailedNotificationSeen:i.b,markIdPNeedsSeatsInfoboxSeen:o.k,markIdPNeedsSeatsInfoboxInPopupSeen:c.N,markIdPProvisioningsPendingInfoboxSeen:d.r,markNewRestrictSharingPolicySeen:l.o,markNotificationTrialExtendedSeen:u.D,markOfferToExtendFreeTrialSeen:p.R,markStarterRepackagePolicyInfoboxSeen:m.z},events:{},queries:{getIdPFailedProvisioningsData:h.It,getIdPFixedProvisioningsData:g.Un,hasSeenActivityLogsInfobox:v.g,hasSeenB2BPlanDiscontinued:f.z,hasSeenIdPFailedNotification:y.g,hasSeenIdPNeedsSeatsInfoboxInPopup:b.k,hasSeenIdPNeedsSeatsInfobox:_.T,hasSeenIdPProvisioningsPendingInfobox:S.S,hasSeenNewRestrictSharingPolicy:w.x,hasSeenNotificationTrialExtended:E.q,hasSeenOfferToExtendFreeTrial:C.U,HasSeenStarterRepackagePolicyInfobox:T.i}})},96209:(e,t,r)=>{r.d(t,{o:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},36486:(e,t,r)=>{r.d(t,{q:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},93595:(e,t,r)=>{r.d(t,{b:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},14485:(e,t,r)=>{r.d(t,{N:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},23578:(e,t,r)=>{r.d(t,{k:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},61358:(e,t,r)=>{r.d(t,{r:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},81940:(e,t,r)=>{r.d(t,{o:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},4093:(e,t,r)=>{r.d(t,{D:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},69877:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},56859:(e,t,r)=>{r.d(t,{z:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},56276:(e,t,r)=>{r.d(t,{C$:()=>s,It:()=>c,qj:()=>o});var s,a=r(99059),n=r(25029),i=r(96168);!function(e){e.NOT_ADMIN="not_admin",e.SERVER_ERROR="server_error"}(s||(s={}));const o=(0,i.Vj)("not_admin","User is not an admin");(0,i.Vj)("server_error","Server error while retrieving IdP Notifications data");class c extends((0,a.k)({scope:n.F.User})){}},59875:(e,t,r)=>{r.d(t,{Go:()=>o,Un:()=>c});var s,a=r(99059),n=r(25029),i=r(96168);!function(e){e.NOT_ADMIN="not_admin",e.SERVER_ERROR="server_error"}(s||(s={}));const o=(0,i.Vj)("not_admin","User is not an admin");(0,i.Vj)("server_error","Server error while retrieving IdP Notifications data");class c extends((0,a.k)({scope:n.F.User})){}},54860:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(99059);class a extends((0,s.k)()){}},92179:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(99059);class a extends((0,s.k)()){}},91206:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(99059);class a extends((0,s.k)()){}},66385:(e,t,r)=>{r.d(t,{k:()=>a});var s=r(99059);class a extends((0,s.k)()){}},16883:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(99059);class a extends((0,s.k)()){}},75178:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(99059);class a extends((0,s.k)()){}},74629:(e,t,r)=>{r.d(t,{x:()=>a});var s=r(99059);class a extends((0,s.k)()){}},31432:(e,t,r)=>{r.d(t,{q:()=>a});var s=r(99059);class a extends((0,s.k)()){}},75008:(e,t,r)=>{r.d(t,{U:()=>a});var s=r(99059);class a extends((0,s.k)()){}},97786:(e,t,r)=>{r.d(t,{i:()=>a});var s=r(99059);class a extends((0,s.k)()){}},72788:(e,t,r)=>{r.d(t,{L:()=>u});var s=r(86952),a=r(16396),n=r(37043),i=r(67267),o=r(35468),c=r(73895),d=r(22099),l=r(59509);const u=(0,s.Q)({name:"teamMembers",commands:{proposeMembers:a.og,dismissNonMembersInfobox:n.Y},events:{membersAdded:i.q},queries:{getNonMembersCount:o.H,getNonMembersList:c.Fz,getHasAdminDismissedInfobox:d.K,getMembersList:l.k}})},37043:(e,t,r)=>{r.d(t,{Y:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},16396:(e,t,r)=>{r.d(t,{Wv:()=>h,og:()=>g});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.InvalidOrigin="InvalidOrigin",e.NoFreeSlot="NoFreeSlot",e.NoFreeSlotFreePlan="NoFreeSlotFreePlan",e.UserTeamInviteTokenNotFound="UserTeamInviteTokenNotFound",e.PaymentFailed="PaymentFailed",e.NotBillingAdmin="NotBillingAdmin",e.CannotAddSeatDuringGracePeriod="CannotAddSeatDuringGracePeriod"}(s||(s={}));class o extends((0,i.Hu)("InvalidOrigin","Invalid origin")){}class c extends((0,i.Hu)("NoFreeSlot","No free slot")){}class d extends((0,i.Hu)("NoFreeSlotFreePlan","No free slot in free plan")){}class l extends((0,i.Hu)("UserTeamInviteTokenNotFound","No invite token to a team available for user")){}class u extends((0,i.Hu)("PaymentFailed","Payment failed")){}class p extends((0,i.Hu)("NotBillingAdmin","User is not the billing admin")){}class m extends((0,i.Hu)("CannotAddSeatDuringGracePeriod","Seats cannot be added during grace period")){}function h(e){switch(e){case"invalid_origin":return new o;case"no_free_slot":return new c;case"no_free_slot_free_plan":return new d;case"USER_TEAM_INVITE_TOKEN_NOT_FOUND":return new l;case"payment_failed":return new u;case"not_billing_admin":return new p;case"cannot_add_seat_during_grace_period":return new m;default:throw new Error("Unknown server error")}}class g extends((0,a.g)({scope:n.F.User})){}},67267:(e,t,r)=>{r.d(t,{q:()=>n});var s=r(88885),a=r(25029);class n extends((0,s.d)({scope:a.F.User})){}},22099:(e,t,r)=>{r.d(t,{K:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},59509:(e,t,r)=>{r.d(t,{k:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},35468:(e,t,r)=>{r.d(t,{H:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},73895:(e,t,r)=>{r.d(t,{Fz:()=>c,R0:()=>i,RD:()=>o});var s=r(7165),a=r(99059),n=r(25029);const i=s.z.object({userId:s.z.number(),login:s.z.string(),premiumStatus:s.z.enum(["free","subscribed","legacy"]),lastActivityDateUnix:s.z.number(),proposedState:s.z.enum(["proposed","not_in_team","in_team","revoked"])}),o=s.z.array(i);class c extends((0,a.k)({scope:n.F.User})){}},35475:(e,t,r)=>{r.d(t,{B:()=>n});var s=r(86952),a=r(58089);const n=(0,s.Q)({name:"teamPasswordHealth",commands:{},events:{},queries:{getReport:a.z}})},58089:(e,t,r)=>{r.d(t,{z:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},48666:(e,t,r)=>{r.d(t,{o:()=>F});var s=r(86952),a=r(36833),n=r(30561),i=r(52966),o=r(45364),c=r(8025),d=r(3434),l=r(29151),u=r(49649),p=r(31933),m=r(93478),h=r(47883),g=r(8365),v=r(14784),f=r(44096),y=r(22283),b=r(88273),_=r(51183),S=r(3463),w=r(20270),E=r(621),C=r(22681),T=r(10729);const F=(0,s.Q)({name:"teamPlanDetails",commands:{addSeats:a.E,extendFreeTrial:n.No,requestTeamPlanCancellation:i.y7,editTeamName:o.Q2,editTeamPolicies:c.m,sendFeedback:d.cr},events:{},queries:{getIndustryBenchmarkData:l.l,getTeamActiveDirectoryInfo:u.e,getTeamBillingInformation:p._,getTeamCancellationStatus:m.F,getTeamCapabilities:h.Y,getTeamCreationDateUnixQuery:g.T,getTeamDuoInfo:v.Z,getTeamId:f.e,getTeamName:y.j,getTeamRoles:b.R,getTeamPolicies:_.K,getTeamSeats:S.W,getTeamSecurityScore:w.R,getTeamSsoInfo:E.m,getTeamTrialStatus:C.P,isTeamCreator:T.G7}})},31108:(e,t,r)=>{r.d(t,{e:()=>n});var s=r(67837),a=r(48666);class n extends((0,s.E)(a.o)){}(0,s.K)(a.o,n)},36833:(e,t,r)=>{r.d(t,{E:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},45364:(e,t,r)=>{r.d(t,{Kv:()=>l,Q2:()=>u,QI:()=>d,U8:()=>o,mX:()=>c});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.DUPLICATE="team_name_already_exists",e.INVALID_TEAM_SETTING_VALUE="INVALID_TEAM_SETTING_VALUE",e.NOT_ADMIN="not_admin",e.NOT_AUTHORIZED="not_authorized"}(s||(s={}));const o=(0,i.Vj)("team_name_already_exists","That team name already exists"),c=(0,i.Vj)("INVALID_TEAM_SETTING_VALUE","The team setting value is invalid"),d=(0,i.Vj)("not_admin","User is not admin"),l=(0,i.Vj)("not_authorized","User is not authorized to perform this action");class u extends((0,a.g)({scope:n.F.User})){}},8025:(e,t,r)=>{r.d(t,{m:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},30561:(e,t,r)=>{r.d(t,{AP:()=>c,No:()=>u,RQ:()=>d,gv:()=>o,lO:()=>l,sK:()=>s});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.NOT_IN_FREE_TRIAL="TEAM_NOT_FREE_TRIAL",e.IN_GRACE_PERIOD="TEAM_IN_GRACE_PERIOD",e.USER_NOT_ADMIN="not_admin"}(s||(s={}));const o=(0,i.Vj)("TEAM_NOT_FOUND","Team not found"),c=(0,i.Vj)("TEAM_NOT_FREE_TRIAL","Team is not in a free trial"),d=(0,i.Vj)("TEAM_IN_GRACE_PERIOD","User trial is already extended. User is in grace period"),l=(0,i.Vj)("not_admin","User is not admin");class u extends((0,a.g)({scope:n.F.User})){}},52966:(e,t,r)=>{r.d(t,{Rb:()=>d,VH:()=>o,fz:()=>c,y7:()=>l});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.IN_FREE_TRIAL="TEAM_IN_FREE_TRIAL",e.IS_DISCONTINUED="TEAM_IS_DISCONTINUED",e.USER_NOT_ADMIN="NOT_ADMIN"}(s||(s={}));const o=(0,i.Vj)("TEAM_IN_FREE_TRIAL","Team is in a free trial"),c=(0,i.Vj)("TEAM_IS_DISCONTINUED","Team is discontinued"),d=(0,i.Vj)("NOT_ADMIN","User is not admin");class l extends((0,a.g)({scope:n.F.User})){}},3434:(e,t,r)=>{r.d(t,{b6:()=>o,cr:()=>c});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.INVALID_FEEDBACK="INVALID_FEEDBACK"}(s||(s={}));const o=(0,i.Vj)("INVALID_FEEDBACK","The provided feedback is invalid and won't be shared");class c extends((0,a.g)({scope:n.F.User})){}},29151:(e,t,r)=>{r.d(t,{l:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},49649:(e,t,r)=>{r.d(t,{e:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},31933:(e,t,r)=>{r.d(t,{_:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},93478:(e,t,r)=>{r.d(t,{F:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},47883:(e,t,r)=>{r.d(t,{Y:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},8365:(e,t,r)=>{r.d(t,{T:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},14784:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},44096:(e,t,r)=>{r.d(t,{e:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},22283:(e,t,r)=>{r.d(t,{j:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},51183:(e,t,r)=>{r.d(t,{K:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},88273:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},3463:(e,t,r)=>{r.d(t,{W:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},20270:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},621:(e,t,r)=>{r.d(t,{m:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},22681:(e,t,r)=>{r.d(t,{P:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},10729:(e,t,r)=>{r.d(t,{G7:()=>c});var s,a=r(99059),n=r(25029),i=r(96168);!function(e){e.NOT_LOGGED="NOT_LOGGED",e.NOT_ADMIN="NOT_ADMIN"}(s||(s={}));const o=(0,i.Vj)("NOT_LOGGED","Please log the user");(0,i.Vj)("NOT_ADMIN","User is not an admin");class c extends((0,a.k)({scope:n.F.User,noUserError:o()})){}},45836:(e,t,r)=>{r.d(t,{F:()=>n,Gr:()=>c,Uz:()=>i,lD:()=>s,qo:()=>a,ym:()=>l,yt:()=>d});var s,a,n,i,o=r(7165);!function(e){e.Legacy="legacy",e.Starter="starter",e.Team="team",e.Business="business",e.Enterprise="entreprise",e.Standard="standard"}(s||(s={})),function(e){e.ProcessOut="processout",e.Invoice="invoice"}(a||(a={})),function(e){e.USD="usd",e.EUR="eur"}(n||(n={})),function(e){e.Pending="pending",e.Canceled="canceled",e.None="none",e.Unknown="unknown"}(i||(i={}));const c={ChoseOtherPasswordManager:"chose_other_password_manager",DownsizedEmployeeCount:"downsized_employee_count",MissingCriticalFeatures:"missing_critical_features",NoInternalUsage:"no_internal_usage",Other:"other",TechnicalIssues:"technical_issues",TooExpensive:"too_expensive"};var d;!function(e){e.InTeam="in_team",e.NotPremium="not_premium",e.NoPayment="no_payment",e.IsUnpaidFamilyMember="is_unpaid_family_member",e.DefaultSettings="default_settings",e.NoVPNCapability="no_vpn_capability",e.DisabledForFreeUser="disabled_for_free_user"}(d||(d={}));const l=o.z.object({allowPersistenceForMasterPassword:o.z.boolean(),allowSharing:o.z.boolean(),sharingRestrictedToTeam:o.z.boolean(),enforce2FA:o.z.boolean(),cryptoForcedPayload:o.z.string(),disableAutoLoginDomains:o.z.array(o.z.string()),enableForcedDomains:o.z.boolean(),enablePersonalSpace:o.z.boolean(),enableRemoveForcedContent:o.z.boolean(),enableVPN:o.z.boolean(),forceAutomaticLogout:o.z.number(),lockOnExit:o.z.boolean(),vaultExportEnabled:o.z.boolean(),collectSensitiveDataAuditLogsEnabled:o.z.boolean(),ssoEnabled:o.z.boolean(),ssoProvisioning:o.z.boolean(),teamDomain:o.z.array(o.z.string()),restrictSharingToTeam:o.z.boolean(),recoveryEnabled:o.z.boolean(),richIconsEnabled:o.z.boolean()})},27006:(e,t,r)=>{r.d(t,{K:()=>o});var s=r(86952),a=r(33549),n=r(54697),i=r(39127);const o=(0,s.Q)({name:"teamPlanUpdate",commands:{changeTierMidcycle:a.G},events:{},queries:{getTeamOffers:n.g,getMidcycleTierUpgradePrice:i.X}})},33549:(e,t,r)=>{r.d(t,{G:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},39127:(e,t,r)=>{r.d(t,{X:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},54697:(e,t,r)=>{r.d(t,{g:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},50691:(e,t,r)=>{r.d(t,{a:()=>c});var s=r(86952),a=r(47969),n=r(38356),i=r(99706),o=r(23945);const c=(0,s.Q)({name:"teamVat",commands:{DeleteTeamVatCommand:a.Hy,UpsertTeamVatCommand:n.XW},events:{},queries:{getTeamVat:i.N7,getTaxAmount:o.B}})},47969:(e,t,r)=>{r.d(t,{Hy:()=>l,zK:()=>d});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class o extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class c extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"not_billing_admin":return new c;default:throw new Error("Unknown server error")}}class l extends((0,a.g)({scope:n.F.User})){}},38356:(e,t,r)=>{r.d(t,{XW:()=>u,q5:()=>l});var s,a=r(74354),n=r(25029),i=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin",e.VatNumberNotUpserted="VatNumberNotUpserted"}(s||(s={}));class o extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class c extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}class d extends((0,i.Hu)("VatNumberNotUpserted","The VAT number couldn't be upserted")){}function l(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"not_billing_admin":return new c;case"VAT_NUMBER_NOT_UPSERTED":return new d;default:throw new Error("Unknown server error")}}class u extends((0,a.g)({scope:n.F.User})){}},23945:(e,t,r)=>{r.d(t,{A:()=>n,B:()=>i});var s=r(99059),a=r(96168);class n extends((0,a.Hu)("GetExpectedTaxInformationFailed","Could not return tax amount")){}class i extends((0,s.k)()){}},99706:(e,t,r)=>{r.d(t,{K$:()=>l,N7:()=>u});var s,a=r(99059),n=r(25029),i=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.VatNumberNotFound="VatNumberNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class o extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class c extends((0,i.Hu)("VatNumberNotFound","The given Team does not have a VAT number")){}class d extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}function l(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"VAT_NUMBER_NOT_FOUND":return new c;case"not_billing_admin":return new d;default:throw new Error("Unknown server error")}}class u extends((0,a.k)({scope:n.F.User})){}},69840:(e,t,r)=>{r.d(t,{_:()=>O});var s,a=r(88802),n=r(99634),i=r(11512);!function(e){e.WebOnboardingInviteLinkTacMigration="web_onboarding_inviteLinkTacMigration"}(s||(s={}));var o=r(25029),c=r(95681),d=r(23347),l=r(43613);class u extends((0,c.Q)({persist:!1,scope:o.F.User,storeName:"invite-link-team-store",initialValue:{status:l.D.NOT_LOADED},capacity:d.Y._001KB})){}var p,m,h=r(25859),g=r(87065),v=r(20754),f=r(87279),y=r(60399),b=r(48844),_=r(18533),S=r(20195),w=r(57924),E=r(87113),C=r(7165);!function(e){e.TEAM_DOES_NOT_EXIST="TEAM_DOES_NOT_EXIST",e.USER_NOT_PROPOSED_IN_TEAM="USER_NOT_PROPOSED_IN_TEAM",e.USER_TEAM_INVITE_TOKEN_NOT_FOUND="USER_TEAM_INVITE_TOKEN_NOT_FOUND"}(p||(p={})),C.z.object({tag:C.z.nativeEnum(p)}),function(e){e.NOT_ADMIN="NOT_ADMIN",e.TEAM_INVITE_LINK_NOT_FOUND="TEAM_INVITE_LINK_NOT_FOUND"}(m||(m={})),C.z.object({tag:C.z.nativeEnum(m)});let T=!1;class F{async shouldRefreshState(){const e=await this.inviteLinkStore.getState(),t=e.status!==l.D.READY,r=e.status===l.D.READY&&e.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES<Date.now();return t||r}constructor(e,t){this.serverApiClient=e,this.inviteLinkStore=t,this.MIN_DELAY_BETWEEN_REFRESHES=1e3,this.getFunctionalErrorForToken=e=>{switch(e){case p.TEAM_DOES_NOT_EXIST:return{tag:p.TEAM_DOES_NOT_EXIST};case p.USER_NOT_PROPOSED_IN_TEAM:return{tag:p.USER_NOT_PROPOSED_IN_TEAM};case p.USER_TEAM_INVITE_TOKEN_NOT_FOUND:return{tag:p.USER_TEAM_INVITE_TOKEN_NOT_FOUND};default:throw new Error(`RequestTeamInviteToken: error ${e}`)}},this.requestUserInviteTokenSending=(e,t)=>(0,y.z)(this.serverApiClient.v1.teams.requestTeamInviteToken({login:e,teamUuid:t}).pipe((0,b.DZ)((e=>(0,_.EQ)(e,{BusinessError:e=>this.getFunctionalErrorForToken(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},InternalServerError:S.j,InvalidRequest:S.j,RateLimited:S.j,ServiceUnavailable:S.j,UnspecifiedBadStatus:S.j}))),(0,b.Qn)((({data:e})=>e)))),this.loadInviteLinkData=async()=>{if(T)return;if(T=!0,!await this.shouldRefreshState())return void(T=!1);const e=await(0,y.z)(this.serverApiClient.v1.teams.getTeamSignUpPageForAdmin().pipe((0,b.Qn)((({data:e})=>e))));if((0,f.hx)(e)){const t="BusinessError"===e.error.tag&&"TEAM_INVITE_LINK_NOT_FOUND"===e.error.code?l.D.NOT_CREATED:l.D.NOT_LOADED;return T=!1,await this.inviteLinkStore.set({status:t})}const{disabled:t,teamKey:r}=e.data;await this.inviteLinkStore.set({teamKey:r,enabled:!t,lastRefreshDate:Date.now(),status:l.D.READY}),T=!1},this.toggleInviteLink=async e=>{const t=await(0,y.z)(this.serverApiClient.v1.teams.toggleTeamSignUpPage({disabled:!e}).pipe((0,b.Qn)((({data:e})=>e))));if((0,f.hx)(t))throw new Error(`could't change toggleTeamSignUpPage ${t}`)},this.createInviteLink=async e=>{const t=await(0,y.z)(this.serverApiClient.v1.teams.createTeamSignUpPage({displayName:e}).pipe((0,b.Qn)((({data:e})=>e))));if((0,f.hx)(t))throw new Error(`could't create an invite link with createTeamSignUpPage ${t}`)}}}F=(0,a.__decorate)([(0,w.GS)(),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===u?Object:u])],F);class N{execute(){return(0,h.P)((()=>(this.inviteLinkService.loadInviteLinkData(),this.inviteLinkStore.state$.pipe((0,g.U)((e=>{switch(e.status){case l.D.NOT_LOADED:return(0,f.Vp)(null);case l.D.NOT_CREATED:return(0,f.Vp)({teamKey:"",enabled:!1});default:return(0,f.Vp)({teamKey:e.teamKey,enabled:e.enabled})}}))))))}constructor(e,t){this.inviteLinkService=e,this.inviteLinkStore=t}}N=(0,a.__decorate)([(0,v.e)(l.$),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===F?Object:F,void 0===u?Object:u])],N);var I=r(93850),U=r(63663),P=r(85187);class A{async execute({body:e}){const{teamName:t,enabled:r}=e,s=await this.inviteLinkStore.getState();return s.status===l.D.NOT_CREATED?await this.inviteLinkService.createInviteLink(t):s.status===l.D.READY&&s.teamKey&&await this.inviteLinkService.toggleInviteLink(r),this.inviteLinkService.loadInviteLinkData(),Promise.resolve((0,f.Vp)(void 0))}constructor(e,t){this.inviteLinkStore=e,this.inviteLinkService=t}}A=(0,a.__decorate)([(0,U.W)(P.s),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===u?Object:u,void 0===F?Object:F])],A);var x=r(71379);class D{async execute({body:e}){const{login:t,teamUuid:r}=e;return await this.inviteLinkService.requestUserInviteTokenSending(t,r),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.inviteLinkService=e}}D=(0,a.__decorate)([(0,U.W)(x.T),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===F?Object:F])],D);class O{}O=(0,a.__decorate)([(0,n.Yl)({api:i.t,imports:[I.n],providers:[F],stores:[u],handlers:{commands:{toggleInviteLink:A,requestUserInviteTokenSending:D},events:{},queries:{inviteLinkData:N}},requiredFeatureFlips:Object.values(s)})],O)},56202:(e,t,r)=>{r.d(t,{E:()=>Fe});var s,a=r(88802),n=r(99634),i=r(93850),o=r(58164),c=r(6550),d=r(87752),l=r(5876),u=r(25029),p=r(95681),m=r(23347),h=r(10722),g=r(7165);!function(e){e.OfferToExtendFreeTrial="offerToExtendFreeTrial",e.NotificationTrialExtended="notificationTrialExtended",e.RestrictSharingPolicy="restrictSharingPolicy",e.B2BPlanDiscontinued="b2bPlanDiscontinued",e.ActivityLogsInfobox="activityLogsInfobox",e.StarterRepackagePolicyInfobox="starterRepackagePolicyInfobox",e.IdPFailedNotification="idpFailedNotification",e.IdPNeedsSeatsInfobox="idpNeedsSeatsInfobox",e.IdPProvisioningsPendingInfobox="idpProvisioningsPendingInfobox",e.IdPNeedsSeatsInfoboxInPopup="idpNeedsSeatsInfoboxInPopup"}(s||(s={}));const v=g.z.object({seenNotifications:g.z.record(g.z.nativeEnum(s),g.z.boolean())}),f=e=>v.safeParse(e).success,y={offerToExtendFreeTrial:!1,notificationTrialExtended:!1,restrictSharingPolicy:!1,b2bPlanDiscontinued:!1,activityLogsInfobox:!1,starterRepackagePolicyInfobox:!1,idpFailedNotification:!1,idpNeedsSeatsInfobox:!1,idpProvisioningsPendingInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1};function b(e){const{content:t,version:r}=e;if(1===r&&f(t))return{seenNotifications:{...t.seenNotifications,idpFailedNotification:t.seenNotifications.idpFailedNotification??y.idpFailedNotification,idpNeedsSeatsInfobox:t.seenNotifications.idpNeedsSeatsInfobox??y.idpNeedsSeatsInfobox,idpProvisioningsPendingInfobox:t.seenNotifications.idpProvisioningsPendingInfobox??y.idpProvisioningsPendingInfobox,idpNeedsSeatsInfoboxInPopup:t.seenNotifications.idpNeedsSeatsInfoboxInPopup??y.idpNeedsSeatsInfoboxInPopup}};throw new Error(`Unable to migrate unexpected team-admin-notification schema version ${r}`)}class _ extends((0,p.Q)({storage:{schemaVersion:2,initialValue:{seenNotifications:y},migrateStorageSchema:b,typeGuard:f},persist:!0,scope:u.F.User,storeName:"team-admin-notifications-store",capacity:m.Y._010KB,codec:h.E})){}const S=g.z.object({failedProvisionings:g.z.union([g.z.object({eventDateUnix:g.z.number(),failedLogins:g.z.array(g.z.string()),nbOfFailedCreations:g.z.number(),requiredSeats:g.z.number(),nbOfPendingProvisionings:g.z.number(),shouldShowNotifications:g.z.object({warningProvisioningsPending:g.z.boolean(),alertFailuresNeedSeats:g.z.boolean()})}),g.z.undefined()]),fixedProvisionings:g.z.union([g.z.array(g.z.object({buyingUserId:g.z.number().nullable(),eventDateUnix:g.z.number(),nbOfSeatsBought:g.z.number()})),g.z.undefined()]),lastRefreshDate:g.z.number(),error:g.z.union([g.z.string(),g.z.undefined()])}),w=e=>S.safeParse(e).success;class E extends((0,p.Q)({storage:{schemaVersion:1,initialValue:{lastRefreshDate:0},typeGuard:w},persist:!0,scope:u.F.User,storeName:"idp-notifications-store",capacity:m.Y._010KB,codec:h.E})){}var C=r(60399),T=r(87065),F=r(82567),N=r(25859),I=r(87279),U=r(57924),P=r(87113),A=r(56276),x=r(59875);class D{async refreshState(){const e=await this.teamAdminService.refreshState();if(!e?.isBillingOrFullAdmin)return void this.idpNotificationsStore.set({lastRefreshDate:0,error:A.C$.NOT_ADMIN});const t=await this.idpNotificationsStore.getState();if(t.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now())return;const r=(await this.adminNotificationsStore.getState()).seenNotifications;return(0,C.z)(this.serverApiClient.v1.teams.getIdpNotifications({}).pipe((0,T.U)((t=>{if((0,I.hx)(t))return{lastRefreshDate:Date.now(),error:t.error.message};const r=t.data.data.logs.failedProvisionings,s=r?.nbOfFailedCreations,a=e.seats.remaining,n=s?Math.max(s-a,0):0,i={warningProvisioningsPending:a>0,alertFailuresNeedSeats:n>0};return{failedProvisionings:r?.nbOfFailedCreations?{...r,requiredSeats:n,nbOfPendingProvisionings:a,shouldShowNotifications:i}:void 0,fixedProvisionings:t.data.data.logs.fixedProvisionings,lastRefreshDate:Date.now()}})),(0,F.b)((async e=>{let s=!1,a=!1,n=!1;e.failedProvisionings&&e.failedProvisionings.eventDateUnix===t.failedProvisionings?.eventDateUnix?e.failedProvisionings.requiredSeats!==t.failedProvisionings.requiredSeats&&(s=!0):(s=!0,n=!0),e.failedProvisionings?.nbOfPendingProvisionings!==t.failedProvisionings?.nbOfPendingProvisionings&&(a=!0),await this.adminNotificationsStore.set({seenNotifications:{...r,...s?{idpNeedsSeatsInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1}:{},idpFailedNotification:!n&&r.idpFailedNotification,idpProvisioningsPendingInfobox:!a&&r.idpProvisioningsPendingInfobox}}),await this.idpNotificationsStore.set(e)}))))}constructor(e,t,r,s){this.serverApiClient=e,this.teamAdminService=t,this.idpNotificationsStore=r,this.adminNotificationsStore=s,this.MIN_DELAY_BETWEEN_REFRESHES=500,this.getIdPFailedProvisioningsData=()=>(0,N.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,T.U)((e=>"not_admin"===e.error?(0,I.Rn)((0,A.qj)()):(0,I.Vp)(e.failedProvisionings))))))),this.getIdPFixedProvisioningsData=()=>(0,N.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,T.U)((e=>"not_admin"===e.error?(0,I.Rn)((0,x.Go)()):(0,I.Vp)(e.fixedProvisionings)))))))}}D=(0,a.__decorate)([(0,U.GS)(),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===P.l?Object:P.l,void 0===d.k?Object:d.k,void 0===E?Object:E,void 0===_?Object:_])],D);var O=r(99805),k=r(63663),R=r(96209);class L{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,activityLogsInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}L=(0,a.__decorate)([(0,k.W)(R.o),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],L);var M=r(56859);class j{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,starterRepackagePolicyInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}j=(0,a.__decorate)([(0,k.W)(M.z),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],j);var V=r(36486);class z{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,b2bPlanDiscontinued:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}z=(0,a.__decorate)([(0,k.W)(V.q),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],z);var B=r(93595);class ${async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpFailedNotification:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}$=(0,a.__decorate)([(0,k.W)(B.b),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],$);var q=r(23578);class G{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}G=(0,a.__decorate)([(0,k.W)(q.k),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],G);var K=r(14485);class H{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfoboxInPopup:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}H=(0,a.__decorate)([(0,k.W)(K.N),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],H);var Q=r(61358);class W{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpProvisioningsPendingInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}W=(0,a.__decorate)([(0,k.W)(Q.r),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],W);var Y=r(81940);class X{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,restrictSharingPolicy:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}X=(0,a.__decorate)([(0,k.W)(Y.o),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],X);var Z=r(4093);class J{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,notificationTrialExtended:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}J=(0,a.__decorate)([(0,k.W)(Z.D),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],J);var ee=r(69877);class te{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,offerToExtendFreeTrial:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,I.Vp)(void 0))}constructor(e){this.store=e}}te=(0,a.__decorate)([(0,k.W)(ee.R),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],te);var re=r(20754);class se{execute(){return this.idpNotificationsDataService.getIdPFailedProvisioningsData()}constructor(e){this.idpNotificationsDataService=e}}se=(0,a.__decorate)([(0,re.e)(A.It),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===D?Object:D])],se);class ae{execute(){return this.idpNotificationsDataService.getIdPFixedProvisioningsData()}constructor(e){this.idpNotificationsDataService=e}}ae=(0,a.__decorate)([(0,re.e)(x.Un),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===D?Object:D])],ae);var ne=r(54860);class ie{execute(){return this.store.state$.pipe((0,T.U)((e=>(0,I.Vp)(!!e.seenNotifications.activityLogsInfobox))))}constructor(e){this.store=e}}ie=(0,a.__decorate)([(0,re.e)(ne.g),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],ie);var oe=r(97786);class ce{execute(){return this.store.state$.pipe((0,T.U)((e=>(0,I.Vp)(!!e.seenNotifications.starterRepackagePolicyInfobox))))}constructor(e){this.store=e}}ce=(0,a.__decorate)([(0,re.e)(oe.i),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],ce);var de=r(6136),le=r(92179);class ue{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.b2bPlanDiscontinued)),(0,de.x)(),(0,T.U)(I.Vp))}constructor(e){this.store=e}}ue=(0,a.__decorate)([(0,re.e)(le.z),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],ue);var pe=r(91206);class me{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.idpFailedNotification)),(0,de.x)(),(0,T.U)(I.Vp))}constructor(e){this.store=e}}me=(0,a.__decorate)([(0,re.e)(pe.g),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],me);var he=r(16883);class ge{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.idpNeedsSeatsInfobox)),(0,de.x)(),(0,T.U)(I.Vp))}constructor(e){this.store=e}}ge=(0,a.__decorate)([(0,re.e)(he.T),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],ge);var ve=r(66385);class fe{execute(){return this.store.state$.pipe((0,T.U)((e=>(0,I.Vp)(!!e.seenNotifications.idpNeedsSeatsInfoboxInPopup))))}constructor(e){this.store=e}}fe=(0,a.__decorate)([(0,re.e)(ve.k),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],fe);var ye=r(75178);class be{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.idpProvisioningsPendingInfobox)),(0,de.x)(),(0,T.U)(I.Vp))}constructor(e){this.store=e}}be=(0,a.__decorate)([(0,re.e)(ye.S),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],be);var _e=r(74629);class Se{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.restrictSharingPolicy)),(0,de.x)(),(0,T.U)(I.Vp))}constructor(e){this.store=e}}Se=(0,a.__decorate)([(0,re.e)(_e.x),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],Se);var we=r(31432);class Ee{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.notificationTrialExtended)),(0,de.x)(),(0,T.U)(I.Vp))}constructor(e){this.store=e}}Ee=(0,a.__decorate)([(0,re.e)(we.q),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],Ee);var Ce=r(75008);class Te{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.offerToExtendFreeTrial)),(0,de.x)(),(0,T.U)(I.Vp))}constructor(e){this.store=e}}Te=(0,a.__decorate)([(0,re.e)(Ce.U),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===_?Object:_])],Te);class Fe{}Fe=(0,a.__decorate)([(0,n.Yl)({api:o.t,imports:[O.H,i.n],stores:[E,_,c.C],providers:[D,l.J,d.k],handlers:{commands:{markActivityLogsInfoboxSeen:L,markStarterRepackagePolicyInfoboxSeen:j,markB2BPlanDiscontinuedSeen:z,markIdPFailedNotificationSeen:$,markIdPNeedsSeatsInfoboxSeen:G,markIdPNeedsSeatsInfoboxInPopupSeen:H,markIdPProvisioningsPendingInfoboxSeen:W,markNewRestrictSharingPolicySeen:X,markNotificationTrialExtendedSeen:J,markOfferToExtendFreeTrialSeen:te},events:{},queries:{getIdPFailedProvisioningsData:se,getIdPFixedProvisioningsData:ae,hasSeenActivityLogsInfobox:ie,HasSeenStarterRepackagePolicyInfobox:ce,hasSeenB2BPlanDiscontinued:ue,hasSeenIdPFailedNotification:me,hasSeenIdPNeedsSeatsInfobox:ge,hasSeenIdPNeedsSeatsInfoboxInPopup:fe,hasSeenIdPProvisioningsPendingInfobox:be,hasSeenNewRestrictSharingPolicy:Se,hasSeenNotificationTrialExtended:Ee,hasSeenOfferToExtendFreeTrial:Te}},requiredFeatureFlips:["monetization_extension_activity_logs_repackage","monetization_extension_trial_activity_logs","monetization_extension_group_sharing_repackage"]})],Fe)},44272:(e,t,r)=>{r.d(t,{X:()=>K});var s=r(88802),a=r(99634),n=r(93850),i=r(72788),o=r(95681),c=r(23347),d=r(25029),l=r(73895),u=r(7165);const p=u.z.object({adminHasDismissInfobox:u.z.boolean(),nonMembersCount:u.z.number().optional(),nonMembersList:l.RD.optional()}),m=e=>p.safeParse(e).success;class h extends((0,o.Q)({initialValue:{adminHasDismissInfobox:!1},storeTypeGuard:m,persist:!1,scope:d.F.User,storeName:"non-member-store",capacity:c.Y._001KB})){}var g=r(20754),v=r(59509),f=r(48844),y=r(32054);class b{execute({body:e}){const{teamId:t}=e;return this.getTeamMembersData.get(t).pipe((0,f.Qn)((({members:e,billingAdmins:t})=>({billingAdmins:t,members:e.map((({isTeamCaptain:e,isGroupManager:t,login:r})=>({isTeamCaptain:e,isGroupManager:t,login:r})))}))))}constructor(e){this.getTeamMembersData=e}}b=(0,s.__decorate)([(0,g.e)(v.k),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y.G?Object:y.G])],b);var _=r(63663),S=r(16396),w=r(60399),E=r(82567),C=r(57924),T=r(87113),F=r(87279),N=r(81459);class I extends N.f{}I=(0,s.__decorate)([(0,C.GS)()],I);class U{async callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}){try{return await(0,w.z)(this.serverApiClient.v1.teams.proposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}).pipe((0,f.DZ)((e=>{if("BusinessError"===e.tag)return(0,S.Wv)(e.code);throw new Error(e.message)})),(0,f.lk)((e=>(0,F.Vp)(e.data))),(0,E.b)((()=>{this.eventEmitter.sendEvent("membersAdded",void 0)}))))}catch(e){return(0,F.Rn)({tag:"failure",error:`Propose Members failed - ${e}`})}}constructor(e,t){this.serverApiClient=e,this.eventEmitter=t}}U=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===T.l?Object:T.l,void 0===I?Object:I])],U);class P{execute({body:{proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}}){return this.proposeMembersService.callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s})}constructor(e){this.proposeMembersService=e}}P=(0,s.__decorate)([(0,_.W)(S.og),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===U?Object:U])],P);var A=r(37043);class x{async execute(){return await this.nonMemberStore.set({adminHasDismissInfobox:!0}),(0,F.Vp)(void 0)}constructor(e){this.nonMemberStore=e}}x=(0,s.__decorate)([(0,_.W)(A.Y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h])],x);var D=r(43978),O=r(69885),k=r(87065),R=r(6136),L=r(35468),M=r(58605);class j{getCount(){return this.serverApiClient.v1.teams.countDomainUsersNotInTeam({}).pipe((0,k.U)((e=>(0,F.hx)(e)?(0,F.Rn)(new M.$):(0,F.Vp)(e.data.data.usersCount))))}getList(){return this.serverApiClient.v1.teams.getDomainUsersNotInTeam({}).pipe((0,k.U)((e=>(0,F.hx)(e)?(0,F.Rn)(new M.$):(0,F.Vp)(e.data.data.users.map((e=>l.R0.parse(e)))))))}constructor(e){this.serverApiClient=e}}j=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===T.l?Object:T.l])],j);class V{execute(){return this.nonMembersStore.state$.pipe((0,D.w)((e=>void 0!==e.nonMembersCount?(0,O.of)(e.nonMembersCount):this.nonMembersService.getCount().pipe((0,k.U)((t=>(0,F.hx)(t)?0:(this.nonMembersStore.set({...e,nonMembersCount:t.data}),t.data)))))),(0,R.x)(),(0,k.U)(F.Vp))}constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}}V=(0,s.__decorate)([(0,g.e)(L.H),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===j?Object:j])],V);var z=r(62760);const B=[];class ${execute(){return this.nonMembersStore.state$.pipe((0,D.w)((e=>void 0!==e.nonMembersList?(0,O.of)(e.nonMembersList):this.nonMembersService.getList().pipe((0,k.U)((t=>{if((0,F.hx)(t))return B;const r=t.data;return this.nonMembersStore.set({...e,nonMembersList:r}),r}))))),(0,R.x)(((e,t)=>(0,z.shallowEqualArrays)(e,t))),(0,k.U)(F.Vp))}constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}}$=(0,s.__decorate)([(0,g.e)(l.Fz),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===j?Object:j])],$);var q=r(22099);class G{execute(){return this.nonMembersStore.state$.pipe((0,k.U)((e=>e.adminHasDismissInfobox)),(0,R.x)(),(0,k.U)(F.Vp))}constructor(e){this.nonMembersStore=e}}G=(0,s.__decorate)([(0,g.e)(q.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h])],G);class K{}K=(0,s.__decorate)([(0,a.Yl)({api:i.L,imports:[n.n],providers:[U,j,I,y.G],stores:[h],handlers:{commands:{proposeMembers:P,dismissNonMembersInfobox:x},events:{},queries:{getNonMembersCount:V,getNonMembersList:$,getHasAdminDismissedInfobox:G,getMembersList:b}},exports:[y.G]})],K)},32054:(e,t,r)=>{r.d(t,{G:()=>o});var s=r(88802),a=r(48844),n=r(57924),i=r(87113);class o{constructor(e){this.serverApiClient=e,this.get=e=>this.serverApiClient.v1.teams.getTeamMembers({teamId:parseInt(e,10),orderBy:"joinedDateUnix",limit:0}).pipe((0,a.Qn)((({data:e})=>e)),(0,a.DZ)((e=>{throw e})))}}o=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.l?Object:i.l])],o)},80699:(e,t,r)=>{r.d(t,{V:()=>v});var s=r(88802),a=r(99634),n=r(93850),i=r(35475),o=r(57924),c=r(87113),d=r(87279),l=r(48844),u=r(87065);class p{constructor(e){this.serverApiClient=e,this.getTeamReport=()=>this.getTeamReportData().pipe((0,u.U)((e=>{if((0,d.hx)(e))throw new Error("could't retrieve team report");const{data:t}=e;return(0,d.Vp)(t)}))),this.getTeamReportData=()=>this.serverApiClient.v1.teams.report({}).pipe((0,l.Qn)((({data:e})=>e)),(0,l.DZ)((e=>{throw e})))}}p=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.l?Object:c.l])],p);var m=r(20754),h=r(58089);class g{execute(){return this.teamReportService.getTeamReport()}constructor(e){this.teamReportService=e}}g=(0,s.__decorate)([(0,m.e)(h.z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p])],g);class v{}v=(0,s.__decorate)([(0,a.Yl)({api:i.B,imports:[n.n],providers:[p],handlers:{commands:{},events:{},queries:{getReport:g}}})],v)},5876:(e,t,r)=>{r.d(t,{J:()=>p});var s=r(88802),a=r(43956),n=r(86252),i=r(57924),o=r(87279),c=r(60399),d=r(87065),l=r(7165);const u=l.z.array(l.z.object({details:l.z.object({isBillingAdmin:l.z.boolean(),isTeamAdmin:l.z.boolean(),status:l.z.nativeEnum(a.fE)})}));class p{async isUserTeamAdmin(){return await(0,c.z)(this.carbonLegacyClient.queries.carbonState({path:"userSession.spaceData.spaces"}).pipe((0,d.U)((e=>{return!((0,o.hx)(e)||(t=e.data,!u.safeParse(t).success)||0===e.data.length)&&e.data.some((e=>e.details.status===a.fE.Accepted&&(e.details.isBillingAdmin||e.details.isTeamAdmin)));var t}))))}constructor(e){this.carbonLegacyClient=e}}p=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n._?Object:n._])],p)},72223:(e,t,r)=>{r.d(t,{O:()=>s,e:()=>i});const s=(e,t)=>({allowPersistenceForMasterPassword:!e.mpPersistenceDisabled,allowSharing:!e.sharingDisabled,sharingRestrictedToTeam:!!e.sharingRestrictedToTeam,enforce2FA:"newDevice"===e.twoFAEnforced,cryptoForcedPayload:e.cryptoForcedPayload??"disabled",disableAutoLoginDomains:e.autologinDomainDisabledArray??[],enableForcedDomains:!!e.forcedDomainsEnabled,enablePersonalSpace:!!e.personalSpaceEnabled,enableRemoveForcedContent:!!e.removeForcedContentEnabled,enableVPN:!!e.secureWifiEnabled,forceAutomaticLogout:(e.forceAutomaticLogout||"unset").toString(),lockOnExit:!!e.lockOnExit,vaultExportEnabled:!!e.vaultExportEnabled,collectSensitiveDataAuditLogsEnabled:!!e.collectSensitiveDataAuditLogsEnabled,ssoEnabled:!!e.ssoEnabled,ssoProvisioning:"automatic"===e.ssoProvisioning,teamDomain:e.teamDomains??[],restrictSharingToTeam:"boolean"==typeof e.sharingRestrictedToTeam?e.sharingRestrictedToTeam:t.internalSharingOnly.enabled,recoveryEnabled:!!e.recoveryEnabled,richIconsEnabled:!!e.richIconsEnabled}),a=(e,t,r)=>{const s=[];return r?.added&&r.added.forEach((t=>s.push({type:e,value:t}))),r?.removed&&r.removed.forEach((e=>s.push({type:t,value:e}))),s},n=(e,t)=>void 0!==t?[{type:e,value:t}]:[],i=(e,t)=>{const r=[...a("add_team_domain","remove_team_domain",t.teamDomain),...a("add_autologin_domain_disabled","remove_autologin_domain_disabled",t.disableAutoLoginDomains),...n("set_forced_domains_enabled",t.enableForcedDomains),...n("set_rm_forced_content_enabled",t.enableRemoveForcedContent),...n("set_vault_export_enabled",t.vaultExportEnabled),...n("set_secure_wifi",t.enableVPN),...n("set_lock_on_exit",t.lockOnExit),...n("set_collect_sensitive_data_audit_logs_enabled",t.collectSensitiveDataAuditLogsEnabled),...n("set_sharing_restricted_to_team",t.restrictSharingToTeam),...(s="set_sharing_disabled",i=t.allowSharing,void 0!==i?[{type:s,value:!i}]:[])];var s,i;return void 0!==t.enforce2FA&&r.push({type:"set_two_factor_authentication_enforced",value:t.enforce2FA?"newDevice":"disabled"}),void 0!==t.forceAutomaticLogout&&r.push({type:null===t.forceAutomaticLogout?"unset_force_automatic_logout":"set_force_automatic_logout",value:t.forceAutomaticLogout}),void 0!==t.cryptoForcedPayload&&r.push({type:"set_crypto_forced_payload",value:t.cryptoForcedPayload}),void 0!==t.ssoProvisioning&&r.push({type:"set_sso_provisioning",value:t.ssoProvisioning?"automatic":"disabled"}),void 0!==t.richIconsEnabled&&r.push({type:"set_rich_icons_enabled",value:t.richIconsEnabled}),{operations:r,teamId:e}}},99805:(e,t,r)=>{r.d(t,{H:()=>lt});var s=r(88802),a=r(99634),n=r(93850),i=r(48666),o=r(72788);var c,d=r(34710),l=r(5876),u=r(60399),p=r(57924),m=r(87113),h=r(96168);!function(e){e.CannotAddSeatDuringFreeTrial="cannot_add_seat_during_free_trial",e.CannotAddSeatIfDiscontinued="cannot_add_seat_on_soft_discontinued",e.CannotAddSeatDuringGracePeriod="cannot_add_seat_during_grace_period",e.UnsupportedPaymentMean="unsupported_payment_mean",e.UserIsNotBillingAdmin="not_billing_admin",e.PaymentFailed="payment_failed"}(c||(c={}));const g=(0,h.Vj)("cannot_add_seat_during_free_trial","Not possible to add seats during free trial"),v=(0,h.Vj)("cannot_add_seat_on_soft_discontinued","Not possible to add seats if team is discontinued"),f=(0,h.Vj)("cannot_add_seat_during_grace_period","Not possible to add seats during grace period"),y=(0,h.Vj)("unsupported_payment_mean","Payment mean is not supported"),b=(0,h.Vj)("not_billing_admin","User is not billing admin"),_=(0,h.Vj)("payment_failed","The payment has failed");var S=r(48844),w=r(18533),E=r(20195);class C{addSeats({seats:e}){return(0,u.z)(this.serverApiClient.v1.teams.addSeats({seats:e}).pipe((0,S.DZ)((e=>(0,w.EQ)(e,{BusinessError:e=>this.getAddSeatsFunctionalError(e.code),FetchFailedError:E.j,BadStatus:E.j,InternalServerError:E.j,InvalidRequest:E.j,RateLimited:E.j,ServiceUnavailable:E.j,UnspecifiedBadStatus:E.j}))),(0,S.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getAddSeatsFunctionalError=e=>{switch(e){case c.CannotAddSeatDuringFreeTrial:return g();case c.CannotAddSeatDuringGracePeriod:return f();case c.CannotAddSeatIfDiscontinued:return v();case c.UnsupportedPaymentMean:return y();case c.UserIsNotBillingAdmin:return b();case c.PaymentFailed:default:return _()}}}}C=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],C);var T=r(25859),F=r(87065),N=r(6136),I=r(85390),U=r(10705),P=r(62760),A=r(86252),x=r(87279),D=r(58605),O=r(45836),k=r(95557),R=r(10994),L=r(92481),M=r(50793);const j=e=>{if(!e)return new Date;const t=(0,k.Z)(e,"yyyy-MM-dd",new Date);return"Invalid Date"!==t.toString()?t:new Date(e)},V=e=>{const t=j((0,R.Z)(e).toString());return(0,L.Z)(t,"yyyy-MM-dd")===(0,L.Z)(j((new Date).toString()),"yyyy-MM-dd")},z=e=>{const t=new Date,r=(0,R.Z)(e);return r.setDate(r.getDate()+6),s=r,t.setHours(0,0,0,0)>s.setHours(0,0,0,0);var s},B=e=>(0,M.Z)((0,R.Z)(e),new Date);var $=r(6550),q=r(87752);class G{constructor(e,t,r){this.carbon=e,this.teamAdminStore=t,this.teamAdminService=r,this.getTeamTrialStatus=()=>(0,T.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?{isBillingOrFullAdmin:!0,isFreeTrial:e.billing.isFreeTrial,isGracePeriod:e.billing.isGracePeriod,creationDateUnix:e.creationDateUnix,nextBillingDetailsDateUnix:e.billing.nextBillingDetails.dateUnix,spaceTier:e.billing.planTier}:{isBillingOrFullAdmin:!1})),(0,N.x)(P.shallowEqualObjects),(0,F.U)((({isBillingOrFullAdmin:e,isFreeTrial:t,isGracePeriod:r,creationDateUnix:s,nextBillingDetailsDateUnix:a,spaceTier:n})=>e?(0,x.Vp)({isFreeTrial:t,isGracePeriod:r,isFirstDayOfTrial:V(s),isSecondStageOfTrial:z(s),daysLeftInTrial:B(a),spaceTier:n}):(0,x.Rn)(new D.$))))))),this.getTeamBillingDetails=()=>(0,I.a)([this.teamAdminStore.state$,this.getTeamSubscriptionInformation()]).pipe((0,F.U)((([e,t])=>{if(!e.isBillingOrFullAdmin)return{isBillingOrFullAdmin:!1};const{billing:r,seats:s}=e;return{isBillingOrFullAdmin:!0,nextBillingDetailsAmount:r.nextBillingDetails.amount,nextBillingDetailsCurrency:r.nextBillingDetails.currency,nextBillingDetailsDateUnix:r.nextBillingDetails.dateUnix,nextBillingAmountFormatted:r.nextBillingDetails.amount/100,billingType:t?.planDetails?.type,spaceTier:r.planTier,creditCardLastDigits:t?.billingInformation?.last4,lastBillingDateUnix:r.lastBillingDateUnix,seatsPaid:s.paid,seatsExtraFree:s.extraFree,usersToBeRenewedCount:r.usersToBeRenewedCount,planDetails:r.planDetails,duration:t?.planDetails?.duration}})),(0,N.x)(((e,t)=>(0,U.Z)(e,t))),(0,F.U)((({isBillingOrFullAdmin:e,nextBillingDetailsAmount:t,nextBillingDetailsCurrency:r,nextBillingDetailsDateUnix:s,nextBillingAmountFormatted:a,billingType:n,spaceTier:i,creditCardLastDigits:o,lastBillingDateUnix:c,seatsPaid:d,seatsExtraFree:l,usersToBeRenewedCount:u,planDetails:p,duration:m})=>{if(!e)return(0,x.Rn)(new D.$);const h={amount:t,currency:"usd"===r?O.F.USD:O.F.EUR,dateUnix:s,amountFormatted:a,pricePerSeat:a/u};return(0,x.Vp)({billingType:(g=n,g?"invoice"===g?O.qo.Invoice:O.qo.ProcessOut:null),spaceTier:i,creditCardLastDigits:o??null,lastBillingDateUnix:c,nextBillingDetails:h,seatsNumber:d+l,usersToBeRenewedCount:u,daysLeftUntilNextBillingPeriod:B(s),planDetails:{...p,duration:m}});var g}))),this.getTeamCapabilities=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?e.capabilities:null)),(0,N.x)(((e,t)=>null!==e&&null!==t?(0,U.Z)(e,t):e===t)),(0,F.U)((e=>null===e?(0,x.Rn)(new D.$):(0,x.Vp)(e)))),this.getTeamCreationDateUnix=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>"NOT_LOADED"===e.loadingState||"LOADING"===e.loadingState&&!e.isBillingOrFullAdmin?null:!!e.isBillingOrFullAdmin&&e.creationDateUnix)),(0,N.x)(),(0,F.U)((e=>!1===e?(0,x.Rn)(new D.$):(0,x.Vp)(e)))),this.getTeamSeats=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?(0,x.Vp)(e.seats):(0,x.Rn)(new D.$)))),this.getTeamSecurityScore=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?(0,x.Vp)(e.securityScore):(0,x.Rn)(new D.$)))),this.getIndustryBenchmarkData=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>!!e.isBillingOrFullAdmin&&e.industryBenchmarkData)),(0,N.x)(((e,t)=>"boolean"!=typeof e&&"boolean"!=typeof t?(0,P.shallowEqualObjects)(e,t):e===t)),(0,F.U)((e=>!1===e?(0,x.Rn)(new D.$):(0,x.Vp)(e)))),this.getTeamName=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?e.teamName:null)),(0,N.x)(),(0,F.U)((e=>null===e?(0,x.Rn)(new D.$):(0,x.Vp)(e)))),this.getTeamRoles=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?(0,x.Vp)(e.teamRoles):(0,x.Rn)(new D.$)))),this.getTeamActiveDirectoryInfo=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?(0,x.Vp)(e.settings.activeDirectoryInfo):(0,x.Rn)(new D.$)))),this.getTeamDuoInfo=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?(0,x.Vp)(e.settings.duoInfo):(0,x.Rn)(new D.$)))),this.getTeamSsoInfo=()=>this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?(0,x.Vp)(e.settings.ssoInfo):(0,x.Rn)(new D.$)))),this.getTeamSubscriptionInformation=()=>{const{getSubscriptionInformation:e}=this.carbon.queries;return e().pipe((0,F.U)((e=>{if(!(0,x.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,x.db)(e).b2bSubscription})))},this.getTeamPolicies=()=>(0,T.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,F.U)((e=>e.isBillingOrFullAdmin?e.policies:null)),(0,N.x)(((e,t)=>null!==e&&null!==t?(0,U.Z)(e,t):e===t)),(0,F.U)((e=>null===e?(0,x.Rn)(new D.$):(0,x.Vp)(e)))))))}}G=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A._?Object:A._,void 0===$.C?Object:$.C,void 0===q.k?Object:q.k])],G);var K=r(30561);class H{constructor(e){this.serverApiClient=e,this.extendFreeTrial=async()=>{const e=await(0,u.z)(this.serverApiClient.v1.teams.extendFreeTrial({}));return(0,x.hx)(e)&&this.getExtendTrialFunctionalError(e.error.message),(0,x.Vp)(void 0)},this.getExtendTrialFunctionalError=e=>{switch(e){case K.sK.TEAM_NOT_FOUND:return(0,K.gv)();case K.sK.NOT_IN_FREE_TRIAL:return(0,K.AP)();case K.sK.IN_GRACE_PERIOD:return(0,K.RQ)();case K.sK.USER_NOT_ADMIN:return(0,K.lO)();default:return(0,K.gv)()}}}}H=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],H);var Q=r(82567),W=r(52966),Y=r(95681),X=r(23347),Z=r(25029),J=r(10722);const ee=e=>e===O.Uz.Canceled||e===O.Uz.None||e===O.Uz.Pending;class te extends((0,Y.Q)({storage:{schemaVersion:1,initialValue:O.Uz.None,typeGuard:ee},persist:!0,scope:Z.F.User,storeName:"plan-cancellation-store",capacity:X.Y._001KB,codec:J.E})){}class re{async refreshState(){const e=this.getTickets(),t=this.getIsRenewalStopped();return await(0,u.z)((0,I.a)([e,t]).pipe((0,F.U)((([e,t])=>this.serverToDomainCancelStatusMapper(e,t))),(0,Q.b)((e=>{this.planCancellationStore.set(e)}))))}constructor(e,t,r){this.serverApiClient=e,this.planCancellationStore=t,this.carbon=r,this.createZendeskCancellationTicket=async e=>{const t=await(0,u.z)(this.serverApiClient.v1.teams.createZendeskCancellationTicket(e));return(0,x.hx)(t)&&this.getBusinessErrorsForCreateZendeskCancellationTicket(t.error.message),(0,x.Vp)(void 0)},this.getZendeskCancellationTicket=()=>(this.refreshState(),this.planCancellationStore.state$.pipe((0,N.x)(),(0,F.U)(x.Vp))),this.getBusinessErrorsForCreateZendeskCancellationTicket=e=>"TEAM_IN_FREE_TRIAL"===e?(0,W.VH)():"TEAM_IS_DISCONTINUED"===e?(0,W.fz)():(0,W.Rb)(),this.serverToDomainCancelStatusMapper=(e,t)=>(0,x.hx)(e)?O.Uz.Unknown:t?O.Uz.Canceled:void 0!==(0,x.db)(e).id?O.Uz.Pending:O.Uz.None,this.getIsRenewalStopped=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,F.U)((e=>{if((0,x.hx)(e))throw new Error("Cannot retrieve node premium status from Carbon");return e.data.b2bStatus?.currentTeam?.isRenewalStopped}))),this.getTickets=()=>this.serverApiClient.v1.teams.getZendeskCancellationTicket({}).pipe((0,S.DZ)((e=>({tag:e.message}))),(0,S.Qn)((e=>e.data)))}}re=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l,void 0===te?Object:te,void 0===A._?Object:A._])],re);var se=r(7165);const ae=se.z.object({isLoading:se.z.boolean(),isTeamCreator:se.z.boolean().optional()}),ne=e=>ae.safeParse(e).success;class ie extends((0,Y.Q)({initialValue:{isLoading:!1},storeTypeGuard:ne,persist:!1,isCache:!0,scope:Z.F.User,storeName:"team-creator-store",capacity:X.Y._010KB})){}var oe,ce=r(44272),de=r(63663),le=r(36833);class ue{async execute({body:e}){const{seats:t}=e,r=await this.addSeatsService.addSeats({seats:t});return(0,x.d6)(r)&&await this.teamAdminService.refreshState(),r}constructor(e,t){this.teamAdminService=e,this.addSeatsService=t}}ue=(0,s.__decorate)([(0,de.W)(le.E),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q.k?Object:q.k,void 0===C?Object:C])],ue);class pe{async execute(){const e=await this.freeTrialService.extendFreeTrial();return(0,x.d6)(e)&&await this.teamAdminService.refreshState(),e}constructor(e,t){this.freeTrialService=e,this.teamAdminService=t}}pe=(0,s.__decorate)([(0,de.W)(K.No),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===H?Object:H,void 0===q.k?Object:q.k])],pe),function(e){e.NoInternalUsage="cancellation_lack_of_adoption",e.DownsizedEmployeeCount="cancellation_acquisition_or_restructured",e.ChoseOtherPasswordManager="cancellation_switched_to_competitor",e.MissingCriticalFeatures="cancellation_lack_of_features",e.TechnicalIssues="cancellation_technical_issues",e.TooExpensive="cancellation_price",e.Other="cancellation_other"}(oe||(oe={}));const me={[O.Gr.ChoseOtherPasswordManager]:"cancellation_switched_to_competitor",[O.Gr.DownsizedEmployeeCount]:"cancellation_acquisition_or_restructured",[O.Gr.MissingCriticalFeatures]:"cancellation_lack_of_features",[O.Gr.NoInternalUsage]:"cancellation_lack_of_adoption",[O.Gr.Other]:"cancellation_other",[O.Gr.TechnicalIssues]:"cancellation_technical_issues",[O.Gr.TooExpensive]:"cancellation_price"};class he{async execute({body:e}){const{reasons:t}=e,r=(e=>({reasons:e.map((e=>me[e]))}))(t),s=await this.planCancellationService.createZendeskCancellationTicket(r);return(0,x.d6)(s)&&await this.planCancellationService.refreshState(),s}constructor(e){this.planCancellationService=e}}he=(0,s.__decorate)([(0,de.W)(W.y7),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===re?Object:re])],he);var ge=r(45364);class ve{async execute({body:e}){const{teamId:t,newTeamName:r}=e,s=await(0,u.z)(this.serverApiClient.v1.teams.editSettings({teamId:t,operations:[{type:"set_name",value:r}]}));return(0,x.hx)(s)?"code"in s.error&&"team_name_already_exists"===s.error.code?(0,x.Rn)((0,ge.U8)()):"NOT_ADMIN"===s.error.message?(0,x.Rn)((0,ge.QI)()):"NOT_AUTHORIZED"===s.error.message?(0,x.Rn)((0,ge.Kv)()):(0,x.Rn)((0,ge.mX)()):(0,x.Vp)(void 0)}constructor(e){this.serverApiClient=e}}ve=(0,s.__decorate)([(0,de.W)(ge.Q2),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],ve);var fe=r(8025),ye=r(72223);class be{async execute({body:e}){const{teamId:t,policyUpdates:r}=e;return await(0,u.z)(this.serverApiClient.v1.teams.editSettings((0,ye.e)(t,r))),await this.teamAdminService.refreshState(),(0,x.Vp)(void 0)}constructor(e,t){this.teamAdminService=e,this.serverApiClient=t}}be=(0,s.__decorate)([(0,de.W)(fe.m),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q.k?Object:q.k,void 0===m.l?Object:m.l])],be);var _e=r(3434);class Se{async execute({body:e}){const{feedbackBody:t}=e,r=await(0,u.z)(this.serverApiClient.v1.feedback.sendFeedback({title:"A team Admin just wrote to us:",body:t}));return(0,x.hx)(r)?(0,x.Rn)((0,_e.b6)()):(0,x.Vp)(void 0)}constructor(e){this.serverApiClient=e}}Se=(0,s.__decorate)([(0,de.W)(_e.cr),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],Se);var we=r(5237),Ee=r(68307);class Ce{async handle(){await this.teamAdminService.refreshState()}constructor(e){this.teamAdminService=e}}Ce=(0,s.__decorate)([(0,Ee.b)(we.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q.k?Object:q.k])],Ce);var Te=r(67267);class Fe{async handle(){await this.teamAdminService.refreshState()}constructor(e){this.teamAdminService=e}}Fe=(0,s.__decorate)([(0,Ee.b)(Te.q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q.k?Object:q.k])],Fe);var Ne=r(162),Ie=r(20754),Ue=r(29151);class Pe{execute(){return(0,Ne.D)(this.getTeamPlanDetailsService.getIndustryBenchmarkData())}constructor(e){this.getTeamPlanDetailsService=e}}Pe=(0,s.__decorate)([(0,Ie.e)(Ue.l),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Pe);var Ae=r(49649);class xe{execute(){return this.getTeamPlanDetailsService.getTeamActiveDirectoryInfo()}constructor(e){this.getTeamPlanDetailsService=e}}xe=(0,s.__decorate)([(0,Ie.e)(Ae.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],xe);var De=r(31933);class Oe{execute(){return(0,Ne.D)(this.getTeamPlanDetailsService.getTeamBillingDetails())}constructor(e){this.getTeamPlanDetailsService=e}}Oe=(0,s.__decorate)([(0,Ie.e)(De._),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Oe);var ke=r(93478);class Re{execute(){return this.planCancellationService.getZendeskCancellationTicket()}constructor(e){this.planCancellationService=e}}Re=(0,s.__decorate)([(0,Ie.e)(ke.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===re?Object:re])],Re);var Le=r(47883);class Me{execute(){return this.getTeamPlanDetailsService.getTeamCapabilities()}constructor(e){this.getTeamPlanDetailsService=e}}Me=(0,s.__decorate)([(0,Ie.e)(Le.Y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Me);var je=r(8365);class Ve{execute(){return(0,Ne.D)(this.getTeamPlanDetailsService.getTeamCreationDateUnix())}constructor(e){this.getTeamPlanDetailsService=e}}Ve=(0,s.__decorate)([(0,Ie.e)(je.T),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Ve);var ze=r(14784);class Be{execute(){return this.getTeamPlanDetailsService.getTeamDuoInfo()}constructor(e){this.getTeamPlanDetailsService=e}}Be=(0,s.__decorate)([(0,Ie.e)(ze.Z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Be);var $e=r(44096);class qe{execute(){const{carbonState:e}=this.carbon.queries;return e({path:"state.userSession.spaceData.spaces"}).pipe((0,F.U)((e=>{if(!(0,x.d6)(e))throw new Error("Cannot retrieve user spaces");const t=e.data.find((e=>"accepted"===e.details.status));return t?t.teamId:null})),(0,N.x)(),(0,F.U)((e=>(0,x.Vp)({teamId:e}))))}constructor(e){this.carbon=e}}qe=(0,s.__decorate)([(0,Ie.e)($e.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A._?Object:A._])],qe);var Ge=r(22283);class Ke{execute(){return this.getTeamPlanDetailsService.getTeamName()}constructor(e){this.getTeamPlanDetailsService=e}}Ke=(0,s.__decorate)([(0,Ie.e)(Ge.j),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Ke);var He=r(88273);class Qe{execute(){return(0,Ne.D)(this.getTeamPlanDetailsService.getTeamRoles())}constructor(e){this.getTeamPlanDetailsService=e}}Qe=(0,s.__decorate)([(0,Ie.e)(He.R),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Qe);var We=r(51183);class Ye{execute(){return this.getTeamPlanDetailsService.getTeamPolicies()}constructor(e){this.getTeamPlanDetailsService=e}}Ye=(0,s.__decorate)([(0,Ie.e)(We.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Ye);var Xe=r(3463);class Ze{execute(){return(0,Ne.D)(this.getTeamPlanDetailsService.getTeamSeats())}constructor(e){this.getTeamPlanDetailsService=e}}Ze=(0,s.__decorate)([(0,Ie.e)(Xe.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],Ze);var Je=r(20270);class et{execute(){return(0,Ne.D)(this.getTeamPlanDetailsService.getTeamSecurityScore())}constructor(e){this.getTeamPlanDetailsService=e}}et=(0,s.__decorate)([(0,Ie.e)(Je.R),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],et);var tt=r(621);class rt{execute(){return this.getTeamPlanDetailsService.getTeamSsoInfo()}constructor(e){this.getTeamPlanDetailsService=e}}rt=(0,s.__decorate)([(0,Ie.e)(tt.m),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],rt);var st=r(22681);class at{execute(){return this.getTeamPlanDetailsService.getTeamTrialStatus()}constructor(e){this.getTeamPlanDetailsService=e}}at=(0,s.__decorate)([(0,Ie.e)(st.P),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G?Object:G])],at);var nt=r(61076),it=r(10729),ot=r(31108),ct=r(32054);class dt{execute(){return this.teamCreatorStore.state$.pipe((0,Q.b)((e=>{e.isLoading||void 0!==e.isTeamCreator||(0,u.z)(this.loadIsTeamCreator())})),(0,F.U)((e=>e.isTeamCreator??null)),(0,N.x)(),(0,F.U)(x.Vp))}constructor(e,t,r,s){this.carbon=e,this.getTeamMembersData=t,this.teamPlanDetailsClient=r,this.teamCreatorStore=s,this.getUserLogin=()=>{const{carbonState:e}=this.carbon.queries;return e({path:"state.userSession.account.login"}).pipe((0,F.U)((e=>{if((0,x.d6)(e)&&"string"==typeof e.data&&""!==e.data)return e.data;throw new Error("No active login")})))},this.getTeamId=()=>{const{getTeamId:e}=this.teamPlanDetailsClient.queries;return e().pipe((0,F.U)((e=>(0,x.hx)(e)||!e.data.teamId||""===e.data.teamId?"":e.data.teamId)))},this.loadIsTeamCreator=()=>{this.teamCreatorStore.set({isLoading:!0});const e=this.getUserLogin();return this.getTeamId().pipe((0,Q.b)((e=>{""===e&&this.teamCreatorStore.set({isTeamCreator:!1,isLoading:!1})})),(0,F.U)((t=>{if(""!==t)return(0,u.z)(this.getTeamMembersData.get(t).pipe((0,nt.V)(e),(0,F.U)((([e,t])=>{if((0,x.hx)(e))throw new Error("Error : could not retrieve team's members");const{data:r}=e,s=r.members.filter((e=>e.isTeamCaptain&&"accepted"===e.status)).sort(((e,t)=>(e.joinedDateUnix??0)-(t.joinedDateUnix??0)));this.teamCreatorStore.set({isTeamCreator:s[0]?.login===t,isLoading:!1})}))))})))}}}dt=(0,s.__decorate)([(0,Ie.e)(it.G7),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A._?Object:A._,void 0===ct.G?Object:ct.G,void 0===ot.e?Object:ot.e,void 0===ie?Object:ie])],dt);class lt{}lt=(0,s.__decorate)([(0,a.Yl)({api:i.o,imports:[n.n,ce.X],providers:[C,H,G,q.k,l.J,re],stores:[$.C,te,ie],handlers:{commands:{addSeats:ue,extendFreeTrial:pe,requestTeamPlanCancellation:he,editTeamName:ve,editTeamPolicies:be,sendFeedback:Se},events:{...(0,a.g4)(d.Q,{sessionOpened:Ce}),...(0,a.g4)(o.L,{membersAdded:Fe})},queries:{getIndustryBenchmarkData:Pe,getTeamActiveDirectoryInfo:xe,getTeamBillingInformation:Oe,getTeamCancellationStatus:Re,getTeamCapabilities:Me,getTeamCreationDateUnix:Ve,getTeamDuoInfo:Be,getTeamId:qe,getTeamName:Ke,getTeamRoles:Qe,getTeamPolicies:Ye,getTeamSeats:Ze,getTeamSecurityScore:et,getTeamSsoInfo:rt,getTeamTrialStatus:at,isTeamCreator:dt}},requiredFeatureFlips:Object.values({DashHackIndustryBenchmarkDev:"dashhack_web_securityScoreBenchmark"})})],lt)},87752:(e,t,r)=>{r.d(t,{k:()=>E});var s=r(88802),a=r(60399),n=r(87065),i=r(82567),o=r(57924),c=r(87113),d=r(87279),l=r(5876),u=r(45836);const p=e=>{switch(e){case"legacy":default:return u.lD.Legacy;case"starter":return u.lD.Starter;case"team":return u.lD.Team;case"business":return u.lD.Business;case"entreprise":return u.lD.Enterprise;case"standard":return u.lD.Standard}},m=e=>{switch(e){case"in_team":return u.yt.InTeam;case"not_premium":return u.yt.NotPremium;case"no_payment":return u.yt.NoPayment;case"is_unpaid_family_member":return u.yt.IsUnpaidFamilyMember;case"default_settings":default:return u.yt.DefaultSettings;case"no_vpn_capability":return u.yt.NoVPNCapability;case"disabled_for_free_user":return u.yt.DisabledForFreeUser}};var h=r(72223);const g=e=>{const{enabled:t,info:r}=e;let s;return r&&(s={limit:r.limit??void 0,maxFileSize:r.maxFileSize??void 0,quota:r.quota??void 0,reason:r.reason?m(r.reason):void 0,excludedPolicies:r.excludedPolicies??void 0}),{enabled:t,info:s}},v=e=>{const{activeDirectorySync:t,activityLog:r,phoneSupport:s,samlProvisioning:a,scim:n,sso:i,usageReports:o,adminPolicies:c,groupSharing:d}=e;return{activeDirectorySync:g(t),activityLog:g(r),phoneSupport:g(s),samlProvisioning:g(a),scim:g(n),sso:g(i),usageReports:g(o),adminPolicies:g(c),groupSharing:g(d)}},f=(e,t)=>({...e,planTier:p(t)}),y=e=>new Set(Object.keys(e)),b=(e,t)=>({activeDirectoryInfo:{activeDirectorySyncType:e.activeDirectorySyncType,activeDirectoryToken:e.activeDirectoryToken,activeDirectorySyncStatus:t},duoInfo:{duo:e.duo,duoApiHostname:e.duoApiHostname,duoIntegrationKey:e.duoIntegrationKey,duoSecretKey:e.duoSecretKey,recoveryEnabled:e.recoveryEnabled},ssoInfo:{ssoServiceProviderUrl:e.ssoServiceProviderUrl,ssoIdpMetadata:e.ssoIdpMetadata,ssoIdpEntrypoint:e.ssoIdpEntrypoint}}),_=(e,t)=>{if(!t||!e)return null;const{averageSecurityScore:r,top25Percentile:s}=t;return{averageSecurityScore:r,top25Percentile:s,ratingVSIndustry:e>r?"higher":e<r?"lower":"onPar",deltaVSIndustry:Math.abs(e-r)}};var S=r(6550);let w=null;class E{async refresh(e){this.teamAdminStore.set({...e,loadingState:"LOADING",lastRefreshDate:Date.now()});const t=await(0,a.z)(this.serverApiClient.v1.teams.getDirectorySyncToken({}).pipe((0,n.U)((e=>{if(!(0,d.hx)(e))return e.data.data.activeDirectorySyncStatus})))),r=await(0,a.z)(this.serverApiClient.v1.teams.teamStatus({}).pipe((0,n.U)((e=>(0,d.hx)(e)?{isBillingOrFullAdmin:!1}:((e,t)=>{const{securityScore:r,industryBenchmarkData:s,creationDateUnix:a,billing:n,capabilities:i,seats:o,planTier:c,info:d}=e,{name:l,groupManagers:u,teamCaptains:p}=d;return{isBillingOrFullAdmin:!0,creationDateUnix:a,loadingState:"LOADED",teamName:l,securityScore:r,industryBenchmarkData:_(r,s),seats:o,capabilities:v(i),billing:f(n,c),teamRoles:{groupManagersIds:u,teamCaptainsIds:y(p)},lastRefreshDate:Date.now(),policies:(0,h.O)(d,i),settings:b(d,t)}})(e.data.data,t))),(0,i.b)((e=>{this.teamAdminStore.set(e)}))));return w=null,r}async refreshState(){if(!await this.isUserTeamAdminService.isUserTeamAdmin())return void this.teamAdminStore.set({isBillingOrFullAdmin:!1,loadingState:"LOADED",lastRefreshDate:0});const e=await this.teamAdminStore.getState();return e.isBillingOrFullAdmin&&e.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now()?void 0:(w||(w=this.refresh(e)),await w)}constructor(e,t,r){this.serverApiClient=e,this.isUserTeamAdminService=t,this.teamAdminStore=r,this.MIN_DELAY_BETWEEN_REFRESHES=500}}E=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.l?Object:c.l,void 0===l.J?Object:l.J,void 0===S.C?Object:S.C])],E)},6550:(e,t,r)=>{r.d(t,{C:()=>_});var s=r(95681),a=r(23347),n=r(25029),i=r(7165),o=r(45836);const c=i.z.union([i.z.object({reason:i.z.union([i.z.custom(),i.z.undefined()]),quota:i.z.union([i.z.object({max:i.z.union([i.z.number(),i.z.undefined()]),remaining:i.z.union([i.z.number(),i.z.undefined()])}),i.z.undefined()]),maxFileSize:i.z.union([i.z.number(),i.z.undefined()]),limit:i.z.union([i.z.number(),i.z.undefined()]),excludedPolicies:i.z.union([i.z.array(i.z.string()),i.z.undefined()])}),i.z.undefined()]),d=i.z.object({paid:i.z.number(),extraFree:i.z.number(),remaining:i.z.number()}),l=i.z.object({billingMethod:i.z.union([i.z.custom(),i.z.undefined()]),creditCardLastDigits:i.z.union([i.z.string(),i.z.undefined()]),isFreeTrial:i.z.boolean(),isGracePeriod:i.z.boolean(),planTier:i.z.custom(),lastBillingDateUnix:i.z.number(),nextBillingDetails:i.z.object({amount:i.z.number(),currency:i.z.union([i.z.literal("eur"),i.z.literal("usd")]),dateUnix:i.z.number()}),usersToBeRenewedCount:i.z.number(),planDetails:i.z.object({currency:i.z.union([i.z.literal("eur"),i.z.literal("usd")]),priceRanges:i.z.array(i.z.object({startMembers:i.z.number(),price:i.z.number(),equivalentPrice:i.z.number()}))})}),u=i.z.object({enabled:i.z.boolean(),info:c}),p=i.z.object({samlProvisioning:u,sso:u,scim:u,phoneSupport:u,activeDirectorySync:u,activityLog:u,usageReports:u,adminPolicies:u,groupSharing:u}),m=i.z.object({lastSuccessfulSync:i.z.union([i.z.object({id:i.z.number(),teamId:i.z.number(),status:i.z.string(),proposedCount:i.z.union([i.z.number(),i.z.undefined()]),reproposedCount:i.z.union([i.z.number(),i.z.undefined()]),unproposedCount:i.z.union([i.z.number(),i.z.undefined()]),removedCount:i.z.union([i.z.number(),i.z.undefined()]),validCount:i.z.union([i.z.number(),i.z.undefined()]),durationMs:i.z.number(),eventDateUnix:i.z.number()}),i.z.null()]),lastFailedSync:i.z.union([i.z.object({id:i.z.number(),teamId:i.z.number(),status:i.z.string(),error:i.z.union([i.z.string(),i.z.undefined()]),durationMs:i.z.number(),eventDateUnix:i.z.number()}),i.z.null(),i.z.undefined()]),failedSyncCount:i.z.union([i.z.number(),i.z.undefined()])}),h=i.z.object({activeDirectoryInfo:i.z.object({activeDirectorySyncType:i.z.union([i.z.string(),i.z.undefined()]),activeDirectoryToken:i.z.union([i.z.string(),i.z.undefined()]),activeDirectorySyncStatus:i.z.union([m,i.z.undefined()])}),duoInfo:i.z.object({duo:i.z.union([i.z.boolean(),i.z.undefined()]),duoApiHostname:i.z.union([i.z.string(),i.z.undefined()]),duoIntegrationKey:i.z.union([i.z.string(),i.z.undefined()]),duoSecretKey:i.z.union([i.z.string(),i.z.undefined()]),recoveryEnabled:i.z.union([i.z.boolean(),i.z.undefined()])}),ssoInfo:i.z.object({ssoServiceProviderUrl:i.z.string().nullable(),ssoIdpMetadata:i.z.string().nullable(),ssoIdpEntrypoint:i.z.string().nullable()})}),g=i.z.enum(["NOT_LOADED","LOADING","LOADED"]),v=i.z.object({isBillingOrFullAdmin:i.z.literal(!0),loadingState:g,lastRefreshDate:i.z.number(),billing:l,seats:d,capabilities:p,securityScore:i.z.number().nullable(),industryBenchmarkData:i.z.custom().nullable(),creationDateUnix:i.z.number(),teamName:i.z.string(),teamRoles:i.z.object({groupManagersIds:i.z.array(i.z.number()),teamCaptainsIds:i.z.set(i.z.string())}),policies:o.ym,settings:h}),f=i.z.object({isBillingOrFullAdmin:i.z.literal(!1),loadingState:g,lastRefreshDate:i.z.number()}),y=i.z.discriminatedUnion("isBillingOrFullAdmin",[v,f]),b=e=>y.safeParse(e).success;class _ extends((0,s.Q)({initialValue:{isBillingOrFullAdmin:!1,lastRefreshDate:0,loadingState:"NOT_LOADED"},storeTypeGuard:b,persist:!1,isCache:!0,scope:n.F.User,storeName:"team-admin-store",capacity:a.Y._010KB})){}},50437:(e,t,r)=>{r.d(t,{c:()=>T});var s=r(88802),a=r(99634),n=r(93850),i=r(27006);var o,c=r(60399),d=r(57924),l=r(87113);!function(e){e.PaymentMeanIsNotCreditCard="PaymentMeanIsNotCreditCard",e.CurrentPlanStartDateInFuture="CurrentPlanStartDateInFuture",e.ChangeTierMidCycleError="ChangeTierMidCycleError",e.PaymentMeanIsNotInvoice="PaymentMeanIsNotInvoice",e.ChangeTierAmountTooExpensive="ChangeTierAmountTooExpensive",e.ErrorCalculatingTierChange="ErrorCalculatingTierChange",e.InsufficientAmount="InsufficientAmount",e.AssignedPlanSameTierAsCurrentPlan="AssignedPlanSameTierAsCurrentPlan",e.SalesTaxMismatch="SalesTaxMismatch",e.NotBillingAdmin="NotBillingAdmin",e.ChangeTierMidCycleInternalServer="ChangeTierMidCycleInternalServer"}(o||(o={}));var u=r(48844),p=r(18533),m=r(20195),h=r(87279);class g{changeTierMidcycle({amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:a,billingContactEmail:n}){return(0,c.z)(this.serverApiClient.v1.teams.changeTierMidCycleV2({amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:a,billingContactEmail:n}).pipe((0,u.DZ)((e=>(0,p.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:m.j,BadStatus:m.j,InternalServerError:()=>({tag:o.ChangeTierMidCycleInternalServer}),InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j,UnspecifiedBadStatus:m.j}))),(0,u.Qn)((e=>e.data))))}getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}){return(0,c.z)(this.serverApiClient.v1.teams.getMidCycleTierUpgradePriceV2({newTotalNumberOfSeats:e,newPlan:t}).pipe((0,u.DZ)((e=>(0,h.Rn)({tag:`MidcycleTierUpgradePriceFailed: ${e.message}`}))),(0,u.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case"PAYMENT_MEAN_IS_NOT_CREDITCARD":return{tag:o.PaymentMeanIsNotCreditCard};case"CURRENT_PLAN_START_DATE_IN_FUTURE":return{tag:o.CurrentPlanStartDateInFuture};case"CHANGE_TIER_MID_CYCLE_ERROR":return{tag:o.ChangeTierMidCycleError};case"PAYMENT_MEAN_IS_NOT_INVOICE":return{tag:o.PaymentMeanIsNotInvoice};case"CHANGE_TIER_AMOUNT_TOO_EXPENSIVE":return{tag:o.ChangeTierAmountTooExpensive};case"ERROR_CALCULATING_TIER_CHANGE_DISCOUNT":return{tag:o.ErrorCalculatingTierChange};case"INSUFFICIENT_AMOUNT":return{tag:o.InsufficientAmount};case"ASSIGNED_PLAN_SAME_TIER_AS_CURRENT_PLAN":return{tag:o.AssignedPlanSameTierAsCurrentPlan};case"sales_tax_mismatch":return{tag:o.SalesTaxMismatch};case"not_billing_admin":return{tag:o.NotBillingAdmin};default:throw new Error(`ChangeTierMidCycle: error ${e}`)}}}}g=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l])],g);var v=r(63663),f=r(33549);class y{execute({body:{amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:a,billingContactEmail:n}}){return this.midcycleTierService.changeTierMidcycle({amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:a,billingContactEmail:n})}constructor(e){this.midcycleTierService=e}}y=(0,s.__decorate)([(0,v.W)(f.G),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g?Object:g])],y);var b=r(20754),_=r(54697);class S{execute({body:{couponCode:e}}){return this.serverApiClient.v1.teams.getTeamOffers({couponCode:e,withStarterOffer:!0}).pipe((0,u.Qn)((e=>e.data)),(0,u.DZ)((e=>{throw new Error(e.message)})))}constructor(e){this.serverApiClient=e}}S=(0,s.__decorate)([(0,b.e)(_.g),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l])],S);var w=r(162),E=r(39127);class C{execute({body:{newTotalNumberOfSeats:e,newPlan:t}}){return(0,w.D)(this.midcycleTierService.getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}))}constructor(e){this.midcycleTierService=e}}C=(0,s.__decorate)([(0,b.e)(E.X),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g?Object:g])],C);class T{}T=(0,s.__decorate)([(0,a.Yl)({api:i.K,imports:[n.n],providers:[g],handlers:{commands:{changeTierMidcycle:y},events:{},queries:{getTeamOffers:S,getMidcycleTierUpgradePrice:C}},requiredFeatureFlips:["monetization_extension_policies_repackage","monetization_extension_policies_revert_notice","monetization_extension_entry_level_plan_dev",...Object.values({EcommerceWebAccountSummaryRevampDev:"ecommerce_web_account_summary_revamp_dev",EcommerceWebAccountSummaryRevampProd:"ecommerce_web_account_summary_revamp"})]})],T)},58172:(e,t,r)=>{r.d(t,{K:()=>N});var s=r(88802),a=r(99634),n=r(93850),i=r(50691),o=r(60399),c=r(85390),d=r(6220),l=r(87065),u=r(57924),p=r(87113),m=r(48844),h=r(87279),g=r(47969),v=r(99706),f=r(38356),y=r(23945),b=r(86252);class _{async deleteTeamVat(){return await(0,o.z)(this.serverApiClient.v1.teams.deleteTeamVat().pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,g.zK)(e.code);throw new Error(e.message)})))),(0,h.Vp)(void 0)}getTeamVat(){return this.serverApiClient.v1.teams.getTeamVat().pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,v.K$)(e.code);throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)(e.data.vatNumber))))}async upsertTeamVat({newVATNumber:e}){return await(0,o.z)(this.serverApiClient.v1.teams.upsertTeamVat({newVATNumber:e}).pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,f.q5)(e.code);throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)(e.data)))))}getExpectedTaxInformation(e){return(0,c.a)([this.getTeamSubscriptionInformation(),this.getUserLogin()]).pipe((0,d.z)((([t,r])=>{if(!t?.billingInformation)throw new Error("Could not retrieve subscription information");const{country:s,address_zip:a}=t.billingInformation;return this.serverApiClient.v1.payments.getExpectedTaxInformation({login:r,zipCode:a??"",country:s??"",taxOrigin:"team",priceInCents:e})})))}constructor(e,t){this.serverApiClient=e,this.carbon=t,this.getTaxAmount=e=>this.getExpectedTaxInformation(e).pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return new y.A;throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)({amount:e.data.expectedTaxesInCents})))),this.getUserLogin=()=>this.carbon.queries.getUserLogin().pipe((0,l.U)((e=>{if((0,h.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")}))),this.getTeamSubscriptionInformation=()=>{const{getSubscriptionInformation:e}=this.carbon.queries;return e().pipe((0,l.U)((e=>{if(!(0,h.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,h.db)(e).b2bSubscription})))}}}_=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===b._?Object:b._])],_);var S=r(63663);class w{execute(){return this.teamVatService.deleteTeamVat()}constructor(e){this.teamVatService=e}}w=(0,s.__decorate)([(0,S.W)(g.Hy),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],w);class E{async execute({body:{newVATNumber:e}}){return await this.teamVatService.upsertTeamVat({newVATNumber:e}),(0,h.Vp)(void 0)}constructor(e){this.teamVatService=e}}E=(0,s.__decorate)([(0,S.W)(f.XW),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],E);var C=r(20754);class T{execute(){return this.teamVatService.getTeamVat()}constructor(e){this.teamVatService=e}}T=(0,s.__decorate)([(0,C.e)(v.N7),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],T);class F{execute({body:e}){const{totalPrice:t}=e;return this.teamVatService.getTaxAmount(t)}constructor(e){this.teamVatService=e}}F=(0,s.__decorate)([(0,C.e)(y.B),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],F);class N{}N=(0,s.__decorate)([(0,a.Yl)({api:i.a,imports:[n.n],providers:[_],handlers:{commands:{deleteTeamVat:w,upsertTeamVat:E},events:{},queries:{getTeamVat:T,getTaxAmount:F}}})],N)},53598:(e,t,r)=>{r.r(t),r.d(t,{CanUserAddNewPasswordQuery:()=>$.K,CollectionsQuery:()=>L.I,Country:()=>y.c,CreateCollectionCommand:()=>k.e,CreateVaultItemCommand:()=>n._,CreatedEvent:()=>d.J,CredentialSchema:()=>S,DeleteCollectionCommand:()=>O.T,DeleteVaultItemsCommand:()=>i.c,DeletedEvent:()=>l.s,DomainIconDetailsMapSchema:()=>b.x,DomainIconDetailsQuery:()=>p.s,DomainIconDetailsSchema:()=>b.N,EmailType:()=>w,EmitTemporaryVaultItemEventCommand:()=>c.c,EventType:()=>c.t,FilterOperators:()=>m.l,GetPasswordLimitStatusQuery:()=>q.r,GetVaultNotificationsStatusQuery:()=>x.M,IdentityTitle:()=>C.t,IsFreeUserFrozenQuery:()=>G.k,NoteColors:()=>F.L,OperationType:()=>R.C,PASSWORD_LIMIT_FEATURE_FLIPS:()=>K.t,PaymentCardColorType:()=>E.X,PhoneType:()=>T.z,RichIconsEnabledQuery:()=>f.M,SecureNoteCategoryQuery:()=>h.F,SecureNoteSchema:()=>F._,SetVaultNotificationsStatusCommand:()=>A.x,SortDirection:()=>g.S,UpdateCollectionCommand:()=>R.s,UpdateVaultItemCommand:()=>o.K,UpdatedEvent:()=>u.V,VaultItemType:()=>N.U,VaultItemTypeToResultDictionary:()=>I.N,VaultItemsCrudClient:()=>a.L,VaultItemsCrudFeatureFlips:()=>U.j,VaultItemsQuery:()=>v.W,VaultOrganizationClient:()=>M.C,VaultSearchClient:()=>V.T,VaultSearchQuery:()=>z.W,passwordLimitApi:()=>B.Z,vaultItemsCrudApi:()=>s.L,vaultNotificationsApi:()=>P.e,vaultOrganizationApi:()=>D.v,vaultSearchApi:()=>j.R});var s=r(70433),a=r(50879),n=r(90404),i=r(78427),o=r(5822),c=r(44594),d=r(25666),l=r(46578),u=r(34086),p=r(17049),m=r(52402),h=r(95736),g=r(93314),v=r(54676),f=r(96900),y=r(44105),b=r(15531),_=r(7165);const S=_.z.object({alternativeUsername:_.z.string(),email:_.z.string(),itemName:_.z.string(),password:_.z.string(),username:_.z.string(),URL:_.z.string(),linkedURLs:_.z.array(_.z.string())});var w,E=r(53214);!function(e){e.Perso="PERSO",e.Pro="PRO",e.NoType="NO_TYPE"}(w||(w={}));var C=r(26311),T=r(7325),F=r(30581),N=r(39431),I=r(29289),U=r(53727),P=r(53234),A=r(67304),x=r(71524),D=r(96124),O=r(38644),k=r(95569),R=r(86342),L=r(42645),M=r(77802),j=r(20281),V=r(22449),z=r(352),B=r(55257),$=r(36723),q=r(70065),G=r(72483),K=r(37470)},55257:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(86952),a=r(36723),n=r(70065),i=r(72483);const o=(0,s.Q)({name:"passwordLimit",commands:{},events:{},queries:{canUserAddNewPassword:a.K,getPasswordLimitStatus:n.r,isFreeUserFrozen:i.k}})},37470:(e,t,r)=>{r.d(t,{t:()=>s});const s={B2CRestrictPasswordFreePlan:"b2c_web_restrict_password_free_plan_dev",B2CFreeUserFrozenState:"b2c_web_free_users_frozen_state"}},36723:(e,t,r)=>{r.d(t,{K:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},70065:(e,t,r)=>{r.d(t,{r:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},72483:(e,t,r)=>{r.d(t,{k:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},70433:(e,t,r)=>{r.d(t,{L:()=>g});var s=r(86952),a=r(90404),n=r(78427),i=r(5822),o=r(44594),c=r(25666),d=r(46578),l=r(34086),u=r(17049),p=r(54676),m=r(95736),h=r(96900);const g=(0,s.Q)({name:"vaultItemsCrud",commands:{createVaultItem:a._,deleteVaultItems:n.c,updateVaultItem:i.K,emitTemporaryVaultItemEvent:o.c},events:{createdEvent:c.J,deletedEvent:d.s,updatedEvent:l.V},queries:{domainIconDetails:u.s,query:p.W,secureNoteCategory:m.F,richIconsEnabled:h.M}})},50879:(e,t,r)=>{r.d(t,{L:()=>n});var s=r(67837),a=r(70433);class n extends((0,s.E)(a.L)){}(0,s.K)(a.L,n)},90404:(e,t,r)=>{r.d(t,{_:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},78427:(e,t,r)=>{r.d(t,{c:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},44594:(e,t,r)=>{r.d(t,{c:()=>i,t:()=>s});var s,a=r(74354),n=r(25029);!function(e){e.Deleted="deleted",e.Updated="updated",e.Created="created"}(s||(s={}));class i extends((0,a.g)({scope:n.F.User})){}},5822:(e,t,r)=>{r.d(t,{K:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},80361:(e,t,r)=>{r.d(t,{D:()=>n});var s=r(88885),a=r(25029);class n extends((0,s.d)({scope:a.F.User})){}},25666:(e,t,r)=>{r.d(t,{J:()=>a});var s=r(80361);class a extends s.D{}},46578:(e,t,r)=>{r.d(t,{s:()=>a});var s=r(80361);class a extends s.D{}},34086:(e,t,r)=>{r.d(t,{V:()=>a});var s=r(80361);class a extends s.D{}},53727:(e,t,r)=>{var s;r.d(t,{j:()=>s}),function(e){e.PasskeysInVaultDev="vault_web_passkey_dev",e.PasskeysInVaultProd="vault_web_passkey_prod",e.RichIconsDev="sharingVault_web_rich_icons_setting"}(s||(s={}))},17049:(e,t,r)=>{r.d(t,{s:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},52402:(e,t,r)=>{var s;r.d(t,{l:()=>s}),function(e){e.Equal="equal",e.LessThan="lessThan",e.GreaterThan="greaterThan"}(s||(s={}))},96900:(e,t,r)=>{r.d(t,{M:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},95736:(e,t,r)=>{r.d(t,{F:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},93314:(e,t,r)=>{var s;r.d(t,{S:()=>s}),function(e){e.Ascend="ascend",e.Descend="descend"}(s||(s={}))},54676:(e,t,r)=>{r.d(t,{W:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},44105:(e,t,r)=>{var s;r.d(t,{c:()=>s}),function(e){e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AQ="AQ",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AX="AX",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BV="BV",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CC="CC",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CX="CX",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.EH="EH",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GS="GS",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HM="HM",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PN="PN",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SJ="SJ",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.UM="UM",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW"}(s||(s={}))},15531:(e,t,r)=>{r.d(t,{N:()=>i,x:()=>o});var s=r(7165);const a=["crawled","xs","sm","sm@2x","md","md.tiff","xmd","xmd@2x","l","l@2x","xl","xl@2x","46x30","46x30@2x","50x33","50x33@2x","56x56","56x56@2x","118x98","118x98@2x","160x106","160x106@2x"];s.z.enum(a);const n=a.reduce(((e,t)=>e.setKey(t,s.z.string().optional().nullable())),s.z.object({})),i=s.z.object({backgroundColor:s.z.string(),mainColor:s.z.string(),urls:n}),o=s.z.map(s.z.string(),i)},53214:(e,t,r)=>{var s;r.d(t,{X:()=>s}),function(e){e.Black="BLACK",e.Blue1="BLUE1",e.Blue2="BLUE2",e.Gold="GOLD",e.Green1="GREEN1",e.Green2="GREEN2",e.Orange="ORANGE",e.Red="RED",e.Silver="SILVER",e.White="WHITE"}(s||(s={}))},26311:(e,t,r)=>{var s;r.d(t,{t:()=>s}),function(e){e.Mr="MR",e.Mrs="MRS",e.Miss="MISS",e.Ms="MS",e.Mx="MX",e.NoneOfThese="NONEOFTHESE"}(s||(s={}))},7325:(e,t,r)=>{var s;r.d(t,{z:()=>s}),function(e){e.Any="ANY",e.Fax="FAX",e.Landline="LANDLINE",e.Mobile="MOBILE",e.WorkFax="WORKFAX",e.WorkLandline="WORKLANDLINE",e.WorkMobile="WORKMOBILE"}(s||(s={}))},30581:(e,t,r)=>{r.d(t,{L:()=>s,_:()=>n});var s,a=r(7165);!function(e){e.BLUE="BLUE",e.BROWN="BROWN",e.GRAY="GRAY",e.GREEN="GREEN",e.ORANGE="ORANGE",e.PINK="PINK",e.PURPLE="PURPLE",e.RED="RED",e.YELLOW="YELLOW"}(s||(s={}));const n=a.z.object({color:a.z.string(),isSecured:a.z.boolean(),title:a.z.string(),content:a.z.string(),categoryId:a.z.string()})},39431:(e,t,r)=>{var s;r.d(t,{U:()=>s}),function(e){e.Address="KWAddress",e.BankAccount="KWBankStatement",e.Company="KWCompany",e.Credential="KWAuthentifiant",e.DriversLicense="KWDriverLicence",e.Email="KWEmail",e.FiscalId="KWFiscalStatement",e.IdCard="KWIDCard",e.Identity="KWIdentity",e.Passkey="KWPasskey",e.Passport="KWPassport",e.PaymentCard="KWPaymentMean_creditCard",e.Phone="KWPhone",e.Secret="KWSecret",e.SecureNote="KWSecureNote",e.SocialSecurityId="KWSocialSecurityStatement",e.Website="KWPersonalWebsite"}(s||(s={}))},29289:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(39431);const a={[s.U.Address]:"addressesResult",[s.U.BankAccount]:"bankAccountsResult",[s.U.Company]:"companiesResult",[s.U.Credential]:"credentialsResult",[s.U.DriversLicense]:"driversLicensesResult",[s.U.Email]:"emailsResult",[s.U.FiscalId]:"fiscalIdsResult",[s.U.IdCard]:"idCardsResult",[s.U.Identity]:"identitiesResult",[s.U.Passkey]:"passkeysResult",[s.U.Passport]:"passportsResult",[s.U.PaymentCard]:"paymentCardsResult",[s.U.Phone]:"phonesResult",[s.U.Secret]:"secretsResult",[s.U.SecureNote]:"secureNotesResult",[s.U.SocialSecurityId]:"socialSecurityIdsResult",[s.U.Website]:"websitesResult"}},53234:(e,t,r)=>{r.d(t,{e:()=>i});var s=r(86952),a=r(67304),n=r(71524);const i=(0,s.Q)({name:"vaultNotifications",commands:{setVaultNotificationsStatus:a.x},events:{},queries:{getVaultNotificationsStatus:n.M}})},67304:(e,t,r)=>{r.d(t,{x:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},71524:(e,t,r)=>{r.d(t,{M:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},96124:(e,t,r)=>{r.d(t,{v:()=>c});var s=r(86952),a=r(38644),n=r(95569),i=r(86342),o=r(42645);const c=(0,s.Q)({name:"vaultOrganization",commands:{deleteCollection:a.T,createCollection:n.e,updateCollection:i.s},events:{},queries:{queryCollections:o.I}})},95569:(e,t,r)=>{r.d(t,{e:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},38644:(e,t,r)=>{r.d(t,{T:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},86342:(e,t,r)=>{r.d(t,{C:()=>s,s:()=>i});var s,a=r(74354),n=r(25029);!function(e){e.SUBSTRACT_VAULT_ITEMS="subtract_vault_items",e.APPEND_VAULT_ITEMS="append_vault_items"}(s||(s={}));class i extends((0,a.g)({scope:n.F.User})){}},42645:(e,t,r)=>{r.d(t,{I:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},77802:(e,t,r)=>{r.d(t,{C:()=>n});var s=r(67837),a=r(96124);class n extends((0,s.E)(a.v)){}(0,s.K)(a.v,n)},20281:(e,t,r)=>{r.d(t,{R:()=>n});var s=r(86952),a=r(352);const n=(0,s.Q)({name:"vaultSearch",commands:{},events:{},queries:{search:a.W}})},22449:(e,t,r)=>{r.d(t,{T:()=>n});var s=r(67837),a=r(20281);class n extends((0,s.E)(a.R)){}(0,s.K)(a.R,n)},352:(e,t,r)=>{r.d(t,{W:()=>n});var s=r(99059),a=r(25029);class n extends((0,s.k)({scope:a.F.User})){}},89434:(e,t,r)=>{r.d(t,{a:()=>F});var s=r(88802),a=r(99634),n=r(55257),i=r(37470),o=r(85390),c=r(87065),d=r(20754),l=r(87279),u=r(36723),p=r(6136),m=r(43978),h=r(69885),g=r(86252),v=r(57924),f=r(39431),y=r(71860);class b{constructor(e,t){this.carbon=e,this.vaultRepository=t,this.isPasswordLimitEnabled=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.enabled??!1))),this.getNumberOfPasswordsLeft=()=>{const e=this._getCredentialCount(),t=this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.info?.limit)));return(0,o.a)([e,t]).pipe((0,c.U)((([e,t])=>{if("number"==typeof t)return t-e})))},this.isFreeUserFrozen=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.enabled&&"enforce_freeze"===e.info?.action&&e.info?.limit)),(0,p.x)()).pipe((0,m.w)((e=>e?this._getCredentialCount().pipe((0,c.U)((t=>t>e))):(0,h.of)(!1)))),this.getCurrentPasswordLimit=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>{if(e?.enabled&&!e.info?.limit&&0!==e.info?.limit)throw new Error("Cannot get password limit from server");return e?.info?.limit}))),this._getPasswordsLimitCapability=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,c.U)((e=>{if(!(0,l.d6)(e))throw new Error("Cannot retrieve node premium status from carbon");return(0,l.db)(e).capabilities?.passwordsLimit}))),this._getCredentialCount=()=>this.vaultRepository.fetchVaultItems$({vaultItemTypes:[f.U.Credential]}).pipe((0,c.U)((e=>{if(!(0,l.d6)(e))throw new Error("Cannot retrieve credentials from vault");return(0,l.db)(e).credentialsResult.matchCount})))}}b=(0,s.__decorate)([(0,v.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._,void 0===y.g?Object:y.g])],b);class _{execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft();return(0,o.a)(e,t).pipe((0,c.U)((([e,t])=>e&&"number"==typeof t?(0,l.Vp)(t>0):(0,l.Vp)(!0))))}constructor(e){this.passwordLimitRepository=e}}_=(0,s.__decorate)([(0,d.e)(u.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b])],_);var S=r(62760),w=r(70065);class E{execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft(),r=this.passwordLimitRepository.getCurrentPasswordLimit();return(0,o.a)([e,t,r]).pipe((0,c.U)((([e,t,r])=>e&&"number"==typeof t&&"number"==typeof r?{hasLimit:e,passwordsLeft:t,limit:r}:{hasLimit:!1})),(0,p.x)(S.shallowEqualObjects),(0,c.U)(l.Vp))}constructor(e){this.passwordLimitRepository=e}}E=(0,s.__decorate)([(0,d.e)(w.r),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b])],E);var C=r(72483);class T{execute(){return this.passwordLimitRepository.isFreeUserFrozen().pipe((0,p.x)(),(0,c.U)(l.Vp))}constructor(e){this.passwordLimitRepository=e}}T=(0,s.__decorate)([(0,d.e)(C.k),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b])],T);class F{}F=(0,s.__decorate)([(0,a.Yl)({api:n.Z,stores:[],handlers:{commands:{},events:{},queries:{canUserAddNewPassword:_,getPasswordLimitStatus:E,isFreeUserFrozen:T}},providers:[y.g,b],requiredFeatureFlips:[...Object.values(i.t)]})],F)},42931:(e,t,r)=>{r.d(t,{z:()=>J});var s=r(88802),a=r(99634),n=r(37935),i=r(70433),o=r(53727),c=r(81459),d=r(57924);class l extends c.f{}l=(0,s.__decorate)([(0,d.GS)()],l);var u=r(63663),p=r(87279),m=r(86252),h=r(39431),g=r(90404),v=r(26461),f=r(18952),y=r(26311),b=r(53214),_=r(7325),S=r(44105);const w={[y.t.Mr]:"MR",[y.t.Mrs]:"MME",[y.t.Miss]:"MLLE",[y.t.Ms]:"MS",[y.t.Mx]:"MX",[y.t.NoneOfThese]:"NONE_OF_THESE"},E={[b.X.Black]:v.LR.BLACK,[b.X.Blue1]:v.LR.BLUE_1,[b.X.Blue2]:v.LR.BLUE_2,[b.X.Gold]:v.LR.GOLD,[b.X.Green1]:v.LR.GREEN_1,[b.X.Green2]:v.LR.GREEN_2,[b.X.Orange]:v.LR.ORANGE,[b.X.Red]:v.LR.RED,[b.X.Silver]:v.LR.SILVER,[b.X.White]:v.LR.WHITE},C={[_.z.Any]:f.z.PHONE_TYPE_ANY,[_.z.Fax]:f.z.PHONE_TYPE_FAX,[_.z.Landline]:f.z.PHONE_TYPE_LANDLINE,[_.z.Mobile]:f.z.PHONE_TYPE_MOBILE,[_.z.WorkFax]:f.z.PHONE_TYPE_WORK_FAX,[_.z.WorkLandline]:f.z.PHONE_TYPE_WORK_LANDLINE,[_.z.WorkMobile]:f.z.PHONE_TYPE_WORK_MOBILE},T=e=>e?Date.parse(e)/1e3:null,F={[h.U.Address]:e=>({addressFull:e.streetName,addressName:e.itemName,linkedPhone:e.linkedPhoneId,...e}),[h.U.BankAccount]:e=>({...e,bank:e.bankCode,localeFormat:e.country||S.c.US,name:e.accountName,owner:e.ownerName}),[h.U.Company]:e=>({name:e.companyName,...e}),[h.U.Credential]:e=>({login:e.username,otpUrl:e.otpURL,otpSecret:e.otpSecret,secondaryLogin:e.alternativeUsername,title:e.itemName,url:e.URL,linkedWebsites:{addedByUser:e.linkedURLs},...e}),[h.U.DriversLicense]:e=>({...e,country:e.country??S.c.US,expirationDate:T(e.expirationDate),idNumber:e.idNumber??"",issueDate:T(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",state:e.state??""}),[h.U.Email]:e=>({email:e.emailAddress,emailName:e.itemName,...e}),[h.U.FiscalId]:e=>({...e,country:e.country??S.c.US,idNumber:e.fiscalNumber??"",spaceId:e.spaceId??"",teledeclarantNumber:e.teledeclarantNumber??""}),[h.U.IdCard]:e=>({...e,country:e.country??S.c.US,expirationDate:T(e.expirationDate),idNumber:e.idNumber??"",issueDate:T(e.issueDate),name:e.idName??"",spaceId:e.spaceId??""}),[h.U.Identity]:e=>({...e,title:e.title?w[e.title]:void 0}),[h.U.Passkey]:e=>({...e}),[h.U.Passport]:e=>({...e,country:e.country??S.c.US,expirationDate:T(e.expirationDate),idNumber:e.idNumber??"",issueDate:T(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",deliveryPlace:e.issuePlace??""}),[h.U.PaymentCard]:e=>({...e,cardName:e.itemName,color:e.color?E[e.color]:void 0,personalNote:e.note}),[h.U.Phone]:e=>({...e,phoneName:e.itemName,number:e.phoneNumber,type:e.type?C[e.type]:void 0}),[h.U.Secret]:e=>({...e,secured:e.isSecured}),[h.U.SecureNote]:e=>({...e}),[h.U.SocialSecurityId]:e=>({...e,country:e.country??S.c.US,idNumber:e.idNumber??"",name:e.idName??"",spaceId:e.spaceId??""}),[h.U.Website]:e=>({name:e.itemName,website:e.URL,...e})};class N{async execute({body:e}){const{vaultItemType:t,content:r,shouldSkipSync:s}=e;if([h.U.DriversLicense,h.U.FiscalId,h.U.IdCard,h.U.Passport,h.U.SocialSecurityId].includes(t))return this.createId(t,r);if(t===h.U.Passkey)return this.createPasskey(r);const{commands:a}=this.carbonLegacyClient,n=await a.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:t,origin:"MANUAL",content:F[t](r),shouldSkipSync:s}]});if((0,p.hx)(n))return this.handleError(t);const i=(0,p.db)(n).carbonResult;return this.handleSuccess(t,i.itemId)}handleError(e){return Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to create ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("created",{ids:[t],vaultItemType:e}),Promise.resolve((0,p.Vp)({id:t}))}async createId(e,t){const{commands:{addDriverLicense:r,addFiscalId:s,addIdCard:a,addPassport:n,addSocialSecurityId:i}}=this.carbonLegacyClient,o={[h.U.DriversLicense]:r,[h.U.FiscalId]:s,[h.U.IdCard]:a,[h.U.Passport]:n,[h.U.SocialSecurityId]:i},c=await o[e](F[e](t));return(0,p.hx)(c)?this.handleError(e):this.handleSuccess(e,(0,p.db)(c).id)}async createPasskey(e){const{commands:{addPasskey:t}}=this.carbonLegacyClient,r=await t(e);return(0,p.hx)(r)?this.handleError(h.U.Passkey):this.handleSuccess(h.U.Passkey,(0,p.db)(r).id)}constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}}N=(0,s.__decorate)([(0,u.W)(g._),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l])],N);var I=r(21877),U=r(78427),P=r(4174);class A{async execute({body:e}){const{vaultItemType:t,ids:r}=e,{commands:s}=this.carbonLegacyClient,a=[],n=r.map((e=>s.carbonLegacyLeeloo({name:"removePersonalDataItem",arg:[{id:e}]}).then((t=>{(0,p.d6)(t)&&a.push(e)}))));return await Promise.allSettled(n),a.length>0&&this.eventEmitter.sendEvent("deleted",{ids:a,vaultItemType:t}),await s.removeItemsFromCollections({ids:r}),a.length!==r.length?Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Error: Failed to delete all ${t}s`,failedDeletionIds:r.filter((e=>!a.includes(e)))})):(await this.syncClient.commands.sync({trigger:I.Trigger.Save}),Promise.resolve((0,p.Vp)(void 0)))}constructor(e,t,r){this.carbonLegacyClient=e,this.eventEmitter=t,this.syncClient=r}}A=(0,s.__decorate)([(0,u.W)(U.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l,void 0===P.Q?Object:P.Q])],A);var x=r(5822);class D{async execute({body:e}){const{content:t,id:r,vaultItemType:s,shouldSkipSync:a}=e;if([h.U.DriversLicense,h.U.FiscalId,h.U.IdCard,h.U.Passport,h.U.SocialSecurityId].includes(s))return this.updateId(s,t,r);if(s===h.U.Passkey)return this.updatePasskey(t,r);const{commands:n}=this.carbonLegacyClient,i=await n.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:s,origin:"MANUAL",content:{...F[s](t),id:r},shouldSkipSync:a}]});return(0,p.hx)(i)?Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to update ${s}`})):(this.eventEmitter.sendEvent("updated",{ids:[r],vaultItemType:s}),Promise.resolve((0,p.Vp)(void 0)))}handleError(e){return Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to update ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("updated",{ids:[t],vaultItemType:e}),Promise.resolve((0,p.Vp)(void 0))}async updateId(e,t,r){const{commands:{editDriverLicense:s,editFiscalId:a,editIdCard:n,editPassport:i,editSocialSecurityId:o}}=this.carbonLegacyClient,c={[h.U.DriversLicense]:s,[h.U.FiscalId]:a,[h.U.IdCard]:n,[h.U.Passport]:i,[h.U.SocialSecurityId]:o},d=await c[e]({...F[e](t),id:r});return(0,p.hx)(d)?this.handleError(e):this.handleSuccess(e,r)}async updatePasskey(e,t){const{commands:{updatePasskey:r}}=this.carbonLegacyClient,s=await r({...e,id:t});return(0,p.hx)(s)?this.handleError(h.U.Passkey):this.handleSuccess(h.U.Passkey,t)}constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}}D=(0,s.__decorate)([(0,u.W)(x.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l])],D);var O=r(44594);class k{execute({body:e}){const{ids:t,eventType:r}=e;return this.eventEmitter.sendEvent(r,{ids:t,vaultItemType:h.U.Credential}),Promise.resolve((0,p.Vp)(void 0))}constructor(e){this.eventEmitter=e}}k=(0,s.__decorate)([(0,u.W)(O.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l?Object:l])],k);var R=r(20754),L=r(17049),M=r(48844),j=r(60733),V=r(96303),z=r(54066),B=r(15531);class ${execute({body:{domain:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.iconsCache.domains"}).pipe((0,M.Qn)((t=>{if(r=t,!B.x.safeParse(r).success)throw new Error("Bad domain icons cache format");var r;return t.get((0,V.k)(this.md5Hasher.compute((0,z.u)(e))))})))}constructor(e,t){this.carbonLegacyClient=e,this.md5Hasher=t}}$=(0,s.__decorate)([(0,R.e)(L.s),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===j.f?Object:j.f])],$);var q=r(54676),G=r(71860);class K{execute({body:e}){return this.vaultRepository.fetchVaultItems$(e)}constructor(e){this.vaultRepository=e}}K=(0,s.__decorate)([(0,R.e)(q.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G.g?Object:G.g])],K);var H=r(95736);class Q{execute({body:{id:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.personalData.noteCategories"}).pipe((0,M.Qn)((t=>{if(r=t,!Array.isArray(r)||0!==r.length&&"KWSecureNoteCategory"!==r[0].kwType)throw new Error("Bad secure note category format");var r;if(void 0===e)return t;const s=t.find((t=>t.Id===e))?.CategoryName;return s})))}constructor(e){this.carbonLegacyClient=e}}Q=(0,s.__decorate)([(0,R.e)(H.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._])],Q);var W=r(96900),Y=r(86213);const X=e=>{if(!e)return{richIconsEnabled:!0};const t=e;if(!(0,Y.u)(t.spaces))return{richIconsEnabled:!0};const r=t.spaces.find((e=>"accepted"===e.status));return{richIconsEnabled:r?.info.richIconsEnabled??!0}};class Z{get(){const{getNodePremiumStatus:e}=this.carbon.queries;return e().pipe((0,M.Qn)(X))}execute(){return this.get().pipe((0,M.Qn)((e=>e.richIconsEnabled)))}constructor(e){this.carbon=e}}Z=(0,s.__decorate)([(0,R.e)(W.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._])],Z);class J{}J=(0,s.__decorate)([(0,a.Yl)({api:i.L,handlers:{commands:{createVaultItem:N,deleteVaultItems:A,updateVaultItem:D,emitTemporaryVaultItemEvent:k},events:{},queries:{domainIconDetails:$,query:K,secureNoteCategory:Q,richIconsEnabled:Z}},imports:[n.D],providers:[l,G.g],requiredFeatureFlips:Object.values(o.j)})],J)},14186:(e,t,r)=>{r.d(t,{K:()=>S});var s=r(88802),a=r(99634),n=r(53234),i=r(95681),o=r(23347),c=r(25029),d=r(10722);const l=e=>!(!e||"object"!=typeof e)&&"isCollectionGuidedIntroEnabled"in e,u={isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1};class p extends((0,i.Q)({persist:!0,storage:{initialValue:u,typeGuard:l,schemaVersion:2,migrateStorageSchema:()=>({isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1})},scope:c.F.User,storeName:"vault-notifications",capacity:o.Y._001KB,codec:d.E})){}var m=r(63663),h=r(87279),g=r(67304);class v{async execute({body:e}){const{notificationName:t,isEnabled:r}=e;try{const e=await this.store.getState();return await this.store.set({...e,[t]:r}),(0,h.Vp)(void 0)}catch{throw new Error("SetVaultNotificationsStatus command from vault-core failed")}}constructor(e){this.store=e}}v=(0,s.__decorate)([(0,m.W)(g.x),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p])],v);var f=r(87065),y=r(20754),b=r(71524);class _{execute(){return this.store.state$.pipe((0,f.U)(h.Vp))}constructor(e){this.store=e}}_=(0,s.__decorate)([(0,y.e)(b.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p])],_);class S{}S=(0,s.__decorate)([(0,a.Yl)({api:n.e,handlers:{commands:{setVaultNotificationsStatus:v},events:{},queries:{getVaultNotificationsStatus:_}},stores:[p]})],S)},62346:(e,t,r)=>{r.d(t,{H:()=>M});var s=r(88802),a=r(99634),n=r(96124),i=r(25029),o=r(95681),c=r(23347),d=r(10722);const l=e=>!0;class u extends((0,o.Q)({persist:!0,scope:i.F.Device,storeName:"collections-store",storeTypeGuard:l,capacity:c.Y._001KB,codec:d.E,storage:{schemaVersion:3,initialValue:{isCredentialCategoriesMigrated:{}},typeGuard:l,migrateStorageSchema:()=>({isCredentialCategoriesMigrated:{}})}})){}var p=r(60399),m=r(38644),h=r(63663),g=r(86252),v=r(87279),f=r(21877),y=r(55920),b=r(91943),_=r(48844);const S=e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&"string"==typeof t.Name&&Array.isArray(t.VaultItems)})));function w(e,t){const{queries:{carbonState:r}}=e;return r({path:"userSession.personalData.collections"}).pipe((0,_.Qn)((e=>{if(!S(e))throw new Error("Collection array has a wrong format");return{collections:(t&&t.length>0?e.filter((e=>t.includes(e.Id))):e).map((e=>({id:e.Id,name:e.Name,spaceId:e.SpaceId??"",vaultItems:e.VaultItems.map((e=>({id:e.Id,type:e.Type})))})))}})))}function E(e,t,r,s){const a=new f.UserUpdateCollectionEvent({collectionId:r,action:t,itemCount:s,isShared:!1});return e.commands.carbon({name:"logEvent",args:[{event:a}]})}var C=r(78776);const T=(e,t)=>({log_type:e,category:y.p.VaultCollections,date_time:(new Date).getTime(),schema_version:"1.0.0",is_sensitive:!0,uuid:(0,C.Z)().toUpperCase(),properties:t});class F{async execute({body:e}){const{id:t,name:r=""}=e,s=await(0,p.z)(w(this.carbonLegacyClient,[t]));if((0,v.hx)(s))throw new Error(`Failed to fetch additional collection info: ${s.error}`);const a=await this.carbonLegacyClient.commands.carbon({name:"deleteCollection",args:[{id:t}]});if((0,v.hx)(a))throw new Error(`Failed to delete collection: ${a.error}`);E(this.carbonLegacyClient,f.CollectionAction.Delete,t,s.data.collections[0]?.vaultItems?.length);const n={collection_name:r},i=T(y.z.UserDeletedCollection,n);return this.activityLogs.commands.storeActivityLogs({activityLogs:[i]}),Promise.resolve((0,v.Vp)(void 0))}constructor(e,t){this.carbonLegacyClient=e,this.activityLogs=t}}F=(0,s.__decorate)([(0,h.W)(m.T),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._,void 0===b._?Object:b._])],F);var N=r(95569),I=r(28489);class U{async execute({body:e}){const{content:{name:t,spaceId:r="",vaultItems:s=[]}}=e,a=await this.carbonLegacy.commands.carbon({name:"addCollection",args:[{name:t,spaceId:r,vaultItems:s}]});if((0,v.hx)(a))throw new Error(`Failed to create collection: ${a.error}`);if("object"!=typeof(n=a.data.carbonResult)||null===n||!(0,I.l$)(n,"id")||"string"!=typeof n.id||!(0,I.l$)(n,"success")||"boolean"!=typeof n.success)throw new Error("Failed to find created collection id");var n;if(r){const e={collection_name:t},r=[T(y.z.UserCreatedCollection,e)];this.activityLogs.commands.storeActivityLogs({activityLogs:r})}return E(this.carbonLegacy,f.CollectionAction.Add,a.data.carbonResult.id,s.length),s.length&&E(this.carbonLegacy,f.CollectionAction.AddCredential,a.data.carbonResult.id,s.length),(0,v.Vp)({id:a.data.id})}constructor(e,t){this.activityLogs=e,this.activityLogs=e,this.carbonLegacy=t}}U=(0,s.__decorate)([(0,h.W)(N.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b._?Object:b._,void 0===g._?Object:g._])],U);var P=r(86342),A=r(39431),x=r(50879),D=r(64718);class O{async execute({body:e}){const{id:t,collection:r,operationType:s=P.C.APPEND_VAULT_ITEMS}=e,a=await(0,p.z)(w(this.carbonLegacyClient,[t]));if((0,v.hx)(a))throw new Error(`Failed to fetch additional collection info: ${a.error}`);const n=a.data.collections[0];let i;if(r.vaultItems){const e=await(0,p.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[A.U.Credential,A.U.SecureNote],ids:r.vaultItems.map((e=>e.id))}));if((0,v.hx)(e))throw new Error("Unable to find items in collection");const t=e.data.credentialsResult.items,a=e.data.secureNotesResult.items,o=[...t.map((e=>({id:e.id,type:A.U.Credential,url:e.URL}))),...a.map((e=>({id:e.id,type:A.U.SecureNote})))];i={id:r.id,name:r.name,spaceId:r.spaceId,vaultItems:o},n.vaultItems=this.mutateCollectionVaultItems(n,s,o)}else i={id:r.id,name:r.name,spaceId:r.spaceId};const o=await this.carbonLegacyClient.commands.carbon({name:"updateCollection",args:[{id:n.id,name:r.name??n.name,spaceId:r.spaceId??n.spaceId,vaultItems:n.vaultItems}]});if((0,v.hx)(o))throw new Error(`Failed to update collection: ${o.error}`);return this.handleLogs(n,i,s),Promise.resolve((0,v.Vp)(void 0))}handleLogs(e,t,r){let s=null;const a={};if(t.name&&(E(this.carbonLegacyClient,f.CollectionAction.Edit,e.id,e.vaultItems.length),t.name!==e.name&&(s=y.z.UserRenamedCollection,a.collection_name=t.name,a.old_collection_name=e.name)),t.vaultItems&&(E(this.carbonLegacyClient,r===P.C.SUBSTRACT_VAULT_ITEMS?f.CollectionAction.DeleteCredential:f.CollectionAction.AddCredential,e.id,1),t.vaultItems[0]?.type===A.U.Credential&&(s=r===P.C.APPEND_VAULT_ITEMS?y.z.UserAddedCredentialToCollection:y.z.UserRemovedCredentialFromCollection,a.collection_name=e.name,a.domain_url=new D.Y(t.vaultItems[0].url).getRootDomain())),e.spaceId&&s){const e=T(s,a);this.activityLogs.commands.storeActivityLogs({activityLogs:[e]})}}getDeduplicatedList(e){return[...new Map(e.map((e=>[e.id,e]))).values()]}mutateCollectionVaultItems(e,t,r){return t===P.C.SUBSTRACT_VAULT_ITEMS?e.vaultItems.filter((e=>!r.some((t=>t.id===e.id)))):this.getDeduplicatedList([...e.vaultItems,...r])}constructor(e,t,r){this.carbonLegacyClient=e,this.activityLogs=t,this.vaultItemsCrudClient=r}}O=(0,s.__decorate)([(0,h.W)(P.s),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._,void 0===b._?Object:b._,void 0===x.L?Object:x.L])],O);var k=r(42645),R=r(20754);class L{execute({body:e}){const{ids:t}=e;return w(this.carbonLegacyClient,t)}constructor(e){this.carbonLegacyClient=e}}L=(0,s.__decorate)([(0,R.e)(k.I),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._])],L);class M{}M=(0,s.__decorate)([(0,a.Yl)({api:n.v,stores:[u],handlers:{commands:{deleteCollection:F,createCollection:U,updateCollection:O},events:{},queries:{queryCollections:L}},requiredFeatureFlips:["vault_web_collection_migration_space_prod_v2","vault_web_popupSavedState_release","sharingVault_web_bulkaddtocollection_dev"]})],M)},86213:(e,t,r)=>{r.d(t,{u:()=>s});const s=e=>function(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const r=e[0];for(let e=0;e<t.length;e++){const s=t[e];if(!Object.prototype.hasOwnProperty.call(r,s))return!1}return!0}(e,["teamId"])},71860:(e,t,r)=>{r.d(t,{g:()=>pe});var s=r(88802),a=r(85390),n=r(87065),i=r(6136),o=r(57924),c=r(87279),d=r(48844),l=r(86252),u=r(29289),p=r(39431),m=r(52402),h=r(92481);function g(e,t){return e in t}function v(e){const t={};for(const r in e)t[r.charAt(0).toLowerCase()+r.slice(1)]=e[r];return t}const f=e=>{if(!e||3!==e.split("-").length)return"";const t=e.split("-"),r=Number(t[0]),s=Number(t[1])-1,a=Number(t[2]);return(0,h.Z)(new Date(r,s,a),"yyyy-MM-dd")};function y(e,t,r){return t||r?e.filter((e=>!(t&&!t.every((t=>g(t.property,e)&&function(e,t,r=m.l.Equal){return{[m.l.Equal]:()=>e===t,[m.l.LessThan]:()=>e<t,[m.l.GreaterThan]:()=>e>t}[r]()}(e[t.property],t.value,t.operator))))&&(r?.(e)??!0))):e}var b=r(93314);function _(e,t){if(!t||!e.length||!g(t.property,e[0]))return e;const r=t.property,s=t.direction||b.S.Ascend;return e.sort(((e,t)=>{const a=e[r],n=t[r];return a||n?a?n?function(e,t,r){const s=Number(e),a=Number(t);return"string"==typeof e&&"string"==typeof t?r===b.S.Ascend?e.localeCompare(t):t.localeCompare(e):"number"==typeof e&&"number"==typeof t?r===b.S.Ascend?e-t:t-e:isNaN(s)||isNaN(a)?0:r===b.S.Ascend?s-a:a-s}(a,n,s):s===b.S.Ascend?1:-1:s===b.S.Ascend?-1:1:0}))}function S(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;return e[0].kwType===t}const w=e=>S(e,p.U.Secret),E=e=>{const{LocaleFormat:t,Secured:r,...s}=e;return{...v(s),isSecured:r}},C=e=>S(e,p.U.Address),T=e=>S(e,p.U.Company),F=e=>S(e,p.U.Email),N=e=>S(e,p.U.Identity),I=e=>S(e,p.U.Phone),U=e=>S(e,p.U.Website);var P=r(86213);const A=e=>{const{AddressName:t,LinkedPhone:r,StreetName:s,AddressFull:a,StateLevel2:n,...i}=e;return{...v(i),itemName:t,linkedPhoneId:r,streetName:s||a}},x=e=>S(e,p.U.BankAccount),D=e=>{const{BankAccountName:t,BankAccountOwner:r,BankAccountIBAN:s,BankAccountBIC:a,BankAccountBank:n,...i}=e,o=n?.split("-"),c=o?.length>1?o[1]??n:n;return{...v(i),accountName:t,bankCode:c||"",BIC:a,country:i.LocaleFormat,IBAN:s,ownerName:r}},O=e=>{const{Name:t,PersonalNote:r,LocaleFormat:s,...a}=e;return{...v(a),companyName:t}},k=e=>S(e,p.U.Credential),R=e=>{const{CreationDatetime:t,Email:r,Id:s,LastBackupTime:a,LastUse:n,LinkedServices:i,Login:o,Note:c,OtpSecret:d,OtpUrl:l,Password:u,SecondaryLogin:p,SpaceId:m,Title:h,Url:g,UserModificationDatetime:f,UserSelectedUrl:y}=e;return{...v({CreationDatetime:t,Email:r,Id:s,LastBackupTime:a,LastUse:n,Note:c,Password:u,SpaceId:m,UserModificationDatetime:f}),alternativeUsername:p,itemName:h??"",linkedURLs:i?.associated_domains.map((e=>e.domain))??[],otpURL:l,otpSecret:d,URL:g||y||"",username:o}},L=e=>S(e,p.U.DriversLicense),M=e=>S(e,p.U.FiscalId),j=e=>S(e,p.U.IdCard),V=e=>S(e,p.U.Passport),z=e=>S(e,p.U.SocialSecurityId),B=e=>e?[e.FirstName,e.MiddleName,e.LastName,e.LastName2].filter(Boolean).join(" "):"",$=(e,t)=>{const{DeliveryDate:r,ExpireDate:s,Fullname:a,Number:n,DateOfBirth:i,Sex:o,...c}=e;return{...v(c),idName:B(t)||a||"",idNumber:n,issueDate:f(r),expirationDate:f(s),country:c.LocaleFormat}},q=e=>{const{EmailName:t,Email:r,Type:s,LocaleFormat:a,...n}=e;return{...v(n),itemName:t,emailAddress:r,type:s}},G=e=>({...v(e),country:e.LocaleFormat}),K=(e,t)=>{const{DateOfBirth:r,DeliveryDate:s,ExpireDate:a,Fullname:n,Number:i,Sex:o,...c}=e;return{...v(c),idName:B(t)||n||"",idNumber:i,issueDate:f(s),expirationDate:f(a),country:c.LocaleFormat}};var H=r(26311);const Q={"":void 0,MR:H.t.Mr,MME:H.t.Mrs,MLLE:H.t.Miss,MS:H.t.Ms,MX:H.t.Mx,NONE_OF_THESE:H.t.NoneOfThese},W=e=>{const{Title:t,LocaleFormat:r,...s}=e;return{...v(s),title:Q[t]}},Y=e=>S(e,p.U.Passkey),X=(e,t)=>{const{DeliveryDate:r,DeliveryPlace:s,ExpireDate:a,Fullname:n,Number:i,DateOfBirth:o,Sex:c,...d}=e;return{...v(d),idName:B(t)||n||"",idNumber:i||"",issueDate:f(r),issuePlace:s||"",expirationDate:f(a),country:d.LocaleFormat}},Z=e=>S(e,p.U.PaymentCard);var J=r(53214);const ee={BLACK:J.X.Black,BLUE_1:J.X.Blue1,BLUE_2:J.X.Blue2,GOLD:J.X.Gold,GREEN_1:J.X.Green1,GREEN_2:J.X.Green2,ORANGE:J.X.Orange,RED:J.X.Red,SILVER:J.X.Silver,WHITE:J.X.White},te=e=>{const{Name:t,CCNote:r,Color:s,Bank:a,CardNumberLastDigits:n,IssueNumber:i,StartMonth:o,StartYear:c,Type:d,LocaleFormat:l,...u}=e;return{...v(u),itemName:t,color:ee[s],note:r||""}};var re=r(18952),se=r(7325);const ae={[re.z.PHONE_TYPE_ANY]:se.z.Any,[re.z.PHONE_TYPE_FAX]:se.z.Fax,[re.z.PHONE_TYPE_LANDLINE]:se.z.Landline,[re.z.PHONE_TYPE_MOBILE]:se.z.Mobile,[re.z.PHONE_TYPE_WORK_FAX]:se.z.WorkFax,[re.z.PHONE_TYPE_WORK_LANDLINE]:se.z.WorkLandline,[re.z.PHONE_TYPE_WORK_MOBILE]:se.z.WorkMobile},ne=e=>{const{PhoneName:t,Number:r,Type:s,...a}=e;return{...v(a),itemName:t,phoneNumber:r,type:ae[s]}},ie=e=>S(e,p.U.SecureNote);var oe=r(30581);const ce=e=>{const{Secured:t,Type:r,Category:s,LocaleFormat:a,...n}=e;return{...v(n),categoryId:s,isSecured:t,color:oe.L[r]||oe.L.GRAY}},de=(e,t)=>{const{DateOfBirth:r,LinkedIdentity:s,Sex:a,SocialSecurityFullname:n,SocialSecurityNumber:i,...o}=e;return{...v(o),idName:B(t)||n||"",idNumber:i,country:o.LocaleFormat}},le=e=>{const{Website:t,Name:r,PersonalNote:s,LocaleFormat:a,...n}=e;return{...v(n),itemName:r,URL:t}},ue=u.N[p.U.Identity].replace("Result","");class pe{initializeVaultItemsQueryParams(e){const{ids:t,pageSize:r,pageNumber:s,propertyFilters:a,propertySorting:n}=e;this.ids=t,this.propertyFilters=a,this.propertySorting=n,this.pageSize=r,this.pageNumber=s}fetchVaultItems$(e,t){const{vaultItemTypes:r,...s}=e;this.initializeVaultItemsQueryParams(s),this.additionalFilterFunc=t;const i=(0,a.a)(r.map((e=>this.getVaultItems$TypeDictionary[e]()))),o=this.getEmptyVaultItemsQueryResult();return i.pipe((0,n.U)((e=>(e.forEach((e=>{if("failure"===e.tag)throw new Error("Error while fetching vault items");Object.assign(o,e.data)})),(0,c.Vp)(o)))))}getVaultItems$(e,t,r,s){return s=s??e.replace("Result",""),(0,a.a)([this.getCarbonVaultItems$(e,t,s),this.getCarbonVaultItems$(u.N[p.U.Identity],N,ue),this.getQuarantinedSpacesTeamIds$()],((e,t,s)=>(0,c.Vp)(function(e,t,r,s,a){return e.flatMap((e=>{if(r.includes(e.SpaceId)||a&&!a.some((t=>t.toUpperCase()===e.Id.toUpperCase())))return[];e.LastUse||(e.LastUse=-1);const n=e.LinkedIdentity?t.find((t=>t.Id===e.LinkedIdentity)):void 0;return s(e,n)}))}(e,t,s,r,this.ids)))).pipe((0,d.Qn)((t=>{const r=_(y(t,this.propertyFilters,this.additionalFilterFunc),this.propertySorting);return{[e]:{items:this.getPage(r),matchCount:r.length}}})))}getPage(e){return this.pageNumber&&this.pageSize?e.slice(this.pageSize*(this.pageNumber-1),this.pageSize*this.pageNumber):e}getCarbonVaultItems$(e,t,r){const{queries:{carbonState:s}}=this.carbonLegacyClient;return s({path:`userSession.personalData.${r}`}).pipe((0,n.U)((r=>{if((0,c.hx)(r)||!t(r.data))throw new Error(`Bad ${e} format`);return r.data})))}getQuarantinedSpacesTeamIds$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.spaceData.spaces"}).pipe((0,n.U)((e=>{if((0,c.hx)(e)||!(0,P.u)(e.data))throw new Error("Bad spaces format");return e.data.filter((e=>this.isPremiumStatusSpaceQuarantined(e.details)))})),(0,n.U)((e=>e.map((e=>e.teamId)).sort())),(0,i.x)(((e,t)=>JSON.stringify(e)!==JSON.stringify(t))))}isPremiumStatusSpaceQuarantined(e){return"accepted"!==e.status.toLowerCase()&&Boolean(e.info.removeForcedContentEnabled)}constructor(e){this.carbonLegacyClient=e,this.getVaultItems$TypeDictionary={[p.U.Address]:()=>this.getVaultItems$(u.N[p.U.Address],C,A),[p.U.BankAccount]:()=>this.getVaultItems$(u.N[p.U.BankAccount],x,D),[p.U.Company]:()=>this.getVaultItems$(u.N[p.U.Company],T,O),[p.U.Credential]:()=>this.getVaultItems$(u.N[p.U.Credential],k,R),[p.U.DriversLicense]:()=>this.getVaultItems$(u.N[p.U.DriversLicense],L,$,"driverLicenses"),[p.U.Email]:()=>this.getVaultItems$(u.N[p.U.Email],F,q),[p.U.FiscalId]:()=>this.getVaultItems$(u.N[p.U.FiscalId],M,G),[p.U.IdCard]:()=>this.getVaultItems$(u.N[p.U.IdCard],j,K),[p.U.Identity]:()=>this.getVaultItems$(u.N[p.U.Identity],N,W),[p.U.Passkey]:()=>this.getVaultItems$(u.N[p.U.Passkey],Y,v),[p.U.Passport]:()=>this.getVaultItems$(u.N[p.U.Passport],V,X),[p.U.PaymentCard]:()=>this.getVaultItems$(u.N[p.U.PaymentCard],Z,te),[p.U.Phone]:()=>this.getVaultItems$(u.N[p.U.Phone],I,ne),[p.U.Secret]:()=>this.getVaultItems$(u.N[p.U.Secret],w,E),[p.U.SecureNote]:()=>this.getVaultItems$(u.N[p.U.SecureNote],ie,ce,"notes"),[p.U.SocialSecurityId]:()=>this.getVaultItems$(u.N[p.U.SocialSecurityId],z,de),[p.U.Website]:()=>this.getVaultItems$(u.N[p.U.Website],U,le,"personalWebsites")},this.getEmptyVaultItemsQueryResult=()=>({addressesResult:this.getEmptyItemsQueryResult(),bankAccountsResult:this.getEmptyItemsQueryResult(),companiesResult:this.getEmptyItemsQueryResult(),credentialsResult:this.getEmptyItemsQueryResult(),driversLicensesResult:this.getEmptyItemsQueryResult(),emailsResult:this.getEmptyItemsQueryResult(),fiscalIdsResult:this.getEmptyItemsQueryResult(),idCardsResult:this.getEmptyItemsQueryResult(),identitiesResult:this.getEmptyItemsQueryResult(),passkeysResult:this.getEmptyItemsQueryResult(),passportsResult:this.getEmptyItemsQueryResult(),paymentCardsResult:this.getEmptyItemsQueryResult(),phonesResult:this.getEmptyItemsQueryResult(),secretsResult:this.getEmptyItemsQueryResult(),secureNotesResult:this.getEmptyItemsQueryResult(),socialSecurityIdsResult:this.getEmptyItemsQueryResult(),websitesResult:this.getEmptyItemsQueryResult()}),this.getEmptyItemsQueryResult=()=>({items:[],matchCount:0})}}pe=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l._?Object:l._])],pe)},95156:(e,t,r)=>{r.d(t,{U:()=>f});var s=r(88802),a=r(99634),n=r(20281),i=r(85390),o=r(43978),c=r(20754),d=r(87279),l=r(48844),u=r(20980),p=r(39431),m=r(352),h=r(77802),g=r(71860);class v{execute({body:e}){const{vaultItemTypes:t,searchQuery:r,...s}=e;this.searchQuery=r;const{queries:{queryCollections:a}}=this.vaultOrganizationClient,{queries:{sharedCollectionsWithItems:n}}=this.sharingCollectionsClient;return(0,i.a)([a({}),n()]).pipe((0,o.w)((([e,r])=>{if((0,d.hx)(e)||(0,d.hx)(r))throw new Error("Error querying collections");return this.collections=e.data.collections.concat(r.data),t?this.vaultRepository.fetchVaultItems$({vaultItemTypes:t,...s},this.isVaultItemMatch):this.vaultRepository.fetchVaultItems$({vaultItemTypes:Object.values(p.U),...s},this.isVaultItemMatch)})),(0,l.Qn)((e=>{let r;if(t)r={items:[],matchCount:0};else{const e=this.collections.filter((e=>this.isMatch(e)));r={items:e,matchCount:e.length}}return{...e,collectionsResult:r}})))}isMatch(e,t=""){return t+=Object.values(e).filter((e=>"object"!=typeof e)).join(this.separator),this.normalizeString(t).includes(this.normalizeString(this.searchQuery))}constructor(e,t,r){this.vaultRepository=e,this.vaultOrganizationClient=t,this.sharingCollectionsClient=r,this.separator=",",this.collections=[],this.searchQuery="",this.normalizeString=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),this.isVaultItemMatch=e=>{let t="";return this.collections.forEach((r=>{r.vaultItems.some((t=>t.id===e.id))&&(t+=`${r.name}${this.separator}`)})),this.isMatch(e,t)}}}v=(0,s.__decorate)([(0,c.e)(m.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g.g?Object:g.g,void 0===h.C?Object:h.C,void 0===u.L?Object:u.L])],v);class f{}f=(0,s.__decorate)([(0,a.Yl)({api:n.R,handlers:{commands:{},events:{},queries:{search:v}},providers:[g.g]})],f)},57842:(e,t,r)=>{r.d(t,{z:()=>c});var s=r(86952),a=r(90717),n=r(41453),i=r(3090),o=r(19186);const c=(0,s.Q)({name:"vpnNotifications",commands:{markVpnProviderSeen:a.M,markInstallVpnSeen:n.b},events:{},queries:{hasSeenVpnProvider:i.D,hasSeenInstallVpn:o.w}})},41453:(e,t,r)=>{r.d(t,{b:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},90717:(e,t,r)=>{r.d(t,{M:()=>n});var s=r(74354),a=r(25029);class n extends((0,s.g)({scope:a.F.User})){}},19186:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(99059);class a extends((0,s.k)()){}},3090:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(99059);class a extends((0,s.k)()){}},19813:(e,t,r)=>{r.d(t,{u:()=>N});var s,a=r(88802),n=r(99634),i=r(57842),o=r(25029),c=r(95681),d=r(23347),l=r(10722),u=r(7165);!function(e){e.VpnProvider="vpnProvider",e.InstallVpn="installVpn"}(s||(s={}));const p=u.z.object({notifications:u.z.record(u.z.nativeEnum(s),u.z.boolean())}),m=e=>p.safeParse(e).success;class h extends((0,c.Q)({storage:{schemaVersion:1,initialValue:{notifications:{vpnProvider:!1,installVpn:!1}},typeGuard:m},persist:!0,scope:o.F.User,storeName:"vpn-notifications-store",capacity:d.Y._010KB,codec:l.E})){}var g=r(63663),v=r(87279),f=r(90717);class y{async execute(){const e=await this.store.getState(),t={...e.notifications,vpnProvider:!0};return await this.store.set({...e,notifications:t}),(0,v.Vp)(void 0)}constructor(e){this.store=e}}y=(0,a.__decorate)([(0,g.W)(f.M),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===h?Object:h])],y);var b=r(41453);class _{async execute(){const e=await this.store.getState(),t={...e.notifications,installVpn:!0};return await this.store.set({...e,notifications:t}),(0,v.Vp)(void 0)}constructor(e){this.store=e}}_=(0,a.__decorate)([(0,g.W)(b.b),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===h?Object:h])],_);var S=r(87065),w=r(20754),E=r(3090);class C{execute(){return this.store.state$.pipe((0,S.U)((e=>(0,v.Vp)(!!e.notifications.vpnProvider))))}constructor(e){this.store=e}}C=(0,a.__decorate)([(0,w.e)(E.D),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===h?Object:h])],C);var T=r(19186);class F{execute(){return this.store.state$.pipe((0,S.U)((e=>(0,v.Vp)(!!e.notifications.installVpn))))}constructor(e){this.store=e}}F=(0,a.__decorate)([(0,w.e)(T.w),(0,a.__metadata)("design:type",Function),(0,a.__metadata)("design:paramtypes",[void 0===h?Object:h])],F);class N{}N=(0,a.__decorate)([(0,n.Yl)({api:i.z,stores:[h],handlers:{commands:{markVpnProviderSeen:y,markInstallVpnSeen:_},events:{},queries:{hasSeenVpnProvider:C,hasSeenInstallVpn:F}}})],N)}}]);