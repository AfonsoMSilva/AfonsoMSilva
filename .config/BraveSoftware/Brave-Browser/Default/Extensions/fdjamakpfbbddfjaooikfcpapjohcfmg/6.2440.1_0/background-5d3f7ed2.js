"use strict";(self.webpackChunk_dashlane_amphora=self.webpackChunk_dashlane_amphora||[]).push([[433],{21804:(e,t,a)=>{a.r(t),a.d(t,{AsyncResource:()=>s});const s={bind:e=>e}},31579:(e,t,a)=>{a.r(t),a.d(t,{performance:()=>s});const s={now:()=>{}}},10370:(e,t,a)=>{a.d(t,{s:()=>n});var s=a(46041);function r(e){const t=e.length,a=[];for(let r=0;r<t;r+=3)a.push(s.T[e[r]>>2]),a.push(s.T[(3&e[r])<<4|e[r+1]>>4]),a.push(s.T[(15&e[r+1])<<2|e[r+2]>>6]),a.push(s.T[63&e[r+2]]);return a.join("")}function n(e,t=s.V){const a=new Uint8Array(e),n=a.length,i=t%3,o=0===i?t:t+(3-i),c=Math.ceil(n/o);let d="",l=-1;for(;l++<c;){const e=l*o,t=l===c-1?n:(l+1)*o,s=r(a.slice(e,t));d=d.concat(s)}return n%3==2?d.substring(0,d.length-1)+"=":n%3==1?d.substring(0,d.length-2)+"==":d}},89685:(e,t,a)=>{a.d(t,{v:()=>r});const s=Math.pow(2,14)-1;function r(e){const t=new Uint8Array(e),a=t.length;let r="",n=s;for(let e=0;e<a;e+=n){e+n>a&&(n=a-e);const s=t.subarray(e,e+n);r+=String.fromCharCode(...s)}return r}},68376:(e,t,a)=>{a.d(t,{L:()=>r});var s=a(46803);function r(e){const t=new Uint8Array(e),a=[];for(let e=0;e<t.byteLength;e++)a[e>>>2]|=t[e]<<24-e%4*8;return s.lib.WordArray.create(a,t.byteLength)}},76884:(e,t,a)=>{a.d(t,{K:()=>n});const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("").reduce(((e,t,a)=>({...e,[t]:a})),{});function r(e){const t=s[e];if(void 0===t)throw new Error(`Invalid character found: ${e}`);return t}function n(e){const t=e.replaceAll("=","").trim().length;let a=0,s=0,n=0;const i=new Uint8Array(5*t/8|0);for(let o=0;o<t;o++)s=s<<5|r(e[o]),a+=5,a>=8&&(i[n++]=s>>>a-8&255,a-=8);return i.buffer}},7502:(e,t,a)=>{a.d(t,{R:()=>n});var s=a(46041);const r=new Uint8Array(256);for(let e=0;e<s.T.length;e++)r[s.T.charCodeAt(e)]=e;function n(e){let t=.75*e.length;const a=e.length;let s,n,i,o,c,d=0;e.endsWith("=")&&(t--,"="===e[e.length-2]&&t--);const l=new ArrayBuffer(t),u=new Uint8Array(l);for(s=0;s<a;s+=4)n=r[e.charCodeAt(s)],i=r[e.charCodeAt(s+1)],o=r[e.charCodeAt(s+2)],c=r[e.charCodeAt(s+3)],u[d++]=n<<2|i>>4,u[d++]=(15&i)<<4|o>>2,u[d++]=(3&o)<<6|63&c;return l}},60198:(e,t,a)=>{a.d(t,{N:()=>r});var s=a(7502);function r(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),a=(4-t.length%4)%4,r=t.padEnd(t.length+a,"=");return(0,s.R)(r)}},96303:(e,t,a)=>{function s(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}a.d(t,{k:()=>s})},21131:(e,t,a)=>{a.d(t,{n:()=>i});var s=a(93347),r=a.n(s),n=a(82933);function i(e){const t=new Uint8Array([0,0,0,0]).buffer,a=new Uint8Array(e),s=r().deflate(a,{level:7}).buffer;return(0,n.K)(t,s)}},82933:(e,t,a)=>{function s(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),a=new Uint8Array(t);return e.reduce(((e,t)=>(a.set(new Uint8Array(t),e),e+t.byteLength)),0),a.buffer}a.d(t,{K:()=>s})},46041:(e,t,a)=>{a.d(t,{T:()=>r,V:()=>s});const s=Math.pow(10,6),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},58859:(e,t,a)=>{function s(e){return e.replace(/(?:\\[r]|[\r\n]+)+/g,"\n")}a.d(t,{Y:()=>s})},40767:(e,t,a)=>{a.d(t,{p:()=>r});var s=a(76465);function r(e){return(0,s.Jx)(new Uint8Array(e))}},63065:(e,t,a)=>{a.d(t,{L:()=>i});var s=a(93347),r=a.n(s);const n=4;function i(e){const t=function(e){return new Uint8Array(e.slice(n))}(e);return r().inflate(t).buffer}},76746:(e,t,a)=>{a.d(t,{d:()=>r});var s=a(76465);function r(e){return(0,s.cv)(e)}},97112:(e,t,a)=>{function s(e){const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e)),t}a.d(t,{n:()=>s})},83168:(e,t,a)=>{a.d(t,{B:()=>i});var s=a(3417),r=a.n(s),n=a(54066);function i(e){const{asn1:t,pki:a}=r(),s=a.privateKeyFromPem(e),i=a.privateKeyToAsn1(s),o=a.wrapRsaPrivateKey(i),c=t.toDer(o).getBytes();return(0,n.u)(c)}},4761:(e,t,a)=>{a.d(t,{M:()=>i});var s=a(3417),r=a.n(s),n=a(54066);function i(e){const{asn1:t,pki:a}=r(),s=a.publicKeyFromPem(e),i=a.publicKeyToAsn1(s),o=t.toDer(i).getBytes();return(0,n.u)(o)}},86286:(e,t,a)=>{a.d(t,{R:()=>i});var s=a(3417),r=a.n(s),n=a(58859);function i(e){const{asn1:t,pki:a,util:s}=r(),i=s.createBuffer(e),o=t.fromDer(i),c=a.privateKeyFromAsn1(o),d=a.privateKeyToPem(c);return(0,n.Y)(d)}},9034:(e,t,a)=>{a.d(t,{y:()=>i});var s=a(3417),r=a.n(s),n=a(58859);function i(e){const{asn1:t,pki:a,util:s}=r(),i=s.createBuffer(e),o=t.fromDer(i),c=a.publicKeyFromAsn1(o),d=a.publicKeyToRSAPublicKeyPem(c);return(0,n.Y)(d)}},54066:(e,t,a)=>{function s(e){const t=new ArrayBuffer(e.length),a=new Uint8Array(t);for(let t=0;t<e.length;++t)a[t]=e.charCodeAt(t);return t}a.d(t,{u:()=>s})},7499:(e,t,a)=>{a.d(t,{e:()=>i});var s=a(30543),r=a(46041);function n(e){return e>>6==2}function i(e,t=r.V){const a=e.length;if(0===a)return"";let i="",o=0,c=Math.min(o+t,a);for(;c<=a;){const r=e.charCodeAt(c-1);if((n(d=r)||function(e){return e>>5==6||e>>4==14||e>>3==30}(d))&&c<a){if(n(e.charCodeAt(c))){c++;continue}}const l=e.slice(o,c),u=s.decode(l);if(i=i.concat(u),c===a)break;o=c,c=Math.min(o+t,a)}var d;return i}},43293:(e,t,a)=>{a.d(t,{N:()=>n});var s=a(30543),r=a(46041);function n(e,t=r.V){const a=e.length;if(0===a)return"";let n="",i=0,o=Math.min(i+t,a);for(;o<=a;){const r=e.charCodeAt(o-1);if(r>=55296&&r<=56319){if(o++,o>a)throw new Error("Invalid string provided to utf8ChunkEncode");continue}const c=e.slice(i,o),d=s.encode(c);if(n=n.concat(d),o===a)break;i=o,o=Math.min(i+t,a)}return n}},69806:(e,t,a)=>{function s(e){const{sigBytes:t,words:a}=e,s=new Uint8Array(t);let r=0,n=0;for(;r!==t;){const e=a[n++];if(s[r++]=(4278190080&e)>>>24,r===t)break;if(s[r++]=(16711680&e)>>>16,r===t)break;if(s[r++]=(65280&e)>>>8,r===t)break;s[r++]=255&e}return s.buffer}a.d(t,{o:()=>s})},98902:(e,t,a)=>{a.d(t,{W:()=>n});var s=a(23337),r=a(96754);class n extends s.X{async fetch(e){const t=(0,r.A)(e);return(await fetch(t)).json()}}},64391:(e,t,a)=>{a.d(t,{x:()=>o});var s=a(5900),r=a.n(s),n=a(68376),i=a(69806);function o(e,t){if(self.crypto.subtle)return self.crypto.subtle.digest({name:t},e);if("SHA-1"===t){const t=(0,n.L)(e),a=(0,i.o)(r()(t));return Promise.resolve(a)}return Promise.reject(new Error("Unsupported hash method"))}},86381:(e,t,a)=>{a.d(t,{$:()=>n});var s=a(22609),r=a(83961);async function n(e,t,a){const n=await(0,r.Y)(e);return self.crypto.subtle.decrypt({name:s.z,iv:t},n,a)}},39560:(e,t,a)=>{a.d(t,{G:()=>r});var s=a(83407);async function r(e,t,a){const r={name:s.$k,hash:{name:a}},n=await self.crypto.subtle.importKey("pkcs8",e,r,!1,["decrypt"]);return self.crypto.subtle.decrypt(r,n,t)}},76254:(e,t,a)=>{a.d(t,{f:()=>n});var s=a(35558),r=a.n(s);async function n(e,t,a){const{tCost:n,mCost:i,parallelism:o}=a,{hash:c}=await r().hash({pass:new Uint8Array(e),salt:new Uint8Array(t),time:n,mem:i,hashLen:32,parallelism:o,type:s.ArgonType.Argon2d});return c.buffer}},80954:(e,t,a)=>{a.d(t,{x:()=>r});var s=a(22609);async function r(e,t,a){const r=await self.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),n={name:s.z,length:256},{iterations:i,hashType:o}=a,c={name:"PBKDF2",salt:t,iterations:i,hash:{name:o}},d=await self.crypto.subtle.deriveKey(c,r,n,!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",d)}},48264:(e,t,a)=>{a.d(t,{P:()=>n});var s=a(22609),r=a(83961);async function n(e,t,a){const n=await(0,r.Y)(e);return self.crypto.subtle.encrypt({name:s.z,iv:t},n,a)}},64396:(e,t,a)=>{a.d(t,{b:()=>r});var s=a(83407);async function r(e,t,a){const r={name:s.$k,hash:{name:a}},n=await self.crypto.subtle.importKey("spki",e,r,!1,["encrypt"]);return self.crypto.subtle.encrypt(r,n,t)}},420:(e,t,a)=>{a.d(t,{o:()=>r});var s=a(22609);async function r(){const e=await self.crypto.subtle.generateKey({name:s.z,length:s.N},!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",e)}},26857:(e,t,a)=>{a.d(t,{Y:()=>n});var s=a(83407);const r=new Uint8Array([1,0,1]);async function n(e){const t=await self.crypto.subtle.generateKey({name:s.$k,modulusLength:2048,publicExponent:r,hash:{name:e}},!0,["encrypt","decrypt"]),{privateKey:a,publicKey:n}=t;return{privateKey:await self.crypto.subtle.exportKey("pkcs8",a),publicKey:await self.crypto.subtle.exportKey("spki",n)}}},39911:(e,t,a)=>{function s(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t)}a.d(t,{P:()=>s})},83961:(e,t,a)=>{a.d(t,{Y:()=>r});var s=a(22609);function r(e){return self.crypto.subtle.importKey("raw",e,s.z,!1,["encrypt","decrypt"])}},48297:(e,t,a)=>{function s(e,t){return self.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign","verify"])}a.d(t,{r:()=>s})},43838:(e,t,a)=>{a.d(t,{n:()=>n});var s=a(74017),r=a(48297);async function n(e,t,a=s.x){const n=await(0,r.r)(e,a);return self.crypto.subtle.sign({name:"HMAC",hash:{name:a}},n,t)}},39387:(e,t,a)=>{a.d(t,{f:()=>r});var s=a(83407);async function r(e,t,a){const r={name:s.xJ,hash:{name:a}},n=await self.crypto.subtle.importKey("pkcs8",e,r,!1,["sign"]);return self.crypto.subtle.sign(r,n,t)}},396:(e,t,a)=>{a.d(t,{H:()=>o});var s=a(90278),r=a.n(s),n=a(68376),i=a(69806);function o(e){const t=(0,n.L)(e);return(0,i.o)(r()(t))}},57487:(e,t,a)=>{a.d(t,{o:()=>n});var s=a(74017),r=a(48297);async function n(e,t,a,n=s.x){const i=await(0,r.r)(e,n);return self.crypto.subtle.verify({name:"HMAC",hash:{name:n}},i,t,a)}},852:(e,t,a)=>{a.d(t,{e:()=>r});var s=a(83407);async function r(e,t,a,r){const n={name:s.xJ,hash:{name:r}},i=await self.crypto.subtle.importKey("spki",e,n,!1,["verify"]);return self.crypto.subtle.verify(n,i,t,a)}},8434:(e,t,a)=>{a.d(t,{Y:()=>r});var s=a(33156);function r(){return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.getManifest&&3===(0,s.W)().manifest_version}},79274:(e,t,a)=>{a.d(t,{m:()=>c});var s=a(72693),r=a(96754);const n="file-download";class i extends s.o{async send(e,t,a){try{if(!("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope))throw new Error("File Download Emitter Channel - Wrong environment. Not in a service worker.");const s=(0,r.A)("").replace(/\/$/,""),i=(await self.clients.matchAll()).find((e=>e.url.includes(s)));i?.postMessage({fileName:e,mimeType:t,fileContent:a,type:n},[a])}catch(e){console.error(e)}}}class o extends s.o{async send(e,t,a){try{if(!chrome?.extension?.getBackgroundPage())throw new Error("Wrong environment. Missing background page.");const s=(0,r.A)("").replace(/\/$/,"");window.postMessage({fileName:e,mimeType:t,fileContent:a,type:n},s,[a])}catch(e){console.error(e)}}}class c{makeFileDownloadEmitterChannel(){if("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope)return new i;if(chrome?.extension?.getBackgroundPage())return new o;throw new Error("unsupported environment. This module should only be used in a service worker or a background page.")}}},33612:(e,t,a)=>{a.d(t,{b:()=>i});var s=a(87201),r=a(96754),n=a(22064);class i extends s.P{listen(){const e=(0,r.A)("").replace(/\/$/,"");new Promise((e=>{setTimeout((()=>{e(void 0)}),5e3),chrome.runtime.getBackgroundPage((t=>e(t)))})).then((t=>{if(!t)throw new Error("File Upload Listener Channel - Wrong environment.  Missing background page.");t.addEventListener("message",(t=>{if(t.data?.type&&t.data.type===n.M){if(t.origin.toLowerCase()!==e.toLowerCase())return void console.error(`Received message from unauthorized origin: ${t.origin}`);this.eventEmitter.sendEvent("fileUploaded",t.data)}}))}))}}},67052:(e,t,a)=>{a.d(t,{w:()=>i});var s=a(87201),r=a(96754),n=a(22064);class i extends s.P{static initializeListener(){return self.addEventListener("message",(e=>i.listenerEventHandler(e))),i}listen(){if(!("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope))throw new Error("File Upload Listener Channel - Wrong environment. Not in a service worker.");const e=(0,r.A)("").replace(/\/$/,"");i.listenerEventHandler=t=>{if(t.data?.type&&t.data.type===n.M){if(t.origin.toLowerCase()!==e.toLowerCase())return void console.error(`Received message from unauthorized origin: ${t.origin}`);this.eventEmitter.sendEvent("fileUploaded",t.data)}}}}i.listenerEventHandler=e=>{}},83074:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(87065),r=a(93192),n=a(90171),i=a(47968),o=a(37182),c=a(69885),d=a(51992),l=a(73155),u=a(12964),p=a(85260),m=a(87279);class h{constructor(){this.toHttpResult=e=>e instanceof l.a?(0,m.Rn)(e):e.ok?(0,m.Vp)(e):(0,m.Rn)(new l.R(e)),this.toHttpResponse=e=>e instanceof l.a?e:new u.Z({body:e.body,url:e.url,status:e.status,statusText:e.statusText,headers:this.mapToHttpHeaders(e.headers)})}handle(e){const t=this.getTimeout$(e.timeout),a=this.doFetch(e).pipe((0,s.U)(this.toHttpResponse),(0,s.U)(this.toHttpResult));return(0,r.S)(t,a)}getTimeout$(e){return e?(0,n.H)(e).pipe((0,s.U)((()=>(0,m.Rn)(new l.a)))):i.C}doFetch(e){return(0,d.U)(e.url,{method:e.method,body:e.serializeBody(),headers:this.getHeaders(e),credentials:e.withCredentials?"include":"omit",mode:e.mode}).pipe((0,o.K)((e=>{if(!(e instanceof TypeError))throw e;return(0,c.of)(new l.a)})))}mapToHttpHeaders(e){const t=new p.W;return e.forEach(((e,a)=>t.set(a,e))),t}getHeaders(e){return e.headers.keys().reduce(((t,a)=>({...t,[a]:e.headers.get(a)})),{})}}},40532:(e,t,a)=>{a.d(t,{D:()=>n});var s=a(6721),r=a(22366);class n extends r.g{extendServiceWorkerLifetime(){console.log("[background/mv3-extension-resilience] Heartbeat to extend SW lifetime"),(0,s.t)({"last-heartbeat":(new Date).getTime()})}}},9980:(e,t,a)=>{a.d(t,{D:()=>o});var s=a(71474),r=a(51186),n=a(856);const i=" ";async function o(){const e=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((e=>async function(e,t){try{const{levelOfControl:t}=await(0,s.U)(e);if("controllable_by_this_extension"!==t&&"controlled_by_this_extension"!==t){const a=[`Impossible to change browser setting: ${e}.`,`Extension prevented from changing: ${t}`].join(i);throw new Error(a)}}catch(t){if((0,r.b)(t))throw new Error(`Browser setting not supported: ${e}`);if((0,r.I)(t))throw t.runtimeError;throw t}try{await(0,n.t)(e,t)}catch(e){throw(0,r.I)(e)?e.runtimeError:e}}(e,!1)));await Promise.allSettled(e)}},26662:(e,t,a)=>{a.d(t,{F:()=>o});var s=a(33156),r=a(38649);const n={beta:"icon_beta_auth",mv2:"icon_auth",nightly:"icon_nightly_auth"},i="icon_not_auth";async function o({isUserAuthenticated:e}){const t=`icons/action/${e?function(){const e=(0,s.W)();return e.name.includes("Nightly")?n.nightly:e.name.includes("Beta")?n.beta:n.mv2}():i}`,a={16:`${t}.png`,32:`${t}@2x.png`};await(0,r.B)(a)}},15348:(e,t,a)=>{a.d(t,{$:()=>i});var s=a(37724),r=a(33017);function n(e){return`${"http"+(e.secure?"s":"")}://${e.domain.startsWith(".")?e.domain.substring(1):e.domain}${e.path}`}async function i(e){const t=await(0,s.g)({domain:e});return Promise.all(t.map((e=>(0,r.O)({url:n(e),name:e.name}))))}},65124:(e,t,a)=>{a.d(t,{j:()=>n});var s=a(21352),r=a(6523);async function n(e){if((0,s.G)()){return await(0,s.y)(e)>0}const t=await(0,r.U)(e),a=void 0===t[e],n=null===t[e];return!a&&!n}},81017:(e,t,a)=>{a.d(t,{b:()=>m});var s=a(96754),r=a(87163),n=a(96344),i=a(40841),o=a(21597),c=a(71751);async function d(){const e=await(0,c.I)({}),t=(0,s.A)("");return e.filter((e=>"string"==typeof e.url&&e.url.startsWith(t))).filter((e=>""!==e.url&&e.url!==(0,s.A)("/popup/index.html")))}const l="index.html";function u(){return`${(0,s.A)("")}${l}`}function p({identifier:e,queryInfo:t,name:a}){const s=u();if(!a)return s;const r=e?`#${a}/${e}`:`#${a}`,n=t?`?${function(e){return Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}(t)}`:"";return encodeURI(`${s}${r}${n}`)}async function m({id:e,query:t,route:a}){const s=p({identifier:e,queryInfo:t,name:a}),c=await d();c.length?await async function({path:e,tabs:t}){const a=await(0,n.T)(),s=function({existingTabs:e,focusedWindow:t}){const a=e.filter((e=>e.active)),s=a.find((e=>e.windowId===t.id)),r=a.pop(),n=e.pop();return s??r??n}({existingTabs:t,focusedWindow:a});if(!s)return;if(s.windowId!==a.id&&(0,i.V)(s.windowId,{focused:!0}),!s.id)return;const r={active:!0,...e===u()?{}:{url:e}};await(0,o.V)(s.id,r)}({path:s,tabs:c}):await async function(e){const t={url:e};await(0,r.U)(t)}(s)}},78896:(e,t,a)=>{a.d(t,{w:()=>_});var s=a(58376),r=a(7074),n=a(24966),i=a(85390),o=a(15023),c=a(87065),d=a(27420),l=a(4710),u=a(22828),p=a(27880),m=a(41718);function h(e){return JSON.parse(JSON.stringify(e))}class g{constructor(){this.events$=new s.y((e=>{const t=t=>{e.next(t)};return d.r.addListener(t),()=>d.r.removeListener(t)})).pipe((0,r.B)())}}class v{constructor(e,t,a){this.stopped$=new n.X(!1),this.key=t,this.typeGuard=a??(e=>!0);const r=new s.y((a=>{this.getState().then((e=>{a.next(e)}));const s=e.events$.subscribe((e=>{let s;if(t in e){const{newValue:r}=e[t];s=a.next(this.asDataWithTimestamp(r))}return s}));return()=>s.unsubscribe()}));this.state$=(0,i.a)({state:r,isStopped:this.stopped$}).pipe((0,o.o)((({isStopped:e})=>!e),!1),(0,c.U)((({state:e})=>e)))}async update(e){return this.set(e(await this.getState()))}persist(){return Promise.resolve()}load(){return Promise.resolve()}set(e){return(0,l.t)(h({[this.key]:e}))}init(e){return(0,l.t)(h({[this.key]:e}))}clear(){return(0,u.O)(this.key)}clearStorage(){return Promise.resolve()}stop(){this.stopped$.next(!0)}getLimit(){return Promise.resolve(9e6)}async getState(){const e=(await(0,p.U)(this.key))[this.key];return this.asDataWithTimestamp(e)}asDataWithTimestamp(e){if(!(e&&"object"==typeof e&&"timestamp"in e&&"number"==typeof e.timestamp&&e.timestamp&&"data"in e))return{timestamp:void 0};try{if(!this.typeGuard(e.data))throw new Error("typeGuard check fail")}catch(e){return console.error("Failed to hydrate store due to typeGuard failure"),{timestamp:void 0}}return{timestamp:e.timestamp,data:e.data}}}class y extends m.G{constructor(){super(...arguments),this.source=new g}createUserScopedInfrastructure(e,t,a,s){const r=`graphene.${e}.${t}.${a}`;return new v(this.source,r,s)}createDeviceScopedInfrastructure(e,t,a){const s=`graphene.${e}.${t}`;return new v(this.source,s,a)}}var f=a(37730);function _(){return(0,f.G)()?new y:new m.N}},81155:(e,t,a)=>{a.d(t,{e:()=>i});var s=a(6523),r=a(6721),n=a(52913);class i{async getAllKeys(){return Object.keys(await(0,s.U)(null))}async get(e){const t=(await(0,s.U)([e]))[e];if(t){if("string"!=typeof t)throw new Error(`[ChromeLocalStorage] - cannot read content of ${e} properly. Type is\n        ${typeof t} but should be 'string'`);return t}}async set(e,t){await(0,r.t)({[e]:t})}async remove(e){await(0,n.O)([e])}}},17236:(e,t,a)=>{a.d(t,{e:()=>r});var s=a(45368);class r{async getAllKeys(){return Object.keys(await(0,s.U)(void 0)??{})}async get(e){const t=await(0,s.U)(e);if(!t)return;const a=t[e];if(a){if("string"!=typeof a)throw new Error("Expected ExtensionManagedStorage entry value to be a string",{cause:{key:e,type:typeof a}});return a}}}},3460:(e,t,a)=>{a.d(t,{y:()=>m});var s=a(31857),r=a(58376),n=a(97280),i=a(23423),o=a(29439),c=a(31261),d=a(63090);const l="cron-source";const u=()=>new r.y((e=>{const t=t=>{t.name===l&&e.next()};return c.i.addListener(t),async function(){await(0,i.U)(l)||await(0,o.U)(l,{delayInMinutes:1,periodInMinutes:1})}(),()=>{c.i.removeListener(t)}})),p=()=>(0,d.G)()?u():new r.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}));class m extends s.R_{constructor(){super(...arguments),this.alarm$=p().pipe((0,n.d)(1)),this.subscription=this.alarm$.subscribe()}stop(){this.subscription.unsubscribe()}}},66917:(e,t,a)=>{a.d(t,{P:()=>p});var s=a(78776),r=a(24966),n=a(58376),i=a(87065),o=a(36610),c=a(57042),d=a(66853),l=a(12335),u=a(19523);class p{constructor(e){this.connectedChannels$=new r.X({});const t=new n.y((t=>{const a={},n=n=>{const u=(0,s.Z)();if(n.name!==e)return;const p=new o.j({addListener:e=>n.onMessage.addListener(e),removeListener:e=>n.onMessage.removeListener(e)},(t=>(0,c.F)(t)&&t.channelName===e)),m=new Promise((e=>{const t=()=>{n.onDisconnect.removeListener(t),e(null)};n.onDisconnect.addListener(t)})),h=new r.X(d.D.Connected);m.then((()=>{p.stop(),h.next(d.D.Disconnected),delete a[u],t.next(a)}));const g={messages$:p.events$.pipe((0,i.U)((([e])=>e.message))),sendMessage:t=>(n.postMessage((0,c.k)({channelName:e,message:t})),Promise.resolve()),stop:()=>(n.disconnect(),Promise.resolve()),status$:h},v=new l.N(g);a[u]=v,t.next(a)};return u.b.addListener(n),()=>{u.b.removeListener(n)}}));this.subscription=t.subscribe((e=>this.connectedChannels$.next(e)))}stop(){this.subscription.unsubscribe()}}},23711:(e,t,a)=>{a.d(t,{z:()=>n});var s=a(7502),r=a(10370);class n{decode(e){return(0,s.R)(e)}encode(e){return(0,r.s)(e)}}},49499:(e,t,a)=>{function s(...e){const t=[...e].reverse();return{decode:async t=>{for(const a of e)t=await a.decode(t);return t},encode:async e=>{for(const a of t)e=await a.encode(e);return e}}}a.d(t,{x:()=>s})},43702:(e,t,a)=>{a.d(t,{b:()=>s});class s{decode(e){return JSON.parse((new TextDecoder).decode(e))}encode(e){return(new TextEncoder).encode(JSON.stringify(e))}}},10722:(e,t,a)=>{a.d(t,{E:()=>r});const s=e=>e;class r{constructor(){this.encode=s,this.decode=s}}},16698:(e,t,a)=>{a.d(t,{BU:()=>n,No:()=>i,Nw:()=>s,gO:()=>r});const s={algorithm:"aes256",mode:"cbchmac",ivLength:16},r={algorithm:"aes256",mode:"cbchmac64",ivLength:16},n={algorithm:"aes256",mode:"cbchmac",ivLength:16,padding:16,bytesToKey:0,reuseSalt:!1},i={algorithm:"aes256",mode:"cbc",ivLength:16,saltLength:32,padding:0,bytesToKey:{algorithm:"sha1",iterations:3,keyLength:32}}},94805:(e,t,a)=>{a.d(t,{E1:()=>n,Yi:()=>o,b9:()=>c,m9:()=>d,mr:()=>r,oo:()=>i});var s=a(95087);const r={algorithm:"argon2d",saltLength:16,tCost:3,mCost:32768,parallelism:2},n={algorithm:"pbkdf2",saltLength:16,iterations:2e5,hashAlgorithm:"sha256"},i={algorithm:"noderivation"},o={algorithm:"pbkdf2",saltLength:32,iterations:10204,hashAlgorithm:"sha1"};function c(e){return["argon2d","pbkdf2","noderivation"].some((t=>t===e))}function d(e){switch(e.algorithm){case"argon2d":case"pbkdf2":return e.saltLength;case"noderivation":return 0;default:(0,s.U)(e)}}},69591:(e,t,a)=>{a.d(t,{F:()=>s,g:()=>r});const s="$",r=1},33055:(e,t,a)=>{a.d(t,{ARGON2D_MARKER_SCHEMA:()=>s,NODERIVATION_MARKER_SCHEMA:()=>n,PBKDF2_MARKER_SCHEMA:()=>r});const s={count:9,index:{version:0,derivation:1,saltLength:2,tCost:3,mCost:4,parallelism:5,cipher:6,mode:7,ivLength:8}},r={count:8,index:{version:0,derivation:1,saltLength:2,iterations:3,hashAlgorithm:4,cipher:5,mode:6,ivLength:7}},n={count:5,index:{version:0,derivation:1,cipher:2,mode:3,ivLength:4}}},38291:(e,t,a)=>{a.d(t,{PD:()=>s,RB:()=>i,en:()=>r,jK:()=>n});const s="KWC5",r=16,n=32,i=0},6752:(e,t,a)=>{a.d(t,{b:()=>n});var s=a(54066);var r=a(12087);function n(e,t,a,n,i,o){if(0===e.byteLength)throw new Error("Attempting to derivate a key from an empty input");return"pbkdf2"===i.algorithm?(0,r.E)(a,o,i,e,t):async function(e,t,a,r,n){const{tCost:i,mCost:o,parallelism:c}=a,d=(0,s.u)(Object.values(a).join("")),l=t.getCacheKey(r,n,d),u=t.getCachedDerivation(l);if(u)return u;const p={tCost:i,mCost:o,parallelism:c},m=await e(r,n,p);return t.setCachedDerivation({cacheKey:l,data:m}),m}(n,o,i,e,t)}},12087:(e,t,a)=>{a.d(t,{E:()=>n});var s=a(54066),r=a(95087);async function n(e,t,a,n,i){const o=(0,s.u)(Object.values(a).join("")),c=t.getCacheKey(n,i,o),d=t.getCachedDerivation(c);if(d)return d;const l=function(e){switch(e){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:(0,r.U)(e)}}(a.hashAlgorithm),u=await e(n,i,{iterations:a.iterations,hashType:l});return t.setCachedDerivation({cacheKey:c,data:u}),u}},60745:(e,t,a)=>{a.d(t,{F:()=>j,V:()=>M});var s=a(82933),r=a(89685),n=a(95087),i=a(94805);function o({transportableData:e,marker:t,metadata:a}){const s=t.length+a.length;return e.substring(s)}var c=a(54066);function d({encipheredContents:e,marker:t,metadata:a}){const{derivation:s,cipher:r,type:n,version:i}=t,{iv:o,salt:d,signature:l}=a;return{type:n,version:i,derivationConfig:s,cipherConfig:r,salt:(0,c.u)(d),signature:(0,c.u)(l),iv:(0,c.u)(o),encipheredContents:(0,c.u)(e)}}function l({str:e,substr:t,occurrence:a}){if(a<1)return-1;let s=0,r=-1;for(;s<a;){if(r=e.indexOf(t,r+1),r<0)return r;s++}return r}var u=a(69591);function p({transportableData:e,makeMarker:t,schema:a}){const s=a.count+1,r=l({str:e,substr:u.F,occurrence:s}),n=e.substring(1,r).split(u.F);if(n.length!==a.count)throw new Error("Marker and schema length mismatch");return t({bytes:r+1,markerSchema:a,values:n})}var m=a(7165);const h=m.z.object({algorithm:m.z.literal("aes256"),mode:m.z.literal("cbchmac"),ivLength:m.z.literal(16)}),g=m.z.object({algorithm:m.z.literal("aes256"),mode:m.z.literal("cbchmac64"),ivLength:m.z.literal(16)}),v=m.z.union([h,g]),y=m.z.object({algorithm:m.z.literal("argon2d"),saltLength:m.z.literal(16),tCost:m.z.number(),mCost:m.z.number(),parallelism:m.z.number()}),f=m.z.object({algorithm:m.z.literal("pbkdf2"),saltLength:m.z.union([m.z.literal(16),m.z.literal(32)]),iterations:m.z.number(),hashAlgorithm:m.z.enum(["sha1","sha256"])}),_=m.z.object({algorithm:m.z.literal("noderivation")}),b=m.z.literal("flexible"),S=m.z.object({version:m.z.literal(1),type:b,length:m.z.number(),derivation:y,cipher:h});function w({bytes:e,markerSchema:t,values:a}){const{version:s,derivation:r,saltLength:n,tCost:i,mCost:o,parallelism:c,cipher:d,mode:l,ivLength:u}=t.index,p=S.safeParse({version:Number(a[s]),type:"flexible",length:e,derivation:{algorithm:a[r],saltLength:Number(a[n]),tCost:Number(a[i]),mCost:Number(a[o]),parallelism:Number(a[c])},cipher:{algorithm:a[d],mode:a[l],ivLength:Number(a[u])}});if(!p.success)throw new Error(p.error.message);return p.data}var E=a(33055);const C=32;function T({transportableData:e,marker:t}){const{length:a,derivation:s,cipher:r}=t,n=s.saltLength,{ivLength:i}=r,o=a+0,c=o+n,d=c+i;return{iv:e.substring(c,c+i),length:n+i+C,salt:e.substring(o,o+n),signature:e.substring(d,d+C)}}const I=m.z.object({version:m.z.literal(1),type:b,length:m.z.number(),derivation:_,cipher:v});function A({bytes:e,markerSchema:t,values:a}){const{version:s,cipher:r,mode:n,ivLength:i}=t.index,o=I.safeParse({version:Number(a[s]),type:"flexible",length:e,derivation:{algorithm:"noderivation"},cipher:{algorithm:a[r],mode:a[n],ivLength:Number(a[i])}});if(!o.success)throw new Error(o.error.message);return o.data}function N(){return e=>{const t=p({transportableData:e,makeMarker:A,schema:E.NODERIVATION_MARKER_SCHEMA}),a=function({transportableData:e,marker:t}){const{length:a,cipher:s}=t,{ivLength:r}=s,n=a+0,i=n+r;return{iv:e.substring(n,n+r),length:r+C,signature:e.substring(i,i+C)}}({transportableData:e,marker:t});return function({encipheredContents:e,marker:t,metadata:a}){const{derivation:s,cipher:r,type:n,version:i}=t,{iv:o,signature:d}=a;return{type:n,version:i,derivationConfig:s,cipherConfig:r,signature:(0,c.u)(d),iv:(0,c.u)(o),encipheredContents:(0,c.u)(e)}}({encipheredContents:o({transportableData:e,marker:t,metadata:a}),marker:t,metadata:a})}}const U=m.z.object({version:m.z.literal(1),type:b,length:m.z.number(),derivation:f,cipher:h});function F({bytes:e,markerSchema:t,values:a}){const{version:s,derivation:r,saltLength:n,iterations:i,hashAlgorithm:o,cipher:c,mode:d,ivLength:l}=t.index,u=U.safeParse({version:Number(a[s]),type:"flexible",length:e,derivation:{algorithm:a[r],saltLength:Number(a[n]),iterations:Number(a[i]),hashAlgorithm:a[o]},cipher:{algorithm:a[c],mode:a[d],ivLength:Number(a[l])}});if(!u.success)throw new Error(u.error.message);return u.data}function D({transportableData:e,index:t}){const a=t+1,s=l({str:e,substr:u.F,occurrence:a}),r=l({str:e,substr:u.F,occurrence:a+1});if(-1===s||-1===r)throw new Error("Marker info indices not found");return e.substring(s+1,r)}const O=0,P=1;function x(e){switch(e){case"argon2d":return e=>{const t=p({transportableData:e,makeMarker:w,schema:E.ARGON2D_MARKER_SCHEMA}),a=T({transportableData:e,marker:t});return d({encipheredContents:o({transportableData:e,marker:t,metadata:a}),marker:t,metadata:a})};case"pbkdf2":return e=>{const t=p({transportableData:e,makeMarker:F,schema:E.PBKDF2_MARKER_SCHEMA}),a=T({transportableData:e,marker:t});return d({encipheredContents:o({transportableData:e,marker:t,metadata:a}),marker:t,metadata:a})};case"noderivation":return N();default:(0,n.U)(e)}}var R=a(6424),k=a(58396),L=a(6752);async function M(e,t,a,n){const o=function(e){const t=(0,r.v)(e),a=D({transportableData:t,index:O});if(Number(a)!==u.g)throw new Error("Marker version not supported");const s=D({transportableData:t,index:P});if(!(0,i.b9)(s))throw new Error("Derivation algorithm not supported");return x(s)(t)}(n),{deriveKeyArgon2d:c,deriveKeyPbkdf2:d}=t,{derivationConfig:l,salt:p}=o,{algorithm:m}=l,h="pbkdf2"===m||"argon2d"===m;if(h&&!p)throw new Error("Need salt for derivation");const g=h&&p?await(0,L.b)(e,p,d,c,l,a):e,{mode:v}=o.cipherConfig,{computeHash:y}=t,{encryptionKey:f,signatureKey:_}="cbchmac64"===v?await(0,k.U)(g):await(0,R.Y)(g,y),{iv:b,encipheredContents:S}=o,w=(0,s.K)(b,S),{signature:E}=o;return{signatureKey:_,signature:E,dataToSign:w,encryptionKey:f,iv:b,encipheredContents:S}}async function j(e,t,a,s){const{verifyHmacSha:r}=t,{signatureKey:n,signature:i,dataToSign:o,encryptionKey:c,iv:d,encipheredContents:l}=await M(e,t,a,s);if(!await r(n,i,o))throw new Error("Signature cannot be verified");const{decryptAes256:u}=t;return u(c,d,l)}},7449:(e,t,a)=>{a.d(t,{I:()=>l});var s=a(82933),r=a(94805),n=a(16698),i=a(38291);const o={type:"KWC5",derivation:r.oo,cipher:n.BU};function c(e){const t=function({transportableData:e,marker:t}){const{cipher:a,type:s}=t,{ivLength:r}=a,n=i.RB+r+i.en+s.length,o=n+i.jK;return{iv:e.slice(i.RB,i.RB+r),signature:e.slice(n,n+i.jK),encipheredContents:e.slice(o)}}({transportableData:e,marker:o});return{iv:t.iv,type:i.PD,signature:t.signature,encipheredContents:t.encipheredContents,derivationConfig:r.oo,cipherConfig:n.BU}}var d=a(6424);async function l(e,t,a){const r=c(a),{computeHash:n}=t,{encryptionKey:i,signatureKey:o}=await(0,d.Y)(e,n),{iv:l,encipheredContents:u}=r,p=(0,s.K)(l,u),{verifyHmacSha:m}=t,{signature:h}=r;if(!await m(o,h,p))throw new Error("Signature cannot be verified");const{decryptAes256:g}=t;return g(i,l,u)}},58396:(e,t,a)=>{function s(e){const t=new Uint8Array(e),a=e.byteLength/2,s=t.slice(0,a),r=t.slice(a);return Promise.resolve({encryptionKey:s.buffer,signatureKey:r.buffer})}a.d(t,{U:()=>s})},6424:(e,t,a)=>{a.d(t,{Y:()=>r});const s="SHA-512";async function r(e,t){const a=await t(e,s),r=new Uint8Array(a),n=a.byteLength/2,i=r.slice(0,n),o=r.slice(n,a.byteLength);return{encryptionKey:i.buffer,signatureKey:o.buffer}}},22609:(e,t,a)=>{a.d(t,{N:()=>r,z:()=>s});const s="AES-CBC",r=256},74017:(e,t,a)=>{a.d(t,{x:()=>s});const s="SHA-256"},83407:(e,t,a)=>{a.d(t,{$k:()=>s,Tt:()=>n,xJ:()=>r});const s="RSA-OAEP",r="RSASSA-PKCS1-v1_5",n="SHA-256"},22253:(e,t,a)=>{a.d(t,{j:()=>s});class s{}},85260:(e,t,a)=>{var s;a.d(t,{W:()=>r}),function(e){e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE",e[e.DELETE_MULTIPLE=3]="DELETE_MULTIPLE"}(s||(s={}));class r{constructor(e){this.headers=new Map,this.normalizedNames=new Map,"string"==typeof e?this.initFromString(e):e&&this.initFromObject(e)}has(e){return this.headers.has(e.toLowerCase())}get(e){const t=this.headers.get(e.toLowerCase());return t?.[0]??null}keys(){return Array.from(this.normalizedNames.values())}getAll(e){return this.headers.get(e.toLowerCase())??null}append(e,t){return this.clone({name:e,value:t,op:s.APPEND})}set(e,t){return this.clone({name:e,value:t,op:s.SET})}delete(e,t){return this.clone({name:e,value:t,op:s.DELETE})}deleteMultiple(e){return this.clone({names:e,op:s.DELETE_MULTIPLE})}toObject(){return Object.fromEntries(this.headers)}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}clone(e){const t=new r;return t.initFromOther(this),t.applyUpdate(e),t}applyUpdate(e){switch(e.op){case s.APPEND:case s.SET:{const t=e.name.toLowerCase();let a=e.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(e.name,t);const r=(e.op===s.APPEND?this.headers.get(t):void 0)??[];r.push(...a),this.headers.set(t,r)}break;case s.DELETE:{const t=e.name.toLowerCase(),a=e.value;if(a){let e=this.headers.get(t);if(!e)return;const s=Array.isArray(a)?a:[a];e=e.filter((e=>!s.includes(e))),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}break;case s.DELETE_MULTIPLE:e.names.forEach((e=>{const t=e.toLowerCase();this.headers.delete(t),this.normalizedNames.delete(t)}))}}initFromOther(e){Array.from(e.headers.keys()).forEach((t=>{this.headers.set(t,[...e.headers.get(t)]),this.normalizedNames.set(t,e.normalizedNames.get(t))}))}initFromObject(e){Object.keys(e).forEach((t=>{let a=e[t];const s=t.toLowerCase();"string"==typeof a&&(a=[a]),a.length>0&&(this.headers.set(s,a),this.maybeSetNormalizedName(t,s))}))}initFromString(e){e.split("\n").forEach((e=>{const t=e.indexOf(":");if(t>0){const a=e.slice(0,t),s=a.toLowerCase(),r=e.slice(t+1).trim();this.maybeSetNormalizedName(a,s),this.headers.has(s)?this.headers.get(s).push(r):this.headers.set(s,[r])}}))}}},61223:(e,t,a)=>{a.d(t,{L:()=>n});class s{encodeKey(e){return this.standardEncoding(e)}encodeValue(e){return this.standardEncoding(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}standardEncoding(e){return encodeURIComponent(e).replace(s.STANDARD_ENCODING_REGEX,((e,t)=>s.STANDARD_ENCODING_REPLACEMENTS[t]??e))}}var r;s.STANDARD_ENCODING_REGEX=/%(\d[a-f0-9])/gi,s.STANDARD_ENCODING_REPLACEMENTS={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"},function(e){e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE"}(r||(r={}));class n{constructor(e={},t={}){this.map=new Map,this.encoder=t.encoder??new s,"string"==typeof e?this.initFromString(e):this.initFromObject(e)}has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?.[0]??null}getAll(e){return this.map.get(e)??null}keys(){return Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:r.APPEND})}appendAll(e){const t=[];return Object.keys(e).forEach((a=>{const s=e[a];Array.isArray(s)?s.forEach((e=>{t.push({param:a,value:e,op:r.APPEND})})):t.push({param:a,value:s,op:r.APPEND})})),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:r.SET})}delete(e,t){return this.clone({param:e,value:t,op:r.DELETE})}toString(){return this.keys().map((e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map((e=>t+"="+this.encoder.encodeValue(e))).join("&")})).filter((e=>""!==e)).join("&")}clone(e){const t=new n({},{encoder:this.encoder});return t.initFromOther(this),t.applyUpdates(Array.isArray(e)?e:[e]),t}initFromOther(e){e.keys().forEach((t=>this.map.set(t,[...e.map.get(t)])))}initFromObject(e){Object.keys(e).forEach((t=>{const a=e[t],s=n.isValueArray(a)?a.map(n.valueToString):[n.valueToString(a)];this.map.set(t,s)}))}initFromString(e){const{encoder:t}=this;if(e.length>0){e.replace(/^\?/,"").split("&").forEach((e=>{const a=e.indexOf("="),[s,r]=-1===a?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,a)),t.decodeValue(e.slice(a+1))],n=this.map.get(s)??[];n.push(r),this.map.set(s,n)}))}}applyUpdates(e){e.forEach((e=>{switch(e.op){case r.APPEND:case r.SET:{const t=(e.op===r.APPEND?this.map.get(e.param):void 0)??[];t.push(n.valueToString(e.value)),this.map.set(e.param,t);break}case r.DELETE:if(void 0===e.value){this.map.delete(e.param);break}{const t=this.map.get(e.param)??[],a=t.indexOf(n.valueToString(e.value));-1!==a&&t.splice(a,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}))}static valueToString(e){return`${e}`}static isValueArray(e){return Array.isArray(e)}}},4043:(e,t,a)=>{a.d(t,{a:()=>n});var s=a(85260),r=a(61223);class n{constructor(e,t,a,i){this.body=null,this.headers=new s.W,this.withCredentials=!1,this.timeout=6e4,this.responseType="json",this.params=new r.L({}),this.url=t,this.method=e,n.mightHaveBody(this.method)&&(this.body=a??null),i&&(this.withCredentials=Boolean(i.withCredentials),i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=this.getHeadersFromOptions(i.headers)),i.params&&(this.params=this.getParamsFromOptions(i.params)),i.timeout&&i.timeout>0&&(this.timeout=i.timeout),i.mode&&(this.mode=i.mode)),this.urlWithParams=this.initUrlWithParams()}serializeBody(){return null===this.body?null:n.isArrayBuffer(this.body)||"string"==typeof this.body?this.body:this.body instanceof r.L?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||n.isArrayBuffer(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof r.L?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method??this.method,a=e.url??this.url,s=e.responseType??this.responseType,r=void 0!==e.body?e.body:this.body,i=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,o=void 0!==e.timeout?e.timeout:this.timeout,c=e.mode??this.mode;let d=e.headers?this.getHeadersFromOptions(e.headers):this.headers,l=e.params?this.getParamsFromOptions(e.params):this.params;const u=e.setHeaders;u&&(d=Object.keys(u).reduce(((e,t)=>e.set(t,u[t])),d));const p=e.setParams;return p&&(l=Object.keys(p).reduce(((e,t)=>e.set(t,p[t])),l)),new n(t,a,r,{params:l,headers:d,responseType:s,withCredentials:i,timeout:o,mode:c})}getHeadersFromOptions(e){return e instanceof s.W?e:new s.W(e)}getParamsFromOptions(e){return e instanceof r.L?e:new r.L(e)}initUrlWithParams(){const e=this.params.toString();if(0===e.length)return this.url;const t=this.url.indexOf("?"),a=-1===t?"?":t<this.url.length-1?"&":"";return this.url+a+e}static mightHaveBody(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":return!1;default:return!0}}static isArrayBuffer(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}}},12964:(e,t,a)=>{a.d(t,{Z:()=>c});var s=a(91174),r=a(85260),n=a(25994);async function i(e){const t=e.getReader();let a=new Uint8Array(0),s=await t.read();for(;!s.done;){const e=new Uint8Array(a.byteLength+s.value.byteLength);e.set(a,0),e.set(s.value,a.byteLength),a=e,s=await t.read()}return a}class o{constructor(e){this.bytesRead=0,this.data=e}pull(e){const{bytesRead:t,data:a}=this;if(t>=a.byteLength)return void e.close();const s=Math.min(a.byteLength-t,e.desiredSize??1/0);if(s>0){const r=new Uint8Array(a,t,s);e.enqueue(r),this.bytesRead+=s}t>=a.byteLength&&e.close()}}class c{constructor(e={},t=n.W.Ok,a="OK"){this.headers=e.headers instanceof r.W?e.headers:new r.W(e.headers),this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText??a,this.url=e.url??null,this.ok=this.status>=200&&this.status<300,this.body=void 0!==e.body?e.body:null}clone(e={}){return new c({body:void 0!==e.body?e.body:null===this.body?null:this.body instanceof s.Pz?this.body.tee()[0]:this.body,headers:e.headers??this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText??this.statusText,url:e.url??this.url??void 0})}isBodyReadableStream(){return!!this.body&&"object"==typeof this.body&&"ReadableStream"===this.body.constructor.name}async arrayBuffer(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){return(await i(this.body)).buffer}if(!(this.body instanceof ArrayBuffer))throw new Error("Unexpected body type, not an ArrayBuffer");return this.body}async text(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const e=await i(this.body);return(new TextDecoder).decode(e.buffer)}if("string"!=typeof this.body)throw new Error("Unexpected body type, not a string");return this.body}async json(e){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const t=await i(this.body),a=(new TextDecoder).decode(t.buffer);try{const t=JSON.parse(a);return e.decode(t)}catch(e){throw new Error("Failed to parse response body JSON")}}if(this.body instanceof ArrayBuffer||"string"==typeof this.body)throw new Error("Unexpected body type");return e.decode(this.body)}bodyStream(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name)return this.body;const e=new TextEncoder;if("string"==typeof this.body)return new s.Pz(new o(e.encode(this.body).buffer));if(this.body instanceof ArrayBuffer)return new s.Pz(new o(this.body));const t=JSON.stringify(this.body);return new s.Pz(new o(e.encode(t).buffer))}}},25994:(e,t,a)=>{var s;a.d(t,{W:()=>s}),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(s||(s={}))},73155:(e,t,a)=>{a.d(t,{R:()=>r,a:()=>n});var s=a(96168);class r extends((0,s.Hu)("BadStatus","The HTTP response has a non-successful status code (not 2XX)")){constructor(e){super(),this.response=e}}class n extends((0,s.Hu)("FetchFailedError","Something happened while communicating to the server")){}},22064:(e,t,a)=>{a.d(t,{M:()=>s});const s="file-upload"},96168:(e,t,a)=>{a.d(t,{As:()=>n,BU:()=>i,Hu:()=>r,Vj:()=>s});const s=(e,t="")=>()=>({tag:e,message:t}),r=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}};function n(e,t){return t.includes(e.tag)}const i=e=>e.tag},20195:(e,t,a)=>{function s(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}a.d(t,{j:()=>s})},59420:(e,t,a)=>{a.r(t),a.d(t,{FILE_UPLOAD:()=>u.M,FunctionalError:()=>s.Hu,assertUnreachable:()=>n.U,assertsSuccess:()=>o.nt,concatMapFailure:()=>c.Tc,concatMapSuccess:()=>c.Gx,concatMatchResult:()=>c.RW,createMatchable:()=>i.H6,defineFunctionalError:()=>s.Vj,failure:()=>o.Rn,getBrander:()=>l.zq,getFailure:()=>o.Yv,getSuccess:()=>o.db,getSuccessOrThrow:()=>o.ho,hasProperty:()=>l.l$,isFailure:()=>o.hx,isFunctionalErrorOfType:()=>s.As,isMatchable:()=>i.cw,isObject:()=>p.K,isResult:()=>o.AZ,isSuccess:()=>o.d6,mapFailure:()=>o.SN,mapFailureObservable:()=>c.DZ,mapResultObservable:()=>c.vg,mapSuccess:()=>o.ty,mapSuccessObservable:()=>c.Qn,mapSuccessResultObservable:()=>c.lk,match:()=>i.EQ,matchMap:()=>d.G,matchResult:()=>o.f2,matchResultObservable:()=>c.nb,panic:()=>r.j,safeCast:()=>l.Ay,success:()=>o.Vp,switchMapFailure:()=>c.pr,switchMapSuccess:()=>c.CP,switchMatchResult:()=>c.bM,toFunctionalErrorCode:()=>s.BU});var s=a(96168),r=a(20195),n=a(95087),i=a(18533),o=a(87279),c=a(48844),d=a(25535),l=a(28489),u=a(22064),p=a(55209)},95087:(e,t,a)=>{function s(e,t){throw new Error(t??`Unreachable code detected (${e})`)}a.d(t,{U:()=>s})},25535:(e,t,a)=>{a.d(t,{G:()=>s});const s=(e,t)=>t[e]()},18533:(e,t,a)=>{a.d(t,{EQ:()=>r,H6:()=>s,cw:()=>n});const s=(e,t)=>({tag:e,...t}),r=(e,t)=>{const a=e.tag,s=a in t?t[a]:null;if(!s)throw new Error("Unmatchable case");return s(e)},n=(e,...t)=>{if("object"!=typeof e||!e)return!1;return"tag"in e&&t.includes(e.tag)}},48844:(e,t,a)=>{a.d(t,{CP:()=>v,DZ:()=>l,Gx:()=>m,Qn:()=>d,RW:()=>g,Tc:()=>h,bM:()=>f,lk:()=>p,nb:()=>c,pr:()=>y,vg:()=>u});var s=a(87065),r=a(34987),n=a(43978),i=a(87279),o=a(18533);function c(e){return t=>t.pipe((0,s.U)((t=>(0,o.EQ)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))}function d(e){return t=>t.pipe((0,s.U)((t=>(0,i.hx)(t)?t:(0,i.Vp)(e(t.data)))))}function l(e){return t=>t.pipe((0,s.U)((t=>(0,i.d6)(t)?t:(0,i.Rn)(e(t.error)))))}function u(e,t){return a=>a.pipe((0,s.U)((a=>(0,i.hx)(a)?t?t(a.error):a:e(a.data))))}function p(e){return t=>t.pipe((0,s.U)((t=>(0,i.hx)(t)?t:e(t.data))))}function m(e){return t=>t.pipe((0,r.b)((async t=>(0,i.hx)(t)?t:(0,i.Vp)(await e(t.data)))))}function h(e){return t=>t.pipe((0,r.b)((async t=>(0,i.d6)(t)?t:(0,i.Rn)(await e(t.error)))))}function g(e){return t=>t.pipe((0,r.b)((t=>(0,i.f2)(t,e))))}function v(e){return t=>t.pipe((0,n.w)((async t=>(0,i.hx)(t)?t:(0,i.Vp)(await e(t.data)))))}function y(e){return t=>t.pipe((0,n.w)((async t=>(0,i.d6)(t)?t:(0,i.Rn)(await e(t.error)))))}function f(e){return t=>t.pipe((0,n.w)((t=>(0,i.f2)(t,e))))}},87279:(e,t,a)=>{a.d(t,{nt:()=>l,Rn:()=>o,Yv:()=>g,db:()=>m,ho:()=>h,hx:()=>u,AZ:()=>p,d6:()=>d,SN:()=>y,ty:()=>v,f2:()=>c,Vp:()=>i});var s=a(18533);const r="success",n="failure",i=e=>(0,s.H6)("success",{data:e}),o=e=>(0,s.H6)("failure",{error:e}),c=(e,t)=>(0,s.EQ)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)}),d=e=>e.tag===r;function l(e){if(!d(e))throw new Error("Is not a success")}const u=e=>e.tag===n,p=e=>(0,s.cw)(e,r,n),m=e=>e.data,h=e=>(l(e),e.data),g=e=>e.error,v=(e,t)=>u(e)?e:i(t(e.data)),y=(e,t)=>d(e)?e:o(t(e.error))},55209:(e,t,a)=>{a.d(t,{K:()=>s});const s=e=>"object"==typeof e&&null!==e},28489:(e,t,a)=>{a.d(t,{Ay:()=>r,l$:()=>n,zq:()=>s});const s=e=>t=>Object.assign(t,{brand:e}),r=e=>e;function n(e,t){return t in e}},54070:(e,t,a)=>{a.d(t,{m:()=>c});var s=a(75958),r=a(99930),n=a(68076),i=a(88661),o=a(66557);const c=(0,s.Q)({name:"scim",commands:{updateScimConfiguration:r.G,generateScimToken:n.S},events:{},queries:{scimConfiguration:i.I,scimEndpoint:o.v}})},68076:(e,t,a)=>{a.d(t,{S:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},99930:(e,t,a)=>{a.d(t,{G:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},88661:(e,t,a)=>{a.d(t,{I:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},66557:(e,t,a)=>{a.d(t,{v:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},43991:(e,t,a)=>{a.d(t,{y:()=>b});var s=a(75958),r=a(80246),n=a(90435),i=a(42308),o=a(21454),c=a(99614),d=a(82062),l=a(48187),u=a(49574),p=a(54602),m=a(88187),h=a(37461),g=a(75998),v=a(56346),y=a(27326),f=a(63874),_=a(18306);const b=(0,s.Q)({name:"confidentialSSOApi",commands:{CheckDNSValidationCommand:r.o,ClearSettingsCommand:n.h,CreateTeamCommand:i.p,MigrateToConfidentialSsoCommand:o.Dt,DeleteDomainCommand:c.k,EnableSsoCommand:d.F,InitSsoProvisioningCommand:l.S,LoginUserWithEnclaveSSOCommand:u.B,ProvisionDomainCommand:p.p,TestLoginUserWithEnclaveSSOCommand:m.b,UpdateMetadataCommand:h.o,ValidateMetadataCommand:g.l,UpdateGroupProvisioningConfigurationCommand:v.Z5},events:{confidentialSsoSettingsReset:y.z},queries:{SsoProvisioningQuery:f._,GetGroupProvisioningConfigurationQuery:_.$}})},51448:(e,t,a)=>{a.d(t,{E:()=>n});var s=a(8260),r=a(43991);class n extends((0,s.E)(r.y)){}(0,s.K)(r.y,n)},80246:(e,t,a)=>{a.d(t,{o:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},90435:(e,t,a)=>{a.d(t,{h:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},42308:(e,t,a)=>{a.d(t,{p:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},99614:(e,t,a)=>{a.d(t,{k:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},82062:(e,t,a)=>{a.d(t,{F:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},48187:(e,t,a)=>{a.d(t,{S:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},49574:(e,t,a)=>{a.d(t,{B:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.Device})){}},21454:(e,t,a)=>{a.d(t,{Dt:()=>d,Fw:()=>c,hw:()=>o});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.SSO_CONNECTOR_KEY_MISSING="SSO_CONNECTOR_KEY_MISSING",e.SSO_CONNECTOR_KEY_FORMAT_INVALID="SSO_CONNECTOR_KEY_FORMAT_INVALID"}(s||(s={}));const o=(0,i.Vj)("SSO_CONNECTOR_KEY_MISSING","SSO Migration failed: SSO connector key is missing"),c=(0,i.Vj)("SSO_CONNECTOR_KEY_FORMAT_INVALID","SSO Migration failed: SSO connector key format is invalid");class d extends((0,r.g)({scope:n.F.User})){}},54602:(e,t,a)=>{a.d(t,{p:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},88187:(e,t,a)=>{a.d(t,{b:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},56346:(e,t,a)=>{a.d(t,{B3:()=>d,HC:()=>c,Y3:()=>u,Z5:()=>p,b2:()=>l,gY:()=>o,hJ:()=>s});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.MISMATCHING_ADMIN_PROVISIONING_KEY="MISMATCHING_ADMIN_PROVISIONING_KEY",e.IDP_NOT_FOUND="IDP_NOT_FOUND",e.NO_IDP_CONFIGURATION_UPDATE="NO_IDP_CONFIGURATION_UPDATE"}(s||(s={}));const o=(0,i.Vj)("TEAM_NOT_FOUND","Team not found"),c=(0,i.Vj)("MISMATCHING_ADMIN_PROVISIONING_KEY","Mismatching admin provisioning key"),d=(0,i.Vj)("IDP_NOT_FOUND","IDP not found"),l=(0,i.Vj)("NO_IDP_CONFIGURATION_UPDATE","No IDP configuration update"),u=(0,i.Vj)("GENERIC_ERROR","Generic error");class p extends((0,r.g)({scope:n.F.User})){}},37461:(e,t,a)=>{a.d(t,{o:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},75998:(e,t,a)=>{a.d(t,{l:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},27326:(e,t,a)=>{a.d(t,{z:()=>n});var s=a(446),r=a(62149);class n extends((0,s.d)({scope:r.F.User})){}},18306:(e,t,a)=>{a.d(t,{$:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},63874:(e,t,a)=>{a.d(t,{_:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},95450:(e,t,a)=>{a.d(t,{JU:()=>u,X5:()=>r,s5:()=>c});var s=a(7165);s.z.object({groupProvisioningActivated:s.z.boolean()}),s.z.object({idpUuid:s.z.string().uuid(),certificates:s.z.array(s.z.string()),entrypoint:s.z.string(),groupProvisioningActivated:s.z.boolean().optional(),creationDateUnix:s.z.number(),updateDateUnix:s.z.number()});const r=s.z.enum(["valid","pending","expired","invalid"]),n=s.z.enum(["tokenNotFound","invalidToken"]),i=s.z.object({status:r.nullable(),verificationToken:s.z.string(),lastCheckDateUnix:s.z.number(),pendingReason:n.nullable(),expiryDateUnix:s.z.number()}),o=s.z.object({creationDateUnix:s.z.number(),dnsCheckStatus:i,domainName:s.z.string(),idpUuid:s.z.ostring(),updateDateUnix:s.z.number()}),c=s.z.enum(["NitroComplete","NitroIncomplete","SelfHostedComplete","SelfHostedIncomplete","SsoConnectorIncomplete","SsoConnectorComplete","SsoConnectorToSelfHostedMigration","None","Unknown"]);s.z.record(s.z.string(),o);const d=s.z.object({subdomainValue:s.z.string().nullable(),txtValue:s.z.string().nullable(),verificationStatus:r.nullable(),tokenFound:s.z.string().nullable(),pendingReason:n.nullable()}),l=s.z.array(s.z.object({domainName:s.z.string().url(),verificationStatus:r,idpUuid:s.z.string().optional().nullable()})),u=s.z.object({global:s.z.object({adminProvisioningKey:s.z.string().nullable(),isTeamProvisionedInNitro:s.z.boolean().nullable(),inferredSsoState:c,teamUuid:s.z.string().nullable(),ssoCapable:s.z.boolean().nullable(),ssoIsNitroProvider:s.z.boolean().nullable()}),idpApplication:s.z.object({entityId:s.z.string().nullable(),acsUrl:s.z.string().nullable(),signOnUrl:s.z.string().nullable()}),idpMetadata:s.z.object({metadataValue:s.z.string().nullable(),idpUuid:s.z.string().nullable(),groupProvisioningActivated:s.z.boolean().nullable()}),domainSetup:l,domainVerificationInfo:s.z.record(s.z.string().url(),d),enableSSO:s.z.object({ssoEnabled:s.z.boolean().nullable()})})},62076:(e,t,a)=>{a.d(t,{x:()=>r});const s=["local","staging","prod"];function r(e){return s.some((t=>t===e))}},57986:(e,t,a)=>{a.d(t,{X:()=>o});var s=a(491),r=a(92587),n=a(81310),i=a(88943);class o{get auditLogs(){return this.auditLogsService}get auditLogsMassDeployment(){return this.auditLogsMassDeploymentService}constructor(e,t){this.auditLogsService=e,this.auditLogsMassDeploymentService=t}}o=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.Z?Object:n.Z,void 0===i.A?Object:i.A])],o)},52401:(e,t,a)=>{a.d(t,{h:()=>s});class s{constructor({appKeys:e,cloudflareHeaders:t,environment:a}){this.appKeys=e,this.cloudflareHeaders=t,this.environment=a}}},77153:(e,t,a)=>{a.d(t,{y:()=>h});var s=a(491),r=a(91743),n=a(86006),i=a(75421),o=a(16624),c=a(41511),d=a(57986),l=a(81310),u=a(88943),p=a(20581),m=a(52401);class h{static configure(e,t,a){return{module:h,configurations:{enclaveProxyConfig:(0,r.z)({appKeys:e,cloudflareHeaders:t,environment:a})}}}}h=(0,s.__decorate)([(0,n.Yl)({sharedModuleName:"enclaveProxy",imports:[i.X,o.D,c.n],providers:[l.Z,u.A,d.X,p.S],exports:[d.X],stores:[],configurations:{enclaveProxyConfig:{token:m.h}}})],h)},88943:(e,t,a)=>{a.d(t,{A:()=>c});var s=a(491),r=a(92587),n=a(49427),i=a(63960),o=a(20581);class c{store(e){const t={auditLogs:e};return this.sendToProxyService.sendToProxy({authenticationType:"massDeployedTeamKey",endpoint:n.K.AUDIT_LOGS_MASS_DEPLOYMENT_STORE,rawPayload:t,responseBodyDecoder:new i.F})}constructor(e){this.sendToProxyService=e}}c=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.S?Object:o.S])],c)},81310:(e,t,a)=>{a.d(t,{Z:()=>m});var s=a(491),r=a(92587),n=a(49427),i=a(63960),o=a(7165);const c=o.z.object({queryExecutionId:o.z.string()});class d{decode(e){const t=c.safeParse(e);if(!t.success)throw new Error("AuditLogsQueryStart: invalid response format");return t.data.queryExecutionId}}const l=o.z.object({nextToken:o.z.string().nullable().optional(),results:o.z.array(o.z.string()).optional(),state:o.z.string()});class u{decode(e){const t=l.safeParse(e);if(!t.success)throw new Error("AuditLogsQueryResults: invalid response format");return{nextToken:t.data.nextToken,results:t.data.results,state:t.data.state}}}var p=a(20581);class m{store(e){const t={auditLogs:e};return this.sendToProxyService.sendToProxy({authenticationType:"userDevice",endpoint:n.K.AUDIT_LOGS_STORE,rawPayload:t,responseBodyDecoder:new i.F})}queryStart(e){return this.sendToProxyService.sendToProxy({authenticationType:"userDevice",endpoint:n.K.AUDIT_LOGS_START_QUERY,rawPayload:e,responseBodyDecoder:new d})}queryResults(e){const t={...e,maxResults:e.maxResults??100};return this.sendToProxyService.sendToProxy({authenticationType:"userDevice",endpoint:n.K.AUDIT_LOGS_QUERY_RESULTS,rawPayload:t,responseBodyDecoder:new u})}constructor(e){this.sendToProxyService=e}}m=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.S?Object:p.S])],m)},63960:(e,t,a)=>{a.d(t,{F:()=>n});var s=a(7165);const r=s.z.object({invalidAuditLogs:s.z.array(s.z.object({error:s.z.string(),uuid:s.z.string()}))});class n{decode(e){const t=r.safeParse(e);if(!t.success)throw new Error("StoreAuditLogs: invalid response format");return{invalidAuditLogs:t.data.invalidAuditLogs}}}},49427:(e,t,a)=>{var s;a.d(t,{K:()=>s}),function(e){e.AUDIT_LOGS_START_QUERY="logs/StartAuditLogsQuery",e.AUDIT_LOGS_QUERY_RESULTS="logs/GetAuditLogQueryResults",e.AUDIT_LOGS_STORE="logs/StoreAuditLogs",e.AUDIT_LOGS_MASS_DEPLOYMENT_STORE="logs-massdeployment/StoreAuditLogs",e.CLIENT_HELLO="tunnel/ClientHello",e.TERMINATE_HELLO="tunnel/TerminateHello"}(s||(s={}))},20581:(e,t,a)=>{a.d(t,{S:()=>V});var s=a(491),r=a(75377),n=a(64987),i=a(92587),o=a(26468),c=a(35159),d=a(87279),l=a(18533),u=a(49427);let p=null;const m=e=>{p=e};var h=a(7165);const g=h.z.object({data:h.z.object({attestation:h.z.string(),tunnelUuid:h.z.string()}),requestId:h.z.string()});class v{decode(e){const t=g.safeParse(e);if(!t.success)throw new Error("ClientHello: invalid response format");return{attestation:r.from_hex(t.data.data.attestation),tunnelUuid:t.data.data.tunnelUuid}}}var y=a(40767);const f=e=>{const t=(0,y.p)(new Uint8Array(e)),a=(s=t,Array.isArray(s)?s:s.value);var s;const[r,,n,i]=a;if(!r)throw new Error("parseSignedMessage: no protected header field");if(!n)throw new Error("parseSignedMessage: no payload field");if(!i)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(n).buffer,protectedHeaders:new Uint8Array(r).buffer,signature:new Uint8Array(i).buffer}};var _=a(89685),b=a(7502);const S=h.z.object({module_id:h.z.string(),timestamp:h.z.bigint(),digest:h.z.string(),pcrs:h.z.record(h.z.string(),h.z.instanceof(Uint8Array)),certificate:h.z.instanceof(Uint8Array),cabundle:h.z.array(h.z.instanceof(Uint8Array)),user_data:h.z.instanceof(Uint8Array),nonce:h.z.instanceof(Uint8Array).nullable()}),w=h.z.object({header:h.z.string(),publicKey:h.z.string()});var E=a(71833);var C=a(76746);var T=a(96303);const I=e=>(0,T.k)((e=>new Uint8Array(e).buffer)(e)),A=async e=>{const{attestation:t,rootCertBER:a,expectedPCRs:s}=e,{protectedHeaders:r,payload:n,signature:i}=f(t),o=(e=>{const t=(0,y.p)(e),a=S.safeParse(t);if(!a.success)throw new Error("failed to parse attestation document");const s=a.data,r=(0,_.v)(s.user_data),n=JSON.parse(r),i=w.safeParse(n);if(!i.success)throw new Error("failed to parse server crypto info");const o=i.data;return{moduleId:s.module_id,timestamp:s.timestamp,digest:s.digest,pcrs:s.pcrs,certificate:new Uint8Array(s.certificate).buffer,cabundle:(c=s.cabundle,c.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,b.R)(o.header),serverPublicKey:(0,b.R)(o.publicKey),nonce:null!==s.nonce?new Uint8Array(s.nonce).buffer:null};var c})(n),c=await(async(e,t,a)=>{const s=E.KBB.fromBER(e),r=t.map((e=>E.KBB.fromBER(e)));r.push(s);const n=[E.KBB.fromBER((0,b.R)(a))],i=new E.DMg({trustedCerts:n,certs:r});return(await i.verify()).result})(o.certificate,o.cabundle,a);if(!c)throw new Error("Invalid cert chain!");const d=await(async(e,t,a,s)=>{const r=E.KBB.fromBER(s),n=await r.getPublicKey(),i=["Signature1",t,new ArrayBuffer(0),a],o=(0,C.d)(i);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},n,e,o)})(i,r,n,o.certificate);if(!d)throw new Error("Invalid signature!");return((e,t)=>{for(const[a,s]of Object.entries(t))if(s!==I(e[Number(a)]))throw new Error("PCRs did not match")})(o.pcrs,s),{serverPublicKey:o.serverPublicKey,serverHeader:o.serverHeader}},N=e=>"local"===e?{0:"9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"}:"staging"===e?{3:"90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"}:{3:"dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16",8:"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"},U=h.z.object({requestId:h.z.string()});class F{decode(e){const t=U.safeParse(e);if(!t.success)throw new Error("TerminateHello: invalid response format");return t.data.requestId}}var D=a(87244),O=a(11515),P=a(60399);const x=async e=>{const{appKeys:t,authenticationType:a,serverApiCredentialsService:s}=e;switch(a){case"app":return{type:"app",...t};case"userDevice":{const{deviceAccessKey:e,deviceSecretKey:a,login:r}=await(0,P.z)(s.getActiveUserDeviceCredentials());return{type:"userDevice",...t,login:r,accessKey:e,secretKey:a}}case"massDeployedTeamKey":{const{massDeployedTeamAccessKey:e,massDeployedTeamSecretKey:a}=await(0,P.z)(s.getMassDeploymentTeamKeyCredentials());return{type:"massDeployedTeamKey",...t,massDeployedTeamAccessKey:e,secretKey:a}}}};var R=a(52401);const k=h.z.object({data:h.z.object({encryptedData:h.z.string()}),requestId:h.z.string()});class L{decode(e){const t=k.safeParse(e);if(!t.success)throw new Error("SendEncrypted: invalid response format");return{encryptedData:t.data.data.encryptedData,requestId:t.data.requestId}}}const M=h.z.object({errors:h.z.array(h.z.object({code:h.z.string(),message:h.z.string(),type:h.z.string().optional()})),requestId:h.z.string()});class j{decode(e){const t=M.safeParse(e);if(!t.success)throw new Error("FailedResponse: invalid response format");return{error:t.data.errors[0],requestId:t.data.requestId}}}var z;!function(e){e.CLIENT_IDENTIFIER_NOT_FOUND="CLIENT_IDENTIFIER_NOT_FOUND",e.CLIENT_SESSION_NOT_PARSED="CLIENT_SESSION_NOT_PARSED",e.CLIENT_STATEIN_NOT_FOUND="CLIENT_STATEIN_NOT_FOUND",e.TUNNEL_UUID_NOT_FOUND="TUNNEL_UUID_NOT_FOUND"}(z||(z={}));class V{async sendToProxy(e){return await r.ready,await this.MUTEX.runExclusive((async()=>{const{authenticationType:t,endpoint:a,rawPayload:s,responseBodyDecoder:n}=e;let i=!0;const o=async()=>{const e=await this.getClientSession();if((0,d.hx)(e))return e;const{clientHello:c,terminateHello:u}=e.data,{tunnelUuid:p}=c,{clientStateIn:h,clientStateOut:g}=u,v=r.crypto_secretstream_xchacha20poly1305_push(g,r.from_string(JSON.stringify(s)),null,r.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),y={encryptedData:r.to_hex(v),tunnelUuid:p},f=await this.executeRequest({authenticationType:t,endpoint:a,payload:y,responseBodyDecoder:new L});if((0,d.hx)(f))try{return await(0,l.EQ)(f.error,{BadStatus:async e=>{const{code:t}=(await e.response.json(new j)).error;return!i||t!==z.TUNNEL_UUID_NOT_FOUND&&t!==z.CLIENT_IDENTIFIER_NOT_FOUND&&t!==z.CLIENT_SESSION_NOT_PARSED&&t!==z.CLIENT_STATEIN_NOT_FOUND?f:(i=!1,m(null),o())},FetchFailedError:()=>f})}catch(e){return f}const _=r.crypto_secretstream_xchacha20poly1305_pull(h,r.from_hex(f.data.encryptedData)).message,b=await n.decode(JSON.parse(r.to_string(_)));return(0,d.Vp)(b)};return o()}))}async getClientSession(){const e=p;if(e)return(0,d.Vp)(e);{const e=r.crypto_kx_keypair(),t=await this.clientHello(e);if((0,d.hx)(t))return t;const a=await this.terminateHello({clientKeyPair:e,clientHello:t.data});if((0,d.hx)(a))return a;const s={clientKeyPair:e,clientHello:t.data,terminateHello:a.data};return m(s),(0,d.Vp)(s)}}async clientHello(e){const t={clientPublicKey:r.to_hex(e.publicKey)},a=await this.executeRequest({authenticationType:"app",endpoint:u.K.CLIENT_HELLO,payload:t,responseBodyDecoder:new v});return(0,d.hx)(a)?a:(0,d.Vp)(a.data)}async terminateHello({clientKeyPair:e,clientHello:{attestation:t,tunnelUuid:a}}){const s=await A({attestation:t,rootCertBER:(n=this.enclaveProxyConfig.environment,"local"===n?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y="),expectedPCRs:N(this.enclaveProxyConfig.environment)});var n;const i=new Uint8Array(s.serverPublicKey),o=new Uint8Array(s.serverHeader),c=r.crypto_kx_client_session_keys(e.publicKey,e.privateKey,i),{state:l,header:p}=r.crypto_secretstream_xchacha20poly1305_init_push(c.sharedRx),m=r.crypto_secretstream_xchacha20poly1305_init_pull(o,c.sharedTx),h={clientHeader:r.to_hex(p),tunnelUuid:a},g=await this.executeRequest({authenticationType:"app",endpoint:u.K.TERMINATE_HELLO,payload:h,responseBodyDecoder:new F});return(0,d.hx)(g)?g:(0,d.Vp)({clientStateIn:m,clientStateOut:l,sessionKeys:c,serverHeader:o,serverPublicKey:i})}executeRequest(e){const{endpoint:t,...a}=e;return(async e=>{const{appKeys:t,authenticationType:a,cloudflareHeaders:s,httpClient:r,path:n,payload:i,responseBodyDecoder:o,serverApiCredentialsService:c}=e;return D.postRequestAPI({authentication:await x({appKeys:t,authenticationType:a,serverApiCredentialsService:c}),path:n,payload:i,requestFunction:e=>{const{headers:t,url:a}=e;return(0,P.z)(r.post(a,i,{headers:{...t,...s.accessKey&&s.secretKey&&{"CF-Access-Client-Id":s.accessKey,"CF-Access-Client-Secret":s.secretKey}},observe:"body",responseBodyDecoder:o,responseType:"json"}))},userAgent:O.getUserAgent()})})({appKeys:this.enclaveProxyConfig.appKeys,cloudflareHeaders:this.enclaveProxyConfig.cloudflareHeaders,httpClient:this.httpClient,path:`v1-nitro-encryption-service/${t}`,serverApiCredentialsService:this.serverApiCredentialsService,...a})}constructor(e,t,a){this.httpClient=e,this.serverApiCredentialsService=t,this.enclaveProxyConfig=a,this.MUTEX=new n.WU}}V=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.e?Object:o.e,void 0===c.n?Object:c.n,void 0===R.h?Object:R.h])],V)},36753:(e,t,a)=>{a.d(t,{i:()=>j});var s=a(491),r=a(86006),n=a(16624),i=a(19961),o=a(54070),c=a(62149),d=a(7165);d.z.enum(["NitroComplete","SelfHostedComplete","AdSyncComplete","None"]);const l=d.z.object({token:d.z.string(),active:d.z.boolean()}).optional();var u=a(63144),p=a(56618);const m=e=>l.safeParse(e).success;class h extends((0,u.Q)({persist:!1,capacity:p.Y._001KB,initialValue:undefined,scope:c.F.User,storeName:"confidential-scim-state",storeTypeGuard:m})){}var g=a(92587),v=a(76500),y=a(60399),f=a(87279),_=a(25917);class b{async getConfidentialScimConfig(){const e={token:"",active:!1},{teamUuid:t,adminProvisioningKey:a}=await this.getTeamIdentifiers(),s=await this.enclaveApiClient.scim.getScimConfiguration({teamUuid:t,adminProvisioningKey:a});if((0,f.hx)(s))throw new Error("cannot get scim configuration");const{active:r,token:n}=(0,f.db)(s);return e.active=r,e.token=n??"",e}async setConfidentialScimConfig(e){const{teamUuid:t,adminProvisioningKey:a}=await this.getTeamIdentifiers();await this.enclaveApiClient.scim.setScimConfiguration({teamUuid:t,adminProvisioningKey:a,token:e.token??"",active:e.active??!1})}async getTeamIdentifiers(){const e=await(0,y.z)(this.teamEnclaveClient.queries.getTeamIdentifiers());if((0,f.hx)(e))throw new Error("cannot get team info");const{teamUuid:t,adminProvisioningKey:a}=(0,f.db)(e);if(!a)throw new Error("[scimService] - adminProvisioningKey is missing, createTeamInEnclave should be called first");return{teamUuid:t,adminProvisioningKey:a}}constructor(e,t){this.enclaveApiClient=e,this.teamEnclaveClient=t}}b=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v.l?Object:v.l,void 0===_.G?Object:_.G])],b);var S=a(43978),w=a(37182),E=a(69885),C=a(46449),T=a(66557),I=a(99081);class A{execute(){return this.confidentialScimStore.state$.pipe((0,S.w)((async e=>{if(!e?.token)return(0,f.Rn)({tag:"Could not load team uuid"});const{teamUuid:t}=await this.confidentialScimService.getTeamIdentifiers();if(!t)return(0,f.Rn)({tag:"Could not load team uuid"});const a=new URL(`scim/${t}`,this.enclaveApiSettings.enclaveUrl);return(0,f.Vp)({endpoint:a.href})})),(0,w.K)((()=>(0,E.of)((0,f.Rn)({tag:"Could not load team uuid"})))))}constructor(e,t,a){this.enclaveApiSettings=e,this.confidentialScimService=t,this.confidentialScimStore=a}}A=(0,s.__decorate)([(0,C.e)(T.v),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===I.N6?Object:I.N6,void 0===b?Object:b,void 0===h?Object:h])],A);var N=a(36355),U=a(82874),F=a(99930);class D{async execute({body:e}){const t=await this.confidentialScimStore.getState();try{const a={token:e.token??(t?.token||""),active:e.active??!!t?.active};return await this.confidentialScimStore.set({...a}),await this.confidentialScimService.setConfidentialScimConfig({...t,...e}),(0,f.Vp)(void 0)}catch(e){return await this.confidentialScimStore.set(t),(0,f.Rn)({tag:e.message})}}constructor(e,t){this.confidentialScimService=e,this.confidentialScimStore=t}}D=(0,s.__decorate)([(0,U.W)(F.G),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b,void 0===h?Object:h])],D);var O=a(68076),P=a(51448),x=a(31108),R=a(48083);class k{async execute(){const e=await this.confidentialScimStore.getState(),{global:{ssoIsNitroProvider:t}}=await this.ssoProvisioningStore.getState();try{t||await this.createTeam();const e=crypto.randomUUID();return await this.confidentialScimStore.set({token:e,active:!1}),await this.confidentialScimService.setConfidentialScimConfig({token:e,active:!1}),(0,f.Vp)(void 0)}catch(t){return this.confidentialScimStore.set(e),(0,f.Rn)({tag:`Something wrong happened: ${t}`})}}async createTeam(){const e=await(0,y.z)(this.teamPlansClient.queries.getTeamId());if((0,f.hx)(e))throw new Error("TeamID not found, are you logged in?");await this.ssoClient.commands.initSsoProvisioning({teamId:`${e.data.teamId}`}),await this.ssoClient.commands.createTeam()}constructor(e,t,a,s,r){this.confidentialScimStore=e,this.confidentialScimService=t,this.ssoClient=a,this.teamPlansClient=s,this.ssoProvisioningStore=r}}k=(0,s.__decorate)([(0,U.W)(O.S),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===b?Object:b,void 0===P.E?Object:P.E,void 0===x.e?Object:x.e,void 0===R.M?Object:R.M])],k);var L=a(88661);class M{execute(){return this.confidentialScimStore.state$.pipe((0,S.w)((async e=>e?(0,f.Vp)(e):this.getInitState())))}async getInitState(){try{const e=await this.scimConfigurationService.getConfidentialScimConfig();return await this.scimStore.set(e),(0,f.Vp)(e)}catch(e){return(0,f.Vp)({active:!1,token:null})}}constructor(e,t,a){this.confidentialScimStore=e,this.scimConfigurationService=t,this.scimStore=a}}M=(0,s.__decorate)([(0,C.e)(L.I),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===b?Object:b,void 0===h?Object:h])],M);class j{}j=(0,s.__decorate)([(0,r.Yl)({api:o.m,imports:[n.D,N.D,i.G],handlers:{commands:{updateScimConfiguration:D,generateScimToken:k},events:{},queries:{scimConfiguration:M,scimEndpoint:A}},stores:[h],providers:[b]})],j)},36355:(e,t,a)=>{a.d(t,{D:()=>Pe});var s=a(491),r=a(86006),n=a(75421),i=a(5206),o=a(19961),c=a(43991),d=a(92587),l=a(95450),u=a(48083);const p="_dashlane-challenge";class m{async reset(){await this.store.init({global:{adminProvisioningKey:null,teamUuid:null,ssoIsNitroProvider:null,isTeamProvisionedInNitro:null,inferredSsoState:l.s5.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}})}set(e){return this.store.set(e)}constructor(e){this.store=e}}m=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===u.M?Object:u.M])],m);var h=a(13800);class g extends h.f{}g=(0,s.__decorate)([(0,d.GS)()],g);var v=a(82874),y=a(87279),f=a(49574),_=a(14122),b=a(76500);class S{}class w{async execute(e){const t=e.body.userEmailAddress,a=t.slice(t.indexOf("@")+1),s=await this.enclaveApiClient.authentication.requestLogin({login:t});if((0,y.hx)(s))return s;const{idpAuthorizeUrl:r,teamUuid:n}=(0,y.db)(s),{samlToken:i}=await this.enclaveLoginContext.getSamlFromLogin(r,!0,e.body.tabFocus),o=await this.enclaveApiClient.authentication.confirmLogin({domainName:a,samlResponse:i,teamUuid:n});if((0,y.hx)(o))return o;const c={...(0,y.db)(o),login:e.body.userEmailAddress};return await this.enclaveLoginContext.redirectUserIntoLoginFlow(c),(0,y.Vp)(void 0)}constructor(e,t,a){this.enclaveApiClient=e,this.enclaveLoginContext=t,this.carbonLegacyClient=a}}w=(0,s.__decorate)([(0,v.W)(f.B),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===S?Object:S,void 0===_._?Object:_._])],w);var E=a(43651),C=a(54602),T=a(13134),I=a(7165);const A=I.z.object({error:I.z.string()}),N=I.z.object({data:I.z.object({samlIdpEntryPoint:I.z.string(),samlIdpCertificate:I.z.string()})}),U=async(e,t)=>{if(null===t)return{samlIdpEntryPoint:"",samlIdpCertificate:""};let a="";if(new T.Y(t).isUrlValid()){const e=await fetch(t);a=await e.text()}else a=t;const{parseMetadataFields:s}=e.commands,r=await s({ssoIdpMetadata:a});if((0,y.d6)(r))return N.parse(r.data).data;throw new Error("failed to parse metadata, please validate first.")};class F{async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,y.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,y.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,y.Rn)({tag:"DomainNameNotProvided"});const a=t.idpMetadata.metadataValue?await U(this.carbonLegacyClient,t.idpMetadata.metadataValue):null,s=await this.enclaveApiClient.domains.createDomain({domainName:e.domainName,adminProvisioningKey:t.global.adminProvisioningKey,idpMetadata:a?{certificate:a.samlIdpCertificate,entrypoint:a.samlIdpEntryPoint}:void 0,teamUuid:t.global.teamUuid});if((0,y.hx)(s))return s;const{dnsVerificationToken:r}=(0,y.db)(s),n=[...t.domainSetup,{idpUuid:t.idpMetadata.idpUuid,domainName:e.domainName,verificationStatus:l.X5.enum.pending}],i={...t.domainVerificationInfo,[e.domainName]:{txtValue:r,verificationStatus:l.X5.enum.pending,subdomainValue:p,pendingReason:null,tokenFound:null}};return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:n,domainVerificationInfo:{...t.domainVerificationInfo,...i}}),(0,y.Vp)(void 0)}constructor(e,t,a,s,r){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=a,this.featureFlipsClient=s,this.carbonLegacyClient=r}}F=(0,s.__decorate)([(0,v.W)(C.p),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===E.P?Object:E.P,void 0===_._?Object:_._])],F);var D=a(42308),O=a(60399),P=a(48844);const x=I.z.object({adminProvisioningKey:I.z.object({adminProvisioningKey:I.z.ostring().nullable(),itemId:I.z.ostring().nullable()}).optional().nullable()}),R=(e,t)=>{const a=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,P.nb)({success:e=>{const t=x.safeParse(e);if(!t.success)throw t.error;return t.data.adminProvisioningKey?.adminProvisioningKey??null},failure:()=>""}));return(0,O.z)(a)};var k=a(31108),L=a(25917);class M{async execute(){const{global:e}=await this.ssoProvisioningStore.getState();if(!e.adminProvisioningKey){const e=await this.teamEnclaveClient.commands.createTeamInEnclave();if((0,y.hx)(e))return(0,y.Rn)({tag:"CreateTeamApiError"})}if(!e.ssoIsNitroProvider)try{await this.setupSsoConfidentialTeam()}catch{return(0,y.Rn)({tag:"CreateTeamApiError"})}return(0,y.Vp)(void 0)}async setupSsoConfidentialTeam(){const e=await this.ssoProvisioningStore.getState();await this.carbonClient.commands.updateTeamSettings({ssoServiceProviderUrl:this.ssoServiceProviderUrl});const t=await(0,O.z)(this.teamPlanDetailsClient.queries.getTeamId());if((0,y.hx)(t))throw new Error("Failed to get teamId");const{teamId:a}=(0,y.db)(t);if(!a)throw new Error("Failed to get teamId");const s=await R(a,this.carbonClient.queries.carbonState);await this.ssoProvisioningStoreUpdater.set({...e,global:{...e.global,adminProvisioningKey:s,ssoIsNitroProvider:!0,isTeamProvisionedInNitro:!0,inferredSsoState:l.s5.enum.NitroIncomplete}})}constructor(e,t,a,s,r,n){this.enclaveApiClient=e,this.teamEnclaveClient=t,this.ssoProvisioningStoreUpdater=a,this.ssoProvisioningStore=s,this.carbonClient=r,this.teamPlanDetailsClient=n,this.ssoServiceProviderUrl=new URL(this.enclaveApiClient.enclaveUrl).origin}}M=(0,s.__decorate)([(0,v.W)(D.p),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===L.G?Object:L.G,void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===_._?Object:_._,void 0===k.e?Object:k.e])],M);var j=a(28489),z=a(21454),V=a(54591);const B=I.z.object({data:I.z.object({deviceAccessKey:I.z.string(),deviceSecretKey:I.z.string()})}),K=I.z.object({data:I.z.object({devicePrivateKey:I.z.string(),devicePublicKey:I.z.string()})}),G=I.z.enum(["sso_connector","encryption_service","nitro_encryption_service","command_line"]),q=[G.enum.encryption_service,G.enum.nitro_encryption_service,G.enum.sso_connector],$=I.z.object({platform:G,accessKey:I.z.string(),deviceName:I.z.string().nullable(),activated:I.z.boolean(),creationDateUnix:I.z.number(),updateDateUnix:I.z.number()}),Q=I.z.object({data:I.z.object({teamDevices:I.z.array($)})}),H=async e=>{const{listTeamDevices:t}=e.commands,a=await t();if((0,y.hx)(a))throw new Error("Failed to get team devices");const{data:{teamDevices:s}}=Q.parse(a.data),r=s.filter((e=>q.includes(e.platform)&&e.activated)),n=e=>e.reduce(((e,t)=>!e||t.updateDateUnix>e.updateDateUnix?t:e),null),i=r.filter((e=>e.platform===G.enum.nitro_encryption_service)),o=r.filter((e=>e.platform===G.enum.encryption_service)),c=r.filter((e=>e.platform===G.enum.sso_connector));return o.length?n(o):c.length?n(c):n(i)};class W{async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),a=t.global.teamUuid;if(!a)throw new Error("SSO Migration failed: TeamUuid is missing");if(t.global.inferredSsoState===l.s5.enum.SsoConnectorComplete){if(!e.ssoConnectorKey)return(0,y.Rn)((0,z.hw)());if(!new RegExp("^[0-9a-f]{8}[-]([0-9a-f]{4}[-]){3}[0-9a-f]{12}\\|[0-9a-zA-Z/+]{86}==$").test(e.ssoConnectorKey))return(0,y.Rn)((0,z.Fw)())}const s=e.ssoConnectorKey||await this.getSsoConnectorKey(),r=await this.getTeamDomains(),{samlIdpCertificate:n,ssoIdpEntrypoint:i}=await this.getIdpData(),o=await this.getTeamDeviceToMigrate(),c=await this.getScimToken(o.accessKey),d=await(async e=>{const t=await e.commands.registerTeamDevice({platform:V.h.NITRO,deviceName:"Nitro Encryption Service"});if((0,y.hx)(t))return t;const{data:{deviceAccessKey:a,deviceSecretKey:s}}=B.parse((0,y.db)(t)),r=await e.commands.registerTeamDeviceAccount({deviceAccessKey:a,shouldGenerateDeviceKeyPair:!0});if((0,y.hx)(r))return r;const{data:{devicePrivateKey:n,devicePublicKey:i}}=K.parse((0,y.db)(r));return(0,y.Vp)({deviceAccessKey:a,deviceSecretKey:s,devicePrivateKey:n,devicePublicKey:i})})(this.carbonClient);if((0,y.hx)(d))throw new Error("SSO Migration failed: Unable to register team device with account with error");const{deviceAccessKey:u,deviceSecretKey:p,devicePublicKey:m,devicePrivateKey:h}=(0,y.db)(d),{adminProvisioningKey:g,team:v}=await this.createTeamForMigration({teamDeviceCredentials:{teamUuid:a,accessKey:u,secretKey:p,sharingPublicKey:m,sharingPrivateKey:h},masterServiceProviderKey:s,domains:r,certificates:[n],entrypoint:i,scimToken:c});return await this.runSideEffects({currentState:t,adminProvisioningKey:g,teamDeviceToMigrate:o,team:v}),(0,y.Vp)(void 0)}async getTeamDomains(){const e=await this.carbonClient.commands.getTeamDomains();if((0,y.hx)(e))throw new Error("SSO Migration failed: Unable to retrieve team domains");const t=(0,y.db)(e);if(!t.success)throw new Error("SSO Migration failed: Unable to retrieve team domains");return t.domains.map((e=>e.name))}async getIdpData(){const e=await(0,O.z)(this.teamPlanDetails.queries.getTeamSsoInfo());if((0,y.hx)(e))throw new Error("SSO Migration failed: Cannot retrieve any SSO information");const{ssoIdpEntrypoint:t,ssoIdpMetadata:a}=(0,y.db)(e);if(!t||!a)throw new Error("SSO Migration failed: Cannot retrieve Idp info. ssoIdpEntrypoint or ssoIdpMetadata is missing");const{samlIdpCertificate:s}=await U(this.carbonClient,a);return{samlIdpCertificate:s,ssoIdpEntrypoint:t}}async getSsoConnectorKey(){const e=await(0,O.z)(this.teamPlanDetails.queries.getTeamId());if((0,y.hx)(e))throw new Error("SSO Migration failed: Unable to retrieve team id");const t=(0,y.db)(e).teamId??"",a=await(0,O.z)(this.carbonClient.queries.carbonState({path:"userSession.teamAdminData.teams"}));if((0,y.hx)(a))throw new Error("SSO Migration failed: Unable to retrieve teamAdminData");const s=I.z.record(I.z.string(),I.z.object({ssoConnectorKey:I.z.object({ssoConnectorKey:I.z.string()})})),r=(0,y.db)(a),n=s.safeParse(r);if(!n.success)throw new Error("SSO Migration failed: Unable to retrieve ssoConnectorKey");return n.data[t].ssoConnectorKey.ssoConnectorKey}async getScimToken(e){const t=await this.carbonClient.commands.getTeamDeviceEncryptedConfig({draft:!1,deviceAccessKey:e});if((0,y.hx)(t))throw new Error("SSO Migration failed: Unable to retrieve scim token");const a=(0,y.db)(t);if(a.success)return a.data?.configProperties.scimAuthToken||void 0}async getTeamDeviceToMigrate(){const e=await H(this.carbonClient);if(!e)throw new Error("SSO Migration failed: no active team device found");return e}getDomainInfoFromTeam(e){return Object.entries(e.domains).reduce(((e,[t,a])=>(e.domainSetup.push({domainName:t,verificationStatus:a.dnsCheckStatus.status??"pending"}),e.domainVerificationInfo[t]={txtValue:a.dnsCheckStatus.verificationToken,verificationStatus:l.X5.parse(a.dnsCheckStatus.status),subdomainValue:p,pendingReason:a.dnsCheckStatus.pendingReason,tokenFound:null},e)),{domainSetup:(0,j.Ay)([]),domainVerificationInfo:(0,j.Ay)({})})}async runSideEffects({currentState:e,adminProvisioningKey:t,teamDeviceToMigrate:a,team:s}){await this.carbonClient.commands.persistAdminProvisioningKey({adminProvisioningKey:t}),await this.carbonClient.commands.updateTeamSettings({ssoServiceProviderUrl:this.ssoServiceProviderUrl});const{domainSetup:r,domainVerificationInfo:n}=this.getDomainInfoFromTeam(s),i=Object.entries(s.idps).map((([e])=>e))[0];await this.ssoProvisioningStoreUpdater.set({...e,global:{...e.global,adminProvisioningKey:t,ssoIsNitroProvider:!0,isTeamProvisionedInNitro:!0,inferredSsoState:l.s5.enum.NitroIncomplete},idpMetadata:{...e.idpMetadata,idpUuid:i},domainSetup:r,domainVerificationInfo:n}),await this.carbonClient.commands.deactivateTeamDevice({teamDeviceAccessKey:a.accessKey})}async createTeamForMigration(e){const t=await this.enclaveApiClient.teams.createTeamForMigration(e);if((0,y.hx)(t))throw new Error("SSO Migration to confidential failed: Unable to create team for migration");const{adminProvisioningKey:a,team:s}=(0,y.db)(t);return{adminProvisioningKey:a,team:s}}constructor(e,t,a,s,r){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=a,this.carbonClient=s,this.teamPlanDetails=r,this.ssoServiceProviderUrl=new URL(this.enclaveApiClient.enclaveUrl).origin}}W=(0,s.__decorate)([(0,v.W)(z.Dt),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===_._?Object:_._,void 0===k.e?Object:k.e])],W);var Y=a(99614);const X=["DOMAIN_NOT_FOUND","DOMAIN_CONFIGURATION_NOT_FOUND"];class Z{async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,y.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,y.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,y.Rn)({tag:"DomainNameNotProvided"});try{const a=await this.enclaveApiClient.domains.deleteDomain({domainName:e.domainName,teamUuid:t.global.teamUuid,adminProvisioningKey:t.global.adminProvisioningKey});if((0,y.hx)(a))return a}catch(e){const t=e instanceof Error?e.message:"Unable to delete domain.";if(!X.includes(t))throw e}return await this.applyDeleteDomainOnState(t,e.domainName),(0,y.Vp)(void 0)}async applyDeleteDomainOnState(e,t){e.domainSetup=e.domainSetup.filter((e=>e.domainName!==t)),delete e.domainVerificationInfo[t],await this.ssoProvisioningStoreUpdater.set(e)}constructor(e,t,a,s){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=a,this.featureFlipsClient=s}}Z=(0,s.__decorate)([(0,v.W)(Y.k),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===E.P?Object:E.P])],Z);var J=a(60590),ee=a(88187);class te{async execute(){const e=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:t,teamUuid:a},idpMetadata:{idpUuid:s}}=e;if(!t||!a||!s)return(0,y.Rn)({tag:"MissingCommandParameters"});try{const e=await this.enclaveApiClient.authentication.requestTestLogin({adminProvisioningKey:t,teamUuid:a,idpUuid:s});if((0,y.hx)(e))return e;const{idpAuthorizeUrl:r}=(0,y.db)(e),{samlToken:n}=await this.enclaveLoginContext.getSamlFromLogin(r,!1);return await this.enclaveApiClient.authentication.confirmTestLogin({teamUuid:a,adminProvisioningKey:t,idpUuid:s,samlResponse:n}),await this.enclaveLoginContext.cleanupTestLogin(),(0,y.Vp)(void 0)}catch{return(0,y.Rn)({tag:"FailedToLoginIntoSsoProvider"})}}constructor(e,t,a,s,r){this.enclaveApiClient=e,this.enclaveLoginContext=t,this.platformInfoService=a,this.ssoProvisioningStore=s,this.featureFlips=r}}te=(0,s.__decorate)([(0,v.W)(ee.b),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===S?Object:S,void 0===J.t?Object:J.t,void 0===u.M?Object:u.M,void 0===E.P?Object:E.P])],te);var ae=a(90318),se=a(55139),re=a(48187);var ne=a(89238);const ie=I.z.object({enabled:I.z.boolean()}).optional(),oe=I.z.object({teamInfo:I.z.object({uuid:I.z.ostring().nullable(),ssoEnabled:I.z.boolean(),ssoIsNitroProvider:I.z.boolean(),ssoServiceProviderUrl:I.z.ostring().nullable(),ssoIdpMetadata:I.z.ostring().nullable(),ssoIdpEntrypoint:I.z.ostring().nullable()}),capabilities:I.z.object({sso:ie})}),ce=I.z.object({data:oe}),de=I.z.object({message:I.z.string(),reason:I.z.nativeEnum(ne._V)}),le=async e=>{const{getTeamInfo:t}=e.commands,a=await t();if((0,y.hx)(a)){switch(de.parse(a.error).reason){case ne._V.UNAUTHORIZED:return(0,y.Rn)({tag:"UserNotAuthorized"});case ne._V.UNKNOWN_ERROR:return(0,y.Rn)({tag:"CouldNotGetTeamStatus"});default:throw new Error("An unexpected error happened while trying to retrieve team info")}}const{data:{teamInfo:s,capabilities:r}}=ce.parse(a.data);return(0,y.Vp)({teamInfo:s,capabilities:r})};var ue=a(87065);class pe{async execute({body:{teamId:e}}){if(!e)return(0,y.Rn)({tag:"TeamIdNotFound"});try{await this.ssoProvisioningStoreUpdater.reset();const a=await this.fetchInitialStateInfo(e);if((0,y.hx)(a))return a;const{teamStatus:s,teamInfo:r,provisioningKey:n,capabilities:i,currentTeamDevice:o}=a.data;if(!r.uuid)return(0,y.Rn)({tag:"TeamIdNotFound"});let c;try{c=((e,t,a,s)=>{if(!a)return l.s5.enum.None;if(s&&a.platform===G.enum.sso_connector)return l.s5.enum.SsoConnectorToSelfHostedMigration;if(!t&&a.platform===G.enum.nitro_encryption_service)return l.s5.enum.None;switch(a.platform){case G.enum.sso_connector:return e?l.s5.enum.SsoConnectorComplete:l.s5.enum.SsoConnectorIncomplete;case G.enum.encryption_service:return e?l.s5.enum.SelfHostedComplete:l.s5.enum.SelfHostedIncomplete;case G.enum.nitro_encryption_service:return e?l.s5.enum.NitroComplete:l.s5.enum.NitroIncomplete}throw new Error("Invalid SSO state reached")})(r.ssoEnabled,r.ssoIsNitroProvider,o,!!await this._shouldUseSSOMigration())}catch{return(0,y.Rn)({tag:"InvalidSsoState"})}const d=Object.keys(s.idps)[0]??null;return await this.ssoProvisioningStoreUpdater.set({global:{adminProvisioningKey:n??null,isTeamProvisionedInNitro:!!n,ssoIsNitroProvider:r.ssoIsNitroProvider,inferredSsoState:c,ssoCapable:i.sso,teamUuid:r.uuid},idpApplication:{acsUrl:(t=this.enclaveApiClient.enclaveUrl,t?`${new URL(t).origin}/saml/callback`:""),entityId:"dashlane-nitro-sso",signOnUrl:"https://app.dashlane.com"},idpMetadata:{idpUuid:d,metadataValue:r.ssoIdpMetadata??null,groupProvisioningActivated:d?s.idps[d].groupProvisioningActivated??null:null},domainSetup:this.getDomainSetupState(s.domains),domainVerificationInfo:this.getDomainVerificationInfo(s.domains),enableSSO:{ssoEnabled:r.ssoEnabled}}),(0,y.Vp)(void 0)}catch(e){return this.appLogger.error(e),(0,y.Rn)({tag:"GenericSsoError"})}var t}async fetchInitialStateInfo(e){const t=[R(e,this.carbonLegacyClient.queries.carbonState),le(this.carbonLegacyClient),H(this.carbonLegacyClient)],[a,s,r]=await Promise.all(t);if((0,y.hx)(s))return s;let n=this.makeGetTeamDecryptedResponse();const{teamInfo:i,capabilities:o}=s.data;a&&i.uuid&&(n=await this.performGetTeam(a,i.uuid));const c=this.extractCapabilities(o);return(0,y.Vp)({provisioningKey:a,teamInfo:i,teamStatus:n,capabilities:c,currentTeamDevice:r})}getDomainSetupState(e){return Object.entries(e).map((([e,t])=>({domainName:e,verificationStatus:t.dnsCheckStatus.status??"pending"})))}getDomainVerificationInfo(e){return Object.entries(e).reduce(((e,[t,a])=>(e[t]={txtValue:a.dnsCheckStatus.verificationToken,verificationStatus:l.X5.parse(a.dnsCheckStatus.status),subdomainValue:p,pendingReason:a.dnsCheckStatus.pendingReason,tokenFound:null},e)),{})}makeGetTeamDecryptedResponse(){return{domains:{},idps:{},updateDateUnix:0,messageIntegrations:{slackStatus:!1}}}fixTeamStatusDomains(e,t,a){const s=Object.values(e.idps);if(s.length<=1)return Promise.resolve(e);const r=s.sort(((e,t)=>e.updateDateUnix-t.updateDateUnix)).pop();return r?(Object.values(e.domains).reduce(((e,s)=>s.idpUuid!==r.idpUuid?e.then((()=>this.enclaveApiClient.domains.updateDomain({domainName:s.domainName,adminProvisioningKey:t,teamUuid:a,idpUuid:r.idpUuid}).then((()=>(s.idpUuid=r.idpUuid,Promise.resolve()))))):Promise.resolve()),Promise.resolve()),s.reduce(((e,s)=>r.idpUuid!==s.idpUuid?e.then((()=>this.enclaveApiClient.idps.deleteIdp({teamUuid:a,adminProvisioningKey:t,idpUuid:s.idpUuid}))).then((()=>Promise.resolve())):Promise.resolve()),Promise.resolve()),e.idps={[r.idpUuid]:r},Promise.resolve(e)):Promise.resolve(e)}async performGetTeam(e,t){const a=await(0,O.z)(this.teamEnclaveClient.queries.getTeamFromEnclave());if((0,y.hx)(a))throw new Error("InitSsoProvisioning: "+a.error);return await this.fixTeamStatusDomains(a.data,e,t)}extractCapabilities(e){return Object.entries(e).reduce(((e,[t,a])=>({...e,[t]:a.enabled})),{})}_shouldUseSSOMigration(){return this._getFeatureFlip(se.w.ItadminTacEncryptionserviceSSOmigrationReset)}_getFeatureFlip(e){const{userFeatureFlips:t}=this.featureFlipsClient.queries;return(0,O.z)(t().pipe((0,ue.U)((t=>{if((0,y.d6)(t)){return(0,y.db)(t)[e]}}))))}constructor(e,t,a,s,r,n){this.enclaveApiClient=e,this.teamEnclaveClient=t,this.ssoProvisioningStoreUpdater=a,this.carbonLegacyClient=s,this.featureFlipsClient=r,this.appLogger=n}}pe=(0,s.__decorate)([(0,v.W)(re.S),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===L.G?Object:L.G,void 0===m?Object:m,void 0===_._?Object:_._,void 0===E.P?Object:E.P,void 0===ae.V?Object:ae.V])],pe);var me=a(75998);class he{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,a=await(async(e,t)=>{if(null===t)return;const a=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});return(0,y.d6)(a)?void 0:A.parse(a.error).error})(t,e.metadata);return a?(0,y.Rn)({tag:a}):(0,y.Vp)(void 0)}constructor(e){this.carbonLegacy=e}}he=(0,s.__decorate)([(0,v.W)(me.l),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_._?Object:_._])],he);var ge=a(37461),ve=a(51448);const ye=async(e,t)=>{const{updateTeamSettings:a}=e.commands;await a({...t})};class fe{async execute({body:e}){try{await this.setupConfidentialTeam()}catch{return(0,y.Rn)({tag:"setup_confidential_team_failed"})}const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:a,teamUuid:s}=t.global;if(!a||!s)return(0,y.Rn)({tag:"internal_error"});const{metadata:r}=e;let n="",i="";try{const e=await U(this.carbon,r);i=e.samlIdpEntryPoint,n=e.samlIdpCertificate}catch{return(0,y.Rn)({tag:"invalid_metadata_content"})}try{const e=t.idpMetadata.idpUuid,o={adminProvisioningKey:a,teamUuid:s,idpMetadata:{certificates:[n],entrypoint:i}},c=e?await this.enclaveApiClient.idps.updateIdp({...o,idpMetadata:{...o.idpMetadata,idpUuid:e}}):await this.enclaveApiClient.idps.createIdp(o);if((0,y.hx)(c))return c;const{idpUuid:d}=(0,y.db)(c);await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,idpUuid:d,metadataValue:r}});try{await ye(this.carbon,{ssoIdpMetadata:r,ssoIdpEntrypoint:i})}catch(e){return(0,y.Rn)({tag:"save_metadata_failed"})}}catch(e){return(0,y.Rn)({tag:"domain_update_failed"})}return(0,y.Vp)(void 0)}async setupConfidentialTeam(){const{global:e}=await this.ssoProvisioningStore.getState(),{ssoIsNitroProvider:t,adminProvisioningKey:a}=e;return a&&t||await this.ssoClient.commands.createTeam(),(0,y.Vp)(void 0)}constructor(e,t,a,s,r,n){this.enclaveApiClient=e,this.platformInfoService=t,this.ssoProvisioningStoreUpdater=a,this.ssoProvisioningStore=s,this.carbon=r,this.ssoClient=n}}fe=(0,s.__decorate)([(0,v.W)(ge.o),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===J.t?Object:J.t,void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===_._?Object:_._,void 0===ve.E?Object:ve.E])],fe);var _e=a(80246);class be{async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:a},domainVerificationInfo:s,domainSetup:r}=t,n=e.body.domainName;if(!a)return(0,y.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!n)return(0,y.Rn)({tag:"DomainNameNotProvided"});let i;try{const e=await this.enclaveApiClient.domains.checkDnsValidation({domainName:n,adminProvisioningKey:a,teamUuid:t.global.teamUuid??""});if((0,y.hx)(e))return e;i=(0,y.db)(e)}catch{return(0,y.Rn)({tag:"CouldNotVerifyDns"})}const o=s[n];o.txtValue=i.verificationToken,o.verificationStatus=i.status,o.tokenFound=i.tokenFound??null,o.pendingReason=i.pendingReason;const c=r.map((e=>(e.domainName===n&&(e.verificationStatus=i.status),e)));return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:c,domainVerificationInfo:{...s,[n]:o}}),(0,y.Vp)(void 0)}constructor(e,t,a,s){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=a,this.featureFlips=s}}be=(0,s.__decorate)([(0,v.W)(_e.o),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===E.P?Object:E.P])],be);var Se=a(82062);class we{async execute(){const e=await this.ssoProvisioningStore.getState();if(e.enableSSO.ssoEnabled)return(0,y.Rn)({tag:"SsoAlreadyEnabled"});const{commands:{carbon:t}}=this.carbonLegacy,a=await(async(e,{ssoEnabled:t})=>{const a=await e({name:"updateTeamSettings",args:[{ssoEnabled:t}]});return!(0,y.hx)(a)})(t,{ssoEnabled:!0});return a?(await this.ssoProvisioningStore.set({...e,global:{...e.global,inferredSsoState:l.s5.enum.NitroComplete},enableSSO:{...e.enableSSO,ssoEnabled:!0}}),(0,y.Vp)(void 0)):(0,y.Rn)({tag:"EnableSsoFailed"})}constructor(e,t,a){this.ssoProvisioningStoreUpdater=e,this.ssoProvisioningStore=t,this.carbonLegacy=a}}we=(0,s.__decorate)([(0,v.W)(Se.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===_._?Object:_._])],we);var Ee=a(90435);class Ce{async execute({body:{teamId:e}}){const t=await this.ssoProvisioningStore.getState(),a=await R(e,this.carbon.queries.carbonState);let s=null;const r=await le(this.carbon);if((0,y.d6)(r)&&r.data.teamInfo.uuid&&(s=r.data.teamInfo.uuid),!s)return this.appLogger.error((0,y.Rn)({tag:"TeamIdNotFound"})),(0,y.Rn)({tag:"TeamIdNotFound"});if(!a)return this.appLogger.error((0,y.Rn)({tag:"NitroTeamNotProvisioned"})),(0,y.Rn)({tag:"NitroTeamNotProvisioned"});try{await this.deleteCurrentTeam({...t,global:{...t.global,adminProvisioningKey:a,teamUuid:s}})}catch(e){const{message:t}=e;if("TEAM_NOT_FOUND"!==t&&"UNKNOWN_ERROR"!==t&&"MISMATCHING_ADMIN_PROVISIONING_KEY"!==t)return this.appLogger.error((0,y.Rn)({tag:"CouldNotDeleteNitroTeam"})),(0,y.Rn)({tag:"CouldNotDeleteNitroTeam"})}const n=await this.removeAdmingProvisioningKey();if((0,y.hx)(n))return this.appLogger.error(n),n;const i=await this.clearLegacyTeamSettings();return(0,y.hx)(i)?(0,y.Rn)({tag:"CouldNotClearLegacyTeamSettings"}):(await this.ssoProvisioningStoreUpdater.reset(),this.eventEmitter.sendEvent("confidentialSsoSettingsReset",void 0),(0,y.Vp)(void 0))}async deleteCurrentTeam(e){const{global:t}=e;if(!t.adminProvisioningKey)return(0,y.Rn)({tag:"NitroTeamNotProvisioned"});const a={teamUuid:t.teamUuid,adminProvisioningKey:t.adminProvisioningKey};return await this.enclaveApiClient.teams.deleteTeam(a),(0,y.Vp)(void 0)}async clearLegacyTeamSettings(){try{await ye(this.carbon,{ssoServiceProviderUrl:null,ssoIdpMetadata:null,ssoIdpEntrypoint:null,ssoEnabled:!1})}catch{return(0,y.Rn)({tag:"CouldNotClearLegacyTeamSettings"})}return(0,y.Vp)(void 0)}async removeAdmingProvisioningKey(){try{const{removeAdminProvisioningKey:e}=this.carbon.commands;await e()}catch{return(0,y.Rn)({tag:"CouldNotDeleteAdminProvisioningKey"})}return(0,y.Vp)(void 0)}constructor(e,t,a,s,r,n){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=a,this.appLogger=s,this.carbon=r,this.eventEmitter=n}}Ce=(0,s.__decorate)([(0,v.W)(Ee.h),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===m?Object:m,void 0===u.M?Object:u.M,void 0===ae.V?Object:ae.V,void 0===_._?Object:_._,void 0===g?Object:g])],Ce);var Te=a(56346);I.z.object({});class Ie{async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:a,teamUuid:s}=t.global,{idpUuid:r}=t.idpMetadata;if(!a||!s)return(0,y.Rn)((0,Te.Y3)());if(!r)return Promise.reject((0,y.Rn)((0,Te.B3)()));const{groupProvisioningActivated:n}=e;try{await this.enclaveApiClient.idps.updateIdp({adminProvisioningKey:a,teamUuid:s,idpMetadata:{idpUuid:r,groupProvisioningActivated:n}}),await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,groupProvisioningActivated:n}})}catch(e){switch(e.message){case Te.hJ.MISMATCHING_ADMIN_PROVISIONING_KEY:return Promise.reject((0,y.Rn)((0,Te.HC)()));case Te.hJ.TEAM_NOT_FOUND:return Promise.reject((0,y.Rn)((0,Te.gY)()));case Te.hJ.IDP_NOT_FOUND:return Promise.reject((0,y.Rn)((0,Te.B3)()));case Te.hJ.NO_IDP_CONFIGURATION_UPDATE:return Promise.reject((0,y.Rn)((0,Te.b2)()));default:return Promise.reject((0,y.Rn)((0,Te.Y3)()))}}return(0,y.Vp)(void 0)}constructor(e,t,a){this.enclaveApiClient=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=a}}Ie=(0,s.__decorate)([(0,v.W)(Te.Z5),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===m?Object:m,void 0===u.M?Object:u.M])],Ie);var Ae=a(46449),Ne=a(26468),Ue=a(63874);class Fe{execute(){return this.ssoProvisioningStore.state$.pipe((0,ue.U)((e=>(0,y.Vp)(e))))}constructor(e,t){this.httpClient=e,this.ssoProvisioningStore=t}}Fe=(0,s.__decorate)([(0,Ae.e)(Ue._),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ne.e?Object:Ne.e,void 0===u.M?Object:u.M])],Fe);var De=a(18306);class Oe{execute(){return this.ssoProvisioningStore.state$.pipe((0,ue.U)((e=>(0,y.Vp)({groupProvisioningActivated:e.idpMetadata.groupProvisioningActivated??!1}))))}constructor(e){this.ssoProvisioningStore=e}}Oe=(0,s.__decorate)([(0,Ae.e)(De.$),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===u.M?Object:u.M])],Oe);class Pe{}Pe=(0,s.__decorate)([(0,r.Yl)({api:c.y,handlers:{commands:{loginUserWithEnclaveSSO:w,provisionDomain:F,createTeam:M,migrateToConfidentialSso:W,deleteDomain:Z,testLoginUserWithEnclaveSSO:te,initSsoProvisioning:pe,validateMetadata:he,updateMetadata:fe,checkDNSValidation:be,enableSso:we,clearSettings:Ce,updateGroupProvisioningConfiguration:Ie},events:{},queries:{ssoProvisioning:Fe,getGroupProvisioningConfiguration:Oe}},configurations:{enclaveLoginContextInfrastructure:{token:S}},imports:[n.X,i.i,o.G],exports:[u.M],stores:[u.M],providers:[m,g],requiredFeatureFlips:["itadmin_tac_encryptionservice_SSOmigration_reset","setup_rollout_reset_confidential_button","setup_rollout_web_ssoconnector_card","setup_rollout_confidential_migration"]})],Pe)},48083:(e,t,a)=>{a.d(t,{M:()=>d});var s=a(62149),r=a(95450),n=a(63144),i=a(56618);const o=e=>r.JU.safeParse(e).success,c={global:{adminProvisioningKey:null,teamUuid:null,ssoIsNitroProvider:null,isTeamProvisionedInNitro:null,inferredSsoState:r.s5.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};class d extends((0,n.Q)({persist:!1,capacity:i.Y._010KB,initialValue:c,scope:s.F.User,storeName:"nitro-sso-provisioning-state",storeTypeGuard:o})){}},78857:(e,t,a)=>{a.d(t,{X:()=>g});var s=a(7165),r=a(56773),n=a(70101),i=a(21597),o=a(96344),c=a(87163),d=a(71751),l=a(96754),u=a(42700),p=a(99743),m=a(36610);const h=s.z.object({type:s.z.string(),saml:s.z.string()});class g{checkMessageType(e){return!this.samlReceived&&"SamlAssertionIntercepted"===e.type}interceptSamlFromTab(){return new Promise(((e,t)=>{if(!this.onMessageListener)return t(new Error("OnMessage event listener is not available in current context"));const a=n.$.addListener((e=>{e===this.interceptedTabId&&(n.$.removeListener(a),t(new Error("Intercepting SAML - tab closed unexpectedly")))}));this.onMessageListener.events$.pipe((0,r.P)()).subscribe((([s])=>{const r=h.safeParse(s);r.success?(this.samlReceived=!0,n.$.removeListener(a),e({samlToken:r.data.saml})):t(new Error("Intercepting SAML - received message could not be parsed"))}))}))}async redirectTabToUrl(e){if(this.interceptedTabId)return await(0,i.V)(this.interceptedTabId,{url:e});{const t=(await(0,o.T)({windowTypes:["normal"]})).id;return await(0,c.U)({windowId:t,url:e})}}async getActiveExtensionTabId(){const e=await(0,d.I)({currentWindow:!0,active:!0}),t=e.length>0?e[0]:null,a=(0,l.A)("");if(t?.id&&t.url?.includes(a))return t.id}async getSamlFromLogin(e,t,a){this.samlReceived=!1,this.originalTabId=void 0,this.interceptedTabId&&(await(0,u.O)([this.interceptedTabId]).catch((()=>{})),this.interceptedTabId=void 0);const s=async(t=!0)=>{const a=await(0,c.U)({url:e,active:t});return this.interceptedTabId=a.id,await this.interceptSamlFromTab()},r=async t=>{this.interceptedTabId=t;const a=this.interceptSamlFromTab();return await(0,i.V)(t,{url:e}),a};return t?this.getActiveExtensionTabId().then((e=>e?r(e):s(a))):this.getActiveExtensionTabId().then((e=>(this.originalTabId=e,s(a))))}async redirectUserIntoLoginFlow(e){const t={ssoToken:e.ssoToken,exists:e.exists,currentAuths:e.currentAuthenticationMethods,expectedAuths:e.expectedAuthenticationMethods,key:e.userServiceProviderKey,login:e.login},a=Object.entries(t).map((e=>`${e[0]}=${encodeURIComponent(e[1].toString())}`)).join("&"),s=(0,l.A)(`index.html#/sso?${a}`);await this.redirectTabToUrl(s)}async redirectUserToLoginPage(){const e=(0,l.A)("index.html#/login");await this.redirectTabToUrl(e)}async cleanupTestLogin(){this.interceptedTabId&&await(0,u.O)([this.interceptedTabId]).catch((()=>{})),this.originalTabId&&(0,i.V)(this.originalTabId,{active:!0})}constructor(){this.interceptedTabId=void 0,this.originalTabId=void 0,this.samlReceived=!1;try{this.onMessageListener=new m.j(p.p,this.checkMessageType.bind(this))}catch{}}}},4174:(e,t,a)=>{a.d(t,{Q:()=>n});var s=a(8260),r=a(98768);class n extends((0,s.E)(r.r)){}(0,s.K)(r.r,n)},98768:(e,t,a)=>{a.d(t,{r:()=>i});var s=a(75958),r=a(16541),n=a(74430);const i=(0,s.Q)({name:"sync",commands:{SyncCommand:r.t},queries:{SyncProgressQuery:n.F},events:{}})},16541:(e,t,a)=>{a.d(t,{t:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.Device})){}},74430:(e,t,a)=>{a.d(t,{F:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.Device})){}},90993:(e,t,a)=>{var s;a.d(t,{L:()=>s,_:()=>r}),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(s||(s={}));class r{}},90904:(e,t,a)=>{a.d(t,{R:()=>I});var s=a(491),r=a(86006),n=a(62149),i=a(98768),o=a(90993),c=a(41842),d=a(60399),l=a(92587),u=a(14122),p=a(87279),m=a(48844);const h=e=>"object"==typeof e&&null!==e&&"status"in e&&Object.values(o.L).includes(e.status);var g=a(96168);class v extends((0,g.Hu)("SyncError","An error occoured while trying to sync the vault")){}class y{async attemptSync(e){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"sessionForceSync",arg:[{trigger:e}]})}async waitForSync(e){const t=this.getSyncState().pipe((0,c.h)((e=>!(!(0,p.d6)(e)||!h(e.data))&&[o.L.FAILURE,o.L.SUCCESS].includes(e.data.status))),(0,m.DZ)((()=>new v)),(0,m.lk)((e=>e.status===o.L.FAILURE?(0,p.Rn)({tag:"Sync failed"}):(0,p.Vp)(void 0))));return await this.attemptSync(e),(0,d.z)(t)}getSyncState(){return this.carbonLegacy.queries.carbonState({path:"userSession.sync"}).pipe((0,m.Qn)((e=>{if(!h(e))throw new Error("Bad sync state format");return{status:e.status}})))}constructor(e){this.carbonLegacy=e}}y=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===u._?Object:u._])],y);var f=a(50756);class _{async run(){return await this.syncService.attemptSync(f.Trigger.Periodic),Promise.resolve()}constructor(e){this.syncService=e}}_=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o._?Object:o._])],_);var b=a(82874),S=a(16541);class w{execute(e){const{trigger:t}=e.body;return this.syncService.attemptSync(t),Promise.resolve((0,p.Vp)(void 0))}constructor(e){this.syncService=e}}w=(0,s.__decorate)([(0,b.W)(S.t),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o._?Object:o._])],w);var E=a(46449),C=a(74430);class T{execute(){return this.syncService.getSyncState()}constructor(e){this.syncService=e}}T=(0,s.__decorate)([(0,E.e)(C.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o._?Object:o._])],T);class I{}I=(0,s.__decorate)([(0,r.Yl)({api:i.r,handlers:{commands:{sync:w},events:{},queries:{syncProgress:T}},crons:[{handler:_,periodInMinutes:5,name:"periodic-sync-cron",scope:n.F.User}],providers:[{provide:o._,useClass:y}],exports:[o._]})],I)},58605:(e,t,a)=>{a.d(t,{$:()=>r});var s=a(96168);class r extends((0,s.Hu)("UserIsNotAdmin","User is not an admin")){}},11512:(e,t,a)=>{a.d(t,{t:()=>o});var s=a(75958),r=a(85187),n=a(71379),i=a(43613);const o=(0,s.Q)({name:"inviteLink",commands:{toggleInviteLink:r.s,requestUserInviteTokenSending:n.T},events:{},queries:{inviteLinkData:i.$}})},71379:(e,t,a)=>{a.d(t,{T:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},85187:(e,t,a)=>{a.d(t,{s:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},43613:(e,t,a)=>{a.d(t,{$:()=>i,D:()=>s});var s,r=a(77535),n=a(62149);!function(e){e.NOT_LOADED="not_loaded",e.NOT_CREATED="not_created",e.READY="ready"}(s||(s={}));class i extends((0,r.k)({scope:n.F.User})){}},58164:(e,t,a)=>{a.d(t,{t:()=>N});var s=a(75958),r=a(96209),n=a(36486),i=a(31521),o=a(93595),c=a(23578),d=a(14485),l=a(61358),u=a(81940),p=a(4093),m=a(69877),h=a(56859),g=a(56276),v=a(59875),y=a(95681),f=a(92179),_=a(7310),b=a(91206),S=a(66385),w=a(16883),E=a(75178),C=a(74629),T=a(31432),I=a(75008),A=a(97786);const N=(0,s.Q)({name:"teamAdminNotifications",commands:{markActivityLogsInfoboxSeen:r.o,markB2BPlanDiscontinuedSeen:n.q,markCRDRisksFoundInfoboxSeen:i.e,markIdPFailedNotificationSeen:o.b,markIdPNeedsSeatsInfoboxSeen:c.k,markIdPNeedsSeatsInfoboxInPopupSeen:d.N,markIdPProvisioningsPendingInfoboxSeen:l.r,markNewRestrictSharingPolicySeen:u.o,markNotificationTrialExtendedSeen:p.D,markOfferToExtendFreeTrialSeen:m.R,markStarterRepackagePolicyInfoboxSeen:h.z},events:{},queries:{getIdPFailedProvisioningsData:g.It,getIdPFixedProvisioningsData:v.Un,hasSeenActivityLogsInfobox:y.g,hasSeenB2BPlanDiscontinued:f.z,hasSeenCRDRisksFoundInfobox:_.e,hasSeenIdPFailedNotification:b.g,hasSeenIdPNeedsSeatsInfoboxInPopup:S.k,hasSeenIdPNeedsSeatsInfobox:w.T,hasSeenIdPProvisioningsPendingInfobox:E.S,hasSeenNewRestrictSharingPolicy:C.x,hasSeenNotificationTrialExtended:T.q,hasSeenOfferToExtendFreeTrial:I.U,HasSeenStarterRepackagePolicyInfobox:A.i}})},96209:(e,t,a)=>{a.d(t,{o:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},36486:(e,t,a)=>{a.d(t,{q:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},31521:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},93595:(e,t,a)=>{a.d(t,{b:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},14485:(e,t,a)=>{a.d(t,{N:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},23578:(e,t,a)=>{a.d(t,{k:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},61358:(e,t,a)=>{a.d(t,{r:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},81940:(e,t,a)=>{a.d(t,{o:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},4093:(e,t,a)=>{a.d(t,{D:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},69877:(e,t,a)=>{a.d(t,{R:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},56859:(e,t,a)=>{a.d(t,{z:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},56276:(e,t,a)=>{a.d(t,{C$:()=>s,It:()=>c,qj:()=>o});var s,r=a(77535),n=a(62149),i=a(96168);!function(e){e.NOT_ADMIN="not_admin",e.SERVER_ERROR="server_error"}(s||(s={}));const o=(0,i.Vj)("not_admin","User is not an admin");(0,i.Vj)("server_error","Server error while retrieving IdP Notifications data");class c extends((0,r.k)({scope:n.F.User})){}},59875:(e,t,a)=>{a.d(t,{Go:()=>o,Un:()=>c});var s,r=a(77535),n=a(62149),i=a(96168);!function(e){e.NOT_ADMIN="not_admin",e.SERVER_ERROR="server_error"}(s||(s={}));const o=(0,i.Vj)("not_admin","User is not an admin");(0,i.Vj)("server_error","Server error while retrieving IdP Notifications data");class c extends((0,r.k)({scope:n.F.User})){}},95681:(e,t,a)=>{a.d(t,{g:()=>r});var s=a(77535);class r extends((0,s.k)()){}},92179:(e,t,a)=>{a.d(t,{z:()=>r});var s=a(77535);class r extends((0,s.k)()){}},7310:(e,t,a)=>{a.d(t,{e:()=>r});var s=a(77535);class r extends((0,s.k)()){}},91206:(e,t,a)=>{a.d(t,{g:()=>r});var s=a(77535);class r extends((0,s.k)()){}},66385:(e,t,a)=>{a.d(t,{k:()=>r});var s=a(77535);class r extends((0,s.k)()){}},16883:(e,t,a)=>{a.d(t,{T:()=>r});var s=a(77535);class r extends((0,s.k)()){}},75178:(e,t,a)=>{a.d(t,{S:()=>r});var s=a(77535);class r extends((0,s.k)()){}},74629:(e,t,a)=>{a.d(t,{x:()=>r});var s=a(77535);class r extends((0,s.k)()){}},31432:(e,t,a)=>{a.d(t,{q:()=>r});var s=a(77535);class r extends((0,s.k)()){}},75008:(e,t,a)=>{a.d(t,{U:()=>r});var s=a(77535);class r extends((0,s.k)()){}},97786:(e,t,a)=>{a.d(t,{i:()=>r});var s=a(77535);class r extends((0,s.k)()){}},72788:(e,t,a)=>{a.d(t,{L:()=>u});var s=a(75958),r=a(16396),n=a(37043),i=a(67267),o=a(35468),c=a(73895),d=a(22099),l=a(59509);const u=(0,s.Q)({name:"teamMembers",commands:{proposeMembers:r.og,dismissNonMembersInfobox:n.Y},events:{membersAdded:i.q},queries:{getNonMembersCount:o.H,getNonMembersList:c.Fz,getHasAdminDismissedInfobox:d.K,getMembersList:l.k}})},37043:(e,t,a)=>{a.d(t,{Y:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},16396:(e,t,a)=>{a.d(t,{Wv:()=>h,og:()=>g});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.InvalidOrigin="InvalidOrigin",e.NoFreeSlot="NoFreeSlot",e.NoFreeSlotFreePlan="NoFreeSlotFreePlan",e.UserTeamInviteTokenNotFound="UserTeamInviteTokenNotFound",e.PaymentFailed="PaymentFailed",e.NotBillingAdmin="NotBillingAdmin",e.CannotAddSeatDuringGracePeriod="CannotAddSeatDuringGracePeriod"}(s||(s={}));class o extends((0,i.Hu)("InvalidOrigin","Invalid origin")){}class c extends((0,i.Hu)("NoFreeSlot","No free slot")){}class d extends((0,i.Hu)("NoFreeSlotFreePlan","No free slot in free plan")){}class l extends((0,i.Hu)("UserTeamInviteTokenNotFound","No invite token to a team available for user")){}class u extends((0,i.Hu)("PaymentFailed","Payment failed")){}class p extends((0,i.Hu)("NotBillingAdmin","User is not the billing admin")){}class m extends((0,i.Hu)("CannotAddSeatDuringGracePeriod","Seats cannot be added during grace period")){}function h(e){switch(e){case"invalid_origin":return new o;case"no_free_slot":return new c;case"no_free_slot_free_plan":return new d;case"USER_TEAM_INVITE_TOKEN_NOT_FOUND":return new l;case"payment_failed":return new u;case"not_billing_admin":return new p;case"cannot_add_seat_during_grace_period":return new m;default:throw new Error("Unknown server error")}}class g extends((0,r.g)({scope:n.F.User})){}},67267:(e,t,a)=>{a.d(t,{q:()=>n});var s=a(446),r=a(62149);class n extends((0,s.d)({scope:r.F.User})){}},22099:(e,t,a)=>{a.d(t,{K:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},59509:(e,t,a)=>{a.d(t,{k:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},35468:(e,t,a)=>{a.d(t,{H:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},73895:(e,t,a)=>{a.d(t,{Fz:()=>c,R0:()=>i,RD:()=>o});var s=a(7165),r=a(77535),n=a(62149);const i=s.z.object({userId:s.z.number(),login:s.z.string(),premiumStatus:s.z.enum(["free","subscribed","legacy"]),lastActivityDateUnix:s.z.number(),proposedState:s.z.enum(["proposed","not_in_team","in_team","revoked"])}),o=s.z.array(i);class c extends((0,r.k)({scope:n.F.User})){}},35475:(e,t,a)=>{a.d(t,{B:()=>n});var s=a(75958),r=a(58089);const n=(0,s.Q)({name:"teamPasswordHealth",commands:{},events:{},queries:{getReport:r.z}})},58089:(e,t,a)=>{a.d(t,{z:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},48666:(e,t,a)=>{a.d(t,{o:()=>A});var s=a(75958),r=a(36833),n=a(30561),i=a(52966),o=a(45364),c=a(8025),d=a(3434),l=a(23099),u=a(29151),p=a(49649),m=a(31933),h=a(93478),g=a(47883),v=a(8365),y=a(14784),f=a(44096),_=a(22283),b=a(88273),S=a(51183),w=a(3463),E=a(20270),C=a(621),T=a(15640),I=a(10729);const A=(0,s.Q)({name:"teamPlanDetails",commands:{addSeats:r.E,extendFreeTrial:n.No,requestTeamPlanCancellation:i.y7,editTeamName:o.Q2,editTeamPolicies:c.m,sendFeedback:d.cr,updateBillingAdmin:l.t},events:{},queries:{getIndustryBenchmarkData:u.l,getTeamActiveDirectoryInfo:p.e,getTeamBillingInformation:m._,getTeamCancellationStatus:h.F,getTeamCapabilities:g.Y,getTeamCreationDateUnixQuery:v.T,getTeamDuoInfo:y.Z,getTeamId:f.e,getTeamName:_.j,getTeamRoles:b.R,getTeamPolicies:S.K,getTeamSeats:w.W,getTeamSecurityScore:E.R,getTeamSsoInfo:C.m,getTeamTrialStatus:T.P,isTeamCreator:I.G7}})},31108:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(8260),r=a(48666);class n extends((0,s.E)(r.o)){}(0,s.K)(r.o,n)},36833:(e,t,a)=>{a.d(t,{E:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},45364:(e,t,a)=>{a.d(t,{Kv:()=>l,Q2:()=>u,QI:()=>d,U8:()=>o,mX:()=>c});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.DUPLICATE="team_name_already_exists",e.INVALID_TEAM_SETTING_VALUE="INVALID_TEAM_SETTING_VALUE",e.NOT_ADMIN="not_admin",e.NOT_AUTHORIZED="not_authorized"}(s||(s={}));const o=(0,i.Vj)("team_name_already_exists","That team name already exists"),c=(0,i.Vj)("INVALID_TEAM_SETTING_VALUE","The team setting value is invalid"),d=(0,i.Vj)("not_admin","User is not admin"),l=(0,i.Vj)("not_authorized","User is not authorized to perform this action");class u extends((0,r.g)({scope:n.F.User})){}},8025:(e,t,a)=>{a.d(t,{m:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},30561:(e,t,a)=>{a.d(t,{AP:()=>c,No:()=>u,RQ:()=>d,gv:()=>o,lO:()=>l,sK:()=>s});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.NOT_IN_FREE_TRIAL="TEAM_NOT_FREE_TRIAL",e.IN_GRACE_PERIOD="TEAM_IN_GRACE_PERIOD",e.USER_NOT_ADMIN="not_admin"}(s||(s={}));const o=(0,i.Vj)("TEAM_NOT_FOUND","Team not found"),c=(0,i.Vj)("TEAM_NOT_FREE_TRIAL","Team is not in a free trial"),d=(0,i.Vj)("TEAM_IN_GRACE_PERIOD","User trial is already extended. User is in grace period"),l=(0,i.Vj)("not_admin","User is not admin");class u extends((0,r.g)({scope:n.F.User})){}},52966:(e,t,a)=>{a.d(t,{Rb:()=>d,VH:()=>o,fz:()=>c,y7:()=>l});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.IN_FREE_TRIAL="TEAM_IN_FREE_TRIAL",e.IS_DISCONTINUED="TEAM_IS_DISCONTINUED",e.USER_NOT_ADMIN="NOT_ADMIN"}(s||(s={}));const o=(0,i.Vj)("TEAM_IN_FREE_TRIAL","Team is in a free trial"),c=(0,i.Vj)("TEAM_IS_DISCONTINUED","Team is discontinued"),d=(0,i.Vj)("NOT_ADMIN","User is not admin");class l extends((0,r.g)({scope:n.F.User})){}},3434:(e,t,a)=>{a.d(t,{b6:()=>o,cr:()=>c});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.INVALID_FEEDBACK="INVALID_FEEDBACK"}(s||(s={}));const o=(0,i.Vj)("INVALID_FEEDBACK","The provided feedback is invalid and won't be shared");class c extends((0,r.g)({scope:n.F.User})){}},23099:(e,t,a)=>{a.d(t,{t:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},29151:(e,t,a)=>{a.d(t,{l:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},49649:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},31933:(e,t,a)=>{a.d(t,{_:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},93478:(e,t,a)=>{a.d(t,{F:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},47883:(e,t,a)=>{a.d(t,{Y:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},8365:(e,t,a)=>{a.d(t,{T:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},14784:(e,t,a)=>{a.d(t,{Z:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},44096:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},22283:(e,t,a)=>{a.d(t,{j:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},51183:(e,t,a)=>{a.d(t,{K:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},88273:(e,t,a)=>{a.d(t,{R:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},3463:(e,t,a)=>{a.d(t,{W:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},20270:(e,t,a)=>{a.d(t,{R:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},621:(e,t,a)=>{a.d(t,{m:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},15640:(e,t,a)=>{a.d(t,{P:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},10729:(e,t,a)=>{a.d(t,{G7:()=>c});var s,r=a(77535),n=a(62149),i=a(96168);!function(e){e.NOT_LOGGED="NOT_LOGGED",e.NOT_ADMIN="NOT_ADMIN"}(s||(s={}));const o=(0,i.Vj)("NOT_LOGGED","Please log the user");(0,i.Vj)("NOT_ADMIN","User is not an admin");class c extends((0,r.k)({scope:n.F.User,noUserError:o()})){}},45836:(e,t,a)=>{a.d(t,{F:()=>n,Gr:()=>c,Uz:()=>i,lD:()=>s,qo:()=>r,ym:()=>l,yt:()=>d});var s,r,n,i,o=a(7165);!function(e){e.Legacy="legacy",e.Starter="starter",e.Team="team",e.Business="business",e.Enterprise="entreprise",e.Standard="standard"}(s||(s={})),function(e){e.ProcessOut="processout",e.Invoice="invoice"}(r||(r={})),function(e){e.USD="usd",e.EUR="eur"}(n||(n={})),function(e){e.Pending="pending",e.Canceled="canceled",e.None="none",e.Unknown="unknown"}(i||(i={}));const c={ChoseOtherPasswordManager:"chose_other_password_manager",DownsizedEmployeeCount:"downsized_employee_count",MissingCriticalFeatures:"missing_critical_features",NoInternalUsage:"no_internal_usage",Other:"other",TechnicalIssues:"technical_issues",TooExpensive:"too_expensive"};var d;!function(e){e.InTeam="in_team",e.NotPremium="not_premium",e.NoPayment="no_payment",e.IsUnpaidFamilyMember="is_unpaid_family_member",e.DefaultSettings="default_settings",e.NoVPNCapability="no_vpn_capability",e.DisabledForFreeUser="disabled_for_free_user"}(d||(d={}));const l=o.z.object({allowPersistenceForMasterPassword:o.z.boolean(),allowSharing:o.z.boolean(),sharingRestrictedToTeam:o.z.boolean(),enforce2FA:o.z.boolean(),cryptoForcedPayload:o.z.string(),disableAutoLoginDomains:o.z.array(o.z.string()),enableForcedDomains:o.z.boolean(),enablePersonalSpace:o.z.boolean(),enableRemoveForcedContent:o.z.boolean(),enableVPN:o.z.boolean(),forceAutomaticLogout:o.z.number(),lockOnExit:o.z.boolean(),vaultExportEnabled:o.z.boolean(),collectSensitiveDataAuditLogsEnabled:o.z.boolean(),ssoEnabled:o.z.boolean(),ssoProvisioning:o.z.boolean(),teamDomain:o.z.array(o.z.string()),restrictSharingToTeam:o.z.boolean(),recoveryEnabled:o.z.boolean(),richIconsEnabled:o.z.boolean()})},27006:(e,t,a)=>{a.d(t,{K:()=>l});var s=a(75958),r=a(33549),n=a(66499),i=a(51060),o=a(54697),c=a(39127),d=a(70552);const l=(0,s.Q)({name:"teamPlanUpdate",commands:{changeTierMidcycle:r.G,computePlanPricingDetails:n.wf,upgradeTeamWithExistingCc:i.gi},events:{},queries:{getTeamOffers:o.g,getMidcycleTierUpgradePrice:c.X,getPlanPricingDetailsQuery:d.n}})},33549:(e,t,a)=>{a.d(t,{G:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},66499:(e,t,a)=>{a.d(t,{C9:()=>c,rm:()=>o,wf:()=>d});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.USER_IS_NOT_BILLING_ADMIN="not_billing_admin",e.NOT_ABLE_TO_ADD_SEATS_DURING_GRACE_PERIOD="cannot_add_seat_during_grace_period"}(s||(s={}));const o=(0,i.Vj)("not_billing_admin","User is not billing admin"),c=(0,i.Vj)("cannot_add_seat_during_grace_period","Cannot add seats during grace period");class d extends((0,r.g)({scope:n.F.User})){}},51060:(e,t,a)=>{a.d(t,{AI:()=>s,KW:()=>S,L7:()=>c,Ls:()=>E,NS:()=>p,QF:()=>_,T1:()=>w,ZP:()=>C,Zy:()=>o,_1:()=>h,aY:()=>f,d3:()=>m,fu:()=>g,g3:()=>l,gi:()=>T,hS:()=>y,hY:()=>d,jV:()=>v,oH:()=>u,rj:()=>b});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.STARTER_PLAN_NOT_10_SEATS="starter_plan_not_10_seats",e.USER_SUBSCRIBING_NOT_FOUND="user_subscribing_not_found",e.CANNOT_INVOICE_FREE_PLAN="cannot_invoice_free_plan",e.PAYMENT_ERROR_DURING_UPGRADE="payment_error_during_upgrade",e.SEATS_TO_PURCHASE_LOWER_ACTUAL_USAGE="seats_to_purchase_lower_actual_usage",e.NOT_IN_A_TEAM_PLAN="not_in_a_team_plan",e.NOT_TEAM_CAPTAIN="not_team_captain",e.NOT_IN_FREE_TRIAL="not_in_free_trial",e.INVALID_PLAN="invalid_plan",e.WRONG_AMOUNT_TO_PAY="wrong_amount_to_pay",e.SALES_TAX_MISMATCH="SALES_TAX_MISMATCH",e.B2B_PLAN_NOT_FOUND="b2b_plan_not_found",e.SELECTED_PLAN_IS_NOT_VALID="SELECTED_PLAN_IS_NOT_VALID",e.FORBIDDEN_EMAIL_DOMAIN="FORBIDDEN_EMAIL_DOMAIN",e.TEAM_HAS_SSO_ENABLED="TEAM_HAS_SSO_ENABLED",e.VAT_NUMBER_NOT_UPSERTED="VAT_NUMBER_NOT_UPSERTED",e.NO_KEY_FOR_USER="no_key_for_user",e.UNSUPPORTED_PAYMENT_MEAN="unsupported_payment_mean"}(s||(s={}));const o=(0,i.Vj)("starter_plan_not_10_seats","Starter Plan is 10 seats"),c=(0,i.Vj)("user_subscribing_not_found","User subscribing does not exist."),d=(0,i.Vj)("cannot_invoice_free_plan","Cannot invoice when Free plan."),l=(0,i.Vj)("payment_error_during_upgrade","Payment error during upgrade"),u=(0,i.Vj)("seats_to_purchase_lower_actual_usage","Seats to purchase is lower than actual team usage"),p=(0,i.Vj)("not_in_a_team_plan","Cannot upgrade, user is not in a team plan"),m=(0,i.Vj)("not_team_captain","The user is not a captain of this team"),h=(0,i.Vj)("not_in_free_trial","This team is not in free trial"),g=(0,i.Vj)("invalid_plan","Offer not allowed"),v=(0,i.Vj)("wrong_amount_to_pay","Amount displayed is too different than real actual price"),y=(0,i.Vj)("SALES_TAX_MISMATCH","Taxes displayed is too different than real actual price"),f=(0,i.Vj)("b2b_plan_not_found","The planId requested to upgrade is not found"),_=(0,i.Vj)("SELECTED_PLAN_IS_NOT_VALID","Selected plan is not valid"),b=(0,i.Vj)("FORBIDDEN_EMAIL_DOMAIN","This user has a forbidden email domain"),S=(0,i.Vj)("TEAM_HAS_SSO_ENABLED","Team needs to disable SSO before purchasing non-SSO offering plans"),w=(0,i.Vj)("VAT_NUMBER_NOT_UPSERTED","VAT number could not be upserted"),E=(0,i.Vj)("no_key_for_user","No key for user"),C=(0,i.Vj)("unsupported_payment_mean","The team is using an unsupported payment mean type.");class T extends((0,r.g)({scope:n.F.User})){}},39127:(e,t,a)=>{a.d(t,{X:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},70552:(e,t,a)=>{a.d(t,{n:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},54697:(e,t,a)=>{a.d(t,{g:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},50691:(e,t,a)=>{a.d(t,{a:()=>c});var s=a(75958),r=a(47969),n=a(38356),i=a(99706),o=a(23945);const c=(0,s.Q)({name:"teamVat",commands:{DeleteTeamVatCommand:r.Hy,UpsertTeamVatCommand:n.XW},events:{},queries:{getTeamVat:i.N7,getTaxAmount:o.B}})},47969:(e,t,a)=>{a.d(t,{Hy:()=>l,zK:()=>d});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class o extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class c extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"not_billing_admin":return new c;default:throw new Error("Unknown server error")}}class l extends((0,r.g)({scope:n.F.User})){}},38356:(e,t,a)=>{a.d(t,{XW:()=>u,q5:()=>l});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin",e.VatNumberNotUpserted="VatNumberNotUpserted"}(s||(s={}));class o extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class c extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}class d extends((0,i.Hu)("VatNumberNotUpserted","The VAT number couldn't be upserted")){}function l(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"not_billing_admin":return new c;case"VAT_NUMBER_NOT_UPSERTED":return new d;default:throw new Error("Unknown server error")}}class u extends((0,r.g)({scope:n.F.User})){}},23945:(e,t,a)=>{a.d(t,{A:()=>n,B:()=>i});var s=a(77535),r=a(96168);class n extends((0,r.Hu)("GetExpectedTaxInformationFailed","Could not return tax amount")){}class i extends((0,s.k)()){}},99706:(e,t,a)=>{a.d(t,{K$:()=>l,N7:()=>u});var s,r=a(77535),n=a(62149),i=a(96168);!function(e){e.TeamNotFound="TeamNotFound",e.VatNumberNotFound="VatNumberNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class o extends((0,i.Hu)("TeamNotFound","The given user is not part of a single team")){}class c extends((0,i.Hu)("VatNumberNotFound","The given Team does not have a VAT number")){}class d extends((0,i.Hu)("NotBillingAdmin","The user is not Billing Admin")){}function l(e){switch(e){case"TEAM_NOT_FOUND":return new o;case"VAT_NUMBER_NOT_FOUND":return new c;case"not_billing_admin":return new d;default:throw new Error("Unknown server error")}}class u extends((0,r.k)({scope:n.F.User})){}},69840:(e,t,a)=>{a.d(t,{_:()=>x});var s,r=a(491),n=a(86006),i=a(11512);!function(e){e.WebOnboardingInviteLinkTacMigration="web_onboarding_inviteLinkTacMigration"}(s||(s={}));var o=a(62149),c=a(63144),d=a(56618),l=a(43613);class u extends((0,c.Q)({persist:!1,scope:o.F.User,storeName:"invite-link-team-store",initialValue:{status:l.D.NOT_LOADED},capacity:d.Y._001KB})){}var p,m,h=a(25859),g=a(87065),v=a(46449),y=a(87279),f=a(60399),_=a(48844),b=a(18533),S=a(20195),w=a(92587),E=a(53344),C=a(7165);!function(e){e.TEAM_DOES_NOT_EXIST="TEAM_DOES_NOT_EXIST",e.USER_NOT_PROPOSED_IN_TEAM="USER_NOT_PROPOSED_IN_TEAM",e.USER_TEAM_INVITE_TOKEN_NOT_FOUND="USER_TEAM_INVITE_TOKEN_NOT_FOUND"}(p||(p={})),C.z.object({tag:C.z.nativeEnum(p)}),function(e){e.NOT_ADMIN="NOT_ADMIN",e.TEAM_INVITE_LINK_NOT_FOUND="TEAM_INVITE_LINK_NOT_FOUND"}(m||(m={})),C.z.object({tag:C.z.nativeEnum(m)});let T=!1;class I{async shouldRefreshState(){const e=await this.inviteLinkStore.getState(),t=e.status!==l.D.READY,a=e.status===l.D.READY&&e.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES<Date.now();return t||a}constructor(e,t){this.serverApiClient=e,this.inviteLinkStore=t,this.MIN_DELAY_BETWEEN_REFRESHES=1e3,this.getFunctionalErrorForToken=e=>{switch(e){case p.TEAM_DOES_NOT_EXIST:return{tag:p.TEAM_DOES_NOT_EXIST};case p.USER_NOT_PROPOSED_IN_TEAM:return{tag:p.USER_NOT_PROPOSED_IN_TEAM};case p.USER_TEAM_INVITE_TOKEN_NOT_FOUND:return{tag:p.USER_TEAM_INVITE_TOKEN_NOT_FOUND};default:throw new Error(`RequestTeamInviteToken: error ${e}`)}},this.requestUserInviteTokenSending=(e,t)=>(0,f.z)(this.serverApiClient.v1.teams.requestTeamInviteToken({login:e,teamUuid:t}).pipe((0,_.DZ)((e=>(0,b.EQ)(e,{BusinessError:e=>this.getFunctionalErrorForToken(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},InternalServerError:S.j,InvalidRequest:S.j,RateLimited:S.j,ServiceUnavailable:S.j,UnspecifiedBadStatus:S.j}))),(0,_.Qn)((({data:e})=>e)))),this.loadInviteLinkData=async()=>{if(T)return;if(T=!0,!await this.shouldRefreshState())return void(T=!1);const e=await(0,f.z)(this.serverApiClient.v1.teams.getTeamSignUpPageForAdmin().pipe((0,_.Qn)((({data:e})=>e))));if((0,y.hx)(e)){const t="BusinessError"===e.error.tag&&"TEAM_INVITE_LINK_NOT_FOUND"===e.error.code?l.D.NOT_CREATED:l.D.NOT_LOADED;return T=!1,await this.inviteLinkStore.set({status:t})}const{disabled:t,teamKey:a}=e.data;await this.inviteLinkStore.set({teamKey:a,enabled:!t,lastRefreshDate:Date.now(),status:l.D.READY}),T=!1},this.toggleInviteLink=async e=>{const t=await(0,f.z)(this.serverApiClient.v1.teams.toggleTeamSignUpPage({disabled:!e}).pipe((0,_.Qn)((({data:e})=>e))));if((0,y.hx)(t))throw new Error(`could't change toggleTeamSignUpPage ${t}`)},this.createInviteLink=async e=>{const t=await(0,f.z)(this.serverApiClient.v1.teams.createTeamSignUpPage({displayName:e}).pipe((0,_.Qn)((({data:e})=>e))));if((0,y.hx)(t))throw new Error(`could't create an invite link with createTeamSignUpPage ${t}`)}}}I=(0,r.__decorate)([(0,w.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===E.l?Object:E.l,void 0===u?Object:u])],I);class A{execute(){return(0,h.P)((()=>(this.inviteLinkService.loadInviteLinkData(),this.inviteLinkStore.state$.pipe((0,g.U)((e=>{switch(e.status){case l.D.NOT_LOADED:return(0,y.Vp)(null);case l.D.NOT_CREATED:return(0,y.Vp)({teamKey:"",enabled:!1});default:return(0,y.Vp)({teamKey:e.teamKey,enabled:e.enabled})}}))))))}constructor(e,t){this.inviteLinkService=e,this.inviteLinkStore=t}}A=(0,r.__decorate)([(0,v.e)(l.$),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===I?Object:I,void 0===u?Object:u])],A);var N=a(41511),U=a(82874),F=a(85187);class D{async execute({body:e}){const{teamName:t,enabled:a}=e,s=await this.inviteLinkStore.getState();return s.status===l.D.NOT_CREATED?await this.inviteLinkService.createInviteLink(t):s.status===l.D.READY&&s.teamKey&&await this.inviteLinkService.toggleInviteLink(a),this.inviteLinkService.loadInviteLinkData(),Promise.resolve((0,y.Vp)(void 0))}constructor(e,t){this.inviteLinkStore=e,this.inviteLinkService=t}}D=(0,r.__decorate)([(0,U.W)(F.s),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===u?Object:u,void 0===I?Object:I])],D);var O=a(71379);class P{async execute({body:e}){const{login:t,teamUuid:a}=e;return await this.inviteLinkService.requestUserInviteTokenSending(t,a),Promise.resolve((0,y.Vp)(void 0))}constructor(e){this.inviteLinkService=e}}P=(0,r.__decorate)([(0,U.W)(O.T),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===I?Object:I])],P);class x{}x=(0,r.__decorate)([(0,n.Yl)({api:i.t,imports:[N.n],providers:[I],stores:[u],handlers:{commands:{toggleInviteLink:D,requestUserInviteTokenSending:P},events:{},queries:{inviteLinkData:A}},requiredFeatureFlips:Object.values(s)})],x)},76067:(e,t,a)=>{a.d(t,{E:()=>Fe});var s,r=a(491),n=a(86006),i=a(41511),o=a(58164),c=a(6550),d=a(87752),l=a(47415),u=a(62149),p=a(63144),m=a(56618),h=a(10722),g=a(7165);!function(e){e.ActivityLogsInfobox="activityLogsInfobox",e.B2BPlanDiscontinued="b2bPlanDiscontinued",e.CRDRisksFoundInfobox="crdRisksFoundInfobox",e.IdPFailedNotification="idpFailedNotification",e.IdPNeedsSeatsInfobox="idpNeedsSeatsInfobox",e.IdPProvisioningsPendingInfobox="idpProvisioningsPendingInfobox",e.IdPNeedsSeatsInfoboxInPopup="idpNeedsSeatsInfoboxInPopup",e.NotificationTrialExtended="notificationTrialExtended",e.OfferToExtendFreeTrial="offerToExtendFreeTrial",e.RestrictSharingPolicy="restrictSharingPolicy",e.StarterRepackagePolicyInfobox="starterRepackagePolicyInfobox"}(s||(s={}));const v=g.z.object({seenNotifications:g.z.record(g.z.nativeEnum(s),g.z.boolean())}),y=e=>v.safeParse(e).success,f={activityLogsInfobox:!1,b2bPlanDiscontinued:!1,crdRisksFoundInfobox:!1,idpFailedNotification:!1,idpNeedsSeatsInfobox:!1,idpProvisioningsPendingInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1,notificationTrialExtended:!1,offerToExtendFreeTrial:!1,restrictSharingPolicy:!1,starterRepackagePolicyInfobox:!1};function _(e){const{content:t,version:a}=e;if(1===a&&y(t))return{seenNotifications:{...t.seenNotifications,idpFailedNotification:t.seenNotifications.idpFailedNotification??f.idpFailedNotification,idpNeedsSeatsInfobox:t.seenNotifications.idpNeedsSeatsInfobox??f.idpNeedsSeatsInfobox,idpProvisioningsPendingInfobox:t.seenNotifications.idpProvisioningsPendingInfobox??f.idpProvisioningsPendingInfobox,idpNeedsSeatsInfoboxInPopup:t.seenNotifications.idpNeedsSeatsInfoboxInPopup??f.idpNeedsSeatsInfoboxInPopup}};throw new Error(`Unable to migrate unexpected team-admin-notification schema version ${a}`)}class b extends((0,p.Q)({storage:{schemaVersion:2,initialValue:{seenNotifications:f},migrateStorageSchema:_,typeGuard:y},persist:!0,scope:u.F.User,storeName:"team-admin-notifications-store",capacity:m.Y._010KB,codec:h.E})){}const S=g.z.object({failedProvisionings:g.z.union([g.z.object({eventDateUnix:g.z.number(),failedLogins:g.z.array(g.z.string()),nbOfFailedCreations:g.z.number(),requiredSeats:g.z.number(),nbOfPendingProvisionings:g.z.number(),shouldShowNotifications:g.z.object({warningProvisioningsPending:g.z.boolean(),alertFailuresNeedSeats:g.z.boolean()})}),g.z.undefined()]),fixedProvisionings:g.z.union([g.z.array(g.z.object({buyingUserId:g.z.number().nullable(),eventDateUnix:g.z.number(),nbOfSeatsBought:g.z.number()})),g.z.undefined()]),lastRefreshDate:g.z.number(),error:g.z.union([g.z.string(),g.z.undefined()])}),w=e=>S.safeParse(e).success;class E extends((0,p.Q)({storage:{schemaVersion:1,initialValue:{lastRefreshDate:0},typeGuard:w},persist:!0,scope:u.F.User,storeName:"idp-notifications-store",capacity:m.Y._010KB,codec:h.E})){}var C=a(60399),T=a(87065),I=a(82567),A=a(25859),N=a(87279),U=a(92587),F=a(53344),D=a(56276),O=a(59875);class P{async refreshState(){const e=await this.teamAdminService.refreshState();if(!e?.isBillingOrFullAdmin)return void this.idpNotificationsStore.set({lastRefreshDate:0,error:D.C$.NOT_ADMIN});const t=await this.idpNotificationsStore.getState();if(t.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now())return;const a=(await this.adminNotificationsStore.getState()).seenNotifications;return(0,C.z)(this.serverApiClient.v1.teams.getIdpNotifications({}).pipe((0,T.U)((t=>{if((0,N.hx)(t))return{lastRefreshDate:Date.now(),error:t.error.message};const a=t.data.data.logs.failedProvisionings,s=a?.nbOfFailedCreations,r=e.seats.remaining,n=s?Math.max(s-r,0):0,i={warningProvisioningsPending:r>0,alertFailuresNeedSeats:n>0};return{failedProvisionings:a?.nbOfFailedCreations?{...a,requiredSeats:n,nbOfPendingProvisionings:r,shouldShowNotifications:i}:void 0,fixedProvisionings:t.data.data.logs.fixedProvisionings,lastRefreshDate:Date.now()}})),(0,I.b)((async e=>{let s=!1,r=!1,n=!1;e.failedProvisionings&&e.failedProvisionings.eventDateUnix===t.failedProvisionings?.eventDateUnix?e.failedProvisionings.requiredSeats!==t.failedProvisionings.requiredSeats&&(s=!0):(s=!0,n=!0),e.failedProvisionings?.nbOfPendingProvisionings!==t.failedProvisionings?.nbOfPendingProvisionings&&(r=!0),await this.adminNotificationsStore.set({seenNotifications:{...a,...s?{idpNeedsSeatsInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1}:{},idpFailedNotification:!n&&a.idpFailedNotification,idpProvisioningsPendingInfobox:!r&&a.idpProvisioningsPendingInfobox}}),await this.idpNotificationsStore.set(e)}))))}constructor(e,t,a,s){this.serverApiClient=e,this.teamAdminService=t,this.idpNotificationsStore=a,this.adminNotificationsStore=s,this.MIN_DELAY_BETWEEN_REFRESHES=500,this.getIdPFailedProvisioningsData=()=>(0,A.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,T.U)((e=>"not_admin"===e.error?(0,N.Rn)((0,D.qj)()):(0,N.Vp)(e.failedProvisionings))))))),this.getIdPFixedProvisioningsData=()=>(0,A.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,T.U)((e=>"not_admin"===e.error?(0,N.Rn)((0,O.Go)()):(0,N.Vp)(e.fixedProvisionings)))))))}}P=(0,r.__decorate)([(0,U.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===F.l?Object:F.l,void 0===d.k?Object:d.k,void 0===E?Object:E,void 0===b?Object:b])],P);var x=a(92122),R=a(82874),k=a(96209);class L{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,activityLogsInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}L=(0,r.__decorate)([(0,R.W)(k.o),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],L);var M=a(56859);class j{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,starterRepackagePolicyInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}j=(0,r.__decorate)([(0,R.W)(M.z),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],j);var z=a(36486);class V{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,b2bPlanDiscontinued:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}V=(0,r.__decorate)([(0,R.W)(z.q),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],V);var B=a(31521);class K{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,crdRisksFoundInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}K=(0,r.__decorate)([(0,R.W)(B.e),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],K);var G=a(93595);class q{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpFailedNotification:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}q=(0,r.__decorate)([(0,R.W)(G.b),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],q);var $=a(23578);class Q{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}Q=(0,r.__decorate)([(0,R.W)($.k),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],Q);var H=a(14485);class W{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfoboxInPopup:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}W=(0,r.__decorate)([(0,R.W)(H.N),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],W);var Y=a(61358);class X{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpProvisioningsPendingInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}X=(0,r.__decorate)([(0,R.W)(Y.r),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],X);var Z=a(81940);class J{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,restrictSharingPolicy:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}J=(0,r.__decorate)([(0,R.W)(Z.o),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],J);var ee=a(4093);class te{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,notificationTrialExtended:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}te=(0,r.__decorate)([(0,R.W)(ee.D),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],te);var ae=a(69877);class se{async execute(){const e=await this.store.getState(),t={...e.seenNotifications,offerToExtendFreeTrial:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,N.Vp)(void 0))}constructor(e){this.store=e}}se=(0,r.__decorate)([(0,R.W)(ae.R),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],se);var re=a(46449);class ne{execute(){return this.idpNotificationsDataService.getIdPFailedProvisioningsData()}constructor(e){this.idpNotificationsDataService=e}}ne=(0,r.__decorate)([(0,re.e)(D.It),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===P?Object:P])],ne);class ie{execute(){return this.idpNotificationsDataService.getIdPFixedProvisioningsData()}constructor(e){this.idpNotificationsDataService=e}}ie=(0,r.__decorate)([(0,re.e)(O.Un),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===P?Object:P])],ie);var oe=a(95681);class ce{execute(){return this.store.state$.pipe((0,T.U)((e=>(0,N.Vp)(!!e.seenNotifications.activityLogsInfobox))))}constructor(e){this.store=e}}ce=(0,r.__decorate)([(0,re.e)(oe.g),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],ce);var de=a(97786);class le{execute(){return this.store.state$.pipe((0,T.U)((e=>(0,N.Vp)(!!e.seenNotifications.starterRepackagePolicyInfobox))))}constructor(e){this.store=e}}le=(0,r.__decorate)([(0,re.e)(de.i),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],le);var ue=a(6136),pe=a(92179);class me{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.b2bPlanDiscontinued)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}me=(0,r.__decorate)([(0,re.e)(pe.z),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],me);var he=a(7310);class ge{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.crdRisksFoundInfobox)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}ge=(0,r.__decorate)([(0,re.e)(he.e),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],ge);var ve=a(91206);class ye{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.idpFailedNotification)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}ye=(0,r.__decorate)([(0,re.e)(ve.g),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],ye);var fe=a(16883);class _e{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.idpNeedsSeatsInfobox)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}_e=(0,r.__decorate)([(0,re.e)(fe.T),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],_e);var be=a(66385);class Se{execute(){return this.store.state$.pipe((0,T.U)((e=>(0,N.Vp)(!!e.seenNotifications.idpNeedsSeatsInfoboxInPopup))))}constructor(e){this.store=e}}Se=(0,r.__decorate)([(0,re.e)(be.k),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],Se);var we=a(75178);class Ee{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.idpProvisioningsPendingInfobox)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}Ee=(0,r.__decorate)([(0,re.e)(we.S),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],Ee);var Ce=a(74629);class Te{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.restrictSharingPolicy)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}Te=(0,r.__decorate)([(0,re.e)(Ce.x),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],Te);var Ie=a(31432);class Ae{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.notificationTrialExtended)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}Ae=(0,r.__decorate)([(0,re.e)(Ie.q),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],Ae);var Ne=a(75008);class Ue{execute(){return this.store.state$.pipe((0,T.U)((e=>!!e.seenNotifications.offerToExtendFreeTrial)),(0,ue.x)(),(0,T.U)(N.Vp))}constructor(e){this.store=e}}Ue=(0,r.__decorate)([(0,re.e)(Ne.U),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===b?Object:b])],Ue);class Fe{}Fe=(0,r.__decorate)([(0,n.Yl)({api:o.t,imports:[x.H,i.n],stores:[E,b,c.C],providers:[P,l.J,d.k],handlers:{commands:{markActivityLogsInfoboxSeen:L,markStarterRepackagePolicyInfoboxSeen:j,markB2BPlanDiscontinuedSeen:V,markCRDRisksFoundInfoboxSeen:K,markIdPFailedNotificationSeen:q,markIdPNeedsSeatsInfoboxSeen:Q,markIdPNeedsSeatsInfoboxInPopupSeen:W,markIdPProvisioningsPendingInfoboxSeen:X,markNewRestrictSharingPolicySeen:J,markNotificationTrialExtendedSeen:te,markOfferToExtendFreeTrialSeen:se},events:{},queries:{getIdPFailedProvisioningsData:ne,getIdPFixedProvisioningsData:ie,hasSeenActivityLogsInfobox:ce,HasSeenStarterRepackagePolicyInfobox:le,hasSeenB2BPlanDiscontinued:me,hasSeenCRDRisksFoundInfobox:ge,hasSeenIdPFailedNotification:ye,hasSeenIdPNeedsSeatsInfobox:_e,hasSeenIdPNeedsSeatsInfoboxInPopup:Se,hasSeenIdPProvisioningsPendingInfobox:Ee,hasSeenNewRestrictSharingPolicy:Te,hasSeenNotificationTrialExtended:Ae,hasSeenOfferToExtendFreeTrial:Ue}},requiredFeatureFlips:["monetization_extension_activity_logs_repackage","monetization_extension_group_sharing_repackage","monetization_extension_post_trial_checkout","monetization_extension_trial_activity_logs"]})],Fe)},44272:(e,t,a)=>{a.d(t,{X:()=>$});var s=a(491),r=a(86006),n=a(41511),i=a(72788),o=a(63144),c=a(56618),d=a(62149),l=a(73895),u=a(7165);const p=u.z.object({adminHasDismissInfobox:u.z.boolean(),nonMembersCount:u.z.number().optional(),nonMembersList:l.RD.optional()}),m=e=>p.safeParse(e).success;class h extends((0,o.Q)({initialValue:{adminHasDismissInfobox:!1},storeTypeGuard:m,persist:!1,scope:d.F.User,storeName:"non-member-store",capacity:c.Y._001KB})){}var g=a(46449),v=a(59509),y=a(48844),f=a(32054);class _{execute({body:e}){const{teamId:t}=e;return this.getTeamMembersData.get(t).pipe((0,y.Qn)((({members:e,billingAdmins:t})=>({billingAdmins:t,members:e.map((({isTeamCaptain:e,isGroupManager:t,login:a,status:s})=>({isTeamCaptain:e,isGroupManager:t,login:a,status:s})))}))))}constructor(e){this.getTeamMembersData=e}}_=(0,s.__decorate)([(0,g.e)(v.k),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===f.G?Object:f.G])],_);var b=a(82874),S=a(16396),w=a(60399),E=a(82567),C=a(92587),T=a(53344),I=a(87279),A=a(13800);class N extends A.f{}N=(0,s.__decorate)([(0,C.GS)()],N);class U{async callProposeMembers({proposedMemberLogins:e,force:t,origin:a,notificationOptions:s}){try{return await(0,w.z)(this.serverApiClient.v1.teams.proposeMembers({proposedMemberLogins:e,force:t,origin:a,notificationOptions:s}).pipe((0,y.DZ)((e=>{if("BusinessError"===e.tag)return(0,S.Wv)(e.code);throw new Error(e.message)})),(0,y.lk)((e=>(0,I.Vp)(e.data))),(0,E.b)((()=>{this.eventEmitter.sendEvent("membersAdded",void 0)}))))}catch(e){return(0,I.Rn)({tag:"failure",error:`Propose Members failed - ${e}`})}}constructor(e,t){this.serverApiClient=e,this.eventEmitter=t}}U=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===T.l?Object:T.l,void 0===N?Object:N])],U);class F{execute({body:{proposedMemberLogins:e,force:t,origin:a,notificationOptions:s}}){return this.proposeMembersService.callProposeMembers({proposedMemberLogins:e,force:t,origin:a,notificationOptions:s})}constructor(e){this.proposeMembersService=e}}F=(0,s.__decorate)([(0,b.W)(S.og),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===U?Object:U])],F);var D=a(37043);class O{async execute(){return await this.nonMemberStore.set({adminHasDismissInfobox:!0}),(0,I.Vp)(void 0)}constructor(e){this.nonMemberStore=e}}O=(0,s.__decorate)([(0,b.W)(D.Y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h])],O);var P=a(43978),x=a(69885),R=a(87065),k=a(6136),L=a(35468),M=a(58605);class j{getCount(){return this.serverApiClient.v1.teams.countDomainUsersNotInTeam({}).pipe((0,R.U)((e=>(0,I.hx)(e)?(0,I.Rn)(new M.$):(0,I.Vp)(e.data.data.usersCount))))}getList(){return this.serverApiClient.v1.teams.getDomainUsersNotInTeam({}).pipe((0,R.U)((e=>(0,I.hx)(e)?(0,I.Rn)(new M.$):(0,I.Vp)(e.data.data.users.map((e=>l.R0.parse(e)))))))}constructor(e){this.serverApiClient=e}}j=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===T.l?Object:T.l])],j);class z{execute(){return this.nonMembersStore.state$.pipe((0,P.w)((e=>void 0!==e.nonMembersCount?(0,x.of)(e.nonMembersCount):this.nonMembersService.getCount().pipe((0,R.U)((t=>(0,I.hx)(t)?0:(this.nonMembersStore.set({...e,nonMembersCount:t.data}),t.data)))))),(0,k.x)(),(0,R.U)(I.Vp))}constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}}z=(0,s.__decorate)([(0,g.e)(L.H),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===j?Object:j])],z);var V=a(62760);const B=[];class K{execute(){return this.nonMembersStore.state$.pipe((0,P.w)((e=>void 0!==e.nonMembersList?(0,x.of)(e.nonMembersList):this.nonMembersService.getList().pipe((0,R.U)((t=>{if((0,I.hx)(t))return B;const a=t.data;return this.nonMembersStore.set({...e,nonMembersList:a}),a}))))),(0,k.x)(((e,t)=>(0,V.shallowEqualArrays)(e,t))),(0,R.U)(I.Vp))}constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}}K=(0,s.__decorate)([(0,g.e)(l.Fz),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===j?Object:j])],K);var G=a(22099);class q{execute(){return this.nonMembersStore.state$.pipe((0,R.U)((e=>e.adminHasDismissInfobox)),(0,k.x)(),(0,R.U)(I.Vp))}constructor(e){this.nonMembersStore=e}}q=(0,s.__decorate)([(0,g.e)(G.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h])],q);class ${}$=(0,s.__decorate)([(0,r.Yl)({api:i.L,imports:[n.n],providers:[U,j,N,f.G],stores:[h],handlers:{commands:{proposeMembers:F,dismissNonMembersInfobox:O},events:{},queries:{getNonMembersCount:z,getNonMembersList:K,getHasAdminDismissedInfobox:q,getMembersList:_}},exports:[f.G]})],$)},32054:(e,t,a)=>{a.d(t,{G:()=>o});var s=a(491),r=a(48844),n=a(92587),i=a(53344);class o{constructor(e){this.serverApiClient=e,this.get=e=>this.serverApiClient.v1.teams.getTeamMembers({teamId:parseInt(e,10),orderBy:"joinedDateUnix",limit:0}).pipe((0,r.Qn)((({data:e})=>e)),(0,r.DZ)((e=>{throw e})))}}o=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.l?Object:i.l])],o)},80699:(e,t,a)=>{a.d(t,{V:()=>v});var s=a(491),r=a(86006),n=a(41511),i=a(35475),o=a(92587),c=a(53344),d=a(87279),l=a(48844),u=a(87065);class p{constructor(e){this.serverApiClient=e,this.getTeamReport=()=>this.getTeamReportData().pipe((0,u.U)((e=>{if((0,d.hx)(e))throw new Error("could't retrieve team report");const{data:t}=e;return(0,d.Vp)(t)}))),this.getTeamReportData=()=>this.serverApiClient.v1.teams.report({}).pipe((0,l.Qn)((({data:e})=>e)),(0,l.DZ)((e=>{throw e})))}}p=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.l?Object:c.l])],p);var m=a(46449),h=a(58089);class g{execute(){return this.teamReportService.getTeamReport()}constructor(e){this.teamReportService=e}}g=(0,s.__decorate)([(0,m.e)(h.z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p])],g);class v{}v=(0,s.__decorate)([(0,r.Yl)({api:i.B,imports:[n.n],providers:[p],handlers:{commands:{},events:{},queries:{getReport:g}}})],v)},47415:(e,t,a)=>{a.d(t,{J:()=>p});var s=a(491),r=a(95255),n=a(14122),i=a(92587),o=a(87279),c=a(60399),d=a(87065),l=a(7165);const u=l.z.array(l.z.object({details:l.z.object({isBillingAdmin:l.z.boolean(),isTeamAdmin:l.z.boolean(),status:l.z.nativeEnum(r.fE)})}));class p{get isBillingAdmin(){return(0,c.z)(this.isBillingAdmin$)}get isFullRightsAdmin(){return(0,c.z)(this.isFullRightsAdmin$)}spaces$(){return this.carbonLegacyClient.queries.carbonState({path:"userSession.spaceData.spaces"}).pipe((0,d.U)((e=>{return(0,o.hx)(e)||(t=e.data,!u.safeParse(t).success)||0===e.data.length?[]:e.data.filter((e=>e.details.status===r.fE.Accepted));var t})))}constructor(e){this.carbonLegacyClient=e,this.isBillingAdmin$=this.spaces$().pipe((0,d.U)((e=>e.some((e=>e.details.isBillingAdmin))))),this.isFullRightsAdmin$=this.spaces$().pipe((0,d.U)((e=>e.some((e=>e.details.isTeamAdmin)))))}}p=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n._?Object:n._])],p)},72223:(e,t,a)=>{a.d(t,{O:()=>s,e:()=>i});const s=(e,t)=>({allowPersistenceForMasterPassword:!e.mpPersistenceDisabled,allowSharing:!e.sharingDisabled,sharingRestrictedToTeam:!!e.sharingRestrictedToTeam,enforce2FA:"newDevice"===e.twoFAEnforced,cryptoForcedPayload:e.cryptoForcedPayload??"disabled",disableAutoLoginDomains:e.autologinDomainDisabledArray??[],enableForcedDomains:!!e.forcedDomainsEnabled,enablePersonalSpace:!!e.personalSpaceEnabled,enableRemoveForcedContent:!!e.removeForcedContentEnabled,enableVPN:!!e.secureWifiEnabled,forceAutomaticLogout:(e.forceAutomaticLogout||"unset").toString(),lockOnExit:!!e.lockOnExit,vaultExportEnabled:!!e.vaultExportEnabled,collectSensitiveDataAuditLogsEnabled:!!e.collectSensitiveDataAuditLogsEnabled,ssoEnabled:!!e.ssoEnabled,ssoProvisioning:"automatic"===e.ssoProvisioning,teamDomain:e.teamDomains??[],restrictSharingToTeam:"boolean"==typeof e.sharingRestrictedToTeam?e.sharingRestrictedToTeam:t.internalSharingOnly.enabled,recoveryEnabled:!!e.recoveryEnabled,richIconsEnabled:!!e.richIconsEnabled}),r=(e,t,a)=>{const s=[];return a?.added&&a.added.forEach((t=>s.push({type:e,value:t}))),a?.removed&&a.removed.forEach((e=>s.push({type:t,value:e}))),s},n=(e,t)=>void 0!==t?[{type:e,value:t}]:[],i=(e,t)=>{const a=[...r("add_team_domain","remove_team_domain",t.teamDomain),...r("add_autologin_domain_disabled","remove_autologin_domain_disabled",t.disableAutoLoginDomains),...n("set_forced_domains_enabled",t.enableForcedDomains),...n("set_rm_forced_content_enabled",t.enableRemoveForcedContent),...n("set_vault_export_enabled",t.vaultExportEnabled),...n("set_secure_wifi",t.enableVPN),...n("set_lock_on_exit",t.lockOnExit),...n("set_collect_sensitive_data_audit_logs_enabled",t.collectSensitiveDataAuditLogsEnabled),...n("set_sharing_restricted_to_team",t.restrictSharingToTeam),...(s="set_sharing_disabled",i=t.allowSharing,void 0!==i?[{type:s,value:!i}]:[])];var s,i;return void 0!==t.enforce2FA&&a.push({type:"set_two_factor_authentication_enforced",value:t.enforce2FA?"newDevice":"disabled"}),void 0!==t.forceAutomaticLogout&&a.push({type:null===t.forceAutomaticLogout?"unset_force_automatic_logout":"set_force_automatic_logout",value:t.forceAutomaticLogout}),void 0!==t.cryptoForcedPayload&&a.push({type:"set_crypto_forced_payload",value:t.cryptoForcedPayload}),void 0!==t.ssoProvisioning&&a.push({type:"set_sso_provisioning",value:t.ssoProvisioning?"automatic":"disabled"}),void 0!==t.richIconsEnabled&&a.push({type:"set_rich_icons_enabled",value:t.richIconsEnabled}),{operations:a,teamId:e}}},92122:(e,t,a)=>{a.d(t,{H:()=>pt});var s=a(491),r=a(86006),n=a(41511),i=a(48666),o=a(72788);var c,d=a(90475),l=a(47415),u=a(60399),p=a(92587),m=a(53344),h=a(96168);!function(e){e.CannotAddSeatDuringFreeTrial="cannot_add_seat_during_free_trial",e.CannotAddSeatIfDiscontinued="cannot_add_seat_on_soft_discontinued",e.CannotAddSeatDuringGracePeriod="cannot_add_seat_during_grace_period",e.UnsupportedPaymentMean="unsupported_payment_mean",e.UserIsNotBillingAdmin="not_billing_admin",e.PaymentFailed="payment_failed"}(c||(c={}));const g=(0,h.Vj)("cannot_add_seat_during_free_trial","Not possible to add seats during free trial"),v=(0,h.Vj)("cannot_add_seat_on_soft_discontinued","Not possible to add seats if team is discontinued"),y=(0,h.Vj)("cannot_add_seat_during_grace_period","Not possible to add seats during grace period"),f=(0,h.Vj)("unsupported_payment_mean","Payment mean is not supported"),_=(0,h.Vj)("not_billing_admin","User is not billing admin"),b=(0,h.Vj)("payment_failed","The payment has failed");var S=a(48844),w=a(18533),E=a(20195);class C{addSeats({seats:e}){return(0,u.z)(this.serverApiClient.v1.teams.addSeats({seats:e}).pipe((0,S.DZ)((e=>(0,w.EQ)(e,{BusinessError:e=>this.getAddSeatsFunctionalError(e.code),FetchFailedError:E.j,BadStatus:E.j,InternalServerError:E.j,InvalidRequest:E.j,RateLimited:E.j,ServiceUnavailable:E.j,UnspecifiedBadStatus:E.j}))),(0,S.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getAddSeatsFunctionalError=e=>{switch(e){case c.CannotAddSeatDuringFreeTrial:return g();case c.CannotAddSeatDuringGracePeriod:return y();case c.CannotAddSeatIfDiscontinued:return v();case c.UnsupportedPaymentMean:return f();case c.UserIsNotBillingAdmin:return _();case c.PaymentFailed:default:return b()}}}}C=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],C);var T=a(25859),I=a(87065),A=a(6136),N=a(85390),U=a(10705),F=a(62760),D=a(14122),O=a(87279),P=a(58605),x=a(45836),R=a(95557),k=a(10994),L=a(92481),M=a(50793);const j=e=>{if(!e)return new Date;const t=(0,R.Z)(e,"yyyy-MM-dd",new Date);return"Invalid Date"!==t.toString()?t:new Date(e)},z=e=>{const t=j((0,k.Z)(e).toString());return(0,L.Z)(t,"yyyy-MM-dd")===(0,L.Z)(j((new Date).toString()),"yyyy-MM-dd")},V=e=>{const t=new Date,a=(0,k.Z)(e);return a.setDate(a.getDate()+6),s=a,t.setHours(0,0,0,0)>s.setHours(0,0,0,0);var s},B=e=>(0,M.Z)((0,k.Z)(e),new Date);var K=a(6550),G=a(87752);class q{constructor(e,t,a){this.carbon=e,this.teamAdminStore=t,this.teamAdminService=a,this.getTeamTrialStatus=()=>(0,T.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?{isBillingOrFullAdmin:!0,isFreeTrial:e.billing.isFreeTrial,isGracePeriod:e.billing.isGracePeriod,creationDateUnix:e.creationDateUnix,nextBillingDetailsDateUnix:e.billing.nextBillingDetails.dateUnix,spaceTier:e.billing.planTier}:{isBillingOrFullAdmin:!1})),(0,A.x)(F.shallowEqualObjects),(0,I.U)((({isBillingOrFullAdmin:e,isFreeTrial:t,isGracePeriod:a,creationDateUnix:s,nextBillingDetailsDateUnix:r,spaceTier:n})=>e?(0,O.Vp)({isFreeTrial:t,isGracePeriod:a,isFirstDayOfTrial:z(s),isSecondStageOfTrial:V(s),daysLeftInTrial:B(r),spaceTier:n}):(0,O.Rn)(new P.$))))))),this.getTeamBillingDetails=()=>(0,N.a)([this.teamAdminStore.state$,this.getTeamSubscriptionInformation()]).pipe((0,I.U)((([e,t])=>{if(!e.isBillingOrFullAdmin)return{isBillingOrFullAdmin:!1};const{billing:a,seats:s}=e;return{isBillingOrFullAdmin:!0,nextBillingDetailsAmount:a.nextBillingDetails.amount,nextBillingDetailsCurrency:a.nextBillingDetails.currency,nextBillingDetailsDateUnix:a.nextBillingDetails.dateUnix,nextBillingAmountFormatted:a.nextBillingDetails.amount/100,billingType:t?.planDetails?.type,spaceTier:a.planTier,creditCardLastDigits:t?.billingInformation?.last4,lastBillingDateUnix:a.lastBillingDateUnix,seatsPaid:s.paid,seatsExtraFree:s.extraFree,usersToBeRenewedCount:a.usersToBeRenewedCount,planDetails:a.planDetails,duration:t?.planDetails?.duration}})),(0,A.x)(((e,t)=>(0,U.Z)(e,t))),(0,I.U)((({isBillingOrFullAdmin:e,nextBillingDetailsAmount:t,nextBillingDetailsCurrency:a,nextBillingDetailsDateUnix:s,nextBillingAmountFormatted:r,billingType:n,spaceTier:i,creditCardLastDigits:o,lastBillingDateUnix:c,seatsPaid:d,seatsExtraFree:l,usersToBeRenewedCount:u,planDetails:p,duration:m})=>{if(!e)return(0,O.Rn)(new P.$);const h={amount:t,currency:"usd"===a?x.F.USD:x.F.EUR,dateUnix:s,amountFormatted:r,pricePerSeat:r/u};return(0,O.Vp)({billingType:(g=n,g?"invoice"===g?x.qo.Invoice:x.qo.ProcessOut:null),spaceTier:i,creditCardLastDigits:o??null,lastBillingDateUnix:c,nextBillingDetails:h,seatsNumber:d+l,usersToBeRenewedCount:u,daysLeftUntilNextBillingPeriod:B(s),planDetails:{...p,duration:m}});var g}))),this.getTeamCapabilities=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?e.capabilities:null)),(0,A.x)(((e,t)=>null!==e&&null!==t?(0,U.Z)(e,t):e===t)),(0,I.U)((e=>null===e?(0,O.Rn)(new P.$):(0,O.Vp)(e)))),this.getTeamCreationDateUnix=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>"NOT_LOADED"===e.loadingState||"LOADING"===e.loadingState&&!e.isBillingOrFullAdmin?null:!!e.isBillingOrFullAdmin&&e.creationDateUnix)),(0,A.x)(),(0,I.U)((e=>!1===e?(0,O.Rn)(new P.$):(0,O.Vp)(e)))),this.getTeamSeats=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?(0,O.Vp)(e.seats):(0,O.Rn)(new P.$)))),this.getTeamSecurityScore=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?(0,O.Vp)(e.securityScore):(0,O.Rn)(new P.$)))),this.getIndustryBenchmarkData=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>!!e.isBillingOrFullAdmin&&e.industryBenchmarkData)),(0,A.x)(((e,t)=>"boolean"!=typeof e&&"boolean"!=typeof t?(0,F.shallowEqualObjects)(e,t):e===t)),(0,I.U)((e=>!1===e?(0,O.Rn)(new P.$):(0,O.Vp)(e)))),this.getTeamName=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?e.teamName:null)),(0,A.x)(),(0,I.U)((e=>null===e?(0,O.Rn)(new P.$):(0,O.Vp)(e)))),this.getTeamRoles=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?(0,O.Vp)(e.teamRoles):(0,O.Rn)(new P.$)))),this.getTeamActiveDirectoryInfo=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?(0,O.Vp)(e.settings.activeDirectoryInfo):(0,O.Rn)(new P.$)))),this.getTeamDuoInfo=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?(0,O.Vp)(e.settings.duoInfo):(0,O.Rn)(new P.$)))),this.getTeamSsoInfo=()=>this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?(0,O.Vp)(e.settings.ssoInfo):(0,O.Rn)(new P.$)))),this.getTeamSubscriptionInformation=()=>{const{getSubscriptionInformation:e}=this.carbon.queries;return e().pipe((0,I.U)((e=>{if(!(0,O.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,O.db)(e).b2bSubscription})))},this.getTeamPolicies=()=>(0,T.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,I.U)((e=>e.isBillingOrFullAdmin?e.policies:null)),(0,A.x)(((e,t)=>null!==e&&null!==t?(0,U.Z)(e,t):e===t)),(0,I.U)((e=>null===e?(0,O.Rn)(new P.$):(0,O.Vp)(e)))))))}}q=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===D._?Object:D._,void 0===K.C?Object:K.C,void 0===G.k?Object:G.k])],q);var $=a(30561);class Q{constructor(e){this.serverApiClient=e,this.extendFreeTrial=async()=>{const e=await(0,u.z)(this.serverApiClient.v1.teams.extendFreeTrial({}));return(0,O.hx)(e)&&this.getExtendTrialFunctionalError(e.error.message),(0,O.Vp)(void 0)},this.getExtendTrialFunctionalError=e=>{switch(e){case $.sK.TEAM_NOT_FOUND:return(0,$.gv)();case $.sK.NOT_IN_FREE_TRIAL:return(0,$.AP)();case $.sK.IN_GRACE_PERIOD:return(0,$.RQ)();case $.sK.USER_NOT_ADMIN:return(0,$.lO)();default:return(0,$.gv)()}}}}Q=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],Q);var H=a(82567),W=a(52966),Y=a(63144),X=a(56618),Z=a(62149),J=a(10722);const ee=e=>e===x.Uz.Canceled||e===x.Uz.None||e===x.Uz.Pending;class te extends((0,Y.Q)({storage:{schemaVersion:1,initialValue:x.Uz.None,typeGuard:ee},persist:!0,scope:Z.F.User,storeName:"plan-cancellation-store",capacity:X.Y._001KB,codec:J.E})){}class ae{async refreshState(){const e=this.getTickets(),t=this.getIsRenewalStopped();return await(0,u.z)((0,N.a)([e,t]).pipe((0,I.U)((([e,t])=>this.serverToDomainCancelStatusMapper(e,t))),(0,H.b)((e=>{this.planCancellationStore.set(e)}))))}constructor(e,t,a){this.serverApiClient=e,this.planCancellationStore=t,this.carbon=a,this.createZendeskCancellationTicket=async e=>{const t=await(0,u.z)(this.serverApiClient.v1.teams.createZendeskCancellationTicket(e));return(0,O.hx)(t)&&this.getBusinessErrorsForCreateZendeskCancellationTicket(t.error.message),(0,O.Vp)(void 0)},this.getZendeskCancellationTicket=()=>(this.refreshState(),this.planCancellationStore.state$.pipe((0,A.x)(),(0,I.U)(O.Vp))),this.getBusinessErrorsForCreateZendeskCancellationTicket=e=>"TEAM_IN_FREE_TRIAL"===e?(0,W.VH)():"TEAM_IS_DISCONTINUED"===e?(0,W.fz)():(0,W.Rb)(),this.serverToDomainCancelStatusMapper=(e,t)=>(0,O.hx)(e)?x.Uz.Unknown:t?x.Uz.Canceled:void 0!==(0,O.db)(e).id?x.Uz.Pending:x.Uz.None,this.getIsRenewalStopped=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,I.U)((e=>{if((0,O.hx)(e))throw new Error("Cannot retrieve node premium status from Carbon");return e.data.b2bStatus?.currentTeam?.isRenewalStopped}))),this.getTickets=()=>this.serverApiClient.v1.teams.getZendeskCancellationTicket({}).pipe((0,S.DZ)((e=>({tag:e.message}))),(0,S.Qn)((e=>e.data)))}}ae=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l,void 0===te?Object:te,void 0===D._?Object:D._])],ae);var se=a(7165);const re=se.z.object({isLoading:se.z.boolean(),isTeamCreator:se.z.boolean().optional()}),ne=e=>re.safeParse(e).success;class ie extends((0,Y.Q)({initialValue:{isLoading:!1},storeTypeGuard:ne,persist:!1,isCache:!0,scope:Z.F.User,storeName:"team-creator-store",capacity:X.Y._010KB})){}var oe,ce=a(44272),de=a(82874),le=a(36833);class ue{async execute({body:e}){const{seats:t}=e,a=await this.addSeatsService.addSeats({seats:t});return(0,O.d6)(a)&&await this.teamAdminService.refreshState(),a}constructor(e,t){this.teamAdminService=e,this.addSeatsService=t}}ue=(0,s.__decorate)([(0,de.W)(le.E),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G.k?Object:G.k,void 0===C?Object:C])],ue);class pe{async execute(){const e=await this.freeTrialService.extendFreeTrial();return(0,O.d6)(e)&&await this.teamAdminService.refreshState(),e}constructor(e,t){this.freeTrialService=e,this.teamAdminService=t}}pe=(0,s.__decorate)([(0,de.W)($.No),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Q?Object:Q,void 0===G.k?Object:G.k])],pe),function(e){e.NoInternalUsage="cancellation_lack_of_adoption",e.DownsizedEmployeeCount="cancellation_acquisition_or_restructured",e.ChoseOtherPasswordManager="cancellation_switched_to_competitor",e.MissingCriticalFeatures="cancellation_lack_of_features",e.TechnicalIssues="cancellation_technical_issues",e.TooExpensive="cancellation_price",e.Other="cancellation_other"}(oe||(oe={}));const me={[x.Gr.ChoseOtherPasswordManager]:"cancellation_switched_to_competitor",[x.Gr.DownsizedEmployeeCount]:"cancellation_acquisition_or_restructured",[x.Gr.MissingCriticalFeatures]:"cancellation_lack_of_features",[x.Gr.NoInternalUsage]:"cancellation_lack_of_adoption",[x.Gr.Other]:"cancellation_other",[x.Gr.TechnicalIssues]:"cancellation_technical_issues",[x.Gr.TooExpensive]:"cancellation_price"};class he{async execute({body:e}){const{reasons:t}=e,a=(e=>({reasons:e.map((e=>me[e]))}))(t),s=await this.planCancellationService.createZendeskCancellationTicket(a);return(0,O.d6)(s)&&await this.planCancellationService.refreshState(),s}constructor(e){this.planCancellationService=e}}he=(0,s.__decorate)([(0,de.W)(W.y7),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],he);var ge=a(45364);class ve{async execute({body:e}){const{teamId:t,newTeamName:a}=e,s=await(0,u.z)(this.serverApiClient.v1.teams.editSettings({teamId:t,operations:[{type:"set_name",value:a}]}));return(0,O.hx)(s)?"code"in s.error&&"team_name_already_exists"===s.error.code?(0,O.Rn)((0,ge.U8)()):"NOT_ADMIN"===s.error.message?(0,O.Rn)((0,ge.QI)()):"NOT_AUTHORIZED"===s.error.message?(0,O.Rn)((0,ge.Kv)()):(0,O.Rn)((0,ge.mX)()):(0,O.Vp)(void 0)}constructor(e){this.serverApiClient=e}}ve=(0,s.__decorate)([(0,de.W)(ge.Q2),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],ve);var ye=a(8025),fe=a(72223);class _e{async execute({body:e}){const{teamId:t,policyUpdates:a}=e;return await(0,u.z)(this.serverApiClient.v1.teams.editSettings((0,fe.e)(t,a))),await this.teamAdminService.refreshState(),(0,O.Vp)(void 0)}constructor(e,t){this.teamAdminService=e,this.serverApiClient=t}}_e=(0,s.__decorate)([(0,de.W)(ye.m),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G.k?Object:G.k,void 0===m.l?Object:m.l])],_e);var be=a(3434);class Se{async execute({body:e}){const{feedbackBody:t}=e,a=await(0,u.z)(this.serverApiClient.v1.feedback.sendFeedback({title:"A team Admin just wrote to us:",body:t}));return(0,O.hx)(a)?(0,O.Rn)((0,be.b6)()):(0,O.Vp)(void 0)}constructor(e){this.serverApiClient=e}}Se=(0,s.__decorate)([(0,de.W)(be.cr),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],Se);var we=a(23099);class Ee{async execute({body:{newAdminEmail:e}}){const t=await(0,u.z)(this.serverApiClient.v1.teams.updateBillingAdmin({newAdminLogin:e}));if((0,O.hx)(t))throw new Error(`Unable to update billing admin. ${t.error.message}`);return(0,O.Vp)(void 0)}constructor(e){this.serverApiClient=e}}Ee=(0,s.__decorate)([(0,de.W)(we.t),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],Ee);var Ce=a(5237),Te=a(85798);class Ie{async handle(){await this.teamAdminService.refreshState()}constructor(e){this.teamAdminService=e}}Ie=(0,s.__decorate)([(0,Te.b)(Ce.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G.k?Object:G.k])],Ie);var Ae=a(67267);class Ne{async handle(){await this.teamAdminService.refreshState()}constructor(e){this.teamAdminService=e}}Ne=(0,s.__decorate)([(0,Te.b)(Ae.q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G.k?Object:G.k])],Ne);var Ue=a(162),Fe=a(46449),De=a(29151);class Oe{execute(){return(0,Ue.D)(this.getTeamPlanDetailsService.getIndustryBenchmarkData())}constructor(e){this.getTeamPlanDetailsService=e}}Oe=(0,s.__decorate)([(0,Fe.e)(De.l),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],Oe);var Pe=a(49649);class xe{execute(){return this.getTeamPlanDetailsService.getTeamActiveDirectoryInfo()}constructor(e){this.getTeamPlanDetailsService=e}}xe=(0,s.__decorate)([(0,Fe.e)(Pe.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],xe);var Re=a(31933);class ke{execute(){return(0,Ue.D)(this.getTeamPlanDetailsService.getTeamBillingDetails())}constructor(e){this.getTeamPlanDetailsService=e}}ke=(0,s.__decorate)([(0,Fe.e)(Re._),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],ke);var Le=a(93478);class Me{execute(){return this.planCancellationService.getZendeskCancellationTicket()}constructor(e){this.planCancellationService=e}}Me=(0,s.__decorate)([(0,Fe.e)(Le.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],Me);var je=a(47883);class ze{execute(){return this.getTeamPlanDetailsService.getTeamCapabilities()}constructor(e){this.getTeamPlanDetailsService=e}}ze=(0,s.__decorate)([(0,Fe.e)(je.Y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],ze);var Ve=a(8365);class Be{execute(){return(0,Ue.D)(this.getTeamPlanDetailsService.getTeamCreationDateUnix())}constructor(e){this.getTeamPlanDetailsService=e}}Be=(0,s.__decorate)([(0,Fe.e)(Ve.T),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],Be);var Ke=a(14784);class Ge{execute(){return this.getTeamPlanDetailsService.getTeamDuoInfo()}constructor(e){this.getTeamPlanDetailsService=e}}Ge=(0,s.__decorate)([(0,Fe.e)(Ke.Z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],Ge);var qe=a(44096);class $e{execute(){const{carbonState:e}=this.carbon.queries;return e({path:"state.userSession.spaceData.spaces"}).pipe((0,I.U)((e=>{if(!(0,O.d6)(e))throw new Error("Cannot retrieve user spaces");const t=e.data.find((e=>"accepted"===e.details.status));return t?t.teamId:null})),(0,A.x)(),(0,I.U)((e=>(0,O.Vp)({teamId:e}))))}constructor(e){this.carbon=e}}$e=(0,s.__decorate)([(0,Fe.e)(qe.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===D._?Object:D._])],$e);var Qe=a(22283);class He{execute(){return this.getTeamPlanDetailsService.getTeamName()}constructor(e){this.getTeamPlanDetailsService=e}}He=(0,s.__decorate)([(0,Fe.e)(Qe.j),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],He);var We=a(88273);class Ye{execute(){return(0,Ue.D)(this.getTeamPlanDetailsService.getTeamRoles())}constructor(e){this.getTeamPlanDetailsService=e}}Ye=(0,s.__decorate)([(0,Fe.e)(We.R),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],Ye);var Xe=a(51183);class Ze{execute(){return this.getTeamPlanDetailsService.getTeamPolicies()}constructor(e){this.getTeamPlanDetailsService=e}}Ze=(0,s.__decorate)([(0,Fe.e)(Xe.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],Ze);var Je=a(3463);class et{execute(){return(0,Ue.D)(this.getTeamPlanDetailsService.getTeamSeats())}constructor(e){this.getTeamPlanDetailsService=e}}et=(0,s.__decorate)([(0,Fe.e)(Je.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],et);var tt=a(20270);class at{execute(){return(0,Ue.D)(this.getTeamPlanDetailsService.getTeamSecurityScore())}constructor(e){this.getTeamPlanDetailsService=e}}at=(0,s.__decorate)([(0,Fe.e)(tt.R),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],at);var st=a(621);class rt{execute(){return this.getTeamPlanDetailsService.getTeamSsoInfo()}constructor(e){this.getTeamPlanDetailsService=e}}rt=(0,s.__decorate)([(0,Fe.e)(st.m),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],rt);var nt=a(15640);class it{execute(){return this.getTeamPlanDetailsService.getTeamTrialStatus()}constructor(e){this.getTeamPlanDetailsService=e}}it=(0,s.__decorate)([(0,Fe.e)(nt.P),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===q?Object:q])],it);var ot=a(61076),ct=a(10729),dt=a(31108),lt=a(32054);class ut{execute(){return this.teamCreatorStore.state$.pipe((0,H.b)((e=>{e.isLoading||void 0!==e.isTeamCreator||(0,u.z)(this.loadIsTeamCreator())})),(0,I.U)((e=>e.isTeamCreator??null)),(0,A.x)(),(0,I.U)(O.Vp))}constructor(e,t,a,s){this.carbon=e,this.getTeamMembersData=t,this.teamPlanDetailsClient=a,this.teamCreatorStore=s,this.getUserLogin=()=>{const{carbonState:e}=this.carbon.queries;return e({path:"state.userSession.account.login"}).pipe((0,I.U)((e=>{if((0,O.d6)(e)&&"string"==typeof e.data&&""!==e.data)return e.data;throw new Error("No active login")})))},this.getTeamId=()=>{const{getTeamId:e}=this.teamPlanDetailsClient.queries;return e().pipe((0,I.U)((e=>(0,O.hx)(e)||!e.data.teamId||""===e.data.teamId?"":e.data.teamId)))},this.loadIsTeamCreator=()=>{this.teamCreatorStore.set({isLoading:!0});const e=this.getUserLogin();return this.getTeamId().pipe((0,H.b)((e=>{""===e&&this.teamCreatorStore.set({isTeamCreator:!1,isLoading:!1})})),(0,I.U)((t=>{if(""!==t)return(0,u.z)(this.getTeamMembersData.get(t).pipe((0,ot.V)(e),(0,I.U)((([e,t])=>{if((0,O.hx)(e))throw new Error("Error : could not retrieve team's members");const{data:a}=e,s=a.members.filter((e=>e.isTeamCaptain&&"accepted"===e.status)).sort(((e,t)=>(e.joinedDateUnix??0)-(t.joinedDateUnix??0)));this.teamCreatorStore.set({isTeamCreator:s[0]?.login===t,isLoading:!1})}))))})))}}}ut=(0,s.__decorate)([(0,Fe.e)(ct.G7),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===D._?Object:D._,void 0===lt.G?Object:lt.G,void 0===dt.e?Object:dt.e,void 0===ie?Object:ie])],ut);class pt{}pt=(0,s.__decorate)([(0,r.Yl)({api:i.o,imports:[n.n,ce.X],providers:[C,Q,q,G.k,l.J,ae],stores:[K.C,te,ie],handlers:{commands:{addSeats:ue,extendFreeTrial:pe,requestTeamPlanCancellation:he,editTeamName:ve,editTeamPolicies:_e,sendFeedback:Se,updateBillingAdmin:Ee},events:{...(0,r.g4)(d.Q,{sessionOpened:Ie}),...(0,r.g4)(o.L,{membersAdded:Ne})},queries:{getIndustryBenchmarkData:Oe,getTeamActiveDirectoryInfo:xe,getTeamBillingInformation:ke,getTeamCancellationStatus:Me,getTeamCapabilities:ze,getTeamCreationDateUnix:Be,getTeamDuoInfo:Ge,getTeamId:$e,getTeamName:He,getTeamRoles:Ye,getTeamPolicies:Ze,getTeamSeats:et,getTeamSecurityScore:at,getTeamSsoInfo:rt,getTeamTrialStatus:it,isTeamCreator:ut}},requiredFeatureFlips:Object.values({DashHackIndustryBenchmarkDev:"dashhack_web_securityScoreBenchmark",ComputePlanPricingMigration:"ecommerce_web_compute_plan_price_details_migration"})})],pt)},87752:(e,t,a)=>{a.d(t,{k:()=>w});var s=a(491),r=a(60399),n=a(87065),i=a(92587),o=a(53344),c=a(87279),d=a(47415),l=a(45836);const u=e=>{switch(e){case"legacy":default:return l.lD.Legacy;case"starter":return l.lD.Starter;case"team":return l.lD.Team;case"business":return l.lD.Business;case"entreprise":return l.lD.Enterprise;case"standard":return l.lD.Standard}},p=e=>{switch(e){case"in_team":return l.yt.InTeam;case"not_premium":return l.yt.NotPremium;case"no_payment":return l.yt.NoPayment;case"is_unpaid_family_member":return l.yt.IsUnpaidFamilyMember;case"default_settings":default:return l.yt.DefaultSettings;case"no_vpn_capability":return l.yt.NoVPNCapability;case"disabled_for_free_user":return l.yt.DisabledForFreeUser}};var m=a(72223);const h=e=>{const{enabled:t,info:a}=e;let s;return a&&(s={limit:a.limit??void 0,maxFileSize:a.maxFileSize??void 0,quota:a.quota??void 0,reason:a.reason?p(a.reason):void 0,excludedPolicies:a.excludedPolicies??void 0}),{enabled:t,info:s}},g=e=>{const{activeDirectorySync:t,activityLog:a,phoneSupport:s,samlProvisioning:r,scim:n,sso:i,usageReports:o,adminPolicies:c,groupSharing:d}=e;return{activeDirectorySync:h(t),activityLog:h(a),phoneSupport:h(s),samlProvisioning:h(r),scim:h(n),sso:h(i),usageReports:h(o),adminPolicies:h(c),groupSharing:h(d)}},v=(e,t)=>({...e,planTier:u(t)}),y=e=>new Set(Object.keys(e)),f=(e,t)=>({activeDirectoryInfo:{activeDirectorySyncType:e.activeDirectorySyncType,activeDirectoryToken:e.activeDirectoryToken,activeDirectorySyncStatus:t},duoInfo:{duo:e.duo,duoApiHostname:e.duoApiHostname,duoIntegrationKey:e.duoIntegrationKey,duoSecretKey:e.duoSecretKey,recoveryEnabled:e.recoveryEnabled},ssoInfo:{ssoServiceProviderUrl:e.ssoServiceProviderUrl,ssoIdpMetadata:e.ssoIdpMetadata,ssoIdpEntrypoint:e.ssoIdpEntrypoint}}),_=(e,t)=>{if(!t||!e)return null;const{averageSecurityScore:a,top25Percentile:s}=t;return{averageSecurityScore:a,top25Percentile:s,ratingVSIndustry:e>a?"higher":e<a?"lower":"onPar",deltaVSIndustry:Math.abs(e-a)}};var b=a(6550);let S=null;class w{async refreshState(){const e=await this.isUserTeamAdminService.isBillingAdmin,t=await this.isUserTeamAdminService.isFullRightsAdmin;if(!e&&!t)return void this.teamAdminStore.set({isBillingOrFullAdmin:!1,loadingState:"LOADED",lastRefreshDate:0});const a=await this.teamAdminStore.getState();return a.isBillingOrFullAdmin&&a.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now()?void 0:(S||(S=this.refresh(a,t)),await S)}async refresh(e,t){this.teamAdminStore.set({...e,loadingState:"LOADING",lastRefreshDate:Date.now()});const a=t?await this.getActiveDirectorySyncStatus():void 0,s=await this.getTeamStatus();if(!s)return this.teamAdminStore.set({...e,loadingState:"LOADED",isBillingOrFullAdmin:!1}),S=null,{};const r=((e,t)=>{const{securityScore:a,industryBenchmarkData:s,creationDateUnix:r,billing:n,capabilities:i,seats:o,planTier:c,info:d}=e,{name:l,groupManagers:u,teamCaptains:p}=d;return{isBillingOrFullAdmin:!0,creationDateUnix:r,loadingState:"LOADED",teamName:l,securityScore:a,industryBenchmarkData:_(a,s),seats:o,capabilities:g(i),billing:v(n,c),teamRoles:{groupManagersIds:u,teamCaptainsIds:y(p)},lastRefreshDate:Date.now(),policies:(0,m.O)(d,i),settings:f(d,t)}})(s,a);return this.teamAdminStore.set(r),S=null,r}getActiveDirectorySyncStatus(){return(0,r.z)(this.serverApiClient.v1.teams.getDirectorySyncToken({}).pipe((0,n.U)((e=>{if(!(0,c.hx)(e))return e.data.data.activeDirectorySyncStatus}))))}getTeamStatus(){return(0,r.z)(this.serverApiClient.v1.teams.teamStatus({}).pipe((0,n.U)((e=>{if(!(0,c.hx)(e))return e.data.data}))))}constructor(e,t,a){this.serverApiClient=e,this.isUserTeamAdminService=t,this.teamAdminStore=a,this.MIN_DELAY_BETWEEN_REFRESHES=500}}w=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.l?Object:o.l,void 0===d.J?Object:d.J,void 0===b.C?Object:b.C])],w)},6550:(e,t,a)=>{a.d(t,{C:()=>b});var s=a(63144),r=a(56618),n=a(62149),i=a(7165),o=a(45836);const c=i.z.union([i.z.object({reason:i.z.union([i.z.custom(),i.z.undefined()]),quota:i.z.union([i.z.object({max:i.z.union([i.z.number(),i.z.undefined()]),remaining:i.z.union([i.z.number(),i.z.undefined()])}),i.z.undefined()]),maxFileSize:i.z.union([i.z.number(),i.z.undefined()]),limit:i.z.union([i.z.number(),i.z.undefined()]),excludedPolicies:i.z.union([i.z.array(i.z.string()),i.z.undefined()])}),i.z.undefined()]),d=i.z.object({paid:i.z.number(),extraFree:i.z.number(),remaining:i.z.number()}),l=i.z.object({billingMethod:i.z.union([i.z.custom(),i.z.undefined()]),creditCardLastDigits:i.z.union([i.z.string(),i.z.undefined()]),isFreeTrial:i.z.boolean(),isGracePeriod:i.z.boolean(),planTier:i.z.custom(),lastBillingDateUnix:i.z.number(),nextBillingDetails:i.z.object({amount:i.z.number(),currency:i.z.union([i.z.literal("eur"),i.z.literal("usd")]),dateUnix:i.z.number()}),usersToBeRenewedCount:i.z.number(),planDetails:i.z.object({currency:i.z.union([i.z.literal("eur"),i.z.literal("usd")]),priceRanges:i.z.array(i.z.object({startMembers:i.z.number(),price:i.z.number(),equivalentPrice:i.z.number()}))})}),u=i.z.object({enabled:i.z.boolean(),info:c}),p=i.z.object({samlProvisioning:u,sso:u,scim:u,phoneSupport:u,activeDirectorySync:u,activityLog:u,usageReports:u,adminPolicies:u,groupSharing:u}),m=i.z.object({lastSuccessfulSync:i.z.union([i.z.object({id:i.z.number(),teamId:i.z.number(),status:i.z.string(),proposedCount:i.z.union([i.z.number(),i.z.undefined()]),reproposedCount:i.z.union([i.z.number(),i.z.undefined()]),unproposedCount:i.z.union([i.z.number(),i.z.undefined()]),removedCount:i.z.union([i.z.number(),i.z.undefined()]),validCount:i.z.union([i.z.number(),i.z.undefined()]),durationMs:i.z.number(),eventDateUnix:i.z.number()}),i.z.null()]),lastFailedSync:i.z.union([i.z.object({id:i.z.number(),teamId:i.z.number(),status:i.z.string(),error:i.z.union([i.z.string(),i.z.undefined()]),durationMs:i.z.number(),eventDateUnix:i.z.number()}),i.z.null(),i.z.undefined()]),failedSyncCount:i.z.union([i.z.number(),i.z.undefined()])}),h=i.z.object({activeDirectoryInfo:i.z.object({activeDirectorySyncType:i.z.union([i.z.string(),i.z.undefined()]),activeDirectoryToken:i.z.union([i.z.string(),i.z.undefined()]),activeDirectorySyncStatus:i.z.union([m,i.z.undefined()])}),duoInfo:i.z.object({duo:i.z.union([i.z.boolean(),i.z.undefined()]),duoApiHostname:i.z.union([i.z.string(),i.z.undefined()]),duoIntegrationKey:i.z.union([i.z.string(),i.z.undefined()]),duoSecretKey:i.z.union([i.z.string(),i.z.undefined()]),recoveryEnabled:i.z.union([i.z.boolean(),i.z.undefined()])}),ssoInfo:i.z.object({ssoServiceProviderUrl:i.z.string().nullable(),ssoIdpMetadata:i.z.string().nullable(),ssoIdpEntrypoint:i.z.string().nullable()})}),g=i.z.enum(["NOT_LOADED","LOADING","LOADED"]),v=i.z.object({isBillingOrFullAdmin:i.z.literal(!0),loadingState:g,lastRefreshDate:i.z.number(),billing:l,seats:d,capabilities:p,securityScore:i.z.number().nullable(),industryBenchmarkData:i.z.custom().nullable(),creationDateUnix:i.z.number(),teamName:i.z.string(),teamRoles:i.z.object({groupManagersIds:i.z.array(i.z.number()),teamCaptainsIds:i.z.set(i.z.string())}),policies:o.ym,settings:h}),y=i.z.object({isBillingOrFullAdmin:i.z.literal(!1),loadingState:g,lastRefreshDate:i.z.number()}),f=i.z.discriminatedUnion("isBillingOrFullAdmin",[v,y]),_=e=>f.safeParse(e).success;class b extends((0,s.Q)({initialValue:{isBillingOrFullAdmin:!1,lastRefreshDate:0,loadingState:"NOT_LOADED"},storeTypeGuard:_,persist:!1,isCache:!0,scope:n.F.User,storeName:"team-admin-store",capacity:r.Y._010KB})){}},95324:(e,t,a)=>{a.d(t,{c:()=>M});var s,r=a(491),n=a(86006),i=a(41511),o=a(27006),c=a(60399),d=a(92587),l=a(53344);!function(e){e.PaymentMeanIsNotCreditCard="PaymentMeanIsNotCreditCard",e.CurrentPlanStartDateInFuture="CurrentPlanStartDateInFuture",e.ChangeTierMidCycleError="ChangeTierMidCycleError",e.PaymentMeanIsNotInvoice="PaymentMeanIsNotInvoice",e.ChangeTierAmountTooExpensive="ChangeTierAmountTooExpensive",e.ErrorCalculatingTierChange="ErrorCalculatingTierChange",e.InsufficientAmount="InsufficientAmount",e.AssignedPlanSameTierAsCurrentPlan="AssignedPlanSameTierAsCurrentPlan",e.SalesTaxMismatch="SalesTaxMismatch",e.NotBillingAdmin="NotBillingAdmin",e.ChangeTierMidCycleInternalServer="ChangeTierMidCycleInternalServer"}(s||(s={}));var u=a(48844),p=a(18533),m=a(20195),h=a(87279);class g{changeTierMidcycle({amountToPay:e,taxes:t,planId:a,couponCode:r,newTotalNumberOfSeats:n,billingContactEmail:i}){return(0,c.z)(this.serverApiClient.v1.teams.changeTierMidCycleV2({amountToPay:e,taxes:t,planId:a,couponCode:r,newTotalNumberOfSeats:n,billingContactEmail:i}).pipe((0,u.DZ)((e=>(0,p.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:m.j,BadStatus:m.j,InternalServerError:()=>({tag:s.ChangeTierMidCycleInternalServer}),InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j,UnspecifiedBadStatus:m.j}))),(0,u.Qn)((e=>e.data))))}getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}){return(0,c.z)(this.serverApiClient.v1.teams.getMidCycleTierUpgradePriceV2({newTotalNumberOfSeats:e,newPlan:t}).pipe((0,u.DZ)((e=>(0,h.Rn)({tag:`MidcycleTierUpgradePriceFailed: ${e.message}`}))),(0,u.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case"PAYMENT_MEAN_IS_NOT_CREDITCARD":return{tag:s.PaymentMeanIsNotCreditCard};case"CURRENT_PLAN_START_DATE_IN_FUTURE":return{tag:s.CurrentPlanStartDateInFuture};case"CHANGE_TIER_MID_CYCLE_ERROR":return{tag:s.ChangeTierMidCycleError};case"PAYMENT_MEAN_IS_NOT_INVOICE":return{tag:s.PaymentMeanIsNotInvoice};case"CHANGE_TIER_AMOUNT_TOO_EXPENSIVE":return{tag:s.ChangeTierAmountTooExpensive};case"ERROR_CALCULATING_TIER_CHANGE_DISCOUNT":return{tag:s.ErrorCalculatingTierChange};case"INSUFFICIENT_AMOUNT":return{tag:s.InsufficientAmount};case"ASSIGNED_PLAN_SAME_TIER_AS_CURRENT_PLAN":return{tag:s.AssignedPlanSameTierAsCurrentPlan};case"sales_tax_mismatch":return{tag:s.SalesTaxMismatch};case"not_billing_admin":return{tag:s.NotBillingAdmin};default:throw new Error(`ChangeTierMidCycle: error ${e}`)}}}}g=(0,r.__decorate)([(0,d.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l])],g);var v=a(62149),y=a(63144),f=a(56618);class _ extends((0,y.Q)({persist:!1,scope:v.F.Device,storeName:"plan-pricing-details",initialValue:{renewal:{seatsCount:0,value:0},additionalSeats:{seatsCount:0,value:0},currency:"usd"},capacity:f.Y._001KB})){}var b=a(82874),S=a(66499),w=a(87065);class E{constructor(e,t){this.serverApiClient=e,this.computePlanPricingStore=t,this.computePlanPricingInStore=async e=>{const t=await(0,c.z)(this.serverApiClient.v1.teams.computePlanPricing({seats:e}).pipe((0,w.U)((e=>{if((0,h.hx)(e)){if("BusinessError"===e.error.tag)return"cannot_add_seat_during_grace_period"===e.error.code?(0,h.Rn)((0,S.C9)()):(0,h.Rn)((0,S.rm)());throw new Error(e.error.message)}const{renewal:t,additionalSeats:a}=e.data.data;return(0,h.Vp)({renewal:t,additionalSeats:a,currency:t.price.currency})}))));if("failure"===t.tag)throw new Error(t.error.message);const{renewal:a,additionalSeats:s}=t.data;return this.computePlanPricingStore.set({renewal:{seatsCount:a.seatsCount,value:a.price.value,taxes:a.price.taxes},additionalSeats:{seatsCount:s.seatsCount,value:s.price.value,taxes:s.price.taxes},currency:a.price.currency}),(0,h.Vp)(void 0)}}}E=(0,r.__decorate)([(0,d.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l,void 0===_?Object:_])],E);class C{async execute({body:{numberOfSeats:e}}){return this.planPricingService.computePlanPricingInStore(e)}constructor(e){this.planPricingService=e}}C=(0,r.__decorate)([(0,b.W)(S.wf),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===E?Object:E])],C);var T=a(51060);class I{upgradeTeamWithExistingCc({planId:e,countryCode:t,membersNumber:a,amountToPayInCents:s,taxesToPayInCents:r,couponCode:n,vatNumber:i}){return(0,c.z)(this.serverApiClient.v1.teams.upgradeTeamWithExistingCc({planId:e,countryCode:t,membersNumber:a,amountToPayInCents:s,taxesToPayInCents:r,couponCode:n,vatNumber:i}).pipe((0,u.DZ)((e=>(0,p.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:m.j,BadStatus:m.j,InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j,UnspecifiedBadStatus:m.j}))),(0,u.Qn)((e=>e.data))))}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case T.AI.STARTER_PLAN_NOT_10_SEATS:return(0,T.Zy)();case T.AI.USER_SUBSCRIBING_NOT_FOUND:return(0,T.L7)();case T.AI.CANNOT_INVOICE_FREE_PLAN:return(0,T.hY)();case T.AI.PAYMENT_ERROR_DURING_UPGRADE:return(0,T.g3)();case T.AI.SEATS_TO_PURCHASE_LOWER_ACTUAL_USAGE:return(0,T.oH)();case T.AI.NOT_IN_A_TEAM_PLAN:return(0,T.NS)();case T.AI.NOT_TEAM_CAPTAIN:return(0,T.d3)();case T.AI.NOT_IN_FREE_TRIAL:return(0,T._1)();case T.AI.INVALID_PLAN:return(0,T.fu)();case T.AI.WRONG_AMOUNT_TO_PAY:return(0,T.jV)();case T.AI.SALES_TAX_MISMATCH:return(0,T.hS)();case T.AI.B2B_PLAN_NOT_FOUND:return(0,T.aY)();case T.AI.SELECTED_PLAN_IS_NOT_VALID:return(0,T.QF)();case T.AI.FORBIDDEN_EMAIL_DOMAIN:return(0,T.rj)();case T.AI.TEAM_HAS_SSO_ENABLED:return(0,T.KW)();case T.AI.VAT_NUMBER_NOT_UPSERTED:return(0,T.T1)();case T.AI.NO_KEY_FOR_USER:return(0,T.Ls)();case T.AI.UNSUPPORTED_PAYMENT_MEAN:return(0,T.ZP)();default:throw new Error(`UpgradeTeamWithExistingCc: error ${e}`)}}}}I=(0,r.__decorate)([(0,d.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l])],I);var A=a(33549);class N{execute({body:{amountToPay:e,taxes:t,planId:a,couponCode:s,newTotalNumberOfSeats:r,billingContactEmail:n}}){return this.midcycleTierService.changeTierMidcycle({amountToPay:e,taxes:t,planId:a,couponCode:s,newTotalNumberOfSeats:r,billingContactEmail:n})}constructor(e){this.midcycleTierService=e}}N=(0,r.__decorate)([(0,b.W)(A.G),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===g?Object:g])],N);class U{execute({body:{planId:e,countryCode:t,membersNumber:a,amountToPayInCents:s,taxesToPayInCents:r,couponCode:n,vatNumber:i}}){return this.upgradeTeamWithExistingCcService.upgradeTeamWithExistingCc({planId:e,countryCode:t,membersNumber:a,amountToPayInCents:s,taxesToPayInCents:r,couponCode:n,vatNumber:i})}constructor(e){this.upgradeTeamWithExistingCcService=e}}U=(0,r.__decorate)([(0,b.W)(T.gi),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===I?Object:I])],U);var F=a(46449),D=a(54697);class O{execute({body:{couponCode:e}}){return this.serverApiClient.v1.teams.getTeamOffers({couponCode:e,withStarterOffer:!0}).pipe((0,u.Qn)((e=>e.data)),(0,u.DZ)((e=>{throw new Error(e.message)})))}constructor(e){this.serverApiClient=e}}O=(0,r.__decorate)([(0,F.e)(D.g),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l])],O);var P=a(162),x=a(39127);class R{execute({body:{newTotalNumberOfSeats:e,newPlan:t}}){return(0,P.D)(this.midcycleTierService.getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}))}constructor(e){this.midcycleTierService=e}}R=(0,r.__decorate)([(0,F.e)(x.X),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===g?Object:g])],R);var k=a(70552);class L{execute(){return this.computePlanPricingStore.state$.pipe((0,w.U)((e=>(0,h.Vp)(e))))}constructor(e){this.computePlanPricingStore=e}}L=(0,r.__decorate)([(0,F.e)(k.n),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===_?Object:_])],L);class M{}M=(0,r.__decorate)([(0,n.Yl)({api:o.K,imports:[i.n],providers:[g,E,I],stores:[_],handlers:{commands:{changeTierMidcycle:N,computePlanPricingDetails:C,upgradeTeamWithExistingCc:U},events:{},queries:{getTeamOffers:O,getMidcycleTierUpgradePrice:R,getPlanPricingDetails:L}},requiredFeatureFlips:["monetization_extension_policies_repackage","monetization_extension_policies_revert_notice"]})],M)},58172:(e,t,a)=>{a.d(t,{K:()=>A});var s=a(491),r=a(86006),n=a(41511),i=a(50691),o=a(60399),c=a(85390),d=a(6220),l=a(87065),u=a(92587),p=a(53344),m=a(48844),h=a(87279),g=a(47969),v=a(99706),y=a(38356),f=a(23945),_=a(14122);class b{async deleteTeamVat(){return await(0,o.z)(this.serverApiClient.v1.teams.deleteTeamVat().pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,g.zK)(e.code);throw new Error(e.message)})))),(0,h.Vp)(void 0)}getTeamVat(){return this.serverApiClient.v1.teams.getTeamVat().pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,v.K$)(e.code);throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)(e.data.vatNumber))))}async upsertTeamVat({newVATNumber:e}){return await(0,o.z)(this.serverApiClient.v1.teams.upsertTeamVat({newVATNumber:e}).pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return(0,y.q5)(e.code);throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)(e.data)))))}getExpectedTaxInformation(e){return(0,c.a)([this.getTeamSubscriptionInformation(),this.getUserLogin()]).pipe((0,d.z)((([t,a])=>{if(!t?.billingInformation)throw new Error("Could not retrieve subscription information");const{country:s,address_zip:r}=t.billingInformation;return this.serverApiClient.v1.payments.getExpectedTaxInformation({login:a,zipCode:r??"",country:s??"",taxOrigin:"team",priceInCents:e})})))}constructor(e,t){this.serverApiClient=e,this.carbon=t,this.getTaxAmount=e=>this.getExpectedTaxInformation(e).pipe((0,m.DZ)((e=>{if("BusinessError"===e.tag)return new f.A;throw new Error(e.message)})),(0,m.lk)((e=>(0,h.Vp)({amount:e.data.expectedTaxesInCents})))),this.getUserLogin=()=>this.carbon.queries.getUserLogin().pipe((0,l.U)((e=>{if((0,h.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")}))),this.getTeamSubscriptionInformation=()=>{const{getSubscriptionInformation:e}=this.carbon.queries;return e().pipe((0,l.U)((e=>{if(!(0,h.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,h.db)(e).b2bSubscription})))}}}b=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.l?Object:p.l,void 0===_._?Object:_._])],b);var S=a(82874);class w{execute(){return this.teamVatService.deleteTeamVat()}constructor(e){this.teamVatService=e}}w=(0,s.__decorate)([(0,S.W)(g.Hy),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b])],w);class E{async execute({body:{newVATNumber:e}}){return await this.teamVatService.upsertTeamVat({newVATNumber:e}),(0,h.Vp)(void 0)}constructor(e){this.teamVatService=e}}E=(0,s.__decorate)([(0,S.W)(y.XW),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b])],E);var C=a(46449);class T{execute(){return this.teamVatService.getTeamVat()}constructor(e){this.teamVatService=e}}T=(0,s.__decorate)([(0,C.e)(v.N7),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b])],T);class I{execute({body:e}){const{totalPrice:t}=e;return this.teamVatService.getTaxAmount(t)}constructor(e){this.teamVatService=e}}I=(0,s.__decorate)([(0,C.e)(f.B),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b?Object:b])],I);class A{}A=(0,s.__decorate)([(0,r.Yl)({api:i.a,imports:[n.n],providers:[b],handlers:{commands:{deleteTeamVat:w,upsertTeamVat:E},events:{},queries:{getTeamVat:T,getTaxAmount:I}}})],A)},15020:(e,t,a)=>{a.r(t),a.d(t,{CanUserAddNewPasswordQuery:()=>q.K,CollectionsQuery:()=>M.I,Country:()=>_.c,CreateCollectionCommand:()=>k.e,CreateVaultItemCommand:()=>n._,CreatedEvent:()=>l.J,CredentialSchema:()=>w,DeleteCollectionCommand:()=>R.T,DeleteSecureFileCommand:()=>Z._8,DeleteSecureFileCommandErrors:()=>Z.j6,DeleteVaultItemCommand:()=>c.io,DeleteVaultItemCommandErrors:()=>c.kx,DeleteVaultItemsCommand:()=>i.c,DeletedEvent:()=>u.s,DomainIconDetailsMapSchema:()=>b.x,DomainIconDetailsQuery:()=>m.s,DomainIconDetailsSchema:()=>b.N,EmailType:()=>E,EmitTemporaryVaultItemEventCommand:()=>d.c,EventType:()=>d.t,FilterOperators:()=>h.l,GetPasswordLimitStatusQuery:()=>$.r,GetVaultNotificationsStatusQuery:()=>P.M,IdentityTitle:()=>T.t,IsFreeUserFrozenQuery:()=>Q.k,NoteColors:()=>A.L,OperationType:()=>L.C,PASSWORD_LIMIT_FEATURE_FLIPS:()=>H.t,PaymentCardColorType:()=>C.X,PhoneType:()=>I.z,RichIconsEnabledQuery:()=>f.M,SecureFilesClient:()=>X,SecureNoteCategoryQuery:()=>g.F,SecureNoteSchema:()=>A._,SetVaultNotificationsStatusCommand:()=>O.x,SortDirection:()=>v.S,UpdateCollectionCommand:()=>L.s,UpdateVaultItemCommand:()=>o.K,UpdatedEvent:()=>p.V,VaultItemType:()=>N.U,VaultItemTypeToResultDictionary:()=>U.N,VaultItemsCrudClient:()=>r.L,VaultItemsCrudFeatureFlips:()=>F.j,VaultItemsQuery:()=>y.W,VaultOrganizationClient:()=>j.C,VaultSearchClient:()=>V.T,VaultSearchQuery:()=>B.W,VaultSearchRankedQuery:()=>K.$,createForbiddenGroupItemError:()=>c.Vf,createForbiddenLastAdminError:()=>c.V$,createItemNotFoundError:()=>c.sA,createNoRemoteFileError:()=>Z.Kg,createSecureFileQuotaUpdateError:()=>Z.qC,passwordLimitApi:()=>G.Z,secureFilesApi:()=>W.e,vaultItemsCrudApi:()=>s.L,vaultNotificationsApi:()=>D.e,vaultOrganizationApi:()=>x.v,vaultSearchApi:()=>z.R});var s=a(70433),r=a(50879),n=a(90404),i=a(56008),o=a(5822),c=a(87263),d=a(44594),l=a(25666),u=a(46578),p=a(34086),m=a(17049),h=a(52402),g=a(95736),v=a(93314),y=a(54676),f=a(96900),_=a(44105),b=a(15531),S=a(7165);const w=S.z.object({alternativeUsername:S.z.string(),email:S.z.string(),itemName:S.z.string(),password:S.z.string(),username:S.z.string(),URL:S.z.string(),linkedURLs:S.z.array(S.z.string())});var E,C=a(53214);!function(e){e.Perso="PERSO",e.Pro="PRO",e.NoType="NO_TYPE"}(E||(E={}));var T=a(26311),I=a(7325),A=a(30581),N=a(39431),U=a(29289),F=a(53727),D=a(53234),O=a(67304),P=a(71524),x=a(96124),R=a(38644),k=a(95569),L=a(86342),M=a(42645),j=a(77802),z=a(20281),V=a(22449),B=a(352),K=a(88846),G=a(55257),q=a(36723),$=a(70065),Q=a(72483),H=a(37470),W=a(81042),Y=a(8260);class X extends((0,Y.E)(W.e)){}(0,Y.K)(W.e,X);var Z=a(22337)},55257:(e,t,a)=>{a.d(t,{Z:()=>o});var s=a(75958),r=a(36723),n=a(70065),i=a(72483);const o=(0,s.Q)({name:"passwordLimit",commands:{},events:{},queries:{canUserAddNewPassword:r.K,getPasswordLimitStatus:n.r,isFreeUserFrozen:i.k}})},37470:(e,t,a)=>{a.d(t,{t:()=>s});const s={B2CRestrictPasswordFreePlan:"b2c_web_restrict_password_free_plan_dev",B2CFreeUserFrozenState:"b2c_web_free_users_frozen_state",B2CPreventCopy:"b2c_ecommerce_web_restrict_free_copy_passwords"}},36723:(e,t,a)=>{a.d(t,{K:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},70065:(e,t,a)=>{a.d(t,{r:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},72483:(e,t,a)=>{a.d(t,{k:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},81042:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(75958),r=a(22337);const n=(0,s.Q)({name:"secureFiles",commands:{deleteSecureFile:r._8},events:{},queries:{}})},22337:(e,t,a)=>{a.d(t,{Kg:()=>o,_8:()=>d,j6:()=>s,qC:()=>c});var s,r=a(13385),n=a(62149),i=a(96168);!function(e){e.NO_REMOTE_FILE="no-remote-file",e.SECURE_FILE_QUOTA_UPDATE="secure-file-quota-update"}(s||(s={}));const o=(0,i.Vj)("no-remote-file","The user doesn't have access to this secure file or it has already been deleted."),c=(0,i.Vj)("secure-file-quota-update","The secure file quota state update failed.");class d extends((0,r.g)({scope:n.F.User})){}},70433:(e,t,a)=>{a.d(t,{L:()=>v});var s=a(75958),r=a(87263),n=a(90404),i=a(56008),o=a(5822),c=a(44594),d=a(25666),l=a(46578),u=a(34086),p=a(17049),m=a(54676),h=a(95736),g=a(96900);const v=(0,s.Q)({name:"vaultItemsCrud",commands:{deleteVaultItem:r.io,createVaultItem:n._,deleteVaultItems:i.c,updateVaultItem:o.K,emitTemporaryVaultItemEvent:c.c},events:{createdEvent:d.J,deletedEvent:l.s,updatedEvent:u.V},queries:{domainIconDetails:p.s,query:m.W,secureNoteCategory:h.F,richIconsEnabled:g.M}})},50879:(e,t,a)=>{a.d(t,{L:()=>n});var s=a(8260),r=a(70433);class n extends((0,s.E)(r.L)){}(0,s.K)(r.L,n)},90404:(e,t,a)=>{a.d(t,{_:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},87263:(e,t,a)=>{a.d(t,{V$:()=>d,Vf:()=>c,io:()=>l,kx:()=>i,sA:()=>o});var s=a(13385),r=a(62149),n=a(96168);const i=Object.freeze({NOT_FOUND:"NOT_FOUND",FORBIDDEN_GROUP_ITEM:"FORBIDDEN_GROUP_ITEM",FORBIDDEN_LAST_ADMIN:"FORBIDDEN_LAST_ADMIN"}),o=(0,n.Vj)(i.NOT_FOUND,"The Vault Item to be deleted couldn't be found."),c=(0,n.Vj)(i.FORBIDDEN_GROUP_ITEM,"The Vault Item cannot be deleted while shared via user group."),d=(0,n.Vj)(i.FORBIDDEN_LAST_ADMIN,"The Vault Item cannot be deleted while the current user is the last admin.");class l extends((0,s.g)({scope:r.F.User})){}},56008:(e,t,a)=>{a.d(t,{c:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},44594:(e,t,a)=>{a.d(t,{c:()=>i,t:()=>s});var s,r=a(13385),n=a(62149);!function(e){e.Deleted="deleted",e.Updated="updated",e.Created="created"}(s||(s={}));class i extends((0,r.g)({scope:n.F.User})){}},5822:(e,t,a)=>{a.d(t,{K:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},80361:(e,t,a)=>{a.d(t,{D:()=>n});var s=a(446),r=a(62149);class n extends((0,s.d)({scope:r.F.User})){}},25666:(e,t,a)=>{a.d(t,{J:()=>r});var s=a(80361);class r extends s.D{}},46578:(e,t,a)=>{a.d(t,{s:()=>r});var s=a(80361);class r extends s.D{}},34086:(e,t,a)=>{a.d(t,{V:()=>r});var s=a(80361);class r extends s.D{}},53727:(e,t,a)=>{var s;a.d(t,{j:()=>s}),function(e){e.PasskeysInVaultDev="vault_web_passkey_dev",e.PasskeysInVaultProd="vault_web_passkey_prod",e.RichIconsDev="sharingVault_web_rich_icons_setting"}(s||(s={}))},17049:(e,t,a)=>{a.d(t,{s:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},52402:(e,t,a)=>{var s;a.d(t,{l:()=>s}),function(e){e.Equal="equal",e.LessThan="lessThan",e.GreaterThan="greaterThan"}(s||(s={}))},96900:(e,t,a)=>{a.d(t,{M:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},95736:(e,t,a)=>{a.d(t,{F:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},93314:(e,t,a)=>{var s;a.d(t,{S:()=>s}),function(e){e.Ascend="ascend",e.Descend="descend"}(s||(s={}))},54676:(e,t,a)=>{a.d(t,{W:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},44105:(e,t,a)=>{var s;a.d(t,{c:()=>s}),function(e){e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AQ="AQ",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AX="AX",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BV="BV",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CC="CC",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CX="CX",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.EH="EH",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GS="GS",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HM="HM",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PN="PN",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SJ="SJ",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.UM="UM",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW"}(s||(s={}))},15531:(e,t,a)=>{a.d(t,{N:()=>i,x:()=>o});var s=a(7165);const r=["crawled","xs","sm","sm@2x","md","md.tiff","xmd","xmd@2x","l","l@2x","xl","xl@2x","46x30","46x30@2x","50x33","50x33@2x","56x56","56x56@2x","118x98","118x98@2x","160x106","160x106@2x"];s.z.enum(r);const n=r.reduce(((e,t)=>e.setKey(t,s.z.string().optional().nullable())),s.z.object({})),i=s.z.object({backgroundColor:s.z.string(),mainColor:s.z.string(),urls:n}),o=s.z.map(s.z.string(),i)},53214:(e,t,a)=>{var s;a.d(t,{X:()=>s}),function(e){e.Black="BLACK",e.Blue1="BLUE1",e.Blue2="BLUE2",e.Gold="GOLD",e.Green1="GREEN1",e.Green2="GREEN2",e.Orange="ORANGE",e.Red="RED",e.Silver="SILVER",e.White="WHITE"}(s||(s={}))},26311:(e,t,a)=>{var s;a.d(t,{t:()=>s}),function(e){e.Mr="MR",e.Mrs="MRS",e.Miss="MISS",e.Ms="MS",e.Mx="MX",e.NoneOfThese="NONEOFTHESE"}(s||(s={}))},7325:(e,t,a)=>{var s;a.d(t,{z:()=>s}),function(e){e.Any="ANY",e.Fax="FAX",e.Landline="LANDLINE",e.Mobile="MOBILE",e.WorkFax="WORKFAX",e.WorkLandline="WORKLANDLINE",e.WorkMobile="WORKMOBILE"}(s||(s={}))},30581:(e,t,a)=>{a.d(t,{L:()=>s,_:()=>n});var s,r=a(7165);!function(e){e.BLUE="BLUE",e.BROWN="BROWN",e.GRAY="GRAY",e.GREEN="GREEN",e.ORANGE="ORANGE",e.PINK="PINK",e.PURPLE="PURPLE",e.RED="RED",e.YELLOW="YELLOW"}(s||(s={}));const n=r.z.object({color:r.z.string(),isSecured:r.z.boolean(),title:r.z.string(),content:r.z.string(),categoryId:r.z.string()})},39431:(e,t,a)=>{var s;a.d(t,{U:()=>s}),function(e){e.Address="KWAddress",e.BankAccount="KWBankStatement",e.Company="KWCompany",e.Credential="KWAuthentifiant",e.DriversLicense="KWDriverLicence",e.Email="KWEmail",e.FiscalId="KWFiscalStatement",e.IdCard="KWIDCard",e.Identity="KWIdentity",e.Passkey="KWPasskey",e.Passport="KWPassport",e.PaymentCard="KWPaymentMean_creditCard",e.Phone="KWPhone",e.Secret="KWSecret",e.SecureNote="KWSecureNote",e.SocialSecurityId="KWSocialSecurityStatement",e.Website="KWPersonalWebsite"}(s||(s={}))},29289:(e,t,a)=>{a.d(t,{N:()=>r});var s=a(39431);const r={[s.U.Address]:"addressesResult",[s.U.BankAccount]:"bankAccountsResult",[s.U.Company]:"companiesResult",[s.U.Credential]:"credentialsResult",[s.U.DriversLicense]:"driversLicensesResult",[s.U.Email]:"emailsResult",[s.U.FiscalId]:"fiscalIdsResult",[s.U.IdCard]:"idCardsResult",[s.U.Identity]:"identitiesResult",[s.U.Passkey]:"passkeysResult",[s.U.Passport]:"passportsResult",[s.U.PaymentCard]:"paymentCardsResult",[s.U.Phone]:"phonesResult",[s.U.Secret]:"secretsResult",[s.U.SecureNote]:"secureNotesResult",[s.U.SocialSecurityId]:"socialSecurityIdsResult",[s.U.Website]:"websitesResult"}},53234:(e,t,a)=>{a.d(t,{e:()=>i});var s=a(75958),r=a(67304),n=a(71524);const i=(0,s.Q)({name:"vaultNotifications",commands:{setVaultNotificationsStatus:r.x},events:{},queries:{getVaultNotificationsStatus:n.M}})},67304:(e,t,a)=>{a.d(t,{x:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},71524:(e,t,a)=>{a.d(t,{M:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},96124:(e,t,a)=>{a.d(t,{v:()=>c});var s=a(75958),r=a(38644),n=a(95569),i=a(86342),o=a(42645);const c=(0,s.Q)({name:"vaultOrganization",commands:{deleteCollection:r.T,createCollection:n.e,updateCollection:i.s},events:{},queries:{queryCollections:o.I}})},95569:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},38644:(e,t,a)=>{a.d(t,{T:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},86342:(e,t,a)=>{a.d(t,{C:()=>s,s:()=>i});var s,r=a(13385),n=a(62149);!function(e){e.SUBSTRACT_VAULT_ITEMS="subtract_vault_items",e.APPEND_VAULT_ITEMS="append_vault_items"}(s||(s={}));class i extends((0,r.g)({scope:n.F.User})){}},42645:(e,t,a)=>{a.d(t,{I:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},77802:(e,t,a)=>{a.d(t,{C:()=>n});var s=a(8260),r=a(96124);class n extends((0,s.E)(r.v)){}(0,s.K)(r.v,n)},20281:(e,t,a)=>{a.d(t,{R:()=>i});var s=a(75958),r=a(88846),n=a(352);const i=(0,s.Q)({name:"vaultSearch",commands:{},events:{},queries:{vaultSearchRanked:r.$,search:n.W}})},22449:(e,t,a)=>{a.d(t,{T:()=>n});var s=a(8260),r=a(20281);class n extends((0,s.E)(r.R)){}(0,s.K)(r.R,n)},88846:(e,t,a)=>{a.d(t,{$:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},352:(e,t,a)=>{a.d(t,{W:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.User})){}},89434:(e,t,a)=>{a.d(t,{a:()=>I});var s=a(491),r=a(86006),n=a(55257),i=a(37470),o=a(85390),c=a(87065),d=a(46449),l=a(87279),u=a(36723),p=a(6136),m=a(43978),h=a(69885),g=a(14122),v=a(92587),y=a(39431),f=a(71860);class _{constructor(e,t){this.carbon=e,this.vaultRepository=t,this.isPasswordLimitEnabled=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.enabled??!1))),this.getNumberOfPasswordsLeft=()=>{const e=this._getCredentialCount(),t=this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.info?.limit)));return(0,o.a)([e,t]).pipe((0,c.U)((([e,t])=>{if("number"==typeof t)return t-e})))},this.isFreeUserFrozen=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>e?.enabled&&"enforce_freeze"===e.info?.action&&e.info?.limit)),(0,p.x)()).pipe((0,m.w)((e=>e?this._getCredentialCount().pipe((0,c.U)((t=>t>e))):(0,h.of)(!1)))),this.getCurrentPasswordLimit=()=>this._getPasswordsLimitCapability().pipe((0,c.U)((e=>{if(e?.enabled&&!e.info?.limit&&0!==e.info?.limit)throw new Error("Cannot get password limit from server");return e?.info?.limit}))),this._getPasswordsLimitCapability=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,c.U)((e=>{if(!(0,l.d6)(e))throw new Error("Cannot retrieve node premium status from carbon");return(0,l.db)(e).capabilities?.passwordsLimit}))),this._getCredentialCount=()=>this.vaultRepository.fetchVaultItems$({vaultItemTypes:[y.U.Credential]}).pipe((0,c.U)((e=>{if(!(0,l.d6)(e))throw new Error("Cannot retrieve credentials from vault");return(0,l.db)(e).credentialsResult.matchCount})))}}_=(0,s.__decorate)([(0,v.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._,void 0===f.g?Object:f.g])],_);class b{execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft();return(0,o.a)(e,t).pipe((0,c.U)((([e,t])=>e&&"number"==typeof t?(0,l.Vp)(t>0):(0,l.Vp)(!0))))}constructor(e){this.passwordLimitRepository=e}}b=(0,s.__decorate)([(0,d.e)(u.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],b);var S=a(62760),w=a(70065);class E{execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft(),a=this.passwordLimitRepository.getCurrentPasswordLimit();return(0,o.a)([e,t,a]).pipe((0,c.U)((([e,t,a])=>e&&"number"==typeof t&&"number"==typeof a?{hasLimit:e,passwordsLeft:t,limit:a}:{hasLimit:!1})),(0,p.x)(S.shallowEqualObjects),(0,c.U)(l.Vp))}constructor(e){this.passwordLimitRepository=e}}E=(0,s.__decorate)([(0,d.e)(w.r),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],E);var C=a(72483);class T{execute(){return this.passwordLimitRepository.isFreeUserFrozen().pipe((0,p.x)(),(0,c.U)(l.Vp))}constructor(e){this.passwordLimitRepository=e}}T=(0,s.__decorate)([(0,d.e)(C.k),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],T);class I{}I=(0,s.__decorate)([(0,r.Yl)({api:n.Z,stores:[],handlers:{commands:{},events:{},queries:{canUserAddNewPassword:b,getPasswordLimitStatus:E,isFreeUserFrozen:T}},providers:[f.g,_],requiredFeatureFlips:[...Object.values(i.t)]})],I)},27357:(e,t,a)=>{a.d(t,{E:()=>f});var s=a(491),r=a(86006),n=a(41511),i=a(81042),o=a(60399),c=a(51592),d=a(14122),l=a(82874),u=a(50423),p=a(61798),m=a(53344),h=a(87279),g=a(18533),v=a(22337);class y{async execute({body:e}){try{const a=await this.carbonLegacyClient.commands.carbonLegacyLeeloo({name:"removePersonalDataItem",arg:[{id:e.id}]});if(!(0,h.d6)(a)){const s=(0,h.Yv)(a),r=(t=s).error&&"object"==typeof t.error&&"reason"in t.error&&"number"==typeof t.error.reason?t.error.reason:null;if(r!==c.M.NOT_FOUND)throw new Error("Unexpected failure while attemping to delete personal data item in Carbon",{cause:{failure:s,reason:r,id:e.id}})}}catch(e){throw new Error("Unexpectedly unable to attempt deleting personal data item in Carbon",{cause:e})}var t;const a=await(0,o.z)(this.serverApiClient.v1.securefile.deleteSecureFile({secureFileInfoId:e.id}));if(!(0,h.d6)(a))return(0,g.EQ)(a.error,{...(0,p.X)((e=>{throw new Error("Unexpected server error while attempting to delete remote secure file",{cause:e})})),BusinessError:()=>(0,h.Rn)((0,v.Kg)())});const{quota:s}=(0,h.db)(a).data;try{const e=await this.carbonLegacyClient.commands.updateSecureFileQuota({quota:s});if(!(0,h.d6)(e)){const t=new Error("Unexpected failure while attemping to update secure file quota state in Carbon",{cause:(0,h.Yv)(e)});return await this.allowedToFail.doOne((()=>Promise.reject(t)),{methodName:"carbonLegacyClient.commands.updateSecureFileQuota",criticality:"warning"}),(0,h.Rn)((0,v.qC)())}}catch(e){return(0,h.Rn)((0,v.qC)())}return(0,h.Vp)(void 0)}constructor(e,t,a){this.carbonLegacyClient=e,this.serverApiClient=t,this.allowedToFail=a}}y=(0,s.__decorate)([(0,l.W)(v._8),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d._?Object:d._,void 0===m.l?Object:m.l,void 0===u.J?Object:u.J])],y);class f{}f=(0,s.__decorate)([(0,r.Yl)({api:i.e,imports:[n.n],handlers:{commands:{deleteSecureFile:y},events:{},queries:{}},domainName:"vault"})],f)},13436:(e,t,a)=>{a.d(t,{z:()=>pe});var s=a(491),r=a(86006),n=a(16624),i=a(70433),o=a(53727),c=a(13800),d=a(92587);class l extends c.f{}l=(0,s.__decorate)([(0,d.GS)()],l);var u=a(82874),p=a(87279),m=a(14122),h=a(39431),g=a(90404),v=a(12144),y=a(90294),f=a(26311),_=a(53214),b=a(7325),S=a(44105);const w={[f.t.Mr]:"MR",[f.t.Mrs]:"MME",[f.t.Miss]:"MLLE",[f.t.Ms]:"MS",[f.t.Mx]:"MX",[f.t.NoneOfThese]:"NONE_OF_THESE"},E={[_.X.Black]:v.LR.BLACK,[_.X.Blue1]:v.LR.BLUE_1,[_.X.Blue2]:v.LR.BLUE_2,[_.X.Gold]:v.LR.GOLD,[_.X.Green1]:v.LR.GREEN_1,[_.X.Green2]:v.LR.GREEN_2,[_.X.Orange]:v.LR.ORANGE,[_.X.Red]:v.LR.RED,[_.X.Silver]:v.LR.SILVER,[_.X.White]:v.LR.WHITE},C={[b.z.Any]:y.z.PHONE_TYPE_ANY,[b.z.Fax]:y.z.PHONE_TYPE_FAX,[b.z.Landline]:y.z.PHONE_TYPE_LANDLINE,[b.z.Mobile]:y.z.PHONE_TYPE_MOBILE,[b.z.WorkFax]:y.z.PHONE_TYPE_WORK_FAX,[b.z.WorkLandline]:y.z.PHONE_TYPE_WORK_LANDLINE,[b.z.WorkMobile]:y.z.PHONE_TYPE_WORK_MOBILE},T=e=>e?Date.parse(e)/1e3:null,I={[h.U.Address]:e=>({addressFull:e.streetName,addressName:e.itemName,linkedPhone:e.linkedPhoneId,...e}),[h.U.BankAccount]:e=>({...e,bank:e.bankCode,localeFormat:e.country||S.c.US,name:e.accountName,owner:e.ownerName}),[h.U.Company]:e=>({name:e.companyName,...e}),[h.U.Credential]:e=>({login:e.username,otpUrl:e.otpURL,otpSecret:e.otpSecret,secondaryLogin:e.alternativeUsername,title:e.itemName,url:e.URL,linkedWebsites:{addedByUser:e.linkedURLs},...e}),[h.U.DriversLicense]:e=>({...e,country:e.country??S.c.US,expirationDate:T(e.expirationDate),idNumber:e.idNumber??"",issueDate:T(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",state:e.state??""}),[h.U.Email]:e=>({email:e.emailAddress,emailName:e.itemName,...e}),[h.U.FiscalId]:e=>({...e,country:e.country??S.c.US,idNumber:e.fiscalNumber??"",spaceId:e.spaceId??"",teledeclarantNumber:e.teledeclarantNumber??""}),[h.U.IdCard]:e=>({...e,country:e.country??S.c.US,expirationDate:T(e.expirationDate),idNumber:e.idNumber??"",issueDate:T(e.issueDate),name:e.idName??"",spaceId:e.spaceId??""}),[h.U.Identity]:e=>({...e,title:e.title?w[e.title]:void 0}),[h.U.Passkey]:e=>({...e}),[h.U.Passport]:e=>({...e,country:e.country??S.c.US,expirationDate:T(e.expirationDate),idNumber:e.idNumber??"",issueDate:T(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",deliveryPlace:e.issuePlace??""}),[h.U.PaymentCard]:e=>({...e,cardName:e.itemName,color:e.color?E[e.color]:void 0,personalNote:e.note}),[h.U.Phone]:e=>({...e,phoneName:e.itemName,number:e.phoneNumber,type:e.type?C[e.type]:void 0}),[h.U.Secret]:e=>({...e,secured:e.isSecured}),[h.U.SecureNote]:e=>({...e}),[h.U.SocialSecurityId]:e=>({...e,country:e.country??S.c.US,idNumber:e.idNumber??"",name:e.idName??"",spaceId:e.spaceId??""}),[h.U.Website]:e=>({name:e.itemName,website:e.URL,...e})};class A{async execute({body:e}){const{vaultItemType:t,content:a,shouldSkipSync:s}=e;if([h.U.DriversLicense,h.U.FiscalId,h.U.IdCard,h.U.Passport,h.U.SocialSecurityId].includes(t))return this.createId(t,a);if(t===h.U.Passkey)return this.createPasskey(a);const{commands:r}=this.carbonLegacyClient,n=await r.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:t,origin:"MANUAL",content:I[t](a),shouldSkipSync:s}]});if((0,p.hx)(n))return this.handleError(t);const i=(0,p.db)(n).carbonResult;return this.handleSuccess(t,i.itemId)}handleError(e){return Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to create ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("created",{ids:[t],vaultItemType:e}),Promise.resolve((0,p.Vp)({id:t}))}async createId(e,t){const{commands:{addDriverLicense:a,addFiscalId:s,addIdCard:r,addPassport:n,addSocialSecurityId:i}}=this.carbonLegacyClient,o={[h.U.DriversLicense]:a,[h.U.FiscalId]:s,[h.U.IdCard]:r,[h.U.Passport]:n,[h.U.SocialSecurityId]:i},c=await o[e](I[e](t));return(0,p.hx)(c)?this.handleError(e):this.handleSuccess(e,(0,p.db)(c).id)}async createPasskey(e){const{commands:{addPasskey:t}}=this.carbonLegacyClient,a=await t(e);return(0,p.hx)(a)?this.handleError(h.U.Passkey):this.handleSuccess(h.U.Passkey,(0,p.db)(a).id)}constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}}A=(0,s.__decorate)([(0,u.W)(g._),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l])],A);var N=a(50756),U=a(56008),F=a(4174);class D{async execute({body:e}){const{vaultItemType:t,ids:a,ignoreSharing:s}=e,{commands:r}=this.carbonLegacyClient,n=[],i=a.map((e=>r.carbonLegacyLeeloo({name:"removePersonalDataItem",arg:[{id:e,ignoreSharing:!!s}]}).then((t=>{(0,p.d6)(t)&&n.push(e)}))));return await Promise.allSettled(i),n.length>0&&this.eventEmitter.sendEvent("deleted",{ids:n,vaultItemType:t}),await r.removeItemsFromCollections({ids:a}),n.length!==a.length?Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Error: Failed to delete all ${t}s`,failedDeletionIds:a.filter((e=>!n.includes(e)))})):(await this.syncClient.commands.sync({trigger:N.Trigger.Save}),Promise.resolve((0,p.Vp)(void 0)))}constructor(e,t,a){this.carbonLegacyClient=e,this.eventEmitter=t,this.syncClient=a}}D=(0,s.__decorate)([(0,u.W)(U.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l,void 0===F.Q?Object:F.Q])],D);var O=a(60399),P=a(55209),x=a(51424),R=a(87263),k=a(88981),L=a(35594),M=a(55920),j=a(91943),z=a(31108),V=a(54691),B=a(13134),K=a(2393),G=a(71860);class q{async execute({body:e}){const{vaultItemType:t,id:a,ignoreSharing:s=!1}=e,{notFound:r}=await this.vaultRepository.vaultItemsOfTypeExist([a],t);if(r.length>0)return this.anomalyReporter.commands.reportAnomaly({criticality:"critical",message:"Vault item to delete could not be found",moduleName:"VaultItemsCrudModule",useCaseName:"DeleteVaultItemCommand",applicationComponent:"",anomalyType:"other",additionalInfo:JSON.stringify({vaultItemType:t})}),(0,p.Rn)((0,R.sA)());if(!s&&(0,k.RP)(t))try{const e=await this.sharingItemsClient.commands.refuseSharedItemBeforeDeletion({vaultItemId:a});if((0,p.hx)(e))throw new Error("Unexpected failure returned by the sharing conditions check of the vault item to delete",{cause:{failure:(0,p.Yv)(e)}})}catch(e){throw new Error("Unexpected error occurred while handling sharing conditions of the vault item to delete",{cause:e})}const n=await this.carbonLegacyClient.commands.deleteVaultModuleItem({id:a,kwType:t});if((0,p.hx)(n))throw new Error("Unexpected failure trying to delete vault item of type from Carbon",{cause:{failure:(0,p.Yv)(n)}});const i=(0,p.db)(n);if(c=i,(0,P.K)(c)&&"success"in c&&!1===c.success&&"error"in c&&(0,P.K)(c.error)){const e=(e=>e.error)(i),a="reason"in(o=e)&&"string"==typeof o.reason?o.reason:null;if(a===x.z.NOT_FOUND)return this.anomalyReporter.commands.reportAnomaly({criticality:"warning",message:"Vault item to delete could not be found during Carbon deletion",moduleName:"VaultItemsCrudModule",useCaseName:"DeleteVaultItemCommand",applicationComponent:"",anomalyType:"other",additionalInfo:JSON.stringify({vaultItemType:t})}),(0,p.Rn)((0,R.sA)());throw new Error("Unexpected failure trying to delete vault item of type from Carbon",{cause:{vaultItemType:t,error:e,reason:a}})}var o,c;this.eventEmitter.sendEvent("deleted",{ids:[a],vaultItemType:t}),await this.carbonLegacyClient.commands.removeItemsFromCollections({ids:[a]}),await this.syncClient.commands.sync({trigger:N.Trigger.Save});if(t===h.U.Credential)try{const[e,t]=await Promise.all([(0,O.z)(this.teamPlanDetailsClient.queries.getTeamId()),this.vaultRepository.getCredential(a)]);if((0,p.d6)(e)&&(0,p.db)(e).teamId===t.SpaceId){const e=(0,K.Y)(M.z.UserDeletedCredential,M.p.VaultPasswords,{domain_url:new B.Y(t.Url).getRootDomain()});this.activityLogs.commands.storeActivityLogs({activityLogs:[e]})}}catch(e){this.anomalyReporter.commands.reportAnomaly({criticality:"critical",message:"Couldn't send activity log for credential deletion",moduleName:"VaultItemsCrudModule",useCaseName:"DeleteVaultItemCommand",applicationComponent:"",anomalyType:"other",additionalInfo:String(e)})}return(0,p.Vp)(void 0)}constructor(e,t,a,s,r,n,i,o){this.carbonLegacyClient=e,this.eventEmitter=t,this.syncClient=a,this.vaultRepository=s,this.sharingItemsClient=r,this.teamPlanDetailsClient=n,this.activityLogs=i,this.anomalyReporter=o}}q=(0,s.__decorate)([(0,u.W)(R.io),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l,void 0===F.Q?Object:F.Q,void 0===G.g?Object:G.g,void 0===L.s?Object:L.s,void 0===z.e?Object:z.e,void 0===j._?Object:j._,void 0===V.G?Object:V.G])],q);var $=a(5822);class Q{async execute({body:e}){const{content:t,id:a,vaultItemType:s,shouldSkipSync:r}=e;if([h.U.DriversLicense,h.U.FiscalId,h.U.IdCard,h.U.Passport,h.U.SocialSecurityId].includes(s))return this.updateId(s,t,a);if(s===h.U.Passkey)return this.updatePasskey(t,a);const{commands:n}=this.carbonLegacyClient,i=await n.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:s,origin:"MANUAL",content:{...I[s](t),id:a},shouldSkipSync:r}]});return(0,p.hx)(i)?Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to update ${s}`})):(this.eventEmitter.sendEvent("updated",{ids:[a],vaultItemType:s}),Promise.resolve((0,p.Vp)(void 0)))}handleError(e){return Promise.resolve((0,p.Rn)({tag:"error",errorMessage:`Failed to update ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("updated",{ids:[t],vaultItemType:e}),Promise.resolve((0,p.Vp)(void 0))}async updateId(e,t,a){const{commands:{editDriverLicense:s,editFiscalId:r,editIdCard:n,editPassport:i,editSocialSecurityId:o}}=this.carbonLegacyClient,c={[h.U.DriversLicense]:s,[h.U.FiscalId]:r,[h.U.IdCard]:n,[h.U.Passport]:i,[h.U.SocialSecurityId]:o},d=await c[e]({...I[e](t),id:a});return(0,p.hx)(d)?this.handleError(e):this.handleSuccess(e,a)}async updatePasskey(e,t){const{commands:{updatePasskey:a}}=this.carbonLegacyClient,s=await a({...e,id:t});return(0,p.hx)(s)?this.handleError(h.U.Passkey):this.handleSuccess(h.U.Passkey,t)}constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}}Q=(0,s.__decorate)([(0,u.W)($.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===l?Object:l])],Q);var H=a(44594);class W{execute({body:e}){const{ids:t,eventType:a}=e;return this.eventEmitter.sendEvent(a,{ids:t,vaultItemType:h.U.Credential}),Promise.resolve((0,p.Vp)(void 0))}constructor(e){this.eventEmitter=e}}W=(0,s.__decorate)([(0,u.W)(H.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l?Object:l])],W);var Y=a(46449),X=a(17049),Z=a(48844),J=a(52987),ee=a(96303),te=a(54066),ae=a(15531);class se{execute({body:{domain:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.iconsCache.domains"}).pipe((0,Z.Qn)((t=>{if(a=t,!ae.x.safeParse(a).success)throw new Error("Bad domain icons cache format");var a;return t.get((0,ee.k)(this.md5Hasher.compute((0,te.u)(e))))})))}constructor(e,t){this.carbonLegacyClient=e,this.md5Hasher=t}}se=(0,s.__decorate)([(0,Y.e)(X.s),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===J.f?Object:J.f])],se);var re=a(54676);class ne{execute({body:e}){return this.vaultRepository.fetchVaultItems$(e)}constructor(e){this.vaultRepository=e}}ne=(0,s.__decorate)([(0,Y.e)(re.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G.g?Object:G.g])],ne);var ie=a(95736);class oe{execute({body:{id:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.personalData.noteCategories"}).pipe((0,Z.Qn)((t=>{if(a=t,!Array.isArray(a)||0!==a.length&&"KWSecureNoteCategory"!==a[0].kwType)throw new Error("Bad secure note category format");var a;if(void 0===e)return t;const s=t.find((t=>t.Id===e))?.CategoryName;return s})))}constructor(e){this.carbonLegacyClient=e}}oe=(0,s.__decorate)([(0,Y.e)(ie.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._])],oe);var ce=a(96900),de=a(69326);const le=e=>{if(!e)return{richIconsEnabled:!0};const t=e;if(!(0,de.u)(t.spaces))return{richIconsEnabled:!0};const a=t.spaces.find((e=>"accepted"===e.status));return{richIconsEnabled:a?.info.richIconsEnabled??!0}};class ue{get(){const{getNodePremiumStatus:e}=this.carbon.queries;return e().pipe((0,Z.Qn)(le))}execute(){return this.get().pipe((0,Z.Qn)((e=>e.richIconsEnabled)))}constructor(e){this.carbon=e}}ue=(0,s.__decorate)([(0,Y.e)(ce.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._])],ue);class pe{}pe=(0,s.__decorate)([(0,r.Yl)({api:i.L,handlers:{commands:{createVaultItem:A,deleteVaultItems:D,deleteVaultItem:q,updateVaultItem:Q,emitTemporaryVaultItemEvent:W},events:{},queries:{domainIconDetails:se,query:ne,secureNoteCategory:oe,richIconsEnabled:ue}},imports:[n.D],providers:[l,G.g],requiredFeatureFlips:Object.values(o.j),domainName:"vault"})],pe)},14186:(e,t,a)=>{a.d(t,{K:()=>S});var s=a(491),r=a(86006),n=a(53234),i=a(63144),o=a(56618),c=a(62149),d=a(10722);const l=e=>!(!e||"object"!=typeof e)&&"isCollectionGuidedIntroEnabled"in e,u={isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1};class p extends((0,i.Q)({persist:!0,storage:{initialValue:u,typeGuard:l,schemaVersion:2,migrateStorageSchema:()=>({isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1})},scope:c.F.User,storeName:"vault-notifications",capacity:o.Y._001KB,codec:d.E})){}var m=a(82874),h=a(87279),g=a(67304);class v{async execute({body:e}){const{notificationName:t,isEnabled:a}=e;try{const e=await this.store.getState();return await this.store.set({...e,[t]:a}),(0,h.Vp)(void 0)}catch{throw new Error("SetVaultNotificationsStatus command from vault-core failed")}}constructor(e){this.store=e}}v=(0,s.__decorate)([(0,m.W)(g.x),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p])],v);var y=a(87065),f=a(46449),_=a(71524);class b{execute(){return this.store.state$.pipe((0,y.U)(h.Vp))}constructor(e){this.store=e}}b=(0,s.__decorate)([(0,f.e)(_.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p])],b);class S{}S=(0,s.__decorate)([(0,r.Yl)({api:n.e,handlers:{commands:{setVaultNotificationsStatus:v},events:{},queries:{getVaultNotificationsStatus:b}},stores:[p]})],S)},94587:(e,t,a)=>{a.d(t,{H:()=>L});var s=a(491),r=a(86006),n=a(96124),i=a(62149),o=a(63144),c=a(56618),d=a(10722);const l=e=>!0;class u extends((0,o.Q)({persist:!0,scope:i.F.Device,storeName:"collections-store",storeTypeGuard:l,capacity:c.Y._001KB,codec:d.E,storage:{schemaVersion:3,initialValue:{isCredentialCategoriesMigrated:{}},typeGuard:l,migrateStorageSchema:()=>({isCredentialCategoriesMigrated:{}})}})){}var p=a(60399),m=a(38644),h=a(82874),g=a(14122),v=a(87279),y=a(50756),f=a(55920),_=a(91943),b=a(48844);const S=e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&"string"==typeof t.Name&&Array.isArray(t.VaultItems)})));function w(e,t){const{queries:{carbonState:a}}=e;return a({path:"userSession.personalData.collections"}).pipe((0,b.Qn)((e=>{if(!S(e))throw new Error("Collection array has a wrong format");return{collections:(t&&t.length>0?e.filter((e=>t.includes(e.Id))):e).map((e=>({id:e.Id,name:e.Name,spaceId:e.SpaceId??"",vaultItems:e.VaultItems.map((e=>({id:e.Id,type:e.Type})))})))}})))}function E(e,t,a,s){const r=new y.UserUpdateCollectionEvent({collectionId:a,action:t,itemCount:s,isShared:!1});return e.commands.carbon({name:"logEvent",args:[{event:r}]})}var C=a(2393);class T{async execute({body:e}){const{id:t,name:a=""}=e,s=await(0,p.z)(w(this.carbonLegacyClient,[t]));if((0,v.hx)(s))throw new Error(`Failed to fetch additional collection info: ${s.error}`);const r=await this.carbonLegacyClient.commands.carbon({name:"deleteCollection",args:[{id:t}]});if((0,v.hx)(r))throw new Error(`Failed to delete collection: ${r.error}`);E(this.carbonLegacyClient,y.CollectionAction.Delete,t,s.data.collections[0]?.vaultItems?.length);const n={collection_name:a},i=(0,C.Y)(f.z.UserDeletedCollection,f.p.VaultCollections,n);return this.activityLogs.commands.storeActivityLogs({activityLogs:[i]}),Promise.resolve((0,v.Vp)(void 0))}constructor(e,t){this.carbonLegacyClient=e,this.activityLogs=t}}T=(0,s.__decorate)([(0,h.W)(m.T),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._,void 0===_._?Object:_._])],T);var I=a(95569),A=a(28489);class N{async execute({body:e}){const{content:{name:t,spaceId:a="",vaultItems:s=[]}}=e,r=await this.carbonLegacy.commands.carbon({name:"addCollection",args:[{name:t,spaceId:a,vaultItems:s}]});if((0,v.hx)(r))throw new Error(`Failed to create collection: ${r.error}`);if("object"!=typeof(n=r.data.carbonResult)||null===n||!(0,A.l$)(n,"id")||"string"!=typeof n.id||!(0,A.l$)(n,"success")||"boolean"!=typeof n.success)throw new Error("Failed to find created collection id");var n;if(a){const e=[(0,C.Y)(f.z.UserCreatedCollection,f.p.VaultCollections,{collection_name:t})];this.activityLogs.commands.storeActivityLogs({activityLogs:e})}return E(this.carbonLegacy,y.CollectionAction.Add,r.data.carbonResult.id,s.length),s.length&&E(this.carbonLegacy,y.CollectionAction.AddCredential,r.data.carbonResult.id,s.length),(0,v.Vp)({id:r.data.id})}constructor(e,t){this.activityLogs=e,this.activityLogs=e,this.carbonLegacy=t}}N=(0,s.__decorate)([(0,h.W)(I.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_._?Object:_._,void 0===g._?Object:g._])],N);var U=a(86342),F=a(39431),D=a(50879),O=a(13134);class P{async execute({body:e}){const{id:t,collection:a,operationType:s=U.C.APPEND_VAULT_ITEMS}=e,r=await(0,p.z)(w(this.carbonLegacyClient,[t]));if((0,v.hx)(r))throw new Error(`Failed to fetch additional collection info: ${r.error}`);const n=r.data.collections[0];let i;if(a.vaultItems){const e=await(0,p.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[F.U.Credential,F.U.SecureNote],ids:a.vaultItems.map((e=>e.id))}));if((0,v.hx)(e))throw new Error("Unable to find items in collection");const t=e.data.credentialsResult.items,r=e.data.secureNotesResult.items,o=[...t.map((e=>({id:e.id,type:F.U.Credential,url:e.URL}))),...r.map((e=>({id:e.id,type:F.U.SecureNote})))];i={id:a.id,name:a.name,spaceId:a.spaceId,vaultItems:o},n.vaultItems=this.mutateCollectionVaultItems(n,s,o)}else i={id:a.id,name:a.name,spaceId:a.spaceId};const o=await this.carbonLegacyClient.commands.carbon({name:"updateCollection",args:[{id:n.id,name:a.name??n.name,spaceId:a.spaceId??n.spaceId,vaultItems:n.vaultItems}]});if((0,v.hx)(o))throw new Error(`Failed to update collection: ${o.error}`);return this.handleLogs(n,i,s),Promise.resolve((0,v.Vp)(void 0))}handleLogs(e,t,a){let s=null;const r={};if(t.name&&(E(this.carbonLegacyClient,y.CollectionAction.Edit,e.id,e.vaultItems.length),t.name!==e.name&&(s=f.z.UserRenamedCollection,r.collection_name=t.name,r.old_collection_name=e.name)),t.vaultItems&&(E(this.carbonLegacyClient,a===U.C.SUBSTRACT_VAULT_ITEMS?y.CollectionAction.DeleteCredential:y.CollectionAction.AddCredential,e.id,1),t.vaultItems[0]?.type===F.U.Credential&&(s=a===U.C.APPEND_VAULT_ITEMS?f.z.UserAddedCredentialToCollection:f.z.UserRemovedCredentialFromCollection,r.collection_name=e.name,r.domain_url=new O.Y(t.vaultItems[0].url).getRootDomain())),e.spaceId&&s){const e=(0,C.Y)(s,f.p.VaultCollections,r);this.activityLogs.commands.storeActivityLogs({activityLogs:[e]})}}getDeduplicatedList(e){return[...new Map(e.map((e=>[e.id,e]))).values()]}mutateCollectionVaultItems(e,t,a){return t===U.C.SUBSTRACT_VAULT_ITEMS?e.vaultItems.filter((e=>!a.some((t=>t.id===e.id)))):this.getDeduplicatedList([...e.vaultItems,...a])}constructor(e,t,a){this.carbonLegacyClient=e,this.activityLogs=t,this.vaultItemsCrudClient=a}}P=(0,s.__decorate)([(0,h.W)(U.s),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._,void 0===_._?Object:_._,void 0===D.L?Object:D.L])],P);var x=a(42645),R=a(46449);class k{execute({body:e}){const{ids:t}=e;return w(this.carbonLegacyClient,t)}constructor(e){this.carbonLegacyClient=e}}k=(0,s.__decorate)([(0,R.e)(x.I),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g._?Object:g._])],k);class L{}L=(0,s.__decorate)([(0,r.Yl)({api:n.v,stores:[u],handlers:{commands:{deleteCollection:T,createCollection:N,updateCollection:P},events:{},queries:{queryCollections:k}},requiredFeatureFlips:["vault_web_collection_migration_space_prod_v2","vault_web_popupSavedState_release","sharingVault_web_bulkaddtocollection_dev"]})],L)},2393:(e,t,a)=>{a.d(t,{Y:()=>s});const s=(e,t,a)=>({log_type:e,category:t,date_time:(new Date).getTime(),schema_version:"1.0.0",is_sensitive:!0,uuid:crypto.randomUUID().toUpperCase(),properties:a})},69326:(e,t,a)=>{a.d(t,{u:()=>s});const s=e=>function(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const a=e[0];for(let e=0;e<t.length;e++){const s=t[e];if(!Object.prototype.hasOwnProperty.call(a,s))return!1}return!0}(e,["teamId"])},71860:(e,t,a)=>{a.d(t,{g:()=>ve});var s=a(491),r=a(85390),n=a(87065),i=a(69885),o=a(43978),c=a(6136),d=a(60399),l=a(92587),u=a(87279),p=a(48844),m=a(14122),h=a(29289),g=a(39431),v=a(87263),y=a(52402),f=a(92481);function _(e,t){return e in t}function b(e){const t={};for(const a in e)t[a.charAt(0).toLowerCase()+a.slice(1)]=e[a];return t}const S=e=>{if(!e||3!==e.split("-").length)return"";const t=e.split("-"),a=Number(t[0]),s=Number(t[1])-1,r=Number(t[2]);return(0,f.Z)(new Date(a,s,r),"yyyy-MM-dd")};function w(e,t,a){return t||a?e.filter((e=>!(t&&!t.every((t=>_(t.property,e)&&function(e,t,a=y.l.Equal){return{[y.l.Equal]:()=>e===t,[y.l.LessThan]:()=>e<t,[y.l.GreaterThan]:()=>e>t}[a]()}(e[t.property],t.value,t.operator))))&&(a?.(e)??!0))):e}var E=a(93314);function C(e,t){if(!t||!e.length||!_(t.property,e[0]))return e;const a=t.property,s=t.direction||E.S.Ascend;return e.sort(((e,t)=>{const r=e[a],n=t[a];return r||n?r?n?function(e,t,a){const s=Number(e),r=Number(t);return"string"==typeof e&&"string"==typeof t?a===E.S.Ascend?e.localeCompare(t):t.localeCompare(e):"number"==typeof e&&"number"==typeof t?a===E.S.Ascend?e-t:t-e:isNaN(s)||isNaN(r)?0:a===E.S.Ascend?s-r:r-s}(r,n,s):s===E.S.Ascend?1:-1:s===E.S.Ascend?-1:1:0}))}function T(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;return e[0].kwType===t}const I=e=>T(e,g.U.Secret),A=e=>{const{LocaleFormat:t,Secured:a,...s}=e;return{...b(s),isSecured:a}};var N=a(81813);const U=e=>T(e,g.U.Credential),F=e=>T(e,g.U.Address),D=e=>T(e,g.U.Company),O=e=>T(e,g.U.Email),P=e=>T(e,g.U.Identity),x=e=>T(e,g.U.Phone),R=e=>T(e,g.U.Website);var k=a(69326);const L=e=>{const{AddressName:t,LinkedPhone:a,StreetName:s,AddressFull:r,StateLevel2:n,...i}=e;return{...b(i),itemName:t,linkedPhoneId:a,streetName:s||r}},M=e=>T(e,g.U.BankAccount),j=e=>{const{BankAccountName:t,BankAccountOwner:a,BankAccountIBAN:s,BankAccountBIC:r,BankAccountBank:n,...i}=e,o=n?.split("-"),c=o?.length>1?o[1]??n:n;return{...b(i),accountName:t,bankCode:c||"",BIC:r,country:i.LocaleFormat,IBAN:s,ownerName:a}},z=e=>{const{Name:t,PersonalNote:a,LocaleFormat:s,...r}=e;return{...b(r),companyName:t}},V=e=>{const{CreationDatetime:t,Email:a,Id:s,LastBackupTime:r,LastUse:n,LinkedServices:i,Login:o,Note:c,OtpSecret:d,OtpUrl:l,Password:u,SecondaryLogin:p,SpaceId:m,Title:h,Url:g,UserModificationDatetime:v,UserSelectedUrl:y,kwType:f}=e;return{...b({CreationDatetime:t,Email:a,Id:s,LastBackupTime:r,LastUse:n,Note:c,Password:u,SpaceId:m,UserModificationDatetime:v}),alternativeUsername:p,itemName:h??"",linkedURLs:i?.associated_domains.map((e=>e.domain))??[],kwType:f,otpURL:l,otpSecret:d,URL:g||y||"",username:o}},B=e=>T(e,g.U.DriversLicense),K=e=>T(e,g.U.FiscalId),G=e=>T(e,g.U.IdCard),q=e=>T(e,g.U.Passport),$=e=>T(e,g.U.SocialSecurityId),Q=e=>e?[e.FirstName,e.MiddleName,e.LastName,e.LastName2].filter(Boolean).join(" "):"",H=(e,t)=>{const{DeliveryDate:a,ExpireDate:s,Fullname:r,Number:n,DateOfBirth:i,Sex:o,...c}=e;return{...b(c),idName:Q(t)||r||"",idNumber:n,issueDate:S(a),expirationDate:S(s),country:c.LocaleFormat}},W=e=>{const{EmailName:t,Email:a,Type:s,LocaleFormat:r,...n}=e;return{...b(n),itemName:t,emailAddress:a,type:s}},Y=e=>{const{kwType:t}=e;return{...b(e),kwType:t,country:e.LocaleFormat}},X=(e,t)=>{const{DateOfBirth:a,DeliveryDate:s,ExpireDate:r,Fullname:n,Number:i,Sex:o,...c}=e;return{...b(c),idName:Q(t)||n||"",idNumber:i,issueDate:S(s),expirationDate:S(r),country:c.LocaleFormat}};var Z=a(26311);const J={"":void 0,MR:Z.t.Mr,MME:Z.t.Mrs,MLLE:Z.t.Miss,MS:Z.t.Ms,MX:Z.t.Mx,NONE_OF_THESE:Z.t.NoneOfThese},ee=e=>{const{Title:t,LocaleFormat:a,...s}=e;return{...b(s),title:J[t]}},te=e=>T(e,g.U.Passkey),ae=(e,t)=>{const{DeliveryDate:a,DeliveryPlace:s,ExpireDate:r,Fullname:n,Number:i,DateOfBirth:o,Sex:c,...d}=e;return{...b(d),idName:Q(t)||n||"",idNumber:i||"",issueDate:S(a),issuePlace:s||"",expirationDate:S(r),country:d.LocaleFormat}},se=e=>T(e,g.U.PaymentCard);var re=a(53214);const ne={BLACK:re.X.Black,BLUE_1:re.X.Blue1,BLUE_2:re.X.Blue2,GOLD:re.X.Gold,GREEN_1:re.X.Green1,GREEN_2:re.X.Green2,ORANGE:re.X.Orange,RED:re.X.Red,SILVER:re.X.Silver,WHITE:re.X.White},ie=e=>{const{Name:t,CCNote:a,Color:s,Bank:r,CardNumberLastDigits:n,IssueNumber:i,StartMonth:o,StartYear:c,Type:d,LocaleFormat:l,...u}=e;return{...b(u),itemName:t,color:ne[s],note:a||""}};var oe=a(90294),ce=a(7325);const de={[oe.z.PHONE_TYPE_ANY]:ce.z.Any,[oe.z.PHONE_TYPE_FAX]:ce.z.Fax,[oe.z.PHONE_TYPE_LANDLINE]:ce.z.Landline,[oe.z.PHONE_TYPE_MOBILE]:ce.z.Mobile,[oe.z.PHONE_TYPE_WORK_FAX]:ce.z.WorkFax,[oe.z.PHONE_TYPE_WORK_LANDLINE]:ce.z.WorkLandline,[oe.z.PHONE_TYPE_WORK_MOBILE]:ce.z.WorkMobile},le=e=>{const{PhoneName:t,Number:a,Type:s,...r}=e;return{...b(r),itemName:t,phoneNumber:a,type:de[s]}},ue=e=>T(e,g.U.SecureNote);var pe=a(30581);const me=e=>{const{Secured:t,Type:a,Category:s,LocaleFormat:r,...n}=e;return{...b(n),categoryId:s,isSecured:t,color:pe.L[a]||pe.L.GRAY}},he=(e,t)=>{const{DateOfBirth:a,LinkedIdentity:s,Sex:r,SocialSecurityFullname:n,SocialSecurityNumber:i,...o}=e;return{...b(o),idName:Q(t)||n||"",idNumber:i,country:o.LocaleFormat}},ge=e=>{const{Website:t,Name:a,PersonalNote:s,LocaleFormat:r,...n}=e;return{...b(n),itemName:a,URL:t}};class ve{initializeVaultItemsQueryParams(e){const{ids:t,pageSize:a,pageNumber:s,propertyFilters:r,propertySorting:n}=e;this.ids=t,this.propertyFilters=r,this.propertySorting=n,this.pageSize=a,this.pageNumber=s}fetchVaultItems$(e,t,a){const{vaultItemTypes:s,...i}=e;this.initializeVaultItemsQueryParams(i),this.additionalFilterFunc=t,this.needDashlaneLinkedWebsites=a;const o=(0,r.a)(s.map((e=>this.getVaultItems$TypeDictionary[e]()))),c=this.getEmptyVaultItemsQueryResult();return o.pipe((0,n.U)((e=>(e.forEach((e=>{if("failure"===e.tag)throw new Error("Error while fetching vault items");Object.assign(c,e.data)})),(0,u.Vp)(c)))))}getDashlaneDefinedLinkedWebsites$(e){if((0,u.d6)(e)&&U(e.data)&&this.needDashlaneLinkedWebsites){const t=e.data,a=t.map((({URL:e})=>e));return this.linkedWebsitesClient.queries.getMultipleDashlaneDefinedLinkedWebsites({urls:a}).pipe((0,p.Qn)((e=>t.map(((t,a)=>({...t,linkedURLs:[...t.linkedURLs,...e[a]]}))))))}return(0,i.of)(e)}getTypePath(e){return e.replace("Result","")}getVaultItems$(e,t,a,s){return s=s??this.getTypePath(e),(0,r.a)([this.getCarbonVaultItems$(e,t,s),this.getCarbonVaultItems$(h.N[g.U.Identity],P,this.getTypePath(h.N[g.U.Identity])),this.getQuarantinedSpacesTeamIds$()],((e,t,s)=>(0,u.Vp)(function(e,t,a,s,r){return e.flatMap((e=>{if(a.includes(e.SpaceId)||r&&!r.some((t=>t.toUpperCase()===e.Id.toUpperCase())))return[];e.LastUse||(e.LastUse=-1);const n=e.LinkedIdentity?t.find((t=>t.Id===e.LinkedIdentity)):void 0;return s(e,n)}))}(e,t,s,a,this.ids)))).pipe((0,o.w)(this.getDashlaneDefinedLinkedWebsites$.bind(this)),(0,p.Qn)((t=>{const a=C(w(t,this.propertyFilters,this.additionalFilterFunc),this.propertySorting);return{[e]:{items:this.getPage(a),matchCount:a.length}}})))}getPage(e){return this.pageNumber&&this.pageSize?e.slice(this.pageSize*(this.pageNumber-1),this.pageSize*this.pageNumber):e}getCarbonVaultItems$(e,t,a){const{queries:{carbonState:s}}=this.carbonLegacyClient;return s({path:`userSession.personalData.${a}`}).pipe((0,n.U)((a=>{if((0,u.hx)(a)||!t(a.data))throw new Error(`Bad ${e} format`);return a.data})))}getQuarantinedSpacesTeamIds$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.spaceData.spaces"}).pipe((0,n.U)((e=>{if((0,u.hx)(e)||!(0,k.u)(e.data))throw new Error("Bad spaces format");return e.data.filter((e=>this.isPremiumStatusSpaceQuarantined(e.details)))})),(0,n.U)((e=>e.map((e=>e.teamId)).sort())),(0,c.x)(((e,t)=>JSON.stringify(e)!==JSON.stringify(t))))}isPremiumStatusSpaceQuarantined(e){return"accepted"!==e.status.toLowerCase()&&Boolean(e.info.removeForcedContentEnabled)}async shouldRefuseSharedItemBeforeVaultItemDeletion(e,t){const a=t,s=await(0,d.z)(e.queries.getSharingStatusForItem({itemId:a}));if((0,u.hx)(s))throw new Error("Unexpected failure while attempting to retrieve sharing status of item to be deleted",{cause:{failure:(0,u.Yv)(s)}});const{isSharedViaUserGroup:r,isShared:n}=(0,u.db)(s);if(!n)return(0,u.Vp)(!1);if(r)return(0,u.Rn)((0,v.Vf)());const i=await(0,d.z)(e.queries.getIsLastAdminForItem({itemId:a}));if((0,u.hx)(i))throw new Error("Unexpected failure while attempting to determine if we're the last admin of shared item to be deleted",{cause:{failure:(0,u.Yv)(i)}});const{isLastAdmin:o}=(0,u.db)(i);return o?(0,u.Rn)((0,v.V$)()):(0,u.Vp)(!0)}constructor(e,t){this.carbonLegacyClient=e,this.linkedWebsitesClient=t,this.getVaultItems$TypeDictionary={[g.U.Address]:()=>this.getVaultItems$(h.N[g.U.Address],F,L),[g.U.BankAccount]:()=>this.getVaultItems$(h.N[g.U.BankAccount],M,j),[g.U.Company]:()=>this.getVaultItems$(h.N[g.U.Company],D,z),[g.U.Credential]:()=>this.getVaultItems$(h.N[g.U.Credential],U,V),[g.U.DriversLicense]:()=>this.getVaultItems$(h.N[g.U.DriversLicense],B,H,"driverLicenses"),[g.U.Email]:()=>this.getVaultItems$(h.N[g.U.Email],O,W),[g.U.FiscalId]:()=>this.getVaultItems$(h.N[g.U.FiscalId],K,Y),[g.U.IdCard]:()=>this.getVaultItems$(h.N[g.U.IdCard],G,X),[g.U.Identity]:()=>this.getVaultItems$(h.N[g.U.Identity],P,ee),[g.U.Passkey]:()=>this.getVaultItems$(h.N[g.U.Passkey],te,b),[g.U.Passport]:()=>this.getVaultItems$(h.N[g.U.Passport],q,ae),[g.U.PaymentCard]:()=>this.getVaultItems$(h.N[g.U.PaymentCard],se,ie),[g.U.Phone]:()=>this.getVaultItems$(h.N[g.U.Phone],x,le),[g.U.Secret]:()=>this.getVaultItems$(h.N[g.U.Secret],I,A),[g.U.SecureNote]:()=>this.getVaultItems$(h.N[g.U.SecureNote],ue,me,"notes"),[g.U.SocialSecurityId]:()=>this.getVaultItems$(h.N[g.U.SocialSecurityId],$,he),[g.U.Website]:()=>this.getVaultItems$(h.N[g.U.Website],R,ge,"personalWebsites")},this.getEmptyVaultItemsQueryResult=()=>({addressesResult:this.getEmptyItemsQueryResult(),bankAccountsResult:this.getEmptyItemsQueryResult(),companiesResult:this.getEmptyItemsQueryResult(),credentialsResult:this.getEmptyItemsQueryResult(),driversLicensesResult:this.getEmptyItemsQueryResult(),emailsResult:this.getEmptyItemsQueryResult(),fiscalIdsResult:this.getEmptyItemsQueryResult(),idCardsResult:this.getEmptyItemsQueryResult(),identitiesResult:this.getEmptyItemsQueryResult(),passkeysResult:this.getEmptyItemsQueryResult(),passportsResult:this.getEmptyItemsQueryResult(),paymentCardsResult:this.getEmptyItemsQueryResult(),phonesResult:this.getEmptyItemsQueryResult(),secretsResult:this.getEmptyItemsQueryResult(),secureNotesResult:this.getEmptyItemsQueryResult(),socialSecurityIdsResult:this.getEmptyItemsQueryResult(),websitesResult:this.getEmptyItemsQueryResult()}),this.getEmptyItemsQueryResult=()=>({items:[],matchCount:0}),this.vaultItemsOfTypeExist=async(e,t)=>{const a=h.N[t],s=this.getTypePath(a),{queries:{carbonState:r}}=this.carbonLegacyClient;return(0,d.z)(r({path:`userSession.personalData.${s}`}).pipe((0,n.U)((t=>{if((0,u.hx)(t)||!Array.isArray(t.data))throw new Error(`Unexpected error fetching vault item for ${a}`);const s=[],r=[];for(const a of e)t.data.some((e=>e.Id===a))?s.push(a):r.push(a);return{found:s,notFound:r}}))))},this.getCredential=async e=>{const t=this.getTypePath("credentialsResult"),{queries:{carbonState:a}}=this.carbonLegacyClient;return(0,d.z)(a({path:`userSession.personalData.${t}`}).pipe((0,n.U)((t=>{if((0,u.hx)(t)||!U(t.data))throw new Error("Unexpected error fetching credential");const a=t.data.find((t=>t.Id===e));if(!a)throw new Error("Credential not found in vault");return a}))))}}}ve=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===N.X?Object:N.X])],ve)},72600:(e,t,a)=>{a.d(t,{U:()=>b});var s=a(491),r=a(86006),n=a(20281),i=a(85390),o=a(43978),c=a(87065),d=a(46449),l=a(87279),u=a(20980),p=a(39431),m=a(352),h=a(77802),g=a(71860);class v{execute({body:{vaultItemTypes:e,searchQuery:t,needDashlaneLinkedWebsites:a=!1,...s}}){this.searchQuery=t;const{queries:{queryCollections:r}}=this.vaultOrganizationClient,{queries:{sharedCollectionsWithItems:n}}=this.sharingCollectionsClient;return(0,i.a)([r({}),n()]).pipe((0,o.w)((([t,r])=>{if((0,l.hx)(t)||(0,l.hx)(r))throw new Error("Error querying collections");this.collections=t.data.collections.concat(r.data);const n=e??Object.values(p.U);return this.vaultRepository.fetchVaultItems$({vaultItemTypes:n,...s},this.isVaultItemMatch,a)})),(0,c.U)((t=>{if((0,l.hx)(t))throw new Error("Error");const a=t.data;let s;if(e)s={items:[],matchCount:0};else{const e=this.collections.filter((e=>this.isMatch(e)));s={items:e,matchCount:e.length}}return(0,l.Vp)({...a,collectionsResult:s})})))}isMatch(e,t=""){return t+=Object.values(e).filter((e=>"object"!=typeof e||Array.isArray(e))).map((e=>Array.isArray(e)?e.toString():e)).join(this.separator),this.normalizeString(t).includes(this.normalizeString(this.searchQuery))}constructor(e,t,a){this.vaultRepository=e,this.vaultOrganizationClient=t,this.sharingCollectionsClient=a,this.separator=",",this.collections=[],this.searchQuery="",this.normalizeString=e=>"string"!=typeof e?"":e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),this.isVaultItemMatch=e=>{let t="";return this.collections.forEach((a=>{a.vaultItems.some((t=>t.id===e.id))&&(t+=`${a.name}${this.separator}`)})),this.isMatch(e,t)}}}v=(0,s.__decorate)([(0,d.e)(m.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g.g?Object:g.g,void 0===h.C?Object:h.C,void 0===u.L?Object:u.L])],v);var y=a(88846),f=a(69885);class _{execute({body:e}){const{vaultItemTypes:t,searchQuery:a,pageSize:s,pageNumber:r,...n}=e;if(this.searchQuery=a,!a)return(0,f.of)((0,l.Vp)({items:[],matchCount:0}));const{queries:{queryCollections:d}}=this.vaultOrganizationClient,{queries:{sharedCollectionsWithItems:u}}=this.sharingCollectionsClient;return(0,i.a)([d({}),u()]).pipe((0,o.w)((([e,a])=>{if((0,l.hx)(e)||(0,l.hx)(a))throw new Error("Error querying collections");this.collections=e.data.collections.concat(a.data);const s=t??Object.values(p.U);return this.vaultRepository.fetchVaultItems$({vaultItemTypes:s,...n})})),(0,c.U)((e=>{if((0,l.hx)(e))throw new Error("Error");const t=e.data,a=[],n={collectionsResult:{items:this.collections,matchCount:this.collections.length},...t};Object.keys(n).forEach((e=>{const t=e;n[t].items.forEach((e=>{const s=this.getPrimarySearchFields(t),r=this.getSecondarySearchFields(t),n=this.searchStartsWith(e,this.searchQuery,s),i=n||this.searchStartsWith(e,this.searchQuery,r),o=!(!n&&!i)||this.searchContains(e,this.searchQuery,s),c=!!(n||i||o)||this.searchContains(e,this.searchQuery,r),d=this.calculatePriority(n,o,i,c,t);d&&a.push({item:e,priority:d})}))}),[]);const i=a.length;let o=a.sort(((e,t)=>Number(t.priority)-Number(e.priority))).map((({item:e})=>e));return s&&r&&(o=o.slice(s*(r-1),s*r)),(0,l.Vp)({items:o,matchCount:i})})))}constructor(e,t,a){this.vaultRepository=e,this.vaultOrganizationClient=t,this.sharingCollectionsClient=a,this.collections=[],this.searchQuery="",this.getPrimarySearchFields=e=>{switch(e){case"addressesResult":case"credentialsResult":case"emailsResult":case"passkeysResult":case"paymentCardsResult":case"phonesResult":case"websitesResult":return["itemName"];case"bankAccountsResult":return["accountName"];case"companiesResult":return["companyName"];case"driversLicensesResult":case"idCardsResult":case"passportsResult":case"socialSecurityIdsResult":return["idName"];case"fiscalIdsResult":return["fiscalNumber"];case"identitiesResult":return["fullName"];case"secretsResult":case"secureNotesResult":return["title"];case"collectionsResult":return["name"];default:return[]}},this.getSecondarySearchFields=e=>{switch(e){case"addressesResult":return["building","city","door","floor","streetName","zipCode"];case"bankAccountsResult":return["ownerName","bankCode"];case"companiesResult":return["jobTitle"];case"credentialsResult":return["email","username","URL","linkedURLs","note","alternativeUsername"];case"driversLicensesResult":case"fiscalIdsResult":case"idCardsResult":case"collectionsResult":default:return[];case"emailsResult":return["emailAddress"];case"identitiesResult":return["firstName","middleName","lastName","pseudo"];case"passkeysResult":return["userDisplayName","rpName","note"];case"passportsResult":case"socialSecurityIdsResult":return["idNumber"];case"paymentCardsResult":return["ownerName","note","cardNumber"];case"phonesResult":return["phoneNumber"];case"secretsResult":case"secureNotesResult":return["content"];case"websitesResult":return["URL"]}},this.getItemTypePriority=e=>{switch(e){case"passkeysResult":return"01";case"phonesResult":return"02";case"websitesResult":return"03";case"identitiesResult":return"04";case"emailsResult":return"05";case"companiesResult":return"06";case"addressesResult":return"07";case"socialSecurityIdsResult":return"08";case"passportsResult":return"09";case"idCardsResult":return"10";case"fiscalIdsResult":return"11";case"driversLicensesResult":return"12";case"paymentCardsResult":return"13";case"bankAccountsResult":return"14";case"collectionsResult":return"15";case"secretsResult":return"16";case"secureNotesResult":return"17";case"credentialsResult":return"18";default:return"00"}},this.calculatePriority=(e,t,a,s,r)=>e||t||a||s?`${Number(e)}${Number(t)}${Number(a)}${Number(s)}${this.getItemTypePriority(r)}`:null,this.normalizeString=e=>"string"!=typeof e?"":e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),this.searchStartsWith=(e,t,a)=>{for(const s of a){if(this.normalizeString(e[s]?.toString()??"").startsWith(this.normalizeString(t)))return!0}return!1},this.searchContains=(e,t,a)=>{let s="";for(const t of a){const a=e[t];s+=this.normalizeString(a?.toString()??"")}return s.includes(this.normalizeString(t))}}}_=(0,s.__decorate)([(0,d.e)(y.$),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g.g?Object:g.g,void 0===h.C?Object:h.C,void 0===u.L?Object:u.L])],_);class b{}b=(0,s.__decorate)([(0,r.Yl)({api:n.R,handlers:{commands:{},events:{},queries:{search:v,vaultSearchRanked:_}},providers:[g.g]})],b)},57842:(e,t,a)=>{a.d(t,{z:()=>c});var s=a(75958),r=a(90717),n=a(41453),i=a(3090),o=a(19186);const c=(0,s.Q)({name:"vpnNotifications",commands:{markVpnProviderSeen:r.M,markInstallVpnSeen:n.b},events:{},queries:{hasSeenVpnProvider:i.D,hasSeenInstallVpn:o.w}})},41453:(e,t,a)=>{a.d(t,{b:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},90717:(e,t,a)=>{a.d(t,{M:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.User})){}},19186:(e,t,a)=>{a.d(t,{w:()=>r});var s=a(77535);class r extends((0,s.k)()){}},3090:(e,t,a)=>{a.d(t,{D:()=>r});var s=a(77535);class r extends((0,s.k)()){}},19813:(e,t,a)=>{a.d(t,{u:()=>A});var s,r=a(491),n=a(86006),i=a(57842),o=a(62149),c=a(63144),d=a(56618),l=a(10722),u=a(7165);!function(e){e.VpnProvider="vpnProvider",e.InstallVpn="installVpn"}(s||(s={}));const p=u.z.object({notifications:u.z.record(u.z.nativeEnum(s),u.z.boolean())}),m=e=>p.safeParse(e).success;class h extends((0,c.Q)({storage:{schemaVersion:1,initialValue:{notifications:{vpnProvider:!1,installVpn:!1}},typeGuard:m},persist:!0,scope:o.F.User,storeName:"vpn-notifications-store",capacity:d.Y._010KB,codec:l.E})){}var g=a(82874),v=a(87279),y=a(90717);class f{async execute(){const e=await this.store.getState(),t={...e.notifications,vpnProvider:!0};return await this.store.set({...e,notifications:t}),(0,v.Vp)(void 0)}constructor(e){this.store=e}}f=(0,r.__decorate)([(0,g.W)(y.M),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===h?Object:h])],f);var _=a(41453);class b{async execute(){const e=await this.store.getState(),t={...e.notifications,installVpn:!0};return await this.store.set({...e,notifications:t}),(0,v.Vp)(void 0)}constructor(e){this.store=e}}b=(0,r.__decorate)([(0,g.W)(_.b),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===h?Object:h])],b);var S=a(87065),w=a(46449),E=a(3090);class C{execute(){return this.store.state$.pipe((0,S.U)((e=>(0,v.Vp)(!!e.notifications.vpnProvider))))}constructor(e){this.store=e}}C=(0,r.__decorate)([(0,w.e)(E.D),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===h?Object:h])],C);var T=a(19186);class I{execute(){return this.store.state$.pipe((0,S.U)((e=>(0,v.Vp)(!!e.notifications.installVpn))))}constructor(e){this.store=e}}I=(0,r.__decorate)([(0,w.e)(T.w),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===h?Object:h])],I);class A{}A=(0,r.__decorate)([(0,n.Yl)({api:i.z,stores:[h],handlers:{commands:{markVpnProviderSeen:f,markInstallVpnSeen:b},events:{},queries:{hasSeenVpnProvider:C,hasSeenInstallVpn:I}}})],A)},15295:(e,t,a)=>{a.d(t,{d:()=>r});var s=a(9036);class r{addExternalComponentReadyCondition(e){this.externalComponentReadyConditions.push(e)}addAppReadyHook(e){this.appReadyHooks.push(e)}addShutdownHook(e){this.shutdownHooks.push(e)}removeShutdownHook(e){const t=this.shutdownHooks.indexOf(e);t>=0&&this.shutdownHooks.splice(t,1)}startup(e){const t=this.waitAndTriggerAppReady(e);if(!this.externalComponentReadyConditions.length)return t;this.addShutdownHook((async()=>await t))}async shutDown(){for(;this.shutdownHooks.length>0;){const e=this.shutdownHooks.pop();e&&await e()}}async waitAndTriggerAppReady(e){console.log("[background/framework] Waiting for external components before running startup hooks...");(await Promise.allSettled(this.externalComponentReadyConditions.map((e=>e())))).forEach((t=>{if("rejected"!==t.status)return;const a=t.reason,r=new Error("Failed to init external component",{cause:a});console.error(`[background/framework] ${r.message}`,a),e.captureException(r,{origin:"exceptionBoundary",domainName:"framework",moduleName:"kernel"},s.T.CRITICAL)})),console.log("[background/framework] Done waiting for external components before running startup hooks"),await this.executeStartupHooks(e,this.appReadyHooks)}async executeStartupHooks(e,t){let a=1;for(;t.length>0;){const r=t.shift();if(r){console.log(`[background/framework] Executing startup hook ${a}`);try{const e=await r();e&&this.addShutdownHook(e),console.log(`[background/framework] Done executing startup hook ${a}`),a++}catch(t){const a=new Error("Failed executing startup hook",{cause:t});console.error(`[background/framework] ${a}`,t),e.captureException(a,{origin:"exceptionBoundary",domainName:"framework",moduleName:"kernel"},s.T.CRITICAL)}}}}constructor(){this.shutdownHooks=[],this.externalComponentReadyConditions=[],this.appReadyHooks=[]}}},75354:(e,t,a)=>{a.d(t,{O:()=>c,r:()=>d});var s=a(60399),r=a(41842),n=a(58376),i=a(24966),o=a(87065);class c{async waitTimeout(e){await(0,s.z)(this.createObservableTimer(e,e))}}class d extends c{fireTimer(e=1){this.time+=e,[...this.subscribers$.value].forEach((e=>{e.next(this.time)}))}async allSubscribersDisconnected(){await(0,s.z)(this.pendingTimerCount$.pipe((0,r.h)((e=>!e))))}createObservableTimer(){return new n.y((e=>(this.subscribers$.next(new Set([...this.subscribers$.value,e])),()=>{this.subscribers$.next(new Set([...this.subscribers$.value].filter((t=>t!==e))))})))}constructor(...e){super(...e),this.subscribers$=new i.X(new Set),this.time=0,this.pendingTimerCount$=this.subscribers$.pipe((0,o.U)((e=>e.size)))}}},52357:(e,t,a)=>{a.d(t,{t:()=>n,u:()=>i});var s=a(66335),r=a(38430);const n=(e,t)=>(()=>{const e=t=>({define:()=>t,with:a=>{const s={api:a.module,main:a.on,queryOnly:a.queryOnly??[]},r={[a.module.name]:s};return e({...t,...r})}});return e({})})().with({module:s.t$,on:e}).with({module:r.P,on:e}),i=n("node")},90318:(e,t,a)=>{a.d(t,{V:()=>s,W:()=>r});class s{}class r extends s{log(){}error(){}warn(){}trace(){}}},46096:(e,t,a)=>{a.d(t,{b:()=>R});var s=a(40284),r=a(93223),n=a(53932),i=a(59590),o=a(40443),c=a(41718),d=a(15295),l=a(90318),u=a(491),p=a(76301),m=a(6178),h=a(33530),g=a(62149),v=a(95087),y=a(16712),f=a(4373);class _{async execute(e){const t=s.ContextIdFactory.getByRequest(e),{type:a}=e;if(!(e.module in this.introspection.modules))throw new Error("Unknown module "+e.module);const r=this.introspection.modules[e.module],n=r.api??h.w,i=r.handlers??f.TB;switch(a){case m.Y.Query:{const{queries:a}=n;if(e.name in a){const s=new(0,a[e.name])(e.body),r=i.queries[e.name];return{result:(await this.moduleRef.resolve(r,t,{strict:!1})).execute(s,{name:e.name})}}throw new Error("Unknown query "+e.name)}case m.Y.Command:{const{commands:a}=n;if(e.name in a){const s=new(0,a[e.name])(e.body),r=i.commands[e.name],n=await this.moduleRef.resolve(r,t,{strict:!1});return{result:await n.execute(s,{name:e.name})}}throw new Error("Unknown command "+e.name)}case m.Y.Event:{const{events:a}=n;if(e.name in a){const s=new(0,a[e.name])(e.body),r=Object.values(this.introspection.modules).flatMap((t=>(t.handlers??f.TB).events[e.module]?.events[e.name])),n=await Promise.all(r.filter((e=>this.introspection.supportedEventHandlers.has(e))).map((async e=>await this.moduleRef.resolve(e,t,{strict:!1}))));return void await Promise.all(n.map((e=>e.handle(s))))}throw new Error("Unknown event "+e.name)}case m.Y.Cron:{const a=(r.crons??[]).find((t=>t.name===e.name));if(!a)throw new Error("unknown cron "+e.name);if(a.scope===g.F.User){if(!e.context.getOrFail(y.l.UserName,{errorMessage:`Expected ${y.l.UserName} to be set in the request context`}))return{result:!1}}const s=await this.moduleRef.resolve(a.handler,t,{strict:!1});return s.isRunnable&&!await s.isRunnable()?{result:!1}:(await s.run(),{result:!0})}}return(0,v.U)(a)}constructor(e,t){this.introspection=e,this.moduleRef=t}}(0,u.__decorate)([(0,p.All)(),(0,u.__param)(0,(0,p.Req)()),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",["undefined"==typeof ApplicationRequest?Object:ApplicationRequest]),(0,u.__metadata)("design:returntype",Promise)],_.prototype,"execute",null),_=(0,u.__decorate)([(0,p.Controller)({scope:p.Scope.REQUEST,durable:!1}),(0,u.__metadata)("design:type",Function),(0,u.__metadata)("design:paramtypes",[void 0===f.Q1?Object:f.Q1,void 0===s.ModuleRef?Object:s.ModuleRef])],_);var b=a(75354),S=a(2198),w=a(96812),E=a(23711),C=a(43702),T=a(10722),I=a(50423),A=a(63419),N=a(7712);class U{catch(e,t){t.switchToHttp().getResponse().fail(e)}}U=(0,u.__decorate)([(0,p.Catch)(Error)],U);const F={provide:y.f,scope:p.Scope.REQUEST,inject:[s.REQUEST],useFactory:e=>{const t=(()=>{switch(e.type){case m.Y.Command:case m.Y.Event:case m.Y.Query:case m.Y.Cron:return e.context;case m.Y.Init:return new y.f;default:(0,v.U)(e)}})();return t.getOrAdd(y.l.UseCaseId,(()=>String(s.ContextIdFactory.getByRequest(e).id))),t}};var D=a(82194),O=a(60785),P=a(23337),x=a(25085);class R{static addGlobalNestInterceptor(e){this.globalInterceptors.push(e)}static create({brokers:e,configProviders:t,keyValueStorageInfrastructure:a,managedStorageInfrastructure:u,lifeCycle:p,logger:m,modules:h,nodeConfiguration:g,storeInfrastructureFactory:v,timers:k,jsonFetcher:L,defaultDeviceStorageEncryptionCodecProvider:M,defaultUserStorageEncryptionCodecProvider:j,storeList:z,interceptors:V,introspection:B,moduleClientsProviders:K,userUseCaseScopeProvider:G}){return{module:R,providers:[{provide:O.QI,useValue:a},{provide:O.Rx,useValue:u},{provide:d.d,useValue:p},{provide:o.$,useValue:g},{provide:r.d,useValue:e.cqrs},{provide:i.a,useValue:e.event},{provide:P.X,useValue:L},n.w,n.m,...t,{provide:l.V,useValue:m},F,{provide:c.G,useValue:v},{provide:b.O,useValue:k},S.u1,{provide:x.u,useValue:new x.u(a)},E.z,M,j,C.b,T.E,{provide:f.Q1,useValue:B},{provide:N.D,useValue:z},A.X,I.J,{provide:s.APP_FILTER,useClass:U},...[...this.globalInterceptors,...V].flatMap((e=>[{provide:s.APP_INTERCEPTOR,useClass:e},e])),...K,G],imports:[...h],exports:[d.d,o.$,r.d,i.a,n.w,n.m,...t.map((({provide:e})=>e)),l.V,y.f,c.G,b.O,S.u1,E.z,w.h,w.s,C.b,T.E,x.u,O.QI,O.Rx,P.X,A.X,I.J,f.Q1,...K.map((({provide:e})=>e)),D.g],controllers:[_],global:!0}}}R.globalInterceptors=[]},6178:(e,t,a)=>{a.d(t,{Y:()=>s});var s,r=a(16712);!function(e){e.Command="command",e.Query="query",e.Event="event",e.Init="init",e.Cron="cron"}(s||(s={}));new r.f},94006:(e,t,a)=>{a.d(t,{u:()=>Se,W:()=>we});var s=a(38430),r=a(66335),n=a(10722),i=a(41842),o=a(60399),c=a(40284),d=a(28489);var l=a(46096),u=a(76301),p=a(87279),m=a(95087),h=a(17350),g=a(162),v=a(74081),y=a(24966),f=a(6178),_=a(16712);const b=()=>{},S=()=>{throw new Error("Not supported")};class w{isHeadersSent(){return!1}bindHandler(e){if(this.cqrsCallbacks||this.eventCallbacks)throw new Error("Handler already registered");this.cqrsCallbacks={onCommand:(t,a,s,r)=>new Promise(((n,i)=>{e({type:f.Y.Command,module:t,name:a,body:s,context:r},{type:f.Y.Command,value:{result:(0,p.Vp)(void 0)},reply:e=>n(e),fail:e=>i(e)})})),onQuery:(t,a,s,r)=>{const n=new Promise(((n,i)=>{e({type:f.Y.Query,module:t,name:a,body:s,context:r},{type:f.Y.Query,value:{result:h.E},reply:e=>n(e),fail:e=>i(e)})}));return(0,g.D)(n).pipe((0,v.J)())}},this.eventCallbacks={onLocalEvent:(t,a,s,r,n)=>new Promise(((a,i)=>{e({type:f.Y.Event,body:r,context:n,name:s,module:t},{type:f.Y.Event,reply:()=>a(),fail:e=>i(e)})}))},this.cronCallbacks=(t,a)=>new Promise(((s,r)=>{e({type:f.Y.Cron,context:new _.f,module:t,name:a},{type:f.Y.Cron,value:{result:!1},reply:e=>s(e),fail:e=>r(e)})}))}all(e,t){if(!t)throw new Error("Provide a handler");return this.bindHandler(t)}async listen(){if(!this.cqrsCallbacks||!this.eventCallbacks||!this.cronCallbacks)throw new Error("Please call `all(path, handler)` first");const e=await this.cqrsBroker.connect(this.cqrsCallbacks).start(),t=await this.eventsBroker.connect(this.eventCallbacks).start(),a=await this.cronsBroker.connect(this.cronCallbacks).start(),{isListening$:s}=this;this.disconnect=()=>{e.stop(),t.stop(),a.stop(),s.complete()},this.close=this.disconnect,this.isListening$.next(!0)}reply(e,t){switch(e.type){case f.Y.Query:case f.Y.Command:e.reply(t.result);break;case f.Y.Event:e.reply();break;case f.Y.Cron:e.reply(t.result);break;default:(0,m.U)(e)}}getInstance(){return this}getHttpServer(){return{once:b,address:()=>"",removeListener:b}}getType(){return"AppCoreNode"}constructor(e,t,a){this.cqrsBroker=e,this.eventsBroker=t,this.cronsBroker=a,this.isListening$=new y.X(!1),this.use=S,this.get=S,this.post=S,this.head=S,this.delete=S,this.put=S,this.options=S,this.patch=S,this.end=S,this.applyVersionFilter=S,this.disconnect=b,this.close=b,this.status=S,this.render=S,this.redirect=S,this.setHeader=S,this.enableCors=S,this.initHttpServer=S,this.registerParserMiddleware=S,this.createMiddlewareFactory=S}}const E=()=>{};class C extends c.AbstractHttpAdapter{initHttpServer(){this.setHttpServer({once:E,address:()=>"",removeListener:E})}getRequestMethod(){return u.RequestMethod.ALL}getRequestUrl(){return"/"}getType(){return"CoreApp"}isHeadersSent(){return!1}applyVersionFilter(){throw new Error("Versioning not supported")}constructor(e,t,a){super(new w(e,t,a)),this.createMiddlewareFactory=this.instance.createMiddlewareFactory,this.close=this.instance.close,this.reply=this.instance.reply,this.useStaticAssets=E,this.setViewEngine=E,this.getRequestHostname=E,this.status=E,this.render=E,this.redirect=E,this.setNotFoundHandler=E,this.setHeader=E,this.registerParserMiddleware=E,this.enableCors=E,this.setErrorHandler=E,this.end=E,this.getHeader=E,this.appendHeader=E,this.isListening$=this.instance.isListening$}}var T=a(15295),I=a(59590),A=a(93223),N=a(93787),U=a(68860),F=a(96031),D=a(4373);const O=(e,t)=>t.reduce(((t,a)=>{const s=Reflect.getMetadata(F.o,a.module);if(!(0,D.Vy)(s))return t;const r=s.api?.name??s.sharedModuleName??"unnamed";if(s.onFrameworkInit){const e=e=>({moduleName:r,initClass:e});s.onFrameworkInit instanceof Array?t.onFrameworkInits=t.onFrameworkInits.concat(s.onFrameworkInit.map(e)):t.onFrameworkInits.push(e(s.onFrameworkInit))}return t.configProviders.push(...function(e,t,a,s){if(!a.configurations)return[];const{configurations:r}=a,n=[];return Object.keys(r).forEach((e=>{const a=r[e].token,i=s.configurations?.[e];if(!i)throw new Error(`Missing '${e}' configuration for '${t}' module`);n.push({...i,provide:a})})),Object.keys(s.configurations??{}).forEach((s=>{a.configurations?.[s]||e.error(`Unknown '${s}' configuration for '${t}' module will be unused`)})),n}(e,r,s,a)),s.api?.name&&t.modulesMetadata.set(s.api.name,s),t.modules.push(a.module),s.crons&&t.crons.push(...s.crons.map((e=>({...e,moduleName:r})))),s.handlers?.events&&t.eventHandlers.push(...Object.values(s.handlers.events).flatMap((e=>Object.values(e.events)))),s.stores&&t.stores.push(...s.stores),t.allDeclarations[r]=s,t}),{configProviders:new Array,modules:new Array,modulesMetadata:new Map,onFrameworkInits:new Array,crons:new Array,eventHandlers:new Array,stores:new Array,allDeclarations:(0,d.Ay)({})});var P=a(96812),x=a(79386),R=a(41718),k=a(31857),L=a(20491),M=a(10894),j=a(9036);function z(e){const{parameterProvider:t,token:a}=e;switch(t.type){case L.j.CLASS_PROVIDER:return{provide:a,useClass:t.useClass};case L.j.VALUE_PROVIDER:return{provide:a,useValue:t.useValue};default:(0,m.U)(t)}}var V=a(7712),B=a(11553),K=a(53466),G=a(491),q=a(43978),$=a(69885),Q=a(25313),H=a(82567),W=a(87065),Y=a(62149),X=a(53932),Z=a(40443);const J={tag:""};class ee{intercept(e,t){const a=e.switchToHttp().getRequest(),{appDefinition:s}=this.config;if(a.type===f.Y.Cron)return this.checkCronActiveUser(t,a);if(!(a.module in s))return t.handle();const r=s[a.module].api;switch(a.type){case f.Y.Query:return this.checkQueryActiveUser(t,a,r);case f.Y.Command:return this.checkCommandActiveUser(t,a,r);case f.Y.Event:return this.checkEventActiveUser(t,a,r);default:(0,m.U)(a)}}checkCronActiveUser(e,t){const a=(this.introspection.modules[t.module].crons??[]).find((e=>e.name===t.name));if(!a)throw new Error("No such cron "+t.name);return a.scope===Y.F.Device?e.handle():this.checkActiveUserPromise(e,t.context,{noUserError:J,scope:Y.F.User},"Cron")}checkQueryActiveUser(e,t,a){const{queries:s}=a;if(t.name in s){const a=s[t.name],{metadata:r}=a;return this.checkActiveUserObservable(e,t.context,r,`Query ${t.module}.${t.name}`)}return e.handle()}checkCommandActiveUser(e,t,a){const{commands:s}=a;if(t.name in s){const a=s[t.name],{metadata:r}=a;return this.checkActiveUserPromise(e,t.context,r,`Command ${t.module}.${t.name}`)}return e.handle()}checkEventActiveUser(e,t,a){const{events:s}=a;if(t.name in s){const a=s[t.name],{metadata:r}=a;return this.checkActiveUserPromise(e,t.context,r,`Event ${t.module}.${t.name}`)}return e.handle()}checkActiveUserPromise(e,t,a,s){if(a.scope!==Y.F.User)return e.handle();const{noUserError:r}=a;return(0,g.D)(t.getOrAdd(_.l.UserName,(()=>this.queryUserName()))).pipe((0,q.w)((t=>{if(t)return e.handle();if(r)return(0,$.of)({result:(0,p.Rn)(r)});throw new Error(`Not logged in : ${s}`)})))}checkActiveUserObservable(e,t,a,s){if(a.scope!==Y.F.User)return e.handle();const{noUserError:r}=a;return(0,$.of)({result:r?this.createResultObservable(e,t,(()=>new y.X((0,p.Rn)(r)))):this.createResultObservable(e,t,(()=>(0,Q._)((()=>new Error(`Not logged in : ${s}`)))))})}createResultObservable(e,t,a){return this.queryUserName$().pipe((0,H.b)((e=>{t.set(_.l.UserName,e)})),(0,q.w)((t=>t?e.handle().pipe((0,q.w)((({result:e})=>e))):a())))}queryUserName$(){return this.clients.getClient(r.t$).queries.activeUser().pipe((0,W.U)((e=>{if((0,p.d6)(e)&&(0,p.db)(e).userName)return e.data.userName})))}queryUserName(){return(0,o.z)(this.queryUserName$())}constructor(e,t,a){this.clients=e,this.config=t,this.introspection=a}}ee=(0,G.__decorate)([(0,u.Injectable)(),(0,G.__metadata)("design:type",Function),(0,G.__metadata)("design:paramtypes",[void 0===X.m?Object:X.m,void 0===Z.$?Object:Z.$,void 0===D.Q1?Object:D.Q1])],ee);class te{async setState(e){await this.storage.set(this.storageKey,JSON.stringify(e))}async getState(){const e=await this.storage.get(this.storageKey);if(!e)return{entries:[]};const t=JSON.parse(e);return(a=t)&&"object"==typeof a&&"entries"in a&&Array.isArray(a.entries)&&a.entries.every((e=>function(e){return!!e&&"object"==typeof e&&"dueTimestamp"in e&&"moduleName"in e&&"name"in e&&"string"==typeof e.name&&"string"==typeof e.moduleName&&"number"==typeof e.dueTimestamp}(e)))?t:{entries:[]};var a}constructor(e,t){this.storage=e,this.storageKey=`crons.${t}`}}var ae=a(34987);const se=6e4;function re(e){return Math.ceil(e/se)*se}function ne(e){return Math.floor(e/se)*se}class ie{async init(){const e=re(this.infra.timers.time),t=await this.infra.repository.getState(),a=this.definitions.filter((e=>!t.entries.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),s={entries:[...t.entries.filter((e=>this.definitions.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),...a.map((t=>({...t,dueTimestamp:e+t.periodInMinutes*se})))]};await this.infra.repository.setState(s)}connect(e){const{infra:t,definitions:a}=this;return{start:async()=>{await this.init();const s=t.cronSource.alarm$.pipe((0,ae.b)((async()=>{const s=await t.repository.getState(),r=re(t.timers.time),n=ne(t.timers.time),i=s.entries.filter((e=>e.dueTimestamp<=r));await Promise.allSettled(i.map((r=>{const i=a.find((e=>e.moduleName===r.moduleName&&e.name===r.name));if(!i)throw new Error("we should have a declaration");return async function(a,s,r,n){let i=!1;try{i=await e(r.moduleName,r.name)}finally{i&&(r.dueTimestamp=ne(a+n.periodInMinutes*se),await t.repository.setState(s))}}(n,s,r,i)})))}))).subscribe();return{stop:()=>{s.unsubscribe()}}}}}constructor(e,t){this.infra=e,this.definitions=t}}var oe=a(49405);class ce{intercept(e,t){return this.useCaseStacktraceRepo.append(this.request.name),t.handle()}constructor(e,t){this.request=e,this.useCaseStacktraceRepo=t}}ce=(0,G.__decorate)([(0,u.Injectable)({scope:u.Scope.REQUEST}),(0,G.__param)(0,(0,u.Inject)(c.REQUEST)),(0,G.__metadata)("design:type",Function),(0,G.__metadata)("design:paramtypes",[Object,void 0===oe.F?Object:oe.F])],ce);var de=a(92587);let le=class{get commands(){return this.client.commands}get queries(){return this.client.queries}constructor(e,t){this.client=e.getClient(t)}};var ue=a(96498),pe=a(82194),me=a(58881);let he;function ge(e){return function(e){return"module"in e}(e)?e:{module:e}}var ve=a(89422),ye=a(61869),fe=a(57934),_e=a(73656);const be=[ce,ee],Se=async({appDefinition:e,channels:t,currentNode:a,implementations:u,otherModules:p=[],logger:m=new U.Mn,storeInfrastructureFactory:h=new R.N,channelsListener:g=fe.y,timers:v=new U.mZ,keyValueStorageInfrastructure:y=new x.s,managedStorageInfrastructure:b=new x.I,jsonFetcher:S=new U.kl,cronSource:w=new k._C(v),defaultDeviceStorageEncryptionCodec:E={type:L.j.CLASS_PROVIDER,useClass:n.E},defaultUserStorageEncryptionCodec:F={type:L.j.CLASS_PROVIDER,useClass:n.E},exceptionLogging:G=K.I})=>{try{console.log("[background/framework] Starting application node");const n=()=>{throw console.error("[background/framework] Unexpected call to process.abort"),new Error("Aborted")};_e.abort=n;const U=()=>{throw console.error("[background/framework] Unexpected call to process.exit"),new Error("Exited")};_e.exit=U;const x={...e,[s.P.name]:{api:s.P,main:a,queryOnly:[]},[r.t$.name]:{api:r.t$,main:a,queryOnly:[]}},R=[...[ye.q,B.G.configure(G)],...p,...Object.keys(u).map((e=>e)).map((e=>u[e]))].map(ge),{configProviders:k,modules:L,modulesMetadata:K,onFrameworkInits:q,crons:$,eventHandlers:Q,stores:H,allDeclarations:W}=O(m,R),Y=new V.D;H.forEach((e=>{Y.registerClass(e)})),((e,t,a)=>{const s=new Set([...a.keys()]),r=new Set(Object.values(e).filter((e=>e.main===t||e.queryOnly.includes(t))).map((e=>e.api.name))),n=[...r].filter((e=>!s.has(e))),i=[...s].filter((e=>!r.has(e)));if(n.length>0)throw new Error("These APIs are not implemented "+JSON.stringify(n));if(i.length>0)throw new Error("Some implementations do not have APIS "+JSON.stringify(i))})(x,a,K);const J=(e=>[...e.entries()].reduce(((e,[t,a])=>{const s=a.handlers?.events??{};return e[t]=Object.values(s).reduce(((e,t)=>t.name?(e[t.name]=Object.keys(t.events),e):e),(0,d.Ay)({})),e}),(0,d.Ay)({})))(K),ee=new Z.$({appDefinition:x,channels:t,channelsListener:g,currentNode:a,subscriptions:J}),ae=new A.d(ee),se=new I.a(ee),re=new ie({cronSource:w,repository:new te(y,a),timers:v},$),ne=new C(ae,se,re),oe=z({token:P.h,parameterProvider:E}),ce=z({token:P.s,parameterProvider:F}),fe=new T.d,Se=new D.Q1(new Set(Q),W),we=function(e){const t=[];return Object.values(e).forEach((e=>{const{api:a}=e,{ClientClass:s}=a;s&&((0,de.GS)()(s),t.push({provide:s,useFactory:e=>new le(e,a),inject:[X.w]}))})),t}(x),Ee={useFactory:(e,t,a)=>{const s=e.get(_.l.UserName);if(s)return he&&he.status!==me.p.Closed||(he=new pe.g(s,a,t)),Promise.resolve(he)},provide:pe.g,inject:[_.f,ue.Q,T.d]},Ce=l.b.create({nodeConfiguration:ee,brokers:{cqrs:ae,event:se},modules:L,configProviders:k,logger:m,lifeCycle:fe,storeInfrastructureFactory:h,timers:v,keyValueStorageInfrastructure:y,managedStorageInfrastructure:b,jsonFetcher:S,defaultDeviceStorageEncryptionCodecProvider:oe,defaultUserStorageEncryptionCodecProvider:ce,storeList:Y,interceptors:be,introspection:Se,moduleClientsProviders:we,userUseCaseScopeProvider:Ee});console.log("[background/framework] Creating NestApplication");const Te=await c.NestFactory.create(Ce,ne,{logger:m});console.log("[background/framework] Initializing NestApplication");const Ie=await Te.init(),Ae=await Ie.resolve(ve.v);try{await async function(e,t,a){console.log("[background/framework] Run modules initialization handlers...");const s=Object.freeze({id:-1}),r=e.map((async({moduleName:e,initClass:r})=>{try{console.log(`[background/framework] Running module initialization handler ${e}`);const a={type:f.Y.Init,[M.REQUEST_CONTEXT_ID]:s};t.registerRequestByContextId(a,s);const n=await t.resolve(r,s,{strict:!1});await n.onFrameworkInit(),console.log(`[background/framework] Done running module initialization handler ${e}`)}catch(t){const s=new Error(`Failed running module initialization handler ${e}`,{cause:t});console.error(`[background/framework] ${s.message}`,t),a.captureException(s,{origin:"exceptionBoundary",moduleName:"kernel",domainName:"framework"},j.T.CRITICAL)}}));await Promise.all(r),console.log("[background/framework] Done running modules initialization handlers")}(q,Ie,Ae),console.log("[background/framework] Start CQRS, event & CRON brokers"),Te.listen("");const e=ne.isListening$.pipe((0,i.h)((e=>!!e)));await(0,o.z)(e),fe.addShutdownHook((()=>Te.close())),await fe.startup(Ae)}catch(e){throw Ae.captureException(e,{origin:"exceptionBoundary",domainName:"framework",moduleName:"kernel"},j.T.CRITICAL),e}return{stop:()=>fe.shutDown(),createClient:()=>(0,N.R)(x,ae),sendEvent:(e,t,a,s)=>se.publishEvent(e,t,a,s??new _.f)}}catch(e){throw console.error("[background/framework] Exception when starting application node",e),e}},we=e=>Se({...e,appDefinition:e.appDefinition,channels:{},currentNode:"node"})},93223:(e,t,a)=>{a.d(t,{d:()=>g});var s=a(162),r=a(60399),n=a(41842),i=a(87065),o=a(17350),c=a(95087),d=a(28489);const l=e=>"response"===e.type,u=(e,t,a,s)=>Object.keys(e).reduce(((r,n)=>{const{commandMailbox:i,queryMailbox:o}=(r=>{const{main:n,queryOnly:i}=e[r],o={type:"local",onMessage:s};if(n===t)return{commandMailbox:o,queryMailbox:o};const c={type:"remote",channel:a[n]};return{commandMailbox:c,queryMailbox:t&&i.includes(t)?o:c}})(n);return r[`command-${n}`]=i,r[`query-${n}`]=o,r}),(0,d.Ay)({}));var p=a(10826),m=a(16712);const h=()=>(0,s.D)([]);class g{async sendCommand(e,t,a,s){if(!this.broker)throw new Error("call connect() first");return await(0,r.z)(this.broker.sendMessage(`command-${e}`,{type:"command",module:e,commandName:String(t),command:a,context:s.toSerializable()}).pipe((0,n.h)(l),(0,i.U)((e=>e.response))))}sendQuery(e,t,a,s){if(!this.broker)throw new Error("call connect() first");return this.broker.sendMessage(`query-${e}`,{type:"query",module:e,queryName:String(t),query:a,context:s.toSerializable()}).pipe((0,n.h)(l),(0,i.U)((e=>e.response)))}connect(e){const t=e?(t,a,r)=>{switch(a.type){case"response":return o.E;case"command":return(0,s.D)(e.onCommand(a.module,a.commandName,a.command,m.f.fromSerializable(a.context),{isReminder:r.isReminder})).pipe((0,i.U)((e=>({type:"response",response:e}))));case"query":return(0,s.D)(e.onQuery(a.module,a.queryName,a.query,m.f.fromSerializable(a.context))).pipe((0,i.U)((e=>({type:"response",response:e}))))}(0,c.U)(a)}:h,a=u(this.config.appDefinition,this.config.currentNode,this.config.channels,t);return this.broker=new p.U(a),this.broker.connect(Object.values(this.config.channels),this.config.channelsListener)}constructor(e){this.config=e}}},53932:(e,t,a)=>{a.d(t,{m:()=>l,w:()=>d});var s=a(491),r=a(92587),n=a(40443),i=a(93223),o=a(93787),c=a(16712);class d{getClient(e){return(0,o.c)(this.configuration.appDefinition,this.broker,e.name,this.context)}constructor(e,t,a){this.broker=e,this.configuration=t,this.context=a}}d=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.d?Object:i.d,void 0===n.$?Object:n.$,void 0===c.f?Object:c.f])],d);class l{getClient(e){return(0,o.c)(this.configuration.appDefinition,this.broker,e.name)}constructor(e,t){this.configuration=e,this.broker=t}}l=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.$?Object:n.$,void 0===i.d?Object:i.d])],l)},93787:(e,t,a)=>{a.d(t,{R:()=>i,c:()=>n});var s=a(28489),r=a(16712);function n(e,t,a,n){return{commands:Object.keys(e[a].api.commands).reduce(((e,s)=>(e[s]=e=>{const i=n??new r.f;return t.sendCommand(a,s,e,i)},e)),(0,s.Ay)({})),queries:(()=>{const i=e[a].api.queries;return Object.keys(i).reduce(((e,s)=>(e[s]=e=>{const i=n??new r.f;return t.sendQuery(a,s,e,i)},e)),(0,s.Ay)({}))})()}}function i(e,t){return Object.keys(e).map((e=>e)).reduce(((a,s)=>(a[s]=n(e,t,s),a)),{})}},13800:(e,t,a)=>{a.d(t,{C:()=>l,f:()=>d});var s=a(491),r=a(76301),n=a(92587),i=a(3441),o=a(59590),c=a(16712);class d{sendEvent(e,t){return this.broker.publishEvent(this.apiName,e,t,this.context)}constructor(e,t,a){this.apiName=e,this.broker=t,this.context=a}}d=(0,s.__decorate)([(0,n.GS)(),(0,s.__param)(0,(0,r.Inject)(i.r)),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,void 0===o.a?Object:o.a,void 0===c.f?Object:c.f])],d);class l{sendEvent(e,t,a){return this.broker.publishEvent(this.apiName,e,t,a??new c.f)}constructor(e,t){this.apiName=e,this.broker=t}}l=(0,s.__decorate)([(0,n.GS)(),(0,s.__param)(0,(0,r.Inject)(i.r)),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,void 0===o.a?Object:o.a])],l)},59590:(e,t,a)=>{a.d(t,{a:()=>_});var s=a(491),r=a(162),n=a(87065),i=a(17350),o=a(69885),c=a(12768),d=a(3497),l=a(40548),u=a(85270),p=a(28489);const m={type:"ask"},h={type:"eventResponse"};var g=a(92587),v=a(40443),y=a(16712),f=a(10826);class _{async publishEvent(e,t,a,s){const{broker:r,eventToSubscriber:n}=this;if(!r)throw new Error("Not started");const i=(n[e].get(t)??[]).map((r=>({type:"event",context:s.toSerializable(),event:a,eventName:t,moduleSource:e,nodeDestination:r})));await Promise.all(i.map((async e=>{await r.trySendMessage(`event-${e.nodeDestination}`,e)})))}connect(e){const{configuration:t}=this,a=Object.keys(t.subscriptions).reduce(((e,a)=>{const s=t.subscriptions[a];return(0,c.Z)((0,d.Z)(l.Z,u.Z),e,s)}),(0,p.Ay)({})),s={type:"subscriptions",nodeName:t.currentNode,subscribesTo:a},g=((e,t)=>e.getNodeList().reduce(((a,s)=>(s===e.currentNode?a[`event-${s}`]={type:"local",onMessage:t}:a[`event-${s}`]={type:"remote",channel:e.channels[s]},a)),(0,p.Ay)({})))(this.configuration,((t,a,c)=>{switch(a.type){case"event":return(0,r.D)(e.onLocalEvent(a.moduleSource,a.nodeDestination,a.eventName,a.event,y.f.fromSerializable(a.context),c)).pipe((0,n.U)((()=>h)));case"eventResponse":return i.E;case"subscriptions":return this.subscriberToEvent[a.nodeName]=a.subscribesTo,this.eventToSubscriber=this.regenerateReverseSubscriptionMap(),(0,o.of)(h);case"ask":return(0,o.of)(s)}})),v=new f.U(g);return t.getNodeList().map((async e=>{await v.trySendMessage(`event-${e}`,s),await v.trySendMessage(`event-${e}`,m)})),this.broker=v,v.connect(Object.values(t.channels),t.channelsListener)}regenerateReverseSubscriptionMap(){const{configuration:e,subscriberToEvent:t}=this,a=e.getModuleNames().reduce(((e,t)=>({...e,[t]:new Map})),{});return e.getNodeList().reduce(((e,a)=>{const s=t[a];return Object.entries(s).forEach((([t,s])=>{if(!(t in e))throw new Error("A module depends on events from "+t+" but this one is not in the app def");const r=e[t];s.forEach((e=>{const t=[...r.get(e)??[],a];r.set(e,t)}))})),e}),a)}constructor(e){this.configuration=e;const t=Object.entries(e.appDefinition).reduce(((e,[t,a])=>(e[t]=Object.keys(a.api.events),e)),{});this.subscriberToEvent=this.configuration.getNodeList().reduce(((e,a)=>(e[a]={...t},e)),{}),this.eventToSubscriber=this.regenerateReverseSubscriptionMap()}}_=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v.$?Object:v.$])],_)},36610:(e,t,a)=>{a.d(t,{j:()=>r});var s=a(58376);class r{stop(){this.source.removeListener(this.listener)}constructor(e,t){this.source=e,this.filter=t;let a=[];const r=new Set;this.listener=(e,t)=>{if(!this.filter(e,t))return!1;r.size?r.forEach((a=>a.next([e,t]))):a.push([e,t])},this.events$=new s.y((e=>(r.size||(a.forEach((t=>e.next(t))),a=[]),r.add(e),()=>{r.delete(e)}))),this.source.addListener(this.listener)}}},82874:(e,t,a)=>{a.d(t,{W:()=>r});var s=a(92587);function r(e){const t=(0,s.GS)();return a=>{Reflect.defineMetadata("dl-handler",a,e),t(a)}}},2198:(e,t,a)=>{a.d(t,{Tx:()=>u,b2:()=>l,u1:()=>p});var s=a(491),r=a(58376),n=a(6220),i=a(7074),o=a(92587),c=a(75354),d=a(53932);function l(e){return e}class u{withRefresh(){return e=>new r.y((t=>{const a=this.refreshObservable$.subscribe();return a.add(e.subscribe(t)),a}))}constructor(e,t,{args:a,commandName:s}){const r=t.commands[s];this.refreshObservable$=e.pipe((0,n.z)((async()=>{await r(a)})),(0,i.B)({}))}}class p{getRefresher(e){const t=this.map.get(e);if(t)return t;return new u(this.timers.createObservableTimer(e.period,e.period),this.cqrsClient.getClient(e.api),e)}constructor(e,t){this.timers=e,this.cqrsClient=t,this.map=new WeakMap}}p=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.O?Object:c.O,void 0===d.m?Object:d.m])],p)},85798:(e,t,a)=>{a.d(t,{b:()=>r});var s=a(92587);function r(e){const t=(0,s.GS)();return a=>{if(Reflect.hasMetadata("dl-handlers",e)){const t=Reflect.getMetadata("dl-handlers",e);Reflect.defineMetadata("dl-handlers",[...t,a],e)}else Reflect.defineMetadata("dl-handlers",[a],e);t(a)}}},46449:(e,t,a)=>{a.d(t,{e:()=>r});var s=a(92587);function r(e){const t=(0,s.GS)();return a=>{Reflect.defineMetadata("dl-handler",a,e),t(a)}}},96031:(e,t,a)=>{a.d(t,{o:()=>s});const s="dl-module"},86213:(e,t,a)=>{a.d(t,{H:()=>c});var s=a(40284),r=a(78776),n=a(92587),i=a(64987),o=a(15295);const c=(e,t)=>{const a=t.token??(0,r.Z)();let c=class{getOrCreate(e,t){return this.mutex.runExclusive((async()=>(this.instance||(t.addShutdownHook((()=>{this.invalidate()})),this.instance=await e()),this.instance)))}invalidate(){this.instance=void 0}constructor(){this.mutex=new i.WU}};(0,n.GS)()(c);const d=c,l={token:e,inject:[c,o.d,s.ModuleRef,s.REQUEST],asyncFactory:(e,t,r,n)=>{const i=s.ContextIdFactory.getByRequest(n);return e.getOrCreate((()=>r.resolve(a,i)),t)}};return[{...t,token:a},d,l]}},92587:(e,t,a)=>{a.d(t,{GS:()=>n,ar:()=>i,xB:()=>r});var s=a(76301);function r(){return(0,s.Global)()}function n(e){return(0,s.Injectable)({scope:e?.neverReuseInstance?s.Scope.TRANSIENT:s.Scope.DEFAULT})}const i=()=>n()},86006:(e,t,a)=>{a.d(t,{Yl:()=>f,g4:()=>v});a(72964);var s=a(96031),r=a(76301),n=a(3441),i=a(491),o=a(43702),c=a(23711),d=a(60785),l=a(16712);const u=new o.b,p=new c.z;class m{async getBatchState(e){const t=await this.kv.get(`${this.prefix}.${e}`);return t?this.stringToState(t):{queue:[]}}async setBatchState(e,t){const a=this.stateToString(t);return await this.kv.set(`${this.prefix}.${e}`,a)}stateToString(e){const t=u.encode(e);return p.encode(t)}stringToState(e){const t=p.decode(e);return u.decode(t)}constructor(e,t,a){this.kv=e,this.prefix=`batch-storage.${a}.${t.get(l.l.UserName)}`}}m=(0,i.__decorate)([(0,i.__param)(2,(0,r.Inject)(n.r)),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===d.QI?Object:d.QI,void 0===l.f?Object:l.f,String])],m);class h{getProviders(e){if(!e.length)return[];return[...e.map((e=>({provide:e,inject:[m,e.Definition.chunkProcessor],useFactory:(t,a)=>new e(t,a)}))),...e.map((({Definition:{chunkProcessor:e}})=>e)),m]}}var g=a(60107);const v=(e,t)=>({[e.name]:{name:e.name,events:t}}),y=(e,t)=>{const{exports:a=[],imports:s=[],providers:r=[],onFrameworkInit:n=[],stores:i=[],crons:o=[]}=e,c=[n,t.onFrameworkInit??[]].flat();return{...e,exports:a.concat(t.exports??[]),imports:s.concat(t.imports??[]),providers:r.concat(t.providers??[]),onFrameworkInit:c,stores:i.concat(t.stores??[]),crons:o.concat(t.crons??[])}};function f(e){const{composes:t=[]}=e;e=t.reduce(((e,t)=>y(e,t)),e);const{exports:a=[],imports:i=[],handlers:o={commands:{},events:{},queries:{}},providers:c=[],onFrameworkInit:d=[],stores:l,batchExecutors:u,crons:p}=e,m=e.api?.name??e.sharedModuleName,v=m?(0,g.N)(...l??[]):[],f=m?(new h).getProviders(u??[]):[],_=[...c,...(p??[]).map((e=>e.handler)),...v,...f,...Object.values(o.commands),...Object.values(o.queries),...Object.values(o.events).map((e=>Object.values(e.events))).reduce(((e,t)=>[...e,...t]),new Array),...d instanceof Array?d:[d],{provide:n.r,useValue:m}],{asyncProviders:b,basicClassProviders:S}=_.reduce(((e,t)=>{return"object"==typeof(a=t)&&"token"in a&&"asyncFactory"in a&&"function"==typeof a.asyncFactory?{asyncProviders:[...e.asyncProviders,t],basicClassProviders:e.basicClassProviders}:{asyncProviders:e.asyncProviders,basicClassProviders:[...e.basicClassProviders,t]};var a}),{asyncProviders:new Array,basicClassProviders:new Array}),w=[...S,...b.map((e=>({provide:e.token,useFactory:e.asyncFactory,inject:e.inject})))],E=(0,r.Module)({exports:a,imports:i,providers:w});return t=>(Reflect.defineMetadata(s.o,e,t),E(t))}var _;!function(e){e.PROVIDERS="providers",e.IMPORTS="imports"}(_||(_={}))},3441:(e,t,a)=>{a.d(t,{r:()=>s});const s="frameworkModuleName"},4373:(e,t,a)=>{a.d(t,{Q1:()=>n,TB:()=>s,Vy:()=>r});const s={commands:{},events:{},queries:{}},r=e=>!(!e||"object"!=typeof e)&&(!(e.api&&!(e.api.commands&&e.api.events&&e.api.name&&e.api.queries&&e.handlers))&&(!(e.exports&&!Array.isArray(e.exports))&&(!(e.handlers&&!e.api)&&(!(e.imports&&!Array.isArray(e.imports))&&!(e.providers&&!Array.isArray(e.providers))))));class n{constructor(e,t){this.supportedEventHandlers=e,this.modules=t}}},91743:(e,t,a)=>{a.d(t,{$:()=>n,z:()=>r});var s=a(20491);function r(e){return{type:s.j.VALUE_PROVIDER,useValue:e}}function n(e){return{type:s.j.CLASS_PROVIDER,useClass:e}}},20491:(e,t,a)=>{var s;a.d(t,{j:()=>s}),function(e){e.VALUE_PROVIDER="value_provider",e.CLASS_PROVIDER="class_provider"}(s||(s={}))},77761:(e,t,a)=>{a.d(t,{B:()=>o});var s=a(62149),r=a(95087),n=a(86213),i=a(77198);const o=(e,t,a)=>{switch(e){case s.F.Device:return(0,n.H)(t,a);case s.F.User:return(0,i.M)(t,a);default:(0,r.U)(e)}}},77198:(e,t,a)=>{a.d(t,{M:()=>c});var s=a(40284),r=a(78776),n=a(64987),i=a(16712),o=a(82194);const c=(e,t)=>{const a=t.token??(0,r.Z)();let c=class{getOrCreate(e,t,a){return this.mutex.runExclusive((async()=>{const s=this.instances.get(e);if(s)return s;a.addCloseHook((()=>{this.invalidate(e)}));const r=await t();return this.instances.set(e,r),r}))}invalidate(e){this.instances.delete(e)}constructor(){this.instances=new Map,this.mutex=new n.WU}};const d=c,l={token:e,inject:[c,i.f,s.ModuleRef,s.REQUEST,o.g],asyncFactory:(t,r,n,o,c)=>{const d=s.ContextIdFactory.getByRequest(o),l=r.getOrDefault(i.l.UserName,"");if(""===l)throw new Error(`Provider ${e} is a user-scoped singleton but there is no user`);if(!c)throw new Error("No user scope available");return t.getOrCreate(l,(()=>n.resolve(a,d)),c)}};return[{token:a,asyncFactory:t.asyncFactory,inject:[...t.inject??[],i.f]},d,l]}},15160:(e,t,a)=>{a.d(t,{U:()=>s});class s{constructor(e){this.events$=e}}},76568:(e,t,a)=>{a.d(t,{A:()=>l});var s=a(491),r=a(15295),n=a(29406),i=a(40284),o=a(33247),c=a(15160),d=a(92587);class l{onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const e=(0,n.T)(...this.diagnosticsLogsSources.events$).subscribe(this.onLogEvent.bind(this));return()=>{e.unsubscribe()}}))}onLogEvent(e){const t=e[0];this.moduleRef.get(o.y).handle(t)}constructor(e,t,a){this.lifeCycle=e,this.moduleRef=t,this.diagnosticsLogsSources=a}}l=(0,s.__decorate)([(0,d.ar)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.d?Object:r.d,void 0===i.ModuleRef?Object:i.ModuleRef,void 0===c.U?Object:c.U])],l)},33247:(e,t,a)=>{a.d(t,{y:()=>n});var s=a(491),r=a(76301);class n{handle(e){return e}}n=(0,s.__decorate)([(0,r.Injectable)()],n)},35273:(e,t,a)=>{a.d(t,{y:()=>h});var s=a(491),r=a(83016),n=a(87279),i=a(42074),o=a(33247),c=a(40284),d=a(82874);class l{async execute(e){const t=e.body.log;return this.moduleRef.get(o.y).handle(t),(0,n.Vp)(void 0)}constructor(e){this.moduleRef=e}}l=(0,s.__decorate)([(0,d.W)(i.Q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.ModuleRef?Object:c.ModuleRef])],l);var u=a(76568),p=a(15160),m=a(86006);class h{static configure(e){return{module:h,configurations:{externalDiagnosticsLogsSources:e.externalDiagnosticsLogsSources}}}}h=(0,s.__decorate)([(0,m.Yl)({api:r.e,handlers:{commands:{log:l},events:{},queries:{}},providers:[o.y],configurations:{externalDiagnosticsLogsSources:{token:p.U}},domainName:"framework",onFrameworkInit:u.A})],h)},50423:(e,t,a)=>{a.d(t,{J:()=>f});var s=a(491),r=a(40284),n=a(76301),i=a(60399),o=a(87065),c=a(89618),d=a(37182),l=a(69885),u=a(43651),p=a(87279),m=a(9036),h=a(89422),g=a(16712),v=a(52274),y=a(49405);class f{async do(e,...t){return(await Promise.all(t.map((t=>this.doOne(t,e))))).every((e=>!!e))}async doOne(e,{criticality:t=m.T.WARNING,methodName:a="methodName"}={}){try{const t=await e();if((0,p.AZ)(t)&&(0,p.hx)(t))throw new Error(`Allowed to fail ${a} has failed`);return!0}catch(e){const{request:a,useCaseStacktraceRepo:s}=this,[r,n]=e instanceof v.cI?[e.exception,e.useCaseStacktrace]:[e,s.read()];try{await Promise.race([new Promise((e=>setTimeout(e,100))),this.logger.captureException(r,{moduleName:a?.module,useCaseId:a?.context.get(g.l.UseCaseId),useCaseName:a?.name,useCaseStacktrace:n,featureFlips:await this.getUserFeatureFlips()},t)])}catch(e){}return!1}}async conditionallyAllowToFailOne(e,t){return t?this.doOne(e):(await e(),!0)}getUserFeatureFlips(){const{userFeatureFlips:e}=this.featureFlips.queries;return(0,i.z)(e().pipe((0,o.U)((e=>(0,p.d6)(e)?(0,p.db)(e):{})),(0,c.V)(50),(0,d.K)((()=>(0,l.of)({})))))}constructor(e,t,a,s){this.request=e,this.logger=t,this.useCaseStacktraceRepo=a,this.featureFlips=s}}f=(0,s.__decorate)([(0,s.__param)(0,(0,n.Inject)(r.REQUEST)),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[Object,void 0===h.v?Object:h.v,void 0===y.F?Object:y.F,void 0===u.P?Object:u.P])],f)},72693:(e,t,a)=>{a.d(t,{o:()=>s});class s{}},79594:(e,t,a)=>{a.d(t,{_:()=>o});var s=a(491),r=a(90318),n=a(72693),i=a(92587);class o{downloadFile(e,t,a){this.logger.log(`downloading file ${e}`),this.emitterChannel.send(e,t,a)}constructor(e,t){this.logger=e,this.emitterChannel=t}}o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.V?Object:r.V,void 0===n.o?Object:n.o])],o)},48302:(e,t,a)=>{a.d(t,{l:()=>c});var s=a(491),r=a(4166),n=a(86006),i=a(79594),o=a(72693);class c{}c=(0,s.__decorate)([(0,n.Yl)({api:r.L,configurations:{fileDownloadEmitterChannel:{token:o.o}},handlers:{commands:{},events:{},queries:{}},stores:[],providers:[i._],exports:[i._],domainName:"framework"})],c)},95962:(e,t,a)=>{a.d(t,{T:()=>i});var s=a(491),r=a(87201),n=a(92587);class i{onFrameworkInit(){try{this.fileUploadListener.listen()}catch(e){console.error("error while initializing file-upload listener",e)}}constructor(e){this.fileUploadListener=e}}i=(0,s.__decorate)([(0,n.ar)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===r.P?Object:r.P])],i)},34319:(e,t,a)=>{a.d(t,{i:()=>i});var s=a(491),r=a(13800),n=a(92587);class i extends r.f{}i=(0,s.__decorate)([(0,n.GS)()],i)},87201:(e,t,a)=>{a.d(t,{P:()=>i});var s=a(491),r=a(76301),n=a(34319);class i{constructor(e){this.eventEmitter=e}}i=(0,s.__decorate)([(0,r.Injectable)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},49699:(e,t,a)=>{a.d(t,{O:()=>d});var s=a(491),r=a(58563),n=a(86006),i=a(87201),o=a(34319),c=a(95962);class d{}d=(0,s.__decorate)([(0,n.Yl)({api:r.a,configurations:{fileUploadListener:{token:i.P}},onFrameworkInit:c.T,handlers:{commands:{},events:{},queries:{}},stores:[],providers:[o.i],exports:[o.i],domainName:"framework"})],d)},26468:(e,t,a)=>{a.d(t,{e:()=>h});var s=a(491),r=a(69885),n=a(34987),i=a(97280),o=a(48844),c=a(95087);class d{constructor(e,t){this.pipeline=this.initPipeline(e,this.dedupeInterceptorsById(t))}handle(e){return this.pipeline.handle(e)}dedupeInterceptorsById(e){const t=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);return Array.from(t.values())}initPipeline(e,t){return t.reduceRight(((e,t)=>({handle:a=>t.intercept(a,e.handle.bind(e))})),e)}}var l=a(4043);class u{constructor(e){this.backend=e,this.interceptors=new Map}addInterceptor(e){this.interceptors.set(e.id,e)}request(...e){return this.makeRequest(...e)}delete(e,t){return this.makeRequest("DELETE",e,t)}get(e,t){return this.makeRequest("GET",e,t)}head(e,t){return this.makeRequest("HEAD",e,t)}options(e,t){return this.makeRequest("OPTIONS",e,t)}patch(e,t,a){return this.makeRequest("PATCH",e,{body:t,...a})}post(e,t,a){return this.makeRequest("POST",e,{body:t,...a})}put(e,t,a){return this.makeRequest("PUT",e,{body:t,...a})}makeRequest(...e){let t,a,s;if(1===e.length)t=e[0],a="response";else{const[r,n,i]=e;t=new l.a(r,n,void 0!==i.body?i.body:null,{headers:i.headers,params:i.params,responseType:i.responseType??"json",withCredentials:i.withCredentials}),a=i.observe??"body","json"===i.responseType&&"body"===i.observe&&(s=i.responseBodyDecoder)}const u=new d(this.backend,Array.from(this.interceptors.values())),p=(0,r.of)(this.addContentTypeRequestHeader(t)).pipe((0,n.b)((e=>u.handle(e))),(0,i.d)(1));switch(a){case"body":switch(t.responseType){case"arraybuffer":return p.pipe((0,o.Gx)((e=>e.arrayBuffer())));case"text":return p.pipe((0,o.Gx)((e=>e.text())));case"json":return p.pipe((0,o.Gx)((e=>e.json(s))));default:(0,c.U)(t.responseType)}break;case"response":return p;default:(0,c.U)(a)}}addContentTypeRequestHeader(e){if(!e.headers.has("content-type")){const t=e.detectContentTypeHeader();if(t)return e.clone({headers:e.headers.set("content-type",t)})}return e}}var p=a(22253),m=a(92587);class h extends u{constructor(e){super(e)}}h=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.j?Object:p.j])],h)},75421:(e,t,a)=>{a.d(t,{X:()=>u});var s=a(491),r=a(40284),n=a(22253),i=a(26468),o=a(82567),c=a(87279);var d=a(86006);const l=[];class u{static configure(e){return{module:u,configurations:{infrastructure:e}}}static addGlobalInterceptor(e){l.push(e)}}(u=(0,s.__decorate)([(0,d.Yl)({providers:[{asyncFactory:async(e,t)=>{const a=new i.e(e);return(await Promise.all(l.map((e=>t.create(e))))).forEach((e=>a.addInterceptor(e))),a},token:i.e,inject:[n.j,r.ModuleRef]}],configurations:{infrastructure:{token:n.j}},exports:[i.e],sharedModuleName:"http",domainName:"framework"})],u)).addGlobalInterceptor(class{intercept(e,t){return console.log(`[background/framework] HTTP ${e.method} request to ${e.url}`),t(e).pipe((0,o.b)((t=>{if((0,c.d6)(t))console.log(`[background/framework] HTTP request to ${e.url} succeeded`);else{"BadStatus"===(0,c.Yv)(t).tag?console.log(`[background/framework] Failure HTTP response from ${e.url} (${(0,c.Yv)(t).tag})`):console.log(`[background/framework] Failed to send HTTP request to ${e.url}`)}})))}constructor(){this.id="LoggingHttpInterceptor"}})},59163:(e,t,a)=>{a.r(t),a.d(t,{AcknowledgedChannel:()=>re.N,AllowedToFail:()=>Ke.J,AppLifeCycle:()=>o.d,AppLogger:()=>n.V,AppTimers:()=>c.O,BadStatus:()=>C.R,BaseEventEmitter:()=>ye.f,BufferedEventStream:()=>H.j,ChannelMessageBroker:()=>te.U,ChannelState:()=>ae.D,CommandHandler:()=>oe.W,CommandRefresherFactory:()=>le.u1,ConcurrencyTestTimers:()=>g,ContextLessCqrsClient:()=>ve.m,ContextlessBaseEventEmitter:()=>ye.C,CqrsBroker:()=>ue.d,CqrsClient:()=>ve.w,CqrsCommandRefresher:()=>le.Tx,CronLowLevelSource:()=>ze.R_,DIAGNOSTICS_ID_KEY:()=>W,DefaultEncryptionCodecForDeviceData:()=>Ie.h,DefaultEncryptionCodecForUserData:()=>Ie.s,DefaultLogger:()=>s.Mn,DefaultTimers:()=>s.mZ,DiagnosticsInit:()=>tt.A,DiagnosticsLogger:()=>J,DiagnosticsLogsSources:()=>at.U,DiagnosticsModule:()=>et.y,EventHandler:()=>de.b,ExceptionCriticalityValues:()=>L.T,ExceptionLogger:()=>j.v,ExceptionLoggingModule:()=>z.G,ExceptionLoggingSink:()=>M.qD,FetchFailedError:()=>C.a,FileDownloadEmitterChannel:()=>$e.o,FileDownloadListenerChannel:()=>qe,FileDownloadModule:()=>He.l,FileDownloadService:()=>Qe._,FileUploadBootstrap:()=>Ze.T,FileUploadListener:()=>Ye.P,FileUploadModule:()=>We.O,FileUploadedEventHandler:()=>Je,FileUploadedEventsEmitter:()=>Xe.i,FrameworkInit:()=>_.ar,FrameworkRequestContextValues:()=>Ge.l,Global:()=>_.xB,HttpBackend:()=>T.j,HttpClient:()=>D.e,HttpHeaders:()=>I.W,HttpModule:()=>O.X,HttpParams:()=>A.L,HttpRequest:()=>N.a,HttpResponse:()=>U.Z,HttpStatusCode:()=>F.W,Injectable:()=>_.GS,JsonApplicationResourceFetcher:()=>Ve.X,JsonApplicationResourceLoader:()=>Be.K,KeyValueStorageFactory:()=>Te.u,KeyValueStorageInfrastructure:()=>Ne.QI,MV3ExtensionHttpInterceptor:()=>P.I,MV3ExtensionResilienceModule:()=>x.f,MV3LongRunningTaskInterceptor:()=>R.V,MV3ServiceWorkerExtenderBase:()=>k.g,ManagedStorageInfrastructure:()=>Ne.Rx,ManualTriggeredTimers:()=>c.r,MemoryChannel:()=>ae.q,MemoryKeyValueStorageInfrastructure:()=>Ae.s,MemoryManagedStorageInfrastructure:()=>Ae.I,MemoryStoreInfrastructureFactory:()=>Ue.N,Module:()=>f.Yl,NoDynamicChannels:()=>se.y,NodeConfiguration:()=>ie.$,NodeEventBroker:()=>pe.a,NodeModulesIntrospection:()=>b.Q1,NodeToModuleEventBroker:()=>he,NullCronTaskHandler:()=>ze.ql,NullLogger:()=>n.W,NullLoggingSink:()=>M.p$,NullStorage:()=>Ne.hL,ParameterProviderType:()=>v.j,QueryHandler:()=>ce.e,RequestContext:()=>Ge.f,RequestContextModule:()=>Ce.q,SingleNodeAppBuilder:()=>i.u,Store:()=>xe.y,StoreCapacity:()=>De.Y,StoreFlusher:()=>Pe.X,StoreInfrastructureFactory:()=>Ue.G,TaskTrackingClient:()=>G,TaskTrackingModule:()=>V.c,ThrowJsonFetcher:()=>s.kl,TimerBasedCronSource:()=>ze._C,UncaughtErrorSource:()=>M.fW,VerboseLogger:()=>s.IO,createApplicationClient:()=>_e,createCqrsClient:()=>ge.c,createCqrsClients:()=>ge.R,createNullExceptionLogger:()=>j.G,createSingleChannelListener:()=>se.v,defineApplication:()=>i.t,defineBatchExecutor:()=>je,defineStore:()=>Fe.Q,deviceScopedSingletonProvider:()=>E.H,getQueryValue:()=>Ee,getStoresProviders:()=>Oe.N,isExceptionLogEntry:()=>L.h,isSendMessageRequest:()=>ne.F,isVersionedData:()=>Ne.Ot,makeDiagnosticsLogger:()=>ee,mockTimer:()=>h,provideClass:()=>y.$,provideValue:()=>y.z,refresherCreationToken:()=>le.b2,scopedSingleton:()=>w.B,sendMessageRequest:()=>ne.k,startApplicationNode:()=>r.u,startSingleApplicationNode:()=>r.W,useEventsOfModule:()=>f.g4,userScopedSingletonProvider:()=>S.M});var s=a(68860),r=a(94006),n=a(90318),i=a(52357),o=a(15295),c=a(75354),d=a(83695),l=a(78263),u=a(87065),p=a(6220),m=a(98187);function h(e,t,a,s){const r=[];if(t<a)return[];if(e<a){if(r.push(a),0===s)return r;let e=a+s;for(;e<=t;)r.push(e),e+=s;return r}if(s<=0)return[];let n=a+(Math.trunc((e-a)/s)+1)*s;for(;n<=t;)r.push(n),n+=s;return r}class g extends c.O{fireTimer(e=1){this.time=this.time+e,this.source$.next(this.time)}createObservableTimer(e,t){return this.source$.pipe((0,d.O)(0),(0,l.G)(),(0,u.U)((([a,s])=>h(a,s,e,t))),(0,p.z)((e=>e)))}constructor(...e){super(...e),this.source$=new m.x,this.time=0}}var v=a(20491),y=a(91743),f=a(86006),_=a(92587),b=a(4373),S=a(77198),w=a(77761),E=a(86213),C=a(73155),T=a(22253),I=a(85260),A=a(61223),N=a(4043),U=a(12964),F=a(25994),D=a(26468),O=a(75421),P=a(36490),x=a(42631),R=a(57197),k=a(22366),L=a(9036),M=a(57882),j=a(89422),z=a(11553),V=a(38566),B=a(8260),K=a(72885);class G extends((0,B.E)(K.e)){}(0,B.K)(K.e,G);var q=a(6721),$=a(52913),Q=a(6523),H=a(36610);const W="diagnostics-data";let Y=null,X=null,Z=!1;class J{getLogsStream$(){return this.bufferedEventStream.events$}async startDiagnosticsSession(){if(await this.initDiagnosticSession(),Y)return;const e=(new Date).getTime()+1728e5;Y=crypto.randomUUID(),X=e;const t={id:Y,ttl:e};await(0,q.t)({[W]:t})}async log({message:e,metadata:t}){if(await this.initDiagnosticSession(),this.shouldLog()&&Y){const a={message:e,diagnosticsId:Y,timestamp:Date.now(),container:this.container,module:this.module,domain:this.domain,metadata:t},s=this.container&&this.module?`[${this.container}/${this.module}]`:"";if(console.log(`%c${s} ${a.message}`,"font-size: 9px; opacity: 0.6;",a),!this.emit)throw new Error("emit has not been set in DiagnosticsLogger");this.emit(a)}}async clear(){await(0,$.O)(W),Y=null,X=null}async getDiagnosticsSessionInfo(){return await this.initDiagnosticSession(),{diagnosticsId:Y,diagnosticsTTL:X}}async initDiagnosticSession(){Z||(await this.loadDiagnosticsSessionFromLocalStorage(),this.isTTLValid(X)||this.clear(),Z=!0)}isTTLValid(e){const t=new Date;return!(!e||t.getTime()>e)}async loadDiagnosticsSessionFromLocalStorage(){try{const e=(await(0,Q.U)([W]))[W];if(!e?.id)return;X=e.ttl,Y=e.id}catch(e){console.log("error",e)}}shouldLog(){return Y&&this.isTTLValid(X)}constructor(e){this.container=e.container,this.module=e.module,this.domain=e.domain,this.bufferedEventStream=new H.j({addListener:e=>{this.emit=t=>e(t,{})},removeListener:()=>{}},(e=>!0))}}function ee(e){return new J(e)}var te=a(10826),ae=a(66853),se=a(57934),re=a(12335),ne=a(57042),ie=a(40443),oe=a(82874),ce=a(46449),de=a(85798),le=a(2198),ue=a(93223),pe=a(59590),me=a(28489);class he{connect(e){const{localSubscribersMap:t,broker:a}=this;return a.connect({onLocalEvent:async(a,s,r,n,i,o)=>{const c=t[a][r];await Promise.all(c.map((async t=>{await e.onEvent(a,t,r,n,i,o)})))}})}constructor(e){this.publishEvent=(e,t,a,s)=>this.broker.publishEvent(e,t,a,s),this.broker=new pe.a(e);const t=e.getModuleNames().reduce(((t,a)=>({...t,[a]:Object.keys(e.appDefinition[a].api.events).reduce(((e,t)=>(e[t]=[],e)),(0,me.Ay)({}))})),(0,me.Ay)({}));this.localSubscribersMap=Object.keys(e.subscriptions).map((e=>e)).reduce(((t,a)=>{const s=e.subscriptions[a];return Object.keys(s).map((e=>e)).forEach((e=>{const r=s[e]??[],n=t[e];r.forEach((e=>{n[e].push(a)}))})),t}),t)}}var ge=a(93787),ve=a(53932),ye=a(13800),fe=a(38430);function _e({appDefinition:e,channels:t,channelsListener:a}){const s={...e,[fe.P.name]:{api:fe.P,main:"background",queryOnly:[]}},r=new ie.$({appDefinition:s,channels:t,channelsListener:a,currentNode:null,subscriptions:{}}),n=new ue.d(r),i=()=>{throw new Error("Unexpected request received by detached application client")},o=n.connect({onCommand:i,onQuery:i}).start();return{client:(0,ge.R)(e,n),stop:async()=>(await o).stop()}}var be=a(27149),Se=a(60399),we=a(89618);async function Ee(e,t=1e4){if(!(0,be.b)(e))throw new Error("Error in getQueryValue: the argument is not an observable");try{return await(0,Se.z)(e.pipe((0,we.V)({first:t})))}catch(e){throw new Error("Error in getQueryValue: "+e)}}var Ce=a(61869),Te=a(25085),Ie=a(96812),Ae=a(79386),Ne=a(60785),Ue=a(41718),Fe=a(63144),De=a(56618),Oe=a(60107),Pe=a(63419),xe=a(62200),Re=a(64987);const ke=16,Le=.5,Me=1.3;function je(e){var t;const{chunkControl:{decrement:a=Le,increment:s=Me,initialSize:r=ke}={decrement:Le,increment:Me,initialSize:ke}}=e;const n=new Re.WU;return(t=class{async dispatchBatch(e){await n.runExclusive((async()=>{const t=await this.pushItemsInQueue(e);for(;t.queue.length>0;)await this.processOneChunkFromQueue(t)}))}async pushItemsInQueue(t){const a=await this.repository.getBatchState(e.name),s=t.filter((e=>!a.queue.find((t=>t===e))));return s.length&&(a.queue.push(...s),await this.repository.setBatchState(e.name,a)),a}async processOneChunkFromQueue(t){const n=function(e){const{lastStartedChunkFirstId:t,lastStartedChunkSize:n=r}=e;if(!t)return r;const i=!e.queue.find((e=>e===t));return Math.max(1,i?Math.ceil(n*s):Math.floor(n*a))}(t),i=Math.min(n,t.queue.length);if(!i)throw new Error("Should have something to process");await this.repository.setBatchState(e.name,{...t,lastStartedChunkSize:i,lastStartedChunkFirstId:t.queue[0]});const o=t.queue.splice(0,i);await this.processor.processChunk(o),await this.repository.setBatchState(e.name,t)}constructor(e,t){this.repository=e,this.processor=t}}).Definition=e,t}var ze=a(31857),Ve=a(23337),Be=a(7531),Ke=a(50423),Ge=a(16712);class qe{}var $e=a(72693),Qe=a(79594),He=a(48302),We=a(49699),Ye=a(87201),Xe=a(34319),Ze=a(95962);class Je{handle({body:e}){return e.uploadKey===this.uploadKey?Promise.resolve(this.handleUploadedFile(e.fileUploadData)):Promise.resolve(void 0)}constructor(e){this.uploadKey=e}}var et=a(35273),tt=a(76568),at=a(15160)},89422:(e,t,a)=>{a.d(t,{G:()=>d,v:()=>c});var s=a(491),r=a(76301),n=a(90318),i=a(57882),o=a(9036);class c{setEnableExceptionLogsSend(e){this.enableExceptionLogsSend=e}captureException(e,t,a=o.T.CRITICAL){if(!this.enableExceptionLogsSend)return Promise.resolve();try{const s=e instanceof Error?e:new Error("Invalid exception type",{cause:e}),r=this.createExceptionLogEntry(t,s,a);return this.sink.logException(r)}catch(a){this.logger.error("Failed to capture exception",a,e,t)}return Promise.resolve()}createExceptionLogEntry(e,t,a){return{callStack:t.stack??"",criticality:a,featuresFlipped:this.mapFeatures(e.featureFlips??{}),fileLocation:e.fileLocation,lineNumber:e.lineNumber,message:t.message,moduleName:e.moduleName,domainName:e.domainName,origin:e.origin,timestamp:Date.now(),useCaseId:e.useCaseId,useCaseName:e.useCaseName,useCaseStacktrace:e.useCaseStacktrace,cause:JSON.stringify(t.cause instanceof Error?{message:t.cause.message,stack:t.cause.stack}:t.cause)}}mapFeatures(e){return Object.keys(e).reduce(((t,a)=>e[a]?[a,...t]:t),[])}constructor(e,t){this.sink=e,this.logger=t,this.enableExceptionLogsSend=!0}}function d(){return new c(new i.p$,new n.W)}c=(0,s.__decorate)([(0,r.Injectable)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.qD?Object:i.qD,void 0===n.V?Object:n.V])],c)},53466:(e,t,a)=>{a.d(t,{I:()=>o});var s=a(17350),r=a(57882),n=a(91743);let i=class extends r.fW{constructor(){super(s.E)}};const o={sink:(0,n.z)(new class{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}),uncaughtErrorSource:(0,n.z)(new i)}},57882:(e,t,a)=>{a.d(t,{fW:()=>n,p$:()=>r,qD:()=>s});class s{}class r extends s{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}class n{constructor(e){this.events$=e}}},52274:(e,t,a)=>{a.d(t,{cI:()=>f,ph:()=>b,xz:()=>S});var s=a(491),r=a(76301),n=a(25313),i=a(60399),o=a(82567),c=a(37182),d=a(87065),l=a(23297),u=a(96498),p=a(87279),m=a(16712),h=a(89422),g=a(49405),v=a(53932),y=a(4373);class f extends Error{constructor(e,t){super("ApplicationRequestError"),this.exception=e,this.useCaseStacktrace=t}}let _=!0;function b(){console.log("[background/framework] Disabling verbose logging of incoming requests"),_=!1}class S{intercept(e,t){const a=e.getArgByIndex(0);return _&&console.log(`[background/framework] Processing incoming request (name: ${a.name}, type: ${a.type})`),t.handle().pipe((0,o.b)((()=>{_&&console.log(`[background/framework] Done processing incoming request (name: ${a.name}, type: ${a.type})`)})),(0,c.K)(this.handleException(a)))}handleException(e){const{useCaseStacktraceRepo:t}=this;return a=>{if(console.error(`[background/framework] Error wile processing incoming request (name: ${e.name}, type: ${e.type})`,a),t.isInitialUseCase()){const[s,r]=a instanceof f?[a.exception,a.useCaseStacktrace]:[a,t.read()];return this.captureException(e,s,r),(0,n._)((()=>s))}const s=a instanceof f?a:new f(a,t.read());return(0,n._)((()=>s))}}async getUserFeatureFlips(){if(!await(0,i.z)(this.requestContextClient.queries.activeUser().pipe((0,d.U)((e=>(0,p.d6)(e)&&!!(0,p.db)(e).userName)))))return Promise.resolve({});const{queries:{userFeatureFlips:e}}=this.cqrsClient.getClient(l.cV);return await(0,i.z)(e().pipe((0,d.U)((e=>(0,p.d6)(e)?(0,p.db)(e):{}))))}async captureException(e,t,a){const s=e.module,r=this.nodeModulesIntrospection.modules[s].domainName??"unknown";this.logger.captureException(t,{domainName:r,moduleName:s,useCaseName:e.name,useCaseId:e.context.get(m.l.UseCaseId),featureFlips:await this.getUserFeatureFlips(),useCaseStacktrace:a})}constructor(e,t,a,s,r){this.logger=e,this.useCaseStacktraceRepo=t,this.cqrsClient=a,this.requestContextClient=s,this.nodeModulesIntrospection=r}}S=(0,s.__decorate)([(0,r.Injectable)({scope:r.Scope.REQUEST}),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h.v?Object:h.v,void 0===g.F?Object:g.F,void 0===v.w?Object:v.w,void 0===u.Q?Object:u.Q,void 0===y.Q1?Object:y.Q1])],S)},11553:(e,t,a)=>{a.d(t,{G:()=>P});var s=a(491),r=a(40284),n=a(38430),i=a(86006),o=a(89422),c=a(53466),d=a(57882),l=a(15295),u=a(92587),p=a(52274),m=a(9036);class h{handle(e){const{error:t,fileLocation:a,lineNumber:s,origin:r}=e,[n,i]=t instanceof p.cI?[t.exception,t.useCaseStacktrace]:[t];return this.logger.captureException(n,{fileLocation:a,lineNumber:s,origin:r,useCaseStacktrace:i},m.T.CRITICAL)}constructor(e){this.logger=e}}h=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.v?Object:o.v])],h);class g{onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const{stop:e}=await this.sink.start(),t=this.uncaughtErrorsSource.events$.subscribe(this.onUncaughtErrorEvent.bind(this));return()=>{t.unsubscribe(),e()}}))}onUncaughtErrorEvent(e){this.moduleRef.get(h).handle(e)}constructor(e,t,a,s){this.sink=e,this.lifeCycle=t,this.moduleRef=a,this.uncaughtErrorsSource=s}}g=(0,s.__decorate)([(0,u.ar)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.qD?Object:d.qD,void 0===l.d?Object:l.d,void 0===r.ModuleRef?Object:r.ModuleRef,void 0===d.fW?Object:d.fW])],g);var v=a(49405),y=a(87279),f=a(68327),_=a(82874),b=a(60399),S=a(87065),w=a(89618),E=a(37182),C=a(69885),T=a(76301),I=a(43651),A=a(90318),N=a(16712);class U{async report(e){const t=e.moduleNameOverride??this.request?.module,a=e.useCaseNameOverride??this.request?.name,s=e.additionalInfo,r=e.useCaseIdOverride??this.request?.context.get(N.l.UseCaseId),n=await this.getUserFeatureFlips();try{const i=Date.now(),o=e.anomalyType===f._F.EXCEPTION?{callStack:e.callStack,criticality:e.criticality,featuresFlipped:n,fileLocation:e.fileLocation,lineNumber:e.lineNumber,message:e.message,moduleName:t,origin:e.origin,timestamp:i,useCaseId:r,useCaseName:a,useCaseStacktrace:e.useCaseStacktrace,cause:s}:{criticality:e.criticality,featuresFlipped:n,message:e.message,timestamp:i,cause:s};await this.sink.logException(o)}catch(t){this.logger.error("Failed to report anomaly",e)}return Promise.resolve()}async getUserFeatureFlips(){if(this.cachedFeatureFlips)return this.cachedFeatureFlips;const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,b.z)(e().pipe((0,S.U)((e=>(0,y.d6)(e)?(0,y.db)(e):{})),(0,w.V)(50),(0,E.K)((()=>(0,C.of)({})))));this.cachedFeatureFlips=Object.keys(t).filter((e=>!!t[e]))}constructor(e,t,a,s){this.sink=e,this.logger=t,this.featureFlips=a,this.request=s,this.cachedFeatureFlips=void 0}}U=(0,s.__decorate)([(0,T.Injectable)(),(0,s.__param)(3,(0,T.Inject)(r.REQUEST)),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.qD?Object:d.qD,void 0===A.V?Object:A.V,void 0===I.P?Object:I.P,Object])],U);class F{async execute({body:e}){return this.reporter.report({...e,criticality:e.criticality,message:e.message,moduleNameOverride:e.moduleName,useCaseNameOverride:e.useCaseName,additionalInfo:e.additionalInfo??""}),Promise.resolve((0,y.Vp)(void 0))}constructor(e){this.reporter=e}}F=(0,s.__decorate)([(0,_.W)(f.SU),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===U?Object:U])],F);var D=a(41597);class O{execute({body:{flag:e}}){return this.logger.setEnableExceptionLogsSend(e),Promise.resolve((0,y.Vp)(void 0))}constructor(e){this.logger=e}}O=(0,s.__decorate)([(0,_.W)(D.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o.v?Object:o.v])],O);class P{static configure(e){return{module:P,configurations:{...c.I,sink:e.sink,...e.uncaughtErrorSource?{uncaughtErrorSource:e.uncaughtErrorSource}:{}}}}}P=(0,s.__decorate)([(0,i.Yl)({api:n.P,handlers:{commands:{reportAnomaly:F,enableExceptionLog:O},events:{},queries:{}},providers:[U,o.v,{provide:r.APP_INTERCEPTOR,useClass:p.xz},v.F,h],configurations:{sink:{token:d.qD},uncaughtErrorSource:{token:d.fW}},exports:[o.v,v.F],onFrameworkInit:g,requiredFeatureFlips:[],domainName:"framework"})],P)},9036:(e,t,a)=>{a.d(t,{T:()=>s,h:()=>r});const s=Object.freeze({WARNING:"warning",CRITICAL:"critical"});function r(e){return!(!e||"object"!=typeof e)&&("criticality"in e&&"timestamp"in e&&"message"in e&&"callStack"in e&&((e.criticality===s.CRITICAL||e.criticality===s.WARNING)&&"string"==typeof e.message&&"string"==typeof e.callStack))}},49405:(e,t,a)=>{a.d(t,{F:()=>o});var s=a(491),r=a(76301),n=a(16712);const i="USE_CASE_STACKTRACE";class o{isInitialUseCase(){return(this.requestContext.get(i)??[]).length<=1}read(){return this.requestContext.getOrAddSync(i,(()=>[]))??[]}append(e){const{requestContext:t}=this,a=t.get(i)??[];t.set(i,[...a,e])}constructor(e){this.requestContext=e}}new(o=(0,s.__decorate)([(0,r.Injectable)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.f?Object:n.f])],o))(new n.f)},38566:(e,t,a)=>{a.d(t,{c:()=>E});var s=a(491),r=a(72885),n=a(86006),i=a(95393),o=a(87279),c=a(82874),d=a(62149),l=a(63144),u=a(56618);const p=e=>"object"==typeof e&&null!==e&&"swStartTime"in e&&"taskTrackingList"in e&&"string"==typeof e.swStartTime&&"object"==typeof e.taskTrackingList;class m extends((0,l.Q)({persist:!1,initialValue:{swStartTime:"",taskTrackingList:{}},scope:d.F.Device,storeName:"task-tracking",storeTypeGuard:p,capacity:u.Y._001KB})){}class h{async execute({body:e}){const t=(new Date).toISOString(),{taskName:a,feature:s,businessDomain:r}=e,n={taskName:a,feature:s,businessDomain:r,startTime:t,serviceWorkerInterruptionCount:0},i=await this.store.getState();return await this.store.set({...i,taskTrackingList:{...i.taskTrackingList,[t]:n}}),Promise.resolve((0,o.Vp)({id:t}))}constructor(e){this.store=e}}h=(0,s.__decorate)([(0,c.W)(i.g),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m?Object:m])],h);var g=a(14122),v=a(50756),y=a(15295),f=a(92587);class _{onFrameworkInit(){this.appLifecycle.addAppReadyHook((async()=>{const e=await this.store.getState(),t={...e.taskTrackingList},a=Object.keys(e.taskTrackingList).map((async a=>{const{taskName:s,feature:r,businessDomain:n,startTime:i}=e.taskTrackingList[a],o=new v.UserMv3ExtensionTaskInterruptionEvent({businessDomain:n,feature:r,taskName:s,taskStartDateTime:i,serviceWorkerStartDateTime:e.swStartTime}),c=this.carbonLegacyClient;await c.commands.carbon({name:"logEvent",args:[{event:o}]}),delete t[a]}));await Promise.all(a),await this.store.set({swStartTime:(new Date).toISOString(),taskTrackingList:t})}))}constructor(e,t,a){this.store=e,this.carbonLegacyClient=t,this.appLifecycle=a}}_=(0,s.__decorate)([(0,f.ar)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m?Object:m,void 0===g._?Object:g._,void 0===y.d?Object:y.d])],_);var b=a(72023),S=a(90318);class w{async execute({body:e}){const{taskTrackingId:t}=e,a=await this.store.getState(),s=a.taskTrackingList[t];if(!s)return this.logger.trace("Trying to track a task that does not exist"),(0,o.Vp)(void 0);const{taskName:r,feature:n,businessDomain:i,startTime:c,serviceWorkerInterruptionCount:d}=s,l=new v.UserMv3ExtensionTaskReportEvent({businessDomain:i,feature:n,serviceWorkerInterruptionCount:d,serviceWorkerStartDateTime:a.swStartTime,taskName:r,taskStartDateTime:c,taskEndDateTime:(new Date).toISOString()}),u=this.carbonLegacyClient;await u.commands.carbon({name:"logEvent",args:[{event:l}]});const p={...a.taskTrackingList};return delete p[t],await this.store.set({swStartTime:a.swStartTime,taskTrackingList:p}),(0,o.Vp)(void 0)}constructor(e,t,a){this.store=e,this.carbonLegacyClient=t,this.logger=a}}w=(0,s.__decorate)([(0,c.W)(b.y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m?Object:m,void 0===g._?Object:g._,void 0===S.V?Object:S.V])],w);class E{}E=(0,s.__decorate)([(0,n.Yl)({api:r.e,handlers:{commands:{startTaskTracking:h,terminateTaskTracking:w},events:{},queries:{}},stores:[m],onFrameworkInit:_,providers:[],domainName:"framework"})],E)},12335:(e,t,a)=>{a.d(t,{N:()=>f});var s=a(6136),r=a(98187),n=a(15023),i=a(41842),o=a(16433),c=a(89618),d=a(37182),l=a(17350),u=a(97280),p=a(42946),m=a(162),h=a(2049),g=a(6220),v=a(7074),y=a(78776);class f{constructor(e,t=3e4){const a=e.status$.pipe((0,s.x)());let f=!1;const _=new r.x,b=_.pipe((0,g.z)((async s=>{const r=(0,y.Z)();let g=!1;const v=e.messages$.pipe((0,n.o)((()=>!f)),(0,i.h)((e=>"acknowledgement"===e.type&&e.id===r)),(0,o.q)(1),(0,c.V)(t),(0,d.K)((()=>l.E)),(0,u.d)(1)),_=v.subscribe((()=>{g=!0,_.unsubscribe()})),b=a.pipe((0,n.o)((()=>!g&&!f)),(0,p.z)((()=>(0,m.D)(e.sendMessage({type:"send",id:r,message:s.message}))))).subscribe();try{await(0,h.n)(v),b.unsubscribe(),s.resolve()}catch(e){b.unsubscribe(),s.reject(e)}}))).subscribe();this.stop=()=>(f=!0,b.unsubscribe(),e.stop()),this.send=e=>new Promise(((t,a)=>{const s={message:e,resolve:t,reject:a};_.next(s)})),this.channelState$=e.status$,this.receivedMessages$=e.messages$.pipe((0,i.h)((e=>"send"===e.type)),(0,g.z)((async t=>{if("send"===t.type)return await e.sendMessage({type:"acknowledgement",id:t.id}),t.message})),(0,v.B)())}}},10826:(e,t,a)=>{a.d(t,{U:()=>E});var s=a(24966),r=a(2049),n=a(41842),i=a(6220),o=a(162),c=a(87065),d=a(37182),l=a(69885),u=a(64659);const p=e=>{if(!e||"object"!=typeof e)return!1;return"unSubscription"===e.type},m=(e,t,a)=>{const s=new Set(a),r=new Map,m=t.receivedMessages$.pipe((0,n.h)(p)).subscribe((e=>{const t=r.get(e.id);t?.unsubscribe(),r.delete(e.id)})),h=t.receivedMessages$.pipe((0,n.h)((e=>{return!(!(t=e)||"object"!=typeof t)&&"start"===t.type&&s.has(e.definition.destination)&&!r.has(e.definition.id);var t})),(0,i.z)((e=>(0,o.D)((async e=>(r.set(e.definition.id,{unsubscribe:()=>{}}),await t.send({type:"initial-acknowledgement",id:e.definition.id}),e))(e))))).subscribe((a=>{const s=a.definition.destination,n=e(s,a.definition.content,a.metadata),p={type:"end",id:a.definition.id},m=n.pipe((0,c.U)((e=>({id:a.definition.id,data:e,type:"data"}))),(0,d.K)((e=>{const t={id:a.definition.id,type:"error",errorMessage:e.message};return(0,l.of)(t)})),(0,u.l)(p),(0,i.z)((e=>(0,o.D)(t.send(e))))).subscribe();r.set(a.definition.id,{unsubscribe:()=>{m.unsubscribe()}})}));return{unsubscribe:()=>{h.unsubscribe(),m.unsubscribe();for(const e of r.values())e.unsubscribe()}}};var h=a(58376),g=a(85390),v=a(15023),y=a(6136),f=a(42946),_=a(60399),b=a(66853),S=a(78776);var w=a(28489);class E{connect(e,t){let a=!1;return{start:()=>{if(a)throw new Error("Already started");a=!0;const s=e=>m(((e,t,a)=>this.routes[e].send(e,t,a)),e,Object.keys(this.routes)),r=e.map(s),n=new Map,i=t.connectedChannels$.subscribe((e=>{const t=[...n.entries()].filter((([t])=>!(t in e))),a=Object.keys(e).filter((e=>!n.has(e)));t.forEach((([e,t])=>{n.delete(e),t.unsubscribe()})),a.forEach((t=>{const a=e[t],r=s(a);n.set(t,r)}))}));return Promise.resolve({stop:()=>([...r,i,...n.values()].forEach((e=>e.unsubscribe())),this.stopped$.next(!0),Promise.resolve())})}}}ensureMessageSerializable(e,t){0}sendMessage(e,t){return this.ensureMessageSerializable(e,t),this.routes[e].send(e,t,{isReminder:!1})}trySendMessage(e,t){return this.ensureMessageSerializable(e,t),this.routes[e].trySend(e,t,{isReminder:!1})}constructor(e){this.stopped$=new s.X(!1);const t={routes:(0,w.Ay)({})};this.routes=(()=>{const{routes:a}=Object.keys(e).reduce(((t,a)=>{const s=e[a];if("local"===s.type&&(t.routes[a]={send:s.onMessage,trySend:async(...e)=>(await(0,r.n)(s.onMessage(...e)),!0)}),"remote"===s.type){const e=((e,t)=>{const a=(a,s,r)=>{const i={content:s,destination:String(a),id:(0,S.Z)()};return new h.y((a=>{let s={type:"start",definition:i,metadata:r};const d=(0,g.a)({message:e.receivedMessages$,stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,c.U)((({message:e})=>e))).subscribe((e=>{var t;(t=e)&&"object"==typeof t&&"initial-acknowledgement"===t.type&&e.id===i.id?s={...s,metadata:{...s.metadata,isReminder:!0}}:(e=>!(!e||"object"!=typeof e)&&"data"===e.type)(e)&&e.id===i.id?a.next(e.data):(e=>!(!e||"object"!=typeof e)&&"error"===e.type)(e)&&e.id===i.id?a.error(new Error(e.errorMessage)):(e=>!(!e||"object"!=typeof e)&&"end"===e.type)(e)&&e.id===i.id&&a.complete()})),l=(0,g.a)({sendTimes:e.channelState$.pipe((0,y.x)(),(0,n.h)((e=>e===b.D.Connected))),stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,f.z)((()=>(0,o.D)(e.send(s))))).subscribe();return()=>{e.send({type:"unSubscription",id:i.id}),l.unsubscribe(),d.unsubscribe()}}))};return{send:a,trySend:async(t,s,n)=>await(0,_.z)(e.channelState$)===b.D.Connected&&(await(0,r.n)(a(t,s,n)),!0)}})(s.channel,this.stopped$);t.routes[a]=e}return t}),t);return a})()}}},66853:(e,t,a)=>{a.d(t,{D:()=>s,q:()=>i});var s,r=a(98187),n=a(24966);!function(e){e.Connected="Connected",e.Disconnected="Disconnected"}(s||(s={}));class i{send(e){if("Connected"!==this.channelStateSubject$.value)throw new Error("Channel is not connected");return this.sentMessages$.next(e),Promise.resolve()}get receivedMessages$(){return this.receivedMessagesSubject$}get channelState$(){return this.channelStateSubject$}stop(){this.receivedMessages$.complete()}connect(e){if("Connected"===this.channelStateSubject$.value)return{disconnect:()=>{}};const t=this.sentMessages$.subscribe((t=>{e.receivedMessages$.next(t)}));return this.channelState$.next("Connected"),{disconnect:()=>{this.channelState$.next("Disconnected"),t.unsubscribe()}}}constructor(){this.sentMessages$=new r.x,this.receivedMessagesSubject$=new r.x,this.channelStateSubject$=new n.X("Disconnected")}}},57934:(e,t,a)=>{a.d(t,{v:()=>n,y:()=>r});var s=a(24966);const r={connectedChannels$:new s.X({})},n=e=>({connectedChannels$:new s.X({channel:e})})},57042:(e,t,a)=>{a.d(t,{F:()=>r,k:()=>s});const s=({channelName:e,message:t})=>({channelName:e,message:t,type:"graphene-message"}),r=e=>{if(!e||"object"!=typeof e)return!1;return"graphene-message"===e.type}},40443:(e,t,a)=>{a.d(t,{$:()=>s});class s{getNodeList(){return this.currentNode?[...this.getRemoteNodeList(),this.currentNode]:this.getRemoteNodeList()}getRemoteNodeList(){return Object.keys(this.channels)}getModuleNames(){return Object.keys(this.appDefinition)}constructor(e){this.appDefinition=e.appDefinition,this.currentNode=e.currentNode,this.channels=e.channels,this.subscriptions=e.subscriptions,this.channelsListener=e.channelsListener}}},36490:(e,t,a)=>{a.d(t,{I:()=>p});var s=a(491),r=a(97280),n=a(83896),i=a(16433),o=a(66189),c=a(76301),d=a(22366),l=a(75354);const u=2e4;class p{intercept(e,t){if(e.timeout<3e4)return t(e);console.log("[background/mv3-extension-resilience] Starting heartbeat sequence to extend SW lifetime during HTTP request");const a=t(e).pipe((0,r.d)(1));return this.timers.createObservableTimer(u,u).pipe((0,n.R)(a),(0,i.q)(Math.trunc(e.timeout/u)),(0,o.x)((()=>{console.log("[background/mv3-extension-resilience] Ending heartbeat sequence to extend SW lifetime during HTTP request")}))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),a}constructor(e,t){this.timers=e,this.mv3ServiceWorkerExtender=t,this.id="MV3ExtensionHttpInterceptor"}}p=(0,s.__decorate)([(0,c.Injectable)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.O?Object:l.O,void 0===d.g?Object:d.g])],p)},42631:(e,t,a)=>{a.d(t,{f:()=>l});var s=a(491),r=a(36490),n=a(22366),i=a(57197),o=a(46096),c=a(75421),d=a(86006);class l{static configure(e){return c.X.addGlobalInterceptor(r.I),o.b.addGlobalNestInterceptor(i.V),{module:l,configurations:{mv3SwExtend:e}}}}l=(0,s.__decorate)([(0,d.Yl)({sharedModuleName:"mv3ExtensionResilience",configurations:{mv3SwExtend:{token:n.g}},providers:[r.I,i.V],exports:[r.I,i.V],domainName:"framework"})],l)},57197:(e,t,a)=>{a.d(t,{V:()=>p});var s=a(491),r=a(97280),n=a(83896),i=a(16433),o=a(76301),c=a(6178),d=a(75354),l=a(22366);const u=2e4;class p{intercept(e,t){const a=e.switchToHttp().getRequest();if(a.type===c.Y.Command||a.type===c.Y.Cron||a.type===c.Y.Event){const e=t.handle().pipe((0,r.d)(1));return this.timers.createObservableTimer(u,u).pipe((0,n.R)(e),(0,i.q)(Math.trunc(45))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),e}return t.handle()}constructor(e,t){this.timers=e,this.mv3ServiceWorkerExtender=t}}p=(0,s.__decorate)([(0,o.Injectable)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.O?Object:d.O,void 0===l.g?Object:l.g])],p)},22366:(e,t,a)=>{a.d(t,{g:()=>s});class s{}},16712:(e,t,a)=>{a.d(t,{f:()=>r,l:()=>s});const s={UseCaseId:"USE_CASE_ID",UserName:"USER_NAME"};class r{get(e){return this.entries[e]}getOrDefault(e,t){return this.entries[e]??t}getOrFail(e,t){if(!this.has(e)){throw new Error(t?.errorMessage??`No ${e} in request context`)}return this.entries[e]}has(e){return e in this.entries}async getOrAdd(e,t){return this.has(e)||this.set(e,await t()),this.get(e)}getOrAddSync(e,t){return this.has(e)||this.set(e,t()),this.get(e)}set(e,t){this.entries[e]=t}toSerializable(){return this.entries}static fromSerializable(e){const t=new r;for(const[a,s]of Object.entries(e))t.entries[a]=s;return t}clone(){return r.fromSerializable(JSON.parse(JSON.stringify(this.toSerializable())))}withValue(e,t){return this.set(e,t),this}constructor(){this.entries={}}}},23337:(e,t,a)=>{a.d(t,{X:()=>s});class s{}},7531:(e,t,a)=>{a.d(t,{K:()=>c});var s=a(491),r=a(162),n=a(25859),i=a(92587),o=a(23337);class c{async load(){await this.get()}async get(){const{value:e}=this;if(e)return e;const t=await this.fetcher.fetch(this.url),a=await this.loadResource(t);return this.value=a,a}constructor(e,t){this.url=e,this.fetcher=t,this.value$=(0,r.D)((0,n.P)((()=>this.get())))}}c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[String,void 0===o.X?Object:o.X])],c)},61869:(e,t,a)=>{a.d(t,{q:()=>w});var s=a(491),r=a(87279),n=a(66335),i=a(87065),o=a(6136),c=a(62149),d=a(63144),l=a(56618);const u=e=>!(!e||"object"!=typeof e)&&"userName"in e;class p extends((0,d.Q)({initialValue:{userName:void 0},persist:!1,scope:c.F.Device,storeName:"active-user-store",storeTypeGuard:u,capacity:l.Y._001KB})){}var m=a(46449),h=a(82874),g=a(13800),v=a(92587);class y extends g.f{}y=(0,s.__decorate)([(0,v.GS)()],y);var f=a(52274);class _{execute(){return this.activeUserStore.state$.pipe((0,i.U)((e=>e.userName)),(0,o.x)(),(0,i.U)((e=>(0,r.Vp)({userName:e}))))}constructor(e){this.activeUserStore=e}}_=(0,s.__decorate)([(0,m.e)(n.p),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p])],_);class b{async execute({body:{userName:e}}){return(await this.activeUserStore.getState()).userName===e||(await this.activeUserStore.set({userName:e}),e?((0,f.ph)(),console.log("[background/framework] Active user set"),this.eventEmitter.sendEvent("activeUserSet",{userName:e})):console.log("[background/framework] Active user unset")),(0,r.Vp)(void 0)}constructor(e,t){this.activeUserStore=e,this.eventEmitter=t}}b=(0,s.__decorate)([(0,h.W)(n.r$),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p,void 0===y?Object:y])],b);var S=a(86006);class w{}w=(0,s.__decorate)([(0,S.Yl)({api:n.t$,handlers:{commands:{setActiveUser:b},events:{},queries:{activeUser:_}},stores:[p],providers:[y],domainName:"framework"})],w)},68860:(e,t,a)=>{a.d(t,{IO:()=>c,Mn:()=>o,kl:()=>l,mZ:()=>d});var s=a(90171),r=a(75354),n=a(90318),i=a(23337);class o extends n.V{log(){}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class c extends n.V{log(e,...t){return console.log(e,t)}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class d extends r.O{get time(){return Date.now()}createObservableTimer(e,t){return(0,s.H)(e,t)}}class l extends i.X{fetch(){return Promise.reject(new Error("Please add a jsonFetcher to the application. Probably you are seing that in unit tests.\nIf this is the case, please mock whatever service is requiring to fetch the data"))}}},96812:(e,t,a)=>{a.d(t,{h:()=>n,s:()=>i});var s=a(491),r=a(76301);class n{}n=(0,s.__decorate)([(0,r.Injectable)()],n);class i{}i=(0,s.__decorate)([(0,r.Injectable)()],i)},25085:(e,t,a)=>{a.d(t,{u:()=>r});class s{clear(){return this.storage.remove(this.baseKey)}async read(){const e=await this.storage.get(this.baseKey);return!e&&this.initialValueFactory?await this.initialValueFactory():e}async write(e){await this.storage.set(this.baseKey,e)}constructor(e,t,a){this.storage=e,this.baseKey=t,this.initialValueFactory=a}}class r{createBackend(e,t,a,r){const n=a?`${e}.${t}.${a}`:`${e}.${t}`;return new s(this.storage,n,r)}constructor(e){this.storage=e}}},79386:(e,t,a)=>{a.d(t,{I:()=>r,s:()=>s});class s{set(e,t){return this.memory.set(e,t),Promise.resolve()}getAllKeys(){return Promise.resolve([...this.memory.keys()])}remove(e){return this.memory.get(e)?(this.memory.delete(e),Promise.resolve()):Promise.resolve()}get(e){return Promise.resolve(this.memory.get(e))}constructor(){this.memory=new Map}}class r{getAllKeys(){return Promise.resolve([])}get(e){return Promise.resolve(void 0)}}},60785:(e,t,a)=>{function s(e){return null!==e&&"object"==typeof e&&"version"in e&&"number"==typeof e.version&&"content"in e}a.d(t,{Ot:()=>s,QI:()=>n,Rx:()=>i,hL:()=>r});const r={read:()=>Promise.resolve(void 0),write:()=>Promise.resolve(),clear:()=>Promise.resolve()};class n{}class i{}},63144:(e,t,a)=>{a.d(t,{Q:()=>p});var s=a(92587),r=a(49499),n=a(10722),i=a(60785);class o{async read(){const e=await this.backend.read();if(!e)return;const{decoded:t,hasBypassedDecryption:a}=await this.decodeData(e),{definition:s}=this,{storageName:r}=s;if(!(0,i.Ot)(t))throw new Error(`Unable to read storage data that isn't versioned (storage name: ${r}, data shape: ${this.printDataShapeInfo(t)})`);const{content:n}=t,o=t.version,c=s.schemaVersion;if(o<c){if(!s.migrateStorageSchema)throw a&&await this.rawWrite(t),new Error(`Missing storage schema migration function prevents from reading old version data (storage name: ${r})`);const e=s.migrateStorageSchema(t),n=this.getTypecheckedData(e,"read");return await this.writeWithVersion(n),n}if(o>c)throw new Error(`Unable to read storage data with a more recent version than current schema (storage name: ${r})`);{const e=this.getTypecheckedData(n,"read");return a&&await this.writeWithVersion(e),e}}write(e){const t=this.getTypecheckedData(e,"write");return this.writeWithVersion(t)}clear(){return this.backend.clear()}async writeWithVersion(e){const t={version:this.definition.schemaVersion,content:e};await this.rawWrite(t)}async rawWrite(e){const t=await this.codec.encode(e);await this.backend.write(t)}async decodeData(e){const{codec:t,bypassedDecryptionDecoder:a}=this;try{return{decoded:await t.decode(e),hasBypassedDecryption:!1}}catch(t){try{return{decoded:await a.decode(e),hasBypassedDecryption:!0}}catch{throw t}}}getTypecheckedData(e,t){try{if(!this.definition.typeGuard(e))throw new Error("Typeguard check failed")}catch(a){const{storageName:s,initialValue:r}=this.definition,n=new Error(`Failed to ${t} storage data because of typeguard failure`,{cause:JSON.stringify({details:a instanceof Error?a.message:null,storageInfo:`(storage name: ${s}, data shape: ${this.printDataShapeInfo(e)})`})});if(this.appLogger.error(n),this.definition.isCache)return r;throw n}return e}printDataShapeInfo(e){if(e&&"object"==typeof e){const t=e,a=Object.keys(t).reduce(((e,a)=>(e[a]=typeof t[a],e)),{});return JSON.stringify(a).substring(0,40)}return void 0===e?"undefined":null===e?"null":typeof e}constructor(e,t,a,s,i,o){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=a,this.backend=s,this.definition=i,this.appLogger=o,this.codec=(0,r.x)(a,e,t);const c=new n.E;this.bypassedDecryptionDecoder=(0,r.x)(a,c,t)}}const c=e=>{var t;return(t=class extends o{constructor(t,a,s,r,n){super(t,a,s,r,e,n)}}).Definition=e,t};var d=a(56618),l=a(62200);const u=e=>e.persist?{persist:!0,codec:e.codec,scope:e.scope,storeName:e.storeName,storeTypeGuard:e.storeTypeGuard,isCache:e.isCache,storage:c({...e.storage,storageName:e.storeName,isCache:e.isCache??!1}),capacity:(0,d.C)(e)?e.capacity:void 0}:{persist:!1,initialValue:e.initialValue,scope:e.scope,storeName:e.storeName,capacity:(0,d.C)(e)?e.capacity:void 0};function p(e){var t;const a=u(e),r=((t=class extends l.y{constructor(e,t,a,s,r,n,i){super(e,t,a,s,r,n,i)}}).Definition=a,t);return(0,s.GS)()(r),r}},56618:(e,t,a)=>{var s;function r(e){return"object"==typeof e&&null!==e&&"capacity"in e}a.d(t,{C:()=>r,Y:()=>s}),function(e){e._001KB="1KB",e._010KB="10KB",e._100KB="100KB",e._001MB="1MB",e.Unlimited="Unlimited"}(s||(s={}))},63419:(e,t,a)=>{a.d(t,{X:()=>o});var s=a(491),r=a(76301),n=a(40284),i=a(7712);class o{async prepare(){const e=n.ContextIdFactory.getByRequest(this.request);this.storeList.instances=await Promise.all(this.storeList.classes.map((t=>this.moduleRef.resolve(t,e,{strict:!1}))))}async flush(){const{instances:e}=this.storeList;if(!e.length)throw new Error("Stores not instantiated");const t=e.map((e=>e.persist()));await Promise.all(t)}constructor(e,t,a){this.moduleRef=e,this.request=t,this.storeList=a}}o=(0,s.__decorate)([(0,r.Injectable)(),(0,s.__param)(1,(0,r.Inject)(n.REQUEST)),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.ModuleRef?Object:n.ModuleRef,"undefined"==typeof Record?Object:Record,void 0===i.D?Object:i.D])],o)},41718:(e,t,a)=>{a.d(t,{N:()=>i,G:()=>n});var s=a(24966);class r{set(e){return this.state$.next(e),Promise.resolve()}init(e){return this.state$.next(e),Promise.resolve()}stop(){this.state$.complete()}getState(){return Promise.resolve(this.state$.value)}clear(){return this.state$.next(this.initValue),Promise.resolve()}clearStorage(){return Promise.resolve()}update(e){return this.set(e(this.state$.value)),Promise.resolve()}persist(){return Promise.resolve()}load(){return Promise.resolve()}constructor(e){this.initValue=e,this.getLimit=()=>Promise.resolve(void 0),this.state$=new s.X(e)}}class n{}class i extends n{createUserScopedInfrastructure(){return new r({timestamp:void 0})}createDeviceScopedInfrastructure(){return new r({timestamp:void 0})}}},7712:(e,t,a)=>{a.d(t,{D:()=>s});class s{get classes(){return this.registeredClasses}get instances(){return this.preparedInstances}set instances(e){this.preparedInstances=e}registerClass(e){this.registeredClasses.push(e)}constructor(){this.registeredClasses=[],this.preparedInstances=[]}}},60107:(e,t,a)=>{a.d(t,{N:()=>b});var s=a(40284),r=a(78776),n=a(62149),i=a(15295),o=a(77761),c=a(41718),d=a(3441),l=a(43702),u=a(23711),p=a(96812),m=a(25085),h=a(16712),g=a(90318);const v={[n.F.Device]:p.h,[n.F.User]:p.s};var y=a(82194),f=a(50423);function _(e){const t=e.Definition.persist?function(e,t,a){const{EncryptionCodec:s=v[t],SerializationCodec:i=l.b,TransportStorageCodec:c=u.z,initialValue:p,schemaVersion:y}=a.Definition;let f=class{constructor(e,t,a,s,r){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=a,this.backend=s,this.appLogger=r}},_=class extends a{constructor(e){super(e.encryptionCodec,e.serializationCodec,e.transportStorageCodec,e.backend,e.appLogger)}};const b={token:(0,r.Z)(),inject:[f],asyncFactory:e=>Promise.resolve(new _(e))},S={token:f,inject:[d.r,s,i,c,m.u,g.V,...t===n.F.User?[h.f]:[]],asyncFactory:async(a,s,r,i,o,c,d)=>{const l=await o.createBackend(a,e,(t===n.F.User?d?.get(h.l.UserName):"")??"",(async()=>{const e={version:y,content:p},t=await r.encode(e),a=await s.encode(t);return await i.encode(a)}));return new f(s,r,i,l,c)}};return[S,...(0,o.B)(t,a,b)]}(e.Definition.storeName,e.Definition.scope,e.Definition.storage):[],a={token:(0,r.Z)(),inject:[d.r,i.d,c.G,e.Definition.scope===n.F.User?h.f:s.REQUEST,f.J,y.g,...e.Definition.persist?[e.Definition.storage,e.Definition.codec]:[]],asyncFactory:async(t,a,s,r,i,o,c,d)=>{const l=new e(t,e.Definition,s,(e.Definition.scope===n.F.User?r.get(h.l.UserName):"")??"",i,c,d),u=async()=>{await l.clear(),l.stop()};if(e.Definition.scope===n.F.User){if(!o)throw new Error("No user scope available");o.addCloseHook(u)}else a.addShutdownHook(u);return await l.load(),l}};return[...t,...(0,o.B)(e.Definition.scope,e,a)]}function b(...e){return e.flatMap((e=>_(e)))}},62200:(e,t,a)=>{a.d(t,{y:()=>p});var s=a(60399),r=a(24966),n=a(85390),i=a(87065),o=a(6136),c=a(41842),d=a(62149),l=a(56618);class u{constructor(e,t,a,s){switch(this.conf=t,this.set=async e=>{if(!await this.quickMemoryInfrastructure.getLimit()||this.conf.capacity!==l.Y.Unlimited||!this.conf.persist)return this.quickMemoryInfrastructure.set(e)},this.getState=()=>this.quickMemoryInfrastructure.getState(),this.init=e=>this.quickMemoryInfrastructure.init(e),this.update=async e=>this.set(e(await this.getState())),this.clearStorage=()=>this.quickMemoryInfrastructure.clearStorage(),this.clear=()=>this.quickMemoryInfrastructure.clear(),this.persist=()=>this.quickMemoryInfrastructure.persist(),this.load=()=>this.quickMemoryInfrastructure.load(),this.stop=()=>this.quickMemoryInfrastructure.stop(),this.getLimit=()=>Promise.reject(new Error("not implemented")),t.scope){case d.F.Device:this.quickMemoryInfrastructure=a.createDeviceScopedInfrastructure(e,t.storeName,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}`;break;case d.F.User:if(!s)throw new Error("Attempting to create a user-scoped store without a user");this.quickMemoryInfrastructure=a.createUserScopedInfrastructure(e,t.storeName,s,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}.${s}`}this.state$=this.quickMemoryInfrastructure.state$}}class p{getState(){return(0,s.z)(this.state$)}async set(e){try{await this.setWithoutPersist(e)}finally{await this.persist()}}async setWithoutPersist(e){const t={data:e,timestamp:this.timeGetter()};let a;this.localState$.next(t);if(!await this.allowedToFail.doOne((()=>this.infrastructure.set(t).catch((e=>{throw a=new Error(`${this.conf.storeName}: ${e.message}`),a})))))return this.conf.persist?this.infrastructure.clear():Promise.reject(a)}init(e){const t={data:e,timestamp:0};return this.localState$.next(t),Promise.resolve()}async clear(){this.localState$.next({timestamp:void 0}),await this.infrastructure.clear()}async clearStorage(){if(!this.storage)throw new Error("Persisted stores should have storage");await this.storage.clear()}stop(){this.localState$.complete()}async update(e){const t=await this.getState();await this.set(e(t))}async load(){const e=await this.infrastructure.getState();if(e.timestamp)return void this.localState$.next(e);const{conf:t,codec:a,storage:s}=this;if(!t.persist)return;if(!a||!s)throw new Error("Persisted stores should have conf/storage");await this.allowedToFail.conditionallyAllowToFailOne((async()=>{const e=await s.read()??t.storage.Definition.initialValue,r=await a.decode(e);await this.setWithoutPersist(r)}),!!t.isCache)||await this.setWithoutPersist(await a.decode(t.storage.Definition.initialValue))}async persist(){const{conf:e,codec:t,storage:a}=this;if(!e.persist)return;if(!t||!a)throw new Error("Persisted stores should have conf/storage");const s=await this.getState(),r=await t.encode(s);await a.write(r)}constructor(e,t,a,s,d,l,p){this.conf=t,this.allowedToFail=d,this.storage=l,this.codec=p,this.getLimit=()=>Promise.reject(new Error("not implemented")),this.infrastructure=new u(e,t,a,s),this.timeGetter=()=>Date.now(),this.localState$=new r.X({timestamp:void 0}),this.mergedState$=(0,n.a)({infra:this.infrastructure.state$,current:this.localState$}).pipe((0,i.U)((({current:e,infra:t})=>t.timestamp&&(!e.timestamp||t.timestamp>e.timestamp)?t:e)),(0,o.x)());const m=t.persist?void 0:t.initialValue;this.state$=this.mergedState$.pipe((0,c.h)((e=>!t.persist||!!e.timestamp)),(0,i.U)((e=>e.data??m)))}}},31857:(e,t,a)=>{a.d(t,{R_:()=>r,_C:()=>n,ql:()=>s});class s{run(){return Promise.resolve()}isRunnable(){return!1}}class r{}class n extends r{constructor(e){super(),this.alarm$=e.createObservableTimer(6e4,6e4)}}},58881:(e,t,a)=>{a.d(t,{F:()=>r,p:()=>s});const s={Open:"open",Closed:"closed"};class r{async close(){for(;this.closeHooks.length>0;){const e=this.closeHooks.pop();e&&await e()}this.status=s.Closed,this.lifecycle.removeShutdownHook(this.onAppShutdown)}addCloseHook(e){this.closeHooks.push(e)}constructor(e){this.lifecycle=e,this.status=s.Open,this.onAppShutdown=()=>this.close(),this.closeHooks=[],e.addShutdownHook(this.onAppShutdown)}}},82194:(e,t,a)=>{a.d(t,{g:()=>p});var s=a(491),r=a(78263),n=a(41842),i=a(16433),o=a(76301),c=a(87279),d=a(96498),l=a(58881),u=a(15295);class p extends l.F{thisUserGotDeactivated(e){return([t,a])=>{if(!(0,c.d6)(t)||!(0,c.d6)(a))return!1;const s=(0,c.db)(t).userName,r=(0,c.db)(a).userName;return s===e&&void 0===r}}constructor(e,t,a){super(t),a.queries.activeUser().pipe((0,r.G)(),(0,n.h)(this.thisUserGotDeactivated(e)),(0,i.q)(1)).subscribe((()=>{this.close()}))}}p=(0,s.__decorate)([(0,o.Injectable)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[String,void 0===u.d?Object:u.d,void 0===d.Q?Object:d.Q])],p)},24418:(e,t,a)=>{a.d(t,{R:()=>n});var s=a(8260),r=a(5574);class n extends((0,s.E)(r.Yu)){}(0,s.K)(r.Yu,n)},5574:(e,t,a)=>{a.d(t,{L5:()=>i,Yu:()=>c,mf:()=>o});var s=a(13385),r=a(62149),n=a(75958);class i extends((0,s.g)({scope:r.F.Device})){}class o extends((0,s.g)({scope:r.F.Device})){}const c=(0,n.Q)({commands:{TrackEventCommand:i,TrackPageViewCommand:o},events:{},name:"analytics",queries:{}})},58349:(e,t,a)=>{a.d(t,{C:()=>n});var s=a(45975),r=a(62149);class n extends r.z{constructor(e){super(),(0,s._)(this,"body",void 0),this.body=e}}},62149:(e,t,a)=>{a.d(t,{F:()=>s,z:()=>n});var s,r=a(45975);class n{constructor(){(0,r._)(this,"_",void 0)}}!function(e){e.User="user",e.Device="device"}(s||(s={}))},13385:(e,t,a)=>{a.d(t,{A:()=>o,g:()=>i});var s=a(45975),r=a(58349),n=a(62149);const i=(...[e={scope:n.F.User}])=>{var t;return t=class extends r.C{},(0,s._)(t,"metadata",e),t},o=(e={scope:n.F.User})=>{var t;return t=class extends r.C{},(0,s._)(t,"metadata",e),t}},77535:(e,t,a)=>{a.d(t,{k:()=>i});var s=a(45975),r=a(75768),n=a(62149);const i=(e={scope:n.F.User})=>{var t;return t=class extends r.M{},(0,s._)(t,"metadata",e),t}},75768:(e,t,a)=>{a.d(t,{M:()=>n});var s=a(45975),r=a(62149);class n extends r.z{constructor(e){super(),(0,s._)(this,"body",void 0),this.body=e}}},83016:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(75958),r=a(42074);const n=(0,s.Q)({name:"diagnostics",commands:{log:r.Q},events:{},queries:{}})},42074:(e,t,a)=>{a.d(t,{Q:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.Device})){}},446:(e,t,a)=>{a.d(t,{d:()=>i,l:()=>n});var s=a(45975),r=a(62149);class n{constructor(e){(0,s._)(this,"body",void 0),this.body=e}}const i=(e={scope:r.F.User})=>{var t;return t=class extends n{},(0,s._)(t,"metadata",e),t}},59965:(e,t,a)=>{a.d(t,{T:()=>n});var s=a(17482),r=a(50123);const n=(0,a(75958).Q)({name:"icons",commands:{fetchIconForDomain:r.F},events:{},queries:{getIconForDomain:s.el}})},50123:(e,t,a)=>{a.d(t,{F:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.Device})){}},17482:(e,t,a)=>{a.d(t,{Ct:()=>s,el:()=>c,xF:()=>o});var s,r=a(96168),n=a(77535),i=a(62149);!function(e){e.NotFound="notFound"}(s||(s={}));const o=(0,r.Vj)("notFound","Icon not found");class c extends((0,n.k)({scope:i.F.User})){}},71931:(e,t,a)=>{a.r(t),a.d(t,{ActiveUserQuery:()=>S.p,ActiveUserSetEvent:()=>S.W_,AnalyticsClient:()=>n.R,AnomalyCriticalityValues:()=>y.h_,AnomalyTypeValues:()=>y._F,ApplicationBuildType:()=>x.P,CommandMessage:()=>i.C,EMPTY_QUERY_RESULT:()=>c,EditSettingsForStagingCommand:()=>R.bH,EnableExceptionLogCommand:()=>f.w,EventMessage:()=>D.l,ExceptionLoggingClient:()=>v.G,ExceptionOriginValues:()=>y.KR,FeatureFlipsClient:()=>C.P,FetchIconForDomainCommand:()=>j.F,FileDownloadClient:()=>I,FileUploadClient:()=>N,FileUploadedEvent:()=>U.W,FilterOperationName:()=>s,GetIconForDomainQuery:()=>z.el,GetIconForDomainQueryErrorTypes:()=>z.Ct,GetKillSwitchQuery:()=>B.K,KillSwitches:()=>L,LogCommand:()=>G.Q,NullModuleApi:()=>b.w,PlatformInfoClient:()=>P.c,PlatformInfoQuery:()=>O.a,QueryMessage:()=>o.M,RefreshAvailableLabsCommand:()=>E._x,ReportAnomalyCommand:()=>y.SU,RequestContextClient:()=>F.Q,SetActiveUserCommand:()=>S.r$,SettingsForStagingQuery:()=>R.Lt,StartTaskTrackingCommand:()=>m.g,TerminateTaskTrackingCommand:()=>h.y,ToggleLabCommand:()=>E.YM,TrackEventCommand:()=>r.L5,TrackPageViewCommand:()=>r.mf,UseCaseScope:()=>d.F,UserAvailableLabsQuery:()=>E._l,UserFeatureFlipQuery:()=>E.fV,UserFeatureFlipsQuery:()=>E.r6,WebServicesClient:()=>k,analyticsApi:()=>r.Yu,createGetIconForDomainQueryNotFoundError:()=>z.xF,defineCarbonCommand:()=>l.A,defineCommand:()=>l.g,defineEvent:()=>D.d,defineModuleApi:()=>_.Q,defineModuleClient:()=>w.E,defineQuery:()=>u.k,diagnosticsApi:()=>K.e,diagnosticsDomains:()=>q,exceptionLoggingApi:()=>g.P,featureFlipsApi:()=>E.cV,fileDownloadApi:()=>T.L,fileUploadApi:()=>A.a,iconsApi:()=>M.T,killSwitchApi:()=>V.m,platformInfoApi:()=>O.J,registerModuleClient:()=>w.K,requestContextApi:()=>S.t$,taskTrackingApi:()=>p.e,webServicesApi:()=>R.Dm});var s,r=a(5574),n=a(24418),i=a(58349),o=a(75768);!function(e){e.Equals="equals",e.Differs="differs",e.Matches="matches",e.In="in",e.Contains="contains"}(s||(s={}));const c={items:[],itemCount:0,page:1,pageCount:1};var d=a(62149),l=a(13385),u=a(77535),p=a(72885),m=a(95393),h=a(72023),g=a(38430),v=a(54691),y=a(68327),f=a(41597),_=a(75958),b=a(33530),S=a(66335),w=a(8260),E=a(23297),C=a(43651),T=a(4166);class I extends((0,w.E)(T.L)){}(0,w.K)(T.L,I);var A=a(58563);class N extends((0,w.E)(A.a)){}(0,w.K)(A.a,N);var U=a(7262),F=a(96498),D=a(446),O=a(74650),P=a(63604),x=a(69259),R=a(32446);class k extends((0,w.E)(R.Dm)){}(0,w.K)(R.Dm,k);var L,M=a(59965),j=a(50123),z=a(17482),V=a(35463),B=a(91247);!function(e){e.DisableAutofill="disableAutofill",e.BrazeContentCardsDisabled="brazeContentCardsDisabled",e.DisableLoginFlowMigration="disableLoginFlowMigration",e.DisableAutoSSOLogin="disableAutoSSOLogin"}(L||(L={}));var K=a(83016),G=a(42074);const q={"no-domain":"no_domain",authentication:"authentication",framework:"framework",options:"options"}},35463:(e,t,a)=>{a.d(t,{m:()=>n});var s=a(75958),r=a(91247);const n=(0,s.Q)({name:"killSwitch",commands:{},events:{},queries:{GetKillSwitchQuery:r.K}})},91247:(e,t,a)=>{a.d(t,{K:()=>n});var s=a(77535),r=a(62149);class n extends((0,s.k)({scope:r.F.Device})){}},38430:(e,t,a)=>{a.d(t,{P:()=>n});var s=a(68327),r=a(41597);const n=(0,a(75958).Q)({name:"exceptionLogging",commands:{reportAnomaly:s.SU,enableExceptionLog:r.w},events:{},queries:{}})},54691:(e,t,a)=>{a.d(t,{G:()=>n});var s=a(38430),r=a(8260);class n extends((0,r.E)(s.P)){}(0,r.K)(s.P,n)},41597:(e,t,a)=>{a.d(t,{w:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.Device})){}},68327:(e,t,a)=>{a.d(t,{KR:()=>o,SU:()=>c,_F:()=>i,h_:()=>n});var s=a(13385),r=a(62149);const n=Object.freeze({WARNING:"warning",CRITICAL:"critical"}),i=Object.freeze({EXCEPTION:"exception",OTHER:"other"}),o=Object.freeze({EXCEPTION_BOUNDARY:"exceptionBoundary",UNHANDLED_PROMISE_REJECTION:"unhandledPromiseRejection",UNCAUGHT_EXCEPTION:"uncaughtException"});class c extends((0,s.g)({scope:r.F.Device})){}},72885:(e,t,a)=>{a.d(t,{e:()=>n});var s=a(95393),r=a(72023);const n=(0,a(75958).Q)({name:"taskTracking",commands:{startTaskTracking:s.g,terminateTaskTracking:r.y},events:{},queries:{}})},95393:(e,t,a)=>{a.d(t,{g:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.Device})){}},72023:(e,t,a)=>{a.d(t,{y:()=>n});var s=a(13385),r=a(62149);class n extends((0,s.g)({scope:r.F.Device})){}},23297:(e,t,a)=>{a.d(t,{YM:()=>u,_l:()=>c,_x:()=>l,cV:()=>p,fV:()=>d,r6:()=>o});var s=a(75958),r=a(77535),n=a(62149),i=a(13385);class o extends((0,r.k)({scope:n.F.User})){}class c extends((0,r.k)({scope:n.F.User})){}class d extends((0,r.k)({scope:n.F.User})){}class l extends((0,i.g)({scope:n.F.User})){}class u extends((0,i.g)({scope:n.F.User})){}const p=(0,s.Q)({events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:o,UserFeatureFlipQuery:d,UserAvailableLabsQuery:c},commands:{RefreshAvailableLabsCommand:l,ToggleLabCommand:u}})},43651:(e,t,a)=>{a.d(t,{P:()=>n});var s=a(8260),r=a(23297);class n extends((0,s.E)(r.cV)){}(0,s.K)(r.cV,n)},4166:(e,t,a)=>{a.d(t,{L:()=>s});const s=(0,a(75958).Q)({events:{},name:"file-download",queries:{},commands:{}})},58563:(e,t,a)=>{a.d(t,{a:()=>r});var s=a(7262);const r=(0,a(75958).Q)({name:"file-upload",events:{fileUploadedEvent:s.W},queries:{},commands:{}})},7262:(e,t,a)=>{a.d(t,{W:()=>n});var s=a(446),r=a(62149);class n extends((0,s.d)({scope:r.F.User})){}},8260:(e,t,a)=>{a.d(t,{E:()=>r,K:()=>n});var s=a(45975);function r(e){var t;return t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}},(0,s._)(t,"api",e),t}function n(e,t){e.ClientClass=t}},75958:(e,t,a)=>{a.d(t,{Q:()=>r});const s=(e,t)=>Object.entries(e).reduce(((e,[a,s])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(a,t)]=s,e)),{}),r=e=>({name:e.name,commands:s(e.commands,"Command"),queries:s(e.queries,"Query"),events:s(e.events,"Event")})},66335:(e,t,a)=>{a.d(t,{W_:()=>l,p:()=>c,r$:()=>d,t$:()=>u});var s=a(75958),r=a(77535),n=a(62149),i=a(13385),o=a(446);class c extends((0,r.k)({scope:n.F.Device})){}class d extends((0,i.g)({scope:n.F.Device})){}class l extends((0,o.d)({scope:n.F.User})){}const u=(0,s.Q)({commands:{SetActiveUserCommand:d},events:{activeUserSet:l},name:"requestContext",queries:{ActiveUserQuery:c}})},96498:(e,t,a)=>{a.d(t,{Q:()=>n});var s=a(8260),r=a(66335);class n extends((0,s.E)(r.t$)){}(0,s.K)(r.t$,n)},33530:(e,t,a)=>{a.d(t,{w:()=>s});const s={name:"api",commands:{},events:{},queries:{}}},74650:(e,t,a)=>{a.d(t,{J:()=>o,a:()=>i});var s=a(77535),r=a(62149),n=a(75958);class i extends((0,s.k)({scope:r.F.Device})){}const o=(0,n.Q)({name:"platformInfo",commands:{},events:{},queries:{PlatformInfoQuery:i}})},63604:(e,t,a)=>{a.d(t,{c:()=>n});var s=a(74650),r=a(8260);class n extends((0,r.E)(s.J)){}(0,r.K)(s.J,n)},69259:(e,t,a)=>{var s;a.d(t,{P:()=>s}),function(e){e.DEV="DEV",e.QA="QA",e.NIGHTLY="NIGHTLY",e.BETA="BETA",e.PRODUCTION="PRODUCTION"}(s||(s={}))},32446:(e,t,a)=>{a.d(t,{Dm:()=>d,Lt:()=>o,bH:()=>c});var s=a(77535),r=a(62149),n=a(13385),i=a(75958);class o extends((0,s.k)({scope:r.F.Device})){}class c extends((0,n.g)({scope:r.F.Device})){}const d=(0,i.Q)({commands:{EditSettingsForStagingCommand:c},events:{},name:"webServices",queries:{SettingsForStagingQuery:o}})},23047:(e,t,a)=>{a.d(t,{I:()=>m});var s=a(491),r=a(5574),n=a(86006),i=a(82874),o=a(87279),c=a(14122),d=a(92587);class l{async trackEvent(e){const{carbon:t}=this.carbonLegacyClient.commands,a=await t({name:"logEvent",args:[{event:e}]});if((0,o.hx)(a))throw new Error("TrackEvent from carbon failed")}async trackPageView(e,t){const{carbon:a}=this.carbonLegacyClient.commands,s=await a({name:"logPageView",args:[{pageView:e,browseComponent:t}]});if((0,o.hx)(s))throw new Error("TrackPageView from carbon failed")}constructor(e){this.carbonLegacyClient=e}}l=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c._?Object:c._])],l);class u{async execute({body:{event:e}}){return await this.analyticsService.trackEvent(e),(0,o.Vp)(void 0)}constructor(e){this.analyticsService=e}}u=(0,s.__decorate)([(0,i.W)(r.L5),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l?Object:l])],u);class p{async execute({body:{pageView:e,browseComponent:t}}){return await this.analyticsService.trackPageView(e,t),(0,o.Vp)(void 0)}constructor(e){this.analyticsService=e}}p=(0,s.__decorate)([(0,i.W)(r.mf),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l?Object:l])],p);class m{}m=(0,s.__decorate)([(0,n.Yl)({api:r.Yu,providers:[l],handlers:{commands:{trackEvent:u,trackPageView:p},events:{},queries:{}},domainName:"framework"})],m)},71171:(e,t,a)=>{a.d(t,{y:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{async derive(e,t,a){const{deriveKeyArgon2d:s}=this.config.crypto;return await s(e,t,a)}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},66481:(e,t,a)=>{a.d(t,{i:()=>i});var s=a(491),r=a(92587);const n={computeHash:()=>Promise.resolve(new ArrayBuffer(32)),decryptAes256:(e,t,a)=>Promise.resolve(a),deriveKeyArgon2d:()=>Promise.resolve(new ArrayBuffer(32)),deriveKeyPbkdf2:()=>Promise.resolve(new ArrayBuffer(32)),encryptAes256:(e,t,a)=>Promise.resolve(a),generateKeyAes256:()=>Promise.resolve(new ArrayBuffer(32)),generateKeyPairRsaOaep:()=>Promise.resolve({privateKey:new ArrayBuffer(32),publicKey:new ArrayBuffer(32)}),getRandomValues:e=>new Uint8Array(e),signHmacSha:()=>Promise.resolve(new ArrayBuffer(32)),unsafeComputeMd5Hash:()=>new ArrayBuffer(1),verifyHmacSha:()=>Promise.resolve(!0),decryptRsaOaep:function(e,t){return Promise.resolve(t)},encryptRsaOaep:function(e,t){return Promise.resolve(t)},signRsassaPkcs1:function(e,t){return Promise.resolve(t)},verifyRsassaPkcs1:()=>Promise.resolve(!0)};class i{constructor(e){this.crypto=e}}new(i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",["undefined"==typeof CryptoPrimitives?Object:CryptoPrimitives])],i))(n)},16624:(e,t,a)=>{a.d(t,{D:()=>Y});var s=a(491),r=a(86006),n=a(71171),i=a(66481),o=a(59352),c=a(85603),d=a(92402),l=a(81929),u=a(92587),p=a(74017);class m{async verify(e,t,a,s=p.x){const{verifyHmacSha:r}=this.config.crypto;return await r(e,t,a,s)}constructor(e){this.config=e}}m=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.i?Object:i.i])],m);var h=a(36041),g=a(60679),v=a(14260),y=a(58496),f=a(53415),_=a(62623),b=a(61805),S=a(49504),w=a(48702),E=a(92698),C=a(55667),T=a(52987),I=a(66329),A=a(95087),N=a(89685);const U="flexible";var F=a(69591);const D="KWC3",O=0;var P=a(38291);const x=32,R=4;function k(e){const t=e.slice(x,x+R),a=(0,N.v)(t);var s;if(s=a,[D,P.PD].includes(s))return a}function L(e){const t=k(e);return t||(function(e){const t=new Uint8Array(e).slice(0,1);return(0,N.v)(t.buffer)===F.F}(e)?U:void 0)}var M=a(60745),j=a(82933),z=a(94805),V=a(16698);const B={type:D,derivation:z.Yi,cipher:V.No};function K(e){const t=function({transportableData:e,marker:t}){const{derivation:a,type:s}=t,{saltLength:r}=a,n=O+r+s.length;return{salt:e.slice(O,O+r),encipheredContents:e.slice(n)}}({transportableData:e,marker:B});return{salt:t.salt,type:D,encipheredContents:t.encipheredContents,derivationConfig:z.Yi,cipherConfig:V.No}}var G=a(12087);async function q(e,t,a,s){const r=K(s),{deriveKeyPbkdf2:n}=t,{derivationConfig:i,salt:o}=r,c=await(0,G.E)(n,a,i,e,o),{computeHash:d}=t,{cipherConfig:{ivLength:l,bytesToKey:{iterations:u,keyLength:p}}}=r,m=await async function(e,t,a,s,r,n){const i=(0,j.K)(t,n.slice(0,8));let o=i,c=new ArrayBuffer(0);for(let t=0;t<a;t++){const t=await e(o,"SHA-1");c=(0,j.K)(c,t),o=(0,j.K)(t,i)}const d=r+s;return Promise.resolve(c.slice(r,d))}(d,c,u,l,p,o),{decryptAes256:h}=t,{encipheredContents:g}=r;return h(c,m,g)}var $=a(7449);class Q{decrypt(e,t){return async function(e,t,a,s){const r=L(s);if(!r)throw new Error("Cannot find marker type");switch(r){case D:return await q(e,t,a,s);case P.PD:return await(0,$.I)(e,t,s);case U:return(0,M.F)(e,t,a,s);default:(0,A.U)(r)}}(e,this.config.crypto,this.derivationCache,t)}constructor(e,t){this.config=e,this.derivationCache=t}}Q=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.i?Object:i.i,void 0===o.E?Object:o.E])],Q);var H=a(39988),W=a(15996);class Y{static configure(e){return{module:Y,configurations:{infrastructure:e}}}}Y=(0,s.__decorate)([(0,r.Yl)({sharedModuleName:"cryptography",configurations:{infrastructure:{token:i.i}},providers:[n.y,o.E,c.a,d._,H.y,l.q,m,h.c,g.$,v.o,y.k,f.n,_.F,I.Y,b.g,S.H,w.e,E.k,W.u,C.Z,Q,T.f],exports:[n.y,o.E,c.a,d._,H.y,l.q,m,h.c,g.$,v.o,y.k,f.n,_.F,I.Y,b.g,S.H,w.e,E.k,W.u,C.Z,Q,T.f],domainName:"framework"})],Y)},59352:(e,t,a)=>{a.d(t,{E:()=>c});var s=a(491),r=a(92587),n=a(82933),i=a(10370);class o{constructor(){this.derivateKeyCache=new Map}getCacheKey(...e){const t=e.reduce(((e,t)=>(0,n.K)(e,t)),new ArrayBuffer(0));return(0,i.s)(t)}getCachedDerivation(e){return this.derivateKeyCache.get(e)}setCachedDerivation({cacheKey:e,data:t}){this.getCachedDerivation(e)||this.derivateKeyCache.set(e,t)}}class c extends o{}c=(0,s.__decorate)([(0,r.GS)()],c)},85603:(e,t,a)=>{a.d(t,{a:()=>c});var s=a(491),r=a(92587),n=a(60745),i=a(66481),o=a(59352);class c{decrypt(e,t){return(0,n.F)(e,this.config.crypto,this.derivationCache,t)}constructor(e,t){this.config=e,this.derivationCache=t}}c=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.i?Object:i.i,void 0===o.E?Object:o.E])],c)},92402:(e,t,a)=>{a.d(t,{_:()=>_});var s=a(491),r=a(92587),n=a(82933),i=a(95087),o=a(54066),c=a(69591),d=a(33055),l=a(94805);function u(e){const t=c.F+e.join(c.F)+c.F;return(0,o.u)(t)}function p({cipher:e,derivation:t}){const{algorithm:a}=t;switch(a){case"argon2d":return function({cipher:e,derivation:t}){const{count:a,index:s}=d.ARGON2D_MARKER_SCHEMA,r=new Array(a);return r[s.version]=c.g,r[s.derivation]=t.algorithm,r[s.saltLength]=t.saltLength,r[s.tCost]=t.tCost,r[s.mCost]=t.mCost,r[s.parallelism]=t.parallelism,r[s.cipher]=e.algorithm,r[s.mode]=e.mode,r[s.ivLength]=e.ivLength,u(r)}({cipher:e,derivation:t});case"pbkdf2":return function({cipher:e,derivation:t}){const{count:a,index:s}=d.PBKDF2_MARKER_SCHEMA,r=new Array(a);return r[s.version]=c.g,r[s.derivation]=t.algorithm,r[s.saltLength]=t.saltLength,r[s.iterations]=t.iterations,r[s.hashAlgorithm]=t.hashAlgorithm,r[s.cipher]=e.algorithm,r[s.mode]=e.mode,r[s.ivLength]=e.ivLength,u(r)}({cipher:e,derivation:t});case"noderivation":return function({cipher:e,derivation:t}){const{count:a,index:s}=d.NODERIVATION_MARKER_SCHEMA,r=new Array(a);return r[s.version]=c.g,r[s.derivation]=t.algorithm,r[s.cipher]=e.algorithm,r[s.mode]=e.mode,r[s.ivLength]=e.ivLength,u(r)}({cipher:e,derivation:t});default:(0,i.U)(a)}}var m=a(58396),h=a(6424),g=a(6752);async function v(e,t,a,s,r,i,o){const{algorithm:c}=a,d="pbkdf2"===c||"argon2d"===c;if(d&&!o?.salt)throw new Error("Need salt for derivation");const{deriveKeyArgon2d:u,deriveKeyPbkdf2:v}=t,y=d&&o?.salt?await(0,g.b)(e,o.salt,v,u,a,s):e,{mode:f}=r,{computeHash:_}=t,{encryptionKey:b,signatureKey:S}="cbchmac64"===f?await(0,m.U)(y):await(0,h.Y)(y,_),{getRandomValues:w}=t,E=w(r.ivLength),{encryptAes256:C}=t,T=await C(b,E,i),{signHmacSha:I}=t,A=(0,n.K)(E,T),N=await I(S,A);return function(e){const{encipheredContents:t,cipherConfig:a,derivationConfig:s,salt:r,signature:i,iv:o}=e;if((r?.byteLength??0)!==(0,l.m9)(s))throw new Error(`Salt length ${r?.byteLength??0} does not match derivation algorithm ${s.algorithm} expectation`);const c=p({cipher:a,derivation:s});return r&&"noderivation"!==s.algorithm?(0,n.K)(c,r,o,i,t):(0,n.K)(c,o,i,t)}({type:"flexible",version:1,derivationConfig:a,cipherConfig:r,salt:o?.salt,iv:E,signature:N,encipheredContents:T})}var y=a(66481),f=a(59352);class _{async encrypt(e,t,a,s,r){return await v(e,this.config.crypto,a,this.derivationCache,s,t,r)}constructor(e,t){this.config=e,this.derivationCache=t}}_=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y.i?Object:y.i,void 0===f.E?Object:f.E])],_)},39988:(e,t,a)=>{a.d(t,{y:()=>c});var s=a(491),r=a(92587),n=a(60745);var i=a(66481),o=a(59352);class c{verifySignature(e,t){return async function(e,t,a,s){const{verifyHmacSha:r}=t,{signatureKey:i,signature:o,dataToSign:c}=await(0,n.V)(e,t,a,s);return r(i,o,c)}(e,this.config.crypto,this.derivationCache,t)}constructor(e,t){this.config=e,this.derivationCache=t}}c=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.i?Object:i.i,void 0===o.E?Object:o.E])],c)},81929:(e,t,a)=>{a.d(t,{q:()=>o});var s=a(491),r=a(92587),n=a(74017),i=a(66481);class o{async sign(e,t,a=n.x){const{signHmacSha:s}=this.config.crypto;return await s(e,t,a)}constructor(e){this.config=e}}o=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.i?Object:i.i])],o)},36041:(e,t,a)=>{a.d(t,{c:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{generate(){const{generateKeyAes256:e}=this.config.crypto;return e()}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},60679:(e,t,a)=>{a.d(t,{$:()=>o});var s=a(491),r=a(92587),n=a(7449),i=a(66481);class o{decrypt(e,t){return(0,n.I)(e,this.config.crypto,t)}constructor(e){this.config=e}}o=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.i?Object:i.i])],o)},14260:(e,t,a)=>{a.d(t,{o:()=>m});var s=a(491),r=a(92587),n=a(16698),i=a(82933),o=a(54066),c=a(38291);var d=a(6424);async function l(e,t,a,s,r,n){const{computeHash:l}=t,{encryptionKey:u,signatureKey:p}=await(0,d.Y)(e,l),{getRandomValues:m}=t,{ivLength:h}=s,g=m(h),{encryptAes256:v}=t,y=await v(u,g,r),{signHmacSha:f}=t,_=(0,i.K)(g,y),b={type:"KWC5",derivationConfig:a,cipherConfig:s,iv:g,signature:await f(p,_),encipheredContents:y},{padding:S}=n;return function({secureData:e,randomValues:t}){if(t.byteLength!==c.en)throw new Error("Encoding kwc5 requires 16 random bytes");const{encipheredContents:a,iv:s,type:r,signature:n}=e,d=(0,o.u)(r);return(0,i.K)(s,t,d,n,a)}({secureData:b,randomValues:S})}var u=a(94805),p=a(66481);class m{encrypt(e,t){const{getRandomValues:a}=this.config.crypto,s={padding:a(n.BU.padding)};return l(e,this.config.crypto,u.oo,n.BU,t,s)}constructor(e){this.config=e}}m=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.i?Object:p.i])],m)},85805:(e,t,a)=>{function s(){return new Uint32Array([57920321,977424202,1999259334,3390546403,3917439743,16505144,3027631148,3235565160,2643335823,1420105356,998514539,2704347781,1011257802,823882961,790991339,3929284516]).buffer}a.d(t,{S:()=>s})},58496:(e,t,a)=>{a.d(t,{k:()=>o});var s=a(491),r=a(92587),n=a(85603),i=a(85805);class o{async decrypt(e){const t=(0,i.S)();return await this.flexibleDecryptor.decrypt(t,e)}constructor(e){this.flexibleDecryptor=e}}o=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.a?Object:n.a])],o)},53415:(e,t,a)=>{a.d(t,{n:()=>c});var s=a(491),r=a(92587),n=a(89685),i=a(58496),o=a(62623);class c{async encode(e){return await this.obfuscationKeyEncryptor.encrypt(e)}async decode(e){return(0,n.v)(e).startsWith("$1$noderivation$aes256$cbchmac64$16$")?await this.obfuscationKeyDecryptor.decrypt(e):e}constructor(e,t){this.obfuscationKeyDecryptor=e,this.obfuscationKeyEncryptor=t}}c=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.k?Object:i.k,void 0===o.F?Object:o.F])],c)},62623:(e,t,a)=>{a.d(t,{F:()=>d});var s=a(491),r=a(92587),n=a(94805),i=a(16698),o=a(92402),c=a(85805);class d{async encrypt(e){const t=(0,c.S)();return await this.flexibleEncryptor.encrypt(t,e,n.oo,i.gO)}constructor(e){this.flexibleEncryptor=e}}d=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o._?Object:o._])],d)},66329:(e,t,a)=>{a.d(t,{Y:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{get(e){const{getRandomValues:t}=this.config.crypto;return t(e).buffer}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},61805:(e,t,a)=>{a.d(t,{g:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{decrypt(e,t,a="SHA-256"){const{decryptRsaOaep:s}=this.config.crypto;return s(e,t,a)}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},49504:(e,t,a)=>{a.d(t,{H:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{encrypt(e,t,a="SHA-256"){const{encryptRsaOaep:s}=this.config.crypto;return s(e,t,a)}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},48702:(e,t,a)=>{a.d(t,{e:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{generate(e="SHA-256"){const{generateKeyPairRsaOaep:t}=this.config.crypto;return t(e)}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},92698:(e,t,a)=>{a.d(t,{k:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{async sign(e,t,a="SHA-256"){const{signRsassaPkcs1:s}=this.config.crypto;return await s(e,t,a)}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},15996:(e,t,a)=>{a.d(t,{u:()=>o});var s=a(491),r=a(92587),n=a(83407),i=a(66481);class o{async verify(e,t,a,s=n.Tt){const{verifyRsassaPkcs1:r}=this.config.crypto;return await r(e,t,a,s)}constructor(e){this.config=e}}o=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.i?Object:i.i])],o)},55667:(e,t,a)=>{a.d(t,{Z:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{async compute(e,t){const{computeHash:a}=this.config.crypto;return await a(e,t)}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},52987:(e,t,a)=>{a.d(t,{f:()=>i});var s=a(491),r=a(92587),n=a(66481);class i{compute(e){const{unsafeComputeMd5Hash:t}=this.config.crypto;return t(e)}constructor(e){this.config=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.i?Object:n.i])],i)},76500:(e,t,a)=>{a.d(t,{l:()=>m});var s=a(491),r=a(92587),n=a(99081),i=a(65967),o=a(43685),c=a(26755),d=a(35955),l=a(96236),u=a(14080),p=a(81646);class m{get enclaveUrl(){return this.enclaveApiSettings.enclaveUrl}get authentication(){return this.authenticationService}get domains(){return this.domainsService}get idps(){return this.idpsService}get scim(){return this.scimService}get siem(){return this.siemService}get slack(){return this.slackService}get teams(){return this.teamService}constructor(e,t,a,s,r,n,i,o){this.authenticationService=e,this.domainsService=t,this.idpsService=a,this.scimService=s,this.siemService=r,this.slackService=n,this.teamService=i,this.enclaveApiSettings=o}}m=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.$?Object:i.$,void 0===o.t?Object:o.t,void 0===c.L?Object:c.L,void 0===d.b?Object:d.b,void 0===l.L?Object:l.L,void 0===u.v?Object:u.v,void 0===p.U?Object:p.U,void 0===n.N6?Object:n.N6])],m)},99081:(e,t,a)=>{a.d(t,{$m:()=>n,Ep:()=>r,N6:()=>s});class s{constructor(e,t,a){this.cloudflareHeaders=e,this.enclaveUrl=t,this.environment=a}}const r=e=>"local"===e?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y=",n=e=>"local"===e?{0:"9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"}:"staging"===e?{3:"90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"}:{3:"dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16",8:"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"}},19961:(e,t,a)=>{a.d(t,{G:()=>y});var s=a(491),r=a(86006),n=a(75421),i=a(5206),o=a(76500),c=a(99081),d=a(29910),l=a(65967),u=a(43685),p=a(26755),m=a(35955),h=a(96236),g=a(14080),v=a(81646);class y{static configure(e){return{module:y,configurations:{enclaveApiSettings:e}}}}y=(0,s.__decorate)([(0,r.Yl)({sharedModuleName:"enclave",providers:[o.l,l.$,u.t,d.d,p.L,m.b,h.L,g.v,v.U],exports:[o.l],stores:[],imports:[n.X,i.i],configurations:{enclaveApiSettings:{token:c.N6}},domainName:"framework"})],y)},65967:(e,t,a)=>{a.d(t,{$:()=>p});var s,r=a(491),n=a(7165),i=a(92587),o=a(87279),c=a(29910);!function(e){e.AUTH_CONFIRM_LOGIN="api/authentication/ConfirmLogin2",e.AUTH_REQUEST_LOGIN="api/authentication/RequestLogin2",e.AUTH_REQUEST_TEST_LOGIN="api/authentication/RequestTestLogin2",e.AUTH_CONFIRM_TEST_LOGIN="api/authentication/ConfirmTestLogin3"}(s||(s={})),n.z.object({login:n.z.string()});const d=n.z.object({idpAuthorizeUrl:n.z.string(),teamUuid:n.z.string(),spCallbackUrl:n.z.string(),domainName:n.z.string()});n.z.object({teamUuid:n.z.string(),samlResponse:n.z.string(),domainName:n.z.string()});const l=n.z.object({exists:n.z.boolean(),ssoToken:n.z.string(),userServiceProviderKey:n.z.string(),currentAuthenticationMethods:n.z.string().array(),expectedAuthenticationMethods:n.z.string().array()});n.z.object({teamUuid:n.z.string(),adminProvisioningKey:n.z.string(),idpUuid:n.z.string().optional()});const u=n.z.object({idpAuthorizeUrl:n.z.string(),spCallbackUrl:n.z.ostring()});n.z.object({teamUuid:n.z.string(),adminProvisioningKey:n.z.string(),idpUuid:n.z.string(),samlResponse:n.z.string()});class p{async requestLogin(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.AUTH_REQUEST_LOGIN,body:e,responseSchema:d});return(0,o.Vp)(t)}async confirmLogin(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.AUTH_CONFIRM_LOGIN,body:e,responseSchema:l});return(0,o.Vp)(t)}async requestTestLogin(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.AUTH_REQUEST_TEST_LOGIN,body:e,responseSchema:u});return(0,o.Vp)(t)}async confirmTestLogin(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:s.AUTH_CONFIRM_TEST_LOGIN,body:e,responseSchema:n.z.object({})}),(0,o.Vp)(void 0)}constructor(e){this.enclaveService=e}}p=(0,r.__decorate)([(0,i.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===c.d?Object:c.d])],p)},29910:(e,t,a)=>{a.d(t,{d:()=>x});var s,r=a(491),n=a(64987),i=a(92587),o=a(26468),c=a(99081);!function(e){e.CLIENT_HELLO="api/tunnel/ClientHello",e.TERMINATE_HELLO="api/tunnel/TerminateHello"}(s||(s={}));const d=(e,t)=>({clientHelloUrl:`${e}api/tunnel/ClientHello`,terminateHelloUrl:`${e}api/tunnel/TerminateHello`,secureContentUrl:`${e}${t}`});var l=a(75377),u=a(52799),p=a(60399),m=a(87279),h=a(7165);const g=e=>{const t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map((e=>parseInt(e,16)))).buffer:(new Uint8Array).buffer},v=h.z.object({data:h.z.object({attestation:h.z.string(),clientIdentifier:h.z.string()}),requestId:h.z.string()});class y{decode(e){const t=v.safeParse(e);if(!t.success)throw new Error("Invalid response format");return{attestation:g(t.data.data.attestation),clientIdentifier:t.data.data.clientIdentifier}}}const f=async(e,t)=>{const{headers:a,httpClient:s,publicKey:r}=t,n=await(async e=>(await l.ready,{clientPublicKey:l.to_hex(e)}))(r),i=await(0,p.z)(s.post(e,n,{observe:"body",responseType:"json",responseBodyDecoder:new y,withCredentials:!0,headers:a}));if((0,m.hx)(i))throw new Error("string"==typeof i.error?i.error:"HTTP Error");return i.data};var _=a(40767);const b=e=>{const t=(0,_.p)(new Uint8Array(e)),a=(s=t,Array.isArray(s)?s:s.value);var s;const[r,,n,i]=a;if(!r)throw new Error("parseSignedMessage: no protected header field");if(!n)throw new Error("parseSignedMessage: no payload field");if(!i)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(n).buffer,protectedHeaders:new Uint8Array(r).buffer,signature:new Uint8Array(i).buffer}};var S=a(7502);const w=h.z.object({module_id:h.z.string(),timestamp:h.z.bigint(),digest:h.z.string(),pcrs:h.z.record(h.z.string(),h.z.instanceof(Uint8Array)),certificate:h.z.instanceof(Uint8Array),cabundle:h.z.array(h.z.instanceof(Uint8Array)),user_data:h.z.instanceof(Uint8Array),nonce:h.z.instanceof(Uint8Array).nullable()}),E=h.z.object({header:h.z.string(),publicKey:h.z.string()});var C=a(71833);var T=a(76746);var I=a(96303);const A=e=>(0,I.k)((e=>new Uint8Array(e).buffer)(e)),N=async e=>{const{attestation:t,rootCertBER:a,expectedPCRs:s}=e,{protectedHeaders:r,payload:n,signature:i}=b(t),o=(e=>{const t=(0,_.p)(e),a=w.safeParse(t);if(!a.success)throw new Error("failed to parse attestation document");const s=a.data,r=new TextDecoder("utf-8").decode(s.user_data),n=JSON.parse(r),i=E.safeParse(n);if(!i.success)throw new Error("failed to parse server crypto info");const o=i.data;return{moduleId:s.module_id,timestamp:s.timestamp,digest:s.digest,pcrs:s.pcrs,certificate:new Uint8Array(s.certificate).buffer,cabundle:(c=s.cabundle,c.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,S.R)(o.header),serverPublicKey:(0,S.R)(o.publicKey),nonce:null!==s.nonce?new Uint8Array(s.nonce).buffer:null};var c})(n),c=await(async(e,t,a)=>{const s=C.KBB.fromBER(e),r=t.map((e=>C.KBB.fromBER(e)));r.push(s);const n=[C.KBB.fromBER((0,S.R)(a))],i=new C.DMg({trustedCerts:n,certs:r});return(await i.verify()).result})(o.certificate,o.cabundle,a);if(!c)throw new Error("Invalid cert chain!");const d=await(async(e,t,a,s)=>{const r=C.KBB.fromBER(s),n=await r.getPublicKey(),i=["Signature1",t,new ArrayBuffer(0),a],o=(0,T.d)(i);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},n,e,o)})(i,r,n,o.certificate);if(!d)throw new Error("Invalid signature!");return((e,t)=>{for(const[a,s]of Object.entries(t))if(s!==A(e[Number(a)]))throw new Error("PCRs did not match")})(o.pcrs,s),{serverPublicKey:o.serverPublicKey,serverHeader:o.serverHeader}},U=async e=>{await l.ready;const{enclaveApiSettings:{cloudflareHeaders:t,enclaveUrl:a},rootCertBER:s,expectedPCRs:r,httpClient:n,platformInfo:i}=e,o={};o["dashlane-client-agent"]=JSON.stringify({platform:i.platformName,osversion:i.osVersion,version:i.appVersion}),t.accessKey&&t.secretKey&&(o["CF-Access-Client-Id"]=t.accessKey,o["CF-Access-Client-Secret"]=t.secretKey);const c=l.crypto_kx_keypair(),{clientHelloUrl:h,terminateHelloUrl:g}=d(a,""),v=await f(h,{headers:o,httpClient:n,publicKey:c.publicKey}),{serverPublicKey:y,serverHeader:_}=await N({attestation:v.attestation,rootCertBER:s,expectedPCRs:r});(0,u.t)({url:a,name:"ClientIdentifier",value:v.clientIdentifier,expirationDate:(new Date).getTime()+15e5,sameSite:"strict",secure:!0});const b=await(async(e,t)=>{const{headers:a,clientKeyPair:s,httpClient:r,serverPublicKey:n,serverHeader:i}=t;await l.ready;const o=l.crypto_kx_client_session_keys(s.publicKey,s.privateKey,new Uint8Array(n)),c=l.crypto_secretstream_xchacha20poly1305_init_push(o.sharedRx),d=c.state,u=c.header,h=l.crypto_secretstream_xchacha20poly1305_init_pull(new Uint8Array(i),o.sharedTx),g={clientHeader:l.to_hex(u)},v=await(0,p.z)(r.post(e,g,{observe:"response",responseType:"json",withCredentials:!0,headers:a}));if((0,m.hx)(v))throw new Error("HTTP error");return{clientStateOut:d,sessionKeys:o,clientStateIn:h}})(g,{headers:o,httpClient:n,clientKeyPair:c,serverPublicKey:y,serverHeader:_});return{clientStateOut:b.clientStateOut,clientStateIn:b.clientStateIn,headers:o}};var F=a(73155);const D=h.z.object({requestId:h.z.string(),errors:h.z.array(h.z.object({status:h.z.string(),code:h.z.string(),message:h.z.string()}))});let O=class{assertData(e){if(!e)throw new Error("toDecode expected to be truthy");if("[object Object]"!=`${e}`||Array.isArray(e))throw new Error("toDecode expected to be object");if(!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('toDecode expected to contain a "data" property');const t=e;if("string"!=typeof t.data)throw new Error("toDecode.data expected to be type string but was "+typeof t.data)}decode(e){return this.assertData(e),e.data}};var P=a(60590);class x{async callEnclaveEndpoint(e){return await this.MUTEX.runExclusive((async()=>{const t=this.tunnel;try{return await this.tryCallEnclave(e)}catch(a){if(a instanceof Error&&("CLIENT_IDENTIFIER_NOT_FOUND"===a.message||"CLIENT_SESSION_NOT_PARSED"===a.message||"CLIENT_STATEIN_NOT_FOUND"===a.message))return this.tunnel===t&&(this.tunnel=void 0),await this.tryCallEnclave(e);throw a}}))}async tryCallEnclave(e){const{body:t,endpoint:a,responseSchema:s}=e,r=JSON.stringify(t),n=await this.platformInfoService.getPlatformInfo(),i=(0,c.Ep)(this.enclaveApiSettings.environment),o=(0,c.$m)(this.enclaveApiSettings.environment);if(void 0===this.tunnel){this.tunnel=U({enclaveApiSettings:this.enclaveApiSettings,httpClient:this.httpClient,expectedPCRs:o,rootCertBER:i,platformInfo:n});try{await this.tunnel}catch(e){throw this.tunnel=void 0,e}}const u=await this.tunnel,{enclaveUrl:h}=this.enclaveApiSettings,{secureContentUrl:g}=d(h,a),{decryptedResponse:v}=await(async(e,t)=>{const{tunnel:{clientStateOut:a,clientStateIn:s,headers:r},httpClient:n}=t;await l.ready;const i=l.crypto_secretstream_xchacha20poly1305_push(a,l.from_string(t.data),null,l.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),o={data:l.to_hex(i)},c=await(0,p.z)(n.post(e,o,{observe:"body",responseType:"json",responseBodyDecoder:new O,withCredentials:!0,headers:r}));if((0,m.hx)(c)){if(c.error instanceof F.R){const e=await JSON.parse(await c.error.response.text()),t=D.safeParse(e);if(t.success){const e=t.data.errors[0];throw new Error(e.code)}}throw new Error("HTTP error")}const d=l.crypto_secretstream_xchacha20poly1305_pull(s,l.from_hex(c.data)).message;return{decryptedResponse:l.to_string(d)}})(g,{data:r,httpClient:this.httpClient,tunnel:u}),y=s.safeParse(JSON.parse(v));if(!y.success)throw new Error(`Enclave response parsing failed. Endpoint: ${a}.`);return y.data}getEnclaveApiSettings(){return this.enclaveApiSettings}constructor(e,t,a){this.platformInfoService=e,this.httpClient=t,this.enclaveApiSettings=a,this.tunnel=void 0,this.MUTEX=new n.WU}}x=(0,r.__decorate)([(0,i.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===P.t?Object:P.t,void 0===o.e?Object:o.e,void 0===c.N6?Object:c.N6])],x)},43685:(e,t,a)=>{a.d(t,{t:()=>u});var s,r=a(491),n=a(92587);!function(e){e.DOMAINS_CREATE_DOMAIN="api/domains/CreateDomain",e.DOMAINS_DELETE_DOMAIN="api/domains/DeleteDomain2",e.DOMAINS_UPDATE_DOMAIN="api/domains/UpdateDomain2",e.DOMAINS_CHECK_DNS_VALIDATION="api/domains/CheckDNSValidation2"}(s||(s={}));var i=a(7165);i.z.object({domainName:i.z.string(),teamUuid:i.z.string(),adminProvisioningKey:i.z.string(),idpMetadata:i.z.object({certificate:i.z.string(),entrypoint:i.z.string()}).optional()});const o=i.z.object({dnsVerificationToken:i.z.string()});i.z.object({domainName:i.z.string(),teamUuid:i.z.string(),adminProvisioningKey:i.z.string()}),i.z.object({domainName:i.z.string(),teamUuid:i.z.string(),adminProvisioningKey:i.z.string(),idpUuid:i.z.string()}),i.z.object({domainName:i.z.string(),adminProvisioningKey:i.z.string(),teamUuid:i.z.string()});const c=i.z.object({previousStatus:i.z.string(),status:i.z.enum(["valid","pending","expired","invalid"]),verificationToken:i.z.string(),lastCheckDateUnix:i.z.number(),pendingReason:i.z.enum(["tokenNotFound","invalidToken"]).nullable(),tokenFound:i.z.string().optional()});var d=a(29910),l=a(87279);class u{async createDomain(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.DOMAINS_CREATE_DOMAIN,body:e,responseSchema:o});return(0,l.Vp)(t)}async deleteDomain(e){return await this.enclaveService.callEnclaveEndpoint({body:e,endpoint:s.DOMAINS_DELETE_DOMAIN,responseSchema:i.z.object({})}),(0,l.Vp)(void 0)}async updateDomain(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:s.DOMAINS_UPDATE_DOMAIN,body:e,responseSchema:i.z.object({})}),(0,l.Vp)(void 0)}async checkDnsValidation(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.DOMAINS_CHECK_DNS_VALIDATION,body:e,responseSchema:c});return(0,l.Vp)(t)}constructor(e){this.enclaveService=e}}u=(0,r.__decorate)([(0,n.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===d.d?Object:d.d])],u)},26755:(e,t,a)=>{a.d(t,{L:()=>u});var s,r=a(491),n=a(92587);!function(e){e.IDPS_CREATE_IDP="api/idps/CreateIdp",e.IDPS_UPDATE_IDP="api/idps/UpdateIdp",e.IDPS_DELETE_IDP="api/idps/DeleteIdp"}(s||(s={}));var i=a(7165);i.z.object({teamUuid:i.z.string().uuid(),adminProvisioningKey:i.z.string(),idpMetadata:i.z.object({certificates:i.z.array(i.z.string()),entrypoint:i.z.string()})});const o=i.z.object({idpUuid:i.z.string().uuid()});i.z.object({teamUuid:i.z.string().uuid(),adminProvisioningKey:i.z.string(),idpUuid:i.z.string().uuid()});const c=i.z.object({idpUuid:i.z.string().uuid()});i.z.object({teamUuid:i.z.string().uuid(),adminProvisioningKey:i.z.string(),idpMetadata:i.z.object({idpUuid:i.z.string(),certificates:i.z.array(i.z.string()).optional(),entrypoint:i.z.string().optional(),groupProvisioningActivated:i.z.boolean().optional()})}),i.z.object({idpUuid:i.z.string().uuid()});var d=a(29910),l=a(87279);class u{async createIdp(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.IDPS_CREATE_IDP,body:e,responseSchema:o});return(0,l.Vp)(t)}async deleteIdp(e){const t=await this.enclaveService.callEnclaveEndpoint({body:e,endpoint:s.IDPS_DELETE_IDP,responseSchema:c});return(0,l.Vp)(t)}async updateIdp(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:s.IDPS_UPDATE_IDP,body:e,responseSchema:i.z.object({})}),(0,l.Vp)({idpUuid:e.idpMetadata.idpUuid})}constructor(e){this.enclaveService=e}}u=(0,r.__decorate)([(0,n.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===d.d?Object:d.d])],u)},35955:(e,t,a)=>{a.d(t,{b:()=>u});var s,r=a(491),n=a(92587),i=a(87279);!function(e){e.SCIM_GET_CONFIGURATION="api/scim/GetSCIMConfiguration",e.SCIM_SET_CONFIGURATION="api/scim/SetSCIMConfiguration"}(s||(s={}));var o=a(29910),c=a(7165);c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string()});const d=c.z.object({token:c.z.string().nullable(),active:c.z.boolean()});c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string(),token:c.z.string(),active:c.z.boolean()});const l=c.z.object({token:c.z.string().nullable(),active:c.z.boolean()});class u{async getScimConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.SCIM_GET_CONFIGURATION,body:e,responseSchema:d});return(0,i.Vp)(t)}async setScimConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.SCIM_SET_CONFIGURATION,body:e,responseSchema:l});return(0,i.Vp)(t)}constructor(e){this.enclaveService=e}}u=(0,r.__decorate)([(0,n.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===o.d?Object:o.d])],u)},96236:(e,t,a)=>{a.d(t,{L:()=>u});var s,r=a(491),n=a(92587),i=a(87279);!function(e){e.SIEM_GET_CONFIGURATION="api/siem/GetSIEMConfiguration",e.SIEM_SET_CONFIGURATION="api/siem/SetSIEMConfiguration"}(s||(s={}));var o=a(29910),c=a(7165);c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string()});const d=c.z.object({token:c.z.string().nullable(),active:c.z.boolean(),instanceURL:c.z.string().nullable(),siemType:c.z.enum(["splunk"]).nullable(),isSelfSignedCertificateAllowed:c.z.boolean()});c.z.object({teamUuid:c.z.string(),adminProvisioningKey:c.z.string(),token:c.z.string().optional(),active:c.z.boolean().optional(),instanceURL:c.z.string().optional(),siemType:c.z.enum(["splunk"]).nullable().optional(),isSelfSignedCertificateAllowed:c.z.boolean().optional()});const l=c.z.object({token:c.z.string().nullable(),active:c.z.boolean(),instanceURL:c.z.string().nullable(),siemType:c.z.enum(["splunk"]).nullable(),isSelfSignedCertificateAllowed:c.z.boolean()});class u{async getSiemConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.SIEM_GET_CONFIGURATION,body:e,responseSchema:d});return(0,i.Vp)(t)}async setSiemConfiguration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.SIEM_SET_CONFIGURATION,body:e,responseSchema:l});return(0,i.Vp)(t)}constructor(e){this.enclaveService=e}}u=(0,r.__decorate)([(0,n.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===o.d?Object:o.d])],u)},14080:(e,t,a)=>{a.d(t,{v:()=>d});var s,r=a(491),n=a(92587),i=a(87279);!function(e){e.SLACK_INSTALL_SLACK_APP="api/slack/InstallSlackApp",e.SLACK_SEND_SLACK_MESSAGE="api/slack/SendSlackMessage",e.SLACK_UNINSTALL_SLACK_APP="api/slack/UninstallSlackApp"}(s||(s={}));var o=a(29910),c=a(7165);class d{async installSlackApp(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:s.SLACK_INSTALL_SLACK_APP,body:e,responseSchema:c.z.object({})}),(0,i.Vp)(void 0)}async sendSlackMessage(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:s.SLACK_SEND_SLACK_MESSAGE,body:e,responseSchema:c.z.object({})}),(0,i.Vp)(void 0)}async uninstallSlackApp(e){return await this.enclaveService.callEnclaveEndpoint({endpoint:s.SLACK_UNINSTALL_SLACK_APP,body:e,responseSchema:c.z.object({})}),(0,i.Vp)(void 0)}constructor(e){this.enclaveService=e}}d=(0,r.__decorate)([(0,n.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===o.d?Object:o.d])],d)},81646:(e,t,a)=>{a.d(t,{U:()=>b});var s,r=a(491),n=a(92587),i=a(87279);!function(e){e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_CREATE_TEAM_FOR_MIGRATION="api/teams/CreateTeamForMigration",e.TEAMS_GET_TEAM="api/teams/GetTeam",e.TEAMS_DELETE_TEAM="api/teams/DeleteTeam"}(s||(s={}));var o=a(29910),c=a(7165);const d=c.z.object({adminProvisioningKey:c.z.string()}),l=c.z.object({}),u=c.z.enum(["valid","pending","expired","invalid"]),p=c.z.enum(["tokenNotFound","invalidToken"]),m=c.z.object({status:u.nullable(),verificationToken:c.z.string(),lastCheckDateUnix:c.z.number(),pendingReason:p.nullable(),expiryDateUnix:c.z.number()}),h=c.z.object({creationDateUnix:c.z.number(),dnsCheckStatus:m,domainName:c.z.string(),idpUuid:c.z.ostring(),updateDateUnix:c.z.number()}),g=c.z.object({idpUuid:c.z.string().uuid(),certificates:c.z.array(c.z.string()),entrypoint:c.z.string(),groupProvisioningActivated:c.z.boolean().optional(),creationDateUnix:c.z.number(),updateDateUnix:c.z.number()}),v=c.z.object({domains:c.z.record(c.z.string(),h),idps:c.z.record(c.z.string(),g),updateDateUnix:c.z.number(),messageIntegrations:c.z.object({slackStatus:c.z.boolean()})});c.z.object({teamDeviceCredentials:c.z.object({teamUuid:c.z.string(),accessKey:c.z.string(),secretKey:c.z.string(),sharingPublicKey:c.z.string(),sharingPrivateKey:c.z.string()}),certificates:c.z.array(c.z.string()),entrypoint:c.z.string(),masterServiceProviderKey:c.z.string(),domains:c.z.array(c.z.string()),scimToken:c.z.string().optional()});const y=c.z.record(c.z.string(),h),f=c.z.object({domains:y,idps:c.z.record(c.z.string(),g),updateDateUnix:c.z.number()}),_=c.z.object({adminProvisioningKey:c.z.string(),team:f});class b{async createTeam(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.TEAMS_CREATE_TEAM,body:e,responseSchema:d});return(0,i.Vp)(t)}async createTeamForMigration(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.TEAMS_CREATE_TEAM_FOR_MIGRATION,body:e,responseSchema:_});return(0,i.Vp)(t)}async getTeam(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.TEAMS_GET_TEAM,body:e,responseSchema:v});return(0,i.Vp)(t)}async deleteTeam(e){const t=await this.enclaveService.callEnclaveEndpoint({endpoint:s.TEAMS_DELETE_TEAM,body:e,responseSchema:l});return(0,i.Vp)(t)}constructor(e){this.enclaveService=e}}b=(0,r.__decorate)([(0,n.GS)(),(0,r.__metadata)("design:type",Function),(0,r.__metadata)("design:paramtypes",[void 0===o.d?Object:o.d])],b)},55139:(e,t,a)=>{a.d(t,{w:()=>s});const s={AuthsyncExtensionArkRelease:"authsync_extension_ark_release",BBCOM238Duo:"BBCOM-238-duo",CollectionsPageEnabled:"vault_web_collectionpage_dev",SAEXSendSharing:"SAEXSendSharing",DwiMultipleDomainsProd:"dwi_multiple_domains_prod",DisableSecureNotes:"disableSecureNotes",EcommerceWebB2BDiscontinuationDev:"ecommerce_web_b2bDiscontinuation_dev",ItadminSAEXCryptoMigrationPhase3V1:"itadmin_SAEX_CryptoMigration_Phase3_v1",ItadminTacEncryptionserviceSSOmigrationReset:"itadmin_tac_encryptionservice_SSOmigration_reset",SearchRevamp:"onboarding_web_search_revamp_prod",EmptyStateBatch1:"onboarding_web_empty_state_batch1_dev",EmptyStateBatch2:"onboarding_web_empty_state_batch2",EmptyStateBatch3:"onboarding_web_empty_state_batch3",TechWeekWebDisplayLabs:"techWeek_web_displayLabs",TechweekWebAttachmentsForIdsV1:"techweek_web_attachmentsForIds_v1",TechweekWebExpiredLabelforIDDev:"techweek_web_expiredLabelforID_dev",WebplatformWebPrideColors:"webplatform_web_prideColors",WebproductExtensionActivateChangeMasterPasswordRelease:"webproduct_extension_ActivateChangeMasterPassword_release",WebproductExtensionShowUserConsentOptions:"webproduct_extension_ShowUserConsentOptions",SupportMarkdownInSecureNotes:"webproduct_extension_securenotesmarkdown_dev",SharingVaultOtpSetupDev:"sharingVault_web_otp_setup_dev"}},12111:(e,t,a)=>{a.d(t,{k:()=>Y});var s=a(491),r=a(86006),n=a(23297),i=a(66335),o=a(85390),c=a(16433),d=a(87065),l=a(41842),u=a(85798),p=a(50423),m=a(46449),h=a(82874),g=a(96498),v=a(87279),y=a(60399),f=a(92587),_=a(48844),b=a(53344);class S{getFeatureFlipsForActiveUser(e){return(0,y.z)(this.serverApiClient.v1.features.getAndEvaluateForUser({features:e}).pipe((0,_.nb)({success:e=>e.data.enabledFeatures,failure:()=>{throw new Error("Unable to fetch enabled feature flips for the active user")}})))}getAvailableFeatureFlips(){return(0,y.z)(this.serverApiClient.v1.features.listAvailableFeatureFlips({}).pipe((0,_.nb)({success:e=>e.data.features.map((e=>e.name)),failure:()=>{throw new Error("Unable to fetch available feature flips")}})))}constructor(e){this.serverApiClient=e}}S=(0,s.__decorate)([(0,f.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l])],S);var w=a(63144),E=a(56618),C=a(62149),T=a(10722);const I=e=>!(!e||"object"!=typeof e)&&"featureFlips"in e;class A extends((0,w.Q)({persist:!0,scope:C.F.Device,storeName:"feature-flip-store",capacity:E.Y._010KB,codec:T.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:I}})){}class N extends((0,w.Q)({persist:!0,scope:C.F.User,storeName:"feature-flip-store",capacity:E.Y._010KB,codec:T.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:I}})){}var U;!function(e){e.Success="Success",e.Pending="Pending",e.Loading="Loading",e.Cache="Cache"}(U||(U={}));class F extends((0,w.Q)({persist:!1,initialValue:{refreshStatus:"Pending"},scope:C.F.Device,storeName:"feature-flip-refresh-store",capacity:E.Y._001KB})){}function D(e,t){return!(!(0,v.d6)(e)||(0,v.db)(e).userName)||(!(0,v.d6)(e)||!(0,v.db)(e).userName||[U.Success,U.Cache].includes(t))}const O=(e,t)=>Object.keys(e).reduce(((a,s)=>{const r=t[s];return a[s]=void 0!==r?r.isActivated:e[s],a}),{});var P=a(28489);const x=e=>"object"==typeof e&&null!==e&&(0,P.l$)(e,"availableLabs")&&"object"==typeof e.availableLabs&&null!==e.availableLabs;class R extends((0,w.Q)({persist:!0,scope:C.F.User,storeName:"labs-store",capacity:E.Y._001KB,codec:T.E,storage:{initialValue:{availableLabs:{}},schemaVersion:1,typeGuard:x}})){}var k=a(4373),L=a(96168);class M extends((0,L.Hu)("refresh_available_labs_failed","Unable to refresh available labs for the active user")){}class j extends((0,L.Hu)("fetch_available_labs_failed","Unable to fetch labs for the active user")){}class z{async refreshAvailableLabs(){const e=await this.getAvailableLabs();if((0,v.hx)(e))return(0,v.Rn)(new M);const t=await this.labsStore.getState(),a=(0,v.db)(e).reduce(((e,a)=>(e[a.featureName]={...a,isActivated:!!t.availableLabs[a.featureName]?.isActivated},e)),{});return await this.labsStore.set({availableLabs:a}),(0,v.Vp)(void 0)}async getAvailableLabs(){const e=this.getRequiredFeatures(),{featureFlips:t}=await this.featureFlipsStore.getState();return(0,y.z)(this.serverApiClient.v1.features.listAvailableLabs({}).pipe((0,_.DZ)((()=>new j)),(0,_.lk)((a=>(0,v.Vp)(a.data.labs.filter((t=>e.has(t.featureName))).filter((e=>!1===t[e.featureName])))))))}getRequiredFeatures(){const e=this.introspection.modules;return Object.keys(e).reduce(((t,a)=>{const s=e[a];if(s.requiredFeatureFlips)for(const e of s.requiredFeatureFlips)t.add(e);return t}),new Set)}constructor(e,t,a,s){this.serverApiClient=e,this.introspection=t,this.featureFlipsStore=a,this.labsStore=s}}z=(0,s.__decorate)([(0,f.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l,void 0===k.Q1?Object:k.Q1,void 0===N?Object:N,void 0===R?Object:R])],z);class V{async handle({body:e}){if(!e.userName)return await this.featureFlipsRefreshStore.set({refreshStatus:U.Pending}),void await this.featureFlipsStore.set({featureFlips:{}});await this.featureFlipsRefreshStore.set({refreshStatus:U.Loading});const t=this.labsService.getRequiredFeatures(),a=Array.from(t);let s=[];await this.allowedToFailForGetAvailableFeatureFlips.doOne((()=>this.featureFlipsService.getAvailableFeatureFlips().then((e=>{s=e.filter((e=>t.has(e)))}))));const r=0===s.length?a:s;await this.allowedToFailForGetFeatureFlipsForActiveUser.doOne((async()=>{try{const e=await this.featureFlipsService.getFeatureFlipsForActiveUser(r),t=new Set(e),n=new Set(s),i=a.reduce(((e,a)=>(e[a]=t.has(a)||!n.has(a)&&void 0,e)),{});await this.featureFlipsStore.set({featureFlips:i}),await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),await this.featureFlipsRefreshStore.set({refreshStatus:U.Success})}catch(e){throw await this.featureFlipsRefreshStore.set({refreshStatus:U.Cache}),e}}))}constructor(e,t,a,s,r,n,i){this.allowedToFailForGetAvailableFeatureFlips=e,this.allowedToFailForGetFeatureFlipsForActiveUser=t,this.allowedToFailForGetAvailableLabs=a,this.featureFlipsService=s,this.featureFlipsStore=r,this.featureFlipsRefreshStore=n,this.labsService=i}}V=(0,s.__decorate)([(0,u.b)(i.W_),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.J?Object:p.J,void 0===p.J?Object:p.J,void 0===p.J?Object:p.J,void 0===S?Object:S,void 0===N?Object:N,void 0===F?Object:F,void 0===z?Object:z])],V);class B{execute(){return(0,o.a)([this.requestContextClient.queries.activeUser().pipe((0,c.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,d.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,d.U)((e=>e.featureFlips))),this.labsStore.state$.pipe((0,d.U)((e=>e.availableLabs)))]).pipe((0,l.h)((([e,t])=>D(e,t))),(0,d.U)((([e,,t,a])=>{if((0,v.d6)(e)){if(!(0,v.db)(e).userName)return(0,v.Vp)({});const s=O(t,a);return(0,v.Vp)(s)}throw new Error("Cannot determine if user is logged in")})))}constructor(e,t,a,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=a,this.labsStore=s}}B=(0,s.__decorate)([(0,m.e)(n.r6),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===N?Object:N,void 0===F?Object:F,void 0===g.Q?Object:g.Q,void 0===R?Object:R])],B);class K{execute({body:e}){const{featureFlip:t}=e;return(0,o.a)([this.requestContextClient.queries.activeUser().pipe((0,c.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,d.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,d.U)((e=>e.featureFlips))),this.labsStore.state$.pipe((0,d.U)((e=>e.availableLabs)))]).pipe((0,l.h)((([e,t])=>D(e,t))),(0,d.U)((([e,,a,s])=>{if((0,v.d6)(e)){if(!(0,v.db)(e).userName)return(0,v.Vp)(void 0);const r=O(a,s);return(0,v.Vp)(r[t])}throw new Error("Cannot determine if user is logged in")})))}constructor(e,t,a,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=a,this.labsStore=s}}K=(0,s.__decorate)([(0,m.e)(n.fV),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===N?Object:N,void 0===F?Object:F,void 0===g.Q?Object:g.Q,void 0===R?Object:R])],K);class G{execute(){return(0,o.a)([this.requestContextClient.queries.activeUser().pipe((0,c.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,d.U)((e=>e.refreshStatus))),this.labsStore.state$.pipe((0,d.U)((e=>e.availableLabs)))]).pipe((0,l.h)((([e,t])=>D(e,t))),(0,d.U)((([e,,t])=>{if((0,v.d6)(e))return(0,v.db)(e).userName?(0,v.Vp)(t):(0,v.Vp)({});throw new Error("Cannot determine if user is logged in")})))}constructor(e,t,a){this.labsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=a}}G=(0,s.__decorate)([(0,m.e)(n._l),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===R?Object:R,void 0===F?Object:F,void 0===g.Q?Object:g.Q])],G);class q{async execute(){return await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),(0,v.Vp)(void 0)}constructor(e,t){this.allowedToFailForGetAvailableLabs=e,this.labsService=t}}q=(0,s.__decorate)([(0,h.W)(n._x),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.J?Object:p.J,void 0===z?Object:z])],q);class ${async execute({body:e}){const{id:t,isActivated:a}=e,s=await this.labsStore.getState(),r={...s,availableLabs:{...s.availableLabs,[t]:{...s.availableLabs[t],isActivated:a}}};return await this.labsStore.set(r),(0,v.Vp)(void 0)}constructor(e){this.labsStore=e}}$=(0,s.__decorate)([(0,h.W)(n.YM),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===R?Object:R])],$);var Q=a(55139);class H{onFrameworkInit(){this.featureFlipsStoreLegacy.clearStorage()}constructor(e){this.featureFlipsStoreLegacy=e}}H=(0,s.__decorate)([(0,f.ar)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A?Object:A])],H);var W=a(41511);class Y{}Y=(0,s.__decorate)([(0,r.Yl)({api:n.cV,providers:[S,z],imports:[W.n],exports:[S],handlers:{commands:{refreshAvailableLabs:q,toggleLab:$},queries:{userFeatureFlips:B,userFeatureFlip:K,userAvailableLabs:G},events:{...(0,r.g4)(i.t$,{activeUserSet:V})}},stores:[A,N,F,R],requiredFeatureFlips:Object.values(Q.w),onFrameworkInit:H,domainName:"framework"})],Y)},93218:(e,t,a)=>{a.d(t,{p:()=>P});var s=a(491),r=a(86006),n=a(86213),i=a(59965),o=a(82874),c=a(87279),d=a(50123),l=a(60399),u=a(92587),p=a(96303),m=a(63144),h=a(56618),g=a(62149),v=a(10722);const y=e=>null!==e&&"object"==typeof e&&("cachedIcons"in e&&null!==e.cachedIcons&&"object"==typeof e.cachedIcons);class f extends((0,m.Q)({persist:!0,storage:{schemaVersion:1,initialValue:{cachedIcons:{}},typeGuard:y},scope:g.F.Device,storeName:"icons-store",capacity:h.Y._100KB,codec:v.E})){}const _=e=>e<0?0:24*e*60*60*1e3,b=e=>null!==e&&"object"==typeof e&&"validity"in e&&"updatedAt"in e&&"domainURL"in e,S=e=>e.hash.slice(0,6);var w=a(55667),E=a(53344);class C{async updateIconsCacheEntries(e){const t=await this.store.getState();await this.store.set({...t,cachedIcons:{...t.cachedIcons,...e.reduce(((e,t)=>(e[t.domainURL]=t,e)),{})}})}async computeDomainHash(e){const t=await this.hasher.compute((new TextEncoder).encode(e),"SHA-256");return(0,p.k)(t)}async fetchIconForDomain(e){const t=await this.computeDomainHash(e);this.domainsToFetch[e]={hash:t,domainURL:e},this.fetchAndRequestDomains()}constructor(e,t,a,s){this.hasher=e,this.serverApiClient=t,this.store=a,this.domainsToFetch=s,this.requestDomains=async e=>{0!==e.length&&this.serverApiClient.v1.icons.requestIcons({domains:e.map((e=>e.domainURL))})},this.fetchDomains=async e=>{const t=e.map(S);return await(0,l.z)(this.serverApiClient.v1.icons.getIcons({hashes:t}))},this.fetchAndRequestDomains=((e,t)=>{let a=!1;return(...s)=>{a||(a=!0,setTimeout((()=>{a=!1,e(...s)}),t))}})((async()=>{const e=(await this.store.getState()).cachedIcons,t=Object.values(this.domainsToFetch).filter((t=>{const a=void 0===e[t.domainURL]?void 0:e[t.domainURL],s=(e=>null!==e&&"object"==typeof e&&"updatedAt"in e&&"domainURL"in e&&!b(e))(a)?_(1):_(14);return((e,t)=>!(e&&Date.now()<e.updatedAt+t))(a,s)}));if(0===t.length)return;const a=await this.fetchDomains(t),s=(0,c.d6)(a)?(0,c.db)(a).data.icons:[],r=t.map((e=>{const t=s.find((t=>t.hash===e.hash));return{...t||{},hash:e.hash,domainURL:e.domainURL,updatedAt:Date.now()}}));await this.updateIconsCacheEntries(r);const n=r.filter((e=>!e.url));await this.requestDomains(n),this.domainsToFetch={}}),100)}}C=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===w.Z?Object:w.Z,void 0===E.l?Object:E.l,void 0===f?Object:f,"undefined"==typeof DomainsToFetch?Object:DomainsToFetch])],C);class T{execute({body:{domainURL:e}}){return this.iconsService.fetchIconForDomain(e),Promise.resolve((0,c.Vp)(void 0))}constructor(e){this.iconsService=e}}T=(0,s.__decorate)([(0,o.W)(d.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===C?Object:C])],T);var I=a(87065),A=a(6136),N=a(46449),U=a(17482);class F{execute(e){const{domainURL:t}=e.body;return this.store.state$.pipe((0,I.U)((e=>{const a=e.cachedIcons[t];return b(a)&&(e=>"valid"===e.validity&&Boolean(e.url))(a)?a:null})),(0,A.x)(),(0,I.U)((e=>e?(0,c.Vp)(e):(0,c.Rn)((0,U.xF)()))))}constructor(e){this.store=e}}F=(0,s.__decorate)([(0,N.e)(U.el),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===f?Object:f])],F);var D=a(16624),O=a(41511);class P{}P=(0,s.__decorate)([(0,r.Yl)({api:i.T,imports:[D.D,O.n],providers:[...(0,n.H)(C,{inject:[w.Z,E.l,f],asyncFactory:(e,t,a)=>Promise.resolve(new C(e,t,a,{}))})],stores:[f],handlers:{commands:{fetchIconForDomain:T},events:{},queries:{getIconForDomain:F}}})],P)},10842:(e,t,a)=>{a.d(t,{B:()=>_});var s=a(491),r=a(86006),n=a(11553),i=a(35463),o=a(41182),c=a(37182),d=a(69885),l=a(6136),u=a(87065),p=a(14122),m=a(46449),h=a(89422),g=a(91247),v=a(48844),y=a(87279);class f{execute({body:e}){return this.carbon.queries.liveKillSwitch(e.killSwitch).pipe((0,v.nb)({failure:e=>{throw new Error("Unexpected failure getting kill switch value from Carbon",{cause:e})},success:o.y}),(0,c.K)((e=>(this.exceptionLogger.captureException(e,{useCaseName:"getKillSwitchQuery"}),(0,d.of)(void 0)))),(0,l.x)(),(0,u.U)(y.Vp))}constructor(e,t){this.carbon=e,this.exceptionLogger=t}}f=(0,s.__decorate)([(0,m.e)(g.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p._?Object:p._,void 0===h.v?Object:h.v])],f);class _{}_=(0,s.__decorate)([(0,r.Yl)({api:i.m,handlers:{commands:{},events:{},queries:{getKillSwitch:f}},imports:[n.G],domainName:"framework"})],_)},5206:(e,t,a)=>{a.d(t,{i:()=>p});var s=a(491),r=a(74650),n=a(86006),i=a(60590),o=a(14122),c=a(46449),d=a(48844),l=a(87279);class u{execute(){return this.carbon.queries.getPlatformInfo().pipe((0,d.lk)((e=>(0,l.Vp)(e))))}constructor(e){this.carbon=e}}u=(0,s.__decorate)([(0,c.e)(r.a),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o._?Object:o._])],u);class p{}p=(0,s.__decorate)([(0,n.Yl)({api:r.J,providers:[i.t],exports:[i.t],handlers:{commands:{},events:{},queries:{platformInfo:u}},domainName:"framework"})],p)},60590:(e,t,a)=>{a.d(t,{t:()=>l});var s=a(491),r=a(60399),n=a(92587),i=a(53932),o=a(48844),c=a(20195),d=a(14676);class l{getPlatformInfo(){return(0,r.z)(this.client.getClient(d.W).queries.getPlatformInfo().pipe((0,o.nb)({success:e=>e,failure:c.j})))}constructor(e){this.client=e}}l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i.m?Object:i.m])],l)},86999:(e,t,a)=>{a.d(t,{c:()=>l});var s=a(491),r=a(92587),n=a(90318),i=a(87279),o=a(14122),c=a(50756),d=a(37741);class l extends d.tI{async decipher(e,t){const{carbon:a}=this.carbonLegacyClient.commands,s=await a({name:"decipherRemoteFile",args:[{cipheredFileContent:e,fileMetaData:t}]});if((0,i.hx)(s))return(0,i.Rn)(c.RemoteFileUpdateError.DecipherError);const{carbonResult:r}=(0,i.db)(s);return(e=>"object"==typeof e&&null!==e&&Object.entries(e).some((([e,t])=>"decipheredFile"===e&&t instanceof ArrayBuffer)))(r)?(0,i.Vp)(r.decipheredFile):(0,i.Rn)(c.RemoteFileUpdateError.DecipherError)}constructor(e,t){super(),this.carbonLegacyClient=e,this.appLogger=t}}l=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o._?Object:o._,void 0===n.V?Object:n.V])],l)},7301:(e,t,a)=>{a.d(t,{Q:()=>c});var s=a(491),r=a(92587),n=a(60399),i=a(7537),o=a(58376);class c{publish(e){(0,n.z)(this.publishSubscriber).then((t=>t.next(e)))}fileSubscription(e){return this.filesToCheck={...this.filesToCheck,...e},this.updatedFileStream$}getFilesToCheck(){return this.filesToCheck}constructor(){this.filesToCheck={},this.publishSubscriber=new i.t,this.updatedFileStream$=new o.y((e=>{this.publishSubscriber.next(e),this.publishSubscriber.complete()}))}}c=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],c)},39976:(e,t,a)=>{a.d(t,{P:()=>f});var s=a(491),r=a(87279),n=a(48844),i=a(18533),o=a(50756),c=a(92587),d=a(26468),l=a(69885),u=a(60399),p=a(87065),m=a(37741),h=a(39069),g=a(25994),v=a(53344);const y=e=>e[1].status===h.nQ;class f extends m.gG{async downloadRemoteFileUpdate(e){if(0===Object.keys(e.files).length)return[];const t=await this._getFileMeta(e);return(0,r.hx)(t)?[(0,l.of)(t)]:this._retrieveFilesFromServer((0,r.db)(t))}_getFileMeta(e){return(0,u.z)(this.serverApiClient.v1.file.getFileMetaV2(e).pipe((0,p.U)((e=>{if((0,r.hx)(e))return(0,r.Rn)(o.RemoteFileUpdateError.ServerError);const t=(0,r.db)(e);return"fileInfos"in(a=t.data)&&Object.values(a.fileInfos).every((e=>"object"==typeof e&&null!==e&&"status"in e&&void 0!==e.status&&null!==e.status&&h.PQ.has(e.status)))?(0,r.Vp)(t.data.fileInfos):(0,r.Rn)(o.RemoteFileUpdateError.ServerError);var a}))))}_retrieveFilesFromServer(e){return Object.entries(e).filter(y).map((([e,t])=>this._getBufferFromURL(e,t)))}_getBufferFromURL(e,t){return this.httpClient.get(t.url,{observe:"body",responseType:"arraybuffer"}).pipe((0,n.Qn)(this._handleSuccess(e,t)),(0,n.DZ)(this._handleFailure))}_handleFailure(e){return(0,i.EQ)(e,{BadStatus:e=>e.response.status===g.W.NotModified?h.ek:o.RemoteFileUpdateError.DownloadError,FetchFailedError:()=>o.RemoteFileUpdateError.DownloadError})}_handleSuccess(e,t){return a=>({fileName:e,buffer:a,updatedFile:t})}constructor(e,t){super(),this.httpClient=e,this.serverApiClient=t}}f=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.e?Object:d.e,void 0===v.l?Object:v.l])],f)},1598:(e,t,a)=>{a.d(t,{u:()=>u,w:()=>l});var s=a(90318),r=a(43702),n=a(41842),i=a(87065),o=a(25859),c=a(6220),d=a(7301);class l{initFileObservation(){this.newlyUpdatedFiles$.subscribe(this._handleRFUDownload.bind(this))}streamFileUpdate(){return this.store.state$.pipe((0,n.h)((e=>0!==e.revision)),(0,i.U)((e=>e.data)),(0,n.h)((e=>this.settings.typeguard(e))))}async _handleRFUDownload(e){const{fileName:t}=this.settings;if(!(t in e))return;const a=e[t],s=this.jsonSerializerCodec.decode(a.buffer);this.settings.typeguard(s)&&(await this.store.set({filename:a.fileName,data:s,revision:a.revision,lastDownloadTimestamp:a.lastDownloadTimestamp}),this.rfuDispatcher.fileSubscription({[t]:a.revision}))}constructor(e,t,a,s){this.settings=e,this.store=t,this.appLogger=a,this.rfuDispatcher=s;const{fileName:n}=e;this.jsonSerializerCodec=new r.b,this.newlyUpdatedFiles$=(0,o.P)((async()=>{const e=await this.store.getState();return{[n]:e.revision}})).pipe((0,c.z)((e=>this.rfuDispatcher.fileSubscription(e))))}}function u(e){return{token:l,asyncFactory:(t,a,s)=>Promise.resolve(new l(e,t,a,s)),inject:[e.storeClass,s.V,d.Q]}}},47830:(e,t,a)=>{a.d(t,{Q:()=>h});var s=a(491),r=a(92587),n=a(1598),i=a(76053),o=a(63144),c=a(56618),d=a(10722),l=a(62149);const u=e=>!("object"!=typeof e||null===e)&&("filename"in e&&null!==e.filename&&void 0!==e.filename&&"string"==typeof e.filename&&"revision"in e&&null!==e.revision&&void 0!==e.revision&&"number"==typeof e.revision),p=e=>({filename:e,revision:0,data:{},lastDownloadTimestamp:Date.now()});class m{onFrameworkInit(){this.rfuClient.initFileObservation()}constructor(e){this.rfuClient=e}}m=(0,s.__decorate)([(0,r.ar)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.w?Object:n.w])],m);const h=(e,t)=>{const a=(e=>class extends((0,o.Q)({storeName:"RFUStore",persist:!0,storage:{schemaVersion:1,initialValue:p(e),typeGuard:u},codec:d.E,storeTypeGuard:u,capacity:c.Y._010KB,scope:l.F.Device,isCache:!0})){})(e);return{providers:[(0,n.u)({fileName:e,storeClass:a,typeguard:t})],onFrameworkInit:[m],imports:[i.Q],stores:[a]}}},37741:(e,t,a)=>{a.d(t,{gG:()=>s,pF:()=>n,tI:()=>r});class s{}class r{}class n{}},76053:(e,t,a)=>{a.d(t,{Q:()=>y});var s=a(491),r=a(86006),n=a(75421),i=a(62149),o=a(39976),c=a(92587),d=a(7301),l=a(37741);class u{run(){const e=this.dispatcherService.getFilesToCheck();this.remoteFileUpdateService.observeRemoteFileUpdates(e).subscribe((e=>{this.dispatcherService.publish(e)})),this.remoteFileUpdateService.downloadAndDecipherRemoteFiles()}constructor(e,t){this.remoteFileUpdateService=e,this.dispatcherService=t}}u=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.pF?Object:l.pF,void 0===d.Q?Object:d.Q])],u);var p=a(86999),m=a(15792),h=a(12111),g=a(41511),v=a(23047);class y{static configure(e,t,a){return{module:y,configurations:{remoteFileUpdateInfrastructure:e,remoteFileUpdateDownloaderInfrastructure:t,decipherInfrastructure:a}}}}y=(0,s.__decorate)([(0,r.Yl)({sharedModuleName:"RemoteFileUpdateModule",configurations:{remoteFileUpdateInfrastructure:{token:l.pF},remoteFileUpdateDownloaderInfrastructure:{token:l.gG},decipherInfrastructure:{token:l.tI}},crons:[{handler:u,periodInMinutes:30,name:"RFUCron",scope:i.F.User}],providers:[m.U,p.c,o.P,d.Q],imports:[h.k,n.X,g.n,v.I],exports:[m.U,p.c,o.P,d.Q],domainName:"framework"})],y)},15792:(e,t,a)=>{a.d(t,{U:()=>b});var s=a(491),r=a(92587),n=a(90318),i=a(53932),o=a(87279),c=a(91501),d=a(6220),l=a(87065),u=a(60399),p=a(7537),m=a(58376),h=a(5574),g=a(86999),v=a(39976),y=a(37741),f=a(39069),_=a(50756);class b extends y.pF{observeRemoteFileUpdates(e){return this._filesToCheck={files:{...this._filesToCheck.files,...e}},this._downloadedFileStream$}async downloadAndDecipherRemoteFiles(){const e=(await this.rfuDownloaderService.downloadRemoteFileUpdate(this._filesToCheck)).map((e=>this._downloadAndDecipherSingleFile(e)));(0,c.D)(e).subscribe((e=>{const t=e.reduce(((e,t)=>{if((0,o.hx)(t)){const a=(0,o.Yv)(t);return a===f.ek||this.sendRFUEvents(_.FlowStep.Error,a),e}const a=(0,o.db)(t);return this.sendRFUEvents(_.FlowStep.Complete),{...e,[a.fileName]:a}}),{});this._callEmitDownloadedFilesUpdate(t)}))}async _applyDecipheringStep(e){const t=e.updatedFile.key?await this.rfuDecipheringService.decipher(e.buffer,e.updatedFile):(0,o.Vp)(e.buffer);return(0,o.d6)(t)?(0,o.Vp)({...e,buffer:(0,o.db)(t)}):t}_downloadAndDecipherSingleFile(e){return e.pipe((0,d.z)((e=>(0,o.d6)(e)?this._applyDecipheringStep((0,o.db)(e)):Promise.resolve(e))),(0,l.U)((e=>{if((0,o.hx)(e))return e;const{fileName:t,updatedFile:a,buffer:s}=(0,o.db)(e);return(0,o.Vp)({fileName:t,revision:a.revision,buffer:s,lastDownloadTimestamp:Date.now()})})))}_callEmitDownloadedFilesUpdate(e){return(0,u.z)(this._emitDownloadedFilesUpdate$).then((t=>{t(e)}))}sendRFUEvents(e,t=undefined){const{trackEvent:a}=this.cqrsClient.getClient(h.Yu).commands;a({event:new _.UserReceiveRemoteFileUpdateEvent({flowStep:e,remoteFileUpdateError:t,packageSource:_.PackageSource.Graphene})})}constructor(e,t,a,s){super(),this.appLogger=e,this.rfuDownloaderService=t,this.rfuDecipheringService=a,this.cqrsClient=s,this._filesToCheck={files:{}},this._emitDownloadedFilesUpdate$=new p.t,this._downloadedFileStream$=new m.y((e=>{this._emitDownloadedFilesUpdate$.next((t=>{e.next(t)})),this._emitDownloadedFilesUpdate$.complete()}))}}b=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.V?Object:n.V,void 0===v.P?Object:v.P,void 0===g.c?Object:g.c,void 0===i.w?Object:i.w])],b)},39069:(e,t,a)=>{a.d(t,{PQ:()=>r,ek:()=>n,nQ:()=>s});const s="update_available",r=new Set([s,"not_updated","not_found","error_server"]),n="not_modified"},44462:(e,t,a)=>{a.d(t,{L:()=>s});class s{constructor(e){this.serverEndpoint=e.serverEndpoint,this.durationInQueue=e.durationInQueue,this.maxExceptionCountPerSession=e.maxExceptionCountPerSession,this.retryDelay=e.retryDelay}}},35171:(e,t,a)=>{a.d(t,{u:()=>P});var s=a(491),r=a(60399),n=a(41842),i=a(87065),o=a(6136),c=a(34987),d=a(14888),l=a(24966),u=a(9036),p=a(92587),m=a(26468),h=a(60785),g=a(90318),v=a(43702);var y,f=a(23711),_=a(49499),b=a(87279),S=a(69259),w=a(60590),E=a(44462),C=a(61223);function T(e){switch(e){case u.T.CRITICAL:return 2;case u.T.WARNING:return 1}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(y||(y={}));const I=(e,t)=>({action:"logOnline",code:T(t.criticality),type:e.platformName,version:e.appVersion,additionalInfo:JSON.stringify({manifestVersion:e.manifestVersion,buildType:e.buildType,...t.origin?{origin:t.origin}:{},cause:t.cause,domainName:t.domainName??"unknown"}),browser:e.browser,browserVersion:e.browserVersion,exceptiontype:t.exceptionType??"grapheneException",message:t.message,os:e.os,osVersion:e.osVersion,sessionId:t.sessionId,stack:t.callStack,initialUseCaseModule:t.moduleName,initialUseCaseName:t.useCaseName,errorCount:1,featureFlips:(t.featuresFlipped??[]).join(","),line:t.lineNumber,file:t.fileLocation});function A(e,t){return new C.L("string"==typeof(a=I(e,t))?a:Object.keys(a).reduce(((e,t)=>{const s=a[t];return void 0===s||(e[t]="string"==typeof s?s:JSON.stringify(s)),e}),{}));var a}const N={"Content-Type":"application/x-www-form-urlencoded"},U=".graphene.exceptionLogs",F=new v.b,D=new class{constructor(e){this.typeGuard=e}decode(e){if(this.typeGuard(e))return e;throw new Error("Bad type")}encode(e){return e}}((e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.keys(e).every((e=>"string"==typeof e))&&Object.values(e).every((e=>{return!!((t=e)&&"object"==typeof t&&"entry"in t&&"id"in t&&"date"in t)&&"string"==typeof t.id&&"number"==typeof t.date&&(0,u.h)(t.entry);var t}))))),O=new f.z;class P{async logException(e){console.error(e);const t=this.settings.maxExceptionCountPerSession??10,a=e.message.length?e.message:"UNKNOWN_EXCEPTION";if(a in this.logExceptionsCount){const e=this.logExceptionsCount[a];if(e===t)return Promise.resolve();this.logExceptionsCount[a]=e+1}else this.logExceptionsCount[a]=1;const s=await this.enqueue(e);await(0,r.z)(this.queue$.pipe((0,n.h)((e=>!(s in e)||!!e[s].error))))}async start(){await this.safeLoadPlatformInfo(),await this.loadQueue();const e=this.settings.retryDelay??6e4,t=this.queue$.pipe((0,i.U)((e=>Object.keys(e))),(0,o.x)(((e,t)=>t.every((t=>e.includes(t))))),(0,c.b)((()=>this.processQueue())),(0,d.X)({delay:e})).subscribe();return{stop:async()=>{t.unsubscribe(),await this.saveQueue()}}}async safeLoadPlatformInfo(){try{this.platformInfo=await this.platformInfoService.getPlatformInfo()}catch(e){this.logger.error("Failed to get platform info, using defaults",e),this.platformInfo={platformName:"server_carbon_unknown",lang:"unknown",browser:"unknown",country:"unknown",buildType:S.P.PRODUCTION,osCountry:"unknown",osVersion:"unknown",appVersion:"unknown",browserVersion:"unknown",os:"unknown"}}}async ignoreError(e){try{return await e(),!0}catch(e){return this.logger.error("failed to send error log",e),!1}}async saveQueue(){await this.ignoreError((async()=>{const e=await this.codec.encode(this.queue$.value);await this.kvStore.set(U,e)}))}async loadQueue(){await this.ignoreError((async()=>{const e=await this.kvStore.get(U);if(!e||""===e)return void this.queue$.next({});const t=await this.codec.decode(e),a=Date.now()-(this.settings.durationInQueue??864e5);for(const e of Object.keys(t))t[e].date<a&&delete t[e];this.queue$.next(t)}))}async enqueue(e){const t={date:Date.now(),entry:e,id:`${Date.now()}-${Math.random()}`};return this.queue$.value[t.id]=t,await this.saveQueue(),this.queue$.next(this.queue$.value),t.id}async processQueue(){const e=this.platformInfo;if(!e)throw new Error("No platform info");for(;Object.keys(this.queue$.value).length>0;){const t=Object.keys(this.queue$.value)[0],a=this.queue$.value[t];if(!await this.ignoreError((async()=>{const t=await(0,r.z)(this.httpClient.post(this.url,A(e,a.entry),{headers:{...N,"Client-Agent":(s=e,`version:${s.appVersion},platform:${s.platformName}}`)},observe:"response"}));var s;if(!(0,b.d6)(t))throw new Error("Failed to send log")})))throw this.queue$.value[t].error=!0,this.queue$.next(this.queue$.value),new Error("failed to send an item from the queue");delete this.queue$.value[t],await this.saveQueue()}this.queue$.next(this.queue$.value)}constructor(e,t,a,s,r){this.httpClient=e,this.kvStore=t,this.logger=a,this.settings=s,this.platformInfoService=r,this.queue$=new l.X({}),this.logExceptionsCount={},this.platformInfo=null,this.url=`${this.settings.serverEndpoint??"https://kck3hlb9.dashlane.com"}/1/softwarelog/create`,this.codec=(0,_.x)(O,F,D)}}P=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.e?Object:m.e,void 0===h.QI?Object:h.QI,void 0===g.V?Object:g.V,void 0===E.L?Object:E.L,void 0===w.t?Object:w.t])],P)},48058:(e,t,a)=>{a.d(t,{F:()=>l});var s=a(491),r=a(91743),n=a(86006),i=a(75421),o=a(5206),c=a(35171),d=a(44462);class l{static configure(e){return{module:l,configurations:{settings:(0,r.z)(e)}}}}l=(0,s.__decorate)([(0,n.Yl)({sharedModuleName:"software-exception-sink",imports:[i.X,o.i],providers:[c.u],exports:[c.u],configurations:{settings:{token:d.L}},domainName:"framework"})],l)},35536:(e,t,a)=>{a.d(t,{t:()=>d});var s=a(10722),r=a(62149),n=a(63144),i=a(56618);const o={drift:null},c=e=>!(!e||"object"!=typeof e||!("drift"in e))&&(null===e.drift||"number"==typeof e.drift);class d extends((0,n.Q)({storeTypeGuard:c,storeName:"clocksync",storage:{initialValue:o,schemaVersion:1,typeGuard:c},scope:r.F.Device,isCache:!0,persist:!0,capacity:i.Y._001KB,codec:s.E})){}},29811:(e,t,a)=>{a.d(t,{E:()=>H,F:()=>W});var s=a(491),r=a(60399),n=a(89618),i=a(92587),o=a(26468),c=a(50423),d=a(71937);class l{async getServerToClientClockDrift(){const{drift:e}=await this.store.getState();return e}storeServerToClientClockDrift(e){return this.store.update((()=>({drift:e})))}constructor(e){this.store=e}}var u=a(21832),p=a(35536),m=a(54404),h=a(77837),g=a(33027),v=a(51402),y=a(9536),f=a(47329),_=a(69865),b=a(99082),S=a(62361),w=a(1117),E=a(34838),C=a(4119),T=a(37703),I=a(59091),A=a(18535),N=a(52839),U=a(55127),F=a(7181),D=a(4863),O=a(8793),P=a(91406),x=a(73873),R=a(77593),k=a(84626),L=a(42882),M=a(32739);const j={v1:{account:m.m,accountrecovery:h.u,authentication:g.V,communication:v.g,darkwebmonitoring:y.D,devices:f.u,features:_.A,feedback:b.x,file:S.$,icons:w.P,integration:E.Y,invitation:C.R,massdeployment:T.W,payments:I.H,premium:A.j,pwleak:N.J,sharingUserdevice:U.b,secretTransfer:F.V,securefile:D.V,sync:O.f,teams:P.p,time:x.q,user:R.n,useractivity:k.V,userconsents:L.G,vpn:M.V}};var z=a(81929),V=a(55667);const B="CF-Access-Client-Id",K="CF-Access-Client-Secret";class G{intercept(e,t){if(e.url.startsWith("https://api.dashlane.com/")||!this.cloudflareKeys)return t(e);if(!e.headers.has(B)&&!e.headers.has(K)){const{cloudflareAccessKey:a,cloudflareSecretKey:s}=this.cloudflareKeys;return t(e.clone({headers:e.headers.set(B,a).set(K,s)}))}return t(e)}constructor(e){this.cloudflareKeys=e,this.id="ServerApiForStagingInterceptor"}}var q=a(17032),$=a(69259),Q=a(60590);class H{async init(){const{clockDriftStore:e,serverApiSettings:t,secureHasher:a,httpClient:s,hmacSigner:r}=this,n=new l(e),i=await this.platformInfoService.getPlatformInfo(),{appKeys:o}=t,{baseUrl:c,cloudflareKeys:u}=await this.initOverridableConfig(t,i.buildType);this.baseUrl=c,s.addInterceptor(new G(u));const p=(0,d.d)({secureHasher:a,httpClient:s,timeSyncStore:n,hmacSigner:r,apis:j,config:{appKeys:o,baseUrl:this.baseUrl,platformInfo:{platformName:i.platformName,version:i.appVersion||"unknown",osversion:i.osVersion||"unknown",language:i.lang||"unknown"}}});await this.initClockDrift(p),this.rawSdk=p}get sdk(){if(!this.rawSdk)throw new Error("ConfiguredServerSdk not initialized");return this.rawSdk}get url(){if(!this.baseUrl)throw new Error("ConfiguredServerSdk base url not found");return this.baseUrl}async initOverridableConfig(e,t){if([$.P.DEV,$.P.NIGHTLY].includes(t))try{const e=(await this.settingsForStagingStore.getState()).api;if(e.override)return{baseUrl:e.baseUrlOverride,cloudflareKeys:{cloudflareAccessKey:e.cloudflareAccessKeyOverride,cloudflareSecretKey:e.cloudflareSecretKeyOverride}}}catch(e){console.error("[background/webservices] Failed to read settings for staging from store",e)}return{baseUrl:e.baseUrl,cloudflareKeys:e.cloudflareKeys}}async initClockDrift(e){await this.allowedToFail.doOne((async()=>{const{drift:t}=await this.clockDriftStore.getState();null===t&&await(0,r.z)(e.refreshClockDrift().pipe((0,n.V)({first:5e3})))}))}constructor(e,t,a,s,r,n,i,o){this.serverApiSettings=e,this.httpClient=t,this.clockDriftStore=a,this.hmacSigner=s,this.secureHasher=r,this.platformInfoService=n,this.allowedToFail=i,this.settingsForStagingStore=o}}function W(){return{token:H,asyncFactory:async(e,t,a,s,r,n,i,o)=>{const c=new H(e,t,a,s,r,n,i,o);return await c.init(),c},inject:[u.oN,o.e,p.t,z.q,V.Z,Q.t,c.J,q.L]}}H=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===u.oN?Object:u.oN,void 0===o.e?Object:o.e,void 0===p.t?Object:p.t,void 0===z.q?Object:z.q,void 0===V.Z?Object:V.Z,void 0===Q.t?Object:Q.t,void 0===c.J?Object:c.J,void 0===q.L?Object:q.L])],H)},66610:(e,t,a)=>{a.d(t,{B:()=>i});var s=a(491),r=a(92587),n=a(29811);class i{get v1(){return this.configuredServerSdk.sdk.v1}constructor(e){this.configuredServerSdk=e}}i=(0,s.__decorate)([(0,r.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.E?Object:n.E])],i)},61798:(e,t,a)=>{a.d(t,{J:()=>n,X:()=>r});var s=a(20195);const r=e=>({FetchFailedError:e,InternalServerError:e,InvalidRequest:e,RateLimited:e,ServiceUnavailable:e,UnspecifiedBadStatus:e}),n=r((()=>(0,s.j)("Error calling server API")))},53344:(e,t,a)=>{a.d(t,{l:()=>l});var s=a(491),r=a(34987),n=a(92587),i=a(64839),o=a(87957),c=a(29811),d=a(35159);class l{get baseUrl(){return this._baseUrl}get v1(){return this.appliedV1Services}buildInjectedServices(e,t){return Object.keys(t[e]).reduce(((a,s)=>({...a,[s]:this.buildInjectedApiServices(e,t,s)})),{})}buildInjectedApiServices(e,t,a){return Object.getOwnPropertyNames(Object.getPrototypeOf(t.v1[a])).filter((e=>"constructor"!==e)).reduce(((s,r)=>({...s,[r]:this.buildInjectedRouteService(t,e,a,r)})),{})}buildInjectedRouteService(e,t,a,s){const n=o.t[a][s];if(!n)throw new Error("Unable to find endpoint descriptor");const{authType:c}=n;return(...n)=>{const o=e[t][a],d=o[s].bind(o);if(c===i.d.USER_DEVICE)return this.credentialsService.getActiveUserDeviceCredentials().pipe((0,r.b)((e=>d(e,...n))));if(c===i.d.MASS_DEPLOYED_TEAM_KEY)return this.credentialsService.getMassDeploymentTeamKeyCredentials().pipe((0,r.b)((e=>d(e,...n))));if([i.d.NONE,i.d.APP].includes(c))return d(...n);throw new Error("Not supported")}}constructor(e,t){this.appliedV1Services=this.buildInjectedServices("v1",e.sdk),this.credentialsService=t,this._baseUrl=e.url}}l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.E?Object:c.E,void 0===d.n?Object:d.n])],l)},35159:(e,t,a)=>{a.d(t,{n:()=>h});var s=a(491),r=a(162),n=a(87065),i=a(34987),o=a(87279),c=a(92587),d=a(53932),l=a(60785),u=a(90318),p=a(66335),m=a(21832);class h{getMassDeploymentTeamKeyCredentials(){return(0,r.D)(this.managedStorageInfrastructure.get("MassDeployedTeamKey")).pipe((0,n.U)((e=>{if(!e)throw new Error("Couldn't find MassDeployedTeamKey in browser managed storage");const[t,a]=e.split("-");return{massDeployedTeamAccessKey:t,massDeployedTeamSecretKey:a}})))}getActiveUserDeviceCredentials(){const{queries:{activeUser:e}}=this.cqrsClient.getClient(p.t$);return e().pipe((0,n.U)((e=>{if((0,o.d6)(e))return(0,o.db)(e);throw new Error("Failed to get active user")})),(0,i.b)((({userName:e})=>{if(!e)throw new Error("No active user available");return this.serverApiCredentialsInfra.getDeviceCredentialsForUser(e)})))}constructor(e,t,a,s){this.cqrsClient=e,this.serverApiCredentialsInfra=t,this.managedStorageInfrastructure=a,this.logger=s}}h=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.w?Object:d.w,void 0===m.se?Object:m.se,void 0===l.Rx?Object:l.Rx,void 0===u.V?Object:u.V])],h)},21832:(e,t,a)=>{a.d(t,{oN:()=>s,se:()=>r});class s{constructor(e){this.baseUrl=e.baseUrl,this.appKeys=e.appKeys,this.cloudflareKeys=e.cloudflareKeys}}class r{}new class extends r{getDeviceCredentialsForUser(e){return Promise.resolve({deviceAccessKey:"",deviceSecretKey:"",login:e})}}},41511:(e,t,a)=>{a.d(t,{n:()=>E});var s=a(491),r=a(91743),n=a(86006),i=a(75421),o=a(32446),c=a(53344),d=a(66610),l=a(21832),u=a(35536),p=a(35159),m=a(29811),h=a(16624),g=a(17032),v=a(87279),y=a(82874);class f{async execute(e){const t=await this.store.getState();return await this.store.set({...t,...e.body}),(0,v.Vp)(void 0)}constructor(e){this.store=e}}f=(0,s.__decorate)([(0,y.W)(o.bH),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g.L?Object:g.L])],f);var _=a(87065),b=a(46449);class S{execute(){return this.store.state$.pipe((0,_.U)((e=>(0,v.Vp)(e))))}constructor(e){this.store=e}}S=(0,s.__decorate)([(0,b.e)(o.Lt),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g.L?Object:g.L])],S);var w=a(5206);class E{static configure(e,t){return{module:E,configurations:{serverApi:(0,r.z)(e),serverApiInfrastructure:t}}}}E=(0,s.__decorate)([(0,n.Yl)({api:o.Dm,handlers:{commands:{editSettingsForStaging:f},queries:{settingsForStaging:S},events:{}},providers:[d.B,c.l,p.n,(0,m.F)()],exports:[d.B,c.l,p.n],configurations:{serverApi:{token:l.oN},serverApiInfrastructure:{token:l.se}},stores:[u.t,g.L],imports:[h.D,i.X,w.i],domainName:"framework"})],E)},17032:(e,t,a)=>{a.d(t,{L:()=>c});var s=a(10722),r=a(62149),n=a(63144),i=a(56618);const o={api:{override:!1},nitro:{override:!1}};class c extends((0,n.Q)({storeTypeGuard:e=>!0,storeName:"webServicesSettingsForStaging",storage:{initialValue:o,schemaVersion:1,typeGuard:e=>!0},scope:r.F.Device,persist:!0,isCache:!1,capacity:i.Y._001KB,codec:s.E})){}}}]);