"use strict";(self.webpackChunk_dashlane_amphora=self.webpackChunk_dashlane_amphora||[]).push([[587],{82590:(e,n,t)=>{var o=t(37730),a=t(2806),r=t(4350),i=t(25601),s=t(92386),c=t(10592),l=t(33156),u=t(96754),g=t(69259);function d(e){if(!(e.buildType&&"string"==typeof e.buildType&&Object.values(g.P).map((e=>e.toString())).includes(e.buildType)))throw new Error("Build type from runtime-config.json is invalid");return g.P[e.buildType]}const m=async()=>{const{buildType:e}=await(async()=>{try{const e=(0,u.A)("runtime-config.json");if(!e)throw new Error("Could not build path to runtime-config.json");const n=await fetch(e);return{buildType:d(await n.json())}}catch(e){return console.error("[background/amphora] Unable to read buildType from runtime-config.json",e),{buildType:g.P.PRODUCTION}}})();return e};const p={appAccess:"C4F8H4SEAMXNBQVSASVBWDDZNCVTESMY",appSecret:"Na9Dz3WcmjMZ5pdYU1AmC5TdYkeWAOzvOK6PkbU4QjfjPQTSaXY8pjPwrvHfVH14"};const h={styxAccess:"DASHQ7DNHYSPYSG6JSF6",styxSecret:"LNS273zaVvwNM+VKOjotBYygJyPaM0CXshpdf0j7"},f={...p,...h,...null!=void 0?undefined:{}},y={LOG_LEVEL:4,CODE_NAME:"amphora",MANIFEST_VERSION:(0,l.W)().manifest_version,...(()=>{const e={[i.DashlaneAPISchemesNames.DASHLANE_API_HOST_WITH_SCHEME]:"https://api.dashlane.com",[i.DashlaneAPISchemesNames.DASHLANE_WS_HOST_WITH_SCHEME]:""};return Object.fromEntries(Object.entries(e).filter((([,e])=>e)))})()};async function b({apiConnector:e,debugConnector:n,infrastructureConnectors:t,legacyExtensionConnector:o,legacyWebappConnector:a,legacyMaverickConnector:u,publicPath:g,storageLayer:d,sessionStorage:p,app:h}){console.log("[background/amphora] Carbon initialization started");const b=await async function(){var e;const n=await m();return{platformName:"server_standalone",appVersion:(0,l.W)().version,versionName:(0,l.W)().version_name,browser:s.getBrowserName(),browserVersion:s.getBrowserVersion(),country:s.getBrowserCountry(),os:null!=(e=c.getOSName())?e:"",osCountry:s.getBrowserCountry(),osVersion:c.getOSVersion(),lang:s.getBrowserLanguage(),manifestVersion:(0,l.W)().manifest_version,buildType:n}}(),v=await(0,i.init)({connectors:{api:e,debug:n,extension:o,leeloo:a,maverick:u},infrastructure:{connectors:t},platformInfo:b,publicPath:g,storageLayer:d,sessionStorage:p,keys:f,config:y,settings:{sync:{syncWithLocalClients:!0},userABTestNames:["ace_password_health_labels",r.v]},createClients:h.createClient});return console.log("[background/amphora] Carbon initialization done"),v}var v=t(6523),w=t(52913),k=t(6721),C=t(22828),E=t(27880),S=t(4710),_=t(65124);const A=" | ",L=" - ";function R(e,n){return"object"==typeof e?JSON.stringify(e,null,n):String(e)}let x=function(e){return e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR",e[e.SILENT=10]="SILENT",e}({});const{DEBUG:B,ERROR:I,INFO:T,VERBOSE:P,WARNING:N}=x;function O(e,n){const t=Object.keys(e);return R(t.filter((n=>!(e[n]instanceof Error))).reduce(((n,t)=>(n[t]=e[t],n)),{}),n?2:0)}function $(e){return n=>{const{details:t={},message:o="",tags:a=[],indentDetails:r=!1}=n,i=function(e){const n=e.join("/");return n?`[${n}]`:""}(a),s=O(t,r);let c=function(e){return e.filter((e=>!!e)).join(L)}([i,o]);if("{}"!==s){c+=`${r?"\n":L}${s}`}const l=function(e){return e.error instanceof Error?e.error:null}(t);e(...l?[c,"\n",l]:[c])}}function W(e){if(4>B)return;$(console.debug)(e)}function j(e){if(4>I)return;$(console.error)(e)}function U(e){if(4>T)return;$(console.info)(e)}function F(e){if(4>N)return;$(console.warn)(e)}var D=t(23385),M=t(30504),z=t(8768),V=t(25944),H=t(11910),G=t(72683),K=t(86055),Y=t(42986);function X(e){return(0,M.createEventBus)({events:z.X,channels:e})}function q(e){return(0,M.createEventBus)({events:H.z,channels:e})}function J(e,n){return(0,M.createEventBus)({events:G.N,channels:e,ignoredEvents:n})}function Z(e){return(0,M.createEventBus)({events:K.I,channels:e})}function Q(e){return(0,M.createEventBus)({events:Y.D,channels:e})}const ee=3e4;const ne=5e3,{PopupCarbon:te,PopupCarbonLoader:oe,OptionsCarbon:ae,WebappCarbon:re}=D.PortNames;function ie(){console.log(`[background/amphora] Initializing communication connectors ${ne}`);const e=new D.sh(oe,ne);e.listen();const n=new D.sh(te,ne);n.listen();const t=new D.sh(ae,ne);t.listen();const o=new D.Yg(re,ne);o.listen();const a=new D.y$,r=new D.y$(ee),s=new D.y$,c=new D.y$,l=Z([a]),{carbonToExtensionLegacyConnector:u,extensionToCarbonLegacyConnector:g}=function(e){const n=new D.y$,t=new D.y$;return(0,D.PN)(n,t),{carbonToExtensionLegacyConnector:q([...e,n]),extensionToCarbonLegacyConnector:q([t])}}([e,n]),d=new D.y$(ee),m=new D.y$(ee);(0,D.PN)(d,m);const p=J([o,d]),h=J([m],i.LEGACY_LEELOO_SLOTS_TO_IGNORE),f=X([e,n,t,o,a,r,s,c]),y=(0,M.createEventBus)({events:V.o}),b={deviceLimit:Q([o])};const{autofillEngineCarbonConnector:v,autofillEngineLegacyCarbonConnector:w}=function(e){const n=new D.y$;return(0,D.PN)(e,n),{autofillEngineCarbonConnector:X([n]),autofillEngineLegacyCarbonConnector:Z([n])}}(a),k=function(e){const n=new D.y$;return(0,D.PN)(e,n),X([n])}(c),C=function(e){const n=new D.y$(ee);return(0,D.PN)(e,n),X([n])}(r);return{applicationModulesToCarbonApiConnector:C,autofillEngineCarbonConnector:v,autofillEngineLegacyCarbonConnector:w,carbonApiConnector:f,carbonDebugConnector:y,carbonInfrastructureConnectors:b,carbonLegacyMaverickConnector:l,carbonLegacyWebappConnector:p,carbonToExtensionLegacyConnector:u,extensionToCarbonApiConnector:function(e){const n=new D.y$;return(0,D.PN)(e,n),X([n])}(s),extensionToCarbonLegacyConnector:g,tiresiasBackgroundToCarbonConnector:k,carbonLegacyWebappConnectorForGraphene:h}}var se=t(57205);function ce(e){se.Y.addListener(e)}const le=1e4;function ue(e,n){return new Promise(((t,o)=>setTimeout((()=>o(n)),e)))}const ge=["amphora","initBackground"],de=(e,n)=>{n(),U({message:`Executing task "${e}"`,tags:ge})};function me(e){return{withAppClientReady(n){e.appClient.then((t=>{n.forEach((({name:n,fn:o})=>{(function(e,n,t){return Promise.race([e,ue(n,t)])})(Promise.resolve().then((()=>de(n,(()=>{o({appClient:t,connectors:e.connectors})})))),le,(()=>new Error(`Initialization Task ${n} timed out (${le}ms)`))).then((()=>{U({message:`${n} completed`,tags:["amphora","initBackground","runTasksAfterAppClientReady"]})})).catch((e=>{throw j({message:`Initialization Task ${n} failed`,details:{error:e},tags:["amphora","initBackground","runTasksAfterAppClientReady"]}),e}))}))}))},withAppClientPromise(n){n.forEach((n=>{try{de(n.name,(()=>n.fn(e)))}catch(e){throw j({message:`Error while running task; "${n.name}"`,details:{error:e},tags:ge}),e}}))}}}t(42403),t(98849),t(78895),t(45595),t(25676);const pe="assets/argon2/argon2.min.js",he="assets/argon2/argon2.wasm";function fe(){try{self.loadArgon2WasmBinary=async()=>{const e=await fetch(he),n=await e.arrayBuffer();return new Uint8Array(n)}}catch(e){throw j({details:{error:e},message:"Failed to assign to self.loadArgon2WasmBinary",tags:["amphora","initBackground","initArgon"]}),e}}function ye(){try{self.loadArgon2WasmModule=()=>(importScripts(pe),Promise.resolve()),self.loadArgon2WasmBinary=async()=>{const e=await fetch(he),n=await e.arrayBuffer();return new Uint8Array(n)},importScripts(pe)}catch(e){throw j({details:{error:e},message:"Error when importing ARGON2_JS_WRAPPER_FOR_WASM script",tags:["amphora","initBackground","initArgonForServiceWorker"]}),e}}var be=t(87163),ve=t(15348);function we({connectors:{extensionToCarbonApiConnector:e,extensionToCarbonLegacyConnector:n}}){e.liveWebOnboardingMode.on((e=>{!async function(e,n){const t=n.flowLoginCredentialOnWebSite;t&&(await(0,ve.$)(t.domain),await(0,be.U)({url:t.url}),await e.updateWebOnboardingMode({flowLoginCredentialOnWebSite:null}))}(n,e)}))}var ke=t(59922);const Ce="https://www.dashlane.com",Ee="/signup";async function Se({connectors:{extensionToCarbonApiConnector:e}}){try{const n=new URL(`${Ce}/feedback`),t=await e.getPlatformName();n.searchParams.append("platform",t);const o=await e.getAnonymousComputerId();n.searchParams.append("aci",o),(0,ke.S)(n.toString())}catch(e){F({details:{error:e},message:"Error on display of survey after extension removal",tags:["amphora","initBackground","surveyOnUninstall"]})}}var _e=t(81017),Ae=t(45368);const Le="silent_deploy";async function Re(){try{const e=await(0,Ae.U)();if("object"==typeof e&&null!==e&&Le in e&&!0===e[Le])return void U({message:"Silent Deploy is set, the webapp will not be launched",tags:["amphora","initBackground","open"]})}catch{}(0,_e.b)({route:Ee})}var xe=t(37724),Be=t(50756);let Ie=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR",e}({});const{ERROR:Te}=Ie;function Pe({column:e,line:n,name:t}){return e||n||t?`${t}:${n}:${e}`:""}function Ne(e){try{const n=function(e){return"object"==typeof e&&Boolean(e)}(e);if(!n)return{code:Te,fileName:"make.ts",funcName:"makeException",legacy:!1,message:"Potential error is not object"};const{columnNumber:t,fileName:o,funcName:a,level:r,lineNumber:i,message:s,stack:c}=e,l=Pe({column:t,line:i,name:o});return{code:null!=r?r:Te,fileName:l,funcName:null!=a?a:"",legacy:!1,line:i,message:null!=s?s:"",precisions:c}}catch(e){return{code:Te,fileName:"make.ts",funcName:"makeException",legacy:!1,message:"Caught exception inception"}}}let Oe=null;async function $e(){const e=await(0,xe.g)({domain:"dashlane.com",name:"userFunnelCookie"}).catch((e=>(j({details:{error:e},message:"Error while getting dashlane cookies",tags:["amphora","initBackground","logFirstLaunch","getDashlaneCookie"]}),[])));if(e[0]){const t=decodeURIComponent(e[0].value);try{return JSON.parse(t)}catch(e){const{WARNING:t}=Ie,o={message:"Error parsing userFunnelCookie"},a=Ne({...function(e){return"object"==typeof e&&null!==e&&"message"in e}(e)?e:o,level:t});n=a,Oe?Oe(n):console.error("Send exception log function not set"),F({details:{error:e},message:"Error parsing userFunnelCookie",tags:["amphora","initBackground"]})}}var n;return{}}function We(e){return""!==e?e:void 0}async function je({connectors:{extensionToCarbonApiConnector:e}}){const n=await $e(),t=0===Object.keys(n).length?{has_cookie:!1}:{has_cookie:!0,heap_identity:n.trackingId,gclid:n.gclid,everflow_transaction_id:n.transaction_id,utm_pathname:n.pathname,utm_referrer:We(n.referrer),utm_source:We(n.utm_source),utm_campaign:We(n.utm_campaign),utm_medium:We(n.utm_medium),utm_content:We(n.utm_content),utm_term:We(n.utm_term),utm_visit_timestamp:n.utm_visitTimestamp,utm_last_click_pathname:n.last_click_pathname,utm_last_click_referrer:We(n.last_click_referrer),utm_last_click_source:We(n.last_click_source),utm_last_click_campaign:We(n.last_click_campaign),utm_last_click_medium:We(n.last_click_medium),utm_last_click_content:We(n.last_click_content),utm_last_click_term:We(n.last_click_term),utm_last_click_visit_timestamp:n.last_click_visitTimestamp};e.logEvent({event:new Be.UserFirstLaunchEvent({web:t})})}var Ue=t(74159);function Fe({connectors:{carbonToExtensionLegacyConnector:e}}){e.reloadExtension.on((async e=>{try{e||(0,Ue.H)()}catch(e){throw j({message:"Error while reloading extension",details:{error:e},tags:["amphora","initBackground","reloadOnLogout"]}),e}}))}var De=t(26662),Me=t(41842),ze=t(87065),Ve=t(6136),He=t(43978),Ge=t(87279);async function Ke(e){try{await(0,De.F)({isUserAuthenticated:e})}catch(e){j({message:"Failed to update toolbar action icon",details:{error:e}})}}function Ye({appClient:e}){e.session.queries.selectedOpenedSession().pipe((0,Me.h)(Ge.d6),(0,ze.U)((e=>!!e.data)),(0,Ve.x)(),(0,He.w)(Ke)).subscribe()}var Xe=t(14501),qe=t(24028);const Je="#FFB81C";async function Ze(){try{const e=function(e){return"BETA"===e?{text:"BETA",color:Je}:null}(await m());e&&((0,Xe.d)({text:e.text}),(0,qe._)({color:e.color}))}catch(e){F({details:{error:e},message:"Error on initialization of icon toolbar icon badge",tags:["amphora","initBackground","initToolbarIconBadge"]})}}var Qe=t(64987),en=t(69235),nn=t(98402);t(61238);const tn=1;const on="^https?://w*\\.?app\\.dashlane\\.com(\\??[^/#]*)[^#]*#?/?(.*)$",an="^https?://w*\\.?console\\.dashlane\\.com(\\??[^/#]*)[^#]*#?/?(.*)$",rn="^https://sso.nitro(staging)?.dashlane.com/saml/callback$";const sn="https?://w*\\.?[a-z]+\\.dashlane\\.com.+noredirect.*$",cn="https?:w*\\.?[a-z]+\\.dashlane\\.com/cdn-cgi/access/authorized.*$";function ln(e,n){const t=(0,u.A)(""),o=new URL(t).hostname;const a=function(e){return new URL(e).protocol}(t),r=function(e,n,t){return[{priority:t,action:{type:"redirect",redirect:{regexSubstitution:`${n}//${e}/index.html\\1#/\\2`}},condition:{regexFilter:on,resourceTypes:["main_frame"]}},{priority:t,action:{type:"redirect",redirect:{regexSubstitution:`${n}//${e}/index.html\\1#/console/\\2`}},condition:{regexFilter:an,resourceTypes:["main_frame"]}},{priority:t+1,action:{type:"redirect",redirect:{regexSubstitution:`${n}//${e}/loading.html`}},condition:{regexFilter:rn,resourceTypes:["main_frame","sub_frame"]}}]}(o,a,n),i=[{priority:s=n+1,action:{type:"allowAllRequests"},condition:{regexFilter:cn,resourceTypes:["main_frame"]}},{priority:s,action:{type:"allowAllRequests"},condition:{regexFilter:sn,resourceTypes:["main_frame"]}}];var s;const c=function(e,n,t,o){return e.map((e=>{const a=e.replace(/[.]/g,"\\$&");return{priority:o,action:{type:"redirect",redirect:{regexSubstitution:`${t}//${n}/index.html?token=${r=e,btoa(encodeURIComponent(r))}#/anti-phishing`}},condition:{regexFilter:`^https?://.*${a}.*$`,resourceTypes:["main_frame"]}};var r}))}(e,o,a,n+2);return[...r,...i,...c].map(((e,n)=>({id:n+tn,...e})))}const un=new Qe.WU;async function gn(e){await un.runExclusive((async()=>{const n=await async function(){return(await(0,en.z)()).map((e=>e.id))}(),t=ln(e,1);(0,nn.O)({removeRuleIds:n,addRules:t})}))}var dn=t(21597),mn=t(61856),pn=t(97379);function hn(e){const{hostname:n,hash:t,search:o}=new URL(e),a=n.includes("console.dashlane.com")?`index.html${o}#/console${t.replace("#","/").replace("//","/")}`:`index.html${o}${t.replace("#","#/").replace("//","/")}`;return(0,u.A)(a)}const fn=new RegExp("(console|app).dashlane.com/cdn-cgi/access/authorized"),yn=["https://app.dashlane.com/*","https://console.dashlane.com/*"],bn=["https://sso.nitro.dashlane.com/saml/callback","https://sso.nitrostaging.dashlane.com/saml/callback"],vn="main_frame";function wn(e){const{url:n,tabId:t}=e,o=n.includes("/sso");return function(e){return e.includes("noredirect")||Boolean(e.match(fn))}(n)||(0,dn.V)(t,{active:!o,url:hn(n)}),{}}function kn(e){const{tabId:n}=e;return(0,dn.V)(n,{active:!0,url:(0,u.A)("loading.html")}),{cancel:!0}}const Cn=()=>{yn.forEach((e=>{mn.a.addListener(wn,{urls:[e],types:[vn]},[pn.X.Blocking])})),mn.a.addListener(kn,{urls:bn,types:[vn,"sub_frame"]},[pn.X.Blocking])};var En=t(13134);function Sn(e,n){return`${e}?token=${t=new En.Y(n).getRootDomain(),btoa(encodeURIComponent(t))}#/anti-phishing`;var t}function _n(e){const{tabId:n,url:t}=e;if(!n)return{};const o=hn((0,u.A)(""));return(0,dn.V)(e.tabId,{url:Sn(o,t)}),{}}function An(e){e.livePhishingURLList.on((e=>{U({message:"Execute on carbon event antiPhishing change from carbon endpoint: livePhishingURLList",tags:["amphora","initBackground","initAntiphishingRedirectionFallback"]}),function(e){if(!e.size)return;const n=Array.from(e).reduce(((e,n)=>{const t=["https","http"].map((e=>`${e}://*.${n}/*`));return e.push(...t),e}),[]);mn.a.hasListener(_n)&&mn.a.removeListener(_n),mn.a.addListener(_n,{urls:n,types:["main_frame"]})}(e)}))}var Ln=t(44566);class Rn{constructor(){this.state=new Map}getState(e){const n=this.state.get(e);return n?Promise.resolve(n):Promise.resolve({})}setState(e,n){return 0===Object.keys(n).length?this.state.delete(e):this.state.set(e,n),Promise.resolve()}}class xn{async getState(e){const n=await(0,E.U)(e);return n[e]?n[e]:{}}async setState(e,n){0===Object.keys(n).length?await(0,C.O)(e):await(0,S.t)({[e]:n})}}function Bn({connectors:{autofillEngineCarbonConnector:e,autofillEngineLegacyCarbonConnector:n},appClient:t}){const a=(0,o.G)()?new xn:new Rn,r=(new Ln.WebExtensionApiManager).getBrowserApi();(0,Ln.startAutofillEngine)(r,{carbon:e,legacyCarbon:n,grapheneClientPromise:t},a,((e,n)=>{W({message:e,details:n,indentDetails:!0,tags:["AutofillEngine"]})})),(0,Ln.startDispatcher)(r)}var In=t(21715);function Tn(e,n){W({message:e,details:n,indentDetails:!0,tags:["Tiresias"]})}let Pn=null;function Nn({connectors:{tiresiasBackgroundToCarbonConnector:e},appClient:n}){U({message:"Creation of Tiresias background process",tags:["amphora","initBackground","initTiresias"]}),Pn=new In.w({messageLogger:Tn,carbonConnectorApi:e,grapheneClient:n})}var On=t(3204),$n=t(90904),Wn=t(75799),jn=t(23573),Un=t(28365),Fn=t(53061),Dn=t(65702),Mn=t(58813),zn=t(13436),Vn=t(72600),Hn=t(14186),Gn=t(94587),Kn=t(27357),Yn=t(89434),Xn=t(94006),qn=t(91743),Jn=t(38566),Zn=t(35273),Qn=t(15160),et=t(48302),nt=t(49699),tt=t(42631),ot=t(75421),at=t(35171),rt=t(23047),it=t(12111),st=t(41511),ct=t(5206),lt=t(93218),ut=t(10842),gt=t(48058),dt=t(76053),mt=t(15792),pt=t(39976),ht=t(86999),ft=t(16624),yt=t(66481),bt=t(53415),vt=t(19961),wt=t(99081),kt=t(63481),Ct=t(99813),Et=t(79925),St=t(12444),_t=t(2075),At=t(3460),Lt=t(66917),Rt=t(8434),xt=t(79274),Bt=t(67052),It=t(33612),Tt=t(40532),Pt=t(83074),Nt=t(64391),Ot=t(86381),$t=t(39560),Wt=t(76254),jt=t(80954),Ut=t(48264),Ft=t(64396),Dt=t(420),Mt=t(26857),zt=t(39911),Vt=t(43838),Ht=t(39387),Gt=t(396),Kt=t(57487),Yt=t(852),Xt=t(98902),qt=t(81155),Jt=t(17236),Zt=t(78896),Qt=t(74643),eo=t(61573),no=t(72481),to=t(41892),oo=t(24981),ao=t(53195),ro=t(98419),io=t(76561),so=t(3786),co=t(99600),lo=t(51442),uo=t(16930),go=t(38487),mo=t(13460),po=t(17556),ho=t(75644),fo=t(76347),yo=t(32611),bo=t(39331),vo=t(53183),wo=t(67206),ko=t(50618),Co=t(93381),Eo=t(74898),So=t(15090),_o=t(3659),Ao=t(38586),Lo=t(62076),Ro=t(36355),xo=t(36753),Bo=t(77153),Io=t(73820),To=t(78857),Po=t(64222),No=t(36093),Oo=t(76403),$o=t(41613),Wo=t(58158),jo=t(44272),Uo=t(58172),Fo=t(92122),Do=t(95324),Mo=t(69840),zo=t(76067),Vo=t(80699),Ho=t(32127),Go=t(20922),Ko=t(56680),Yo=t(19813),Xo=t(78840),qo=t(55743),Jo=t(88427),Zo=t(58428),Qo=t(29406),ea=t(36610),na=t(57882);function ta(e){const n=Pe({column:e.colno,line:e.lineno,name:e.filename});return{error:e.error,fileLocation:n,origin:"uncaughtException"}}function oa(e){return{error:e.reason,origin:"unhandledPromiseRejection"}}function aa(e){return!(e.reason instanceof TypeError&&"Failed to fetch"===e.reason.message&&e.reason.stack?.includes("assets/argon2/argon2.min.js"))}function ra(e){e.preventDefault()}class ia extends na.fW{constructor(e){const n=(0,Qo.T)(function(e){let n;return new ea.j({addListener:t=>{n=n=>(ra(n),t(n,e)),e.addEventListener("error",n)},removeListener:()=>{e.removeEventListener("error",n)}},(e=>!0)).events$.pipe((0,ze.U)((([e])=>e)),(0,ze.U)(ta))}(e),function(e){let n;return new ea.j({addListener:t=>{n=n=>(ra(n),t(n,e)),e.addEventListener("unhandledrejection",n)},removeListener:()=>{e.removeEventListener("unhandledrejection",n)}},(e=>!0)).events$.pipe((0,ze.U)((([e])=>e)),(0,Me.h)(aa),(0,ze.U)(oa))}(e));super(n)}}const sa=new ia(self),ca=new At.y,la=new Lt.P("graphene-background-port"),ua={accessKey:"",secretKey:""},ga=((0,Lo.x)("prod"),"prod"),da=void 0,ma=(0,Zt.w)();var pa=t(71751),ha=t(6045);const fa=["/content/injectedts/vendors.js","/content/contentScripts/kwift.CHROME.js"],ya="options.useInjectScriptOnStart";function ba(){!async function(){try{(await(0,v.U)(ya))[ya]&&(await(0,pa.I)({url:["http://*/*","https://*/*"]})).forEach((({id:e})=>{e&&(0,ha.k)({target:{tabId:e,allFrames:!0},files:fa})}))}catch(e){throw j({message:"Failed to inject script on existing tabs",details:{error:e},tags:["amphora","initBackground","getTabsAndInjectScript"]}),e}}()}const va="carbonDebugConnector";function wa({date:e,message:n,optionalParams:t}){const o="string"==typeof n?n:"Invalid message type",a=t.map(R).join(A);return(a?[e,o,a]:[e,o]).join(L)}const ka={error:j,info:U,log:function(e){if(4>P)return;$(console.log)(e)},warning:F};var Ca=t(9980);"pbenjapkjdkdlfdjjokeendimjkgjgjb"===chrome.runtime.id||chrome.runtime.id;async function Ea(e){const n=new i.CarbonStorage({itemExists:async e=>await(0,_.j)(e),readItem:async e=>{const n=(await(0,v.U)(e))[e];return function(e){return"string"==typeof e||null===e}(n)?n:null},removeItem:async e=>{await(0,w.O)(e)},writeItem:async(e,n)=>{const t={[e]:n};await(0,k.t)(t)}}),t=(0,o.G)()?{removeItem:async e=>await(0,C.O)(e),getItem:async e=>(await(0,E.U)(e))[e],setItem:async(e,n)=>{const t={[e]:n};await(0,S.t)(t).catch((n=>{throw new Error(`carbon storing ${e}: ${n.message}`)}))}}:void 0,{app:a,signalCarbonReady:r,signalCarbonInitFailed:s}=await async function(){console.log("[background/amphora] Starting application modules");const e=new i.CarbonLegacyInfrastructure,n=(0,Rt.Y)();return{app:await(0,Xn.u)({appDefinition:On.R,channels:{},channelsListener:la,currentNode:"background",exceptionLogging:{sink:(0,qn.$)(at.u),uncaughtErrorSource:(0,qn.z)(sa)},implementations:{accountCreation:kt.Z,deleteOrResetAccount:Ct.T,subscriptionCode:Et.q,accountReferral:St.o,analytics:rt.I,taskTracking:Jn.c,featureFlips:it.k,"carbon-legacy":{module:i.CarbonLegacyModule,configurations:{infrastructure:(0,qn.z)(e)}},permissions:Ao.B,passwordHealth:Qt.C,authenticationFlow:{module:io.c,configurations:{authenticationFlowContextInfrastructure:(0,qn.z)(new po.e)}},deviceTransfer:so.I,activityLogs:Co.Z,accountManagement:_t.c,loggedOutMonitoring:Eo.a,identityVerificationFlow:co.f,autofillSettings:ho.P,autofillData:fo.U,autofillTracking:yo.V,autofillSecurity:bo.k,autofillNotifications:vo.r,linkedWebsites:wo.J,teamEnclave:Io.Z,confidentialSSOApi:{module:Ro.D,configurations:{enclaveLoginContextInfrastructure:(0,qn.z)(new To.X)}},scim:xo.i,nudges:_o._,session:{module:Wn._,configurations:{session:(0,qn.$)(jn.h)}},sync:$n.R,vaultReport:eo.E,vaultItemsCrud:zn.z,vaultSearch:Vn.U,vaultNotifications:Hn.K,vaultOrganization:Gn.H,secureFiles:Kn.E,passwordLimit:Yn.a,pinCode:lo.N,otp:no.f,masterPasswordSecurity:Ko.f,emailMonitoring:to.S,breaches:oo.t,sharingCollections:Po.a,sharingItems:No.F,sharingInvites:Oo.p,sharingRecipients:$o.u,sharingSync:Wo.P,antiphishing:ao.v,overrides:ko.x,accountRecoveryKey:ro.D,teamMembers:jo.X,teamVat:Uo.K,teamPlanDetails:Fo.H,teamPlanUpdate:Do.c,inviteLink:Mo._,teamAdminNotifications:zo.E,notifications:Ho.F,changeMasterPassword:Un.M,teamPasswordHealth:Vo.V,userConsents:Xo.K,vaultAccess:Fn.r,vpnNotifications:Yo.u,userVerification:uo.Z,getStarted:qo.$,profileAdmin:Jo.y,deviceRegistration:go._,b2cPlansApi:Zo.X,webServices:st.n.configure({baseUrl:"https://api.dashlane.com",appKeys:{appAccessKey:p.appAccess,appSecretKey:p.appSecret},...da?{cloudflareKeys:{cloudflareAccessKey:da.cloudflareAccess,cloudflareSecretKey:da.cloudflareSecret}}:{}},(0,qn.$)(Dn.w)),platformInfo:ct.i,authentication:mo.R,siem:So.g,deviceManagement:Go.B,diagnostics:{module:Zn.y,configurations:{externalDiagnosticsLogsSources:(0,qn.z)(new Qn.U([]))}},icons:lt.p,"file-download":{module:et.l,configurations:{fileDownloadEmitterChannel:(0,qn.z)((new xt.m).makeFileDownloadEmitterChannel())}},"file-upload":{module:nt.O,configurations:{fileUploadListener:n?(0,qn.$)(Bt.w.initializeListener()):(0,qn.$)(It.b)}},killSwitch:ut.B},otherModules:[...n?[tt.f.configure((0,qn.$)(Tt.D))]:[],gt.F.configure({}),ot.X.configure((0,qn.z)(new Pt.A)),dt.Q.configure((0,qn.$)(mt.U),(0,qn.$)(pt.P),(0,qn.$)(ht.c)),ft.D.configure((0,qn.z)(new yt.i({computeHash:Nt.x,decryptAes256:Ot.$,decryptRsaOaep:$t.G,deriveKeyArgon2d:Wt.f,deriveKeyPbkdf2:jt.x,encryptAes256:Ut.P,encryptRsaOaep:Ft.b,generateKeyAes256:Dt.o,generateKeyPairRsaOaep:Mt.Y,getRandomValues:zt.P,signHmacSha:Vt.n,signRsassaPkcs1:Ht.f,unsafeComputeMd5Hash:Gt.H,verifyHmacSha:Kt.o,verifyRsassaPkcs1:Yt.e}))),Bo.y.configure({appAccessKey:p.appAccess,appSecretKey:p.appSecret},ua,ga),vt.G.configure((0,qn.z)(new wt.N6(ua,"https://sso.nitro.dashlane.com/",ga)))],storeInfrastructureFactory:ma,jsonFetcher:new Xt.W,cronSource:ca,keyValueStorageInfrastructure:new qt.e,managedStorageInfrastructure:new Jt.e,defaultDeviceStorageEncryptionCodec:(0,qn.$)(bt.n),defaultUserStorageEncryptionCodec:(0,qn.$)(Mn.Y)}),signalCarbonReady:(n,t,o)=>{e.ready({apiEvents:t,leelooEvents:o,leelooEventsCommands:o,coreServices:n})},signalCarbonInitFailed:n=>{e.initFailed(n)}}}(),{applicationModulesToCarbonApiConnector:c,carbonApiConnector:l,carbonDebugConnector:u,carbonLegacyWebappConnectorForGraphene:g,carbonInfrastructureConnectors:d,carbonToExtensionLegacyConnector:m,carbonLegacyWebappConnector:h,carbonLegacyMaverickConnector:f}=e;try{r(await b({apiConnector:l,debugConnector:u,infrastructureConnectors:d,legacyExtensionConnector:m,legacyWebappConnector:h,legacyMaverickConnector:f,publicPath:"./",storageLayer:n,sessionStorage:t,app:a}),c,g)}catch(e){s(e)}return a}!function(){try{console.log("[background/amphora] Starting background initialization"),function(){try{addEventListener("install",(()=>{console.log("[background/amphora] Extension ServiceWorker installing")})),addEventListener("activate",(()=>{console.log("[background/amphora] Extension ServiceWorker activated")})),chrome.runtime.onStartup?.addListener((()=>{console.log("[background/amphora] Browser profile startup")})),chrome.runtime.onSuspend?.addListener((()=>{console.log("[background/amphora] Extension event page suspend event")})),chrome.runtime.onSuspendCanceled?.addListener((()=>{console.log("[background/amphora] Extension event page suspend cancelled")})),chrome.runtime.onUpdateAvailable?.addListener((()=>{console.log("[background/amphora] Extension update available")})),chrome.runtime.onRestartRequired?.addListener((()=>{console.log("[background/amphora] Browser update available")})),chrome.runtime.onBrowserUpdateAvailable?.addListener((()=>{console.log("[background/amphora] Browser update available")})),chrome.runtime.onRestartRequired?.addListener((e=>{console.log("[background/amphora] Restart required by browser",{reason:e})})),chrome.extension?.isIncognitoContext&&console.log("[background/amphora] Is in incognito context"),chrome.idle?.onStateChanged?.addListener((e=>{console.log("[background/amphora] Idle state changed",{state:e})})),chrome.runtime.onPerformanceWarning?.addListener((e=>{const{category:n,severity:t,tabId:o,description:a}=e;console.log("[background/amphora] Performance warning emitted for the extension",{category:n,severity:t,tabId:o,description:a})})),chrome.runtime.onInstalled?.addListener((e=>{const{reason:n}=e;if("install"===n)console.log("[background/amphora] Extension got installed");else if("update"===n){const{previousVersion:n}=e;console.log("[background/amphora] Extension got updated",{previousVersion:n})}else if("chrome_update"===n)console.log("[background/amphora] Chrome got updated");else if("browser_update"===n)console.log("[background/amphora] Browser got updated");else if("shared_module_update"===n){const{id:n}=e;console.log("[background/amphora] A shared module got updated",{sharedModuleId:n})}e.temporary&&console.log("[background/amphora] Extension is installed temporarily")}))}catch(e){console.error("[background/amphora] Failed setting up extension lifecycle event logs",e)}}();const t=ie();U({message:"Starting Carbon & Application Modules ...",tags:["amphora","initBackground","startCarbonAndModules"]});const o=Ea(t).then((e=>e.createClient())).catch((e=>(j({message:"Promise appClientPromise rejected",details:{error:e},tags:["amphora","initBackground","startCarbonAndModules"]}),Promise.reject(e))));U({message:"Running initialization tasks ...",tags:["amphora","initBackground","makeRunTasksAfterAppClientReady"]});const r=me({appClient:o,connectors:t});U({message:"Running redirection initialization tasks ...",tags:["amphora","initBackground","redirectionTasks"]});(0,a.G)()?(n=t.extensionToCarbonApiConnector,gn([]),n.livePhishingURLList.on((e=>{U({message:"Execute on carbon event antiPhishing change from carbon endpoint: livePhishingURLList",tags:["amphora","initBackground","initRedirection"]}),gn(Array.from(e))}))):(Cn(),An(t.extensionToCarbonApiConnector)),(()=>{var e;U({message:"Initializing CarbonDebugConnector Debug Logger ...",tags:["amphora","initBackground","onExtensionStart","initDebugLogger"]}),e=t.carbonDebugConnector,Object.keys(ka).forEach((n=>{e[n].on((e=>{if(!function(e){return["error","info","log","warning"].some((n=>n===e))}(n))throw new Error("Invalid debug connector event");(0,ka[n])({message:wa(e),tags:[va]})}))})),U({message:"Initilializing argon2 ...",tags:["amphora","initBackground","onExtensionStart","argonInitializationFn"]}),("serviceWorker"in self?ye:fe)(),U({message:'Running "onExtensionStart" init tasks with the app client promise ...',tags:["amphora","initBackground","onExtensionStart","runTasksBeforeAppClientReady"]}),r.withAppClientPromise([{name:"reloadOnLogout",fn:Fe},{name:"initAutofillEngine",fn:Bn}]),U({message:'Running "onExtensionStart" init tasks with the app client ready ...',tags:["amphora","initBackground","onExtensionStart","runTasksAfterAppClientReady"]}),r.withAppClientReady([{name:"initOnboarding",fn:we},{name:"surveyOnUninstall",fn:Se},{name:"initToolbarIcon",fn:Ye},{name:"initToolbarIconBadge",fn:Ze},{name:"initTiresias",fn:Nn}])})(),e=()=>{U({message:'Running "onExtensionFirstInstall" init tasks with the app client ready ...',tags:["amphora","initBackground","onExtensionFirstInstall"]}),r.withAppClientReady([{name:"logWebAppFirstLaunch",fn:je},{name:"openWebAppSignUp",fn:Re}])},ce((n=>{"install"===n.reason&&e(n)})),ce((()=>{U({message:"Disabling browser native autofill ...",tags:["amphora","initBackground","onExtensionInstall"]}),(0,Ca.D)()})),function(e){ce((n=>{"update"===n.reason&&e(n)}))}((()=>{U({message:'Running "onExtensionUpdate" init tasks with the app client ready ...',tags:["amphora","initBackground","onExtensionUpdate"]}),r.withAppClientReady([{name:"injectScriptOnExistingTabs",fn:ba}])})),chrome.runtime.onStartup.addListener((()=>{U({message:"chrome.runtime.onStartup event",tags:["amphora","initBackground"]})}));if("serviceWorker"in self&&self instanceof ServiceWorkerGlobalScope&&!0){U({message:"Attaching Chrome MV3 Service Worker event handlers ...",tags:["amphora","initBackground","chrome-mv3-service-worker"]});const e=self.skipWaiting,n=self.clients;self.oninstall=()=>{U({message:"self.oninstall event",tags:["amphora","initBackground","chrome-mv3-service-worker","self.oninstall"]}),e().then((()=>{U({message:"Promise skipWaiting() resolved",tags:["amphora","initBackground","chrome-mv3-service-worker","self.oninstall","skipWaiting"]})})).catch((e=>{throw j({message:"Promise skipWaiting() rejected",details:{error:e},tags:["amphora","initBackground","chrome-mv3-service-worker","self.oninstall","skipWaiting"]}),e}))},self.addEventListener("activate",(e=>{U({message:"'activate' event triggered",tags:["amphora","initBackground","chrome-mv3-service-worker","self.addEventListener('activate')"]}),e.waitUntil(new Promise((e=>{U({message:"ExtendableEvent.waitUntil() pending",tags:["amphora","initBackground","chrome-mv3-service-worker","self.addEventListener('activate')","event.waitUntil"]}),n.claim().then((()=>{U({message:"Promise clients.claim() resolved",tags:["amphora","initBackground","chrome-mv3-service-worker","self.addEventListener('activate')","clients.claim()"]})})).catch((e=>{throw j({message:"Promise clients.claim() rejected",details:{error:e},tags:["amphora","initBackground","chrome-mv3-service-worker","self.addEventListener('activate')","clients.claim()"]}),e})).then(e)})))}))}U({message:"Background initialization initiated.",tags:["amphora","initBackground"]})}catch(e){throw j({message:"Error during the initialization of the background",details:{error:e},tags:["amphora","initBackground"]}),e}var e,n}()}}]);