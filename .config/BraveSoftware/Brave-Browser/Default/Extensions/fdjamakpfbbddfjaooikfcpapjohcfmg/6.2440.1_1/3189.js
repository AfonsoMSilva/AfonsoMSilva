"use strict";(self.webpackChunk_dashlane_leeloo=self.webpackChunk_dashlane_leeloo||[]).push([[3189],{82994:(e,t,i)=>{i.d(t,{s:()=>S}),i(96832);var n=i(78971),s=i(82598),a=i(33354),o=i(91871),r=i(88203);let l=function(e){return e.LastAdmin="LastAdmin",e.GroupSharing="GroupSharing",e.CollectionSharing="CollectionSharing",e.Generic="Generic",e}({});var c=i(65580),d=i(44110);const u=({reason:e,translations:t,goToSharingAccess:i,closeCantDeleteDialog:s})=>{const{translate:a}=(0,r.Z)(),o=((e,t)=>{const{groupSharingTitle:i,lastAdminTitle:n,collectionSharingTitle:s,genericErrorTitle:a}=e;switch(t){case l.LastAdmin:return n;case l.GroupSharing:return i;case l.CollectionSharing:return s;case l.Generic:return a;default:return(0,c.U)(t)}})(t,e),u=((e,t)=>{const{groupSharingSubtitle:i,lastAdminSubtitle:n,collectionSharingSubtitle:s,genericErrorSubtitle:a}=e;switch(t){case l.LastAdmin:return n;case l.GroupSharing:return i;case l.CollectionSharing:return s;case l.Generic:return a;default:return(0,c.U)(t)}})(t,e);return(0,d.tZ)(n.Vq,{isOpen:!0,onClose:s,title:null!=o?o:"",closeActionLabel:a("_common_dialog_dismiss_button"),actions:e===l.LastAdmin||l.GroupSharing||l.CollectionSharing?{primary:{children:t.lastAdminActionLabel,onClick:()=>{i(),s()}}}:void 0,children:u})};var m=i(37527);const h=({closeConfirmDeleteDialog:e,onDeleteConfirm:t,translations:i})=>{const{translate:s}=(0,r.Z)(),{confirmDeleteSubtitle:a,confirmDeleteTitle:o,confirmDeleteDismiss:l,confirmDeleteConfirm:c}=i;return(0,d.tZ)(n.Vq,{title:o,onClose:e,isOpen:!0,dialogClassName:m.Ht,closeActionLabel:s("_common_dialog_dismiss_button"),isDestructive:!0,actions:{primary:{children:c,onClick:t,id:"deletion-dialog-confirm-button"},secondary:{children:l,onClick:e,autoFocus:!0,id:"deletion-dialog-dismiss-button"}},children:a})},S=({closeConfirmDeleteDialog:e,goToSharingAccess:t,isVisible:i,itemId:c,onDeletionSuccess:m,sharingStatus:S,translations:g,vaultItemType:_,isShared:p,isSharedViaUserGroup:b,isItemInCollection:C,isLastAdmin:I})=>{const{showToast:D}=(0,n.pm)(),{translate:A}=(0,r.Z)(),{deleteVaultItems:y}=(0,s.u)(o.L);if(!i)return null;let f;return(p||S?.isShared)&&(b&&(f=l.GroupSharing),I&&(f=l.LastAdmin),C&&(f=l.CollectionSharing)),f&&t?(0,d.tZ)(u,{reason:f,translations:g,goToSharingAccess:t,closeCantDeleteDialog:e}):(0,d.tZ)(h,{closeConfirmDeleteDialog:e,onDeleteConfirm:async()=>{try{var e;(await y({ids:[c],vaultItemType:_})).tag===a.rq.Success?(D({description:null!=(e=g.deleteSuccessToast)?e:A("webapp_personal_info_edition_delete_success_toast")}),m()):D({description:A("_common_generic_error"),mood:"danger",isManualDismiss:!0})}catch(e){D({description:A("_common_generic_error"),mood:"danger",isManualDismiss:!0})}},translations:g})}},64676:(e,t,i)=>{i.r(t),i.d(t,{SecureNotesEdit:()=>x});var n=i(96832),s=i(15192),a=i(99852),o=i(33354),r=i(91871),l=i(39431),c=i(92077),d=i(26356),u=i(95445),m=i(92018),h=i(13252),S=i(82598),g=i(50756),_=i(14900),p=i(87279),b=i(5465),C=i(88203),I=i(45272),D=i(6697),A=i(86498),y=i(63520),f=i(82994),T=i(86541),w=i(32870),v=i(64098),L=i(99822),N=i(30894),E=i(73157),Z=i(99193),U=i(20684),F=i(79808),G=i(1639),O=i(85163),V=i(95727),q=i(39035),P=i(44110);const{CONTENT:k,DOCUMENT_STORAGE:R,MORE_OPTIONS:M,SHARED_ACCESS:H}=T.SecureNoteTabs,B=(0,N.DP)((({note:e,isShared:t,isAdmin:i,isSharedViaUserGroup:s,isLastAdmin:a,onClose:d})=>{var u,m;const{translate:h}=(0,C.Z)(),{routes:N}=(0,c.Xo)(),B=(0,c.TH)(),{updateVaultItem:X}=(0,S.u)(r.L),{showAlert:x}=(0,A.V)(),{shouldShowFrozenStateDialog:z}=(0,D.Ub)(),{addNoteToCollections:Q}=(0,O.Q)(),{allCollections:W}=(0,V.bA)(),[K,Y]=(0,n.useState)(k),[$,j]=(0,n.useState)(!1),[J]=(0,n.useState)(null),[ee,te]=(0,n.useState)(!1),[ie,ne]=(0,n.useState)(!1),[se,ae]=(0,n.useState)(!1),[oe,re]=(0,n.useState)(!1),[le,ce]=(0,n.useState)(e.isSecured),[de,ue]=(0,n.useState)(e.content),[me,he]=(0,n.useState)(e.title),[Se,ge]=(0,n.useState)(e.color),[_e,pe]=(0,n.useState)(e.spaceId),[be,Ce]=(0,n.useState)(!1),[Ie,De]=(0,n.useState)([]),[Ae,ye]=(0,n.useState)(!1),{data:fe,status:Te}=(0,F.r)(e.id),we=()=>x(h("_common_generic_error"),_.BLW.ERROR),ve=()=>{(0,U.P)(),B.pathname.includes(N.userSecureNotes)&&(0,I.Nc)(g.PageView.ItemSecureNoteList),d()},Le=async(t=!0)=>{ae(!0);const i=null!=J?J:{spaceId:_e,type:Se,category:e.categoryId,secured:le};try{var n;const t=await X({vaultItemType:l.U.SecureNote,content:{content:de,title:me,id:e.id,attachments:[...null!=(n=e.attachments)?n:[]],...i},id:e.id});Q(e.id,Ie),(0,p.hx)(t)&&we()}catch(e){we()}ae(!1),t?ve():j(!1)},Ne=()=>{re(!0)},Ee=async t=>{re(!1),t.success&&(await b.C.commitSecureFile({secureFileInfo:t.secureFileInfo}),e.attachments?.push((0,Z.w)(t.secureFileInfo)),Le(!1))},Ze=()=>j(!0),Ue=(0,q.vN)(g.ItemType.SecureNote,we),Fe=W.filter((t=>t.vaultItems.some((t=>t.id===e.id)))),Ge=Fe.length||Ie.length,Oe=!!e.attachments&&e.attachments.length>0,Ve=!Ge,qe=[k];t?qe.push(H):Ve&&qe.push(R);const Pe={confirmDeleteConfirm:h("webapp_secure_notes_edition_delete_confirm"),confirmDeleteDismiss:h("webapp_credential_edition_delete_dismiss"),confirmDeleteSubtitle:h("webapp_credential_edition_confirm_delete_subtitle"),confirmDeleteTitle:h("webapp_secure_notes_edition_delete_title"),lastAdminActionLabel:h("webapp_credential_edition_change_permissions"),lastAdminTitle:h("webapp_credential_edition_last_admin_title"),lastAdminSubtitle:h("webapp_credential_edition_last_admin_subtitle"),groupSharingTitle:h("webapp_secure_notes_edition_group_sharing_title"),groupSharingSubtitle:h("webapp_credential_edition_group_sharing_subtitle"),collectionSharingTitle:h("webapp_credential_edition_collection_sharing_title"),collectionSharingSubtitle:h("webapp_credential_edition_collection_sharing_subtitle"),genericErrorTitle:"webapp_account_recovery_generic_error_title",genericErrorSubtitle:"webapp_account_recovery_generic_error_subtitle"},ke={attachments:null!=(u=e.attachments)?u:[],category:e.categoryId?e.categoryId:"noCategory",content:e.content,id:e.id,limitedPermissions:t&&!i,secured:e.isSecured,spaceId:e.spaceId,title:e.title,type:e.color},Re=e=>t=>{Ze(),e(t)},Me=Re(pe),He=Re(ge),Be=Re(he),Xe=Re(ue),xe=Re(ce),ze=t&&Te===o.rq.Success&&null!=(Qe=fe?.count)?Qe:0;var Qe;const We=Fe.filter((e=>e.isShared)).length>0;return(0,P.BX)(y.zI,{isViewingExistingItem:!0,submitDisabled:be,itemHasBeenEdited:$,onSubmit:()=>{Le()},isUsingNewDesign:!0,submitPending:se,secondaryActions:(()=>{switch(K){case k:return[(s=e,!s||t&&!i||s.attachments?.length?null:(0,P.tZ)(G.Z,{tooltipPlacement:"top-start",sharing:(n=e.id,(0,L.A1)(n)),text:h("webapp_sharing_invite_share"),origin:g.Origin.ItemDetailView},"shareaction"))];case R:return[(0,P.tZ)(E.d,{isQuotaReached:!1,onFileUploadStarted:Ne,onFileUploadDone:Ee,isShared:t,itemId:e.id,dataType:"KWSecureNote",disabled:!!z},"uploadAction")];default:return[]}var n,s})(),onNavigateOut:ve,onClickDelete:()=>te(!0),ignoreCloseOnEscape:ee||ie,isSomeDialogOpen:ee||Ae,formId:"edit_securenote_panel",header:(0,P.tZ)(w.h,{backgroundColor:ke.type,displayDocumentStorage:qe.includes(R),displaySharedAccess:qe.includes(H),displayMoreOptions:qe.includes(M),recipientsCount:ze,attachmentsCount:null!=(m=e?.attachments?.length)?m:0,setActiveTab:Y,disabled:t&&!i,title:me,setTitle:Be}),children:[(0,P.tZ)(v.T,{activeTab:K,data:ke,content:null!=de?de:"",title:me,color:Se,spaceId:_e,isDisabled:!!z,isSecured:le,onSpaceIdChange:Me,onColorChange:He,onTitleChange:Be,onContentChange:Xe,onIsSecuredChange:xe,onIsSubmitDisabled:Ce,handleFileInfoDetached:t=>{e.attachments=e.attachments?.filter((e=>e.id!==t)),Le(!1)},hasAttachment:Oe,isAdmin:i,isShared:t,isUploading:oe,onModifyData:Ze,onModalDisplayStateChange:ne,onCollectionsToUpdate:De,setHasDialogsOpenedByChildren:ye}),(0,P.tZ)(f.s,{isVisible:ee,itemId:e.id,closeConfirmDeleteDialog:()=>te(!1),goToSharingAccess:()=>{Y(T.SecureNoteTabs.SHARED_ACCESS)},onDeletionSuccess:async()=>{e.attachments?.forEach((async e=>{const{id:t}=e;Ue(t)})),ve()},isLastAdmin:a,isShared:t,isSharedViaUserGroup:s,isItemInCollection:We,translations:Pe,vaultItemType:l.U.SecureNote})]})})),X=({note:e,onClose:t})=>{const{getPermissionForItem:i,getSharingStatusForItem:n,getIsLastAdminForItem:s}=(0,u.Y)(m.X,{getPermissionForItem:{queryParam:{itemId:e.id}},getSharingStatusForItem:{queryParam:{itemId:e.id}},getIsLastAdminForItem:{queryParam:{itemId:e.id}}},[]);if(i.status!==o.rq.Success||n.status!==o.rq.Success||s.status!==o.rq.Success)return null;const{isShared:a,isSharedViaUserGroup:r}=n.data,{permission:l}=i.data,{isLastAdmin:c}=s.data,d=a&&l===h.y3.Admin;return(0,P.tZ)(B,{onClose:t,note:e,isShared:a,isAdmin:d,isSharedViaUserGroup:r,isLastAdmin:c})},x=e=>{const t=(0,a.k)(r.L,"query",{vaultItemTypes:[l.U.SecureNote],ids:[`{${e.match.params.uuid}}`]}),{routes:i}=(0,c.Xo)();return t.status===o.rq.Loading?null:t.data?.secureNotesResult.items.length?(0,P.tZ)(X,{...e,note:t.data.secureNotesResult.items[0]}):e.location?.state?(0,P.tZ)(s.l_,{to:(0,d.rF)(e.location?.state,i)}):(0,P.tZ)(s.l_,{to:i.userSecureNotes})}}}]);