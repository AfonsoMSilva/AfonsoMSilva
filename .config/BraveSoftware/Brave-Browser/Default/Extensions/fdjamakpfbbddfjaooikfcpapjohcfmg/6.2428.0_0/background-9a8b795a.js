"use strict";(globalThis.webpackChunk_dashlane_amphora=globalThis.webpackChunk_dashlane_amphora||[]).push([[394],{53006:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},27571:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.abTestsLiveQueriesSlots=t.abTestsQueriesSlots=t.abTestsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.abTestsCommandsSlots={participateToUserABTest:(0,s.slot)()},t.abTestsQueriesSlots={getUserABTestVariant:(0,s.slot)()},t.abTestsLiveQueriesSlots={liveUserABTestVariant:(0,i.liveSlot)()}},28249:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(53006),t),i(r(27571),t)},29004:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(19240),t),i(r(69021),t)},19240:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contactInfoLiveQueriesSlots=t.contactInfoQueriesSlots=t.contactInfoCommandsSlots=void 0;const s=r(30504),i=r(72345);t.contactInfoCommandsSlots={editContactInfo:(0,s.slot)(),refreshContactInfo:(0,s.slot)()},t.contactInfoQueriesSlots={getContactInfo:(0,s.slot)()},t.contactInfoLiveQueriesSlots={liveContactInfo:(0,i.liveSlot)()}},69021:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshContactInfoErrorCode=t.EditContactInfoErrorCode=void 0,function(e){e[e.EMPTY_EMAIL=0]="EMPTY_EMAIL",e[e.INVALID_EMAIL=1]="INVALID_EMAIL",e[e.UNKNOWN_ERROR=2]="UNKNOWN_ERROR"}(t.EditContactInfoErrorCode||(t.EditContactInfoErrorCode={})),function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(t.RefreshContactInfoErrorCode||(t.RefreshContactInfoErrorCode={}))},90041:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(83559),t)},83559:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subscriptionCodeLiveQueriesSlots=t.subscriptionCodeQueriesSlots=void 0;const s=r(30504),i=r(72345);t.subscriptionCodeQueriesSlots={getSubscriptionCode:(0,s.slot)()},t.subscriptionCodeLiveQueriesSlots={liveSubscriptionCode:(0,i.liveSlot)()}},53042:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AccountCreationCode=void 0,function(e){e[e.USER_EXISTS=0]="USER_EXISTS",e[e.USER_DOESNT_EXIST=1]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=2]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=3]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_DOESNT_EXIST_SSO_NON_PROVISIONED=4]="USER_DOESNT_EXIST_SSO_NON_PROVISIONED",e[e.USER_SSO_PROVISIONED=5]="USER_SSO_PROVISIONED",e[e.USER_NITRO_SSO_PROVISIONED=6]="USER_NITRO_SSO_PROVISIONED",e[e.USER_NOT_PROPOSED=7]="USER_NOT_PROPOSED"}(t.AccountCreationCode||(t.AccountCreationCode={}))},33773:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(53042),t)},16307:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.antiPhishingLiveQueriesSlots=void 0;const s=r(72345);t.antiPhishingLiveQueriesSlots={livePhishingURLList:(0,s.liveSlot)()}},65722:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(16307),t)},8850:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(14529),t),i(r(54876),t)},14529:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.twoFactorAuthenticationLiveQueriesSlots=t.twoFactorAuthenticationQueriesSlots=t.twoFactorAuthenticationCommandsSlots=void 0;const s=r(30504),i=r(72345);t.twoFactorAuthenticationCommandsSlots={refreshU2FDevicesList:(0,s.slot)(),removeU2FAuthenticator:(0,s.slot)(),refreshTwoFactorAuthenticationInfo:(0,s.slot)(),startTwoFactorAuthenticationEnableFlow:(0,s.slot)(),stopTwoFactorAuthenticationEnableFlow:(0,s.slot)(),continueTwoFactorAuthenticationEnableFlow:(0,s.slot)(),backTwoFactorAuthenticationEnableFlow:(0,s.slot)(),startTwoFactorAuthenticationDisableFlow:(0,s.slot)(),stopTwoFactorAuthenticationDisableFlow:(0,s.slot)(),continueTwoFactorAuthenticationDisableFlow:(0,s.slot)(),backTwoFactorAuthenticationDisableFlow:(0,s.slot)()},t.twoFactorAuthenticationQueriesSlots={getU2FDevicesList:(0,s.slot)(),getTwoFactorAuthenticationEnableStage:(0,s.slot)(),getTwoFactorAuthenticationDisableStage:(0,s.slot)()},t.twoFactorAuthenticationLiveQueriesSlots={liveU2FDevicesList:(0,i.liveSlot)(),liveTwoFactorAuthenticationEnableStage:(0,i.liveSlot)(),liveTwoFactorAuthenticationDisableStage:(0,i.liveSlot)()}},54876:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestTOTPActivationError=t.TwoFactorAuthenticationDisableStages=t.TwoFactorAuthenticationEnableStages=t.RemoveU2FAuthenticatorError=t.RefreshU2FErrorCode=void 0,function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(t.RefreshU2FErrorCode||(t.RefreshU2FErrorCode={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.NO_KEYHANDLE_FOUND="NO_KEYHANDLE_FOUND",e.WRONG_AUTHENTICATION_CODE="WRONG_AUTHENTICATION_CODE"}(t.RemoveU2FAuthenticatorError||(t.RemoveU2FAuthenticatorError={})),function(e){e.AUTHENTICATION_TYPE="AUTHENTICATION_TYPE",e.BACKUP_PHONE="BACKUP_PHONE",e.QR_CODE="QR_CODE",e.AUTHENTICATION_CODE="AUTHENTICATION_CODE",e.LOADING="LOADING",e.FINALIZING_CHANGES="FINALIZING_CHANGES",e.BACKUP_CODES="BACKUP_CODES",e.GENERIC_ERROR="GENERIC_ERROR",e.LOGOUT_REQUIRED="LOGOUT_REQUIRED",e.SUCCESS="SUCCESS"}(t.TwoFactorAuthenticationEnableStages||(t.TwoFactorAuthenticationEnableStages={})),function(e){e.CONFIRMATION="CONFIRMATION",e.AUTHENTICATION_CODE="AUTHENTICATION_CODE",e.BACKUP_CODE="BACKUP_CODE",e.FINALIZING_CHANGES="FINALIZING_CHANGES",e.SUCCESS="SUCCESS",e.LOGOUT_REQUIRED="LOGOUT_REQUIRED",e.GENERIC_ERROR="GENERIC_ERROR"}(t.TwoFactorAuthenticationDisableStages||(t.TwoFactorAuthenticationDisableStages={})),function(e){e.INTERNAL_ERROR="internal_error",e.CANNOT_SEED_FOR_USER_WITH_TOTP_ENABLED="cannot_seed_for_user_with_TOTP_enabled",e.OTP_FAILED="otp_failed",e.TOTP_TYPE_IS_NOT_SET_TO_EMAIL_TOKEN="totp_type_is_not_set_to_email_token",e.PHONE_VALIDATION_FAILED="phone_validation_failed"}(t.RequestTOTPActivationError||(t.RequestTOTPActivationError={}))},30156:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47817),t),i(r(1195),t)},1195:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InitUserVerificationWithWebAuthnError=t.RemoveWebAuthnAuthenticatorError=t.DisableWebAuthnAuthenticationError=t.OpenSessionWithWebAuthnAuthenticatorError=t.InitOpenSessionWithWebAuthnAuthenticatorError=t.RefreshAvailableWebAuthnAuthenticatorsError=t.RefreshWebAuthnAuthenticatorsError=t.RegisterWebAuthnAuthenticatorError=t.InitRegisterWebAuthnAuthenticatorError=t.EnableWebAuthnAuthenticationError=t.InitEnableWebAuthnAuthenticationError=t.WebAuthnCallTypes=void 0,t.WebAuthnCallTypes=Object.freeze({CREATE:"webauthn.create",GET:"webauthn.get"}),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(t.InitEnableWebAuthnAuthenticationError||(t.InitEnableWebAuthnAuthenticationError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.USER_HAS_OTP="USER_HAS_OTP",e.WEBAUTHN_SERVICE_INIT_FAILED="WEBAUTHN_SERVICE_INIT_FAILED"}(t.EnableWebAuthnAuthenticationError||(t.EnableWebAuthnAuthenticationError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(t.InitRegisterWebAuthnAuthenticatorError||(t.InitRegisterWebAuthnAuthenticatorError={})),function(e){e.USER_HAS_OTP="USER_HAS_OTP",e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(t.RegisterWebAuthnAuthenticatorError||(t.RegisterWebAuthnAuthenticatorError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(t.RefreshWebAuthnAuthenticatorsError||(t.RefreshWebAuthnAuthenticatorsError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MISSING_SESSION_KEYS_IN_STORE="MISSING_SESSION_KEYS_IN_STORE"}(t.RefreshAvailableWebAuthnAuthenticatorsError||(t.RefreshAvailableWebAuthnAuthenticatorsError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNAVAILABLE_AUTHENTICATORS="UNAVAILABLE_AUTHENTICATORS",e.CANNOT_TRIGGER_WEBAUTHN_AUTHENTICATION="CANNOT_TRIGGER_WEBAUTHN_AUTHENTICATION"}(t.InitOpenSessionWithWebAuthnAuthenticatorError||(t.InitOpenSessionWithWebAuthnAuthenticatorError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MP_MISSING_IN_SESSION_ERROR="MP_MISSING_IN_SESSION_ERROR"}(t.OpenSessionWithWebAuthnAuthenticatorError||(t.OpenSessionWithWebAuthnAuthenticatorError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.WEBAUTHN_SERVICE_DEACTIVATE_FAILED="WEBAUTHN_SERVICE_DEACTIVATE_FAILED",e.MISSING_LOGIN="MISSING_LOGIN"}(t.DisableWebAuthnAuthenticationError||(t.DisableWebAuthnAuthenticationError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.CANNOT_REMOVE_WEBAUTHN_AUTHENTICATOR="CANNOT_REMOVE_WEBAUTHN_AUTHENTICATOR"}(t.RemoveWebAuthnAuthenticatorError||(t.RemoveWebAuthnAuthenticatorError={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.LOGGED_OUT="LOGGED_OUT",e.CANNOT_REFRESH_WEBAUTHN_AUTHENTICATORS="CANNOT_REFRESH_WEBAUTHN_AUTHENTICATORS",e.CANNOT_FETCH_WEBAUTHN_CHALLENGE="CANNOT_FETCH_WEBAUTHN_CHALLENGE"}(t.InitUserVerificationWithWebAuthnError||(t.InitUserVerificationWithWebAuthnError={}))},47817:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.webAuthnAuthenticationLiveQueriesSlots=t.webAuthnAuthenticationQueriesSlots=t.webAuthnAuthenticationCommandsSlots=void 0;const s=r(30504),i=r(72345);t.webAuthnAuthenticationCommandsSlots={enableWebAuthnAuthentication:(0,s.slot)(),initEnableWebAuthnAuthentication:(0,s.slot)(),refreshAvailableWebAuthnAuthenticators:(0,s.slot)(),refreshWebAuthnAuthenticators:(0,s.slot)(),initRegisterWebAuthnAuthenticator:(0,s.slot)(),registerWebAuthnAuthenticator:(0,s.slot)(),initOpenSessionWithWebAuthnAuthenticator:(0,s.slot)(),openSessionWithWebAuthnAuthenticator:(0,s.slot)(),disableWebAuthnAuthentication:(0,s.slot)(),removeWebAuthnAuthenticator:(0,s.slot)(),initUserVerificationWithWebAuthn:(0,s.slot)()},t.webAuthnAuthenticationQueriesSlots={getWebAuthnAuthenticators:(0,s.slot)(),getWebAuthnAuthenticationOptedIn:(0,s.slot)()},t.webAuthnAuthenticationLiveQueriesSlots={liveWebAuthnAuthenticators:(0,i.liveSlot)(),liveWebAuthnAuthenticationOptedIn:(0,i.liveSlot)()}},29814:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.authenticationLiveQueriesSlots=t.authenticationQueriesSlots=t.authenticationCommandsSlots=void 0;const s=r(30504),i=r(72345),o=r(8850),a=r(30156);t.authenticationCommandsSlots=(0,s.combineEvents)({openSessionWithMasterPassword:(0,s.slot)(),registerDevice:(0,s.slot)(),requestEmailToken:(0,s.slot)(),requestPaymentUpdateAuthenticationToken:(0,s.slot)(),setReactivationStatus:(0,s.slot)(),disableAutologin:(0,s.slot)()},a.webAuthnAuthenticationCommandsSlots,o.twoFactorAuthenticationCommandsSlots),t.authenticationQueriesSlots=(0,s.combineEvents)({getHasOtp2Type:(0,s.slot)(),getUserOtpType:(0,s.slot)(),getReactivationStatus:(0,s.slot)(),getAvailableUserVerificationMethods:(0,s.slot)()},a.webAuthnAuthenticationQueriesSlots,o.twoFactorAuthenticationQueriesSlots),t.authenticationLiveQueriesSlots=(0,s.combineEvents)({liveReactivationStatus:(0,i.liveSlot)()},a.webAuthnAuthenticationLiveQueriesSlots,o.twoFactorAuthenticationLiveQueriesSlots)},25098:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29814),t),i(r(52632),t),i(r(8850),t),i(r(30156),t)},52632:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthenticationCode=t.OtpType=t.UserVerificationMethods=t.PersistData=t.ReactivationStatus=t.EmailTokenApiError=void 0,t.EmailTokenApiError="SEND_TOKEN_FAILED",function(e){e.DISABLED="DISABLED",e.CLASSIC="CLASSIC",e.WEBAUTHN="WEBAUTHN"}(t.ReactivationStatus||(t.ReactivationStatus={})),function(e){e[e.PERSIST_DATA_YES=0]="PERSIST_DATA_YES",e[e.PERSIST_DATA_NO=1]="PERSIST_DATA_NO"}(t.PersistData||(t.PersistData={})),t.UserVerificationMethods=Object.freeze({MasterPassword:"masterPassword",Webauthn:"webauthn"}),function(e){e[e.NO_OTP=0]="NO_OTP",e[e.OTP_NEW_DEVICE=1]="OTP_NEW_DEVICE",e[e.OTP_LOGIN=2]="OTP_LOGIN"}(t.OtpType||(t.OtpType={})),function(e){e[e.INVALID_LOGIN=0]="INVALID_LOGIN",e[e.EMPTY_LOGIN=1]="EMPTY_LOGIN",e[e.EMPTY_MASTER_PASSWORD=2]="EMPTY_MASTER_PASSWORD",e[e.EMPTY_ENCRYPTED_KEY=3]="EMPTY_ENCRYPTED_KEY",e[e.INVALID_ENCRYPTED_KEY=4]="INVALID_ENCRYPTED_KEY",e[e.EMPTY_TOKEN=5]="EMPTY_TOKEN",e[e.EMPTY_OTP=6]="EMPTY_OTP",e[e.SEND_TOKEN_FAILED=7]="SEND_TOKEN_FAILED",e[e.UKI_REGISTRATION_FAILED=8]="UKI_REGISTRATION_FAILED",e[e.REGISTER_DEVICE_FAILED=9]="REGISTER_DEVICE_FAILED",e[e.BUSINESS_ERROR=10]="BUSINESS_ERROR",e[e.USER_DOESNT_EXIST=11]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=12]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=13]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_UNAUTHORIZED=14]="USER_UNAUTHORIZED",e[e.WRONG_PASSWORD=15]="WRONG_PASSWORD",e[e.DATA_TAMPERED_ERROR=16]="DATA_TAMPERED_ERROR",e[e.LOGGEDIN=17]="LOGGEDIN",e[e.ASK_TOKEN=18]="ASK_TOKEN",e[e.ASK_OTP=19]="ASK_OTP",e[e.ASK_MASTER_PASSWORD=20]="ASK_MASTER_PASSWORD",e[e.USE_LOCAL_UKI=21]="USE_LOCAL_UKI",e[e.ASK_DASHLANE_AUTHENTICATOR=22]="ASK_DASHLANE_AUTHENTICATOR",e[e.OTP_NOT_VALID=23]="OTP_NOT_VALID",e[e.OTP_TOO_MANY_ATTEMPTS=24]="OTP_TOO_MANY_ATTEMPTS",e[e.OTP_ALREADY_USED=25]="OTP_ALREADY_USED",e[e.BACKUP_CODE_NOT_VALID=26]="BACKUP_CODE_NOT_VALID",e[e.TOKEN_NOT_VALID=27]="TOKEN_NOT_VALID",e[e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED=28]="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e[e.SERVER_KEY_MISSING=29]="SERVER_KEY_MISSING",e[e.TOKEN_LOCKED=30]="TOKEN_LOCKED",e[e.TOKEN_TOO_MANY_ATTEMPTS=31]="TOKEN_TOO_MANY_ATTEMPTS",e[e.TOKEN_ACCOUNT_LOCKED=32]="TOKEN_ACCOUNT_LOCKED",e[e.TOKEN_EXPIRED=33]="TOKEN_EXPIRED",e[e.NO_ACTIVE_AUTHENTICATOR=34]="NO_ACTIVE_AUTHENTICATOR",e[e.FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE=35]="FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE",e[e.DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION=36]="DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION",e[e.DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED=37]="DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED",e[e.TOKEN_PROVIDED_FOR_LOCAL_SESSION=38]="TOKEN_PROVIDED_FOR_LOCAL_SESSION",e[e.DEVICE_ALREADY_REGISTERED=39]="DEVICE_ALREADY_REGISTERED",e[e.OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION=40]="OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION",e[e.DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP=41]="DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP",e[e.UNKNOWN_SYNC_ERROR=42]="UNKNOWN_SYNC_ERROR",e[e.INVALID_UKI=43]="INVALID_UKI",e[e.UNKNOWN_UKI=44]="UNKNOWN_UKI",e[e.UNKNOWN_ERROR=45]="UNKNOWN_ERROR",e[e.UNEXPECTED_OTP_TYPE=46]="UNEXPECTED_OTP_TYPE",e[e.UNAUTHORIZED=47]="UNAUTHORIZED",e[e.UNAUTHORIZED_NOT_VALID_CONTENT=48]="UNAUTHORIZED_NOT_VALID_CONTENT",e[e.NETWORK_ERROR=49]="NETWORK_ERROR",e[e.THROTTLED=50]="THROTTLED",e[e.SESSION_ALREADY_OPENED=51]="SESSION_ALREADY_OPENED",e[e.INVALID_SESSION=52]="INVALID_SESSION",e[e.DEVICE_NOT_REGISTERED=53]="DEVICE_NOT_REGISTERED",e[e.MISSING_APP_KEYS=54]="MISSING_APP_KEYS",e[e.PROVIDE_EXTRA_DEVICE_TOKEN=55]="PROVIDE_EXTRA_DEVICE_TOKEN",e[e.PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE=56]="PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE",e[e.PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE=57]="PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE",e[e.ASK_OTP_FOR_NEW_DEVICE=58]="ASK_OTP_FOR_NEW_DEVICE",e[e.TEAM_GENERIC_ERROR=59]="TEAM_GENERIC_ERROR",e[e.SSO_LOGIN_BYPASS=60]="SSO_LOGIN_BYPASS",e[e.SSO_VERIFICATION_FAILED=61]="SSO_VERIFICATION_FAILED",e[e.SSO_BLOCKED=62]="SSO_BLOCKED",e[e.CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION=63]="CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION",e[e.USER_DOESNT_EXIST_SSO=64]="USER_DOESNT_EXIST_SSO"}(t.AuthenticationCode||(t.AuthenticationCode={}))},1295:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.autofillDataQueriesSlots=void 0;const s=r(30504);t.autofillDataQueriesSlots={getSingleAddressForAutofill:(0,s.slot)(),getMultipleAddressesForAutofill:(0,s.slot)(),getSingleBankAccountForAutofill:(0,s.slot)(),getMultipleBankAccountsForAutofill:(0,s.slot)(),getSingleCompanyForAutofill:(0,s.slot)(),getMultipleCompaniesForAutofill:(0,s.slot)(),getSingleCredentialForAutofill:(0,s.slot)(),getMultipleCredentialsForAutofill:(0,s.slot)(),getSingleDriverLicenseForAutofill:(0,s.slot)(),getMultipleDriverLicensesForAutofill:(0,s.slot)(),getSingleEmailForAutofill:(0,s.slot)(),getMultipleEmailsForAutofill:(0,s.slot)(),getSingleFiscalIdForAutofill:(0,s.slot)(),getMultipleFiscalIdsForAutofill:(0,s.slot)(),getSingleGeneratedPasswordForAutofill:(0,s.slot)(),getMultipleGeneratedPasswordsForAutofill:(0,s.slot)(),getSingleIdCardForAutofill:(0,s.slot)(),getMultipleIdCardsForAutofill:(0,s.slot)(),getSingleIdentityForAutofill:(0,s.slot)(),getMultipleIdentitiesForAutofill:(0,s.slot)(),getSingleNoteForAutofill:(0,s.slot)(),getMultipleNotesForAutofill:(0,s.slot)(),getSinglePasskeyForAutofill:(0,s.slot)(),getSinglePassportForAutofill:(0,s.slot)(),getMultiplePassportsForAutofill:(0,s.slot)(),getSinglePaymentCardForAutofill:(0,s.slot)(),getMultiplePaymentCardsForAutofill:(0,s.slot)(),getSinglePersonalWebsiteForAutofill:(0,s.slot)(),getMultiplePersonalWebsitesForAutofill:(0,s.slot)(),getSinglePhoneForAutofill:(0,s.slot)(),getMultiplePhonesForAutofill:(0,s.slot)(),getSingleSocialSecurityIdForAutofill:(0,s.slot)(),getMultipleSocialSecurityIdsForAutofill:(0,s.slot)(),getAutofillSettingOnUrlForAutofill:(0,s.slot)()}},94372:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1295),t),i(r(37905),t),i(r(60188),t),i(r(42362),t)},60188:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},37905:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AutofillOptions=void 0,function(e){e.ANALYSIS_ENABLED_ON_ALL_FORMS="ANALYSIS_ENABLED_ON_ALL_FORMS",e.ANALYSIS_ENABLED_ONLY_ON_LOGINS_AND_PASSWORDS="ANALYSIS_ENABLED_ONLY_ON_LOGINS_AND_PASSWORDS"}(t.AutofillOptions||(t.AutofillOptions={}))},42362:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.vaultSourceTypeToDataModelTypeMap=void 0;const s=r(70976),i=r(44225);t.vaultSourceTypeToDataModelTypeMap={[s.VaultSourceType.Address]:i.DataModelType.KWAddress,[s.VaultSourceType.BankAccount]:i.DataModelType.KWBankStatement,[s.VaultSourceType.Company]:i.DataModelType.KWCompany,[s.VaultSourceType.Credential]:i.DataModelType.KWAuthentifiant,[s.VaultSourceType.DriverLicense]:i.DataModelType.KWDriverLicence,[s.VaultSourceType.Email]:i.DataModelType.KWEmail,[s.VaultSourceType.FiscalId]:i.DataModelType.KWFiscalStatement,[s.VaultSourceType.GeneratedPassword]:i.DataModelType.KWGeneratedPassword,[s.VaultSourceType.IdCard]:i.DataModelType.KWIDCard,[s.VaultSourceType.Identity]:i.DataModelType.KWIdentity,[s.VaultSourceType.NoteCategory]:i.DataModelType.KWSecureNoteCategory,[s.VaultSourceType.Note]:i.DataModelType.KWSecureNote,[s.VaultSourceType.Passkey]:i.DataModelType.KWPasskey,[s.VaultSourceType.Passport]:i.DataModelType.KWPassport,[s.VaultSourceType.PaymentCard]:i.DataModelType.KWPaymentMean_creditCard,[s.VaultSourceType.PersonalWebsite]:i.DataModelType.KWPersonalWebsite,[s.VaultSourceType.Phone]:i.DataModelType.KWPhone,[s.VaultSourceType.SocialSecurityId]:i.DataModelType.KWSocialSecurityStatement,[s.VaultSourceType.Secret]:i.DataModelType.KWSecret}},39229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonApiConnector=void 0;const s=r(30504),i=r(52240),o=r(78178),a=r(90397);t.CarbonApiConnector=(0,s.combineEvents)(i.carbonCommandsSlots,o.carbonQueriesSlots,a.carbonLiveQueriesSlots)},52240:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonCommandsSlots=void 0;const s=r(30504),i=r(28249),o=r(29004),a=r(25098),n=r(15874),c=r(50459),d=r(14811),l=r(30897),u=r(65005),p=r(29450),m=r(96035),h=r(6666),g=r(15925),v=r(68183),_=r(6768),y=r(58290),S=r(78779),E=r(37174),f=r(60687),A=r(77277),I=r(49106),O=r(68440),b=r(34852),T=r(31525),C=r(9987),w=r(57369),R=r(22162),P=r(31955),D=r(88219);t.carbonCommandsSlots=(0,s.combineEvents)(i.abTestsCommandsSlots,a.authenticationCommandsSlots,n.changeMasterPasswordCommandsSlots,o.contactInfoCommandsSlots,c.cryptoMigrationCommandsSlots,d.darkWebInsightsCommandsSlots,l.dataManagementCommandsSlots,g.eventLoggerCommandsSlots,v.exceptionCommandsSlots,u.familyCommandsSlots,m.globalExtensionSettingsCommandsSlots,h.healthCommandsSlots,_.loginCommandsSlots,y.loginNotificationsCommandsSlots,S.loginStepInfoCommandsSlots,E.notificationsCommandsSlots,f.openSessionCommandsSlots,A.passwordGeneratorCommandsSlots,I.paymentsCommandsSlots,O.protectedItemsUnlockerCommandsSlots,b.recoveryCommandsSlots,p.remoteFileCommandsSlots,T.sharingCommandsSlots,C.teamCommandsSlots,w.teamAdminCommandsSlots,R.userMessagesCommandsSlots,P.vpnCommandsSlots,D.deviceCommandsSlots)},90397:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonLiveQueriesSlots=void 0;const s=r(30504),i=r(28249),o=r(29004),a=r(90041),n=r(65722),c=r(25098),d=r(30897),l=r(15874),u=r(50459),p=r(29450),m=r(24875),h=r(58290),g=r(78779),v=r(37174),_=r(60687),y=r(68440),S=r(34852),E=r(31525),f=r(57369),A=r(22162),I=r(31955);t.carbonLiveQueriesSlots=(0,s.combineEvents)(i.abTestsLiveQueriesSlots,n.antiPhishingLiveQueriesSlots,c.authenticationLiveQueriesSlots,l.changeMasterPasswordLiveQueriesSlots,o.contactInfoLiveQueriesSlots,u.cryptoMigrationLiveQueriesSlots,d.dataManagementLiveQueriesSlots,m.killswitchLiveQueriesSlots,h.loginNotificationsLiveQueriesSlots,g.loginStepInfoLiveQueriesSlots,v.notificationsLiveQueriesSlots,_.openSessionLiveQueriesSlots,y.protectedItemsUnlockerLiveQueriesSlots,S.recoveryLiveQueriesSlots,p.remoteFilesLiveQueriesSlots,E.sharingLiveQueriesSlots,a.subscriptionCodeLiveQueriesSlots,f.teamAdminLiveQueriesSlots,A.userMessagesLiveQueriesSlots,I.vpnLiveQueriesSlots)},78178:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonQueriesSlots=void 0;const s=r(30504),i=r(28249),o=r(29004),a=r(90041),n=r(25098),c=r(94372),d=r(30897),l=r(50459),u=r(88219),p=r(80898),m=r(29450),h=r(24875),g=r(58290),v=r(78779),_=r(37174),y=r(60687),S=r(77277),E=r(49106),f=r(68440),A=r(34852),I=r(98655),O=r(31525),b=r(9987),T=r(57369),C=r(22162),w=r(31955);t.carbonQueriesSlots=(0,s.combineEvents)(i.abTestsQueriesSlots,n.authenticationQueriesSlots,c.autofillDataQueriesSlots,o.contactInfoQueriesSlots,l.cryptoMigrationQueriesSlots,d.dataManagementQueriesSlots,u.deviceQueriesSlots,p.featureQueriesSlots,h.killswitchQueriesSlots,g.loginNotificationsQueriesSlots,v.loginStepInfoQueriesSlots,_.notificationsQueriesSlots,y.openSessionQueriesSlots,S.passwordGeneratorQueriesSlots,E.paymentsQueriesSlots,f.protectedItemsUnlockerQueriesSlots,A.recoveryQueriesSlots,m.remoteFilesQueriesSlots,O.sharingQueriesSlots,I.staticDataQueriesSlots,a.subscriptionCodeQueriesSlots,b.teamQueriesSlots,T.teamAdminQueriesSlots,C.userMessagesQueriesSlots,w.vpnQueriesSlots)},8438:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(52240),t),i(r(90397),t),i(r(78178),t),i(r(39229),t)},72345:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(60283),t),i(r(910),t),i(r(8438),t),i(r(53143),t)},910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},60283:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.liveSlot=void 0;const s=r(30504),i={noBuffer:!0};t.liveSlot=()=>(0,s.slot)(i)},53143:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},35715:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonDebugConnector=void 0;const s=r(30504);t.CarbonDebugConnector={log:(0,s.slot)(),info:(0,s.slot)(),warning:(0,s.slot)(),error:(0,s.slot)()}},11873:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},80112:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(35715),t),i(r(11873),t)},79702:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonDiagnosticConnector=void 0;const s=r(30504);t.CarbonDiagnosticConnector={decipheringDiagnosticLogEvent:(0,s.slot)()}},31427:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},55334:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(79702),t),i(r(31427),t)},80213:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.changeMasterPasswordLiveQueriesSlots=t.changeMasterPasswordCommandsSlots=void 0;const s=r(30504),i=r(72345);t.changeMasterPasswordCommandsSlots={changeMasterPassword:(0,s.slot)()},t.changeMasterPasswordLiveQueriesSlots={liveChangeMasterPasswordStatus:(0,i.liveSlot)()}},15874:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(80213),t),i(r(14776),t)},14776:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeMasterPasswordStepNeeded=t.ChangeMasterPasswordCode=t.ChangeMPFlowPath=void 0,function(e){e.USER_CHANGING_MP="USER_CHANGING_MP",e.MP_TO_SSO="MP_TO_SSO",e.SSO_TO_MP="SSO_TO_MP",e.TO_EMAIL_TOKEN="EMAIL_TOKEN",e.ADMIN_ASSISTED_RECOVERY="ADMIN_ASSISTED_RECOVERY",e.ACCOUNT_RECOVERY_KEY="ACCOUNT_RECOVERY_KEY"}(t.ChangeMPFlowPath||(t.ChangeMPFlowPath={})),function(e){e.FEATURE_BLOCKED="feature_blocked",e.INNACTIVE_SESSION="inactive_session",e.INVALID_TOKEN="invalid_token",e.OTP_PROBLEM="otp_problem",e.MP_ERROR="mp_error",e.MP_STRENGTH_ERROR="mp_strength_error",e.SUCCESS="success",e.SYNC_PROGRESS="sync_in_progress",e.UNKNOWN_ERROR="unknown_error",e.WRONG_PASSWORD="wrong_password",e.UNEXPECTED_STATE="unexpected_state"}(t.ChangeMasterPasswordCode||(t.ChangeMasterPasswordCode={})),function(e){e.DOWNLOAD="download",e.DECRYPTING="decrypting",e.ENCRYPTING="encrypting",e.UPLOADING="uploading",e.DONE="done",e.ERROR="error"}(t.ChangeMasterPasswordStepNeeded||(t.ChangeMasterPasswordStepNeeded={}))},23411:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cryptoMigrationLiveQueriesSlots=t.cryptoMigrationQueriesSlots=t.cryptoMigrationCommandsSlots=void 0;const s=r(30504),i=r(72345);t.cryptoMigrationCommandsSlots={changeUserCrypto:(0,s.slot)()},t.cryptoMigrationQueriesSlots={getCanUserChangeCrypto:(0,s.slot)(),getUserDerivationMethod:(0,s.slot)()},t.cryptoMigrationLiveQueriesSlots={liveUserDerivationMethod:(0,i.liveSlot)()}},50459:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(23411),t),i(r(92490),t)},92490:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SupportedDerivationMethods=t.CryptoMigrationApiErrorType=void 0,function(e){e.ChangeUserCryptoFailed="CHANGE_USER_CRYPTO_FAILED"}(t.CryptoMigrationApiErrorType||(t.CryptoMigrationApiErrorType={})),function(e){e.ARGON2D="argon2d",e.PBKDF2="pbkdf2",e.KWC3="kwc3"}(t.SupportedDerivationMethods||(t.SupportedDerivationMethods={}))},10130:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.darkWebInsightsCommandsSlots=void 0;const s=r(30504);t.darkWebInsightsCommandsSlots={getDarkWebInsightsReportResults:(0,s.slot)(),getDarkWebInsightsSummary:(0,s.slot)()}},14811:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(10130),t),i(r(76128),t)},76128:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmailIncidentViewStatuses=t.DarkWebInsightsBreachType=t.DarkWebInsightsApiErrorType=void 0,function(e){e.GetDarkWebInsightsFailed="GET_DARK_WEB_INSIGHTS_FAILED",e.GetDarkWebInsightsSummaryFailed="GET_DARK_WEB_INSIGHTS_SUMMARY_FAILED"}(t.DarkWebInsightsApiErrorType||(t.DarkWebInsightsApiErrorType={})),function(e){e.Password="password",e.CreditCard="creditcard",e.IPAddress="ip",e.MailingAddress="address",e.Phone="phone",e.Email="email",e.Social="social",e.GeoLocation="geolocation",e.UserName="username",e.PersonalInfo="personalinfo"}(t.DarkWebInsightsBreachType||(t.DarkWebInsightsBreachType={})),t.EmailIncidentViewStatuses=Object.freeze({New:"new",Viewed:"viewed"})},47495:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAddress=void 0,t.isAddress=function(e){return Boolean(e)&&"KWAddress"===e.kwType}},76647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBankAccount=void 0,t.isBankAccount=function(e){return Boolean(e)&&"KWBankStatement"===e.kwType}},15381:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBreach=t.BreachStatus=void 0,function(e){e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED"}(t.BreachStatus||(t.BreachStatus={})),t.isBreach=function(e){return Boolean(e)&&"KWSecurityBreach"===e.kwType}},39093:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCollection=void 0,t.isCollection=function(e){return Boolean(e)&&"KWCollection"===e.kwType}},270:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isObjectLocalized=t.isDataModelObject=t.dataModelTypes=t.transactionTypes=t.getTransactionTypeFromDataModelType=t.getDataModelTypeFromTransactionType=t.TRANSACTION_TYPE_TO_DATAMODEL_TYPE=t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE=t.TransactionType=t.DataModelType=t.getLocalFormat=t.Country=void 0;const s=r(50415);!function(e){e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW",e.AQ="AQ",e.AX="AX",e.BV="BV",e.CC="CC",e.CX="CX",e.EH="EH",e.GS="GS",e.HM="HM",e.PN="PN",e.SJ="SJ",e.UM="UM"}(t.Country||(t.Country={})),t.getLocalFormat=function(e){return e.LocaleFormat},t.DataModelType=(0,s.Enum)("KWAddress","KWAuthCategory","KWAuthentifiant","KWBankStatement","KWCollection","KWCompany","KWDataChangeHistory","KWDriverLicence","KWEmail","KWFiscalStatement","KWGeneratedPassword","KWIDCard","KWIdentity","KWMerchand","KWMiscData","KWPasskey","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWPurchaseAccount","KWPurchaseCategory","KWPurchasePaidBasket","KWPurchaseTrueArticle","KWSecret","KWSecureFileInfo","KWSecureNote","KWSecureNoteCategory","KWSecurityBreach","KWSettingsManagerApp","KWSocialSecurityStatement","KWWebSite"),t.TransactionType=(0,s.Enum)("ADDRESS","AUTHENTIFIANT","AUTH_CATEGORY","BANKACCESS","BANKACCOUNT","BANKCATEGORY","BANKINSTITUTION","BANKSITE","BANKSTATEMENT","BANKTRANSACTION","COLLECTION","COMPANY","DATA_CHANGE_HISTORY","DATA_USAGE_HISTORY","DEFAULT_AUTHENTIFIANT","DEFAULT_CONFIDENTIAL","DEFAULT_IDENTITY","DEFAULT_MISC","DEFAULT_PAYMENTMEANS","DEFAULT_REWARDCARD","DRIVERLICENCE","EMAIL","EMERGENCY_BUNDLE_FULL","EMERGENCY_BUNDLE_LITE","FULLBACKUP","FISCALSTATEMENT","GENERATED_PASSWORD","IDCARD","IDENTITY","INVOICEACCESS","INVOICEELEMENT","INVOICEINSTITUTION","MERCHANT","MISCDATA","PASSKEY","PASSPORT","PAYMENTMEANS_CREDITCARD","PAYMENTMEAN_PAYPAL","PERSONALWEBSITE","PHONE","POINTS","PURCHASEABANDONNEDBASKET","PURCHASEACCOUNT","PURCHASEARTICLE","PURCHASEBASKET","PURCHASEDELIVERYARTICLE","PURCHASEOPTIONARTICLE","PURCHASEPAIDBASKET","PURCHASE_CATEGORY","REWARDCARD","SECRET","SECUREFILEINFO","SECURENOTE","SECURENOTE_CATEGORY","SECURITYALERT","SECURITYALERTS","SECURITYBREACH","SETTINGS","SHARING_GROUP","SOCIALSECURITYSTATEMENT","WEBSITE"),t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE={KWAddress:t.TransactionType.ADDRESS,KWAuthCategory:t.TransactionType.AUTH_CATEGORY,KWAuthentifiant:t.TransactionType.AUTHENTIFIANT,KWCollection:t.TransactionType.COLLECTION,KWBankStatement:t.TransactionType.BANKSTATEMENT,KWCompany:t.TransactionType.COMPANY,KWDataChangeHistory:t.TransactionType.DATA_CHANGE_HISTORY,KWDriverLicence:t.TransactionType.DRIVERLICENCE,KWEmail:t.TransactionType.EMAIL,KWFiscalStatement:t.TransactionType.FISCALSTATEMENT,KWGeneratedPassword:t.TransactionType.GENERATED_PASSWORD,KWIDCard:t.TransactionType.IDCARD,KWIdentity:t.TransactionType.IDENTITY,KWMerchand:t.TransactionType.MERCHANT,KWMiscData:t.TransactionType.MISCDATA,KWPasskey:t.TransactionType.PASSKEY,KWPassport:t.TransactionType.PASSPORT,KWPaymentMean_creditCard:t.TransactionType.PAYMENTMEANS_CREDITCARD,KWPaymentMean_paypal:t.TransactionType.PAYMENTMEAN_PAYPAL,KWPersonalWebsite:t.TransactionType.PERSONALWEBSITE,KWPhone:t.TransactionType.PHONE,KWPurchaseAccount:t.TransactionType.PURCHASEACCOUNT,KWPurchaseCategory:t.TransactionType.PURCHASE_CATEGORY,KWPurchasePaidBasket:t.TransactionType.PURCHASEPAIDBASKET,KWPurchaseTrueArticle:t.TransactionType.PURCHASEARTICLE,KWSecret:t.TransactionType.SECRET,KWSecureFileInfo:t.TransactionType.SECUREFILEINFO,KWSecureNote:t.TransactionType.SECURENOTE,KWSecureNoteCategory:t.TransactionType.SECURENOTE_CATEGORY,KWSecurityBreach:t.TransactionType.SECURITYBREACH,KWSettingsManagerApp:t.TransactionType.SETTINGS,KWSocialSecurityStatement:t.TransactionType.SOCIALSECURITYSTATEMENT,KWWebSite:t.TransactionType.WEBSITE},t.TRANSACTION_TYPE_TO_DATAMODEL_TYPE=Object.values(t.DataModelType).reduce(((e,r)=>(e[t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE[r]]=r,e)),{}),t.getDataModelTypeFromTransactionType=function(e){const r=t.TRANSACTION_TYPE_TO_DATAMODEL_TYPE[e];if(!r)throw new Error(`No DataModelType found for TransactionType '${e}'`);return r},t.getTransactionTypeFromDataModelType=function(e){if(!t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE[e])throw new Error(`No TransactionType found for DataModelType ${e}`);return t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE[e]},t.transactionTypes=s.Enum.keys(t.TransactionType),t.dataModelTypes=s.Enum.keys(t.DataModelType);t.isDataModelObject=e=>!!e.LocaleFormat&&"string"==typeof e.SpaceId,t.isObjectLocalized=function(e){return Boolean(e)&&("KWPhone"===e.kwType||"KWIdentity"===e.kwType||"KWAddress"===e.kwType||"KWBankStatement"===e.kwType)}},59761:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCompany=void 0,t.isCompany=function(e){return Boolean(e)&&"KWCompany"===e.kwType}},77467:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCredential=t.isCredentialCategory=void 0,t.isCredentialCategory=function(e){return Boolean(e)&&"KWAuthCategory"===e.kwType},t.isCredential=function(e){return Boolean(e)&&"KWAuthentifiant"===e.kwType}},79840:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isDriverLicense=void 0,t.isDriverLicense=function(e){return Boolean(e)&&"KWDriverLicence"===e.kwType}},21563:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmail=void 0,t.isEmail=function(e){return Boolean(e)&&"KWEmail"===e.kwType}},19200:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},71148:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFiscalId=void 0,t.isFiscalId=function(e){return Boolean(e)&&"KWFiscalStatement"===e.kwType}},34314:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isGeneratedPassword=void 0,t.isGeneratedPassword=function(e){return Boolean(e)&&"KWGeneratedPassword"===e.kwType}},33092:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},45633:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isIdCard=void 0,t.isIdCard=function(e){return Boolean(e)&&"KWIDCard"===e.kwType}},36070:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isIdentity=void 0,t.isIdentity=function(e){return Boolean(e)&&"KWIdentity"===e.kwType}},15578:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedWebsiteSource=void 0,function(e){e.Manual="manual",e.Remember="remember"}(t.LinkedWebsiteSource||(t.LinkedWebsiteSource={}))},25353:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNote=t.isNoteCategory=t.NoteTypes=void 0,t.NoteTypes=["GRAY","PURPLE","GREEN","BLUE","YELLOW","ORANGE","PINK","BROWN","RED"],t.isNoteCategory=function(e){return Boolean(e)&&"KWSecureNoteCategory"===e.kwType},t.isNote=function(e){return Boolean(e)&&"KWSecureNote"===e.kwType}},9455:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPasskey=void 0,t.isPasskey=function(e){return Boolean(e)&&"KWPasskey"===e.kwType}},38275:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPassport=void 0,t.isPassport=function(e){return Boolean(e)&&"KWPassport"===e.kwType}},12728:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPaymentCard=t.PaymentCardColor=t.PaymentCardType=void 0;const s=r(50415);t.PaymentCardType=(0,s.Enum)("PAYMENT_TYPE_VISA","PAYMENT_TYPE_MASTERCARD","PAYMENT_TYPE_AMEX","PAYMENT_TYPE_DISCOVER","PAYMENT_TYPE_JCB","PAYMENT_TYPE_DINERSCLUB"),t.PaymentCardColor=(0,s.Enum)("BLACK","SILVER","WHITE","RED","ORANGE","GOLD","BLUE_1","BLUE_2","GREEN_1","GREEN_2"),t.isPaymentCard=function(e){return Boolean(e)&&"KWPaymentMean_creditCard"===e.kwType}},76756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPaypalAccount=void 0,t.isPaypalAccount=function(e){return Boolean(e)&&"KWPaymentMean_paypal"===e.kwType}},95701:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPersonalSettings=void 0,t.isPersonalSettings=function(e){return Boolean(e)&&"KWSettingsManagerApp"===e.kwType}},41667:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPersonalWebsite=void 0,t.isPersonalWebsite=function(e){return Boolean(e)&&"KWPersonalWebsite"===e.kwType}},91760:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPhone=t.PhoneType=void 0;const s=r(50415);t.PhoneType=(0,s.Enum)("PHONE_TYPE_ANY","PHONE_TYPE_MOBILE","PHONE_TYPE_LANDLINE","PHONE_TYPE_FAX","PHONE_TYPE_WORK_MOBILE","PHONE_TYPE_WORK_LANDLINE","PHONE_TYPE_WORK_FAX"),t.isPhone=function(e){return Boolean(e)&&"KWPhone"===e.kwType}},98661:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSecret=void 0,t.isSecret=function(e){return Boolean(e)&&"KWSecret"===e.kwType}},33952:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSecureFileInfo=void 0,t.isSecureFileInfo=function(e){return Boolean(e)&&"KWSecureFileInfo"===e.kwType}},96949:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSocialSecurityId=void 0,t.isSocialSecurityId=function(e){return Boolean(e)&&"KWSocialSecurityStatement"===e.kwType}},47357:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47495),t),i(r(76647),t),i(r(15381),t),i(r(39093),t),i(r(270),t),i(r(59761),t),i(r(77467),t),i(r(79840),t),i(r(21563),t),i(r(19200),t),i(r(71148),t),i(r(34314),t),i(r(33092),t),i(r(45633),t),i(r(36070),t),i(r(15578),t),i(r(25353),t),i(r(9455),t),i(r(38275),t),i(r(12728),t),i(r(76756),t),i(r(95701),t),i(r(41667),t),i(r(91760),t),i(r(98661),t),i(r(33952),t),i(r(96949),t)},24635:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},44225:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47357),t),i(r(24635),t)},34694:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deviceCommandsSlots=t.deviceQueriesSlots=void 0;const s=r(30504);t.deviceQueriesSlots={getAnonymousComputerId:(0,s.slot)(),getPlatformInfo:(0,s.slot)()},t.deviceCommandsSlots={cleanRemotelyRemovedProfiles:(0,s.slot)()}},88219:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(34694),t)},98792:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceLimitCapabilityConnector=void 0;const s=r(30504);t.DeviceLimitCapabilityConnector={deviceLimitCapabilityUpdated:(0,s.slot)()}},43245:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(98792),t)},99103:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},70242:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionCarbonConnector=void 0;const s=r(30504);t.ExtensionCarbonConnector={loginStatusChanged:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),deactivateDeviceResult:(0,s.slot)({noBuffer:!0}),changeDeviceNameResult:(0,s.slot)({noBuffer:!0}),accountFeaturesChanged:(0,s.slot)({noBuffer:!0}),webOnboardingModeUpdated:(0,s.slot)({noBuffer:!0}),askWebsiteInfo:(0,s.slot)({noBuffer:!0}),getAccountInfo:(0,s.slot)({noBuffer:!0}),getAnonymousLogsMetadata:(0,s.slot)({noBuffer:!0}),checkIfMasterPasswordIsValid:(0,s.slot)({noBuffer:!0}),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)({noBuffer:!0}),closeSession:(0,s.slot)({noBuffer:!0}),lockSession:(0,s.slot)({noBuffer:!0}),exceptionLog:(0,s.slot)({noBuffer:!0}),getDevicesList:(0,s.slot)({noBuffer:!0}),getLocalAccountsList:(0,s.slot)({noBuffer:!0}),deactivateDevice:(0,s.slot)({noBuffer:!0}),changeDeviceName:(0,s.slot)({noBuffer:!0}),updateWebOnboardingMode:(0,s.slot)({noBuffer:!0})}},28413:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(70242),t)},56376:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionDebugConnector=void 0;const s=r(30504);t.ExtensionDebugConnector={getExtensionId:(0,s.slot)(),switchExtensionToStandalone:(0,s.slot)(),showInput:(0,s.slot)(),showFormOnPage:(0,s.slot)(),signalTti:(0,s.slot)(),signalDatabasesSent:(0,s.slot)()}},13981:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionDebugEventType=void 0;const s=r(50415);t.ExtensionDebugEventType=(0,s.Enum)("GET_EXTENSION_ID","SIGNAL_TTI","DATABASES_SEND","SHOW_INPUT","SHOW_FORM_ON_PAGE","SWITCH_TO_STANDALONE")},91609:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(56376),t),i(r(13981),t)},21818:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.familyCommandsSlots=void 0;const s=r(30504);t.familyCommandsSlots={getFamilyDetails:(0,s.slot)(),joinFamily:(0,s.slot)(),leaveFamily:(0,s.slot)(),removeFamilyMember:(0,s.slot)(),resetFamilyJoinToken:(0,s.slot)()}},65005:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(21818),t),i(r(50647),t)},50647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FamilyRenewalPlatform=t.FamilyMemberRoles=t.FamilyStatusCode=t.JoinFamilyUserStatus=void 0,function(e){e.NEW_USER="NEW_USER",e.EXISTING_FREE_USER="EXISTING_FREE_USER",e.EXISTING_PREMIUM_USER="EXISTING_PREMIUM_USER"}(t.JoinFamilyUserStatus||(t.JoinFamilyUserStatus={})),function(e){e[e.DISCONTINUED=0]="DISCONTINUED",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_PLUS=2]="PREMIUM_PLUS"}(t.FamilyStatusCode||(t.FamilyStatusCode={})),t.FamilyMemberRoles=Object.freeze({ADMIN:"admin",REGULAR:"regular",REMOVED:"removed"}),function(e){e.IOS_APP_STORE="ios",e.MAC_STORE="mac",e.PLAY_STORE="playstore"}(t.FamilyRenewalPlatform||(t.FamilyRenewalPlatform={}))},33824:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.featureQueriesSlots=void 0;const s=r(30504);t.featureQueriesSlots={getHasFeature:(0,s.slot)(),getFeatures:(0,s.slot)()}},80898:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(78674),t),i(r(33824),t)},78674:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4126:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.remoteFilesLiveQueriesSlots=t.remoteFilesQueriesSlots=t.remoteFileCommandsSlots=void 0;const s=r(30504),i=r(72345);t.remoteFileCommandsSlots={decipherRemoteFile:(0,s.slot)()},t.remoteFilesQueriesSlots={getFileContent:(0,s.slot)()},t.remoteFilesLiveQueriesSlots={liveFileMeta:(0,i.liveSlot)()}},29450:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4126),t),i(r(46046),t)},46046:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileNamesList=t.SERVER_ERROR_HTTP_STATUS=t.UNSPECIFIED_ERROR=t.FILE_NOT_UPDATED=t.FILE_NOT_FOUND_HTTP_STATUS=t.NO_CURRENT_UPDATE_HTTP_STATUS=t.UPDATE_AVAILABLE_HTTP_STATUS=void 0,t.UPDATE_AVAILABLE_HTTP_STATUS="update_available",t.NO_CURRENT_UPDATE_HTTP_STATUS="unknown_revision",t.FILE_NOT_FOUND_HTTP_STATUS="not_found",t.FILE_NOT_UPDATED="not_updated",t.UNSPECIFIED_ERROR="unspecified_error",t.SERVER_ERROR_HTTP_STATUS="error_server",t.FileNamesList=["phishing_urls_test.json"]},44605:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalExtensionSettingsCommandsSlots=void 0;const s=r(30504);t.globalExtensionSettingsCommandsSlots={setGlobalExtensionSettings:(0,s.slot)(),getGlobalExtensionSettings:(0,s.slot)()}},96035:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(44605),t),i(r(73054),t)},73054:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},15044:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.healthCommandsSlots=void 0;const s=r(30504);t.healthCommandsSlots={evaluatePassword:(0,s.slot)()}},6666:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(15044),t),i(r(14836),t)},14836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},24875:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(38561),t)},38561:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.killswitchLiveQueriesSlots=t.killswitchQueriesSlots=void 0;const s=r(30504),i=r(72345);t.killswitchQueriesSlots={getIsBrazeContentDisabled:(0,s.slot)(),getIsLoginFlowMigrationDisabled:(0,s.slot)(),getIsAutoSSOLoginDisabled:(0,s.slot)()},t.killswitchLiveQueriesSlots={liveIsBrazeContentDisabled:(0,i.liveSlot)(),liveIsLoginFlowMigrationDisabled:(0,i.liveSlot)(),liveIsAutoSSOLoginDisabled:(0,i.liveSlot)()}},28730:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonLeelooConnector=void 0;const s=r(30504);t.CarbonLeelooConnector={abTestingChanged:(0,s.slot)(),loginStatusChanged:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)(),spaceDataUpdated:(0,s.slot)(),teamAdminDataUpdated:(0,s.slot)(),deactivateDeviceResult:(0,s.slot)(),changeDeviceNameResult:(0,s.slot)(),accountFeaturesChanged:(0,s.slot)(),updatePaymentCardTokenResult:(0,s.slot)(),webOnboardingModeUpdated:(0,s.slot)(),currentLocationUpdated:(0,s.slot)(),checkDirectorySyncKeyRequest:(0,s.slot)(),serverSidePairingStatusChanged:(0,s.slot)(),getUki:(0,s.slot)(),getAccountInfo:(0,s.slot)(),getDevicesList:(0,s.slot)(),getLocalAccountsList:(0,s.slot)(),deactivateDevice:(0,s.slot)(),changeDeviceName:(0,s.slot)(),getInvoices:(0,s.slot)(),getPersonalSettings:(0,s.slot)(),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)(),closeSession:(0,s.slot)(),lockSession:(0,s.slot)({noBuffer:!0}),cancelPremiumSubscription:(0,s.slot)(),createUserGroup:(0,s.slot)(),deleteUserGroup:(0,s.slot)(),renameUserGroup:(0,s.slot)(),inviteUserGroupMembers:(0,s.slot)(),revokeUserGroupMembers:(0,s.slot)(),updateUserGroupMembers:(0,s.slot)(),teamUpdated:(0,s.slot)(),createAccountStep1:(0,s.slot)(),createAccountStep2:(0,s.slot)(),checkLogin:(0,s.slot)(),savePersonalDataItem:(0,s.slot)(),removePersonalDataItem:(0,s.slot)(),savePaymentCard:(0,s.slot)(),getMasterPasswordResetDemandList:(0,s.slot)(),acceptMasterPasswordResetDemand:(0,s.slot)(),checkIfMasterPasswordIsValid:(0,s.slot)(),declineMasterPasswordResetDemand:(0,s.slot)(),getMembers:(0,s.slot)(),addTeamAdmin:(0,s.slot)(),removeTeamAdmin:(0,s.slot)(),setTeamSettings:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)(),checkDirectorySyncKeyResponse:(0,s.slot)(),queryStaticDataCollections:(0,s.slot)(),resumeSession:(0,s.slot)(),exceptionLog:(0,s.slot)()}},17317:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(28730),t),i(r(31291),t)},31291:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RemovePersonalDataItemFailureReason=void 0,function(e){e[e.LEAVE_SHARING_FAILED=0]="LEAVE_SHARING_FAILED",e[e.FORBIDDEN_LAST_ADMIN=1]="FORBIDDEN_LAST_ADMIN",e[e.FORBIDDEN_GROUP_ITEM=2]="FORBIDDEN_GROUP_ITEM",e[e.NOT_AUTHORIZED=3]="NOT_AUTHORIZED",e[e.NOT_FOUND=4]="NOT_FOUND",e[e.INTERNAL_ERROR=5]="INTERNAL_ERROR"}(t.RemovePersonalDataItemFailureReason||(t.RemovePersonalDataItemFailureReason={}))},29182:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.eventLoggerCommandsSlots=void 0;const s=r(30504);t.eventLoggerCommandsSlots={logEvent:(0,s.slot)(),logPageView:(0,s.slot)()}},15925:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29182),t),i(r(40035),t)},40035:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StyxApiResult=void 0,function(e){e[e.AllBatchesSent=0]="AllBatchesSent",e[e.SomeBatchesSent=1]="SomeBatchesSent",e[e.NoBatchesSent=2]="NoBatchesSent"}(t.StyxApiResult||(t.StyxApiResult={}))},63054:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exceptionCommandsSlots=void 0;const s=r(30504);t.exceptionCommandsSlots={logException:(0,s.slot)()}},68183:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(63054),t),i(r(96103),t)},96103:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionCriticality=void 0,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(t.ExceptionCriticality||(t.ExceptionCriticality={}))},87940:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationBuildType=t.LoggingEventType=void 0;const s=r(50415);t.LoggingEventType=(0,s.Enum)("EXCEPTION_LOG");var i=r(90693);Object.defineProperty(t,"ApplicationBuildType",{enumerable:!0,get:function(){return i.ApplicationBuildType}})},6768:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(65063),t),i(r(24309),t)},65063:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginCommandsSlots=void 0;const s=r(30504);t.loginCommandsSlots={abortDeviceLimitFlow:(0,s.slot)(),loginViaSSO:(0,s.slot)(),unlinkPreviousDevice:(0,s.slot)(),unlinkMultipleDevices:(0,s.slot)()}},24309:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoginViaSsoCode=t.SsoMigrationServerMethod=t.LoginResultEnum=void 0,function(e){e[e.MasterPasswordMissing=0]="MasterPasswordMissing",e[e.DeviceAuthenticationMissing=1]="DeviceAuthenticationMissing",e[e.TokenMissing=2]="TokenMissing",e[e.OTPMissing=3]="OTPMissing",e[e.AskPersistData=4]="AskPersistData",e[e.LoggedIn=5]="LoggedIn",e[e.ExtraDeviceTokenMissing=6]="ExtraDeviceTokenMissing",e[e.SSOLogin=7]="SSOLogin",e[e.DeviceLimitFlow=8]="DeviceLimitFlow",e[e.DashlaneAuthenticatorApprovalMissing=9]="DashlaneAuthenticatorApprovalMissing",e[e.DashlaneAuthenticatorApprovalCancelled=10]="DashlaneAuthenticatorApprovalCancelled",e[e.MasterPasswordLess=11]="MasterPasswordLess"}(t.LoginResultEnum||(t.LoginResultEnum={})),function(e){e.SSO="sso",e.MP="master_password"}(t.SsoMigrationServerMethod||(t.SsoMigrationServerMethod={})),function(e){e.SUCCESS="SUCCESS",e.ASK_NEW_MP="ASK_NEW_MP",e.EMPTY_LOGIN="EMPTY_LOGIN",e.INNACTIVE_SESSION="INNACTIVE_SESSION",e.SSO_VERIFICATION_FAILED="SSO_VERIFICATION_FAILED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED_TRANSITION="UNSUPPORTED_TRANSITION",e.WRONG_PASSWORD="WRONG_PASSWORD",e.SSO_LOGIN_CORRUPT="SSO_LOGIN_CORRUPT"}(t.LoginViaSsoCode||(t.LoginViaSsoCode={}))},58290:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(23903),t),i(r(53168),t)},53168:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginNotificationsLiveQueriesSlots=t.loginNotificationsQueriesSlots=t.loginNotificationsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.loginNotificationsCommandsSlots={addLoginNotification:(0,s.slot)(),clearAllStoredLoginNotification:(0,s.slot)()},t.loginNotificationsQueriesSlots={getLoginNotifications:(0,s.slot)()},t.loginNotificationsLiveQueriesSlots={liveLoginNotifications:(0,i.liveSlot)()}},23903:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoginNotificationType=void 0,function(e){e.RELOGIN_NEEDED="RELOGIN_NEEDED",e.SSO_FEATURE_BLOCKED="SSO_FEATURE_BLOCKED",e.SSO_SETUP_ERROR="SSO_SETUP_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.TEAM_ACCEPTANCE_SUCCESS="TEAM_ACCEPTANCE_SUCCESS",e.TEAM_ACCEPTANCE_ERROR="TEAM_ACCEPTANCE_ERROR"}(t.LoginNotificationType||(t.LoginNotificationType={}))},78779:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(12249),t),i(r(3455),t)},12249:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginStepInfoLiveQueriesSlots=t.loginStepInfoQueriesSlots=t.loginStepInfoCommandsSlots=void 0;const s=r(30504),i=r(72345);t.loginStepInfoCommandsSlots={updateLoginStepInfo:(0,s.slot)(),resetLoginStepInfo:(0,s.slot)()},t.loginStepInfoQueriesSlots={getLoginStepInfo:(0,s.slot)()},t.loginStepInfoLiveQueriesSlots={liveLoginStepInfo:(0,i.liveSlot)()}},3455:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoginStep=void 0,function(e){e.Email="email",e.Welcome="welcome",e.OTP1="OTP1",e.OTP2="OTP2",e.BackupCodeOTP1="backupCodeOTP1",e.BackupCodeOTP2="backupCodeOTP2",e.OTPToken="token",e.Password="password",e.SSO="SSO",e.ActivateSSO="activateSSO",e.WebAuthn="webAuthn",e.WebAuthnError="webAuthnError",e.DeviceLimitReached="deviceLimitReached",e.DashlaneAuthenticator="dashlaneAuthenticator",e.PasswordLess="passwordLess"}(t.LoginStep||(t.LoginStep={}))},66478:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},48905:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},25460:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonMaverickConnector=void 0;const s=r(30504);t.CarbonMaverickConnector={savePersonalDataItem:(0,s.slot)(),filledDataItem:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)()}},98521:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(25460),t),i(r(58962),t)},58962:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},37174:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5264),t),i(r(28155),t)},28155:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.notificationsLiveQueriesSlots=t.notificationsQueriesSlots=t.notificationsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.notificationsCommandsSlots={markNotificationAsInteracted:(0,s.slot)(),markNotificationAsSeen:(0,s.slot)(),markNotificationAsUnseen:(0,s.slot)()},t.notificationsQueriesSlots={getNotificationStatus:(0,s.slot)()},t.notificationsLiveQueriesSlots={liveNotificationStatus:(0,i.liveSlot)()}},5264:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationStatus=t.NotificationName=void 0,function(e){e.PaymentFailureChurning="paymentFailureChurning",e.PaymentFailureChurned="paymentFailureChurned",e.SwitchToMlAnalysisEngine="switchToMlAnalysisEngine",e.DWMb2bAutoEnrollTooltip="dWMb2bAutoEnrollTooltip",e.TacGetTheExtensionBanner="tacGetTheExtensionBanner",e.TacEnableAccountRecoveryBanner="tacEnableAccountRecoveryBanner",e.TacOnlyOneAdminBanner="tacOnlyOneAdminBanner",e.TacDarkWebInsightsNewBadge="tacDarkWebInsightsNewBadge",e.PasswordHistoryBanner="passwordHistoryBanner",e.SharingCenterDisabledBanner="sharingCenterDisabledBanner",e.AccountRecoveryAvailableAdminTooltip="accountRecoveryAvailableAdminTooltip",e.AccountRecoveryAvailableEmployeeDialog="accountRecoveryAvailableEmployeeDialog",e.ActivateInviteLink="activateInviteLink",e.MpToSsoMigrationDoneDialog="mpToSsoMigrationDoneDialog"}(t.NotificationName||(t.NotificationName={})),function(e){e.Interacted="interacted",e.Seen="seen",e.Unseen="unseen"}(t.NotificationStatus||(t.NotificationStatus={}))},36632:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(58355),t)},58355:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebOnboardingPopoverStep=t.WebOnboardingLeelooStep=void 0;const s=r(50415);t.WebOnboardingLeelooStep=(0,s.Enum)("SHOW_LOGIN_USING_EXTENSION_NOTIFICATION","SHOW_SAVE_SITES_DIALOG","SHOW_PASSWORD_SAVE_SUCCESS","SHOW_WEB_SAVE_AND_AUTOLOGIN_COMPLETED","SHOW_PASSWORD_IMPORT","SHOW_GET_MOBILE_DIALOG"),t.WebOnboardingPopoverStep=(0,s.Enum)("SHOW_LOGIN_NOTIFICATION")},24281:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Platform=void 0,function(e){e[e.Android=0]="Android",e[e.CarbonTests=1]="CarbonTests",e[e.CarbonUnknown=2]="CarbonUnknown",e[e.DesktopLegacyMacOS=3]="DesktopLegacyMacOS",e[e.DesktopLegacyWindows=4]="DesktopLegacyWindows",e[e.DesktopUWP=5]="DesktopUWP",e[e.IPad=6]="IPad",e[e.IPhone=7]="IPhone",e[e.IPod=8]="IPod",e[e.StandaloneExtension=9]="StandaloneExtension",e[e.TeamAdminConsole=10]="TeamAdminConsole",e[e.WebApp=11]="WebApp",e[e.WebAppDev=12]="WebAppDev"}(t.Platform||(t.Platform={}))},68557:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformView=void 0,function(e){e.Android="android",e.DesktopMacOS="macosx",e.DesktopWindows="windows",e.IPad="ipad",e.IPhone="iphone",e.IPod="ipod",e.Other="other",e.StandaloneExtension="saex",e.TeamAdminConsole="tac",e.WebApp="webapp"}(t.PlatformView||(t.PlatformView={}))},54982:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LoginDeviceLimitFlowStage=void 0,function(e){e.OneDeviceLimitReached="OneDeviceLimitReached",e.MultipleDevicesLimitReached="MultipleDevicesLimitReached",e.UnlinkingAndOpeningSession="UnlinkingAndOpeningSession",e.UnlinkingMultipleDevicesError="UnlinkingMultipleDevicesError",e.RefreshingDeviceLimitStatus="RefreshingDeviceLimitStatus",e.OpeningSessionAfterDeviceLimitRemoval="OpeningSessionAfterDeviceLimitRemoval",e.DeviceLimitDone="DeviceLimitDone"}(t.LoginDeviceLimitFlowStage||(t.LoginDeviceLimitFlowStage={}))},38340:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},43556:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbortDeviceLimitFlowError=void 0,function(e){e.UnexpectedError="UNEXPECTED_ERROR"}(t.AbortDeviceLimitFlowError||(t.AbortDeviceLimitFlowError={}))},96197:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(43556),t),i(r(93522),t),i(r(44270),t),i(r(54982),t),i(r(38340),t),i(r(68557),t),i(r(61445),t),i(r(53240),t),i(r(24281),t)},93522:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UNEXPECTED_ERROR=t.USER_STILL_OVERFLOWING=void 0,t.USER_STILL_OVERFLOWING="USER_STILL_OVERFLOWING",t.UNEXPECTED_ERROR="UNEXPECTED_ERROR"},53240:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},44270:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnlinkPreviousDeviceError=void 0,function(e){e.UnexpectedError="UNEXPECTED_ERROR"}(t.UnlinkPreviousDeviceError||(t.UnlinkPreviousDeviceError={}))},61445:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},84369:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deviceLimitLiveSlots=t.deviceLimitSlots=void 0;const s=r(30504),i=r(72345);t.deviceLimitSlots={getLoginDeviceLimitFlow:(0,s.slot)()},t.deviceLimitLiveSlots={liveLoginDeviceLimitFlow:(0,i.liveSlot)()}},76758:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(26749),t)},89391:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.twoFactorStatusLiveSlots=t.twoFactorStatusSlots=void 0;const s=r(30504),i=r(72345);t.twoFactorStatusSlots={getTwoFactorAuthenticationInfo:(0,s.slot)()},t.twoFactorStatusLiveSlots={liveTwoFactorAuthenticationInfo:(0,i.liveSlot)()}},26749:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ENFORCE_TWO_FACTOR_AUTHENTICATION_ENABLED_VALUES=t.TwoFactorAuthenticationInfoRequestStatus=t.TwoFactorAuthenticationType=void 0,function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(t.TwoFactorAuthenticationType||(t.TwoFactorAuthenticationType={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(t.TwoFactorAuthenticationInfoRequestStatus||(t.TwoFactorAuthenticationInfoRequestStatus={})),function(e){e.LOGIN="login",e.NEW_DEVICE="newDevice",e.DISABLED="disabled"}(r||(r={})),t.ENFORCE_TWO_FACTOR_AUTHENTICATION_ENABLED_VALUES=[r.LOGIN,r.NEW_DEVICE]},60687:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(89884),t),i(r(22574),t),i(r(96197),t),i(r(76758),t)},22574:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.openSessionCommandsSlots=t.openSessionLiveQueriesSlots=t.openSessionQueriesSlots=void 0;const s=r(30504),i=r(72345),o=r(84369),a=r(89391);t.openSessionQueriesSlots={getLoginStatus:(0,s.slot)(),getLocalAccounts:(0,s.slot)(),getIsSSOUser:(0,s.slot)(),getSSOMigrationInfo:(0,s.slot)(),getSessionInfo:(0,s.slot)(),getMasterPasswordAndServerKey:(0,s.slot)(),getUserCryptoSettings:(0,s.slot)(),getSyncInfo:(0,s.slot)(),getIsSyncInProgress:(0,s.slot)(),getPremiumStatus:(0,s.slot)(),getNodePremiumStatus:(0,s.slot)(),getSubscriptionInformation:(0,s.slot)(),getActiveSpaces:(0,s.slot)(),getSSOProviderInfo:(0,s.slot)(),getUserLogin:(0,s.slot)(),getPublicUserId:(0,s.slot)(),getAnalyticsInstallationId:(0,s.slot)(),getUserLoginStatus:(0,s.slot)(),getWebOnboardingMode:(0,s.slot)(),getIsPaymentFailureChurningDismissed:(0,s.slot)(),getCredentialSearchOrder:(0,s.slot)(),getDidOpen:(0,s.slot)(),getPlatformName:(0,s.slot)(),getAccountAuthenticationType:(0,s.slot)(),...o.deviceLimitSlots,...a.twoFactorStatusSlots},t.openSessionLiveQueriesSlots={liveLoginStatus:(0,i.liveSlot)(),liveDidOpen:(0,i.liveSlot)(),liveIsSSOUser:(0,i.liveSlot)(),liveSSOMigrationInfo:(0,i.liveSlot)(),liveSessionInfo:(0,i.liveSlot)(),liveSyncInfo:(0,i.liveSlot)(),liveIsSyncInProgress:(0,i.liveSlot)(),livePremiumStatus:(0,i.liveSlot)(),liveServiceProviderUrl:(0,i.liveSlot)(),liveWebOnboardingMode:(0,i.liveSlot)(),liveSubscriptionInformation:(0,i.liveSlot)(),...o.deviceLimitLiveSlots,...a.twoFactorStatusLiveSlots},t.openSessionCommandsSlots={validateToken:(0,s.slot)(),validateMasterPassword:(0,s.slot)(),resetProtectedItemAutofillTimer:(0,s.slot)(),forceSync:(0,s.slot)(),updatePremiumChurningDismissDate:(0,s.slot)(),setCredentialSearchOrder:(0,s.slot)(),refreshSubscriptionInformation:(0,s.slot)(),updateAccountRecoveryKeyPersonalSettings:(0,s.slot)()}},89884:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialSearchOrder=t.SSOMigrationType=t.SpaceStatus=t.SpaceTiers=t.B2CPlanFeatures=t.SyncStatuses=t.ServerSidePairingStatus=t.possibleAdminPermissions=t.groupPermissions=t.PlanTypes=t.PremiumLogTypes=t.CapabilityKeys=t.PremiumStatusCode=void 0,function(e){e[e.NO_PREMIUM=0]="NO_PREMIUM",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_CANCELLED=2]="PREMIUM_CANCELLED",e[e.OLD_ACCOUNT=3]="OLD_ACCOUNT",e[e.NEW_USER=4]="NEW_USER",e[e.GRACE_PERIOD=5]="GRACE_PERIOD"}(t.PremiumStatusCode||(t.PremiumStatusCode={})),t.CapabilityKeys=["adminPolicies","autofillWithPhishingPrevention","collectionSharing","creditMonitoring","dataLeak","devicesLimit","identityRestoration","identityTheftProtection","multipleAccounts","passwordsLimit","phoneSupport","secretManagement","secureFiles","secureNotes","secureWiFi","securityBreach","sharingLimit","sync","yubikey","scim","sso","collectionSharing"],t.PremiumLogTypes=Object.freeze({freeTrialGranted:"free_trial_granted",premiumGranted:"premium_granted",renewed:"renewed",subscribed:"subscribed",crosssellPurchased:"crosssell_purchased",setAsLegacy:"set_as_legacy",familyCreated:"family_created",familyRenewed:"family_renewed"}),t.PlanTypes=Object.freeze({Amazon:"amazon",FreeTrial:"free_trial",Invoice:"invoice",IOS:"ios",IOSRenewable:"ios_renewable",Legacy:"legacy",Mac:"mac",MacRenewable:"mac_renewable",Offer:"offer",Partner:"partner",Paypal:"paypal",PaypalRenewable:"paypal_renewable",Playstore:"playstore",PlaystoreRenewable:"playstore_renewable",Stripe:"stripe"}),t.groupPermissions=["GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"],t.possibleAdminPermissions=["FULL","BILLING",...t.groupPermissions],function(e){e[e.UNPAIRED=0]="UNPAIRED",e[e.PAIRED=1]="PAIRED"}(t.ServerSidePairingStatus||(t.ServerSidePairingStatus={})),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(t.SyncStatuses||(t.SyncStatuses={})),function(e){e.not_in_team="not_in_team",e.proposed="proposed",e.in_team="in_team"}(r||(r={})),t.B2CPlanFeatures=Object.freeze({Premium:"premium",Essentials:"essentials",Premiumplus:"premiumplus",BackupForAll:"backup-for-all"}),t.SpaceTiers=Object.freeze({Team:"team",Business:"business",Legacy:"legacy",Entreprise:"entreprise",Free:"free",Starter:"starter",Standard:"standard"}),function(e){e.Accepted="accepted",e.Pending="pending",e.Proposed="proposed",e.Refused="refused",e.Removed="removed",e.Revoked="revoked",e.Unproposed="unproposed"}(t.SpaceStatus||(t.SpaceStatus={})),function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(t.SSOMigrationType||(t.SSOMigrationType={})),function(e){e.NAME="name",e.DATE="date"}(t.CredentialSearchOrder||(t.CredentialSearchOrder={}))},77277:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(20188),t),i(r(59417),t)},20188:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passwordGeneratorQueriesSlots=t.passwordGeneratorCommandsSlots=void 0;const s=r(30504);t.passwordGeneratorCommandsSlots={generatePassword:(0,s.slot)(),generateAndSavePassword:(0,s.slot)(),savePasswordGenerationSettings:(0,s.slot)()},t.passwordGeneratorQueriesSlots={getPasswordGenerationSettings:(0,s.slot)()}},59417:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},49106:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(54841),t),i(r(77492),t)},54841:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.paymentsQueriesSlots=t.paymentsCommandsSlots=void 0;const s=r(30504);t.paymentsCommandsSlots={cancelAutoRenew:(0,s.slot)(),downloadCustomerInvoice:(0,s.slot)(),fetchInvoiceList:(0,s.slot)(),requestRefund:(0,s.slot)()},t.paymentsQueriesSlots={getInvoicesCount:(0,s.slot)(),getInvoiceList:(0,s.slot)(),getInvoiceListYears:(0,s.slot)()}},77492:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDir=void 0,function(e){e.ascending="ascending",e.descending="descending"}(t.OrderDir||(t.OrderDir={}))},68440:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(53379),t),i(r(84493),t)},53379:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.protectedItemsUnlockerLiveQueriesSlots=t.protectedItemsUnlockerQueriesSlots=t.protectedItemsUnlockerCommandsSlots=void 0;const s=r(30504),i=r(72345);t.protectedItemsUnlockerCommandsSlots={disableCredentialProtection:(0,s.slot)(),unlockProtectedItems:(0,s.slot)()},t.protectedItemsUnlockerQueriesSlots={vaultLockDate:(0,s.slot)()},t.protectedItemsUnlockerLiveQueriesSlots={liveVaultLockDate:(0,i.liveSlot)()}},84493:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisableCredentialProtectionStatus=t.unlockProtectedItemsWrongPasswordError=t.UnlockProtectedItemsStatus=void 0,function(e){e.SUCCESS="success",e.ERROR="error"}(t.UnlockProtectedItemsStatus||(t.UnlockProtectedItemsStatus={})),t.unlockProtectedItemsWrongPasswordError="WRONG PASSWORD",function(e){e.SUCCESS="success",e.ERROR="error"}(t.DisableCredentialProtectionStatus||(t.DisableCredentialProtectionStatus={}))},34852:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(36569),t),i(r(6461),t)},36569:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recoveryLiveQueriesSlots=t.recoveryQueriesSlots=t.recoveryCommandsSlots=void 0;const s=r(30504),i=r(72345);t.recoveryCommandsSlots={activateAccountRecovery:(0,s.slot)(),setupMasterPasswordForRecovery:(0,s.slot)(),deactivateAccountRecovery:(0,s.slot)(),registerDeviceForRecovery:(0,s.slot)(),startAccountRecovery:(0,s.slot)(),sendRecoveryRequest:(0,s.slot)(),cancelRecoveryRequest:(0,s.slot)(),checkRecoveryRequestStatus:(0,s.slot)(),recoverUserData:(0,s.slot)(),checkDoesLocalRecoveryKeyExist:(0,s.slot)(),isRecoveryRequestPending:(0,s.slot)()},t.recoveryQueriesSlots={getRecoveryOptInSetting:(0,s.slot)(),getShouldShowFeatureActivationModal:(0,s.slot)(),getAccountRecoveryRequestCount:(0,s.slot)()},t.recoveryLiveQueriesSlots={liveAccountRecoveryRequestCount:(0,i.liveSlot)()}},6461:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestStatus=t.RecoveryApiErrorType=void 0,function(e){e.CheckRecoveryStatusFailed="CHECK_RECOVERY_STATUS_FAILED",e.RecoverySetupFailed="RECOVERY_SETUP_FAILED",e.RecoveryDeactivationFailed="RECOVERY_DEACTIVATION_FAILED",e.RecoveryRequestFailed="RECOVERY_REQUEST_FAILED",e.RegisterDeviceFailed="REGISTER_DEVICE_FAILED",e.SetupMasterPasswordForRecoveryFailed="SETUP_MASTERPASSWORD_FOR_RECOVERY_FAILED",e.CancelRecoveryRequestFailed="CANCEL_RECOVERY_REQUEST_FAILED",e.RecoverUserDataFailed="RECOVER_REQUEST_FAILED",e.CheckLocalRecoveryKeyFailed="CHECK_LOCAL_RECOVERY_KEY_FAILED",e.StartAccountRecoveryFailed="START_ACCOUNT_RECOVERY_FAILED",e.AccountRecoveryNotAvailableError="ACCOUNT_RECOVERY_NOT_AVAILABLE_ERROR",e.IsRecoveryRequestPendingFailed="IS_RECOVERY_REQUEST_PENDING_FAILED"}(t.RecoveryApiErrorType||(t.RecoveryApiErrorType={})),function(e){e.PENDING="PENDING",e.APPROVED="APPROVED",e.REFUSED="REFUSED",e.OVERRIDDEN="OVERRIDDEN",e.CANCELED="CANCELED"}(t.RequestStatus||(t.RequestStatus={}))},54205:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPIPersonalWebsiteEvent=t.isPIEmailEvent=t.isPICompanyEvent=t.isPIAddressEvent=t.isPIPhoneEvent=t.isPIIdentityEvent=t.isPersonalInfoEvent=t.SaveOrigin=void 0,function(e){e.MANUAL="MANUAL",e.MAV_DATACAPTURE="MAV_DATACAPTURE",e.MAV_SAVE_CREDENTIAL="MAV_SAVE_CREDENTIAL",e.IMPORT="IMPORT"}(t.SaveOrigin||(t.SaveOrigin={})),t.isPersonalInfoEvent=function(e){return["KWCompany","KWEmail","KWPersonalWebsite","KWIdentity","KWAddress","KWPhone"].some((t=>Boolean(e)&&e.kwType===t))},t.isPIIdentityEvent=function(e){return Boolean(e)&&"KWIdentity"===e.kwType},t.isPIPhoneEvent=function(e){return Boolean(e)&&"KWPhone"===e.kwType},t.isPIAddressEvent=function(e){return Boolean(e)&&"KWAddress"===e.kwType},t.isPICompanyEvent=function(e){return Boolean(e)&&"KWCompany"===e.kwType},t.isPIEmailEvent=function(e){return Boolean(e)&&"KWEmail"===e.kwType},t.isPIPersonalWebsiteEvent=function(e){return Boolean(e)&&"KWPersonalWebsite"===e.kwType}},19635:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(54205),t)},12891:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},99714:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShareItemFailureReason=t.isGroupRecipient=t.isUserRecipient=void 0,t.isUserRecipient=function(e){return Boolean(e)&&"user"===e.type},t.isGroupRecipient=function(e){return Boolean(e)&&"userGroup"===e.type},function(e){e[e.ITEM_DOESNT_EXIST=0]="ITEM_DOESNT_EXIST",e[e.LIMIT_EXCEEDED=1]="LIMIT_EXCEEDED",e[e.ITEM_HAS_ATTACHMENTS=2]="ITEM_HAS_ATTACHMENTS",e[e.SHARING_FAILED=3]="SHARING_FAILED"}(t.ShareItemFailureReason||(t.ShareItemFailureReason={}))},18497:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},59296:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},82130:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(59296),t),i(r(18497),t),i(r(99714),t)},31525:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(82130),t),i(r(57926),t),i(r(75841),t)},57926:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sharingCommandsSlots=t.sharingLiveQueriesSlots=t.sharingQueriesSlots=void 0;const s=r(30504),i=r(72345);t.sharingQueriesSlots={getAllSharedItemIds:(0,s.slot)(),getMyAcceptedUserGroups:(0,s.slot)(),getSharingCapacity:(0,s.slot)(),getUserGroups:(0,s.slot)(),getUserGroup:(0,s.slot)(),getUserGroupMembers:(0,s.slot)(),getSharingUsers:(0,s.slot)(),getSharingUserPermissionLevel:(0,s.slot)()},t.sharingLiveQueriesSlots={liveAllSharedItemIds:(0,i.liveSlot)(),liveMyAcceptedUserGroups:(0,i.liveSlot)(),liveSharingCapacity:(0,i.liveSlot)(),liveUserGroups:(0,i.liveSlot)(),liveSharingUsers:(0,i.liveSlot)(),liveSharingUserPermissionLevel:(0,i.liveSlot)()},t.sharingCommandsSlots={convertItemToDashlaneXml:(0,s.slot)(),convertDashlaneXmlToItem:(0,s.slot)(),shareItem:(0,s.slot)()}},75841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},58575:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},84470:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},74226:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},60292:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StaticDataQueryType=void 0,function(e){e[e.CALLING_CODES=0]="CALLING_CODES",e[e.GEOGRAPHIC_STATES=1]="GEOGRAPHIC_STATES"}(t.StaticDataQueryType||(t.StaticDataQueryType={}))},58462:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GeographicStateLevel=void 0,function(e){e[e.LEVEL_0=0]="LEVEL_0",e[e.LEVEL_1=1]="LEVEL_1"}(t.GeographicStateLevel||(t.GeographicStateLevel={}))},98655:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.StaticDataQueryType=void 0;var o=r(60292);Object.defineProperty(t,"StaticDataQueryType",{enumerable:!0,get:function(){return o.StaticDataQueryType}}),i(r(74226),t),i(r(58462),t),i(r(35324),t),i(r(78017),t)},78017:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.staticDataQueriesSlots=void 0;const s=r(30504);t.staticDataQueriesSlots={getAllBanks:(0,s.slot)(),getAllCallingCodes:(0,s.slot)(),getBanks:(0,s.slot)(),getSecureDocumentsExtensionsList:(0,s.slot)()}},35324:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1659:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9987:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(84797),t),i(r(77030),t)},84797:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.teamCommandsSlots=t.teamQueriesSlots=void 0;const s=r(30504);t.teamQueriesSlots={getIsRecoveryEnabled:(0,s.slot)()},t.teamCommandsSlots={getTeamInfo:(0,s.slot)(),computePlanPricing:(0,s.slot)()}},77030:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ComputePlanPricingErrorType=void 0,function(e){e.ComputePlanPricingFailed="COMPUTE_PLAN_PRICING_FAILED",e.NotBillingAdmin="NOT_BILLING_ADMIN"}(t.ComputePlanPricingErrorType||(t.ComputePlanPricingErrorType={}))},83891:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetAuditLogQueryResultsStates=t.ApiAuditLogsErrorType=void 0,function(e){e.StartAuditLogsQueryFailed="START_AUDIT_LOGS_QUERY_FAILED",e.GetAuditLogQueryResultsFailed="GET_AUDIT_LOG_QUERY_RESULTS_FAILED"}(t.ApiAuditLogsErrorType||(t.ApiAuditLogsErrorType={})),t.GetAuditLogQueryResultsStates=Object.freeze({Queued:"QUEUED",Running:"RUNNING",Succeeded:"SUCCEEDED",Failed:"FAILED",Cancelled:"CANCELLED"})},76198:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TeamDevicePlatform=void 0,function(e){e.SSO_CONNECTOR="sso_connector",e.ENCRYPTION_SERVICE="encryption_service",e.NITRO="nitro_encryption_service"}(t.TeamDevicePlatform||(t.TeamDevicePlatform={}))},56254:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},31197:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DomainStatus=t.DomainStatusResponses=void 0,t.DomainStatusResponses=Object.freeze({pending:"pending",valid:"valid",expired:"expired",invalid:"invalid"}),t.DomainStatus=t.DomainStatusResponses},62236:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionServiceRestartStatusCodes=void 0,t.EncryptionServiceRestartStatusCodes=Object.freeze({OK:"OK",ES_UNREACHABLE:"ES_UNREACHABLE",ES_CONFIG_RELOAD_FAILURE:"ES_CONFIG_RELOAD_FAILURE",ES_INTERNAL_NETWORK_ERROR:"ES_INTERNAL_NETWORK_ERROR"})},59226:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DomainDeletionFailed=t.DomainCannotBeDeactivated=t.DomainNotFound=t.DomainCannotContainUppercaseLetters=t.DomainNotValidForTeam=t.DomainContainsNonTeamUsers=t.InvalidPublicDomain=t.DomainAlreadyExists=t.TeamDoesNotExist=t.ServerError=t.InsufficientTier=t.TeamDeviceEncryptedConfigNotFound=t.InvalidTeamDeviceLogin=t.InvalidRequestError=t.DeviceAccountMappingAlreadyExists=t.DeviceKeyNotFound=t.UnknownTeamAdminError=t.NotAdmin=t.DeactivatedTeamDevice=t.BasicConfigNotFound=void 0,t.BasicConfigNotFound="BASIC_CONFIGURATION_NOT_FOUND",t.DeactivatedTeamDevice="DEACTIVATED_TEAM_DEVICE",t.NotAdmin="NOT_ADMIN",t.UnknownTeamAdminError="UNKNOWN_ERROR",t.DeviceKeyNotFound="DEVICE_KEY_NOT_FOUND",t.DeviceAccountMappingAlreadyExists="DEVICE_ACCOUNT_MAPPING_ALREADY_EXISTS",t.InvalidRequestError="invalid_request_error",t.InvalidTeamDeviceLogin="INVALID_TEAM_DEVICE_LOGIN",t.TeamDeviceEncryptedConfigNotFound="TEAM_DEVICE_CONFIGURATION_NOT_FOUND",t.InsufficientTier="INSUFFICIENT_TIER",t.ServerError="server_error",t.TeamDoesNotExist="TEAM_DOES_NOT_EXIST",t.DomainAlreadyExists="DOMAIN_ALREADY_EXISTS",t.InvalidPublicDomain="INVALID_PUBLIC_DOMAIN",t.DomainContainsNonTeamUsers="DOMAIN_CONTAINS_EXISTING_NONTEAM_USERS",t.DomainNotValidForTeam="DOMAIN_NOT_VALID_FOR_TEAM",t.DomainCannotContainUppercaseLetters="DOMAIN_CANNOT_CONTAIN_UPPERCASE_LETTERS",t.DomainNotFound="DOMAIN_NOT_FOUND",t.DomainCannotBeDeactivated="DOMAIN_CANNOT_BE_DEACTIVATED",t.DomainDeletionFailed="DOMAIN_DELETION_FAILED"},57369:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownTeamAdminError=t.TeamDeviceEncryptedConfigNotFound=void 0;var o=r(59226);Object.defineProperty(t,"TeamDeviceEncryptedConfigNotFound",{enumerable:!0,get:function(){return o.TeamDeviceEncryptedConfigNotFound}}),Object.defineProperty(t,"UnknownTeamAdminError",{enumerable:!0,get:function(){return o.UnknownTeamAdminError}}),i(r(9825),t),i(r(83891),t),i(r(76198),t),i(r(56254),t),i(r(31197),t),i(r(62236),t),i(r(36471),t),i(r(34059),t),i(r(17023),t),i(r(21310),t),i(r(15770),t),i(r(10434),t),i(r(53863),t)},36471:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InviteLinkResponseErrorCode=void 0,function(e){e.NotAdmin="not_admin",e.TeamKeyNotFound="TEAM_KEY_NOT_FOUND",e.InviteLinkNotFound="TEAM_INVITE_LINK_NOT_FOUND",e.UserInviteLinkNotFound="USER_TEAM_INVITE_TOKEN_NOT_FOUND"}(t.InviteLinkResponseErrorCode||(t.InviteLinkResponseErrorCode={}))},53863:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},34059:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetRecoveryCodesAsTeamCaptainErrorCode=void 0,function(e){e.NotAdmin="not_billing_admin",e.InternalError="internal_error",e.UnknownError="UNKNOWN_ERROR"}(t.GetRecoveryCodesAsTeamCaptainErrorCode||(t.GetRecoveryCodesAsTeamCaptainErrorCode={}))},17023:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDPMetadataParseErrors=t.IDPXmlParseErrors=void 0,function(e){e.XML_PARSE_FAILED="xml_parse_failed"}(t.IDPXmlParseErrors||(t.IDPXmlParseErrors={})),function(e){e.KEY_DESCRIPTOR_NOT_FOUND="key_descriptor_not_found",e.IDP_ENTRYPOINT_NOT_FOUND="idp_entrypoint_not_found",e.INVALID_IDP_SSO_DESCRIPTOR="invalid_idp_sso_descriptor",e.MISSING_CERTIFICATE="missing_certificate",e.MULTIPLE_CERTIFICATES="multiple_certificates",e.CERTIFICATE_TOO_SHORT="certificate_too_short",e.CERTIFICATE_TOO_LONG="certificate_too_long ",e.CERTIFICATE_DECODE_FAILED="certificate_decode_failed",e.INVALID_ENTRYPOINT="invalid_entrypoint"}(t.IDPMetadataParseErrors||(t.IDPMetadataParseErrors={}))},21310:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},10434:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.teamAdminCommandsSlots=t.teamAdminLiveQueriesSlots=t.teamAdminQueriesSlots=void 0;const s=r(30504),i=r(72345);t.teamAdminQueriesSlots={getAdministrableUserGroup:(0,s.slot)(),getAdministrableUserGroups:(0,s.slot)(),isGroupNameAvailable:(0,s.slot)(),getAdminProvisioningKey:(0,s.slot)(),getMassDeploymentTeamKey:(0,s.slot)()},t.teamAdminLiveQueriesSlots={liveAdministrableUserGroup:(0,i.liveSlot)(),liveAdministrableUserGroups:(0,i.liveSlot)(),liveAdminProvisioningKey:(0,i.liveSlot)(),liveMassDeploymentTeamKey:(0,i.liveSlot)()},t.teamAdminCommandsSlots={registerTeamDomain:(0,s.slot)(),completeTeamDomainRegistration:(0,s.slot)(),deactivateTeamDomain:(0,s.slot)(),getTeamDomains:(0,s.slot)(),getTeamDevice:(0,s.slot)(),listTeamDevices:(0,s.slot)(),deactivateTeamDevice:(0,s.slot)(),registerTeamDevice:(0,s.slot)(),registerTeamDeviceAccount:(0,s.slot)(),getEncryptionServiceConfig:(0,s.slot)(),generateAndSaveEncryptionServiceConfig:(0,s.slot)(),clearSelfHostedESSettings:(0,s.slot)(),getTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamSettings:(0,s.slot)(),parseMetadataFields:(0,s.slot)(),persistAdminProvisioningKey:(0,s.slot)(),persistMassDeploymentTeamKey:(0,s.slot)(),removeAdminProvisioningKey:(0,s.slot)(),createSSOConnectorConfig:(0,s.slot)(),generateSSOConnectorKey:(0,s.slot)(),startAuditLogsQuery:(0,s.slot)(),getAuditLogQueryResults:(0,s.slot)(),getRecoveryCodesAsTeamCaptain:(0,s.slot)(),createInviteLink:(0,s.slot)(),changeInviteLinkTeamKey:(0,s.slot)(),toggleInviteLink:(0,s.slot)(),getInviteLink:(0,s.slot)(),requestInviteLinkToken:(0,s.slot)(),getInviteLinkForAdmin:(0,s.slot)(),getLastADSyncDate:(0,s.slot)(),getSpecialUserGroupInviteValuesForMemberInTeam:(0,s.slot)(),getSpecialUserGroupRevision:(0,s.slot)()}},15770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9825:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TeamMemberSSOStatuses=void 0,t.TeamMemberSSOStatuses=Object.freeze({Activated:"activated",PendingActivation:"pending_activation",PendingDeactivation:"pending_deactivation"})},22162:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(62485),t),i(r(86174),t)},62485:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserMessageTypes=void 0,function(e){e.DEFAULT="default",e.TRIAL_EXPIRED="trial_expired",e.WEB_STORE="web_store",e.DASHBOARD_UPRADE="dashboard_upgrade",e.SHARING_CENTER_FAMILY="sharing_center_family",e.SHARING_CENTER_WORK="sharing_center_work"}(t.UserMessageTypes||(t.UserMessageTypes={}))},86174:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userMessagesCommandsSlots=t.userMessagesLiveQueriesSlots=t.userMessagesQueriesSlots=void 0;const s=r(30504),i=r(72345);t.userMessagesQueriesSlots={getVisibleUserMessages:(0,s.slot)(),getUserMessages:(0,s.slot)()},t.userMessagesLiveQueriesSlots={liveUserMessages:(0,i.liveSlot)(),liveVisibleUserMessages:(0,i.liveSlot)()},t.userMessagesCommandsSlots={dismissUserMessages:(0,s.slot)(),addUserMessage:(0,s.slot)()}},31955:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(73955),t),i(r(25625),t)},73955:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VpnDisabledReason=t.VpnAccountActivationErrorType=t.VpnAccountStatusType=void 0,function(e){e.Activated="Activated",e.Activating="Activating",e.Error="Error",e.NotFound="NotFound",e.Ready="Ready"}(t.VpnAccountStatusType||(t.VpnAccountStatusType={})),function(e){e.ServerError="ServerError",e.AccountAlreadyExistError="AccountAlreadyExist"}(t.VpnAccountActivationErrorType||(t.VpnAccountActivationErrorType={})),function(e){e.InTeam="InTeam",e.NotPremium="NotPremium",e.NoPayment="NoPayment",e.Other="Other"}(t.VpnDisabledReason||(t.VpnDisabledReason={}))},25625:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.vpnCommandsSlots=t.vpnLiveQueriesSlots=t.vpnQueriesSlots=void 0;const s=r(30504),i=r(72345);t.vpnQueriesSlots={getVpnAccount:(0,s.slot)(),getVpnCapabilitySetting:(0,s.slot)()},t.vpnLiveQueriesSlots={liveVpnAccount:(0,i.liveSlot)()},t.vpnCommandsSlots={activateVpnAccount:(0,s.slot)(),clearVpnAccountErrors:(0,s.slot)(),completeVpnAccountActivation:(0,s.slot)()}},13006:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(90693),i=r(13190),o=r(53598),a=r(74675),n=r(77997),c=r(65741),d=r(36272),l=r(29597),u=r(92137);a.sharingItemsApi,s.taskTrackingApi,i.activityLogsApi,o.vaultItemsCrudApi,d.AuthenticationFlowContracts.authenticationFlowApi,d.DeviceTransferContracts.deviceTransferApi,d.pinCodeApi,l.sessionApi,u.masterPasswordSecurityApi,n.passwordHealthApi,c.carbonLegacyApi,l.changeMasterPasswordApi,a.sharingCollectionsApi,a.sharingInvitesApi,o.vaultOrganizationApi,s.featureFlipsApi,s.webServicesApi},65741:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonLegacyApi=void 0;const s=r(90693),i=r(99765),o=r(70314),a=r(78515);t.carbonLegacyApi=(0,s.defineModuleApi)({name:"carbon-legacy",commands:i.commands,queries:a.queries,events:o.events})},49420:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonLegacyClient=void 0;const s=r(90693),i=r(65741);class o extends((0,s.defineModuleClient)(i.carbonLegacyApi)){}t.CarbonLegacyClient=o,(0,s.registerModuleClient)(i.carbonLegacyApi,o)},99765:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commands=t.commandsFromCarbonAPI=t.MitigationDeleteGrapheneUserDataCommand=t.CarbonLegacyLeelooCommand=t.CarbonCommand=void 0;const s=r(90693),i=r(72345),o=r(16229);class a extends((0,s.defineCarbonCommand)({scope:s.UseCaseScope.Device})){}t.CarbonCommand=a;class n extends((0,s.defineCarbonCommand)({scope:s.UseCaseScope.Device})){}t.CarbonLegacyLeelooCommand=n;class c extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.MitigationDeleteGrapheneUserDataCommand=c,t.commandsFromCarbonAPI=(0,o.createCommandContractsFromConnector)(i.carbonCommandsSlots),t.commands={...t.commandsFromCarbonAPI,CarbonCommand:a,CarbonLegacyLeelooCommand:n,MitigationDeleteGrapheneUserDataCommand:c}},70314:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.events=t.CarbonLegacyDeviceRemotelyDeleted=t.CarbonLegacyEvent=t.CarbonCommandResultEvent=void 0;const s=r(90693);class i extends((0,s.defineEvent)({scope:s.UseCaseScope.Device})){}t.CarbonCommandResultEvent=i;class o extends((0,s.defineEvent)({scope:s.UseCaseScope.Device})){}t.CarbonLegacyEvent=o;class a extends((0,s.defineEvent)({scope:s.UseCaseScope.Device})){}t.CarbonLegacyDeviceRemotelyDeleted=a,t.events={CarbonCommandResultEvent:i,CarbonLegacyEvent:o,CarbonLegacyDeviceRemotelyDeleted:a}},78515:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.queries=t.queriesFromCarbonAPI=t.CarbonStateListQuery=t.CarbonStateQuery=void 0;const s=r(90693),i=r(72345),o=r(16229);class a extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.CarbonStateQuery=a;class n extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.CarbonStateListQuery=n,t.queriesFromCarbonAPI=(0,o.createQueryContractsFromConnectors)(i.carbonQueriesSlots,i.carbonLiveQueriesSlots),t.queries={...t.queriesFromCarbonAPI,CarbonStateQuery:a,CarbonStateListQuery:n}},83496:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(78515),t),i(r(70314),t),i(r(99765),t),i(r(76931),t),i(r(65741),t),i(r(49420),t)},16229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryContractsFromConnectors=t.createCommandContractsFromConnector=void 0;const s=r(90693);t.createCommandContractsFromConnector=function(e){return Object.keys(e).reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Command`]:(0,s.defineCarbonCommand)({scope:s.UseCaseScope.Device})})),{})},t.createQueryContractsFromConnectors=function(e,t){return[...Object.keys(e),...Object.keys(t)].reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Query`]:(0,s.defineQuery)({scope:s.UseCaseScope.Device})})),{})}},76931:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LEGACY_CARBON_LEELOO_USED_COMMANDS=void 0;t.LEGACY_CARBON_LEELOO_USED_COMMANDS=["lockSession","closeSession","cancelDashlaneAuthenticatorRegistration","openSession","openSessionWithDashlaneAuthenticator","openSessionWithOTP","openSessionWithOTPForNewDevice","openSessionWithToken","openSessionResendToken","removePersonalDataItem","savePersonalDataItem","sessionForceSync","getLocalAccountsList"]},23446:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5865),t)},5865:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},85530:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.breachesCommandsSlots=t.breachesLiveQueriesSlots=t.breachesQueriesSlots=void 0;const s=r(30504),i=r(72345);t.breachesQueriesSlots={getBreach:(0,s.slot)(),getBreaches:(0,s.slot)(),getBreachesPage:(0,s.slot)(),getBreachesPaginationToken:(0,s.slot)(),getBreachesUpdateStatus:(0,s.slot)()},t.breachesLiveQueriesSlots={liveBreach:(0,i.liveSlot)(),liveBreaches:(0,i.liveSlot)(),liveBreachesBatch:(0,i.liveSlot)(),liveBreachesUpdaterStatus:(0,i.liveSlot)()},t.breachesCommandsSlots={updateBreachStatus:(0,s.slot)()}},59870:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(85530),t),i(r(56476),t)},56476:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BreachesUpdaterStatus=t.BreachLeakedDataType=void 0,function(e){e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social"}(t.BreachLeakedDataType||(t.BreachLeakedDataType={})),function(e){e.UNKNOWN="unknown",e.SYNCING="syncing",e.SKIPPED="skipped",e.UNCHANGED="unchanged",e.UPDATED="updated",e.ERROR="error"}(t.BreachesUpdaterStatus||(t.BreachesUpdaterStatus={}))},21528:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.collectionsCommandsSlots=void 0;const s=r(30504);t.collectionsCommandsSlots={addCollection:(0,s.slot)(),deleteCollection:(0,s.slot)(),removeItemsFromCollections:(0,s.slot)(),updateCollection:(0,s.slot)()}},23328:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(21528),t),i(r(2868),t)},2868:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},40466:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(95331),t),i(r(347),t)},95331:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.credentialsLiveQueriesSlots=t.credentialsQueriesSlots=t.credentialsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.credentialsCommandsSlots={addCredential:(0,s.slot)(),updateCredential:(0,s.slot)(),updateLinkedWebsites:(0,s.slot)()},t.credentialsQueriesSlots={getCredential:(0,s.slot)(),getCredentialCategories:(0,s.slot)(),getCredentials:(0,s.slot)(),getCredentialsByDomain:(0,s.slot)(),getCredentialsCount:(0,s.slot)(),getCredentialsPage:(0,s.slot)(),getCredentialsPaginationToken:(0,s.slot)(),getDashlaneDefinedLinkedWebsites:(0,s.slot)(),getShouldShowRequireMasterPassword:(0,s.slot)()},t.credentialsLiveQueriesSlots={liveCredential:(0,i.liveSlot)(),liveCredentials:(0,i.liveSlot)(),liveCredentialsByDomain:(0,i.liveSlot)(),liveCredentialsBatch:(0,i.liveSlot)(),liveCredentialsCount:(0,i.liveSlot)()}},347:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialLimitStatus=void 0,function(e){e.Unlimited="unlimited",e.UnderLimit="underLimit",e.NearLimit="nearLimit",e.AtOrAboveLimit="atOrAboveLimit"}(t.CredentialLimitStatus||(t.CredentialLimitStatus={}))},54613:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.duplicationCommandsSlots=void 0;const s=r(30504);t.duplicationCommandsSlots={duplicateVaultItem:(0,s.slot)()}},55301:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(54613),t),i(r(11379),t)},11379:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},55552:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exportCommandsSlots=t.exportQueriesSlots=void 0;const s=r(30504);t.exportQueriesSlots={getIsForcedDomainsEnabled:(0,s.slot)()},t.exportCommandsSlots={getPersonalDataExport:(0,s.slot)()}},10362:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(55552),t),i(r(82),t)},82:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetPersonalDataExportErrorMessage=void 0;!function(e){e.UNSUPPORTED_DATATYPE_ERROR="Unsupported Data Export Type",e.UNDEFINED_PASSWORD_ERROR="Undefined Password"}(t.GetPersonalDataExportErrorMessage||(t.GetPersonalDataExportErrorMessage={}))},86575:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generatedPasswordsCommandsSlots=t.generatedPasswordsLiveQueriesSlots=t.generatedPasswordsQueriesSlots=void 0;const s=r(30504),i=r(72345);t.generatedPasswordsQueriesSlots={getGeneratedPassword:(0,s.slot)(),getGeneratedPasswordsCount:(0,s.slot)(),getGeneratedPasswords:(0,s.slot)(),getGeneratedPasswordsPage:(0,s.slot)(),getGeneratedPasswordsPaginationToken:(0,s.slot)()},t.generatedPasswordsLiveQueriesSlots={liveGeneratedPasswordsCount:(0,i.liveSlot)(),liveGeneratedPasswords:(0,i.liveSlot)()},t.generatedPasswordsCommandsSlots={saveGeneratedPassword:(0,s.slot)()}},20703:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(86575),t),i(r(99308),t)},99308:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},25632:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.driverLicensesCommandsSlots=void 0;const s=r(30504);t.driverLicensesCommandsSlots={addDriverLicense:(0,s.slot)(),editDriverLicense:(0,s.slot)()}},57155:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(25632),t),i(r(93910),t)},93910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},65671:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fiscalsIdCommandsSlots=void 0;const s=r(30504);t.fiscalsIdCommandsSlots={addFiscalId:(0,s.slot)(),editFiscalId:(0,s.slot)()}},49258:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(65671),t),i(r(83059),t)},83059:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},90232:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.idCardsCommandsSlots=void 0;const s=r(30504);t.idCardsCommandsSlots={addIdCard:(0,s.slot)(),editIdCard:(0,s.slot)()}},13538:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(90232),t),i(r(26328),t)},26328:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},61470:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(16281),t),i(r(57155),t),i(r(49258),t),i(r(13538),t),i(r(73758),t),i(r(74847),t),i(r(68955),t)},73758:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4922),t),i(r(86924),t)},4922:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passportsCommandsSlots=void 0;const s=r(30504);t.passportsCommandsSlots={addPassport:(0,s.slot)(),editPassport:(0,s.slot)()}},86924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},16281:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.idsCommandsSlots=void 0;const s=r(30504),i=r(57155),o=r(65671),a=r(13538),n=r(73758),c=r(74847);t.idsCommandsSlots=(0,s.combineEvents)(i.driverLicensesCommandsSlots,o.fiscalsIdCommandsSlots,a.idCardsCommandsSlots,n.passportsCommandsSlots,c.socialSecurityIdsCommandsSlots)},74847:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(44771),t),i(r(41022),t)},44771:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socialSecurityIdsCommandsSlots=void 0;const s=r(30504);t.socialSecurityIdsCommandsSlots={addSocialSecurityId:(0,s.slot)(),editSocialSecurityId:(0,s.slot)()}},41022:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},68955:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateIdResultErrorCode=t.AddIdResultErrorCode=t.IdErrorCode=void 0,function(e){e.INTERNAL_ERROR="INTERNAL_ERROR",e.NOT_AUTHENTICATED="NOT_AUTHENTICATED",e.NOT_FOUND="NOT_FOUND"}(t.IdErrorCode||(t.IdErrorCode={})),function(e){e.MISSING_ID_NUMBER="MISSING_ID_NUMBER"}(t.AddIdResultErrorCode||(t.AddIdResultErrorCode={})),function(e){e.MISSING_ID_NUMBER="MISSING_ID_NUMBER"}(t.UpdateIdResultErrorCode||(t.UpdateIdResultErrorCode={}))},60655:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.importCommandsSlots=t.importLiveQueriesSlots=t.importQueriesSlots=void 0;const s=r(30504),i=r(72345);t.importQueriesSlots={getImportPersonalDataStatus:(0,s.slot)()},t.importLiveQueriesSlots={liveImportPersonalDataStatus:(0,i.liveSlot)()},t.importCommandsSlots={importPersonalData:(0,s.slot)(),previewPersonalData:(0,s.slot)(),dismissPersonalDataImportNotifications:(0,s.slot)()}},7716:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(60655),t),i(r(42393),t)},42393:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewPersonalDataErrorType=t.ImportPersonalDataStateType=t.ImportPersonalDataErrorType=t.ImportFormats=t.ImportSource=t.SupportedVaultTypes=void 0,function(e){e.CREDENTIAL="credentials",e.NOTE="notes",e.PAYMENT_CARD="paymentCards",e.BANK_ACCOUNT="bankAccounts",e.COLLECTION="collections"}(t.SupportedVaultTypes||(t.SupportedVaultTypes={})),function(e){e["1Password"]="1password",e.Bitwarden="bitwarden",e.Chrome="chrome",e.Dash="dash",e.Edge="edge",e.Firefox="firefox",e.Keepass="keepass",e.Keeper="keeper",e.Lastpass="lastpass",e.Other="other",e.Safari="safari"}(t.ImportSource||(t.ImportSource={})),function(e){e.Csv="csv",e.Dash="dash"}(t.ImportFormats||(t.ImportFormats={})),function(e){e.Unavailable="unavailable",e.Unknown="unknown"}(t.ImportPersonalDataErrorType||(t.ImportPersonalDataErrorType={})),function(e){e.Idle="idle",e.Processing="processing",e.Success="success",e.Error="error"}(t.ImportPersonalDataStateType||(t.ImportPersonalDataStateType={})),function(e){e.BadPassword="bad_password",e.Unavailable="unavailable",e.InvalidFormat="invalid",e.Unknown="unknown"}(t.PreviewPersonalDataErrorType||(t.PreviewPersonalDataErrorType={}))},30897:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(57882),t),i(r(88295),t),i(r(63571),t),i(r(23446),t),i(r(59870),t),i(r(23328),t),i(r(40466),t),i(r(10362),t),i(r(61470),t),i(r(7716),t),i(r(76354),t),i(r(13995),t),i(r(42366),t),i(r(27958),t),i(r(91480),t),i(r(44015),t),i(r(32487),t),i(r(62061),t),i(r(35643),t),i(r(48934),t),i(r(20703),t),i(r(34237),t),i(r(55301),t)},76354:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(9092),t)},9092:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateLinkedWebsitesError=void 0,function(e){e.CredentialUpdateError="credentialUpdateError"}(t.UpdateLinkedWebsitesError||(t.UpdateLinkedWebsitesError={}))},62061:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(91583),t),i(r(1172),t)},91583:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passkeyCommandsSlots=t.passkeyLiveQueriesSlots=t.passkeyQueriesSlots=void 0;const s=r(30504),i=r(72345);t.passkeyQueriesSlots={getPasskey:(0,s.slot)(),getPasskeys:(0,s.slot)(),getPasskeysForDomain:(0,s.slot)()},t.passkeyLiveQueriesSlots={livePasskey:(0,i.liveSlot)(),livePasskeys:(0,i.liveSlot)()},t.passkeyCommandsSlots={addPasskey:(0,s.slot)(),updatePasskey:(0,s.slot)(),deletePasskey:(0,s.slot)()}},1172:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeletePasskeyErrorCode=void 0,function(e){e[e.NOT_AUTHORIZED=0]="NOT_AUTHORIZED",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.INTERNAL_ERROR=2]="INTERNAL_ERROR"}(t.DeletePasskeyErrorCode||(t.DeletePasskeyErrorCode={}))},35643:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29477),t),i(r(38161),t)},29477:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passwordHistoryLiveQueriesSlots=t.passwordHistoryQueriesSlots=void 0;const s=r(30504),i=r(72345);t.passwordHistoryQueriesSlots={getHasPasswordHistory:(0,s.slot)(),getPasswordHistoryPage:(0,s.slot)(),getPasswordHistoryPaginationToken:(0,s.slot)()},t.passwordHistoryLiveQueriesSlots={livePasswordHistoryBatch:(0,i.liveSlot)()}},38161:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordHistoryItemType=void 0,function(e){e.Credential="credential",e.Generated="generated"}(t.PasswordHistoryItemType||(t.PasswordHistoryItemType={}))},48934:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(75161),t),i(r(40672),t)},75161:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.paymentCardCommandsSlots=t.paymentCardLiveQueriesSlots=t.paymentCardQueriesSlots=void 0;const s=r(30504),i=r(72345);t.paymentCardQueriesSlots={getPaymentCard:(0,s.slot)(),getPaymentCards:(0,s.slot)()},t.paymentCardLiveQueriesSlots={livePaymentCard:(0,i.liveSlot)(),livePaymentCards:(0,i.liveSlot)()},t.paymentCardCommandsSlots={addPaymentCard:(0,s.slot)(),updatePaymentCard:(0,s.slot)(),deletePaymentCard:(0,s.slot)()}},40672:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeletePaymentCardErrorCode=t.PaymentCardSaveResultErrorCode=void 0,function(e){e.EMPTY_CARD_NUMBER_AND_SECURITY_CODE="EMPTY_CARD_NUMBER_AND_SECURITY_CODE",e.NOT_FOUND="NOT_FOUND"}(t.PaymentCardSaveResultErrorCode||(t.PaymentCardSaveResultErrorCode={})),function(e){e.NOT_AUTHORIZED="NOT_AUTHORIZED",e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR"}(t.DeletePaymentCardErrorCode||(t.DeletePaymentCardErrorCode={}))},46329:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1721),t)},1721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5746:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4249),t)},4249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},47413:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(836),t)},836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8400:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(67369),t)},67369:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},63571:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(46329),t),i(r(5746),t),i(r(47413),t),i(r(8400),t),i(r(87893),t),i(r(60776),t)},60776:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(68813),t)},68813:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},87893:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(63142),t)},63142:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},13995:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(56894),t),i(r(17013),t)},56894:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.secretLiveQueriesSlots=void 0;const s=r(72345);t.secretLiveQueriesSlots={liveSecrets:(0,s.liveSlot)()}},17013:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteSecretErrorCode=void 0,function(e){e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR",e.LEAVE_SHARING_FAILED="LEAVE_SHARING_FAILED",e.LEAVE_SHARING_FORBIDDEN_LAST_ADMIN="LEAVE_SHARING_FORBIDDEN_LAST_ADMIN",e.LEAVE_SHARING_FORBIDDEN_GROUP_ITEM="LEAVE_SHARING_FORBIDDEN_GROUP_ITEM"}(t.DeleteSecretErrorCode||(t.DeleteSecretErrorCode={}))},42366:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(70954),t),i(r(1376),t)},70954:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.secureFilesCommandsSlots=t.secureFilesLiveQueriesSlots=t.secureFilesQueriesSlots=void 0;const s=r(30504),i=r(72345);t.secureFilesQueriesSlots={getSecureFilesQuota:(0,s.slot)(),getSecureFilesInfoList:(0,s.slot)(),getFileDownloadProgress:(0,s.slot)(),getFileUploadProgress:(0,s.slot)()},t.secureFilesLiveQueriesSlots={liveSecureFilesQuota:(0,i.liveSlot)(),liveFileDownloadProgress:(0,i.liveSlot)(),liveFileUploadProgress:(0,i.liveSlot)()},t.secureFilesCommandsSlots={downloadSecureFile:(0,s.slot)(),chunkTransferDone:(0,s.slot)(),deleteSecureFile:(0,s.slot)(),addSecureFile:(0,s.slot)(),validateSecureFile:(0,s.slot)(),commitSecureFile:(0,s.slot)(),initSecureFilesStorageInfo:(0,s.slot)(),clearSecureFileState:(0,s.slot)()}},1376:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileUploadStatus=t.FileDownloadStatus=t.SecureFileResultErrorCode=void 0,function(e){e.MAX_CONTENT_LENGTH_EXCEEDED="MAX_CONTENT_LENGTH_EXCEEDED",e.QUOTA_EXCEEDED="QUOTA_EXCEEDED",e.INVALID_FILE_TYPE="INVALID_FILE_TYPE",e.INTERNAL_ERROR="INTERNAL_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.FILE_NOT_FOUND="FILE_NOT_FOUND"}(t.SecureFileResultErrorCode||(t.SecureFileResultErrorCode={})),function(e){e.Initial="Initial",e.Downloading="Downloading",e.Deciphering="Deciphering",e.Error="Error",e.ChunkReady="ChunkReady",e.ChunkDownloaded="ChunkDownloaded",e.TransferComplete="TransferComplete"}(t.FileDownloadStatus||(t.FileDownloadStatus={})),function(e){e.None="None",e.Initial="Initial",e.Uploading="Uploading",e.Ciphering="Ciphering",e.Done="Done",e.Error="Error"}(t.FileUploadStatus||(t.FileUploadStatus={}))},27958:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(32376),t),i(r(20397),t)},32376:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.secureNoteCategoryCommandsSlots=void 0;const s=r(30504);t.secureNoteCategoryCommandsSlots={setupDefaultNoteCategories:(0,s.slot)()}},20397:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},91480:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47110),t),i(r(5721),t)},47110:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.noteLiveQueriesSlots=t.noteQueriesSlots=void 0;const s=r(30504),i=r(72345);t.noteQueriesSlots={getNote:(0,s.slot)(),getNoteCategories:(0,s.slot)(),getNotes:(0,s.slot)(),getNotesPage:(0,s.slot)(),getNotesPaginationToken:(0,s.slot)()},t.noteLiveQueriesSlots={liveNote:(0,i.liveSlot)(),liveNotes:(0,i.liveSlot)()}},5721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteSecureNoteErrorCode=t.SecureNoteSaveResultErrorCode=void 0,function(e){e.NOT_FOUND="NOT_FOUND"}(t.SecureNoteSaveResultErrorCode||(t.SecureNoteSaveResultErrorCode={})),function(e){e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR",e.LEAVE_SHARING_FAILED="LEAVE_SHARING_FAILED",e.LEAVE_SHARING_FORBIDDEN_LAST_ADMIN="LEAVE_SHARING_FORBIDDEN_LAST_ADMIN",e.LEAVE_SHARING_FORBIDDEN_GROUP_ITEM="LEAVE_SHARING_FORBIDDEN_GROUP_ITEM"}(t.DeleteSecureNoteErrorCode||(t.DeleteSecureNoteErrorCode={}))},44015:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(12451),t),i(r(76646),t)},12451:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.settingsCommandsSlots=t.settingsLiveQueriesSlots=t.settingsQueriesSlots=void 0;const s=r(30504),i=r(72345);t.settingsQueriesSlots={getAnonymousUserId:(0,s.slot)(),getIsUrlBanished:(0,s.slot)(),arePasswordsProtected:(0,s.slot)(),areRichIconsEnabled:(0,s.slot)()},t.settingsLiveQueriesSlots={liveArePasswordsProtected:(0,i.liveSlot)(),liveAreRichIconsEnabled:(0,i.liveSlot)()},t.settingsCommandsSlots={toggleDashlane:(0,s.slot)(),updateProtectPasswordsSetting:(0,s.slot)(),updateAutofillSettings:(0,s.slot)(),updateRichIconsSetting:(0,s.slot)()}},76646:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},57882:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dataManagementCommandsSlots=t.dataManagementLiveQueriesSlots=t.dataManagementQueriesSlots=void 0;const s=r(30504),i=r(59870),o=r(23328),a=r(40466),n=r(10362),c=r(20703),d=r(61470),l=r(7716),u=r(62061),p=r(35643),m=r(48934),h=r(42366),g=r(27958),v=r(91480),_=r(44015),y=r(32487),S=r(34237),E=r(13995),f=r(54613);t.dataManagementQueriesSlots=(0,s.combineEvents)(i.breachesQueriesSlots,a.credentialsQueriesSlots,n.exportQueriesSlots,c.generatedPasswordsQueriesSlots,l.importQueriesSlots,v.noteQueriesSlots,u.passkeyQueriesSlots,p.passwordHistoryQueriesSlots,m.paymentCardQueriesSlots,h.secureFilesQueriesSlots,_.settingsQueriesSlots,y.spacesQueriesSlots,S.vaultQueriesSlots),t.dataManagementLiveQueriesSlots=(0,s.combineEvents)(i.breachesLiveQueriesSlots,a.credentialsLiveQueriesSlots,c.generatedPasswordsLiveQueriesSlots,l.importLiveQueriesSlots,v.noteLiveQueriesSlots,u.passkeyLiveQueriesSlots,p.passwordHistoryLiveQueriesSlots,m.paymentCardLiveQueriesSlots,E.secretLiveQueriesSlots,h.secureFilesLiveQueriesSlots,_.settingsLiveQueriesSlots),t.dataManagementCommandsSlots=(0,s.combineEvents)(i.breachesCommandsSlots,o.collectionsCommandsSlots,a.credentialsCommandsSlots,n.exportCommandsSlots,c.generatedPasswordsCommandsSlots,d.idsCommandsSlots,l.importCommandsSlots,u.passkeyCommandsSlots,m.paymentCardCommandsSlots,h.secureFilesCommandsSlots,g.secureNoteCategoryCommandsSlots,_.settingsCommandsSlots,S.vaultCommandsSlots,f.duplicationCommandsSlots)},32487:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3316),t),i(r(81774),t)},3316:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.spacesQueriesSlots=void 0;const s=r(30504);t.spacesQueriesSlots={getSpace:(0,s.slot)(),getSpaces:(0,s.slot)()}},81774:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},88295:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},34237:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(52810),t),i(r(76417),t)},52810:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VaultItemDisableProtectionMode=void 0,function(e){e[e.CannotDisable=0]="CannotDisable",e[e.DisableSpecificVaultItem=1]="DisableSpecificVaultItem",e[e.DisableGeneralSetting=2]="DisableGeneralSetting"}(t.VaultItemDisableProtectionMode||(t.VaultItemDisableProtectionMode={}))},76417:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.vaultCommandsSlots=t.vaultQueriesSlots=void 0;const s=r(30504);t.vaultQueriesSlots={},t.vaultCommandsSlots={disableVaultItemProtection:(0,s.slot)()}},32626:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(72345),t),i(r(28413),t),i(r(17317),t),i(r(98521),t),i(r(80112),t),i(r(55334),t),i(r(91609),t),i(r(99103),t),i(r(29004),t),i(r(90041),t),i(r(65722),t),i(r(25098),t),i(r(94372),t),i(r(15874),t),i(r(50459),t),i(r(14811),t),i(r(30897),t),i(r(88219),t),i(r(43245),t),i(r(65005),t),i(r(80898),t),i(r(29450),t),i(r(96035),t),i(r(6666),t),i(r(24875),t),i(r(87940),t),i(r(15925),t),i(r(68183),t),i(r(6768),t),i(r(58290),t),i(r(78779),t),i(r(37174),t),i(r(60687),t),i(r(36632),t),i(r(77277),t),i(r(49106),t),i(r(68440),t),i(r(34852),t),i(r(31525),t),i(r(28249),t),i(r(33773),t),i(r(84470),t),i(r(58575),t),i(r(9987),t),i(r(57369),t),i(r(1659),t),i(r(48905),t),i(r(66478),t),i(r(12891),t),i(r(98655),t),i(r(44225),t),i(r(19635),t),i(r(22162),t),i(r(31955),t),i(r(83496),t),i(r(13006),t)},5933:(e,t,r)=>{r.d(t,{KV:()=>n,co:()=>a,td:()=>o});var s=r(30504),i=r(55432);const o={participateToUserABTest:(0,s.slot)()},a={getUserABTestVariant:(0,s.slot)()},n={liveUserABTestVariant:(0,i.H)()}},16537:(e,t,r)=>{r.d(t,{PG:()=>a,PO:()=>o,cN:()=>n});var s=r(30504),i=r(55432);const o={editContactInfo:(0,s.slot)(),refreshContactInfo:(0,s.slot)()},a={getContactInfo:(0,s.slot)()},n={liveContactInfo:(0,i.H)()}},57317:(e,t,r)=>{r.d(t,{E:()=>o,b:()=>a});var s=r(30504),i=r(55432);const o={getSubscriptionCode:(0,s.slot)()},a={liveSubscriptionCode:(0,i.H)()}},53927:(e,t,r)=>{r.d(t,{zR:()=>u,QR:()=>m,ke:()=>p});var s=r(30504),i=r(55432);const o={refreshU2FDevicesList:(0,s.slot)(),removeU2FAuthenticator:(0,s.slot)(),refreshTwoFactorAuthenticationInfo:(0,s.slot)(),startTwoFactorAuthenticationEnableFlow:(0,s.slot)(),stopTwoFactorAuthenticationEnableFlow:(0,s.slot)(),continueTwoFactorAuthenticationEnableFlow:(0,s.slot)(),backTwoFactorAuthenticationEnableFlow:(0,s.slot)(),startTwoFactorAuthenticationDisableFlow:(0,s.slot)(),stopTwoFactorAuthenticationDisableFlow:(0,s.slot)(),continueTwoFactorAuthenticationDisableFlow:(0,s.slot)(),backTwoFactorAuthenticationDisableFlow:(0,s.slot)()},a={getU2FDevicesList:(0,s.slot)(),getTwoFactorAuthenticationEnableStage:(0,s.slot)(),getTwoFactorAuthenticationDisableStage:(0,s.slot)()},n={liveU2FDevicesList:(0,i.H)(),liveTwoFactorAuthenticationEnableStage:(0,i.H)(),liveTwoFactorAuthenticationDisableStage:(0,i.H)()},c={enableWebAuthnAuthentication:(0,s.slot)(),initEnableWebAuthnAuthentication:(0,s.slot)(),refreshAvailableWebAuthnAuthenticators:(0,s.slot)(),refreshWebAuthnAuthenticators:(0,s.slot)(),initRegisterWebAuthnAuthenticator:(0,s.slot)(),registerWebAuthnAuthenticator:(0,s.slot)(),initOpenSessionWithWebAuthnAuthenticator:(0,s.slot)(),openSessionWithWebAuthnAuthenticator:(0,s.slot)(),disableWebAuthnAuthentication:(0,s.slot)(),removeWebAuthnAuthenticator:(0,s.slot)(),initUserVerificationWithWebAuthn:(0,s.slot)()},d={getWebAuthnAuthenticators:(0,s.slot)(),getWebAuthnAuthenticationOptedIn:(0,s.slot)()},l={liveWebAuthnAuthenticators:(0,i.H)(),liveWebAuthnAuthenticationOptedIn:(0,i.H)()},u=(0,s.combineEvents)({openSessionWithMasterPassword:(0,s.slot)(),registerDevice:(0,s.slot)(),requestEmailToken:(0,s.slot)(),requestPaymentUpdateAuthenticationToken:(0,s.slot)(),setReactivationStatus:(0,s.slot)(),disableAutologin:(0,s.slot)()},c,o),p=(0,s.combineEvents)({getHasOtp2Type:(0,s.slot)(),getUserOtpType:(0,s.slot)(),getReactivationStatus:(0,s.slot)(),getAvailableUserVerificationMethods:(0,s.slot)()},d,a),m=(0,s.combineEvents)({liveReactivationStatus:(0,i.H)()},l,n)},22450:(e,t,r)=>{r.d(t,{_V:()=>a,jP:()=>i});var s,i;!function(e){e.DISABLED="DISABLED",e.CLASSIC="CLASSIC",e.WEBAUTHN="WEBAUTHN"}(s||(s={})),function(e){e[e.PERSIST_DATA_YES=0]="PERSIST_DATA_YES",e[e.PERSIST_DATA_NO=1]="PERSIST_DATA_NO"}(i||(i={}));Object.freeze({MasterPassword:"masterPassword",Webauthn:"webauthn"});var o,a;!function(e){e[e.NO_OTP=0]="NO_OTP",e[e.OTP_NEW_DEVICE=1]="OTP_NEW_DEVICE",e[e.OTP_LOGIN=2]="OTP_LOGIN"}(o||(o={})),function(e){e[e.INVALID_LOGIN=0]="INVALID_LOGIN",e[e.EMPTY_LOGIN=1]="EMPTY_LOGIN",e[e.EMPTY_MASTER_PASSWORD=2]="EMPTY_MASTER_PASSWORD",e[e.EMPTY_ENCRYPTED_KEY=3]="EMPTY_ENCRYPTED_KEY",e[e.INVALID_ENCRYPTED_KEY=4]="INVALID_ENCRYPTED_KEY",e[e.EMPTY_TOKEN=5]="EMPTY_TOKEN",e[e.EMPTY_OTP=6]="EMPTY_OTP",e[e.SEND_TOKEN_FAILED=7]="SEND_TOKEN_FAILED",e[e.UKI_REGISTRATION_FAILED=8]="UKI_REGISTRATION_FAILED",e[e.REGISTER_DEVICE_FAILED=9]="REGISTER_DEVICE_FAILED",e[e.BUSINESS_ERROR=10]="BUSINESS_ERROR",e[e.USER_DOESNT_EXIST=11]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=12]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=13]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_UNAUTHORIZED=14]="USER_UNAUTHORIZED",e[e.WRONG_PASSWORD=15]="WRONG_PASSWORD",e[e.DATA_TAMPERED_ERROR=16]="DATA_TAMPERED_ERROR",e[e.LOGGEDIN=17]="LOGGEDIN",e[e.ASK_TOKEN=18]="ASK_TOKEN",e[e.ASK_OTP=19]="ASK_OTP",e[e.ASK_MASTER_PASSWORD=20]="ASK_MASTER_PASSWORD",e[e.USE_LOCAL_UKI=21]="USE_LOCAL_UKI",e[e.ASK_DASHLANE_AUTHENTICATOR=22]="ASK_DASHLANE_AUTHENTICATOR",e[e.OTP_NOT_VALID=23]="OTP_NOT_VALID",e[e.OTP_TOO_MANY_ATTEMPTS=24]="OTP_TOO_MANY_ATTEMPTS",e[e.OTP_ALREADY_USED=25]="OTP_ALREADY_USED",e[e.BACKUP_CODE_NOT_VALID=26]="BACKUP_CODE_NOT_VALID",e[e.TOKEN_NOT_VALID=27]="TOKEN_NOT_VALID",e[e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED=28]="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e[e.SERVER_KEY_MISSING=29]="SERVER_KEY_MISSING",e[e.TOKEN_LOCKED=30]="TOKEN_LOCKED",e[e.TOKEN_TOO_MANY_ATTEMPTS=31]="TOKEN_TOO_MANY_ATTEMPTS",e[e.TOKEN_ACCOUNT_LOCKED=32]="TOKEN_ACCOUNT_LOCKED",e[e.TOKEN_EXPIRED=33]="TOKEN_EXPIRED",e[e.NO_ACTIVE_AUTHENTICATOR=34]="NO_ACTIVE_AUTHENTICATOR",e[e.FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE=35]="FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE",e[e.DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION=36]="DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION",e[e.DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED=37]="DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED",e[e.TOKEN_PROVIDED_FOR_LOCAL_SESSION=38]="TOKEN_PROVIDED_FOR_LOCAL_SESSION",e[e.DEVICE_ALREADY_REGISTERED=39]="DEVICE_ALREADY_REGISTERED",e[e.OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION=40]="OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION",e[e.DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP=41]="DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP",e[e.UNKNOWN_SYNC_ERROR=42]="UNKNOWN_SYNC_ERROR",e[e.INVALID_UKI=43]="INVALID_UKI",e[e.UNKNOWN_UKI=44]="UNKNOWN_UKI",e[e.UNKNOWN_ERROR=45]="UNKNOWN_ERROR",e[e.UNEXPECTED_OTP_TYPE=46]="UNEXPECTED_OTP_TYPE",e[e.UNAUTHORIZED=47]="UNAUTHORIZED",e[e.UNAUTHORIZED_NOT_VALID_CONTENT=48]="UNAUTHORIZED_NOT_VALID_CONTENT",e[e.NETWORK_ERROR=49]="NETWORK_ERROR",e[e.THROTTLED=50]="THROTTLED",e[e.SESSION_ALREADY_OPENED=51]="SESSION_ALREADY_OPENED",e[e.INVALID_SESSION=52]="INVALID_SESSION",e[e.DEVICE_NOT_REGISTERED=53]="DEVICE_NOT_REGISTERED",e[e.MISSING_APP_KEYS=54]="MISSING_APP_KEYS",e[e.PROVIDE_EXTRA_DEVICE_TOKEN=55]="PROVIDE_EXTRA_DEVICE_TOKEN",e[e.PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE=56]="PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE",e[e.PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE=57]="PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE",e[e.ASK_OTP_FOR_NEW_DEVICE=58]="ASK_OTP_FOR_NEW_DEVICE",e[e.TEAM_GENERIC_ERROR=59]="TEAM_GENERIC_ERROR",e[e.SSO_LOGIN_BYPASS=60]="SSO_LOGIN_BYPASS",e[e.SSO_VERIFICATION_FAILED=61]="SSO_VERIFICATION_FAILED",e[e.SSO_BLOCKED=62]="SSO_BLOCKED",e[e.CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION=63]="CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION",e[e.USER_DOESNT_EXIST_SSO=64]="USER_DOESNT_EXIST_SSO"}(a||(a={}))},49594:(e,t,r)=>{r.d(t,{X:()=>n});var s=r(30504),i=r(66302),o=r(38344),a=r(78961);const n=(0,s.combineEvents)(i.z,o.r,a.z)},66302:(e,t,r)=>{r.d(t,{z:()=>N});var s=r(30504),i=r(5933),o=r(16537),a=r(53927),n=r(38429),c=r(61045);const d={getDarkWebInsightsReportResults:(0,s.slot)(),getDarkWebInsightsSummary:(0,s.slot)()};var l=r(44632);const u={getFamilyDetails:(0,s.slot)(),joinFamily:(0,s.slot)(),leaveFamily:(0,s.slot)(),removeFamilyMember:(0,s.slot)(),resetFamilyJoinToken:(0,s.slot)()};var p=r(64128);const m={setGlobalExtensionSettings:(0,s.slot)(),getGlobalExtensionSettings:(0,s.slot)()},h={evaluatePassword:(0,s.slot)()},g={logEvent:(0,s.slot)(),logPageView:(0,s.slot)()},v={logException:(0,s.slot)()},_={abortDeviceLimitFlow:(0,s.slot)(),loginViaSSO:(0,s.slot)(),unlinkPreviousDevice:(0,s.slot)(),unlinkMultipleDevices:(0,s.slot)()};var y=r(94883),S=r(22955),E=r(8755),f=r(52215),A=r(38578),I=r(73298),O=r(52860),b=r(77507),T=r(27794),C=r(73762),w=r(77253),R=r(89210),P=r(71316),D=r(92753);const N=(0,s.combineEvents)(i.td,a.zR,n.v,o.PO,c.rU,d,l.fv,g,v,u,m,h,_,y._m,S.vq,E.U$,f.of,A.r,I._,O.gQ,b.$k,p.H9,T.uG,C.b,w.hO,R.Kr,P.lp,D.n)},78961:(e,t,r)=>{r.d(t,{z:()=>O});var s=r(30504),i=r(5933),o=r(16537),a=r(57317);const n={livePhishingURLList:(0,r(55432).H)()};var c=r(53927),d=r(44632),l=r(38429),u=r(61045),p=r(64128),m=r(64001),h=r(94883),g=r(22955),v=r(8755),_=r(52215),y=r(52860),S=r(77507),E=r(27794),f=r(77253),A=r(89210),I=r(71316);const O=(0,s.combineEvents)(i.KV,n,c.QR,l.F,o.cN,u.vF,d.QX,m.b,h.Rj,g._1,v.iX,_.K1,y.qN,S.EX,p.YW,E.Ll,a.b,f.dN,A.kh,I.fD)},38344:(e,t,r)=>{r.d(t,{r:()=>R});var s=r(30504),i=r(5933),o=r(16537),a=r(57317),n=r(53927);const c={getSingleAddressForAutofill:(0,s.slot)(),getMultipleAddressesForAutofill:(0,s.slot)(),getSingleBankAccountForAutofill:(0,s.slot)(),getMultipleBankAccountsForAutofill:(0,s.slot)(),getSingleCompanyForAutofill:(0,s.slot)(),getMultipleCompaniesForAutofill:(0,s.slot)(),getSingleCredentialForAutofill:(0,s.slot)(),getMultipleCredentialsForAutofill:(0,s.slot)(),getSingleDriverLicenseForAutofill:(0,s.slot)(),getMultipleDriverLicensesForAutofill:(0,s.slot)(),getSingleEmailForAutofill:(0,s.slot)(),getMultipleEmailsForAutofill:(0,s.slot)(),getSingleFiscalIdForAutofill:(0,s.slot)(),getMultipleFiscalIdsForAutofill:(0,s.slot)(),getSingleGeneratedPasswordForAutofill:(0,s.slot)(),getMultipleGeneratedPasswordsForAutofill:(0,s.slot)(),getSingleIdCardForAutofill:(0,s.slot)(),getMultipleIdCardsForAutofill:(0,s.slot)(),getSingleIdentityForAutofill:(0,s.slot)(),getMultipleIdentitiesForAutofill:(0,s.slot)(),getSingleNoteForAutofill:(0,s.slot)(),getMultipleNotesForAutofill:(0,s.slot)(),getSinglePasskeyForAutofill:(0,s.slot)(),getSinglePassportForAutofill:(0,s.slot)(),getMultiplePassportsForAutofill:(0,s.slot)(),getSinglePaymentCardForAutofill:(0,s.slot)(),getMultiplePaymentCardsForAutofill:(0,s.slot)(),getSinglePersonalWebsiteForAutofill:(0,s.slot)(),getMultiplePersonalWebsitesForAutofill:(0,s.slot)(),getSinglePhoneForAutofill:(0,s.slot)(),getMultiplePhonesForAutofill:(0,s.slot)(),getSingleSocialSecurityIdForAutofill:(0,s.slot)(),getMultipleSocialSecurityIdsForAutofill:(0,s.slot)(),getAutofillSettingOnUrlForAutofill:(0,s.slot)()};var d=r(44632),l=r(61045),u=r(92753);const p={getHasFeature:(0,s.slot)(),getFeatures:(0,s.slot)()};var m=r(64128),h=r(64001),g=r(94883),v=r(22955),_=r(8755),y=r(52215),S=r(38578),E=r(73298),f=r(52860),A=r(77507);const I={getAllBanks:(0,s.slot)(),getAllCallingCodes:(0,s.slot)(),getBanks:(0,s.slot)(),getSecureDocumentsExtensionsList:(0,s.slot)()};var O=r(27794),b=r(73762),T=r(77253),C=r(89210),w=r(71316);const R=(0,s.combineEvents)(i.co,n.ke,c,o.PG,l.kQ,d.pz,u.C,p,h.c,g.Xz,v.xP,_.Ie,y.A2,S.H,E.P,f.UW,A.q9,m.JQ,O.i1,I,a.E,b.N,T.XJ,C.Vz,w.T4)},55432:(e,t,r)=>{r.d(t,{H:()=>o});var s=r(30504);const i={noBuffer:!0},o=()=>(0,s.slot)(i)},62029:(e,t,r)=>{r.d(t,{o:()=>i});var s=r(30504);const i={log:(0,s.slot)(),info:(0,s.slot)(),warning:(0,s.slot)(),error:(0,s.slot)()}},38429:(e,t,r)=>{r.d(t,{F:()=>a,v:()=>o});var s=r(30504),i=r(55432);const o={changeMasterPassword:(0,s.slot)()},a={liveChangeMasterPasswordStatus:(0,i.H)()}},61045:(e,t,r)=>{r.d(t,{kQ:()=>a,rU:()=>o,vF:()=>n});var s=r(30504),i=r(55432);const o={changeUserCrypto:(0,s.slot)()},a={getCanUserChangeCrypto:(0,s.slot)(),getUserDerivationMethod:(0,s.slot)()},n={liveUserDerivationMethod:(0,i.H)()}},57789:(e,t,r)=>{function s(e){return Boolean(e)&&"KWAuthentifiant"===e.kwType}r.d(t,{G:()=>s})},26461:(e,t,r)=>{r.d(t,{LR:()=>i});var s=r(50415);(0,s.Enum)("PAYMENT_TYPE_VISA","PAYMENT_TYPE_MASTERCARD","PAYMENT_TYPE_AMEX","PAYMENT_TYPE_DISCOVER","PAYMENT_TYPE_JCB","PAYMENT_TYPE_DINERSCLUB");const i=(0,s.Enum)("BLACK","SILVER","WHITE","RED","ORANGE","GOLD","BLUE_1","BLUE_2","GREEN_1","GREEN_2")},18952:(e,t,r)=>{r.d(t,{z:()=>s});const s=(0,r(50415).Enum)("PHONE_TYPE_ANY","PHONE_TYPE_MOBILE","PHONE_TYPE_LANDLINE","PHONE_TYPE_FAX","PHONE_TYPE_WORK_MOBILE","PHONE_TYPE_WORK_LANDLINE","PHONE_TYPE_WORK_FAX")},92753:(e,t,r)=>{r.d(t,{C:()=>i,n:()=>o});var s=r(30504);const i={getAnonymousComputerId:(0,s.slot)(),getPlatformInfo:(0,s.slot)()},o={cleanRemotelyRemovedProfiles:(0,s.slot)()}},98558:(e,t,r)=>{r.d(t,{D:()=>s});const s={deviceLimitCapabilityUpdated:(0,r(30504).slot)()}},98052:(e,t,r)=>{r.d(t,{z:()=>i});var s=r(30504);const i={loginStatusChanged:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),deactivateDeviceResult:(0,s.slot)({noBuffer:!0}),changeDeviceNameResult:(0,s.slot)({noBuffer:!0}),accountFeaturesChanged:(0,s.slot)({noBuffer:!0}),webOnboardingModeUpdated:(0,s.slot)({noBuffer:!0}),askWebsiteInfo:(0,s.slot)({noBuffer:!0}),getAccountInfo:(0,s.slot)({noBuffer:!0}),getAnonymousLogsMetadata:(0,s.slot)({noBuffer:!0}),checkIfMasterPasswordIsValid:(0,s.slot)({noBuffer:!0}),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)({noBuffer:!0}),closeSession:(0,s.slot)({noBuffer:!0}),lockSession:(0,s.slot)({noBuffer:!0}),exceptionLog:(0,s.slot)({noBuffer:!0}),getDevicesList:(0,s.slot)({noBuffer:!0}),getLocalAccountsList:(0,s.slot)({noBuffer:!0}),deactivateDevice:(0,s.slot)({noBuffer:!0}),changeDeviceName:(0,s.slot)({noBuffer:!0}),updateWebOnboardingMode:(0,s.slot)({noBuffer:!0})}},64128:(e,t,r)=>{r.d(t,{H9:()=>o,JQ:()=>a,YW:()=>n});var s=r(30504),i=r(55432);const o={decipherRemoteFile:(0,s.slot)()},a={getFileContent:(0,s.slot)()},n={liveFileMeta:(0,i.H)()}},64001:(e,t,r)=>{r.d(t,{b:()=>a,c:()=>o});var s=r(30504),i=r(55432);const o={getIsBrazeContentDisabled:(0,s.slot)(),getIsLoginFlowMigrationDisabled:(0,s.slot)(),getIsAutoSSOLoginDisabled:(0,s.slot)()},a={liveIsBrazeContentDisabled:(0,i.H)(),liveIsLoginFlowMigrationDisabled:(0,i.H)(),liveIsAutoSSOLoginDisabled:(0,i.H)()}},92486:(e,t,r)=>{r.d(t,{N:()=>i});var s=r(30504);const i={abTestingChanged:(0,s.slot)(),loginStatusChanged:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)(),spaceDataUpdated:(0,s.slot)(),teamAdminDataUpdated:(0,s.slot)(),deactivateDeviceResult:(0,s.slot)(),changeDeviceNameResult:(0,s.slot)(),accountFeaturesChanged:(0,s.slot)(),updatePaymentCardTokenResult:(0,s.slot)(),webOnboardingModeUpdated:(0,s.slot)(),currentLocationUpdated:(0,s.slot)(),checkDirectorySyncKeyRequest:(0,s.slot)(),serverSidePairingStatusChanged:(0,s.slot)(),getUki:(0,s.slot)(),getAccountInfo:(0,s.slot)(),getDevicesList:(0,s.slot)(),getLocalAccountsList:(0,s.slot)(),deactivateDevice:(0,s.slot)(),changeDeviceName:(0,s.slot)(),getInvoices:(0,s.slot)(),getPersonalSettings:(0,s.slot)(),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)(),closeSession:(0,s.slot)(),lockSession:(0,s.slot)({noBuffer:!0}),cancelPremiumSubscription:(0,s.slot)(),createUserGroup:(0,s.slot)(),deleteUserGroup:(0,s.slot)(),renameUserGroup:(0,s.slot)(),inviteUserGroupMembers:(0,s.slot)(),revokeUserGroupMembers:(0,s.slot)(),updateUserGroupMembers:(0,s.slot)(),teamUpdated:(0,s.slot)(),createAccountStep1:(0,s.slot)(),createAccountStep2:(0,s.slot)(),checkLogin:(0,s.slot)(),savePersonalDataItem:(0,s.slot)(),removePersonalDataItem:(0,s.slot)(),savePaymentCard:(0,s.slot)(),getMasterPasswordResetDemandList:(0,s.slot)(),acceptMasterPasswordResetDemand:(0,s.slot)(),checkIfMasterPasswordIsValid:(0,s.slot)(),declineMasterPasswordResetDemand:(0,s.slot)(),getMembers:(0,s.slot)(),addTeamAdmin:(0,s.slot)(),removeTeamAdmin:(0,s.slot)(),setTeamSettings:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)(),checkDirectorySyncKeyResponse:(0,s.slot)(),queryStaticDataCollections:(0,s.slot)(),resumeSession:(0,s.slot)(),exceptionLog:(0,s.slot)()}},30187:(e,t,r)=>{var s;r.d(t,{w:()=>s}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(s||(s={}))},94883:(e,t,r)=>{r.d(t,{Rj:()=>n,Xz:()=>a,_m:()=>o});var s=r(30504),i=r(55432);const o={addLoginNotification:(0,s.slot)(),clearAllStoredLoginNotification:(0,s.slot)()},a={getLoginNotifications:(0,s.slot)()},n={liveLoginNotifications:(0,i.H)()}},22955:(e,t,r)=>{r.d(t,{_1:()=>n,vq:()=>o,xP:()=>a});var s=r(30504),i=r(55432);const o={updateLoginStepInfo:(0,s.slot)(),resetLoginStepInfo:(0,s.slot)()},a={getLoginStepInfo:(0,s.slot)()},n={liveLoginStepInfo:(0,i.H)()}},35096:(e,t,r)=>{r.d(t,{I:()=>i});var s=r(30504);const i={savePersonalDataItem:(0,s.slot)(),filledDataItem:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)()}},8755:(e,t,r)=>{r.d(t,{Ie:()=>a,U$:()=>o,iX:()=>n});var s=r(30504),i=r(55432);const o={markNotificationAsInteracted:(0,s.slot)(),markNotificationAsSeen:(0,s.slot)(),markNotificationAsUnseen:(0,s.slot)()},a={getNotificationStatus:(0,s.slot)()},n={liveNotificationStatus:(0,i.H)()}},52215:(e,t,r)=>{r.d(t,{of:()=>u,K1:()=>l,A2:()=>d});var s=r(30504),i=r(55432);const o={getLoginDeviceLimitFlow:(0,s.slot)()},a={liveLoginDeviceLimitFlow:(0,i.H)()},n={getTwoFactorAuthenticationInfo:(0,s.slot)()},c={liveTwoFactorAuthenticationInfo:(0,i.H)()},d={getLoginStatus:(0,s.slot)(),getLocalAccounts:(0,s.slot)(),getIsSSOUser:(0,s.slot)(),getSSOMigrationInfo:(0,s.slot)(),getSessionInfo:(0,s.slot)(),getMasterPasswordAndServerKey:(0,s.slot)(),getUserCryptoSettings:(0,s.slot)(),getSyncInfo:(0,s.slot)(),getIsSyncInProgress:(0,s.slot)(),getPremiumStatus:(0,s.slot)(),getNodePremiumStatus:(0,s.slot)(),getSubscriptionInformation:(0,s.slot)(),getActiveSpaces:(0,s.slot)(),getSSOProviderInfo:(0,s.slot)(),getUserLogin:(0,s.slot)(),getPublicUserId:(0,s.slot)(),getAnalyticsInstallationId:(0,s.slot)(),getUserLoginStatus:(0,s.slot)(),getWebOnboardingMode:(0,s.slot)(),getIsPaymentFailureChurningDismissed:(0,s.slot)(),getCredentialSearchOrder:(0,s.slot)(),getDidOpen:(0,s.slot)(),getPlatformName:(0,s.slot)(),getAccountAuthenticationType:(0,s.slot)(),...o,...n},l={liveLoginStatus:(0,i.H)(),liveDidOpen:(0,i.H)(),liveIsSSOUser:(0,i.H)(),liveSSOMigrationInfo:(0,i.H)(),liveSessionInfo:(0,i.H)(),liveSyncInfo:(0,i.H)(),liveIsSyncInProgress:(0,i.H)(),livePremiumStatus:(0,i.H)(),liveServiceProviderUrl:(0,i.H)(),liveWebOnboardingMode:(0,i.H)(),liveSubscriptionInformation:(0,i.H)(),...a,...c},u={validateToken:(0,s.slot)(),validateMasterPassword:(0,s.slot)(),resetProtectedItemAutofillTimer:(0,s.slot)(),forceSync:(0,s.slot)(),updatePremiumChurningDismissDate:(0,s.slot)(),setCredentialSearchOrder:(0,s.slot)(),refreshSubscriptionInformation:(0,s.slot)(),updateAccountRecoveryKeyPersonalSettings:(0,s.slot)()}},43956:(e,t,r)=>{var s;r.d(t,{fE:()=>n,vX:()=>c}),function(e){e[e.NO_PREMIUM=0]="NO_PREMIUM",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_CANCELLED=2]="PREMIUM_CANCELLED",e[e.OLD_ACCOUNT=3]="OLD_ACCOUNT",e[e.NEW_USER=4]="NEW_USER",e[e.GRACE_PERIOD=5]="GRACE_PERIOD"}(s||(s={}));Object.freeze({freeTrialGranted:"free_trial_granted",premiumGranted:"premium_granted",renewed:"renewed",subscribed:"subscribed",crosssellPurchased:"crosssell_purchased",setAsLegacy:"set_as_legacy",familyCreated:"family_created",familyRenewed:"family_renewed"}),Object.freeze({Amazon:"amazon",FreeTrial:"free_trial",Invoice:"invoice",IOS:"ios",IOSRenewable:"ios_renewable",Legacy:"legacy",Mac:"mac",MacRenewable:"mac_renewable",Offer:"offer",Partner:"partner",Paypal:"paypal",PaypalRenewable:"paypal_renewable",Playstore:"playstore",PlaystoreRenewable:"playstore_renewable",Stripe:"stripe"});var i,o,a;!function(e){e[e.UNPAIRED=0]="UNPAIRED",e[e.PAIRED=1]="PAIRED"}(i||(i={})),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(o||(o={})),function(e){e.not_in_team="not_in_team",e.proposed="proposed",e.in_team="in_team"}(a||(a={}));Object.freeze({Premium:"premium",Essentials:"essentials",Premiumplus:"premiumplus",BackupForAll:"backup-for-all"}),Object.freeze({Team:"team",Business:"business",Legacy:"legacy",Entreprise:"entreprise",Free:"free",Starter:"starter",Standard:"standard"});var n,c,d;!function(e){e.Accepted="accepted",e.Pending="pending",e.Proposed="proposed",e.Refused="refused",e.Removed="removed",e.Revoked="revoked",e.Unproposed="unproposed"}(n||(n={})),function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(c||(c={})),function(e){e.NAME="name",e.DATE="date"}(d||(d={}))},38578:(e,t,r)=>{r.d(t,{H:()=>o,r:()=>i});var s=r(30504);const i={generatePassword:(0,s.slot)(),generateAndSavePassword:(0,s.slot)(),savePasswordGenerationSettings:(0,s.slot)()},o={getPasswordGenerationSettings:(0,s.slot)()}},73298:(e,t,r)=>{r.d(t,{P:()=>o,_:()=>i});var s=r(30504);const i={cancelAutoRenew:(0,s.slot)(),downloadCustomerInvoice:(0,s.slot)(),fetchInvoiceList:(0,s.slot)(),requestRefund:(0,s.slot)()},o={getInvoicesCount:(0,s.slot)(),getInvoiceList:(0,s.slot)(),getInvoiceListYears:(0,s.slot)()}},52860:(e,t,r)=>{r.d(t,{UW:()=>a,gQ:()=>o,qN:()=>n});var s=r(30504),i=r(55432);const o={disableCredentialProtection:(0,s.slot)(),unlockProtectedItems:(0,s.slot)()},a={vaultLockDate:(0,s.slot)()},n={liveVaultLockDate:(0,i.H)()}},77507:(e,t,r)=>{r.d(t,{$k:()=>o,EX:()=>n,q9:()=>a});var s=r(30504),i=r(55432);const o={activateAccountRecovery:(0,s.slot)(),setupMasterPasswordForRecovery:(0,s.slot)(),deactivateAccountRecovery:(0,s.slot)(),registerDeviceForRecovery:(0,s.slot)(),startAccountRecovery:(0,s.slot)(),sendRecoveryRequest:(0,s.slot)(),cancelRecoveryRequest:(0,s.slot)(),checkRecoveryRequestStatus:(0,s.slot)(),recoverUserData:(0,s.slot)(),checkDoesLocalRecoveryKeyExist:(0,s.slot)(),isRecoveryRequestPending:(0,s.slot)()},a={getRecoveryOptInSetting:(0,s.slot)(),getShouldShowFeatureActivationModal:(0,s.slot)(),getAccountRecoveryRequestCount:(0,s.slot)()},n={liveAccountRecoveryRequestCount:(0,i.H)()}},27794:(e,t,r)=>{r.d(t,{Ll:()=>a,i1:()=>o,uG:()=>n});var s=r(30504),i=r(55432);const o={getAllSharedItemIds:(0,s.slot)(),getMyAcceptedUserGroups:(0,s.slot)(),getSharingCapacity:(0,s.slot)(),getUserGroups:(0,s.slot)(),getUserGroup:(0,s.slot)(),getUserGroupMembers:(0,s.slot)(),getSharingUsers:(0,s.slot)(),getSharingUserPermissionLevel:(0,s.slot)()},a={liveAllSharedItemIds:(0,i.H)(),liveMyAcceptedUserGroups:(0,i.H)(),liveSharingCapacity:(0,i.H)(),liveUserGroups:(0,i.H)(),liveSharingUsers:(0,i.H)(),liveSharingUserPermissionLevel:(0,i.H)()},n={convertItemToDashlaneXml:(0,s.slot)(),convertDashlaneXmlToItem:(0,s.slot)(),shareItem:(0,s.slot)()}},73762:(e,t,r)=>{r.d(t,{N:()=>i,b:()=>o});var s=r(30504);const i={getIsRecoveryEnabled:(0,s.slot)()},o={getTeamInfo:(0,s.slot)(),computePlanPricing:(0,s.slot)()}},77253:(e,t,r)=>{r.d(t,{XJ:()=>o,dN:()=>a,hO:()=>n});var s=r(30504),i=r(55432);const o={getAdministrableUserGroup:(0,s.slot)(),getAdministrableUserGroups:(0,s.slot)(),isGroupNameAvailable:(0,s.slot)(),getAdminProvisioningKey:(0,s.slot)(),getMassDeploymentTeamKey:(0,s.slot)()},a={liveAdministrableUserGroup:(0,i.H)(),liveAdministrableUserGroups:(0,i.H)(),liveAdminProvisioningKey:(0,i.H)(),liveMassDeploymentTeamKey:(0,i.H)()},n={registerTeamDomain:(0,s.slot)(),completeTeamDomainRegistration:(0,s.slot)(),deactivateTeamDomain:(0,s.slot)(),getTeamDomains:(0,s.slot)(),getTeamDevice:(0,s.slot)(),listTeamDevices:(0,s.slot)(),deactivateTeamDevice:(0,s.slot)(),registerTeamDevice:(0,s.slot)(),registerTeamDeviceAccount:(0,s.slot)(),getEncryptionServiceConfig:(0,s.slot)(),generateAndSaveEncryptionServiceConfig:(0,s.slot)(),clearSelfHostedESSettings:(0,s.slot)(),getTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamSettings:(0,s.slot)(),parseMetadataFields:(0,s.slot)(),persistAdminProvisioningKey:(0,s.slot)(),persistMassDeploymentTeamKey:(0,s.slot)(),removeAdminProvisioningKey:(0,s.slot)(),createSSOConnectorConfig:(0,s.slot)(),generateSSOConnectorKey:(0,s.slot)(),startAuditLogsQuery:(0,s.slot)(),getAuditLogQueryResults:(0,s.slot)(),getRecoveryCodesAsTeamCaptain:(0,s.slot)(),createInviteLink:(0,s.slot)(),changeInviteLinkTeamKey:(0,s.slot)(),toggleInviteLink:(0,s.slot)(),getInviteLink:(0,s.slot)(),requestInviteLinkToken:(0,s.slot)(),getInviteLinkForAdmin:(0,s.slot)(),getLastADSyncDate:(0,s.slot)(),getSpecialUserGroupInviteValuesForMemberInTeam:(0,s.slot)(),getSpecialUserGroupRevision:(0,s.slot)()}},89210:(e,t,r)=>{r.d(t,{Kr:()=>n,Vz:()=>o,kh:()=>a});var s=r(30504),i=r(55432);const o={getVisibleUserMessages:(0,s.slot)(),getUserMessages:(0,s.slot)()},a={liveUserMessages:(0,i.H)(),liveVisibleUserMessages:(0,i.H)()},n={dismissUserMessages:(0,s.slot)(),addUserMessage:(0,s.slot)()}},71316:(e,t,r)=>{r.d(t,{T4:()=>o,fD:()=>a,lp:()=>n});var s=r(30504),i=r(55432);const o={getVpnAccount:(0,s.slot)(),getVpnCapabilitySetting:(0,s.slot)()},a={liveVpnAccount:(0,i.H)()},n={activateVpnAccount:(0,s.slot)(),clearVpnAccountErrors:(0,s.slot)(),completeVpnAccountActivation:(0,s.slot)()}},6936:(e,t,r)=>{r.d(t,{W:()=>f});var s=r(86952),i=r(74354),o=r(25029),a=r(66302),n=r(99059);class c extends((0,i.A)({scope:o.F.Device})){}class d extends((0,i.A)({scope:o.F.Device})){}class l extends((0,i.g)({scope:o.F.Device})){}var u;const p={...(u=a.z,Object.keys(u).reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Command`]:(0,i.A)({scope:o.F.Device})})),{})),CarbonCommand:c,CarbonLegacyLeelooCommand:d,MitigationDeleteGrapheneUserDataCommand:l};var m=r(23326),h=r(38344),g=r(78961);class v extends((0,n.k)({scope:o.F.Device})){}class _ extends((0,n.k)({scope:o.F.Device})){}var y,S;const E={...(y=h.r,S=g.z,[...Object.keys(y),...Object.keys(S)].reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Query`]:(0,n.k)({scope:o.F.Device})})),{})),CarbonStateQuery:v,CarbonStateListQuery:_},f=(0,s.Q)({name:"carbon-legacy",commands:p,queries:E,events:m.U3})},86252:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(67837),i=r(6936);class o extends((0,s.E)(i.W)){}(0,s.K)(i.W,o)},23326:(e,t,r)=>{r.d(t,{Dj:()=>a,E1:()=>n,U3:()=>c});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.Device})){}class a extends((0,s.d)({scope:i.F.Device})){}class n extends((0,s.d)({scope:i.F.Device})){}const c={CarbonCommandResultEvent:o,CarbonLegacyEvent:a,CarbonLegacyDeviceRemotelyDeleted:n}},44632:(e,t,r)=>{r.d(t,{fv:()=>q,QX:()=>Q,pz:()=>Y});var s=r(30504),i=r(55432);const o={getBreach:(0,s.slot)(),getBreaches:(0,s.slot)(),getBreachesPage:(0,s.slot)(),getBreachesPaginationToken:(0,s.slot)(),getBreachesUpdateStatus:(0,s.slot)()},a={liveBreach:(0,i.H)(),liveBreaches:(0,i.H)(),liveBreachesBatch:(0,i.H)(),liveBreachesUpdaterStatus:(0,i.H)()},n={updateBreachStatus:(0,s.slot)()},c={addCollection:(0,s.slot)(),deleteCollection:(0,s.slot)(),removeItemsFromCollections:(0,s.slot)(),updateCollection:(0,s.slot)()},d={addCredential:(0,s.slot)(),updateCredential:(0,s.slot)(),updateLinkedWebsites:(0,s.slot)()},l={getCredential:(0,s.slot)(),getCredentialCategories:(0,s.slot)(),getCredentials:(0,s.slot)(),getCredentialsByDomain:(0,s.slot)(),getCredentialsCount:(0,s.slot)(),getCredentialsPage:(0,s.slot)(),getCredentialsPaginationToken:(0,s.slot)(),getDashlaneDefinedLinkedWebsites:(0,s.slot)(),getShouldShowRequireMasterPassword:(0,s.slot)()},u={liveCredential:(0,i.H)(),liveCredentials:(0,i.H)(),liveCredentialsByDomain:(0,i.H)(),liveCredentialsBatch:(0,i.H)(),liveCredentialsCount:(0,i.H)()},p={getIsForcedDomainsEnabled:(0,s.slot)()},m={getPersonalDataExport:(0,s.slot)()},h={getGeneratedPassword:(0,s.slot)(),getGeneratedPasswordsCount:(0,s.slot)(),getGeneratedPasswords:(0,s.slot)(),getGeneratedPasswordsPage:(0,s.slot)(),getGeneratedPasswordsPaginationToken:(0,s.slot)()},g={liveGeneratedPasswordsCount:(0,i.H)(),liveGeneratedPasswords:(0,i.H)()},v={saveGeneratedPassword:(0,s.slot)()},_={addDriverLicense:(0,s.slot)(),editDriverLicense:(0,s.slot)()},y={addFiscalId:(0,s.slot)(),editFiscalId:(0,s.slot)()},S={addIdCard:(0,s.slot)(),editIdCard:(0,s.slot)()},E={addPassport:(0,s.slot)(),editPassport:(0,s.slot)()},f={addSocialSecurityId:(0,s.slot)(),editSocialSecurityId:(0,s.slot)()},A=(0,s.combineEvents)(_,y,S,E,f),I={getImportPersonalDataStatus:(0,s.slot)()},O={liveImportPersonalDataStatus:(0,i.H)()},b={importPersonalData:(0,s.slot)(),previewPersonalData:(0,s.slot)(),dismissPersonalDataImportNotifications:(0,s.slot)()},T={getPasskey:(0,s.slot)(),getPasskeys:(0,s.slot)(),getPasskeysForDomain:(0,s.slot)()},C={livePasskey:(0,i.H)(),livePasskeys:(0,i.H)()},w={addPasskey:(0,s.slot)(),updatePasskey:(0,s.slot)(),deletePasskey:(0,s.slot)()},R={getHasPasswordHistory:(0,s.slot)(),getPasswordHistoryPage:(0,s.slot)(),getPasswordHistoryPaginationToken:(0,s.slot)()},P={livePasswordHistoryBatch:(0,i.H)()},D={getPaymentCard:(0,s.slot)(),getPaymentCards:(0,s.slot)()},N={livePaymentCard:(0,i.H)(),livePaymentCards:(0,i.H)()},U={addPaymentCard:(0,s.slot)(),updatePaymentCard:(0,s.slot)(),deletePaymentCard:(0,s.slot)()},F={getSecureFilesQuota:(0,s.slot)(),getSecureFilesInfoList:(0,s.slot)(),getFileDownloadProgress:(0,s.slot)(),getFileUploadProgress:(0,s.slot)()},M={liveSecureFilesQuota:(0,i.H)(),liveFileDownloadProgress:(0,i.H)(),liveFileUploadProgress:(0,i.H)()},L={downloadSecureFile:(0,s.slot)(),chunkTransferDone:(0,s.slot)(),deleteSecureFile:(0,s.slot)(),addSecureFile:(0,s.slot)(),validateSecureFile:(0,s.slot)(),commitSecureFile:(0,s.slot)(),initSecureFilesStorageInfo:(0,s.slot)(),clearSecureFileState:(0,s.slot)()},G={setupDefaultNoteCategories:(0,s.slot)()},K={getNote:(0,s.slot)(),getNoteCategories:(0,s.slot)(),getNotes:(0,s.slot)(),getNotesPage:(0,s.slot)(),getNotesPaginationToken:(0,s.slot)()},x={liveNote:(0,i.H)(),liveNotes:(0,i.H)()},k={getAnonymousUserId:(0,s.slot)(),getIsUrlBanished:(0,s.slot)(),arePasswordsProtected:(0,s.slot)(),areRichIconsEnabled:(0,s.slot)()},j={liveArePasswordsProtected:(0,i.H)(),liveAreRichIconsEnabled:(0,i.H)()},V={toggleDashlane:(0,s.slot)(),updateProtectPasswordsSetting:(0,s.slot)(),updateAutofillSettings:(0,s.slot)(),updateRichIconsSetting:(0,s.slot)()},W={getSpace:(0,s.slot)(),getSpaces:(0,s.slot)()},B={disableVaultItemProtection:(0,s.slot)()},z={liveSecrets:(0,i.H)()},H={duplicateVaultItem:(0,s.slot)()},Y=(0,s.combineEvents)(o,l,p,h,I,K,T,R,D,F,k,W,{}),Q=(0,s.combineEvents)(a,u,g,O,x,C,P,N,z,M,j),q=(0,s.combineEvents)(n,c,d,m,v,A,b,w,U,L,G,V,B,H)},61476:(e,t,r)=>{r.d(t,{J:()=>n});var s=r(86952),i=r(46047),o=r(70219),a=r(26331);const n=(0,s.Q)({name:"permissions",commands:{addGroupManager:i.B,removeGroupManager:o.d},events:{},queries:{userPermissions:a.l}})},46047:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},70219:(e,t,r)=>{r.d(t,{d:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},26331:(e,t,r)=>{r.d(t,{l:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},23597:(e,t,r)=>{r.d(t,{B:()=>j});var s,i=r(88802),o=r(99634),a=r(61476),n=r(34710),c=r(93850),d=r(63663),l=r(46047),u=r(60399),p=r(57924),m=r(87113),h=r(86252),g=r(87279),v=r(48844);!function(e){e[e.GroupManager=0]="GroupManager"}(s||(s={}));let _=class{constructor(e,t){this.serverApiClient=e,this.carbonLegacyClient=t}async addRole({role:e,params:t}){if(e===s.GroupManager)return await this.addGroupManager(t)}async removeRole({role:e,params:t}){if(e===s.GroupManager)return await this.removeGroupManager(t)}async getSpecialUserGroupRevision(e){const{commands:{carbon:t}}=this.carbonLegacyClient,r=await t({name:"getSpecialUserGroupRevision",args:[{teamId:e}]});let s;if(!(0,g.d6)(r))throw r.error.error;{const{carbonResult:e}=r.data,{specialUserGroupRevision:t}=e;s=t}return s}async removeGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t);return await(0,u.z)(this.serverApiClient.v1.teams.removeGroupManager({memberLogin:e,userGroupRevision:r}).pipe((0,v.DZ)((e=>{throw new Error(e.message)})),(0,v.lk)((e=>{if(e.data)return(0,g.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to remove group manager")}))))}async addGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t),{commands:{carbon:s}}=this.carbonLegacyClient,i=await s({name:"getSpecialUserGroupInviteValuesForMemberInTeam",args:[{memberLogin:e,teamId:t}]});let o="",a="";if(!(0,g.d6)(i))throw i.error.error;{const{carbonResult:e}=i.data,{groupKey:t,proposeSignature:r}=e;o=t,a=r}return await(0,u.z)(this.serverApiClient.v1.teams.addGroupManager({memberLogin:e,groupKey:o,proposeSignature:a,userGroupRevision:r}).pipe((0,v.DZ)((e=>{throw new Error(e.message)})),(0,v.lk)((e=>{if(e.data)return(0,g.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to add group manager")}))))}};_=(0,i.__decorate)([(0,p.GS)(),(0,i.__metadata)("design:paramtypes",[m.l,h._])],_);let y=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.addRole({role:s.GroupManager,params:e})}};y=(0,i.__decorate)([(0,d.W)(l.B),(0,i.__metadata)("design:paramtypes",[_])],y);var S=r(70219);let E=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.removeRole({role:s.GroupManager,params:e})}};E=(0,i.__decorate)([(0,d.W)(S.d),(0,i.__metadata)("design:paramtypes",[_])],E);var f=r(26331),A=r(20754),I=r(43978),O=r(69885),b=r(87065),T=r(7165);const C=T.z.enum(["ALL","BILLING_EDIT","BILLING_READ","GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"]),w=C,R=T.z.array(C);var P=r(95681),D=r(23347),N=r(10722),U=r(25029);const F=e=>R.safeParse(e).success;class M extends((0,P.Q)({storage:{schemaVersion:1,initialValue:[],typeGuard:F},persist:!0,scope:U.F.User,storeName:"permissions-store",capacity:D.Y._010KB,codec:N.E})){}let L=class{constructor(e,t,r){this.carbon=e,this.serverApiClient=t,this.permissionsStore=r}async refreshState(){const{getActiveSpaces:e}=this.carbon.queries;return await(0,u.z)(e().pipe((0,I.w)((e=>{if(!(0,g.d6)(e))throw new Error("Cannot retrieve user spaces from carbon");return e.data.length?this.serverApiClient.v1.teams.getUserPermissions().pipe((0,b.U)((e=>{if((0,g.hx)(e))throw new Error(`getUserPermissions failed with error: ${e}`);this.permissionsStore.set(this.serverToDomainPermissionsMapper(e.data.data.permissions))}))):(0,O.of)(void 0)}))))}getActiveUserPermissions(){return this.permissionsStore.state$.pipe((0,b.U)(g.Vp))}serverToDomainPermissionsMapper(e){return e.filter((e=>w.safeParse(e).success))}};L=(0,i.__decorate)([(0,p.GS)(),(0,i.__metadata)("design:paramtypes",[h._,m.l,M])],L);let G=class{constructor(e){this.permissionsService=e}execute(){return this.permissionsService.getActiveUserPermissions()}};G=(0,i.__decorate)([(0,A.e)(f.l),(0,i.__metadata)("design:paramtypes",[L])],G);var K=r(5237),x=r(68307);let k=class{constructor(e){this.permissionsService=e}async handle(){await this.permissionsService.refreshState()}};k=(0,i.__decorate)([(0,x.b)(K.M),(0,i.__metadata)("design:paramtypes",[L])],k);let j=class{};j=(0,i.__decorate)([(0,o.Yl)({api:a.J,imports:[c.n],providers:[L,_],stores:[M],handlers:{commands:{addGroupManager:y,removeGroupManager:E},events:{...(0,o.g4)(n.Q,{sessionOpened:k})},queries:{userPermissions:G}}})],j)},36636:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(67837),i=r(29986);class o extends((0,s.E)(i.V)){}(0,s.K)(i.V,o)},29986:(e,t,r)=>{r.d(t,{V:()=>a});var s=r(86952),i=r(28096),o=r(75203);const a=(0,s.Q)({name:"authenticationFlow",commands:{changeLogin:o.hW,changeTwoFactorAuthenticationOtpType:o.eG,clearError:o.jq,cancelDeviceTransferRequest:o.Yc,resendEmailToken:o.Gc,resendPushNotification:o.rF,sendAccountEmail:o.A,sendMasterPassword:o.rT,submitPinCode:o.CO,submitBackupCode:o.sH,submitEmailToken:o.XH,submitTotp:o.ad,switchToDevicetoDeviceAuthentication:o.sU,switchToDashlaneAuthenticator:o.K1,switchToMasterPasswordCommand:o.On,switchToEmailToken:o.v5,switchToPinCode:o.WF,retryWebAuthnAuthentication:o.M6,webAuthnAuthenticationFail:o.O3,logout:o.N5,lockSession:o.Y$,loginViaSSO:o.yv,initiateLoginWithSSO:o.Hr,initiateAutologinWithSSOCommand:o.x2},queries:{authenticationFlowStatus:i.DW,getSsoUserSettings:i.Dc,getProviderInfo:i.L2},events:{}})},75203:(e,t,r)=>{r.d(t,{A:()=>o,CO:()=>n,Gc:()=>v,Hr:()=>T,K1:()=>l,M6:()=>f,N5:()=>I,O3:()=>A,On:()=>c,WF:()=>u,XH:()=>p,Y$:()=>O,Yc:()=>w,ad:()=>m,eG:()=>g,hW:()=>a,jq:()=>E,rF:()=>y,rT:()=>_,sH:()=>h,sU:()=>d,v5:()=>S,x2:()=>C,yv:()=>b});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}class a extends((0,s.g)({scope:i.F.Device})){}class n extends((0,s.g)({scope:i.F.Device})){}class c extends((0,s.g)({scope:i.F.Device})){}class d extends((0,s.g)({scope:i.F.Device})){}class l extends((0,s.g)({scope:i.F.Device})){}class u extends((0,s.g)({scope:i.F.Device})){}class p extends((0,s.g)({scope:i.F.Device})){}class m extends((0,s.g)({scope:i.F.Device})){}class h extends((0,s.g)({scope:i.F.Device})){}class g extends((0,s.g)({scope:i.F.Device})){}class v extends((0,s.g)({scope:i.F.Device})){}class _ extends((0,s.g)({scope:i.F.Device})){}class y extends((0,s.g)({scope:i.F.Device})){}class S extends((0,s.g)({scope:i.F.Device})){}class E extends((0,s.g)({scope:i.F.Device})){}class f extends((0,s.g)({scope:i.F.Device})){}class A extends((0,s.g)({scope:i.F.Device})){}class I extends((0,s.g)({scope:i.F.Device})){}class O extends((0,s.g)({scope:i.F.Device})){}class b extends((0,s.g)({scope:i.F.Device})){}class T extends((0,s.g)({scope:i.F.Device})){}class C extends((0,s.g)({scope:i.F.Device})){}class w extends((0,s.g)({scope:i.F.Device})){}},28096:(e,t,r)=>{r.d(t,{DW:()=>o,Dc:()=>a,L2:()=>n});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}class a extends((0,s.k)({scope:i.F.Device})){}class n extends((0,s.k)({scope:i.F.Device})){}},64496:(e,t,r)=>{var s,i,o;r.d(t,{E6:()=>i,UY:()=>o,ao:()=>a,hr:()=>s,vX:()=>n}),function(e){e.SSO="sso",e.MP="master_password"}(s||(s={})),function(e){e.WaitingForTransferRequest="WaitingForTransferRequest",e.DisplayInstructions="DisplayInstructions",e.LoadingPassphrase="LoadingPassphrase",e.DisplayPassphrase="DisplayPassphrase",e.LoadingAccount="LoadingAccount",e.Error="Error",e.DeviceRegistered="DeviceRegistered"}(i||(i={})),function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.TIMEOUT="TIMEOUT",e.REQUEST_REJECTED="REQUEST_REJECTED",e.ACCOUNT_ERROR="ACCOUNT_ERROR",e.RATE_LIMIT="RATE_LIMIT"}(o||(o={}));const a=e=>Object.values(o).includes(e);var n;!function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(n||(n={}))},66974:(e,t,r)=>{r.d(t,{n:()=>o});var s=r(86952),i=r(85373);const o=(0,s.Q)({name:"authentication",commands:{},events:{},queries:{canLockApp:i._}})},85373:(e,t,r)=>{r.d(t,{I:()=>o,_:()=>a});var s=r(99059),i=r(25029);const o="USER_NOT_LOGGED_IN";class a extends((0,s.k)({scope:i.F.User,noUserError:{tag:o}})){}},42853:(e,t,r)=>{r.d(t,{G:()=>n});var s=r(86952),i=r(319),o=r(96782),a=r(59463);const n=(0,s.Q)({name:"deviceRegistration",commands:{cleanRemotelyRemovedProfiles:i.L,registerDevice:o.J},events:{},queries:{localAccounts:a.a}})},25565:(e,t,r)=>{r.d(t,{z:()=>o});var s=r(67837),i=r(42853);class o extends((0,s.E)(i.G)){}(0,s.K)(i.G,o)},319:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},96782:(e,t,r)=>{r.d(t,{J:()=>n,Y:()=>a});var s=r(74354),i=r(25029),o=r(7165);const a=o.z.discriminatedUnion("with",[o.z.object({with:o.z.literal("token"),login:o.z.string(),token:o.z.string(),deviceName:o.z.optional(o.z.string()),ignoreAlreadyRegisteredError:o.z.optional(o.z.boolean())}),o.z.object({with:o.z.literal("authTicket"),login:o.z.string(),authTicket:o.z.string(),deviceName:o.z.optional(o.z.string()),ignoreAlreadyRegisteredError:o.z.optional(o.z.boolean())}),o.z.object({with:o.z.literal("deviceKeys"),login:o.z.string(),deviceName:o.z.optional(o.z.string()),ignoreAlreadyRegisteredError:o.z.optional(o.z.boolean()),deviceAccessKey:o.z.string(),deviceSecretKey:o.z.string(),settings:o.z.string(),userAnalyticsId:o.z.string(),serverKey:o.z.optional(o.z.string())})]);class n extends((0,s.g)({scope:i.F.Device})){}},59463:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},6218:(e,t,r)=>{r.d(t,{F:()=>u});var s=r(86952),i=r(53835),o=r(33969),a=r(97891),n=r(87041),c=r(55870),d=r(48214),l=r(81540);const u=(0,s.Q)({name:"deviceTransfer",commands:{refreshRequest:o.V,cancelRequest:a.b,approveRequest:n.G,rejectRequest:c.a,submitPassphraseChallenge:d.I,returnToDeviceSetupCommand:l.n},events:{},queries:{trustedDeviceFlowStatus:i.N}})},87041:(e,t,r)=>{r.d(t,{G:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},97891:(e,t,r)=>{r.d(t,{b:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},33969:(e,t,r)=>{r.d(t,{V:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},55870:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},81540:(e,t,r)=>{r.d(t,{n:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},48214:(e,t,r)=>{r.d(t,{I:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},53835:(e,t,r)=>{r.d(t,{N:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},70486:(e,t,r)=>{var s,i;r.d(t,{S:()=>s,T:()=>i}),function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.INVALID_PASSPHRASE="INVALID_PASSPHRASE",e.TIMEOUT="TIMEOUT",e.PASSPHRASE_ATTEMPTS_LIMIT="PASSPHRASE_ATTEMPTS_LIMIT"}(s||(s={})),function(e){e[e.WaitingForNewDeviceRequest=0]="WaitingForNewDeviceRequest",e[e.NewDeviceRequestAvailable=1]="NewDeviceRequestAvailable",e[e.DisplayPassphraseChallenge=2]="DisplayPassphraseChallenge",e[e.DeviceTransferComplete=3]="DeviceTransferComplete",e[e.LoadingChallenge=4]="LoadingChallenge",e[e.DeviceTransferRejected=5]="DeviceTransferRejected",e[e.Error=6]="Error"}(i||(i={}))},28760:(e,t,r)=>{var s;r.d(t,{T:()=>s}),function(e){e.AuthenticationWebPinUnlockProd="authentication_web_pincode_prod",e.PinCodeEnforcementAfterD2dArkDev="as_web_pincode_arkd2d_dev",e.PinCodeEnforcementAfterD2dArkRelease="as_web_pincode_arkd2d_release"}(s||(s={}))},11433:(e,t,r)=>{r.d(t,{i:()=>n});var s=r(86952),i=r(41025),o=r(13744),a=r(13089);const n=(0,s.Q)({name:"identityVerificationFlow",commands:{changeTwoFactorAuthenticationOtpType:o.eG,clearError:o.$5,resendEmailToken:o.Gc,resendPushNotification:o.rF,submitBackupCode:o.sH,submitEmailToken:o.XH,submitTotp:o.ad,switchToDashlaneAuthenticator:o.K1,switchToEmailToken:o.v5,startIdentityVerification:o.qw,cancelIdentityVerification:o.Vs},queries:{identityVerificationFlowStatus:i.O},events:{identityVerificationCompleted:a.w}})},13744:(e,t,r)=>{r.d(t,{$5:()=>a,Gc:()=>n,K1:()=>p,Vs:()=>g,XH:()=>d,ad:()=>u,eG:()=>o,qw:()=>h,rF:()=>c,sH:()=>l,v5:()=>m});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}class a extends((0,s.g)({scope:i.F.Device})){}class n extends((0,s.g)({scope:i.F.Device})){}class c extends((0,s.g)({scope:i.F.Device})){}class d extends((0,s.g)({scope:i.F.Device})){}class l extends((0,s.g)({scope:i.F.Device})){}class u extends((0,s.g)({scope:i.F.Device})){}class p extends((0,s.g)({scope:i.F.Device})){}class m extends((0,s.g)({scope:i.F.Device})){}class h extends((0,s.g)({scope:i.F.Device})){}class g extends((0,s.g)({scope:i.F.Device})){}},13089:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.Device})){}},41025:(e,t,r)=>{r.d(t,{O:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},81822:(e,t,r)=>{r.d(t,{l:()=>o});var s=r(67837),i=r(11433);class o extends((0,s.E)(i.i)){}(0,s.K)(i.i,o)},12436:(e,t,r)=>{r.r(t),r.d(t,{CancelIdentityVerificationCommand:()=>i.Vs,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>i.eG,ClearIdentityVerificationErrorCommand:()=>i.$5,IdentityVerificationClient:()=>a.l,IdentityVerificationCompletedEvent:()=>n.w,IdentityVerificationFlowStatusQuery:()=>o.O,ResendEmailTokenCommand:()=>i.Gc,ResendPushNotificationCommand:()=>i.rF,StartIdentityVerificationCommand:()=>i.qw,SubmitBackupCodeCommand:()=>i.sH,SubmitEmailTokenCommand:()=>i.XH,SubmitTotpCommand:()=>i.ad,SwitchToDashlaneAuthenticatorCommand:()=>i.K1,SwitchToEmailTokenCommand:()=>i.v5,identityVerificationFlowApi:()=>s.i});var s=r(11433),i=r(13744),o=r(41025),a=r(81822),n=r(13089)},36272:(e,t,r)=>{r.r(t),r.d(t,{ActivateCommand:()=>R.r,AuthenticationClient:()=>k,AuthenticationFeatureFlips:()=>L.T,AuthenticationFlowContracts:()=>s,CanLockAppQuery:()=>K._,CleanRemotelyRemovedProfilesCommand:()=>O.L,DeactivateCommand:()=>P.E,DeviceRegistrationClient:()=>C.z,DeviceTransferContracts:()=>i,GetCurrentUserStatusQuery:()=>U.o,GetStatusQuery:()=>N.D,IdentityVerificationFlowContracts:()=>l,LocalAccountsQuery:()=>T.a,LoginWithPinCodeCommand:()=>D.cM,NO_ACTIVE_PIN_CODE:()=>D.DN,PinCodeClient:()=>F.u,PinCodeServerApiConfig:()=>M,RegisterDeviceCommand:()=>b.J,Request2FaCodesByPhoneCommand:()=>f.x,Request2FaCodesByPhoneErrorCodes:()=>A.A,USER_NOT_LOGGED_IN:()=>K.I,ValidateWebauthnAssertionCommand:()=>f.L,WRONG_PIN_CODE:()=>D.Vh,authenticationApi:()=>G.n,createNoActivePinCodeError:()=>D.Zs,createWrongPinCodeError:()=>D.g5,deviceRegistrationApi:()=>I.G,pinCodeApi:()=>w.n,registrationSchema:()=>b.Y,userVerificationApi:()=>E.M});var s={};r.r(s),r.d(s,{AuthenticationFlowClient:()=>d.e,AuthenticationFlowStatusQuery:()=>n.DW,CancelDeviceTransferRequestCommand:()=>a.Yc,ChangeAccountEmailCommand:()=>a.hW,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>a.eG,ClearErrorCommand:()=>a.jq,DeviceToDeviceAuthenticationErrors:()=>c.UY,DeviceToDeviceAuthenticationFlowStep:()=>c.E6,GetSsoProviderInfoQuery:()=>n.L2,GetSsoUserSettingsQuery:()=>n.Dc,InitiateAutologinWithSSOCommand:()=>a.x2,InitiateLoginWithSSOCommand:()=>a.Hr,LockCommand:()=>a.Y$,LoginViaSSOCommand:()=>a.yv,LogoutCommand:()=>a.N5,ResendEmailTokenCommand:()=>a.Gc,ResendPushNotificationCommand:()=>a.rF,RetryWebAuthnAuthenticationCommand:()=>a.M6,SSOMigrationType:()=>c.vX,SendAccountEmailCommand:()=>a.A,SendMasterPasswordCommand:()=>a.rT,SsoMigrationServerMethod:()=>c.hr,SubmitBackupCodeCommand:()=>a.sH,SubmitEmailTokenCommand:()=>a.XH,SubmitPinCodeCommand:()=>a.CO,SubmitTotpCommand:()=>a.ad,SwitchToDashlaneAuthenticatorCommand:()=>a.K1,SwitchToDevicetoDeviceAuthenticationCommand:()=>a.sU,SwitchToEmailTokenCommand:()=>a.v5,SwitchToMasterPasswordCommand:()=>a.On,SwitchToPinCodeCommand:()=>a.WF,WebAuthnAuthenticationFailCommand:()=>a.O3,authenticationFlowApi:()=>o.V,isDeviceToDeviceAuthenticationError:()=>c.ao});var i={};r.r(i),r.d(i,{ApproveDeviceTransferRequestCommand:()=>m.G,CancelRequestCommand:()=>v.b,RefreshRequestCommand:()=>p.V,RejectDeviceTransferRequestCommand:()=>h.a,ReturnToDeviceSetupCommand:()=>_.n,SubmitPassphraseChallengeCommand:()=>g.I,TrustedDeviceFlowErrors:()=>S.S,TrustedDeviceFlowStatusQuery:()=>y.N,TrustedDeviceFlowStep:()=>S.T,deviceTransferApi:()=>u.F});var o=r(29986),a=r(75203),n=r(28096),c=r(64496),d=r(36636),l=r(12436),u=r(6218),p=r(33969),m=r(87041),h=r(55870),g=r(48214),v=r(97891),_=r(81540),y=r(53835),S=r(70486),E=r(69401),f=r(11088),A=r(83853),I=r(42853),O=r(319),b=r(96782),T=r(59463),C=r(25565),w=r(89033),R=r(85035),P=r(44878),D=r(73675),N=r(35941),U=r(67160),F=r(42303);class M{constructor(e){this.env=e}}var L=r(28760),G=r(66974),K=r(85373),x=r(67837);class k extends((0,x.E)(G.n)){}(0,x.K)(G.n,k)},89033:(e,t,r)=>{r.d(t,{n:()=>d});var s=r(86952),i=r(85035),o=r(44878),a=r(73675),n=r(35941),c=r(67160);const d=(0,s.Q)({name:"pinCode",commands:{activate:i.r,deactivate:o.E,loginWithPinCode:a.cM},events:{},queries:{getStatus:n.D,getCurrentUserStatus:c.o}})},42303:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(67837),i=r(89033);class o extends((0,s.E)(i.n)){}(0,s.K)(i.n,o)},85035:(e,t,r)=>{r.d(t,{r:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},44878:(e,t,r)=>{r.d(t,{E:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},73675:(e,t,r)=>{r.d(t,{DN:()=>c,Vh:()=>a,Zs:()=>d,cM:()=>l,g5:()=>n});var s=r(74354),i=r(25029),o=r(96168);const a="WRONG_PIN_CODE",n=(0,o.Vj)(a,"Entered pin-code is not correct"),c="NO_ACTIVE_PIN_CODE",d=(0,o.Vj)(c,"User has no active pin-code");class l extends((0,s.g)({scope:i.F.Device})){}},67160:(e,t,r)=>{r.d(t,{o:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},35941:(e,t,r)=>{r.d(t,{D:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},83853:(e,t,r)=>{var s;r.d(t,{A:()=>s}),function(e){e.AccountNotEligible="AccountNotEligible",e.NetworkError="NetworkError"}(s||(s={}))},69401:(e,t,r)=>{r.d(t,{M:()=>o});var s=r(86952),i=r(11088);const o=(0,s.Q)({name:"userVerification",commands:{validateWebauthnAssertion:i.L,request2FaCodesByPhone:i.x},queries:{},events:{}})},11088:(e,t,r)=>{r.d(t,{L:()=>o,x:()=>a});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}class a extends((0,s.g)({scope:i.F.Device})){}},76561:(e,t,r)=>{r.d(t,{c:()=>Vt});var s=r(88802),i=r(60399),o=r(29986),a=r(6936),n=r(86252),c=r(99634),d=r(38679),l=r(9671),u=r(55300),p=r(59894),m=r(87279),h=r(93850),g=r(43673),v=r(8362),_=r(25029),y=r(95681),S=r(87065);const E=e=>!0;class f extends((0,y.Q)({initialValue:void 0,persist:!1,scope:_.F.Device,storeName:"authentication-flow-machine",storeTypeGuard:E})){}var A=r(23347),I=r(10722);const O=e=>!(!e||"object"!=typeof e)&&"rememberMeForSSOPreference"in e;class b extends((0,y.Q)({codec:I.E,persist:!0,storage:{initialValue:{rememberMeForSSOPreference:!0},schemaVersion:1,typeGuard:O},scope:_.F.Device,storeName:"sso-info",storeTypeGuard:O,capacity:A.Y._001KB})){}const T=e=>!0;class C extends((0,y.Q)({persist:!1,initialValue:{},scope:_.F.Device,storeName:"sso-provider-info",storeTypeGuard:T,capacity:A.Y._001KB})){}var w=r(63663),R=r(75203),P=r(78065),D=r(20916),N=r(57924),U=r(53446),F=r(37294);class M{constructor(e,t){this.interpreter=e,this.carbon=t}execute(){try{const{carbonState:e}=this.carbon.queries;e({path:"userSession.loginDeviceLimitFlow.flow"}).pipe((0,S.U)((e=>{if("success"===e.tag)return e.data}))).subscribe((e=>{Boolean(this.lastDeviceLimitFlowValue)&&!e&&this.interpreter.send({type:"DEVICE_LIMIT_ABORTED"}),this.lastDeviceLimitFlowValue=e}))}catch(e){return Promise.reject(new Error("Unable to subscribe to loginDeviceLimitFlow state"))}}}var L=r(65865),G=r(18275),K=r(48038),x=r(15187);class k extends x.x{}var j=r(89358);let V=class{constructor(e,t){this.carbon=e,this.session=t}async executeWithParams({login:e,masterPassword:t,isRememberMeEnabled:r,serverKey:s}){try{const o=await(0,i.z)(this.session.queries.createdSessionsState());if(!(0,m.d6)(o))throw new Error("Failure querying the session module to get the sessions");if(e in o.data){const i=await this.session.commands.openUserSession({email:e,rememberPassword:r,sessionKey:{type:"mp",masterPassword:t,secondaryKey:s}});if(!(0,m.d6)(i))throw new Error("Failed to open session");return Promise.resolve()}const a=await this.carbon.commands.openSessionWithMasterPassword({login:e,password:t,rememberPassword:r,requiredPermissions:void 0,loginType:"MasterPassword"});if(!(0,m.d6)(a))throw new Error("Failed to open session in carbon");return Promise.resolve()}catch(e){if(e instanceof Error){if(("exception"in e&&e.exception instanceof Error?e.exception.message:e.message).includes("WRONG_PASSWORD on openSessionWithMasterPassword"))return Promise.reject(new k)}return Promise.reject(new Error("UNKNOWN_ERROR"))}}};V=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._,j.x])],V);let W=class{constructor(e){this.carbonLegacy=e}async execute(){try{const e=await this.carbonLegacy.commands.carbon({name:"checkDoesLocalRecoveryKeyExist",args:[]});if(!(0,m.d6)(e))throw new Error("Carbon command failed");return{isAccountRecoveryAvailable:e.data.carbonResult.doesExist}}catch(e){return{isAccountRecoveryAvailable:!1}}}};W=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],W);var B=r(18533),z=r(20195),H=r(87113),Y=r(64496);const Q=e=>"object"==typeof e&&"type"in e,q=e=>{if(e)switch(e){case"sso_member_to_admin":case"sso_member_to_mp_user":return Y.vX.SSO_TO_MP;case"mp_user_to_sso_member":return Y.vX.MP_TO_SSO;default:return}};let $=class{constructor(e,t){this.ssoProviderInfoStore=e,this.serverApiClient=t,this.ssoProviderInfoStore=e,this.serverApiClient=t}async getSsoMigration(e){const t=await(0,i.z)(this.serverApiClient.v1.authentication.getAuthenticationMethodsForDevice({login:e,methods:["email_token","totp","duo_push","dashlane_authenticator","u2f"]}));if((0,m.hx)(t))return(0,B.EQ)(t.error,{FetchFailedError:()=>{},BusinessError:()=>(0,z.j)("Retrieve of verificationMethods failed"),InternalServerError:()=>(0,z.j)("Retrieve of verificationMethods failed"),InvalidRequest:()=>(0,z.j)("Retrieve of verificationMethods failed"),RateLimited:()=>(0,z.j)("Retrieve of verificationMethods failed"),ServiceUnavailable:()=>(0,z.j)("Retrieve of verificationMethods failed"),UnspecifiedBadStatus:()=>(0,z.j)("Retrieve of verificationMethods failed")});const r=t.data.data.verifications.find(Q);if(!r)throw new Error("No valid verification method");return"sso"===r.type?{serviceProviderUrl:r.ssoInfo.serviceProviderUrl,isNitroProvider:r.ssoInfo.isNitroProvider,migration:r.ssoInfo.migration}:void 0}async executeWithParams({login:e}){const t=await this.getSsoMigration(e);if(t)return await this.ssoProviderInfoStore.set({isNitroProvider:t.isNitroProvider??!1,serviceProviderUrl:t.serviceProviderUrl,migrationType:q(t.migration)}),{serviceProviderRedirectUrl:t.serviceProviderUrl,isNitroProvider:t.isNitroProvider}}};$=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[C,H.l])],$);let X=class{constructor(e){this.session=e}async executeWithParams(e){const t=await(0,i.z)(this.session.queries.checkSessionKey({email:e.login,sessionKey:{type:"mp",masterPassword:e.masterPassword,secondaryKey:e.serverKey}}));if(!(0,m.d6)(t))throw new Error("Error verifying SK");if(t.data)return!0;throw new k}};X=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[j.x])],X);let Z=class{constructor(e,t,r,s){this.accountRecoveryStatusService=e,this.masterPasswordService=t,this.checkIsMigrationNeededService=r,this.mpVerificationService=s}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"CheckingAccountRecoveryStatus",id:"MasterPasswordFlowMachine",context:{isRememberMeEnabled:!1,isAccountRecoveryAvailable:!1},states:{CheckingAccountRecoveryStatus:{invoke:{src:"checkAccountRecoveryStatus",onDone:{target:"WaitingForMasterPassword",actions:["assignAccountRecoveryStatus"]}}},WaitingForMasterPassword:{on:{INPUT_MASTER_PASSWORD:{target:"ValidatingMasterPassword",actions:["assignMasterPassword"]},SWITCH_TO_PIN_CODE:{target:"#AuthenticationFlowMachine.PinCode",cond:"hasPinCodeEnabled"},CARBON_WRONG_PASSWORD:{actions:["assignMpError"]}}},ValidatingMasterPassword:{invoke:{src:"validateMasterPassword",onDone:{target:"OpeningSessionWithMasterpassword"},onError:{actions:["assignMaybeMpError"],target:"WaitingForMasterPassword"}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},CARBON_WRONG_PASSWORD:{actions:["assignMpError"],target:"WaitingForMasterPassword"}}},OpeningSessionWithMasterpassword:{invoke:{src:"authenticateWithMasterPassword",onError:{actions:["assignMaybeMpError"],target:"WaitingForMasterPassword"},onDone:{target:"CheckingMigrationNeeded"},CARBON_WRONG_PASSWORD:{actions:["assignMpError"],target:"WaitingForMasterPassword"}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},DEVICE_LIMIT_ABORTED:{target:"DeviceLimitAborted"}}},CheckingMigrationNeeded:{invoke:{src:"checkIsMigrationNeeded",onDone:{target:"MasterPasswordDone",actions:["assignSSOMigrationStatus"]},onError:{target:"WaitingForMasterPassword",actions:["assignGenericServiceError"]}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]}}},DeviceLimitAborted:{type:"final",data:{shouldResetAuthenticationFlow:!0}},MasterPasswordDone:{type:"final",data:{shouldResetAuthenticationFlow:!1}}}},options:{actions:{assignMasterPassword:(0,L.f0)({masterPassword:(e,t)=>t.masterPassword,isRememberMeEnabled:(e,t)=>t.rememberMe}),assignAccountRecoveryStatus:(0,L.f0)({isAccountRecoveryAvailable:(e,t)=>t.data.isAccountRecoveryAvailable}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignGenericServiceError:(0,L.f0)({error:()=>({code:"unknown_error",data:{message:"UNKNOWN_ERROR"}})}),assignMpError:(0,L.f0)({error:()=>({code:"unknown_error",data:{message:"WRONG_PASSWORD"}})}),assignMaybeMpError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.data instanceof k?"WRONG_PASSWORD":"UNKNOWN_ERROR"}})}),assignSSOMigrationStatus:(0,L.f0)({serviceProviderRedirectUrl:(e,t)=>t.data?.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.data?.isNitroProvider})},services:{authenticateWithMasterPassword:e=>{const{login:t,masterPassword:r,isRememberMeEnabled:s,serverKey:i}=e;return this.masterPasswordService.executeWithParams({login:t??"",masterPassword:r??"",isRememberMeEnabled:s,serverKey:i})},checkAccountRecoveryStatus:()=>this.accountRecoveryStatusService.execute(),checkIsMigrationNeeded:e=>this.checkIsMigrationNeededService.executeWithParams({login:e.login??""}),validateMasterPassword:({login:e,masterPassword:t,serverKey:r})=>this.mpVerificationService.executeWithParams({login:e??"",masterPassword:t??"",serverKey:r})},guards:{hasPinCodeEnabled:e=>e.shouldAskPinCode}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};Z=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[W,V,$,X])],Z);let J=class{constructor(e){this.carbonLegacy=e}async execute(e){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionResendToken",arg:[{login:e.login??""}]}),Promise.resolve()}catch(e){}}};J=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],J);let ee=class{constructor(e){this.carbonLegacy=e}async requestCodeAgainstServer(){}async execute({login:e}){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithDashlaneAuthenticator",arg:[{login:e,password:null,persistData:!0,deviceName:""}]}),Promise.resolve()}async cancel(){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"cancelDashlaneAuthenticatorRegistration",arg:[]}),Promise.resolve()}};ee=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],ee);let te=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator"},on:{CARBON_LEGACY_ERROR:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]},RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["cancelDashlaneAuthenticator","clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,L.f0)({error:()=>{}}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),switchToEmailToken:(0,L.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,L.f0)({isDashlaneAuthenticatorAvailable:!0}),cancelDashlaneAuthenticator:()=>{this.dashlaneAuthenticatorService.cancel()},sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};te=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[ee,J])],te);let re=class{constructor(e){this.carbonLegacy=e}async execute(e){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithToken",arg:[{login:e.login??"",password:null,token:e.emailToken??"",persistData:!0,deviceName:e.deviceName}]})}catch(e){}}};re=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],re);let se=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"WaitingForEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{entry:["authenticateWithEmailToken"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{clearError:(0,L.f0)({error:()=>{}}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignEmailToken:(0,L.f0)({emailToken:(e,t)=>t.emailToken}),authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:s}=e;return this.authenticateWithEmailToken.execute({deviceName:t,emailToken:r,login:s})}},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};se=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[re,J])],se);const ie=e=>({initial:e.initial,states:e.states,on:e.on??{}});let oe=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...ie(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...ie(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,L.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};oe=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[te,se])],oe);let ae=class{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{},initial:"InitWebAuthnAuthentication",states:{InitWebAuthnAuthentication:{on:{WEBAUTHN_AUTHENTICATION_FAIL:{target:"WebAuthnAuthenticationFailed",actions:["assignWebAuthnError"]}}},WebAuthnAuthenticationFailed:{on:{RETRY_WEBAUTHN_AUTHENTICATION:{target:"InitWebAuthnAuthentication",actions:["clearError"]}}},WebAuthnAuthenticationDone:{type:"final",data:{switchToMasterPassword:!1,switchToPinCode:!1}},MasterPasswordRequested:{type:"final",data:{switchToMasterPassword:!0,switchToPinCode:!1}},PinCodeRequested:{type:"final",data:{switchToMasterPassword:!1,switchToPinCode:!0}}},on:{USE_MASTER_PASSWORD:{actions:["clearError"],target:".MasterPasswordRequested",internal:!0},SWITCH_TO_PIN_CODE:{actions:["clearError"],target:".PinCodeRequested",internal:!0}}},options:{actions:{clearError:(0,L.f0)({error:()=>{}}),assignWebAuthnError:(0,L.f0)({error:(e,t)=>t.error})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};ae=(0,s.__decorate)([(0,N.GS)()],ae);let ne=class{constructor(e){this.carbonLegacy=e}executeWithParams({login:e,masterPassword:t,otp:r,twoFactorAuthenticationOtpType:s,otpVerificationMode:i,deviceName:o}){const a={login:e,password:t??null,otp:r,withBackupCode:"backupCode"===s,persistData:!0};try{"otp2"===i?this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTP",arg:[{...a,deviceName:o}]}):"otp1"===i&&this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTPForNewDevice",arg:[a]})}catch(e){}return Promise.resolve()}};ne=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],ne);let ce=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{entry:["authenticateWithTwoFactorAuthentication"],on:{CARBON_LEGACY_ERROR:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),clearError:(0,L.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,L.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,L.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType}),authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};this.twoFactorAuthenticationService.executeWithParams(t)}},services:{},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};ce=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[ne])],ce);var de=r(10430),le=r(10551),ue=r(16053);let pe=class{constructor(e){this.d2dAuthenticationService=e}async execute({login:e}){const t=le.getDefaultDeviceName();if(!e||!t)throw new de.z("No user login/device name",Y.UY.GENERIC_ERROR);const r=await this.d2dAuthenticationService.requestTransfer(e,t);if((0,m.hx)(r))throw new de.z("Request transfer error",Y.UY.GENERIC_ERROR);const{transferId:s,expireDateUnix:i}=r.data;return Promise.resolve({transferId:s,expireDateUnix:i})}};pe=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[ue.C])],pe);var me=r(15652);let he=class{constructor(e,t){this.d2dCryptoService=e,this.d2dAuthenticationService=t}async execute({transferId:e}){if(!e)throw new de.z("No transferId in context",Y.UY.GENERIC_ERROR);const{privateKey:t,publicKey:r}=this.d2dCryptoService.generateKeyPair(),s=this.d2dCryptoService.hash(r),i=await this.d2dAuthenticationService.startReceiverKeyExchange(e,s);if((0,m.hx)(i))return Promise.reject(i.error);const{senderPublicKey:o}=i.data;return Promise.resolve({receiverPrivateKey:t,receiverPublicKey:r,senderPublicKey:o})}};he=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[me.q,ue.C])],he);let ge=class{constructor(e){this.d2dAuthenticationService=e}async execute(e){if(!e.transferId||!e.login)throw new de.z("No transferId or user login in the machine context",Y.UY.GENERIC_ERROR);const t=await this.d2dAuthenticationService.startTransfer(e.transferId);return(0,m.hx)(t)?Promise.reject(t.error):Promise.resolve(t.data)}};ge=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[ue.C])],ge);let ve=class{constructor(e,t){this.d2dCryptoService=e,this.d2dAuthenticationService=t}async execute(e){if(!e.transferId||!e.login)throw new de.z("No transferId or user login in the machine context",Y.UY.GENERIC_ERROR);if(!e.receiverPrivateKey||!e.receiverPublicKey||!e.senderPublicKey)throw new de.z("Missing keys/data in context",Y.UY.GENERIC_ERROR);if(!e.sharedSecret)throw new de.z("Missing sharedSecret in context",Y.UY.GENERIC_ERROR);if(!e.encryptedData||!e.nonce)throw new de.z("Missing transfer data in context",Y.UY.GENERIC_ERROR);const t=this.d2dCryptoService.generateSymmetricKey(e.login,e.transferId,e.sharedSecret),r=this.d2dCryptoService.decryptInvisibleMasterPassword(e.encryptedData,e.nonce,t);await this.d2dAuthenticationService.openSession(r.login,r.token,r.key.value,e.deviceName)}};ve=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[me.q,ue.C])],ve);var _e=r(69605);let ye=class{constructor(e,t,r){this.d2dCryptoService=e,this.d2dAuthenticationService=t,this.passphraseService=r}async execute(e){if(!e.receiverPrivateKey||!e.receiverPublicKey||!e.senderPublicKey)throw new de.z("Keys not found in the state machine context",Y.UY.GENERIC_ERROR);if(!e.transferId)throw new de.z("TransferId not found in the state machine context/store",Y.UY.GENERIC_ERROR);if(!e.login)throw new de.z("User login not found in state machine context/store",Y.UY.GENERIC_ERROR);const t=await this.d2dAuthenticationService.completeKeyExchange(e.transferId,e.receiverPublicKey);if((0,m.hx)(t))throw new de.z("Error with completeKeyExchange",Y.UY.GENERIC_ERROR);const r=this.d2dCryptoService.generateReceiverSharedSecret(e.receiverPublicKey,e.receiverPrivateKey,e.senderPublicKey),s=this.d2dCryptoService.generateVisualCheckSeed(e.login,e.transferId,r),{passphrase:i}=await this.passphraseService.generatePassphraseChallenge(s);return Promise.resolve({sharedSecret:r,passphrase:i})}};ye=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[me.q,ue.C,_e.Kp])],ye);let Se=class{constructor(e,t,r,s,i){this.requestDeviceTransfer=e,this.startReceiverKeyExchange=t,this.completeKeyExchangeAndGeneratePassphrase=r,this.startTransfer=s,this.openSession=i}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"DeviceToDeviceAuthenticationFlow",initial:"WaitingForTransferRequest",context:{transferId:void 0},states:{WaitingForTransferRequest:{invoke:{src:"requestDeviceTransfer",onDone:{target:"DisplayInstructions",actions:["assignTransferId"]},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},DisplayInstructions:{invoke:{src:"startReceiverKeyExchange",onDone:{actions:["assignKeys"],target:"GeneratePassphrase"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},GeneratePassphrase:{invoke:{src:"completeKeyExchangeAndGeneratePassphrase",onDone:{actions:["assignPassphrase"],target:"StartTransfer"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},StartTransfer:{invoke:{src:"startTransfer",onDone:{actions:["assignTransferData"],target:"OpenSession"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},OpenSession:{invoke:{src:"openSession",onDone:{target:"DeviceRegistered"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},DeviceTransferError:{},DeviceRegistered:{type:"final"}}},options:{actions:{assignTransferId:(0,L.f0)({transferId:(e,t)=>t.data.transferId}),assignKeys:(0,L.f0)({receiverPublicKey:(e,t)=>t.data.receiverPublicKey,receiverPrivateKey:(e,t)=>t.data.receiverPrivateKey,senderPublicKey:(e,t)=>t.data.senderPublicKey}),assignPassphrase:(0,L.f0)({passphrase:(e,t)=>t.data.passphrase,sharedSecret:(e,t)=>t.data.sharedSecret}),assignTransferData:(0,L.f0)({encryptedData:(e,t)=>t.data.encryptedData,nonce:(e,t)=>t.data.nonce}),clearContext:(0,L.f0)({deviceName:()=>{},transferId:()=>{},receiverPublicKey:()=>{},receiverPrivateKey:()=>{},senderPublicKey:()=>{},sharedSecret:()=>{},passphrase:()=>{}}),assignDeviceToDeviceError:(0,L.f0)({error:(e,t)=>t.data instanceof de.z?t.data.code:Y.UY.GENERIC_ERROR})},services:{requestDeviceTransfer:e=>this.requestDeviceTransfer.execute(e),startReceiverKeyExchange:e=>this.startReceiverKeyExchange.execute(e),completeKeyExchangeAndGeneratePassphrase:e=>this.completeKeyExchangeAndGeneratePassphrase.execute(e),startTransfer:e=>this.startTransfer.execute(e),openSession:e=>this.openSession.execute(e)}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};Se=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[pe,he,ye,ge,ve])],Se);var Ee=r(42303);class fe extends x.x{constructor(){super("Entered PIN code is wrong")}}let Ae=class{constructor(e){this.pinCodeClient=e}async executeWithParams({loginEmail:e,pinCode:t}){if(!e)throw new Error("No login email");const r=await this.pinCodeClient.commands.loginWithPinCode({email:e,pinCode:t});return(0,m.hx)(r)?Promise.reject((0,B.EQ)(r.error,{NO_ACTIVE_PIN_CODE:()=>new Error("No active pin code"),WRONG_PIN_CODE:()=>new fe})):Promise.resolve()}};Ae=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[Ee.u])],Ae);let Ie=class{constructor(e){this.pinCodeVerificationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"PinCodeMachine",context:{pinCode:""},initial:"WaitingForPinCode",states:{WaitingForPinCode:{on:{INPUT_PIN_CODE:{target:"ValidatingPinCode",actions:["assignPinCode"]},USE_MASTER_PASSWORD:{target:"#AuthenticationFlowMachine.MasterPassword"},USE_DEVICE_TO_DEVICE_AUTHENTICATION:{target:"#AuthenticationFlowMachine.DeviceToDeviceAuthentication"}}},ValidatingPinCode:{invoke:{src:"validatePinCode",onDone:{target:"PinCodeDone"},onError:{actions:["assignPinCodeError"],target:"WaitingForPinCode"}}},PinCodeDone:{type:"final"}}},options:{actions:{assignPinCode:(0,L.f0)({pinCode:(e,t)=>t.pinCode}),assignPinCodeError:(0,L.f0)({error:(e,t)=>({code:t.data instanceof fe?"wrong_pin_code":"unknown_error"})}),clearError:(0,L.f0)({error:()=>{}}),clearContext:(0,L.f0)({pinCode:()=>"",error:()=>{}})},services:{validatePinCode:e=>this.pinCodeVerificationService.executeWithParams({loginEmail:e.login,pinCode:e.pinCode})},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,G.C)(e,t)}};Ie=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[Ae])],Ie);var Oe=r(41842);let be=class{constructor(e,t){this.carbonLegacyClient=e,this.pinCodeClient=t}retrieveLocalAccounts(){return(0,i.z)(this.carbonLegacyClient.queries.carbonState({path:"authentication.localAccounts"}).pipe((0,Oe.h)(m.d6),(0,Oe.h)((e=>e.data.accountsListInitialized)),(0,S.U)((e=>e.data.accountsList))))}async getPinCodeStatus(e){if(!e)return!1;const t=await(0,i.z)(this.pinCodeClient.queries.getStatus({loginEmail:e}));return!(0,m.hx)(t)&&t.data.isPinCodeEnabled}async execute(){const e=await this.retrieveLocalAccounts(),t=e?.find((e=>e.isLastSuccessfulLogin)),r=await this.getPinCodeStatus(t?.login);return{localAccounts:e??[],lastUsedLogin:t?.login??"",shouldAskMasterPassword:t?.shouldAskMasterPassword??!1,shouldAskPinCode:r,shouldAskOTP:t?.hasLoginOtp??!1,rememberMeType:t?.rememberMeType??"disabled"}}};be=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._,Ee.u])],be);let Te=class{constructor(e){this.carbonLegacy=e}async execute(e){await this.carbonLegacy.commands.carbon({name:"loginViaSSO",args:[e]})}};Te=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],Te);let Ce=class{constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}async execute({isNitroProvider:e,serviceProviderRedirectUrl:t}){await this.ssoProviderInfoStore.set({isNitroProvider:e,serviceProviderUrl:t})}};Ce=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[C])],Ce);let we=class{constructor(e){this.carbonLegacy=e}async execute({login:e}){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSession",arg:[{login:e??""}]})}};we=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],we);let Re=class{constructor(e){this.pinCodeClient=e}async execute({login:e}){if(e){const t=await(0,i.z)(this.pinCodeClient.queries.getStatus({loginEmail:e}));if((0,m.d6)(t)&&t.data.isPinCodeEnabled)return Promise.resolve(!0)}return Promise.resolve(!1)}};Re=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[Ee.u])],Re);let Pe=class{constructor(e,t,r,s,i,o,a,n,c,d,l){this.deviceRegistrationMachine=e,this.masterPasswordFlowMachine=t,this.twoFactorAuthenticationMachine=r,this.webAuthnMachine=s,this.deviceToDeviceAuthenticationMachine=i,this.pinCodeMachine=o,this.initializeMachineService=a,this.legacySSOLoginService=n,this.checkAccountType=c,this.storeSSOInfoService=d,this.checkPinCodeStatusService=l}desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"AuthenticationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.masterPasswordFlowMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,...this.webAuthnMachine.desc().config.context,...this.deviceToDeviceAuthenticationMachine.desc().config.context,...this.pinCodeMachine.desc().config.context,ready:!1,shouldAskMasterPassword:!1,shouldAskOTP:!1,shouldAskPinCode:!1},states:{Starting:{invoke:{src:"initializeMachine",onDone:{actions:["assignInitializationResults"],target:"RememberMeRedirection"}}},RememberMeRedirection:{always:[{target:"MasterPassword",cond:"shouldAskMasterPassword"},{target:"CheckSessionForOtp2",cond:"shouldAskOTP"},{target:"WebAuthn",cond:"rememberMeIsWebAuthn"},{target:"WaitingForEmail"}]},CheckSessionForOtp2:{entry:["checkAccountType"]},WaitingForEmail:{on:{INPUT_ACCOUNT_EMAIL:{target:"ValidatingEmail",actions:["assignAccountEmail","clearError"]}}},ValidatingEmail:{entry:["checkAccountType"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},PinCode:{...ie(this.pinCodeMachine.desc().config)},DeviceRegistration:{...ie(this.deviceRegistrationMachine.desc().config)},WebAuthn:{...ie(this.webAuthnMachine.desc().config),onDone:[{target:"MasterPassword",cond:"shouldSwitchToMasterPassword"},{target:"PinCode",cond:"shouldSwitchToPinCode"},{target:"MasterPasswordBasedAuthenticationDone"}]},TwoFactorAuthentication:{...ie(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"MasterPasswordBasedAuthenticationDone"}},SSOAuthentication:{entry:["legacySSOLogin"]},SSORedirectionToIdp:{entry:["assignServiceProviderInfo","storeSSOInfo"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},CheckPinCodeAvailableForMasterPassword:{invoke:{src:"checkPinCodeStatus",onDone:[{actions:["assignShouldAskPinCode"],cond:"isPinCodeLogin",target:"PinCode"},{actions:["assignShouldAskPinCode"],target:"MasterPassword"}]}},MasterPassword:{...ie(this.masterPasswordFlowMachine.desc().config),onDone:[{target:"WaitingForEmail",cond:"shouldResetAuthenticationFlow"},{target:"MasterPasswordBasedAuthenticationDone"}]},MasterPasswordBasedAuthenticationDone:{on:{CARBON_LEGACY_LOGGED_OUT:{target:"Starting"}}},CheckPinCodeAvailableForPasswordless:{invoke:{src:"checkPinCodeStatus",onDone:[{actions:["assignShouldAskPinCode"],cond:"isPinCodeLogin",target:"PinCode"},{actions:["assignShouldAskPinCode"],target:"DeviceToDeviceAuthentication"}]}},DeviceToDeviceAuthentication:{...ie(this.deviceToDeviceAuthenticationMachine.desc().config),onDone:{target:"DeviceToDeviceAuthenticationDone"}},DeviceToDeviceAuthenticationDone:{type:"final"}},on:{CHANGE_ACCOUNT_EMAIL:[{target:"ValidatingEmail",actions:["clearError","assignAccountEmail"],cond:"isAccountLoginAvailable"},{target:"WaitingForEmail",actions:["clearError","clearEmail"]}],CARBON_LEGACY_ASK_MASTER_PASSWORD:{target:"CheckPinCodeAvailableForMasterPassword",actions:["assignServerKey","clearError"]},CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT:[{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail","clearError"],cond:"isGrapheneDeviceRegistrationFlow"},{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail","clearError"]}],CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED:{target:"SSORedirectionToIdp",actions:["clearError"]},CARBON_LEGACY_SSO_LOGIN_BYPASS:{target:"SSOAuthentication",actions:["assignSsoData"]},CARBON_LEGACY_OPEN_SESSION_OTP_SENT:{target:"TwoFactorAuthentication",actions:["assignOtpVerificationMode","clearError"]},CARBON_LEGACY_OPEN_SESSION_DEVICE_TO_DEVICE:{target:"CheckPinCodeAvailableForPasswordless",actions:["assignServerKey","clearError"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.masterPasswordFlowMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,...this.webAuthnMachine.desc().options.actions,...this.deviceToDeviceAuthenticationMachine.desc().options.actions,...this.pinCodeMachine.desc().options.actions,assignInitializationResults:(0,L.f0)({login:(e,t)=>t.data.lastUsedLogin,localAccounts:(e,t)=>t.data.localAccounts,shouldAskMasterPassword:(e,t)=>t.data.shouldAskMasterPassword,shouldAskOTP:(e,t)=>t.data.shouldAskOTP,shouldAskPinCode:(e,t)=>t.data.shouldAskPinCode,rememberMeType:(e,t)=>t.data.rememberMeType,ready:()=>!0}),assignAccountEmail:(0,L.f0)({login:(e,t)=>t.login}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignOtpVerificationMode:(0,L.f0)({otpVerificationMode:(e,t)=>t.otpVerificationMode}),assignSsoData:(0,L.f0)({ssoData:(e,t)=>t}),assignServiceProviderInfo:(0,L.f0)({serviceProviderRedirectUrl:(e,t)=>t.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.isNitroProvider,rememberMeForSSOPreference:(e,t)=>t.rememberMeForSSOPreference}),assignServerKey:(0,L.f0)({serverKey:(e,t)=>t.serverKey}),assignShouldAskPinCode:(0,L.f0)({shouldAskPinCode:(e,t)=>t.data}),clearEmail:(0,L.f0)({login:void 0}),clearError:(0,L.f0)({error:()=>{}}),clearContext:(0,L.f0)({login:()=>"",shouldAskOTP:()=>!1,shouldAskMasterPassword:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1,isRememberMeEnabled:()=>!1,isAccountRecoveryAvailable:()=>!1}),legacySSOLogin:(e,t)=>this.legacySSOLoginService.execute(t),checkAccountType:e=>this.checkAccountType.execute(e),storeSSOInfo:(e,t)=>this.storeSSOInfoService.execute(t)},services:{...this.deviceRegistrationMachine.desc().options.services,...this.masterPasswordFlowMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services,...this.webAuthnMachine.desc().options.services,...this.deviceToDeviceAuthenticationMachine.desc().options.services,...this.pinCodeMachine.desc().options.services,initializeMachine:()=>this.initializeMachineService.execute(),checkAccountType:e=>this.checkAccountType.execute(e),checkPinCodeStatus:e=>this.checkPinCodeStatusService.execute(e)},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,...this.webAuthnMachine.desc().options.guards,...this.masterPasswordFlowMachine.desc().options.guards,isAccountLoginAvailable:(e,t)=>Boolean(t.login),shouldAskMasterPassword:e=>e.shouldAskMasterPassword&&!e.shouldAskPinCode,shouldAskOTP:e=>!!e.shouldAskOTP&&e.shouldAskOTP,shouldAskPinCode:e=>e.shouldAskPinCode,shouldSwitchToMasterPassword:(e,t)=>t.data.switchToMasterPassword,shouldSwitchToPinCode:(e,t)=>t.data.switchToPinCode,shouldResetAuthenticationFlow:(e,t)=>t.data.shouldResetAuthenticationFlow,rememberMeIsWebAuthn:e=>void 0!==e.rememberMeType&&"webauthn"===e.rememberMeType,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice"),isPinCodeLogin:(e,t)=>t.data}}};return e&&(0,K.G)(t.config),t}create(e=!1){const{config:t,options:r}=this.desc(e);return(0,G.C)(t,r)}};Pe=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[oe,Z,ce,ae,Se,Ie,be,Te,we,Ce,Re])],Pe);let De=class{constructor(e,t,r,s,i){this.carbon=s,this.allowedToFail=i,this.loginMachineStore=t;const o=e.create(r);this.interpreter=P.kJ(o).onTransition((0,U.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onEvent((0,F.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onTransition((async()=>{const e=this.interpreter.getSnapshot();await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.loginMachineStore,e)})),this.abortDeviceLimitEventHandler=new M(this.interpreter,this.carbon)}async prepare(){await this.abortDeviceLimitEventHandler.execute();const e=await(async e=>{const t=await e.getState();return t?v.ZM.create(JSON.parse(t)):void 0})(this.loginMachineStore);if(!e){const e=this.interpreter.start();return void await(0,D.x)(e,(e=>e.context.ready),{timeout:3e4})}let t;await this.allowedToFail.doOne((()=>{if(e.done)throw new Error("Restarting a machine which is already in its final state. Starting from scratch instead.");t=this.interpreter.start(e)}),"Resuming state machine"),t||(t=this.interpreter.start()),await(0,D.x)(t,(e=>e.context.ready))}continue(e){this.interpreter.send(e)}};De=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[Pe,f,Boolean,n._,l.J])],De);let Ne=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"CHANGE_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,m.Vp)(void 0))}};Ne=(0,s.__decorate)([(0,w.W)(R.hW),(0,s.__metadata)("design:paramtypes",[De])],Ne);let Ue=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.authenticationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,m.Vp)(void 0))}};Ue=(0,s.__decorate)([(0,w.W)(R.eG),(0,s.__metadata)("design:paramtypes",[De])],Ue);let Fe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,m.Vp)(void 0))}};Fe=(0,s.__decorate)([(0,w.W)(R.jq),(0,s.__metadata)("design:paramtypes",[De])],Fe);let Me=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"CANCEL_DEVICE_TRANSFER_REQUEST"}),Promise.resolve((0,m.Vp)(void 0))}};Me=(0,s.__decorate)([(0,w.W)(R.Yc),(0,s.__metadata)("design:paramtypes",[De])],Me);let Le=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,m.Vp)(void 0))}};Le=(0,s.__decorate)([(0,w.W)(R.Gc),(0,s.__metadata)("design:paramtypes",[De])],Le);let Ge=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,m.Vp)(void 0))}};Ge=(0,s.__decorate)([(0,w.W)(R.rF),(0,s.__metadata)("design:paramtypes",[De])],Ge);let Ke=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,m.Vp)(void 0))}};Ke=(0,s.__decorate)([(0,w.W)(R.A),(0,s.__metadata)("design:paramtypes",[De])],Ke);let xe=class{constructor(e){this.authenticationFlow=e}execute(e){const{masterPassword:t,rememberMe:r}=e.body;return this.authenticationFlow.continue({type:"INPUT_MASTER_PASSWORD",masterPassword:t,rememberMe:r}),Promise.resolve((0,m.Vp)(void 0))}};xe=(0,s.__decorate)([(0,w.W)(R.rT),(0,s.__metadata)("design:paramtypes",[De])],xe);let ke=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,m.Vp)(void 0))}};ke=(0,s.__decorate)([(0,w.W)(R.sH),(0,s.__metadata)("design:paramtypes",[De])],ke);let je=class{constructor(e){this.authenticationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.authenticationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,m.Vp)(void 0))}};je=(0,s.__decorate)([(0,w.W)(R.XH),(0,s.__metadata)("design:paramtypes",[De])],je);let Ve=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,m.Vp)(void 0))}};Ve=(0,s.__decorate)([(0,w.W)(R.ad),(0,s.__metadata)("design:paramtypes",[De])],Ve);let We=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,m.Vp)(void 0))}};We=(0,s.__decorate)([(0,w.W)(R.K1),(0,s.__metadata)("design:paramtypes",[De])],We);let Be=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,m.Vp)(void 0))}};Be=(0,s.__decorate)([(0,w.W)(R.v5),(0,s.__metadata)("design:paramtypes",[De])],Be);let ze=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"USE_DEVICE_TO_DEVICE_AUTHENTICATION"}),Promise.resolve((0,m.Vp)(void 0))}};ze=(0,s.__decorate)([(0,w.W)(R.sU),(0,s.__metadata)("design:paramtypes",[De])],ze);let He=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RETRY_WEBAUTHN_AUTHENTICATION"}),Promise.resolve((0,m.Vp)(void 0))}};He=(0,s.__decorate)([(0,w.W)(R.M6),(0,s.__metadata)("design:paramtypes",[De])],He);let Ye=class{constructor(e){this.authenticationFlow=e}execute(e){const{webAuthnError:t}=e.body;return this.authenticationFlow.continue({type:"WEBAUTHN_AUTHENTICATION_FAIL",error:t}),Promise.resolve((0,m.Vp)(void 0))}};Ye=(0,s.__decorate)([(0,w.W)(R.O3),(0,s.__metadata)("design:paramtypes",[De])],Ye);var Qe=r(26457);let qe=class{constructor(e,t){this.carbonLegacy=e,this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}catch(e){this.logger.trace("Logout Command error :"+e)}return Promise.resolve((0,m.Vp)(void 0))}};qe=(0,s.__decorate)([(0,w.W)(R.N5),(0,s.__metadata)("design:paramtypes",[n._,Qe.V])],qe);let $e=class{constructor(e,t){this.carbonLegacy=e,this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"lockSession",arg:[{}]})}catch(e){this.logger.trace("LockSession command handler: "+e)}return Promise.resolve((0,m.Vp)(void 0))}};$e=(0,s.__decorate)([(0,w.W)(R.Y$),(0,s.__metadata)("design:paramtypes",[n._,Qe.V])],$e);let Xe=class{constructor(e){this.authenticationFlow=e}execute(e){return this.authenticationFlow.continue({type:"CARBON_LEGACY_SSO_LOGIN_BYPASS",...e.body}),Promise.resolve((0,m.Vp)(void 0))}};Xe=(0,s.__decorate)([(0,w.W)(R.yv),(0,s.__metadata)("design:paramtypes",[De])],Xe);var Ze=r(28489),Je=r(94189),et=r(95082);class tt{}let rt=class{constructor(e,t,r,s){this.carbonLegacyClient=e,this.ssoUserSettingsStore=r,this.client=t,this.authenticationFlowInfraContext=s}async retrieveSSOInfo(){const e=await(0,i.z)(this.carbonLegacyClient.queries.carbonState({path:"userSession.ssoSettings"}).pipe((0,S.U)((e=>{if(!((0,m.d6)(e)&&(t=e.data,t&&"object"==typeof t&&(0,Ze.l$)(t,"ssoUser")&&(0,Ze.l$)(t,"serviceProviderUrl"))))throw new Error("SsoSettings is not of the expected type");var t;return e.data}))));return{isNitroProvider:e.isNitroProvider??!1,serviceProviderUrl:e.serviceProviderUrl}}async execute(e){const{loginUserWithEnclaveSSO:t}=this.client.getClient(et.y).commands,r=await this.retrieveSSOInfo(),{login:s,rememberMeForSSOPreference:i}=e.body;return await this.ssoUserSettingsStore.set({rememberMeForSSOPreference:i}),r.isNitroProvider?await t({userEmailAddress:s}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:r.serviceProviderUrl,tabFocus:!0}),Promise.resolve((0,m.Vp)(void 0))}};rt=(0,s.__decorate)([(0,w.W)(R.Hr),(0,s.__metadata)("design:paramtypes",[n._,Je.w,b,tt])],rt);var st=r(46420);const it=e=>!!e&&"object"==typeof e&&(0,Ze.l$)(e,"type")&&"sso"===e.type;let ot=class{constructor(e,t,r,s,i){this.allowToFail=i,this.client=t,this.carbonLegacyClient=e,this.authenticationFlowInfraContext=r,this.serverApiClient=s}getDeviceAccessKeys(e){return this.carbonLegacyClient.queries.carbonState({path:"authentication.localUsers"}).pipe((0,Oe.h)(m.d6),(0,S.U)((t=>t.data[e])))}async checkSSOInfo(e){const t=(await(0,i.z)(this.getDeviceAccessKeys(e).pipe((0,S.U)((t=>this.serverApiClient.v1.authentication.getAuthenticationMethodsForLogin({login:e,deviceAccessKey:t.deviceAccessKey,methods:["email_token","totp","duo_push","dashlane_authenticator"]}))),(0,st.J)(),(0,Oe.h)(m.d6),(0,S.U)((e=>e.data.data))))).verifications.find(it);if(t){const e=t.ssoInfo;return{isNitroProvider:e.isNitroProvider,serviceProviderUrl:e.serviceProviderUrl}}throw new Error("No SSO authentication available for the user")}async execute(e){const{login:t}=e.body,{loginUserWithEnclaveSSO:r}=this.client.getClient(et.y).commands;return await this.allowToFail.doOne((async()=>{const e=await this.checkSSOInfo(t);e.isNitroProvider?await r({userEmailAddress:t,tabFocus:!1}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:e.serviceProviderUrl,tabFocus:!1})}),"InitiateAutologinWithSSOCommandHandler.execute"),Promise.resolve((0,m.Vp)(void 0))}};ot=(0,s.__decorate)([(0,w.W)(R.x2),(0,s.__metadata)("design:paramtypes",[n._,Je.w,tt,H.l,l.J])],ot);var at=r(68307),nt=r(23326);let ct=class{constructor(e,t,r){this.authenticationFlow=e,this.ssoUserSettingsStore=t,this.carbon=r}getLoginFlowMigrationKillswitch(){return(0,i.z)(this.carbon.queries.carbonState({path:"device.killswitch.disableLoginFlowMigration"}).pipe((0,Oe.h)(m.d6),(0,S.U)((e=>e))))}async handle(e){const t=await this.getLoginFlowMigrationKillswitch();let r=!1;if("undefined"!=typeof self&&self.localStorage){const e=self.localStorage.getItem("extng.loginFlow.forceLegacyFallback");r=Boolean(e)&&"true"===e}if("success"===t.tag&&t.data||r)return console.warn("[Authentication-flow] Ignoring carbon event due to legacy login fallback",{isKillSwitchEnabled:t,isForceLoginFlowFallbackOptionEnabled:r}),Promise.resolve();switch(e.body.eventName){case"openSessionMasterPasswordLess":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_DEVICE_TO_DEVICE"});break;case"openSessionTokenSent":if(!e.body.eventData||"object"!=typeof e.body.eventData||!("login"in e.body.eventData)||"string"!=typeof e.body.eventData.login)throw new Error("login not in eventData");this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT",login:e.body.eventData.login});break;case"openSessionAskMasterPassword":{const e=await(0,i.z)(this.carbon.queries.getMasterPasswordAndServerKey());if((0,m.hx)(e))throw new Error("Failed to get  server key from carbon");const{serverKey:t}=e.data;this.authenticationFlow.continue({type:"CARBON_LEGACY_ASK_MASTER_PASSWORD",serverKey:t})}break;case"openSessionDashlaneAuthenticator":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR"});break;case"openSessionOTPSent":case"openSessionOTPForNewDeviceRequired":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_OTP_SENT",otpVerificationMode:"openSessionOTPSent"===e.body.eventName?"otp2":"otp1"});break;case"openSessionSsoRedirectionToIdpRequired":{const t=e.body.eventData,{rememberMeForSSOPreference:r}=await this.ssoUserSettingsStore.getState();this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED",serviceProviderRedirectUrl:t.serviceProviderRedirectUrl,isNitroProvider:t.isNitroProvider,rememberMeForSSOPreference:r})}break;case"openSessionFailed":{const t=e.body.eventData;return"WRONG_PASSWORD"===t.errorCode?this.authenticationFlow.continue({type:"CARBON_WRONG_PASSWORD"}):this.authenticationFlow.continue({type:"CARBON_LEGACY_ERROR",error:t.errorCode})}case"loginStatusChanged":e.body.eventData.loggedIn||this.authenticationFlow.continue({type:"CARBON_LEGACY_LOGGED_OUT"})}return Promise.resolve()}};ct=(0,s.__decorate)([(0,at.b)(nt.Dj),(0,s.__metadata)("design:paramtypes",[De,b,n._])],ct);var dt=r(6136),lt=r(20754),ut=r(28096),pt=r(69885),mt=r(6220);const ht=e=>({step:"EmailStep",loginEmail:e.context.login,localAccounts:e.context.localAccounts??[],isLoading:e.matches("ValidatingEmail")&&!e.context.error,error:e.context.error?.data?.message}),gt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:Y.E6.WaitingForTransferRequest,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),vt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:Y.E6.DisplayInstructions,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),_t=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:Y.E6.LoadingPassphrase,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),yt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:Y.E6.DisplayPassphrase,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,passphrase:e.context.passphrase?.split(_e.iy)||[],error:e.context.error}),St=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:Y.E6.LoadingAccount,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),Et=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:Y.E6.Error,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error??Y.UY.GENERIC_ERROR}),ft=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:Y.E6.DeviceRegistered,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),At=e=>({step:"EmailTokenStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error?.data?.message,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),It=e=>({step:"DashlaneAuthenticatorStep",localAccounts:e.context.localAccounts??[],isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error?.data?.message}),Ot=e=>({step:"TwoFactorAuthenticationOtpStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error?.data?.message,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType}),bt=e=>({step:"WebAuthnStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login??"",isLoading:e.matches({WebAuthn:"InitWebAuthnAuthentication"})&&!e.context.error,error:e.context.error?.data?.message}),Tt=e=>({step:"SSORedirectionToIdpStep",loginEmail:e.context.login,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl??"",isNitroProvider:e.context.isNitroProvider??!1,rememberMeForSSOPreference:e.context.rememberMeForSSOPreference,isLoading:e.matches({SSORedirectionToIdp:"InitSSOAuthentication"})&&!e.context.error,error:e.context.error?.data?.message,localAccounts:e.context.localAccounts??[]}),Ct=(e,t)=>({step:"MasterPasswordStep",loginEmail:e.context.login??"",localAccounts:e.context.localAccounts??[],isLoading:(e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"CheckingMigrationNeeded"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})||e.matches("MasterPasswordBasedAuthenticationDone"))&&!e.context.error,isAccountRecoveryAvailable:e.context.isAccountRecoveryAvailable,error:e.context.error?.data?.message,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl,isNitroProvider:e.context.isNitroProvider??!1,isAuthenticationDone:t}),wt=e=>{if(!e.context.login)throw new Error("No email login");return{step:"PinCodeStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({PinCode:"ValidatingPinCode"})&&!e.context.error,error:e.context.error?.code}},Rt=e=>({step:"StartingStep",localAccounts:e.context.localAccounts??[]});const Pt=e=>(0,pt.of)((0,m.Vp)(function(e){return e.matches("Starting")?Rt(e):e.matches("WaitingForEmail")||e.matches("ValidatingEmail")||e.matches("CheckPinCodeAvailableForMasterPassword")||e.matches("CheckPinCodeAvailableForPasswordless")?ht(e):e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?At(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?It(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?Ot(e):e.matches({WebAuthn:"InitWebAuthnAuthentication"})||e.matches({WebAuthn:"WebAuthnAuthenticationFailed"})||e.matches({WebAuthn:"WebAuthnAuthenticationValidated"})?bt(e):e.matches("SSORedirectionToIdp")?Tt(e):e.matches({DeviceToDeviceAuthentication:"WaitingForTransferRequest"})?gt(e):e.matches({DeviceToDeviceAuthentication:"DisplayInstructions"})?vt(e):e.matches({DeviceToDeviceAuthentication:"GeneratePassphrase"})?_t(e):e.matches({DeviceToDeviceAuthentication:"StartTransfer"})?yt(e):e.matches({DeviceToDeviceAuthentication:"OpenSession"})?St(e):e.matches({DeviceToDeviceAuthentication:"DeviceTransferError"})?Et(e):e.matches({DeviceToDeviceAuthentication:"DeviceRegistered"})||e.matches("DeviceToDeviceAuthenticationDone")?ft(e):e.matches({PinCode:"WaitingForPinCode"})||e.matches({PinCode:"ValidatingPinCode"})||e.matches({PinCode:"PinCodeError"})?wt(e):e.matches({MasterPassword:"CheckingAccountRecoveryStatus"})||e.matches({MasterPassword:"WaitingForMasterPassword"})||e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})||e.matches({MasterPassword:"CheckingMigrationNeeded"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})?Ct(e):e.matches("MasterPasswordBasedAuthenticationDone")?Ct(e,!0):void console.warn("[Auth] - No view associated to state ",JSON.stringify(e.value))}(e))),Dt=e=>e.pipe((0,mt.z)(Pt));var Nt=r(30045);let Ut=class{constructor(e,t){this.authenticationFlow=e,this.loginMachineStore=t}execute(){return(e=this.loginMachineStore,e.state$.pipe((0,S.U)((e=>e?v.ZM.create(JSON.parse(e)):void 0)))).pipe((0,Oe.h)(Boolean),(0,dt.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),s=(0,Nt.Z)(e.context,t.context);return r&&s})(e,t))),Dt);var e}};Ut=(0,s.__decorate)([(0,lt.e)(ut.DW),(0,s.__metadata)("design:paramtypes",[De,f])],Ut);let Ft=class{constructor(e){this.ssoUserSettingsStore=e,this.ssoUserSettingsStore=e}execute(){return this.ssoUserSettingsStore.state$.pipe((0,S.U)((e=>(0,m.Vp)({rememberMeForSSOPreference:e.rememberMeForSSOPreference}))))}};Ft=(0,s.__decorate)([(0,lt.e)(ut.Dc),(0,s.__metadata)("design:paramtypes",[b])],Ft);let Mt=class{constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}execute(){return this.ssoProviderInfoStore.state$.pipe((0,S.U)((e=>(0,m.Vp)({serviceProviderUrl:e.serviceProviderUrl,isNitroProvider:e.isNitroProvider,migrationType:e.migrationType}))))}};Mt=(0,s.__decorate)([(0,lt.e)(ut.L2),(0,s.__metadata)("design:paramtypes",[C])],Mt);const Lt=e=>!0;class Gt extends((0,y.Q)({initialValue:void 0,persist:!1,scope:_.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:Lt})){}var Kt=r(3786);let xt=class{constructor(e){this.authenticationFlow=e}execute(e){const{pinCode:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_PIN_CODE",pinCode:t}),Promise.resolve((0,m.Vp)(void 0))}};xt=(0,s.__decorate)([(0,w.W)(R.CO),(0,s.__metadata)("design:paramtypes",[De])],xt);let kt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"USE_MASTER_PASSWORD"}),Promise.resolve((0,m.Vp)(void 0))}};kt=(0,s.__decorate)([(0,w.W)(R.On),(0,s.__metadata)("design:paramtypes",[De])],kt);let jt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_PIN_CODE"}),Promise.resolve((0,m.Vp)(void 0))}};jt=(0,s.__decorate)([(0,w.W)(R.WF),(0,s.__metadata)("design:paramtypes",[De])],jt);let Vt=class{};Vt=(0,s.__decorate)([(0,c.Yl)({api:o.V,handlers:{commands:{changeLogin:Ne,changeTwoFactorAuthenticationOtpType:Ue,clearError:Fe,cancelDeviceTransferRequest:Me,resendEmailToken:Le,resendPushNotification:Ge,sendAccountEmail:Ke,sendMasterPassword:xe,submitBackupCode:ke,submitEmailToken:je,submitTotp:Ve,submitPinCode:xt,switchToMasterPassword:kt,switchToDashlaneAuthenticator:We,switchToEmailToken:Be,switchToDevicetoDeviceAuthentication:ze,switchToPinCode:jt,retryWebAuthnAuthentication:He,webAuthnAuthenticationFail:Ye,logout:qe,lockSession:$e,loginViaSSO:Xe,initiateLoginWithSSO:rt,initiateAutologinWithSSO:ot},events:{...(0,c.g4)(a.W,{carbonLegacy:ct})},queries:{authenticationFlowStatus:Ut,getSsoUserSettings:Ft,getProviderInfo:Mt}},configurations:{authenticationFlowContextInfrastructure:{token:tt}},providers:[te,oe,se,ae,Z,ce,Se,...(0,d.H)(De,{inject:[Pe,f,n._,u.c,l.J],asyncFactory:async(e,t,r,s,o)=>{let a=!1;const n=await(0,i.z)(s.queries.platformInfo());!(0,m.d6)(n)||n.data.buildType!==p.P.DEV&&n.data.buildType!==p.P.NIGHTLY||(a=!0);const c=new De(e,t,a,r,o);return await c.prepare(),c}}),Pe,Ie,Ae,be,Te,W,$,ee,re,V,ne,we,J,Ce,Re,pe,X,he,ye,ge,ve,me.q,ue.C,_e.Kp,_e.Ny],stores:[f,Gt,b,C],imports:[h.n,g.i,Kt.I]})],Vt)},10430:(e,t,r)=>{r.d(t,{z:()=>s});class s extends Error{constructor(e,t){super(e),this.code=t}}},59550:(e,t,r)=>{r.d(t,{Q:()=>v});var s=r(88802),i=r(60399),o=r(87065),a=r(86252),n=r(28489),c=r(87279),d=r(57924);function l(e){const t=e.split("-");if(t.length>0){const[r]=t;return{accessKey:r,secretKey:e}}throw new Error("Invalid UKI format")}function u(e){return!!(e&&"object"==typeof e&&(0,n.l$)(e,"accessKey")&&(0,n.l$)(e,"secretKey"))&&("string"==typeof e.accessKey&&"string"==typeof e.secretKey)}function p(e){return"string"==typeof e}const m="authentication.currentUser.deviceKeys",h="userSession.localSettings.uki",g="userSession.account.login";let v=class{constructor(e){this.carbonLegacyClient=e}getDeviceCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.carbonLegacyClient;return(0,i.z)(t({paths:[m,h,g]}).pipe((0,o.U)((e=>{if((0,c.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,c.db)(e)})),(0,o.U)(this.carbonStateToRequestUserDeviceCredentials(e))))}getSessionCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.carbonLegacyClient;return(0,i.z)(t({paths:[m,h,g,"userSession.session.sessionKeys"]}).pipe((0,o.U)((e=>{if((0,c.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,c.db)(e)})),(0,o.U)(this.carbonStateToRequestUserSessionCredentials(e))))}carbonStateToRequestUserDeviceCredentials(e){return([t,r,s])=>{if(!t&&!r||s!==e)throw new Error("No user device credentials available for active user");let i;if(r){if(!p(r))throw new Error("Unexpected UKI state shape received from carbon");i=l(r)}else{if(!u(t))throw new Error("Unexpected user device state shape received from carbon");i=t}return{login:e,deviceAccessKey:i.accessKey,deviceSecretKey:i.secretKey}}}carbonStateToRequestUserSessionCredentials(e){return([t,r,s,i])=>{if(!t&&!r||s!==e)throw new Error("No user device credentials available for active user");if(!i)throw new Error("No session credentials available for active user");let o;if(r){if(!p(r))throw new Error("Unexpected UKI state shape received from carbon");o=l(r)}else{if(!u(t))throw new Error("Unexpected user device state shape received from carbon");o=t}if(!((a=i)&&"object"==typeof a&&"accessKey"in a&&"secretKey"in a&&"expirationTimeSeconds"in a&&"string"==typeof a.accessKey&&"string"==typeof a.secretKey&&"number"==typeof a.expirationTimeSeconds))throw new Error("Unexpected session keys state shape received from carbon");var a;return{login:e,deviceAccessKey:o.accessKey,sessionAccessKey:i.accessKey,sessionSecretKey:i.secretKey}}}};v=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[a._])],v)},13460:(e,t,r)=>{r.d(t,{R:()=>v});var s=r(88802),i=r(99634),o=r(59550),a=r(66974),n=r(85373),c=r(42303),d=r(86252),l=r(20754),u=r(87279),p=r(85390),m=r(87065),h=r(6136);let g=class{constructor(e,t){this.carbon=e,this.pinCode=t}execute(){const e=this.carbon.queries.liveWebAuthnAuthenticationOptedIn(void 0),t=this.pinCode.queries.getCurrentUserStatus();return(0,p.a)({webAuthnQuery:e,pinCodeQuery:t}).pipe((0,m.U)((({pinCodeQuery:e,webAuthnQuery:t})=>{if((0,u.hx)(e)||(0,u.hx)(t))throw new Error("failed to query");return e.data.isPinCodeEnabled||t.data})),(0,h.x)(),(0,m.U)(u.Vp))}};g=(0,s.__decorate)([(0,l.e)(n._),(0,s.__metadata)("design:paramtypes",[d._,c.u])],g);let v=class{};v=(0,s.__decorate)([(0,i.Yl)({api:a.n,handlers:{commands:{},events:{},queries:{canLockApp:g}},providers:[o.Q],exports:[o.Q]})],v)},38487:(e,t,r)=>{r.d(t,{_:()=>M});var s=r(88802),i=r(99634),o=r(42853),a=r(162),n=r(87065),c=r(20754),d=r(87279),l=r(59463),u=r(86252);let p=class{constructor(e){this.carbon=e}isLocalAccounts(e){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"object"==typeof t&&"login"in t}isCarbonLocalAccountResult(e){return!(!e||"object"!=typeof e||!("localAccounts"in e))&&this.isLocalAccounts(e.localAccounts)}execute(){return(0,a.D)(this.carbon.commands.carbonLegacyLeeloo({name:"getLocalAccountsList",arg:[]})).pipe((0,n.U)((e=>{if((0,d.hx)(e))throw new Error("Unable to retrieve local accounts list");const t=(0,d.db)(e).carbonResult;if(!this.isCarbonLocalAccountResult(t))throw new Error("Carbon result is not of type local accounts");return(0,d.Vp)({localAccounts:t.localAccounts})})))}};p=(0,s.__decorate)([(0,c.e)(l.a),(0,s.__metadata)("design:paramtypes",[u._])],p);var m=r(63663),h=r(319);let g=class{constructor(e){this.carbon=e}async execute(){const e=await this.carbon.commands.cleanRemotelyRemovedProfiles();if((0,d.hx)(e))throw new Error("clean remotely removed profiles failed");return(0,d.Vp)(void 0)}};g=(0,s.__decorate)([(0,m.W)(h.L),(0,s.__metadata)("design:paramtypes",[u._])],g);var v=r(96782),_=r(18533),y=r(95087),S=r(60399),E=r(22450),f=r(57924),A=r(87113),I=r(63281),O=r(20195);const b="ZZ";const T="und";function C(e){return e?e.replace(/https?:\/\//g," "):e}var w=r(10551);const R={tag:"InvalidTokenError"},P={tag:"NetworkError"};let D=class{constructor(e,t,r){this.serverApiClient=e,this.carbon=t,this.contextless=r}async hasRegisteredDevice(e){const t=await(0,S.z)(this.carbon.queries.getLocalAccounts());if((0,d.hx)(t))throw new Error("Failed to query carbon");return t.data.some((t=>t.login===e))}async registerDeviceWithToken(e,t,r){const s=await(0,S.z)(this.serverApiClient.v1.authentication.performExtraDeviceVerification({login:e,token:t}));if(!(0,d.d6)(s))return(0,d.Rn)(R);const{authTicket:i}=s.data.data;return this.registerDeviceWithTicket(e,i,r)}async registerDeviceWithTicket(e,t,r){const s=await(0,S.z)(this.carbon.queries.getPlatformInfo());if(!(0,d.d6)(s))throw new Error("Failed to get status from carbon");const i=s.data;if("server_carbon_unknown"===i.platformName)throw new Error("unexpected server_carbon_unknown");const o={deviceName:C(r??w.getDefaultDeviceName()),appVersion:i.appVersion,platform:i.platformName,osCountry:(n=i.country,!n||n.length<2||n.length>5?b:n),osLanguage:(a=i.lang,!a||a.length<2||a.length>5?T:a),temporary:!1};var a,n;const c=await(0,S.z)(this.serverApiClient.v1.authentication.completeDeviceRegistrationWithAuthTicket({authTicket:t,login:e,device:o}));if(!(0,d.d6)(c))return(0,_.EQ)(c.error,{BusinessError:()=>(0,O.j)("Failed to register on server"),FetchFailedError:()=>(0,d.Rn)(P),InternalServerError:()=>(0,O.j)("Failed to register on server"),InvalidRequest:()=>(0,O.j)("Failed to register on server"),RateLimited:()=>(0,O.j)("Failed to register on server"),ServiceUnavailable:()=>(0,O.j)("Failed to register on server"),UnspecifiedBadStatus:()=>(0,O.j)("Failed to register on server")});const{deviceAccessKey:l,deviceSecretKey:u,settings:p,serverKey:m}=c.data.data;return await this.registerDeviceWithKeys({deviceAccessKey:l,deviceSecretKey:u,login:e,settingsContent:p.content,serverKey:m})}async registerDeviceWithKeys({deviceAccessKey:e,deviceSecretKey:t,settingsContent:r,serverKey:s,login:i}){const o=await(0,S.z)(this.contextless.v1.account.accountInfo({deviceAccessKey:e,deviceSecretKey:t,login:i}));if(!(0,d.d6)(o))return(0,_.EQ)(o.error,{BusinessError:()=>(0,O.j)("Failed to get account infos"),FetchFailedError:()=>(0,d.Rn)(P),InternalServerError:()=>(0,O.j)("Failed to get account infos"),InvalidRequest:()=>(0,O.j)("Failed to get account infos"),RateLimited:()=>(0,O.j)("Failed to get account infos"),ServiceUnavailable:()=>(0,O.j)("Failed to get account infos"),UnspecifiedBadStatus:()=>(0,O.j)("Failed to get account infos")});const{creationDateUnix:a,publicUserId:n,deviceAnalyticsId:c,userAnalyticsId:l}=o.data.data,u=await this.carbon.commands.registerDevice({deviceAccessKey:e,deviceAnalyticsId:c??"",deviceSecretKey:t,settings:{action:"BACKUP_EDIT",backupDate:a,content:r,identifier:"SETTINGS_userId",time:a,type:"SETTINGS"},serverKey:s,publicUserId:n,userAnalyticsId:l??"",isDataPersisted:E.jP.PERSIST_DATA_YES,login:i});if((0,d.hx)(u))throw new Error("Failed to register in carbon");return(0,d.Vp)(void 0)}};D=(0,s.__decorate)([(0,f.GS)(),(0,s.__metadata)("design:paramtypes",[A.l,u._,I.B])],D);const N={tag:"DeviceAlreadyRegistered"};let U=class{constructor(e){this.service=e}async execute({body:e}){const{login:t,ignoreAlreadyRegisteredError:r,deviceName:s}=e;if(!r){if(await this.service.hasRegisteredDevice(t))return(0,d.Rn)(N)}switch(e.with){case"authTicket":return this.service.registerDeviceWithTicket(t,e.authTicket,s);case"token":return(0,_.EQ)(await this.service.registerDeviceWithToken(t,e.token,s),{success:()=>(0,d.Vp)(void 0),failure:e=>(0,_.EQ)(e.error,{InvalidTokenError:e=>(0,d.Rn)(e),NetworkError:e=>(0,d.Rn)(e)})});case"deviceKeys":return await this.service.registerDeviceWithKeys({deviceAccessKey:e.deviceAccessKey,deviceSecretKey:e.deviceSecretKey,login:t,settingsContent:e.settings,serverKey:e.serverKey});default:return(0,y.U)(e)}}};U=(0,s.__decorate)([(0,m.W)(v.J),(0,s.__metadata)("design:paramtypes",[D])],U);var F=r(93850);let M=class{};M=(0,s.__decorate)([(0,i.Yl)({api:o.G,imports:[F.n],handlers:{commands:{cleanRemotelyRemovedProfiles:g,registerDevice:U},events:{},queries:{localAccounts:p}},providers:[D]})],M)},65871:(e,t,r)=>{r.d(t,{E:()=>n,V:()=>c});var s=r(88802),i=r(56695),o=r.n(i),a=r(57924);let n=class{constructor(e){this.sodium=e}generateNonce(){return this.sodium.randombytes_buf(this.sodium.crypto_box_NONCEBYTES)}generateKeyPair(){return this.sodium.crypto_kx_keypair()}hash(e,t){return this.sodium.crypto_generichash(this.sodium.crypto_secretbox_KEYBYTES,e,t)}compare(e,t){return this.sodium.memcmp(e,t)}generateClientSharedSecret(e,t,r){return this.sodium.crypto_kx_client_session_keys(e,t,r)}generateServerSharedSecret(e,t,r){return this.sodium.crypto_kx_server_session_keys(e,t,r)}encrypt(e,t,r){return this.sodium.crypto_secretbox_easy(e,t,r)}decrypt(e,t,r){return this.sodium.crypto_secretbox_open_easy(e,t,r)}};function c(){return{token:n,asyncFactory:async()=>{await o().ready;const e=o();return new n(e)}}}n=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[Object])],n)},46484:(e,t,r)=>{r.d(t,{KF:()=>i,dJ:()=>o});var s=r(15187);const i=3;class o extends s.x{constructor(e,t){super(e),this.code=t}}},3786:(e,t,r)=>{r.d(t,{I:()=>ae});var s=r(88802),i=r(6218),o=r(99634),a=r(38679),n=r(93850),c=r(65871),d=r(8362),l=r(87065),u=r(25029),p=r(95681);const m=e=>!0;class h extends((0,p.Q)({initialValue:void 0,persist:!1,scope:u.F.Device,storeName:"trusted-device-flow-machine",storeTypeGuard:m})){}const g=e=>e.state$.pipe((0,l.U)((e=>e?d.ZM.create(JSON.parse(e)):void 0)));var v=r(78065),_=r(24966),y=r(57924),S=r(18275),E=r(65865),f=r(70486),A=r(46484),I=r(87279),O=r(16053);let b=class{constructor(e){this.d2dAuthenticationService=e}async execute(){const e=await this.d2dAuthenticationService.getKeyExchangeTransferInfo();if((0,I.hx)(e))throw new Error("Error with getKeyExchangeTransferInfo");const{transferId:t,receiver:r}=e.data.transfer;return Promise.resolve({transferId:t,requestTimestamp:r.requestedAtDateUnix,untrustedDeviceName:r.deviceName,untrustedDeviceLocation:`${r.city}, ${r.countryCode}`,untrustedDeviceHashedPublicKey:r.hashedPublicKey})}};b=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[O.C])],b);var T=r(15652),C=r(69605);let w=class{constructor(e,t,r){this.d2dCryptoService=e,this.d2dAuthenticationService=t,this.passphraseService=r}async execute(e){const{privateKey:t,publicKey:r}=this.d2dCryptoService.generateKeyPair();if(!e.transferId)throw new Error("No transferId in context");const s=await this.d2dAuthenticationService.startSenderKeyExchange(e.transferId,r);if((0,I.hx)(s))return Promise.reject(s.error);const{receiverPublicKey:i}=s.data,o=e.untrustedDeviceHashedPublicKey;if(!this.d2dCryptoService.verifyUntrustedDevicePublicKey(o,i))throw new Error("Receiver public key doesn't match");const a=this.d2dCryptoService.generateSenderSharedSecret(r,t,i),n=await this.d2dAuthenticationService.getCurrentUserLogin();if((0,I.hx)(n)||!n.data)throw new Error("No user login in context");const c=this.d2dCryptoService.generateVisualCheckSeed(n.data,e.transferId,a),{passphrase:d,missingWordIndex:l}=await this.passphraseService.generatePassphraseChallenge(c);return{sharedSecret:a,passphrase:d,passhraseMissingWordIndex:l}}};w=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[T.q,O.C,C.Kp])],w);let R=class{constructor(e,t,r){this.passphraseService=e,this.d2dCryptoService=t,this.d2dAuthenticationService=r}async execute(e){if(!this.passphraseService.verifyChallenge(e.passphrase,e.passphraseGuess))throw new A.dJ("Passphrase incorrect",e.passphraseAttemptsLeft>1?f.S.INVALID_PASSPHRASE:f.S.PASSPHRASE_ATTEMPTS_LIMIT);const t=await this.d2dAuthenticationService.getCurrentUserLogin();if((0,I.hx)(t)||!t.data||!e.transferId)throw new Error("No user login or no transferId");const r=await this.d2dAuthenticationService.getUserInvisibleMasterPassword(),s=await this.d2dAuthenticationService.requestAuthTicket();if((0,I.hx)(s))throw new Error("Couldn't get authTicket");const{encryptedData:i,nonce:o}=this.d2dCryptoService.encryptInvisibleMasterPassword(t.data,s.data,r,e.transferId,e.sharedSecret),a=await this.d2dAuthenticationService.completeTransfer(i,o,e.transferId);return(0,I.hx)(a)?Promise.reject(a.error):Promise.resolve()}};R=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[C.Kp,T.q,O.C])],R);let P=class{constructor(e,t,r){this.getPendingDeviceTransferRequestService=e,this.approveDeviceTransferRequestService=t,this.verifyPassphraseChallengeService=r}create(){return(0,S.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"WaitingForNewDeviceTransferRequest",id:"TrustedDeviceFlowMachine",context:{transferId:void 0,untrustedDeviceName:"",untrustedDeviceHashedPublicKey:"",untrustedDeviceLocation:"",sharedSecret:"",passphrase:"",passphraseGuess:"",passphraseMissingWordIndex:-1,passphraseAttemptsLeft:A.KF},states:{Idle:{on:{REFRESH_REQUEST:{target:"WaitingForNewDeviceTransferRequest"}}},WaitingForNewDeviceTransferRequest:{invoke:{src:"getPendingDeviceTransferRequest",onDone:[{actions:["assignUntrustedDeviceData"],cond:"isDeviceTransferRequestAvailable",target:"NewDeviceTransferRequest"},{target:"Idle"}],onError:{actions:["assignTrustedDeviceFlowError"],target:"Idle"}}},NewDeviceTransferRequest:{on:{APPROVE_REQUEST:{target:"HandlingDeviceTransferRequest"},REJECT_REQUEST:{actions:["clearContext"],target:"DeviceTransferRejected"},RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}},HandlingDeviceTransferRequest:{invoke:{src:"approveDeviceTransferRequest",onDone:{actions:["assignPassphraseChallengeData"],target:"DisplayPassphraseChallenge"},onError:{actions:["assignTrustedDeviceFlowError"],target:"DeviceTransferFailed"}}},DisplayPassphraseChallenge:{on:{SUBMIT_PASSPHRASE_CHALLENGE:{actions:["assignPassphraseGuess","clearError"],target:"VerifyingPassphraseChallenge"},CANCEL_REQUEST:{actions:["clearContext"],target:"Idle"}}},VerifyingPassphraseChallenge:{invoke:{src:"verifyPassphraseChallenge",onDone:{target:"DeviceTransferComplete"},onError:[{actions:["assignTrustedDeviceFlowError","updatePassphraseAttempts"],target:"DisplayPassphraseChallenge",cond:"isInvalidPassphraseError"},{actions:["assignTrustedDeviceFlowError","updatePassphraseAttempts"],target:"DeviceTransferFailed"}]}},DeviceTransferComplete:{on:{RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}},DeviceTransferRejected:{on:{RETURN_TO_DEVICE_SETUP:{target:"Idle"}}},DeviceTransferFailed:{on:{RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}}}},{actions:{assignUntrustedDeviceData:(0,E.f0)({transferId:(e,t)=>t.data.transferId,untrustedDeviceName:(e,t)=>t.data.untrustedDeviceName,untrustedDeviceHashedPublicKey:(e,t)=>t.data.untrustedDeviceHashedPublicKey,untrustedDeviceLocation:(e,t)=>t.data.untrustedDeviceLocation,requestTimestamp:(e,t)=>t.data.requestTimestamp}),clearContext:(0,E.f0)({transferId:()=>{},untrustedDeviceName:()=>"",untrustedDeviceHashedPublicKey:()=>"",untrustedDeviceLocation:()=>"",sharedSecret:()=>"",passphrase:()=>"",passphraseGuess:()=>"",passphraseMissingWordIndex:()=>-1,passphraseAttemptsLeft:()=>A.KF,error:()=>{}}),clearError:(0,E.f0)({error:()=>{}}),assignTrustedDeviceFlowError:(0,E.f0)({error:(e,t)=>t.data instanceof A.dJ?t.data.code:f.S.GENERIC_ERROR}),assignPassphraseChallengeData:(0,E.f0)({sharedSecret:(e,t)=>t.data.sharedSecret,passphrase:(e,t)=>t.data.passphrase,passphraseMissingWordIndex:(e,t)=>t.data.passhraseMissingWordIndex}),assignPassphraseGuess:(0,E.f0)({passphraseGuess:(e,t)=>t.passphraseChallenge}),updatePassphraseAttempts:(0,E.f0)({passphraseAttemptsLeft:(e,t)=>t.data instanceof A.dJ&&t.data.code===f.S.INVALID_PASSPHRASE?e.passphraseAttemptsLeft-1:e.passphraseAttemptsLeft})},services:{getPendingDeviceTransferRequest:()=>this.getPendingDeviceTransferRequestService.execute(),approveDeviceTransferRequest:e=>this.approveDeviceTransferRequestService.execute(e),verifyPassphraseChallenge:e=>this.verifyPassphraseChallengeService.execute(e)},guards:{isDeviceTransferRequestAvailable:(e,t)=>!!t.data.transferId,isInvalidPassphraseError:(e,t)=>t.data instanceof A.dJ&&"INVALID_PASSPHRASE"===t.data.code}})}};P=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[b,w,R])],P);let D=class{constructor(e,t){this.trustedDeviceMachineStore=t;const r=e.create();this.interpreter=v.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[D2D Trusted Device Flow] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.trustedDeviceMachineStore,e)}catch(e){console.warn("[D2D Trusted Device Flow] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?d.ZM.create(JSON.parse(t)):void 0})(this.trustedDeviceMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[D2D Trusted Device Flow] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[D2D Trusted Device Flow] Unable to start machine",e)}}ready(){return new _.X(!0)}continue(e){if(!this.interpreter)throw new Error("TrustedDevice flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};D=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[P,h])],D);var N=r(43978),U=r(90171),F=r(83695),M=r(85390),L=r(41842),G=r(6136),K=r(30045),x=r(20754),k=r(53835),j=r(69885),V=r(6220),W=r(69126);const B=e=>(0,j.of)((0,I.Vp)(function(e){if(e.matches("Idle")||e.matches("WaitingForNewDeviceTransferRequest"))return{step:f.T.WaitingForNewDeviceRequest};if(e.matches("NewDeviceTransferRequest"))return(0,W.Xn)(e.context.requestTimestamp)<=0?{step:f.T.Error,errorCode:f.S.TIMEOUT}:{step:f.T.NewDeviceRequestAvailable,untrustedDeviceName:e.context.untrustedDeviceName,untrustedDeviceLocation:e.context.untrustedDeviceLocation,requestTimestamp:e.context.requestTimestamp};if(e.matches("HandlingDeviceTransferRequest"))return{step:f.T.LoadingChallenge};if(e.matches("DisplayPassphraseChallenge")||e.matches("VerifyingPassphraseChallenge")){const{passphrase:t,passphraseMissingWordIndex:r,untrustedDeviceName:s,error:i}=e.context,o=t.split(C.iy).map(((e,t)=>t===r?"":e));return{step:f.T.DisplayPassphraseChallenge,untrustedDeviceName:s,passphrase:o,error:i}}if(e.matches("DeviceTransferComplete"))return{step:f.T.DeviceTransferComplete,untrustedDeviceName:e.context.untrustedDeviceName};if(e.matches("DeviceTransferRejected"))return{step:f.T.DeviceTransferRejected,untrustedDeviceName:e.context.untrustedDeviceName};if(e.matches("DeviceTransferFailed"))return{step:f.T.Error,errorCode:e.context.error};throw new Error("[D2D Trusted Device] - No view associated to state")}(e))),z=e=>e.pipe((0,V.z)(B));let H=class{constructor(e,t){this.trustedDeviceFlow=e,this.trustedDeviceFlowMachineStore=t}execute(){const e=g(this.trustedDeviceFlowMachineStore).pipe((0,L.h)(Boolean),(0,l.U)((e=>e.context.requestTimestamp?(0,W.Xn)(e.context.requestTimestamp):0))).pipe((0,N.w)((e=>(0,U.H)(e))),(0,F.O)(0));return(0,M.a)([g(this.trustedDeviceFlowMachineStore),this.trustedDeviceFlow.ready(),e],((e,t,r)=>{if(e&&t)return e})).pipe((0,L.h)(Boolean),z,(0,G.x)(((e,t)=>(0,K.Z)(e,t))))}};H=(0,s.__decorate)([(0,x.e)(k.N),(0,s.__metadata)("design:paramtypes",[D,h])],H);var Y=r(63663),Q=r(87041);let q=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"APPROVE_REQUEST"}),Promise.resolve((0,I.Vp)(void 0))}};q=(0,s.__decorate)([(0,Y.W)(Q.G),(0,s.__metadata)("design:paramtypes",[D])],q);var $=r(33969);let X=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"REFRESH_REQUEST"}),Promise.resolve((0,I.Vp)(void 0))}};X=(0,s.__decorate)([(0,Y.W)($.V),(0,s.__metadata)("design:paramtypes",[D])],X);var Z=r(55870);let J=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"REJECT_REQUEST"}),Promise.resolve((0,I.Vp)(void 0))}};J=(0,s.__decorate)([(0,Y.W)(Z.a),(0,s.__metadata)("design:paramtypes",[D])],J);var ee=r(97891);let te=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"CANCEL_REQUEST"}),Promise.resolve((0,I.Vp)(void 0))}};te=(0,s.__decorate)([(0,Y.W)(ee.b),(0,s.__metadata)("design:paramtypes",[D])],te);var re=r(48214);let se=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(e){const{passphraseChallenge:t}=e.body;return this.trustedDeviceFlow.continue({type:"SUBMIT_PASSPHRASE_CHALLENGE",passphraseChallenge:t}),Promise.resolve((0,I.Vp)(void 0))}};se=(0,s.__decorate)([(0,Y.W)(re.I),(0,s.__metadata)("design:paramtypes",[D])],se);var ie=r(81540);let oe=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"RETURN_TO_DEVICE_SETUP"}),Promise.resolve((0,I.Vp)(void 0))}};oe=(0,s.__decorate)([(0,Y.W)(ie.n),(0,s.__metadata)("design:paramtypes",[D])],oe);let ae=class{};ae=(0,s.__decorate)([(0,o.Yl)({api:i.F,stores:[h],imports:[n.n],exports:[T.q,c.E],providers:[(0,c.V)(),...(0,a.H)(D,{inject:[P,h],asyncFactory:async(e,t)=>{const r=new D(e,t);return await r.prepare(),r}}),c.E,C.Kp,T.q,O.C,b,w,R,P,C.Ny],handlers:{commands:{approveRequest:q,refreshRequest:X,rejectRequest:J,cancelRequest:te,submitPassphraseChallenge:se,returnToDeviceSetup:oe},events:{},queries:{trustedDeviceFlowStatus:H}}})],ae)},16053:(e,t,r)=>{r.d(t,{C:()=>f});var s=r(88802),i=r(60399),o=r(10551),a=r(22450),n=r(86252),c=r(87113),d=r(25994),l=r(57924),u=r(48844),p=r(87279),m=r(18533),h=r(20195),g=r(89358),v=r(64496),_=r(70486),y=r(69126),S=r(10430),E=r(46484);let f=class{constructor(e,t,r){this.serverApiClient=e,this.sessionClient=t,this.carbon=r}async getCurrentUserLogin(){return await(0,i.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,u.DZ)((()=>(0,p.Rn)(new Error("No user login found")))),(0,u.lk)((e=>(0,p.Vp)(e)))))}getUserInvisibleMasterPassword(){const{carbonState:e}=this.carbon.queries;return(0,i.z)(e({path:"userSession.session.masterPassword"}).pipe((0,u.nb)({success:e=>e,failure:()=>{throw new Error("Failure getting user invisible master password info")}})))}async requestAuthTicket(){return await(0,i.z)(this.serverApiClient.v1.authentication.requestExtraDeviceRegistration({tokenType:"googleAccountNewDevice"}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data.token)))))}async getKeyExchangeTransferInfo(){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.getKeyExchangeTransferInfo({}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startReceiverKeyExchange(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.startReceiverKeyExchange({transferId:e,receiverHashedPublicKey:t},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:h.j,FetchFailedError:()=>{throw new S.z("User offline or request timeout",v.UY.TIMEOUT)},UnspecifiedBadStatus:({response:t})=>{if(t.status===d.W.GatewayTimeout)return new S.z("Request has timed out",v.UY.TIMEOUT);(0,h.j)(e)},InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async completeKeyExchange(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.completeKeyExchange({receiverPublicKey:t,transferId:e}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startTransfer(e){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.startTransfer({transferId:e,transferType:"universal"},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:h.j,FetchFailedError:h.j,UnspecifiedBadStatus:({response:t})=>t.status===d.W.GatewayTimeout?new S.z("Request has timed out",v.UY.TIMEOUT):(0,h.j)(e),InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async requestTransfer(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.requestTransfer({transfer:{login:e,receiverDeviceName:t,transferType:"universal"}}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:()=>{throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:h.j,InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startSenderKeyExchange(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.startSenderKeyExchange({transferId:e,senderPublicKey:t},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>{if("TRANSFER_DOES_NOT_EXISTS"===e.code)throw new E.dJ("Transfer request has expired",_.S.TIMEOUT);throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:({response:e})=>{if(e.status===d.W.GatewayTimeout)return new E.dJ("Request has timed out",_.S.TIMEOUT);throw new Error("[D2D]: Bad status error")},InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async completeTransfer(e,t,r){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.completeTransfer({transfer:{encryptedData:e,nonce:t,transferId:r,transferType:"universal"}}).pipe((0,u.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>{if("TRANSFER_DOES_NOT_EXISTS"===e.error.code)return new E.dJ("Request timed out",_.S.TIMEOUT);throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:h.j,InternalServerError:h.j,InvalidRequest:h.j,RateLimited:h.j,ServiceUnavailable:h.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async openSession(e,t,r,s){const n=await(0,i.z)(this.serverApiClient.v1.authentication.performExtraDeviceVerification({login:e,token:t}));if(!(0,p.d6)(n))throw new S.z("Perform extra device verification failed",v.UY.ACCOUNT_ERROR);const{authTicket:c}=n.data.data,d=await(0,i.z)(this.carbon.queries.getPlatformInfo());if(!(0,p.d6)(d))throw new S.z("No platform info available",v.UY.ACCOUNT_ERROR);const l=d.data,u={deviceName:(0,y.$f)(s||o.getDefaultDeviceName()),appVersion:l.appVersion,platform:l.platformName,osCountry:(0,y.Yb)(l.country),osLanguage:(0,y._$)(l.lang),temporary:!1},m=await(0,i.z)(this.serverApiClient.v1.authentication.completeDeviceRegistrationWithAuthTicket({authTicket:c,login:e,device:u}));if(!(0,p.d6)(m))throw new S.z("Device registration with authTicket failed",v.UY.ACCOUNT_ERROR);const{deviceAccessKey:h,deviceAnalyticsId:g,deviceSecretKey:_,settings:E,serverKey:f,publicUserId:A,userAnalyticsId:I}=m.data.data;await this.carbon.commands.registerDevice({deviceAccessKey:h,deviceAnalyticsId:g,deviceSecretKey:_,settings:E,serverKey:f,publicUserId:A,userAnalyticsId:I,isDataPersisted:a.jP.PERSIST_DATA_YES,login:e});const O=await this.carbon.commands.openSessionWithMasterPassword({login:e,password:r,rememberPassword:!0,requiredPermissions:void 0,serverKey:"",loginType:"DeviceToDevice"});if(!(0,p.d6)(O))throw new S.z("Open session with deciphered password failed",v.UY.ACCOUNT_ERROR)}};f=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[c.l,g.x,n._])],f)},15652:(e,t,r)=>{r.d(t,{q:()=>c});var s=r(88802),i=r(10370),o=r(57924),a=r(65871),n=r(69126);let c=class{constructor(e){this.cryptoToolboxService=e}verifyUntrustedDevicePublicKey(e,t){return this.cryptoToolboxService.compare((0,n.tp)(e),(0,n.tp)(this.hash(t)))}generateReceiverSharedSecret(e,t,r){return(0,i.s)(this.cryptoToolboxService.generateClientSharedSecret((0,n.tp)(e),(0,n.tp)(t),(0,n.tp)(r)).sharedRx)}generateSenderSharedSecret(e,t,r){return(0,i.s)(this.cryptoToolboxService.generateServerSharedSecret((0,n.tp)(e),(0,n.tp)(t),(0,n.tp)(r)).sharedTx)}generateSymmetricKey(e,t,r){return(0,i.s)(this.cryptoToolboxService.hash((new TextEncoder).encode(`DASHLANE_D2D_SYMMETRIC_KEY${e.length}${e}${t}`),(0,n.tp)(r)))}hash(e){return(0,i.s)(this.cryptoToolboxService.hash((0,n.tp)(e)))}generateKeyPair(){const e=this.cryptoToolboxService.generateKeyPair();return{publicKey:(0,i.s)(e.publicKey),privateKey:(0,i.s)(e.privateKey)}}generateVisualCheckSeed(e,t,r){return(0,i.s)(this.cryptoToolboxService.hash((new TextEncoder).encode(`DASHLANE_D2D_SAS_SEED${e.length}${e}${t}`),(0,n.tp)(r)))}encryptInvisibleMasterPassword(e,t,r,s,o){const a=(e=>(new TextEncoder).encode(JSON.stringify(e)))({login:e,key:{type:"invisible_master_password",value:r},token:t,version:1}),c=this.generateSymmetricKey(e,s,o),d=this.cryptoToolboxService.generateNonce(),l=this.cryptoToolboxService.encrypt(a,d,(0,n.tp)(c));return{encryptedData:(0,i.s)(l),nonce:(0,i.s)(d)}}decryptInvisibleMasterPassword(e,t,r){const s=this.cryptoToolboxService.decrypt((0,n.tp)(e),(0,n.tp)(t),(0,n.tp)(r)),i=new TextDecoder("utf-8").decode(s);return JSON.parse(i)}};c=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[a.E])],c)},69605:(e,t,r)=>{r.d(t,{Kp:()=>u,Ny:()=>l,iy:()=>c});var s=r(88802),i=r(67978),o=r(57924),a=r(75994),n=r(69126);const c=" ",d=Math.pow(2,32)-1;let l=class extends i.K{constructor(e){super("assets/eff_large_wordlist.json",e)}loadResource(e){if(!e||!Array.isArray(e))throw new Error("Failed to load word list");return e}};l=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[a.X])],l);let u=class{constructor(e){this.fetcher=e}getWordList(){return this.fetcher.get()}async generatePassphraseChallenge(e){const t=await this.getWordList(),r=[],s=Math.floor(d/t.length)*t.length;for(let i=0;i<e.length;i+=4){const{buffer:o,byteOffset:a}=new Uint8Array((0,n.tp)(e).slice(i,i+4)),c=new DataView(o).getUint32(a,!0);if(c<s){const e=t[c%t.length];r.push(e)}if(5===r.length)break}return{passphrase:r.join(c),missingWordIndex:Math.floor(5*Math.random())}}verifyChallenge(e,t){if(!e)throw new Error("[DEVICE-TRANSFER]: Passphrase challenge not generated yet");if(!t)throw new Error("[DEVICE-TRANSFER]: Passphrase guess not saved to machine context");return e===t}};u=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[l])],u)},69126:(e,t,r)=>{r.d(t,{$f:()=>l,Xn:()=>i,Yb:()=>n,_$:()=>d,tp:()=>o});var s=r(7502);const i=e=>1e3*e+6e4-Date.now(),o=e=>new Uint8Array((0,s.R)(e)),a="ZZ";function n(e){return!e||e.length<2||e.length>5?a:e}const c="und";function d(e){return!e||e.length<2||e.length>5?c:e}function l(e){return e?e.replace(/https?:\/\//g," "):e}},99600:(e,t,r)=>{r.d(t,{f:()=>Pe});var s,i,o,a,n,c=r(88802),d=r(99634),l=r(38679),u=r(93850),p=r(11433),m=r(57924),h=r(65865),g=r(18275),v=r(87279),_=r(60399),y=r(87113),S=r(48844),E=r(18533),f=r(95087),A=r(20195),I=r(96168);!function(e){e.VERIFICATION_FAILED="verification_failed",e.VERIFICATION_TIMEOUT="verification_timeout",e.VERIFICATION_REQUIRES_REQUEST="verification_requires_request",e.ACCOUNT_BLOCKED_CONTACT_SUPPORT="account_blocked_contact_support",e.INVALID_OTP_ALREADY_USED="invalid_otp_already_used",e.INVALID_OTP_BLOCKED="invalid_otp_blocked"}(s||(s={}));class O extends((0,I.Hu)(s.VERIFICATION_FAILED,"")){}class b extends((0,I.Hu)(s.VERIFICATION_TIMEOUT,"")){}class T extends((0,I.Hu)(s.VERIFICATION_REQUIRES_REQUEST,"")){}class C extends((0,I.Hu)(s.ACCOUNT_BLOCKED_CONTACT_SUPPORT,"")){}class w extends((0,I.Hu)(s.INVALID_OTP_ALREADY_USED,"")){}class R extends((0,I.Hu)(s.INVALID_OTP_BLOCKED,"")){}class P extends((0,I.Hu)("network_error","")){}!function(e){e.TOKEN_NOT_VALID="TOKEN_NOT_VALID",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.TOKEN_TOO_MANY_ATTEMPTS="TOKEN_TOO_MANY_ATTEMPTS",e.TOKEN_ACCOUNT_LOCKED="TOKEN_ACCOUNT_LOCKED"}(i||(i={})),function(e){e.OTP_NOT_VALID="OTP_NOT_VALID",e.OTP_TOO_MANY_ATTEMPTS="OTP_TOO_MANY_ATTEMPTS",e.OTP_ALREADY_USED="OTP_ALREADY_USED",e.BACKUP_CODE_NOT_VALID="BACKUP_CODE_NOT_VALID"}(o||(o={})),function(e){e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e.TOKEN_EXPIRED="TOKEN_EXPIRED"}(a||(a={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(n||(n={}));let D=class{constructor(e){this.serverApiClient=e}async performEmailTokenVerification(e,t){return await(0,_.z)(this.serverApiClient.v1.authentication.performEmailTokenVerification({login:e,token:t}).pipe((0,S.DZ)((e=>(0,E.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new O;case s.VERIFICATION_TIMEOUT:return new b;case s.VERIFICATION_REQUIRES_REQUEST:return new T;case s.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return new C;default:(0,f.U)(e.code)}},FetchFailedError:()=>new P,UnspecifiedBadStatus:A.j,InternalServerError:A.j,InvalidRequest:A.j,RateLimited:A.j,ServiceUnavailable:A.j}))),(0,S.lk)((e=>(0,v.Vp)(e.data.authTicket)))))}async performTotpVerification(e,t){return await(0,_.z)(this.serverApiClient.v1.authentication.performTotpVerification({login:e,otp:t}).pipe((0,S.DZ)((e=>(0,E.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new O;case s.INVALID_OTP_ALREADY_USED:return new w;case s.INVALID_OTP_BLOCKED:return new R;default:(0,f.U)(e.code)}},FetchFailedError:()=>new P,UnspecifiedBadStatus:A.j,InternalServerError:A.j,InvalidRequest:A.j,RateLimited:A.j,ServiceUnavailable:A.j}))),(0,S.lk)((e=>(0,v.Vp)(e.data.authTicket)))))}async performDashlaneAuthenticatorValidation(e,t){return await(0,_.z)(this.serverApiClient.v1.authentication.performDashlaneAuthenticatorVerification({login:e,deviceName:t}).pipe((0,S.DZ)((e=>(0,E.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new O;case s.VERIFICATION_TIMEOUT:return new b;default:(0,f.U)(e.code)}},FetchFailedError:()=>new P,UnspecifiedBadStatus:A.j,InternalServerError:A.j,InvalidRequest:A.j,RateLimited:A.j,ServiceUnavailable:A.j}))),(0,S.lk)((e=>(0,v.Vp)(e.data.authTicket)))))}async askServerToSendToken(e){return await(0,_.z)(this.serverApiClient.v1.authentication.requestEmailTokenVerification({login:e}).pipe((0,S.DZ)((e=>{throw e})),(0,S.lk)((()=>(0,v.Vp)(void 0)))))}};D=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[y.l])],D);let N=class{constructor(e){this.identityVerificationService=e,this.identityVerificationService=e}async execute({login:e}){if(e){const t=await this.identityVerificationService.askServerToSendToken(e);if((0,v.hx)(t))return Promise.reject(t.error)}Promise.resolve(void 0)}};N=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[D])],N);var U=r(81459);let F=class extends U.f{};F=(0,c.__decorate)([(0,m.GS)()],F);let M=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return a.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED;case s.VERIFICATION_TIMEOUT:return a.TOKEN_EXPIRED;default:return n.UNKNOWN_ERROR}}async execute({login:e}){if(!e)throw new Error("Something went wrong");const t=await this.identityVerificationService.performDashlaneAuthenticatorValidation(e,"");if((0,v.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}};M=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[D,F])],M);let L=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator",onDone:{target:"AuthenticatorPushValidated"},onError:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]}},on:{RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,h.f0)({error:()=>{}}),assignError:(0,h.f0)({error:(e,t)=>t.data}),switchToEmailToken:(0,h.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,h.f0)({isDashlaneAuthenticatorAvailable:!0}),sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};L=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[M,N])],L);const G=/^\d{6}$/;let K=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return i.TOKEN_NOT_VALID;case s.VERIFICATION_TIMEOUT:return i.TOKEN_EXPIRED;case s.VERIFICATION_REQUIRES_REQUEST:return i.TOKEN_TOO_MANY_ATTEMPTS;case s.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return i.TOKEN_ACCOUNT_LOCKED;default:return n.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.emailToken||0===e.emailToken.length||!G.test(e.emailToken))return Promise.reject(n.UNKNOWN_ERROR);const t=await this.identityVerificationService.performEmailTokenVerification(e.login,e.emailToken);if((0,v.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}const r=t.data;return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:r}),Promise.resolve()}};K=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[D,F])],K);let x=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"SendEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{invoke:{src:"authenticateWithEmailToken",onDone:{target:"FinishingEmailToken"},onError:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{assignError:(0,h.f0)({error:(e,t)=>t.data}),clearError:(0,h.f0)({error:()=>{}}),assignEmailToken:(0,h.f0)({emailToken:(e,t)=>t.emailToken})},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})},authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:s}=e;return this.authenticateWithEmailToken.executeWithParams({deviceName:t,emailToken:r,login:s})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};x=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[K,N])],x);const k=e=>({initial:e.initial,states:e.states,on:e.on??{}});let j=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...k(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...k(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,h.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};j=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[L,x])],j);var V=r(25029),W=r(95681);const B=e=>!0;class z extends((0,W.Q)({initialValue:void 0,persist:!1,scope:V.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:B})){}let H=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return o.OTP_NOT_VALID;case s.INVALID_OTP_ALREADY_USED:return o.OTP_ALREADY_USED;case s.INVALID_OTP_BLOCKED:return o.OTP_TOO_MANY_ATTEMPTS;default:return n.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.otp||0===e.otp.length||"totp"===e.twoFactorAuthenticationOtpType&&!G.test(e.otp))return Promise.reject(n.UNKNOWN_ERROR);const t=await this.identityVerificationService.performTotpVerification(e.login,e.otp);if((0,v.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}};H=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[D,F])],H);let Y=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"TwoFactorAuthenticationMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{invoke:{src:"authenticateWithTwoFactorAuthentication",onDone:{target:"TwoFactorAuthenticationDone"},onError:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,h.f0)({error:(e,t)=>t.data}),clearError:(0,h.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,h.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,h.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType})},services:{authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};return this.twoFactorAuthenticationService.executeWithParams(t)}},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};Y=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[H])],Y);let Q=class{constructor(e,t){this.deviceRegistrationMachine=e,this.twoFactorAuthenticationMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"IdentityVerificationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,ready:!1,shouldAskOTP:!1},states:{Starting:{entry:["assignInitializationResults"]},DeviceRegistration:{...k(this.deviceRegistrationMachine.desc().config)},TwoFactorAuthentication:{...k(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"AuthenticationDone"}},AuthenticationDone:{type:"final"}},on:{VERIFY_IDENTITY_WITH_TOKEN:{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_TOTP:{target:"TwoFactorAuthentication",actions:["assignAccountEmail"]},CANCEL_IDENTITY_VERIFICATION:{target:"Starting",actions:["clearContext"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,assignInitializationResults:(0,h.f0)({ready:()=>!0}),assignAccountEmail:(0,h.f0)({login:(e,t)=>t.login}),clearContext:(0,h.f0)({login:()=>"",shouldAskOTP:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1}),clearError:(0,h.f0)({error:()=>{}})},services:{...this.deviceRegistrationMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice")}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};Q=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[j,Y])],Q);var q=r(85390),$=r(41842),X=r(6136),Z=r(20754),J=r(41025),ee=r(69885),te=r(6220);const re=e=>({step:"EmailTokenStep",isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),se=e=>({step:"DashlaneAuthenticatorStep",isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error}),ie=e=>({step:"TwoFactorAuthenticationOtpStep",isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType});const oe=e=>(0,ee.of)((0,v.Vp)(function(e){return e.matches("Starting")?{step:"StartingStep"}:e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?re(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?se(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?ie(e):void console.warn("[Auth Ticket] - No view associated to state ",JSON.stringify(e.value))}(e))),ae=e=>e.pipe((0,te.z)(oe));var ne=r(8362),ce=r(87065);const de=e=>!0;class le extends((0,W.Q)({initialValue:void 0,persist:!1,scope:V.F.Device,storeName:"identity-verification-flow-machine",storeTypeGuard:de})){}var ue=r(30045);var pe=r(24966),me=r(78065),he=r(20916);let ge=class{constructor(e,t){this.identityVerificationMachineStore=t,this.initFlag=new pe.X(!1);const r=e.create();this.delayedEvents=[],this.interpreter=me.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[Auth Ticket] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.identityVerificationMachineStore,e)}catch(e){console.warn("[Auth Ticket] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?ne.ZM.create(JSON.parse(t)):void 0})(this.identityVerificationMachineStore);let t;try{t=this.interpreter.start(e)}catch(e){console.error("[Auth Ticket] Unable to reuse the stored state: ",e),t=this.interpreter.start()}await(0,he.x)(t,(e=>e.context.ready)),this.interpreter.send(this.delayedEvents),this.delayedEvents=[],this.initFlag.next(!0)}catch(e){console.error("[Auth Ticket] Unable to start machine",e)}}ready(){return this.initFlag}continue(e){if(!this.interpreter)throw new Error("Authentication flow not started");this.interpreter.getSnapshot().context.ready?this.interpreter.send(e):this.delayedEvents.push(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};ge=(0,c.__decorate)([(0,m.GS)(),(0,c.__metadata)("design:paramtypes",[Q,le])],ge);let ve=class{constructor(e,t){this.identityVerificationFlow=e,this.identityVerificationMachineStore=t}execute(){return(0,q.a)([(e=this.identityVerificationMachineStore,e.state$.pipe((0,ce.U)((e=>e?ne.ZM.create(JSON.parse(e)):void 0)))),this.identityVerificationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,$.h)(Boolean),(0,X.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),s=(0,ue.Z)(e.context,t.context);return r&&s})(e,t))),ae);var e}};ve=(0,c.__decorate)([(0,Z.e)(J.O),(0,c.__metadata)("design:paramtypes",[ge,le])],ve);var _e=r(63663),ye=r(13744);let Se=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.identityVerificationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,v.Vp)(void 0))}};Se=(0,c.__decorate)([(0,_e.W)(ye.eG),(0,c.__metadata)("design:paramtypes",[ge])],Se);let Ee=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,v.Vp)(void 0))}};Ee=(0,c.__decorate)([(0,_e.W)(ye.$5),(0,c.__metadata)("design:paramtypes",[ge])],Ee);let fe=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,v.Vp)(void 0))}};fe=(0,c.__decorate)([(0,_e.W)(ye.Gc),(0,c.__metadata)("design:paramtypes",[ge])],fe);let Ae=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,v.Vp)(void 0))}};Ae=(0,c.__decorate)([(0,_e.W)(ye.rF),(0,c.__metadata)("design:paramtypes",[ge])],Ae);let Ie=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,v.Vp)(void 0))}};Ie=(0,c.__decorate)([(0,_e.W)(ye.sH),(0,c.__metadata)("design:paramtypes",[ge])],Ie);let Oe=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,v.Vp)(void 0))}};Oe=(0,c.__decorate)([(0,_e.W)(ye.XH),(0,c.__metadata)("design:paramtypes",[ge])],Oe);let be=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,v.Vp)(void 0))}};be=(0,c.__decorate)([(0,_e.W)(ye.ad),(0,c.__metadata)("design:paramtypes",[ge])],be);let Te=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,v.Vp)(void 0))}};Te=(0,c.__decorate)([(0,_e.W)(ye.K1),(0,c.__metadata)("design:paramtypes",[ge])],Te);let Ce=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,v.Vp)(void 0))}};Ce=(0,c.__decorate)([(0,_e.W)(ye.v5),(0,c.__metadata)("design:paramtypes",[ge])],Ce);let we=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{login:t,verificationMethod:r}=e.body;switch(r){case"email_token":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOKEN",login:t});break;case"totp":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOTP",login:t});break;case"dashlane_authenticator":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR",login:t})}return Promise.resolve((0,v.Vp)(void 0))}};we=(0,c.__decorate)([(0,_e.W)(ye.qw),(0,c.__metadata)("design:paramtypes",[ge])],we);let Re=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"CANCEL_IDENTITY_VERIFICATION"}),Promise.resolve((0,v.Vp)(void 0))}};Re=(0,c.__decorate)([(0,_e.W)(ye.Vs),(0,c.__metadata)("design:paramtypes",[ge])],Re);let Pe=class{};Pe=(0,c.__decorate)([(0,d.Yl)({api:p.i,handlers:{commands:{changeTwoFactorAuthenticationOtpType:Se,clearError:Ee,resendEmailToken:fe,resendPushNotification:Ae,submitBackupCode:Ie,submitEmailToken:Oe,submitTotp:be,switchToDashlaneAuthenticator:Te,switchToEmailToken:Ce,startIdentityVerification:we,cancelIdentityVerification:Re},events:{},queries:{identityVerificationFlowStatus:ve}},providers:[j,L,M,x,Y,...(0,l.H)(ge,{inject:[Q,le],asyncFactory:async(e,t)=>{const r=new ge(e,t);return await r.prepare(),r}}),Q,K,H,N,D,F],imports:[u.n],exports:[ge],stores:[le,z]})],Pe)},87470:(e,t,r)=>{r.d(t,{N:()=>ae});var s=r(88802),i=r(99634),o=r(89033),a=r(28760),n=r(37935),c=r(93850),d=r(85035),l=r(63663),u=r(87279),p=r(73675),m=r(86252),h=r(57924),g=r(9671),v=r(92258),_=r(31222),y=r(87113),S=r(10370),E=r(7502),f=r(60198),A=r(18533),I=r(20195),O=r(95087),b=r(89358),T=r(87065),C=r(89618),w=r(25313),R=r(41842),P=r(85390),D=r(60399);let N=null;async function U(){if(!N){const{client:e}=await async function(){const{client:e,ready:t}=await Promise.all([r.e(642),r.e(633),r.e(877),r.e(495),r.e(373),r.e(139)]).then(r.bind(r,6504));return await t,{client:e}}();N=e}return N}var F=r(25029),M=r(95681),L=r(23347),G=r(7165),K=r(10722);const x=G.z.object({localAccounts:G.z.record(G.z.string(),G.z.object({salt:G.z.string(),encryptedSessionKey:G.z.string(),serverSessionKey:G.z.string(),attemptsLeft:G.z.number()}))}),k=e=>x.safeParse(e).success;class j extends((0,M.Q)({persist:!0,storage:{initialValue:{localAccounts:{}},schemaVersion:1,typeGuard:k,migrateStorageSchema:()=>({localAccounts:{}})},codec:K.E,scope:F.F.Device,storeName:"pincode",capacity:L.Y._001KB})){}var V=r(56268),W=r(25594),B=r(94805),z=r(16698);let H=class{constructor(e,t){this.flexibleEncryptor=e,this.flexibleDecryptor=t}async encryptSessionKeyWithPinKey(e,t){return await this.flexibleEncryptor.encrypt(t,e,B.oo,z.gO)}async decryptSessionKeyWithPinKey(e,t){return await this.flexibleDecryptor.decrypt(t,e)}};H=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[V._,W.a])],H);var Y=r(67978),Q=r(75994);let q=class extends Y.K{constructor(e,t){super(`/assets/pin-code.${"https://api.dashlane.com"===t.baseUrl?"prod":"staging"}.config.json`,e)}loadResource(e){if(!((t=e)&&"object"==typeof t&&"serverIdentifier"in t&&"serverPublicKey"in t))throw new Error("File corrupted");var t;return e}};q=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[Q.X,y.l])],q);let $=class{constructor(e,t,r,s,i,o,a,n,c){this.pinCodeStore=e,this.session=t,this.keyGenerator=r,this.hmacSigner=s,this.sessionKeyCrypto=i,this.serverApi=o,this.allowToFail=a,this.carbonClient=n,this.pinCodeServerConfigResourceLoader=c}getPinCodeStatus(e){return this.pinCodeStore.state$.pipe((0,T.U)((t=>{const r=e in t.localAccounts;return(0,u.Vp)(r?{isPinCodeEnabled:!0,attemptsLeft:t.localAccounts[e].attemptsLeft}:{isPinCodeEnabled:!1})})))}getCurrentUserPinCodeStatus(){const e=this.session.queries.selectedOpenedSession().pipe((0,C.V)({first:5e3,with:()=>(0,w._)((()=>new Error("No current active user")))}),(0,T.U)((e=>(0,u.d6)(e)&&e.data?e.data:"")),(0,R.h)((e=>!!e)));return(0,P.a)([e,this.pinCodeStore.state$]).pipe((0,T.U)((([e,t])=>{const r=e in t.localAccounts;return(0,u.Vp)(r?{isPinCodeEnabled:!0,attemptsLeft:t.localAccounts[e].attemptsLeft}:{isPinCodeEnabled:!1})})))}async activatePinCode(e){const t=await this.getCurrentUserEmail(),r=await(0,D.z)(this.carbonClient.queries.carbonState({path:"state.authentication.currentUser.rememberMeType"}));(0,u.d6)(r)&&"autologin"===r.data&&await this.carbonClient.commands.disableAutologin();const s=await this.pinCodeStore.getState(),i=await this.getExportedSessionKey(),o=(0,S.s)(await this.keyGenerator.generate()),a=await U(),n=(0,S.s)(await this.hmacSigner.sign((0,E.R)(o),(new TextEncoder).encode(e))),{clientRegistrationState:c,registrationRequest:d}=a.startRegistration({password:n}),l=await(0,D.z)(this.serverApi.v1.authentication.pincodeRequestActivation({activationRequest:d})),p=(0,A.EQ)(l,{success:e=>e.data.data.activationResponse,failure:e=>(0,A.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"FAILED_TO_PROCESS_ACTIVATION_REQUEST":case"SSO_USER_NOT_ALLOWED":return(0,I.j)(e.code);default:(0,O.U)(e)}},FetchFailedError:I.j,InternalServerError:I.j,InvalidRequest:I.j,RateLimited:I.j,ServiceUnavailable:I.j,UnspecifiedBadStatus:I.j})}),m=await this.pinCodeServerConfigResourceLoader.get(),{registrationRecord:h,exportKey:g,serverStaticPublicKey:v}=a.finishRegistration({clientRegistrationState:c,registrationResponse:p,password:n,identifiers:{client:t,server:m.serverIdentifier}});if(v!==m.serverPublicKey)throw new Error("OPAQUEs serverStaticPublicKey does not match api configs.");const _=await(0,D.z)(this.serverApi.v1.authentication.pincodeCompleteActivation({pinCodeRecord:h})),y=(0,A.EQ)(_,{success:e=>e.data.data.sessionKey,failure:e=>(0,A.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"ACTIVATION_REQUEST_NOT_FOUND":case"EMPTY_PIN_CODE_RECORD":return(0,I.j)(e.code);default:(0,O.U)(e)}},FetchFailedError:I.j,InternalServerError:I.j,InvalidRequest:I.j,RateLimited:I.j,ServiceUnavailable:I.j,UnspecifiedBadStatus:I.j})}),b=(0,f.N)(g),T=await this.sessionKeyCrypto.encryptSessionKeyWithPinKey(i,b);await this.pinCodeStore.set({...s,localAccounts:{...s.localAccounts,[t]:{...s.localAccounts[t],serverSessionKey:y,salt:o,encryptedSessionKey:(0,S.s)(T),attemptsLeft:3}}})}async removePinCodeFromStore(e){const t=await this.pinCodeStore.getState();delete t.localAccounts[e],await this.pinCodeStore.set(t)}async deactivatePinCode(){const e=await this.getCurrentUserEmail();e in(await this.pinCodeStore.getState()).localAccounts&&(await this.removePinCodeFromStore(e),await this.allowToFail.doOne((async()=>await(0,D.z)(this.serverApi.v1.authentication.pincodeDisable({}))),"Deactivate pin code"))}async computePinKey(e,t){const r=await this.pinCodeStore.getState();if(!(t in r.localAccounts))return(0,u.Rn)((0,p.Zs)());const{serverSessionKey:s,salt:i}=r.localAccounts[t],o=(0,S.s)(await this.hmacSigner.sign((0,E.R)(i),(new TextEncoder).encode(e))),a=await U(),{clientLoginState:n,startLoginRequest:c}=a.startLogin({password:o}),d=await(0,D.z)(this.serverApi.v1.authentication.pincodeRequestLogin({loginRequest:c,sessionKey:s})),l=(0,A.EQ)(d,{success:e=>(0,u.Vp)(e.data.data),failure:e=>(0,A.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"INVALID_SESSION_KEY":case"NO_PIN_CODE_ACTIVATED":case"FAILED_TO_PROCESS_LOGIN_REQUEST":case"MAX_ATTEMPTS_REACHED":return(0,u.Rn)((0,p.Zs)());default:(0,O.U)(e)}},FetchFailedError:I.j,InternalServerError:I.j,InvalidRequest:I.j,RateLimited:I.j,ServiceUnavailable:I.j,UnspecifiedBadStatus:I.j})});if(!(0,u.d6)(l))return await this.removePinCodeFromStore(t),l;const{loginResponse:m,attemptsLeft:h}=l.data,g=await this.pinCodeStore.getState();await this.pinCodeStore.set({...g,localAccounts:{...g.localAccounts,[t]:{...g.localAccounts[t],attemptsLeft:h}}});const v=await this.pinCodeServerConfigResourceLoader.get(),_=a.finishLogin({clientLoginState:n,loginResponse:m,password:o,identifiers:{client:t,server:v.serverIdentifier}});if(!_)return 0===h&&await this.removePinCodeFromStore(t),(0,u.Rn)((0,p.g5)());if(_.serverStaticPublicKey!==v.serverPublicKey)throw new Error("OPAQUEs serverStaticPublicKey does not match api configs.");const{exportKey:y,finishLoginRequest:b}=_;return await this.allowToFail.doOne((async()=>await(0,D.z)(this.serverApi.v1.authentication.pincodeCompleteLogin({sessionKey:s,completeLoginRequest:b}))),"Complete login with pin code"),(0,u.Vp)((0,f.N)(y))}async loginWithPinCode(e,t){const r=await this.pinCodeStore.getState();if(!(e in r.localAccounts))return(0,u.Rn)((0,p.Zs)());const{encryptedSessionKey:s}=r.localAccounts[e],i=await this.computePinKey(t,e);if(!(0,u.d6)(i))return i;const o=i.data,a=await this.sessionKeyCrypto.decryptSessionKeyWithPinKey((0,E.R)(s),o),n=await this.session.commands.openUserSession({email:e,rememberPassword:!1,sessionKey:{type:"exported",content:(0,S.s)(a)}});if(!(0,u.d6)(n))throw new Error("Failed to open the session");return(0,u.Vp)(void 0)}async getCurrentUserEmail(){const e=await(0,D.z)(this.session.queries.selectedOpenedSession());if(!(0,u.d6)(e)||!e.data)throw new Error("No current session was found");return e.data}async getExportedSessionKey(){const e=await(0,D.z)(this.session.queries.exportSessionKey());if(!(0,u.d6)(e))throw new Error("Failed to export session key");return(0,E.R)(e.data.content)}};$=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[j,b.x,v.c,_.q,H,y.l,g.J,m._,q])],$);let X=class{constructor(e){this.pinCodeService=e}async execute({body:e}){return await this.pinCodeService.activatePinCode(e.pinCode),(0,u.Vp)(void 0)}};X=(0,s.__decorate)([(0,l.W)(d.r),(0,s.__metadata)("design:paramtypes",[$])],X);var Z=r(44878);let J=class{constructor(e){this.pinCodeService=e}async execute(){return await this.pinCodeService.deactivatePinCode(),(0,u.Vp)(void 0)}};J=(0,s.__decorate)([(0,l.W)(Z.E),(0,s.__metadata)("design:paramtypes",[$])],J);let ee=class{constructor(e){this.pinCodeService=e}async execute({body:e}){return await this.pinCodeService.loginWithPinCode(e.email,e.pinCode)}};ee=(0,s.__decorate)([(0,l.W)(p.cM),(0,s.__metadata)("design:paramtypes",[$])],ee);var te=r(35941),re=r(20754);let se=class{constructor(e){this.pinCodeService=e}execute(e){return this.pinCodeService.getPinCodeStatus(e.body.loginEmail)}};se=(0,s.__decorate)([(0,re.e)(te.D),(0,s.__metadata)("design:paramtypes",[$])],se);var ie=r(67160);let oe=class{constructor(e){this.pinCodeService=e}execute(){return this.pinCodeService.getCurrentUserPinCodeStatus()}};oe=(0,s.__decorate)([(0,re.e)(ie.o),(0,s.__metadata)("design:paramtypes",[$])],oe);let ae=class{};ae=(0,s.__decorate)([(0,i.Yl)({api:o.n,stores:[j],imports:[n.D,c.n],handlers:{commands:{activate:X,deactivate:J,loginWithPinCode:ee},events:{},queries:{getStatus:se,getCurrentUserStatus:oe}},providers:[$,H,q],requiredFeatureFlips:Object.values(a.T)})],ae)},25814:(e,t,r)=>{r.d(t,{Z:()=>O});var s=r(88802),i=r(69401),o=r(99634),a=r(93850),n=r(13460),c=r(11088),d=r(63663),l=r(63281),u=r(87279),p=r(89358),m=r(60399),h=r(59550);let g=class{constructor(e,t,r){this.contextLessServerApiClient=e,this.authWSRepository=t,this.sessionClient=r}async execute(e){const t=await(0,m.z)(this.sessionClient.queries.selectedOpenedSession()),r=(0,u.d6)(t)?(0,u.db)(t):e.body.login;if(void 0===r)throw new Error("Logged out and no login specified");const{id:s,type:i,rawId:o,response:a}=e.body.assertion,n=await(0,m.z)(this.contextLessServerApiClient.v1.authentication.completeRememberMeOpenSession(await this.authWSRepository.getSessionCredentialsForUser(r),{authenticator:{authenticationType:"webauthn.get",credential:{type:i,id:s,rawId:o,response:a}}}));if((0,u.hx)(n))throw new Error(`Assertion could not be validated: ${n.error.name}`);return(0,u.Vp)(void 0)}};g=(0,s.__decorate)([(0,d.W)(c.L),(0,s.__metadata)("design:paramtypes",[l.B,h.Q,p.x])],g);var v=r(6939),_=r(87113),y=r(18533),S=r(25535),E=r(20195),f=r(83853);function A(e){return()=>(0,u.Rn)({tag:e})}let I=class{constructor(e){this.server=e}async execute({body:{email:e}}){const t=await(0,m.z)(this.server.v1.authentication.requestOtpRecoveryCodesByPhone({login:e}));return(0,y.EQ)(t,{success:()=>(0,u.Vp)(void 0),failure:e=>(0,y.EQ)(e.error,{...v.J,FetchFailedError:A(f.A.NetworkError),BusinessError:e=>(0,S.G)(e.code,{INVALID_RECOVERY_PHONE:A(f.A.AccountNotEligible),SMS_ERROR:()=>(0,E.j)("Dashlane servers failed to send SMS"),SMS_OPT_OUT:A(f.A.AccountNotEligible),USER_NOT_FOUND:A(f.A.AccountNotEligible),WRONG_OTP_STATUS:A(f.A.AccountNotEligible)})})})}};I=(0,s.__decorate)([(0,d.W)(c.x),(0,s.__metadata)("design:paramtypes",[_.l])],I);let O=class{};O=(0,s.__decorate)([(0,o.Yl)({api:i.M,handlers:{commands:{validateWebauthnAssertion:g,request2FaCodesByPhone:I},events:{},queries:{}},imports:[a.n,n.R]})],O)},17556:(e,t,r)=>{r.d(t,{e:()=>s});class s{redirectUserToExternalUrl(e){!async function(){try{await chrome.tabs.create({url:e.externalUrl,active:e.tabFocus})}catch(t){console.warn("[Auto-SSO] No window available. Delaying tab creation");const r=()=>{chrome.tabs.create({url:e.externalUrl,active:e.tabFocus}),chrome.windows.onCreated.removeListener(r)};chrome.windows.onCreated.addListener(r)}}()}}},15403:(e,t,r)=>{r.d(t,{c:()=>n});var s=r(86952),i=r(21494),o=r(57655),a=r(24221);const n=(0,s.Q)({name:"autofillData",commands:{},events:{},queries:{getSingleAutofillData:i.a,getMultipleAutofillData:o.N,searchAutofillData:a.w}})},57655:(e,t,r)=>{r.d(t,{N:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},21494:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},24221:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},92018:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(86952),i=r(11564),o=r(73581);const a=(0,s.Q)({name:"autofillTracking",commands:{temporaryEmitPasswordAutofillPerformedEvent:o.q},events:{passwordAutofillPerformedEvent:i.p},queries:{}})},73581:(e,t,r)=>{r.d(t,{q:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},11564:(e,t,r)=>{r.d(t,{p:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.User})){}},59325:(e,t,r)=>{var s;r.d(t,{S:()=>s}),function(e){e.AutofillWebOneClickFormFill="autofill_web_oneClickFormFill",e.AutofillWebAskBeforeAutologin="autofill_web_askBeforeAutologin",e.AutofillWebNewSubdomainManagement="autofill_web_newSubdomainManagement",e.AutofillWebInjectScriptOnStartDev="autofill_web_injectScriptOnStart_dev",e.ReplaceInputListeners="autofill_web_replaceInputListeners",e.ReplaceInputListenersDev="autofill_web_replaceInputListeners_dev",e.PasskeySupport="autofill_web_passkey_support",e.PhishingPreventionOnPasteDev="autofill_web_phishing_prevention_on_paste_dev",e.PhishingPreventionOnPaste="autofill_web_phishing_prevention_on_paste_2",e.ImproveImpalaVisibility="autofill_web_improveImpalaVisibility",e.ImproveImpalaVisibilityDev="autofill_web_improveImpalaVisibility_dev",e.DisableAutologin="autofill_web_disableAutologin",e.AdminTabDev="ace_admin_tab_dev",e.AdminTab="ace_admin_tab",e.DisableEmailPasswordWarningDev="ace_disable_email_password_warning_dev",e.DisableEmailPasswordWarning="ace_disable_email_password_warning",e.RestrictPasswordFreePlanPhase1="b2c_web_restrict_password_free_plan_phase1",e.RestrictPasswordFreePlanPhase2="b2c_web_restrict_password_free_plan_phase2",e.EnableAdditionalInputEventInTimeout="ace_web_enableAdditionalInputEventInTimeout",e.AdminInterview="ace_admin_tab_interview",e.AdminInterviewDev="ace_admin_tab_interview_dev",e.LinkedWebsitesInContextDev="ace_web_linkedWebsitesInContext_dev",e.GrapheneMigrationV3Dev="ace_web_graphene_migration_v3_dev",e.SecretsAttachment="ace_secrets_vault_attachment",e.InAppPasswordHealthBadges="ace_inapp_passwordhealth_indicators",e.NewUserVerificationForItemUnlock="ace_web_new_uv_item_unlock",e.SharedCollectionInSaveWebcard="shared_collection_in_save_webcard_dev"}(s||(s={}))},46154:(e,t,r)=>{r.d(t,{Pw:()=>a,q_:()=>i,rF:()=>n,up:()=>s});const s=["KWAddress","KWBankStatement","KWCompany","KWDriverLicence","KWEmail","KWFiscalStatement","KWIDCard","KWIdentity","KWMerchand","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWSecureNote","KWSecureNoteCategory","KWSocialSecurityStatement"],i=["KWAuthentifiant","KWGeneratedPassword","KWPasskey"],o=[...s,...i],a=e=>!!e&&"string"==typeof e&&o.includes(e),n=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every(a)},3124:(e,t,r)=>{r.d(t,{P:()=>s,w:()=>i});const s=e=>e instanceof Array&&!e.find((e=>{return!("object"==typeof(t=e)&&null!==t&&"id"in t&&"fieldIdentifier"in t&&"domain"in t);var t})),i=e=>"none"===e.correctedDataSource},52434:(e,t,r)=>{var s;r.d(t,{M:()=>s}),function(e){e[e.CannotDisable=0]="CannotDisable",e[e.DisableSpecificVaultItem=1]="DisableSpecificVaultItem",e[e.DisableGeneralSetting=2]="DisableGeneralSetting"}(s||(s={}))},78364:(e,t,r)=>{var s;r.d(t,{k:()=>s}),function(e){e.Address="Address",e.BankAccount="BankAccount",e.Company="Company",e.Credential="Credential",e.DriverLicense="DriverLicense",e.Email="Email",e.FiscalId="FiscalId",e.GeneratedPassword="GeneratedPassword",e.IdCard="IdCard",e.Identity="Identity",e.NoteCategory="NoteCategory",e.Note="Note",e.Passport="Passport",e.Passkey="Passkey",e.PaymentCard="PaymentCard",e.PersonalWebsite="PersonalWebsite",e.Phone="Phone",e.Secret="Secret",e.SocialSecurityId="SocialSecurityId"}(s||(s={}))},70976:(e,t,r)=>{r.r(t),r.d(t,{AddDisabledSourceTypesCommand:()=>F.g,AddLinkedWebsiteCommand:()=>J.vp,AddLinkedWebsiteErrors:()=>J.hy,AnalysisStatus:()=>P._,AutofillFeatureFlips:()=>l.S,AutofillSettingsApiClient:()=>R.W,CREDENTIAL_DATA_MODELS:()=>v.q_,CountriesForAutofill:()=>u,DisableAnalysisCommand:()=>M.u,DisableAutofillOnFormsCommand:()=>G.t,DisableAutofillOnLoginsCommand:()=>K.f,DisableAutologinCommand:()=>L.T,DisableFollowUpNotificationCommand:()=>x.y,DisablePhishingPreventionForUrlCommand:()=>C.z,EnableAnalysisCommand:()=>k.c,EnableAutofillOnFormsCommand:()=>V.a,EnableAutofillOnLoginsCommand:()=>W.I,EnableAutologinCommand:()=>j.i,EnableFollowUpNotificationCommand:()=>B.B,FORM_DATA_MODELS:()=>v.up,GetAnalysisStatusOnUrlQuery:()=>P.h,GetAutofillDisabledOnLoginsAndFormsNotificationStatusQuery:()=>f.z,GetAutofillProtectionContextQuery:()=>I.u,GetAutofillSettingsQuery:()=>D.T,GetDashlaneDefinedLinkedWebsitesQuery:()=>X.J,GetMultipleAutofillDataQuery:()=>o.N,GetPreferencesForCredentialsQuery:()=>U.g,GetSingleAutofillDataQuery:()=>i.a,GetUserAutofillCorrectionsQuery:()=>N.w,LinkedWebsitesClient:()=>$.X,OtherSourceType:()=>p,PasswordAutofillPerformedEvent:()=>c.p,PhishingPreventionDisabledForUrlQuery:()=>b.v,PhishingPreventionEnabledQuery:()=>O.i,RemoveDisabledSourceTypesCommand:()=>z.v,RemoveLinkedWebsiteCommand:()=>ee.M7,RemoveLinkedWebsiteErrors:()=>ee.E6,ResetProtectedItemAutofillTimerCommand:()=>T.y,SearchAutofillDataQuery:()=>a.w,SetAutofillDisabledOnLoginsAndFormsNotificationStatusCommand:()=>E.a,SetUserAutofillCorrectionsCommand:()=>Y.S,TemporaryEmitPasswordAutofillPerformedEventCommand:()=>d.q,ToggleDashlaneCommand:()=>H.r,UpdateCredentialPreferencesCommand:()=>Q.J,UpdateLinkedWebsitesCommand:()=>Z.A,VaultItemDisableProtectionMode:()=>y.M,VaultSourceType:()=>m.k,autofillDataApi:()=>s.c,autofillNotificationsApi:()=>S._,autofillSecurityApi:()=>A.V,autofillSettingsApi:()=>w.I,autofillTrackingApi:()=>n.Y,createAddLinkedWebsiteCredentialNotFound:()=>J.i6,createAddLinkedWebsiteErrorOnUpdatingVault:()=>J.R6,createAddLinkedWebsiteWebsiteAlreadyLinked:()=>J.lD,createRemoveLinkedWebsiteCredentialNotFound:()=>ee.W4,createRemoveLinkedWebsiteErrorOnUpdatingVault:()=>ee.cQ,isArrayOfAutofillableDataModel:()=>v.rF,isArrayOfUserAutofillCorrections:()=>_.P,isAutofillableDataModel:()=>v.Pw,isDashlaneDisabledPermanently:()=>_.w,isOtherSourceType:()=>h,isVaultSourceType:()=>g,linkedWebsitesApi:()=>q.G});var s=r(15403),i=r(21494),o=r(57655),a=r(24221),n=r(92018),c=r(11564),d=r(73581),l=r(59325);const u=Object.freeze({NO_TYPE:"NO_TYPE",UNIVERSAL:"UNIVERSAL",AD:"AD",AE:"AE",AF:"AF",AG:"AG",AI:"AI",AL:"AL",AM:"AM",AO:"AO",AR:"AR",AS:"AS",AT:"AT",AU:"AU",AW:"AW",AZ:"AZ",BA:"BA",BB:"BB",BD:"BD",BE:"BE",BF:"BF",BG:"BG",BH:"BH",BI:"BI",BJ:"BJ",BL:"BL",BM:"BM",BN:"BN",BO:"BO",BR:"BR",BS:"BS",BT:"BT",BW:"BW",BY:"BY",BZ:"BZ",CA:"CA",CD:"CD",CF:"CF",CG:"CG",CH:"CH",CI:"CI",CK:"CK",CL:"CL",CM:"CM",CN:"CN",CO:"CO",CR:"CR",CU:"CU",CV:"CV",CY:"CY",CZ:"CZ",DE:"DE",DJ:"DJ",DK:"DK",DM:"DM",DO:"DO",DZ:"DZ",EC:"EC",EE:"EE",EG:"EG",ER:"ER",ES:"ES",ET:"ET",FI:"FI",FJ:"FJ",FK:"FK",FM:"FM",FO:"FO",FR:"FR",GA:"GA",GB:"GB",GD:"GD",GE:"GE",GF:"GF",GG:"GG",GH:"GH",GI:"GI",GL:"GL",GM:"GM",GN:"GN",GP:"GP",GQ:"GQ",GR:"GR",GT:"GT",GU:"GU",GW:"GW",GY:"GY",HK:"HK",HN:"HN",HR:"HR",HT:"HT",HU:"HU",ID:"ID",IE:"IE",IL:"IL",IM:"IM",IN:"IN",IO:"IO",IQ:"IQ",IR:"IR",IS:"IS",IT:"IT",JE:"JE",JM:"JM",JO:"JO",JP:"JP",KE:"KE",KG:"KG",KH:"KH",KI:"KI",KM:"KM",KN:"KN",KP:"KP",KR:"KR",KW:"KW",KY:"KY",KZ:"KZ",LA:"LA",LB:"LB",LC:"LC",LI:"LI",LK:"LK",LR:"LR",LS:"LS",LT:"LT",LU:"LU",LV:"LV",LY:"LY",MA:"MA",MC:"MC",MD:"MD",ME:"ME",MF:"MF",MG:"MG",MH:"MH",MK:"MK",ML:"ML",MM:"MM",MN:"MN",MO:"MO",MP:"MP",MQ:"MQ",MR:"MR",MS:"MS",MT:"MT",MU:"MU",MV:"MV",MW:"MW",MX:"MX",MY:"MY",MZ:"MZ",NA:"NA",NC:"NC",NE:"NE",NF:"NF",NG:"NG",NI:"NI",NL:"NL",NO:"NO",NP:"NP",NR:"NR",NU:"NU",NZ:"NZ",OM:"OM",PA:"PA",PE:"PE",PF:"PF",PG:"PG",PH:"PH",PK:"PK",PL:"PL",PM:"PM",PR:"PR",PS:"PS",PT:"PT",PW:"PW",PY:"PY",QA:"QA",RE:"RE",RO:"RO",RS:"RS",RU:"RU",RW:"RW",SA:"SA",SB:"SB",SC:"SC",SD:"SD",SE:"SE",SG:"SG",SH:"SH",SI:"SI",SK:"SK",SL:"SL",SM:"SM",SN:"SN",SO:"SO",SR:"SR",ST:"ST",SV:"SV",SY:"SY",SZ:"SZ",TC:"TC",TD:"TD",TF:"TF",TG:"TG",TH:"TH",TJ:"TJ",TK:"TK",TL:"TL",TM:"TM",TN:"TN",TO:"TO",TR:"TR",TT:"TT",TV:"TV",TW:"TW",TZ:"TZ",UA:"UA",UG:"UG",US:"US",UY:"UY",UZ:"UZ",VA:"VA",VC:"VC",VE:"VE",VG:"VG",VI:"VI",VN:"VN",VU:"VU",WF:"WF",WS:"WS",XK:"XK",YE:"YE",YT:"YT",ZA:"ZA",ZM:"ZM",ZW:"ZW",AQ:"AQ",AX:"AX",BV:"BV",CC:"CC",CX:"CX",EH:"EH",GS:"GS",HM:"HM",PN:"PN",SJ:"SJ",UM:"UM"});var p,m=r(78364);!function(e){e.NewPassword="newPassword",e.SubmitButton="submitButton",e.WebauthnConditionalUI="WebauthnConditionalUI"}(p||(p={}));const h=e=>Object.values(p).includes(e),g=e=>e in m.k;var v=r(46154),_=r(3124),y=r(52434),S=r(45714),E=r(61933),f=r(63208),A=r(38554),I=r(51730),O=r(5282),b=r(63212),T=r(93555),C=r(94370),w=r(69029),R=r(72250),P=r(68573),D=r(63267),N=r(3414),U=r(95371),F=r(99682),M=r(3909),L=r(34962),G=r(65791),K=r(56e3),x=r(11232),k=r(54405),j=r(4924),V=r(38018),W=r(69643),B=r(82796),z=r(46918),H=r(50163),Y=r(29641),Q=r(15269),q=r(46097),$=r(25146),X=r(66608),Z=r(9446),J=r(3535),ee=r(88026)},46097:(e,t,r)=>{r.d(t,{G:()=>c});var s=r(86952),i=r(66608),o=r(3535),a=r(88026),n=r(9446);const c=(0,s.Q)({name:"linkedWebsites",commands:{addLinkedWebsite:o.vp,removeLinkedWebsite:a.M7,updateLinkedWebsites:n.A},events:{},queries:{getDashlaneDefinedLinkedWebsites:i.J}})},25146:(e,t,r)=>{r.d(t,{X:()=>o});var s=r(67837),i=r(46097);class o extends((0,s.E)(i.G)){}(0,s.K)(i.G,o)},3535:(e,t,r)=>{r.d(t,{R6:()=>d,hy:()=>s,i6:()=>n,lD:()=>c,vp:()=>l});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.CREDENTIAL_NOT_FOUND="credential_not_found",e.WEBSITE_ALREADY_LINKED="website_already_linked",e.ERROR_ON_UPDATING_VAULT="error_on_updating_vault"}(s||(s={}));const n=(0,a.Vj)(s.CREDENTIAL_NOT_FOUND,"Couldn't retrieve the credential"),c=(0,a.Vj)(s.WEBSITE_ALREADY_LINKED,"Website alredy linked to this credential"),d=(0,a.Vj)(s.ERROR_ON_UPDATING_VAULT,"Error while updating the credential");class l extends((0,i.g)({scope:o.F.User})){}},88026:(e,t,r)=>{r.d(t,{E6:()=>s,M7:()=>d,W4:()=>n,cQ:()=>c});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.CREDENTIAL_NOT_FOUND="credential_not_found",e.ERROR_ON_UPDATING_VAULT="error_on_updating_vault"}(s||(s={}));const n=(0,a.Vj)(s.CREDENTIAL_NOT_FOUND,"Couldn't retrieve the credential"),c=(0,a.Vj)(s.ERROR_ON_UPDATING_VAULT,"Error while updating the credential");class d extends((0,i.g)({scope:o.F.User})){}},9446:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},66608:(e,t,r)=>{r.d(t,{J:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},45714:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(86952),i=r(61933),o=r(63208);const a=(0,s.Q)({name:"autofillNotifications",commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:i.a},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:o.z}})},61933:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},63208:(e,t,r)=>{r.d(t,{z:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},38554:(e,t,r)=>{r.d(t,{V:()=>d});var s=r(86952),i=r(51730),o=r(5282),a=r(63212),n=r(94370),c=r(93555);const d=(0,s.Q)({name:"autofillSecurity",commands:{disablePhishingPreventionForUrl:n.z,resetProtectedItemAutofillTimer:c.y},events:{},queries:{getAutofillProtectionContext:i.u,isPhishingPreventionCapabilityEnabled:o.i,isPhishingPreventionDisabledForUrl:a.v}})},94370:(e,t,r)=>{r.d(t,{z:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},93555:(e,t,r)=>{r.d(t,{y:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},51730:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},5282:(e,t,r)=>{r.d(t,{i:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},63212:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},69029:(e,t,r)=>{r.d(t,{I:()=>I});var s=r(86952),i=r(46918),o=r(99682),a=r(50163),n=r(68573),c=r(63267),d=r(3414),l=r(95371),u=r(54405),p=r(4924),m=r(38018),h=r(69643),g=r(82796),v=r(3909),_=r(34962),y=r(65791),S=r(56e3),E=r(11232),f=r(29641),A=r(15269);const I=(0,s.Q)({name:"autofillSettings",commands:{toggleDashlane:a.r,enableAnalysis:u.c,enableAutologin:p.i,enableAutofillOnForms:m.a,enableAutofillOnLogins:h.I,enableFollowUpNotification:g.B,disableAnalysis:v.u,disableAutologin:_.T,disableAutofillOnForms:y.t,disableAutofillOnLogins:S.f,disableFollowUpNotification:E.y,addDisabledSourceTypes:o.g,removeDisabledSourceTypes:i.v,setUserAutofillCorrections:f.S,updateCredentialPreferences:A.J},events:{},queries:{getAnalysisStatusOnUrl:n.h,getAutofillSettings:c.T,getUserAutofillCorrections:d.w,getPreferencesForCredentials:l.g}})},72250:(e,t,r)=>{r.d(t,{W:()=>o});var s=r(67837),i=r(69029);class o extends((0,s.E)(i.I)){}(0,s.K)(i.I,o)},99682:(e,t,r)=>{r.d(t,{g:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},3909:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},65791:(e,t,r)=>{r.d(t,{t:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},56e3:(e,t,r)=>{r.d(t,{f:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},34962:(e,t,r)=>{r.d(t,{T:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},11232:(e,t,r)=>{r.d(t,{y:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},54405:(e,t,r)=>{r.d(t,{c:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},38018:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},69643:(e,t,r)=>{r.d(t,{I:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},4924:(e,t,r)=>{r.d(t,{i:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},82796:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},46918:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},29641:(e,t,r)=>{r.d(t,{S:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},50163:(e,t,r)=>{r.d(t,{r:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},15269:(e,t,r)=>{r.d(t,{J:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},68573:(e,t,r)=>{r.d(t,{_:()=>s,h:()=>a});var s,i=r(99059),o=r(25029);!function(e){e.ANALYSIS_ENABLED="ANALYSIS_ENABLED",e.ANALYSIS_DISABLED_BY_USER="ANALYSIS_DISABLED_BY_USER",e.ANALYSIS_DISABLED_BY_B2B_ADMIN="ANALYSIS_DISABLED_BY_B2B_ADMIN",e.ANALYSIS_DISABLED_BY_KILLSWITCH="ANALYSIS_DISABLED_BY_KILLSWITCH",e.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT="ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT"}(s||(s={}));class a extends((0,i.k)({scope:o.F.Device})){}},63267:(e,t,r)=>{r.d(t,{T:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},95371:(e,t,r)=>{r.d(t,{g:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},3414:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},73346:(e,t,r)=>{r.d(t,{c:()=>s});const s=(0,r(86952).Q)({name:"deviceManagement",commands:{},events:{},queries:{}})},75453:(e,t,r)=>{r.d(t,{B:()=>u});var s=r(88802),i=r(99634),o=r(73346),a=r(25029),n=r(95681),c=r(23347);const d=e=>!(!e||"object"!=typeof e)&&"isOpen"in e;class l extends((0,n.Q)({initialValue:{isOpen:!1},persist:!1,scope:a.F.User,storeName:"device-management",storeTypeGuard:d,capacity:c.Y._010KB})){}let u=class{};u=(0,s.__decorate)([(0,i.Yl)({api:o.c,handlers:{commands:{},events:{},queries:{}},stores:[l]})],u)},92137:(e,t,r)=>{r.r(t),r.d(t,{DismissMasterPasswordNotificationCommand:()=>i.T,IsMasterPasswordLeakedQuery:()=>c.B,IsMasterPasswordNotificationDismissedQuery:()=>d.F,IsMasterPasswordWeakQuery:()=>l.D,TemporaryCheckMasterPasswordCommand:()=>o.T,TemporaryCheckMasterPasswordWeakCommand:()=>n.B,TemporaryResetMasterPasswordLeakedCommand:()=>a.j,masterPasswordSecurityApi:()=>s.J});var s=r(75962),i=r(80673),o=r(88030),a=r(30600),n=r(5105),c=r(22730),d=r(23913),l=r(86695)},75962:(e,t,r)=>{r.d(t,{J:()=>u});var s=r(86952),i=r(80673),o=r(88030),a=r(30600),n=r(5105),c=r(22730),d=r(86695),l=r(23913);const u=(0,s.Q)({name:"masterPasswordSecurity",commands:{dismissMasterPasswordNotification:i.T,temporaryCheckMasterPassword:o.T,temporaryResetMasterPasswordLeaked:a.j,temporaryCheckMasterPasswordWeak:n.B},events:{},queries:{isMasterPasswordLeaked:c.B,isMasterPasswordWeak:d.D,isMasterPasswordNotificationDismissed:l.F}})},80673:(e,t,r)=>{r.d(t,{T:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},5105:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},88030:(e,t,r)=>{r.d(t,{T:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},30600:(e,t,r)=>{r.d(t,{j:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},22730:(e,t,r)=>{r.d(t,{B:()=>i});var s=r(99059);class i extends((0,s.k)()){}},23913:(e,t,r)=>{r.d(t,{F:()=>i});var s=r(99059);class i extends((0,s.k)()){}},86695:(e,t,r)=>{r.d(t,{D:()=>i});var s=r(99059);class i extends((0,s.k)()){}},56680:(e,t,r)=>{r.d(t,{f:()=>De});var s=r(99634),i=r(75962),o=r(37935),a=r(93850),n=r(70305),c=r(20754),d=r(22730),l=r(25029),u=r(95681),p=r(23347),m=r(10722),h=r(7165);const g=h.z.object({isMasterPasswordLeaked:h.z.boolean(),isMasterPasswordNotificationDismissed:h.z.boolean(),isMasterPasswordWeak:h.z.boolean(),lastCheckTimestamp:h.z.number()}),v=h.z.union([h.z.object({isMasterPasswordLeaked:h.z.boolean(),isMasterPasswordLeakedNotificationDismissed:h.z.boolean(),isMasterPasswordWeak:h.z.boolean(),lastCheckTimestamp:h.z.number()}),g]),_=e=>g.safeParse(e).success,y=e=>v.safeParse(e).success;function S(e){const{content:t,version:r}=e;if(1===r&&y(t))return _(t)?t:{isMasterPasswordWeak:t.isMasterPasswordWeak,isMasterPasswordLeaked:t.isMasterPasswordLeaked,isMasterPasswordNotificationDismissed:t.isMasterPasswordLeakedNotificationDismissed,lastCheckTimestamp:t.lastCheckTimestamp};throw new Error(`Unable to migrate unexpected master-password-security schema version ${r}`)}const E={isMasterPasswordWeak:!1,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1,lastCheckTimestamp:0};class f extends((0,u.Q)({persist:!0,storage:{initialValue:E,typeGuard:_,schemaVersion:2,migrateStorageSchema:S},scope:l.F.User,isCache:!0,storeName:"master-password-security",codec:m.E,capacity:p.Y._001KB})){}var A=r(87279),I=r(87065),O=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let T=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,I.U)((e=>(0,A.Vp)(e.isMasterPasswordLeaked))))}};T=O([(0,c.e)(d.B),b("design:paramtypes",[f])],T);var C=r(86695),w=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},R=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let P=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,I.U)((e=>(0,A.Vp)(e.isMasterPasswordWeak))))}};P=w([(0,c.e)(C.D),R("design:paramtypes",[f])],P);var D=r(23913),N=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},U=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let F=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,I.U)((e=>(0,A.Vp)(e.isMasterPasswordNotificationDismissed))))}};F=N([(0,c.e)(D.F),U("design:paramtypes",[f])],F);var M=r(63663),L=r(80673),G=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},K=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let x=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!0}),Promise.resolve((0,A.Vp)(void 0))}};x=G([(0,M.W)(L.T),K("design:paramtypes",[f])],x);var k=r(88030),j=r(57924),V=r(87113),W=r(60399),B=r(6453),z=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},H=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Y=class{constructor(e,t,r){this.serverApiClient=e,this.masterPasswordSecurityStore=t,this.passwordHasher=r}shouldBeChecked(){return(0,W.z)(this.masterPasswordSecurityStore.state$.pipe((0,I.U)((e=>!e.isMasterPasswordLeaked&&e.lastCheckTimestamp+864e5<=Date.now()))))}async check(e){const t=await this.passwordHasher.hash(e),r=await(0,W.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,A.hx)(r))throw new Error("Error while retrieving list of hashes for MP checking");const s=r.data.data.includes(t),i=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...i,isMasterPasswordLeaked:s,lastCheckTimestamp:Date.now()})}};Y=z([(0,j.GS)(),H("design:paramtypes",[V.l,f,B.T])],Y);var Q=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let $=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!1})}};$=Q([(0,j.GS)(),q("design:paramtypes",[f])],$);var X=r(94189),Z=r(20587),J=r(21877),ee=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},te=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let re=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(Z.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new J.AnonymousMasterPasswordHealthReportEvent({isLeaked:t.isMasterPasswordLeaked})})}};re=ee([(0,j.GS)(),te("design:paramtypes",[f,X.w])],re);var se=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e,t,r){this.checkMasterPasswordService=e,this.resetMasterPasswordNotification=t,this.anonymousMasterPasswordLeakedTrackingEventSender=r}async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordService.shouldBeChecked()?(await this.checkMasterPasswordService.check(e.password),this.anonymousMasterPasswordLeakedTrackingEventSender.send(),Promise.resolve((0,A.Vp)(void 0))):Promise.resolve((0,A.Vp)(void 0))}};oe=se([(0,M.W)(k.T),ie("design:paramtypes",[Y,$,re])],oe);var ae=r(30600),ne=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},ce=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let de=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,lastCheckTimestamp:0,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1}),Promise.resolve((0,A.Vp)(void 0))}};de=ne([(0,M.W)(ae.j),ce("design:paramtypes",[f])],de);var le=r(5105),ue=r(85465);const pe=async e=>{if(e)return await(async e=>(await(0,ue.evaluate)(e)).score)(e)/25};var me=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},he=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ge=class{constructor(e){this.masterPasswordSecurityStore=e}async check(e){const t=(await pe(e)??5)<3,r=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...r,isMasterPasswordWeak:t})}};ge=me([(0,j.GS)(),he("design:paramtypes",[f])],ge);var ve=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},_e=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ye=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(Z.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new J.AnonymousMasterPasswordHealthReportEvent({isWeak:t.isMasterPasswordWeak})})}};ye=ve([(0,j.GS)(),_e("design:paramtypes",[f,X.w])],ye);var Se=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fe=class{constructor(e,t,r){this.checkMasterPasswordWeakService=e,this.anonymousMasterPasswordWeakTrackingEventSender=t,this.resetMasterPasswordNotification=r}async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordWeakService.check(e.password),this.anonymousMasterPasswordWeakTrackingEventSender.send(),Promise.resolve((0,A.Vp)(void 0))}};fe=Se([(0,M.W)(le.B),Ee("design:paramtypes",[ge,ye,$])],fe);var Ae=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},Ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Oe=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordWeak:!1})}};Oe=Ae([(0,j.GS)(),Ie("design:paramtypes",[f])],Oe);var be=r(68307),Te=r(67490),Ce=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},we=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Re=class{constructor(e){this.resetMasterPasswordWeak=e}handle(){return this.resetMasterPasswordWeak.reset(),Promise.resolve(void 0)}};Re=Ce([(0,be.b)(Te.D),we("design:paramtypes",[Oe])],Re);var Pe=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};let De=class{};De=Pe([(0,s.Yl)({api:i.J,handlers:{commands:{dismissMasterPasswordNotification:x,temporaryCheckMasterPassword:oe,temporaryResetMasterPasswordLeaked:de,temporaryCheckMasterPasswordWeak:fe},events:{...(0,s.g4)(n.v,{masterPasswordChanged:Re})},queries:{isMasterPasswordLeaked:T,isMasterPasswordWeak:P,isMasterPasswordNotificationDismissed:F}},providers:[Y,B.T,$,ge,re,ye,Oe],imports:[o.D,a.n],stores:[f]})],De)},6453:(e,t,r)=>{r.d(t,{T:()=>d});var s=r(57924),i=r(79256),o=r(96303),a=r(54066),n=function(e,t,r,s){var i,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let d=class{constructor(e){this.argon2dDeriver=e}async hash(e){return(0,o.k)(await this.argon2dDeriver.derive((0,a.u)(e),(0,a.u)("z8CXohryCcGAa7CESNHYnedqbDyp"),{tCost:3,mCost:32768,parallelism:2}))}};d=n([(0,s.GS)(),c("design:paramtypes",[i.y])],d)},57578:(e,t,r)=>{r.d(t,{y:()=>n});var s=r(86952),i=r(75183),o=r(43832),a=r(46938);const n=(0,s.Q)({name:"userConsents",commands:{UpdateConsentsCommand:i.a},events:{},queries:{getConsents:o.o,getEmailPreferenceLink:a.UE}})},75183:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},43832:(e,t,r)=>{r.d(t,{o:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},46938:(e,t,r)=>{r.d(t,{UE:()=>c,Wp:()=>n});var s,i=r(96168),o=r(99059),a=r(25029);!function(e){e.NO_USER_FOR_KEY="no_user_for_key"}(s||(s={}));const n=(0,i.Vj)(s.NO_USER_FOR_KEY,"No user for this subscription code");class c extends((0,o.k)({scope:a.F.User})){}},78840:(e,t,r)=>{r.d(t,{K:()=>O});var s=r(88802),i=r(99634),o=r(57578);var a=r(63663),n=r(75183),c=r(60399),d=r(87065),l=r(6220),u=r(57924),p=r(87113),m=r(48844),h=r(87279),g=r(46938),v=r(86252);let _=class{constructor(e,t){this.serverApiClient=e,this.carbon=t}async updateConsents({triggerBy:e,consents:t}){return await(0,c.z)(this.serverApiClient.v1.userconsents.updateConsents({triggerBy:e,consents:t}).pipe((0,m.DZ)((e=>{throw new Error(e.message)})))),(0,h.Vp)(void 0)}getEmailPreferenceCenterLink(){return this.getSubscriptionCode().pipe((0,d.U)((e=>e))).pipe((0,l.z)((e=>this.serverApiClient.v1.communication.getUserEmailSubscriptionInfo({userKey:e}).pipe((0,d.U)((e=>(0,h.hx)(e)?(0,h.Rn)((0,g.Wp)()):(0,h.Vp)(e.data.data.prefCenterLink)))))))}getSubscriptionCode(){const{getSubscriptionCode:e}=this.carbon.queries;return e().pipe((0,d.U)((e=>{if(!(0,h.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,h.db)(e)})))}};_=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[p.l,v._])],_);let y=class{constructor(e){this.userConsentsService=e}execute({body:{triggerBy:e,consents:t}}){return this.userConsentsService.updateConsents({triggerBy:e,consents:t})}};y=(0,s.__decorate)([(0,a.W)(n.a),(0,s.__metadata)("design:paramtypes",[_])],y);var S=r(20754),E=r(43832);let f=class{constructor(e){this.serverApiClient=e}execute(){return this.serverApiClient.v1.userconsents.getConsents({format:"two-consents"}).pipe((0,m.Qn)((e=>e.data)),(0,m.DZ)((e=>{throw new Error(e.message)})))}};f=(0,s.__decorate)([(0,S.e)(E.o),(0,s.__metadata)("design:paramtypes",[p.l])],f);let A=class{constructor(e){this.userConsentsService=e}execute(){return this.userConsentsService.getEmailPreferenceCenterLink()}};A=(0,s.__decorate)([(0,S.e)(g.UE),(0,s.__metadata)("design:paramtypes",[_])],A);var I=r(93850);let O=class{};O=(0,s.__decorate)([(0,i.Yl)({api:o.y,imports:[I.n],providers:[_],handlers:{commands:{updateConsents:y},events:{},queries:{getConsents:f,getEmailPreferenceLink:A}},requiredFeatureFlips:[...Object.values({EMAIL_PREFERENCE_CENTER:"ecommerce_web_admin_email_preference_center"})]})],O)},39623:(e,t,r)=>{r.d(t,{R:()=>d});var s=r(86952),i=r(20360),o=r(64548),a=r(53032),n=r(6553),c=r(59039);const d=(0,s.Q)({name:"nudges",commands:{ValidateNudgesInstallationCommand:i.u,SendNudgeCommand:o.P,UpdateTeamNudgeCommand:a.X},events:{},queries:{CheckNudgesInstallationQuery:n.W,GetTeamNudgesQuery:c.w}})},64548:(e,t,r)=>{r.d(t,{P:()=>a,m:()=>o});var s=r(74354),i=r(25029);const o="SLACK_MESSAGE_NOT_DELIVERED";class a extends((0,s.g)({scope:i.F.User})){}},53032:(e,t,r)=>{r.d(t,{X:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},20360:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},6553:(e,t,r)=>{r.d(t,{W:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},59039:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},442:(e,t,r)=>{r.d(t,{_:()=>K});var s=r(88802),i=r(99634),o=r(25504),a=r(39623),n=r(7165),c=r(63663),d=r(87279),l=r(20360),u=r(53127),p=r(57648);const m="api/slack/InstallSlackApp";var h=r(73321);let g=class{constructor(e,t,r){this.enclaveService=e,this.scimService=t,this.enclaveClient=r}async execute({body:{authCode:e}}){try{let{adminProvisioningKey:t,teamUuid:r}=await this.scimService.getTeamIdentifiers();if(!t||!r){const e=await this.enclaveClient.commands.createTeamInEnclave();if((0,d.hx)(e))throw new Error("ValidateNudgesInstallation: failed to create team "+e.error);const{adminProvisioningKey:s,teamUuid:i}=await this.scimService.getTeamIdentifiers();t=s??"",r=i??""}return await this.validateInstallationInNitro(e,t,r),(0,d.Vp)(void 0)}catch(e){throw new Error(`ValidateNudgesInstallation: ${e}`)}}async validateInstallationInNitro(e,t,r){const s={adminProvisioningKey:t,slackAuthGrant:e,teamUuid:r};await this.enclaveService.callEnclaveEndpoint({endpoint:m,body:s,responseSchema:n.z.object({})})}};g=(0,s.__decorate)([(0,c.W)(l.u),(0,s.__metadata)("design:paramtypes",[u.d,p.Z,h.t])],g);var v=r(60399),_=r(87113),y=r(18533),S=r(20195),E=r(64548);let f=class{constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{if(e===E.m)return(0,d.Rn)({tag:"SLACK_MESSAGE_NOT_DELIVERED"});throw new Error(`SendNudge: error ${e}`)}}async execute(){const{testSlackMessageForAdmin:e}=this.serverApiClient.v1.integration;try{const t=await(0,v.z)(e({nudge:"compromised_passwords"}));return(0,d.hx)(t)?(0,y.EQ)(t.error,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},BadStatus:S.j,InternalServerError:S.j,InvalidRequest:S.j,RateLimited:S.j,ServiceUnavailable:S.j,UnspecifiedBadStatus:S.j}):(0,d.Vp)(void 0)}catch(e){throw new Error("SendNudge: unable to send nudge"+e)}}};f=(0,s.__decorate)([(0,c.W)(E.P),(0,s.__metadata)("design:paramtypes",[_.l])],f);var A=r(53032);let I=class{constructor(e){this.serverApiClient=e}async execute({body:e}){const{updateTeamNudge:t}=this.serverApiClient.v1.integration;try{const r=await(0,v.z)(t(e));if((0,d.hx)(r))throw new Error(r.error.message);return(0,d.Vp)(void 0)}catch(e){throw new Error("UpdateTeamNudge: "+e)}}};I=(0,s.__decorate)([(0,c.W)(A.X),(0,s.__metadata)("design:paramtypes",[_.l])],I);var O=r(162),b=r(43978),T=r(87065),C=r(69885),w=r(20754),R=r(6553);let P=class{constructor(e,t){this.scimService=e,this.enclaveClient=t}execute(){return(0,O.D)(this.scimService.getTeamIdentifiers()).pipe((0,b.w)((({adminProvisioningKey:e,teamUuid:t})=>e&&t?this.enclaveClient.queries.getTeam({adminProvisioningKey:e,teamUuid:t}).pipe((0,T.U)((e=>{if((0,d.d6)(e))return Boolean(e.data.messageIntegrations.slackStatus);throw new Error(e.error)}))):(0,C.of)(!1))),(0,T.U)(d.Vp))}};P=(0,s.__decorate)([(0,w.e)(R.W),(0,s.__metadata)("design:paramtypes",[p.Z,h.t])],P);var D=r(48844),N=r(59039);let U=class{constructor(e){this.serverApiClient=e}execute(){const{getTeamNudges:e}=this.serverApiClient.v1.integration;return e().pipe((0,D.Qn)((e=>e.data)),(0,D.DZ)((e=>{throw new Error(e.message)})))}};U=(0,s.__decorate)([(0,w.e)(N.w),(0,s.__metadata)("design:paramtypes",[_.l])],U);var F=r(43673),M=r(93850),L=r(39577),G=r(18045);let K=class{};K=(0,s.__decorate)([(0,i.Yl)({api:a.R,handlers:{commands:{validateNudgesInstallation:g,sendNudge:f,updateTeamNudge:I},events:{},queries:{checkNudgesInstallation:P,getTeamNudges:U}},imports:[o.X,F.i,L.E,M.n,G.i],providers:[],requiredFeatureFlips:["ace_tac_slack_integration_dev"]})],K)},89193:(e,t,r)=>{r.d(t,{g:()=>d});var s=r(86952),i=r(79448),o=r(56073),a=r(98976),n=r(57571),c=r(60678);const d=(0,s.Q)({name:"activityLogs",commands:{initiateActivityLogsRetrieval:i.b,loadNextActivityLogs:o.X,storeActivityLogs:a.M},events:{},queries:{activityLogs:n.I,areSensitiveLogsEnabled:c._}})},91943:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(67837),i=r(89193);class o extends((0,s.E)(i.g)){}(0,s.K)(i.g,o)},79448:(e,t,r)=>{r.d(t,{b:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},56073:(e,t,r)=>{r.d(t,{X:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},98976:(e,t,r)=>{r.d(t,{M:()=>a,W:()=>s});var s,i=r(74354),o=r(25029);!function(e){e.AUDIT_LOG_MISSING_JSON_SCHEMA="AUDIT_LOG_MISSING_JSON_SCHEMA",e.AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA="AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA",e.AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION="AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION",e.AUDIT_LOG_ERROR_READING_JSON_SCHEMA="AUDIT_LOG_ERROR_READING_JSON_SCHEMA",e.STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED="STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED",e.AUDIT_LOG_TYPE_NOT_CLIENT_SIDE="AUDIT_LOG_TYPE_NOT_CLIENT_SIDE",e.AUDIT_LOG_TYPE_NOT_TEAM_DEVICE_OR_CLIENT_SIDE="AUDIT_LOG_TYPE_NOT_TEAM_DEVICE_OR_CLIENT_SIDE",e.AUDIT_LOG_MISSING_CATEGORY_TO_LOG_TYPE_MAPPING="AUDIT_LOG_MISSING_CATEGORY_TO_LOG_TYPE_MAPPING",e.AUDIT_LOG_NON_SECURITY_MONITORING_IN_MASS_DEPLOYMENT="AUDIT_LOG_NON_SECURITY_MONITORING_IN_MASS_DEPLOYMENT"}(s||(s={}));class a extends((0,i.g)({scope:o.F.User})){}},57571:(e,t,r)=>{r.d(t,{I:()=>a,Q:()=>o});var s=r(99059),i=r(25029);const o={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",READY:"READY",ERROR:"ERROR"};class a extends((0,s.k)({scope:i.F.User})){}},60678:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},55920:(e,t,r)=>{var s,i;r.d(t,{p:()=>i,z:()=>s}),function(e){e.UserInvited="user_invited",e.UserReinvited="user_reinvited",e.UserRemoved="user_removed",e.TeamCaptainAdded="team_captain_added",e.TeamCaptainRemoved="team_captain_removed",e.GroupManagerAdded="group_manager_added",e.GroupManagerRemoved="group_manager_removed",e.MasterPasswordResetAccepted="master_password_reset_accepted",e.MasterPasswordResetRefused="master_password_reset_refused",e.BillingAdminAdded="billing_admin_added",e.BillingAdminRemoved="billing_admin_removed",e.UserGroupCreated="user_group_created",e.UserGroupRenamed="user_group_renamed",e.UserGroupDeleted="user_group_deleted",e.UserJoinedUserGroup="user_joined_user_group",e.UserLeftUserGroup="user_left_user_group",e.UserInvitedToUserGroup="user_invited_to_user_group",e.UserDeclinedInviteToUserGroup="user_declined_invite_to_user_group",e.UserRemovedFromUserGroup="user_removed_from_user_group",e.DomainRequested="domain_requested",e.DomainValidated="domain_validated",e.SensitiveLogsEnabled="collect_sensitive_data_audit_logs_enabled",e.SensitiveLogsDisabled="collect_sensitive_data_audit_logs_disabled",e.SsoIdpMetadataSet="sso_idp_metadata_set",e.SsoServiceProviderUrlSet="sso_service_provider_url_set",e.SsoEnabled="sso_enabled",e.SsoDisabled="sso_disabled",e.NitroUserProvisioningActivated="nitro_user_provisioning_activated",e.NitroUserProvisioningDeactivated="nitro_user_provisioning_deactivated",e.NitroGroupProvisioningActivated="nitro_group_provisioning_activated",e.NitroGroupProvisioningDeactivated="nitro_group_provisioning_deactivated",e.NitroSiemActivated="nitro_siem_activated",e.NitroSiemDeactivated="nitro_siem_deactivated",e.NitroSiemEdited="nitro_siem_edited",e.NitroSsoDomainProvisioned="nitro_sso_domain_provisioned",e.NitroSsoDomainRemoved="nitro_sso_domain_removed",e.NitroSsoDomainVerified="nitro_sso_domain_verified",e.NitroSsoSetupStarted="nitro_sso_setup_started",e.TeamNameChanged="team_name_changed",e.NewBillingPeriodCreated="new_billing_period_created",e.SeatsAdded="seats_added",e.ContactEmailChanged="contact_email_changed",e.MasterPasswordMobileResetEnabled="master_password_mobile_reset_enabled",e.MasterPasswordMobileResetDisabled="master_password_mobile_reset_disabled",e.MasterPasswordMobileReset="master_password_mobile_reset",e.MasterPasswordChanged="master_password_changed",e.MpToViewPasswordsEnabled="mp_to_view_passwords_enabled",e.MpToViewPasswordsDisabled="mp_to_view_passwords_disabled",e.TwoFactorAuthenticationLoginMethodAdded="two_factor_authentication_login_method_added",e.TwoFactorAuthenticationLoginMethodRemoved="two_factor_authentication_login_method_removed",e.BiometricSignInDisabled="biometric_sign_in_disabled",e.DWMEmailAdded="dwm_email_added",e.DWMEmailRemoved="dwm_email_removed",e.DWMAlertReceived="dwm_alert_received",e.UserDeviceAdded="user_device_added",e.UserDeviceRemoved="user_device_removed",e.UserDeviceLogin="user_device_login",e.MasterPasswordReset="master_password_reset",e.RequestedAccountRecovery="requested_account_recovery",e.CompletedAccountRecovery="completed_account_recovery",e.UserSharedCredentialWithGroup="user_shared_credential_with_group",e.UserSharedCredentialWithEmail="user_shared_credential_with_email",e.UserSharedCredentialWithExternal="user_shared_credential_with_external",e.UserSharedSecureNoteWithGroup="user_shared_secure_note_with_group",e.UserSharedSecureNoteWithEmail="user_shared_secure_note_with_email",e.UserSharedSecureNoteWithExternal="user_shared_secure_note_with_external",e.UserRevokedSharedCredentialGroup="user_revoked_shared_credential_group",e.UserRevokedSharedCredentialEmail="user_revoked_shared_credential_email",e.UserRevokedSharedCredentialExternal="user_revoked_shared_credential_external",e.UserRevokedSharedSecureNoteGroup="user_revoked_shared_secure_note_group",e.UserRevokedSharedSecureNoteEmail="user_revoked_shared_secure_note_email",e.UserRevokedSharedSecureNoteExternal="user_revoked_shared_secure_note_external",e.UserAcceptedSharingInviteSecureNote="user_accepted_sharing_invite_secure_note",e.UserRejectedSharingInviteSecureNote="user_rejected_sharing_invite_secure_note",e.UserAcceptedSharingInviteCredential="user_accepted_sharing_invite_credential",e.UserRejectedSharingInviteCredential="user_rejected_sharing_invite_credential",e.UserAddedCredentialToCollection="user_added_credential_to_collection",e.UserCreatedCollection="user_created_collection",e.UserDeletedCollection="user_deleted_collection",e.UserImportedCollection="user_imported_collection",e.UserRemovedCredentialFromCollection="user_removed_credential_from_collection",e.UserRenamedCollection="user_renamed_collection",e.UserSharedCollectionWithUser="user_shared_collection_with_user",e.UserSharedCollectionWithGroup="user_shared_collection_with_usergroup",e.UserAcceptedCollection="user_accepted_collection_invite",e.UserRejectedCollection="user_rejected_collection_invite",e.UserAddedItemToCollection="user_added_credential_to_shared_collection",e.UserRemovedItemFromCollection="user_removed_credential_from_shared_collection",e.UserUpdatedGroupRoleInCollection="user_updated_collection_usergroup",e.UserUpdatedUserRoleInCollection="user_updated_collection_user",e.UserRenamedSharedCollection="user_renamed_shared_collection",e.UserRevokedGroupFromCollection="user_revoked_collection_usergroup",e.UserRevokedUserFromCollection="user_revoked_collection_user",e.UserCreatedCredential="user_created_credential",e.UserModifiedCredential="user_modified_credential",e.UserDeletedCredential="user_deleted_credential",e.UserImportedCredentials="user_imported_credentials",e.UserCreatedSecureNote="user_created_secure_note",e.UserModifiedSecureNote="user_modified_secure_note",e.UserDeletedSecureNote="user_deleted_secure_note",e.NudgeExecuted="nudge_executed",e.NudgeConfigured="nudge_configured",e.NitroIntegrationAppInstalled="nitro_integration_app_installed",e.NitroIntegrationAppUninstalled="nitro_integration_app_uninstalled",e.UserReceivedNudge="user_received_nudge",e.MassDeploymentConfigurationUpdated="mass_deployment_configuration_updated",e.UserTypedCompromisedPassword="user_typed_compromised_password",e.UserTypedWeakPassword="user_typed_weak_password"}(s||(s={})),function(e){e.Account="account",e.Authentication="authentication",e.DarkWebMonitoring="dark_web_monitoring",e.Groups="groups",e.ImportExport="import_export",e.TeamSettings="team_settings",e.TeamSettingsActiveDirectory="team_settings_activedirectory",e.TeamSettingsPolicies="team_settings_policies",e.TeamSettingsSAMLProvisioning="team_settings_samlprovisioning",e.TeamSettingsSIEM="team_settings_siem",e.TeamSettingsSCIM="team_settings_scim",e.TeamSettingsSSO="team_settings_sso",e.Sharing="sharing",e.UserSettings="user_settings",e.UserSettingsAccountRecovery="user_settings_accountrecovery",e.Users="users",e.VaultCollections="vault_collections",e.VaultIDs="vault_ids",e.VaultPasswords="vault_passwords",e.VaultPayments="vault_payments",e.VaultPersonalInfo="vault_personalinfo",e.VaultSecureNotes="vault_securenotes",e.TeamNudges="team_nudges",e.SecurityMonitoring="security_monitoring"}(i||(i={}))},13190:(e,t,r)=>{r.r(t),r.d(t,{ActivityLogCategory:()=>l.p,ActivityLogType:()=>l.z,ActivityLogsClient:()=>i._,ActivityLogsQuery:()=>c.I,AnalysePasswordForRisksQuery:()=>y.S,AreSensitiveLogsEnabledQuery:()=>d._,GenerateMassDeploymentTeamKeyCommand:()=>h.tv,GenerateMassDeploymentTeamKeyCommandErrorCodes:()=>h.rI,GetMassDeploymentSecurityMonitoringConfigurationQuery:()=>S.g,GetMassDeploymentTeamKeyQuery:()=>E.w,GetSiemConfigurationErrorCode:()=>T.At,GetSiemConfigurationQuery:()=>T.pr,InitiateActivityLogsRetrievalCommand:()=>o.b,IsLoggedOutMonitoringEnabledForDeviceQuery:()=>f.m,IsLoggedOutMonitoringEnabledForDeviceQueryErrorCodes:()=>A.y,LoadNextActivityLogsCommand:()=>a.X,LoadingStatus:()=>c.Q,LoggedOutMonitoringClient:()=>m,LoggedOutMonitoringFeatureFlips:()=>_.q,MassDeploymentSecurityMonitoringConfigurationErrorCodes:()=>I.k,SendRiskyPasswordLoggedOutLogCommand:()=>g.r,SetSiemConfigurationCommand:()=>b.Qj,SetSiemConfigurationErrorCode:()=>b.M7,StoreActivityLogsCommand:()=>n.M,StoreActivityLogsInvalidLogsError:()=>n.W,UpdateLoggedOutMonitoringActiveStatusCommand:()=>v.a,activityLogsApi:()=>s.g,createCantGetMassDeploymentTeamKeyFromBrowserPoliciesError:()=>A.z,createServerCallNotAuthorizedError:()=>I.x,createTeamNotFoundMassDeploymentError:()=>h.o1,createValidMassDeploymentTeamKeyAlreadyExistsForTeamError:()=>h.$m,getSiemGenericError:()=>T.Nv,invalidUrlError:()=>b.q0,loggedOutMonitoringApi:()=>u.i,mismatchingAdminProvisioningKeyError:()=>b.HC,noSiemConfigurationUpdateError:()=>b.$3,setSiemGenericError:()=>b.SC,siemApi:()=>O.v,teamNotFoundError:()=>b.gY});var s=r(89193),i=r(91943),o=r(79448),a=r(56073),n=r(98976),c=r(57571),d=r(60678),l=r(55920),u=r(30049),p=r(67837);class m extends((0,p.E)(u.i)){}(0,p.K)(u.i,m);var h=r(23035),g=r(67426),v=r(4087),_=r(48847),y=r(87954),S=r(57325),E=r(60093),f=r(18221),A=r(74484),I=r(46035),O=r(55102),b=r(24170),T=r(42668)},30049:(e,t,r)=>{r.d(t,{i:()=>u});var s=r(86952),i=r(23035),o=r(67426),a=r(4087),n=r(87954),c=r(57325),d=r(60093),l=r(18221);const u=(0,s.Q)({name:"loggedOutMonitoring",commands:{generateMassDeploymentTeamKey:i.tv,sendRiskyPasswordLoggedOutLog:o.r,updateLoggedOutMonitoringActiveStatus:a.a},events:{},queries:{analysePasswordForRisks:n.S,getMassDeploymentSecurityMonitoringConfigurationQuery:c.g,getMassDeploymentTeamKey:d.w,isLoggedOutMonitoringEnabledForDevice:l.m}})},23035:(e,t,r)=>{r.d(t,{$m:()=>c,o1:()=>n,rI:()=>s,tv:()=>d});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM="VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM"}(s||(s={}));const n=(0,a.Vj)(s.TEAM_NOT_FOUND,"[Mass Deployment - Generate Key] - Team not found"),c=(0,a.Vj)(s.VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM,"[Mass Deployment - Generate Key] - A valid mass deployment team key already exists for the team");class d extends((0,i.g)({scope:o.F.User})){}},67426:(e,t,r)=>{r.d(t,{r:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},4087:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},48847:(e,t,r)=>{var s;r.d(t,{q:()=>s}),function(e){e.LoggedOutMonitoringV1Dev="setupAndRollout_web_lomo_dev",e.LoggedOutMonitoringV1Prod="setupAndRollout_web_lomo"}(s||(s={}))},87954:(e,t,r)=>{r.d(t,{S:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},57325:(e,t,r)=>{r.d(t,{g:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},60093:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},18221:(e,t,r)=>{r.d(t,{m:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},74484:(e,t,r)=>{r.d(t,{y:()=>s,z:()=>o});var s,i=r(96168);!function(e){e.CANT_GET_MASS_DEPLOYMENT_TEAM_KEY_FROM_BROWSER_POLICIES="CANT_GET_MASS_DEPLOYMENT_TEAM_KEY_FROM_BROWSER_POLICIES"}(s||(s={}));const o=(0,i.Vj)(s.CANT_GET_MASS_DEPLOYMENT_TEAM_KEY_FROM_BROWSER_POLICIES,"[Mass Deployment - Is Logged-out Monitoring Enabled for device] - Failed to get mass deployment team key from browser policies")},46035:(e,t,r)=>{r.d(t,{k:()=>s,x:()=>o});var s,i=r(96168);!function(e){e.NOT_AUTHORIZED="NOT_AUTHORIZED"}(s||(s={}));const o=(0,i.Vj)(s.NOT_AUTHORIZED,"[Mass Deployment - Update Logged-out Monitoring Active Status] - Server call not authorized")},55102:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(86952),i=r(24170),o=r(42668);const a=(0,s.Q)({name:"siem",commands:{setSiemConfiguration:i.Qj},events:{},queries:{getSiemConfiguration:o.pr}})},24170:(e,t,r)=>{r.d(t,{$3:()=>d,HC:()=>c,M7:()=>s,Qj:()=>p,SC:()=>u,gY:()=>n,q0:()=>l});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.MISMATCHING_ADMIN_PROVISIONING_KEY="MISMATCHING_ADMIN_PROVISIONING_KEY",e.NO_SIEM_CONFIGURATION_UPDATE="NO_SIEM_CONFIGURATION_UPDATE",e.INVALID_URL="INVALID_URL"}(s||(s={}));const n=(0,a.Vj)(s.TEAM_NOT_FOUND,"Team not found"),c=(0,a.Vj)(s.MISMATCHING_ADMIN_PROVISIONING_KEY,"Mismatching admin provisioning key"),d=(0,a.Vj)(s.NO_SIEM_CONFIGURATION_UPDATE,"There's nothing to update"),l=(0,a.Vj)(s.INVALID_URL,"Invalid URL"),u=(0,a.Vj)(s.GENERIC_ERROR,"Generic error");class p extends((0,i.g)({scope:o.F.User})){}},42668:(e,t,r)=>{r.d(t,{At:()=>s,Nv:()=>n,pr:()=>c});var s,i=r(99059),o=r(25029),a=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR"}(s||(s={}));const n=(0,a.Vj)(s.GENERIC_ERROR,"Generic error");class c extends((0,i.k)({scope:o.F.User})){}},70305:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(86952),i=r(67490),o=r(98193);const a=(0,s.Q)({name:"changeMasterPassword",commands:{temporarySendMasterPasswordChangedEvent:o.n},events:{masterPasswordChanged:i.D},queries:{}})},98193:(e,t,r)=>{r.d(t,{n:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},67490:(e,t,r)=>{r.d(t,{D:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.User})){}},29597:(e,t,r)=>{r.r(t),r.d(t,{ChangeSessionKeyErrorTypes:()=>l.eq,CheckSessionKeyErrorTypes:()=>E.f3,CheckSessionKeyQuery:()=>m.Z,CheckSessionSessionNotCreated:()=>E.OT,CloseUserSessionCommand:()=>a.V,CreateUserSessionCommand:()=>n.lk,CreatedSessionState:()=>u.XL,CreatedSessionsStateQuery:()=>u.iH,DeleteLocalSessionCommand:()=>d.G,DeviceLimitQuery:()=>T.X,ExportSessionKeyQuery:()=>h.w,FlushLocalDataCommand:()=>i.e,IsAllowedQuery:()=>b.bY,MasterPasswordChangedEvent:()=>A.D,MultiAccountNotYetSupported:()=>c.y9,NotAllowedReason:()=>b.Oq,OpenUserSessionCommand:()=>c.Dx,PlatformView:()=>T.i,PrepareLocalDataFlushCommand:()=>o.X,SelectedOpenedSessionQuery:()=>p._,SessionAlreadyExists:()=>n.X0,SessionAlreadyOpened:()=>c.mR,SessionClient:()=>S.x,SessionCloseMode:()=>g.K,SessionClosedEvent:()=>g.X,SessionClosingEvent:()=>v.Z,SessionCreationErrorTypes:()=>n.v5,SessionKeyChecker:()=>E.BD,SessionNotCreated:()=>c.aK,SessionOpenErrorTypes:()=>c.T8,SessionOpenedEvent:()=>_.M,SessionOpeningEvent:()=>y.$,SessionQueryParamsSchema:()=>u.cM,SessionState:()=>u.sM,SessionStateQuery:()=>u.ZP,TemporarySendMasterPasswordChangedEventCommand:()=>I.n,UnableToUpdateSessionKeyForNonExistingAccount:()=>l.pX,UnableToUpdateSessionSessionNotOpened:()=>l.nA,UpdateUserSessionKeyCommand:()=>l.yt,UserNotLogged:()=>b.Fh,changeMasterPasswordApi:()=>f.v,sessionApi:()=>s.Q,vaultAccessApi:()=>O.Y});var s=r(34710),i=r(42858),o=r(15473),a=r(86334),n=r(69207),c=r(37334),d=r(54703),l=r(90032),u=r(55510),p=r(31839),m=r(45911),h=r(74156),g=r(66134),v=r(82398),_=r(5237),y=r(90775),S=r(89358),E=r(57385),f=r(70305),A=r(67490),I=r(98193),O=r(65766),b=r(57755),T=r(49273)},34710:(e,t,r)=>{r.d(t,{Q:()=>S});var s=r(86952),i=r(55510),o=r(45911),a=r(74156),n=r(5237),c=r(82398),d=r(66134),l=r(42858),u=r(15473),p=r(69207),m=r(37334),h=r(86334),g=r(54703),v=r(90775),_=r(31839),y=r(90032);const S=(0,s.Q)({name:"session",commands:{FlushLocalDataCommand:l.e,PrepareLocalDataFlushCommand:u.X,CreateUserSessionCommand:p.lk,OpenUserSessionCommand:m.Dx,CloseUserSessionCommand:h.V,DeleteLocalSessionCommand:g.G,UpdateUserSessionKeyCommand:y.yt},queries:{sessionState:i.ZP,createdSessionsState:i.iH,selectedOpenedSession:_._,checkSessionKey:o.Z,exportSessionKey:a.w},events:{SessionOpenedEvent:n.M,SessionClosingEvent:c.Z,SessionClosedEvent:d.X,SessionOpeningEvent:v.$}})},86334:(e,t,r)=>{r.d(t,{V:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},69207:(e,t,r)=>{r.d(t,{X0:()=>n,lk:()=>c,v5:()=>s});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.AlreadyExists="alreadyExists"}(s||(s={}));class n extends((0,a.Hu)(s.AlreadyExists,"The session already exists. Delete it first.")){}class c extends((0,i.g)({scope:o.F.Device})){}},54703:(e,t,r)=>{r.d(t,{G:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},42858:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},37334:(e,t,r)=>{r.d(t,{Dx:()=>l,T8:()=>s,aK:()=>n,mR:()=>c,y9:()=>d});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.NotCreated="notCreated",e.AlreadyOpened="alreadyOpened",e.MultiAccountNotYetSupported="multiAccountNotYetSupported"}(s||(s={}));class n extends((0,a.Hu)(s.NotCreated,"The session has not been created. Create it first.")){}class c extends((0,a.Hu)(s.AlreadyOpened,"The session is already opened for this user. Close it first.")){}class d extends((0,a.Hu)(s.MultiAccountNotYetSupported,"Another session is opened. Close it first.")){}class l extends((0,i.g)({scope:o.F.Device})){}},15473:(e,t,r)=>{r.d(t,{X:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},90032:(e,t,r)=>{r.d(t,{eq:()=>s,nA:()=>c,pX:()=>n,yt:()=>d});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.NotCreated="notCreated",e.NotOpened="notOpened"}(s||(s={}));class n extends((0,a.Hu)(s.NotCreated,"The session has not been created. Create it first.")){}class c extends((0,a.Hu)(s.NotOpened,"The session has not been opened")){}class d extends((0,i.g)({scope:o.F.Device})){}},66134:(e,t,r)=>{r.d(t,{K:()=>s,X:()=>a});var s,i=r(88885),o=r(25029);!function(e){e.Close="close",e.Lock="lock"}(s||(s={}));class a extends((0,i.d)({scope:o.F.Device})){}},82398:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.User})){}},5237:(e,t,r)=>{r.d(t,{M:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.User})){}},90775:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.User})){}},45911:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},74156:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},31839:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},55510:(e,t,r)=>{r.d(t,{XL:()=>c,ZP:()=>d,cM:()=>a,iH:()=>l,sM:()=>n});var s=r(99059),i=r(25029),o=r(7165);const a=o.z.object({email:o.z.string()});var n,c;!function(e){e.NotCreated="notCreated",e.Closed="closed",e.Open="open"}(n||(n={}));class d extends((0,s.k)({scope:i.F.Device})){}!function(e){e.Closed="closed",e.Open="open"}(c||(c={}));class l extends((0,s.k)({scope:i.F.Device})){}},57385:(e,t,r)=>{r.d(t,{BD:()=>a,OT:()=>o,f3:()=>s});var s,i=r(96168);!function(e){e.SessionNotCreated="notCreated"}(s||(s={}));class o extends((0,i.Hu)(s.SessionNotCreated,"The session has not been created. Create it first.")){}class a{}},89358:(e,t,r)=>{r.d(t,{x:()=>o});var s=r(67837),i=r(34710);class o extends((0,s.E)(i.Q)){}(0,s.K)(i.Q,o)},65766:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(86952),i=r(57755),o=r(49273);const a=(0,s.Q)({name:"vaultAccess",commands:{},events:{},queries:{isAllowed:i.bY,deviceLimit:o.X}})},49273:(e,t,r)=>{r.d(t,{X:()=>a,i:()=>s});var s,i=r(99059),o=r(25029);!function(e){e.Android="android",e.DesktopMacOS="macosx",e.DesktopWindows="windows",e.IPad="ipad",e.IPhone="iphone",e.IPod="ipod",e.Other="other",e.StandaloneExtension="saex",e.TeamAdminConsole="tac",e.WebApp="webapp"}(s||(s={}));class a extends((0,i.k)({scope:o.F.User})){}},57755:(e,t,r)=>{r.d(t,{Fh:()=>n,Oq:()=>s,bY:()=>c});var s,i=r(99059),o=r(25029),a=r(96168);!function(e){e.DeviceLimited="DeviceLimited",e.Requires2FAEnforcement="Requires2FAEnforcement",e.RequiresSSO2MPMigration="RequiresSSO2MPMigration",e.RequiresMP2SSOMigration="RequiresMP2SSOMigration",e.RequiresSettingUpRecoveryKey="RequiresSettingUpRecoveryKey",e.RequiresSettingUpPin="RequiresSettingUpPin",e.NoActiveUser="NoActiveUser"}(s||(s={}));class n extends((0,a.Hu)("UserNotLogged","Please log the user")){}class c extends((0,i.k)({scope:o.F.Device})){}},28365:(e,t,r)=>{r.d(t,{M:()=>m});var s=r(88802),i=r(99634),o=r(70305),a=r(81459),n=r(57924);let c=class extends a.f{};c=(0,s.__decorate)([(0,n.GS)()],c);var d=r(98193),l=r(63663),u=r(87279);let p=class{constructor(e){this.eventEmitter=e}execute(){return this.eventEmitter.sendEvent("masterPasswordChanged",void 0),Promise.resolve((0,u.Vp)(void 0))}};p=(0,s.__decorate)([(0,l.W)(d.n),(0,s.__metadata)("design:paramtypes",[c])],p);let m=class{};m=(0,s.__decorate)([(0,i.Yl)({api:o.v,handlers:{commands:{temporarySendMasterPasswordChangedEvent:p},events:{},queries:{}},providers:[c]})],m)},32109:(e,t,r)=>{r.d(t,{P:()=>i});var s=r(94805);const i=e=>{const[,,t]=e.split("$");return"pbkdf2"===t?s.E1:s.mr}},23573:(e,t,r)=>{r.d(t,{h:()=>o});var s=r(2240),i=r(22631);class o extends i.b{async isUserIdle(e){return"idle"===await(0,s.q)(e)}}},22631:(e,t,r)=>{r.d(t,{b:()=>o});var s=r(88802),i=r(57924);let o=class{};o=(0,s.__decorate)([(0,i.GS)()],o)},87918:(e,t,r)=>{r.d(t,{t:()=>u});var s=r(88802),i=r(60399),o=r(86252),a=r(57924),n=r(54066),c=r(43293),d=r(48844),l=r(25594);let u=class{constructor(e,t){this.carbonLegacyClient=e,this.flexibleDecryptor=t}async decrypt(e){const{carbonStateList:t}=this.carbonLegacyClient.queries;return await(0,i.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey"]}).pipe((0,d.nb)({success:([t,r,s])=>{if("string"==typeof t)return this.flexibleDecryptor.decrypt((0,n.u)(t),e);if("string"==typeof r&&"string"==typeof s){const t=s+r,i=(0,c.N)(t);return this.flexibleDecryptor.decrypt((0,n.u)(i),e)}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}};u=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o._,l.a])],u)},12642:(e,t,r)=>{r.d(t,{Y:()=>n});var s=r(88802),i=r(57924),o=r(87918),a=r(73378);let n=class{constructor(e,t){this.localDataKeyDecryptor=e,this.localDatKeyaEncryptor=t}encode(e){return this.localDatKeyaEncryptor.encrypt(e)}decode(e){return this.localDataKeyDecryptor.decrypt(e)}};n=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.t,a.n])],n)},73378:(e,t,r)=>{r.d(t,{n:()=>v});var s=r(88802),i=r(60399),o=r(57924),a=r(86252),n=r(48844),c=r(94805),d=r(16698),l=r(54066),u=r(43293),p=r(7502),m=r(56268),h=r(19603),g=r(32109);let v=class{constructor(e,t,r){this.carbonLegacyClient=e,this.flexibleEncryptor=t,this.randomValuesGetter=r}async encrypt(e){const{carbonStateList:t}=this.carbonLegacyClient.queries;return await(0,i.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey","userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,n.nb)({success:([t,r,s,i,o])=>{if("string"==typeof t)return this.flexibleEncryptor.encrypt((0,l.u)(t),e,c.oo,d.gO);if("string"==typeof r&&"string"==typeof s){const t=s+r,a=(0,u.N)(t),n="string"==typeof o?(0,g.P)(o):c.mr,{saltLength:m}=n,h="string"===i?(0,p.R)(i):this.randomValuesGetter.get(m);return this.flexibleEncryptor.encrypt((0,l.u)(a),e,n,d.Nw,{salt:h})}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}};v=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[a._,m._,h.Y])],v)},79816:(e,t,r)=>{r.d(t,{_:()=>Le});var s=r(88802),i=r(99634),o=r(25029),a=r(34710),n=r(57385),c=r(37935),d=r(6936),l=r(87918),u=r(73378),p=r(12642),m=r(57924),h=r(25594),g=r(7502),v=r(82933),_=r(54066),y=r(95087);let S=class{constructor(e){this.flexibleDecryptor=e}decrypt(e,t){const{flexibleDecryptor:r}=this;let s;switch(t.type){case"sso":s=(0,g.R)(t.ssoKey);break;case"mp":s=(0,v.K)((0,_.u)(t.masterPassword),(0,g.R)(t.secondaryKey??""));break;default:(0,y.U)(t)}return r.decrypt(s,e)}};S=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[h.a])],S);var E=r(56268),f=r(16698);let A=class{constructor(e){this.flexibleEncryptor=e}encrypt(e,t,r){const{flexibleEncryptor:s}=this,{derivation:i,salt:o}=r,{algorithm:a}=i;if("noderivation"===a)throw new Error("Session key requires derivation");let n;switch(t.type){case"sso":n=(0,g.R)(t.ssoKey);break;case"mp":n=(0,v.K)((0,_.u)(t.masterPassword),(0,g.R)(t.secondaryKey??""));break;default:(0,y.U)(t)}return s.encrypt(n,e,i,f.Nw,{salt:(0,g.R)(o)})}};A=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[E._])],A);var I=r(87279),O=r(87065),b=r(95681),T=r(23347),C=r(10722);const w=e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.entries(e).every((([,e])=>"object"==typeof e&&"derivation"in e&&"salt"in e)));class R extends((0,b.Q)({storeName:"sessions-crypto-settings-store",scope:o.F.Device,capacity:T.Y._010KB,persist:!0,storage:{schemaVersion:1,initialValue:{},typeGuard:w},codec:C.E})){}let P=class{constructor(e){this.sessionsCryptoSettingsStore=e}getConfig(e){return this.sessionsCryptoSettingsStore.state$.pipe((0,O.U)((t=>{if(e in t){const{derivation:r,salt:s}=t[e];return(0,I.Vp)({derivation:r,salt:s})}throw new Error("No crypto settings found for this user")})))}};P=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[R])],P);var D=r(63663),N=r(71949),U=r(42858);let F=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.flush(),Promise.resolve((0,I.Vp)(void 0))}};F=(0,s.__decorate)([(0,D.W)(U.e),(0,s.__metadata)("design:paramtypes",[N.X])],F);var M=r(15473);let L=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.prepare(),Promise.resolve((0,I.Vp)(void 0))}};L=(0,s.__decorate)([(0,D.W)(M.X),(0,s.__metadata)("design:paramtypes",[N.X])],L);var G=r(86252),K=r(69207),x=r(55510),k=r(64987),j=r(60399),V=r(10370);let W=class{constructor(e,t){this.encryptor=e,this.settings=t}decode(e){const t={};for(const[r,s]of Object.entries(e))t[r]={status:"closed",encryptedLocalKey:s.encryptedLocalKey};return t}async encode(e){const t={};for(const[r,s]of Object.entries(e)){if("closed"===s.status){t[r]={encryptedLocalKey:s.encryptedLocalKey};continue}if("sso"===s.sessionKey.type)continue;if(!s.localKey){t[r]={encryptedLocalKey:null};continue}const e=await(0,j.z)(this.settings.getConfig(r));if(!(0,I.d6)(e))throw new Error("Fail to get crypto settings");t[r]={encryptedLocalKey:(0,V.s)(await this.encryptor.encrypt((0,g.R)(s.localKey),s.sessionKey,e.data))}}return t}};W=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[A,P])],W);class B extends((0,b.Q)({storeName:"sessions-state-store",scope:o.F.Device,capacity:T.Y._010KB,persist:!0,isCache:!0,codec:W,storage:{initialValue:{},schemaVersion:2,typeGuard:e=>!0,migrateStorageSchema:()=>({})}})){}const z=new k.WU;var H=r(6220);let Y=class{constructor(e,t,r){this.carbon=e,this.store=t,this.settings=r}getLocalKey(e){const t=this.generate.bind(this),r=this.changeLocalKey.bind(this);return this.store.state$.pipe((0,H.z)((async s=>{if(e in s){const t=s[e];if("open"!==t.status)throw new Error("Session is not open ");const r=t.localKey;return r?(0,g.R)(r):null}const i=await t();return await r(e,i),i})))}async changeLocalKey(e,t){const{store:r}=this,s=await(0,j.z)(this.settings.getConfig(e));if(!(0,I.d6)(s))throw new Error("Fail to get crypto settings");await z.runExclusive((async()=>{const s=await r.getState();if(!(e in s))throw new Error("Session is not created");const i=s[e];if("open"!==i.status)throw new Error("Session is not open");await r.set({...s,[e]:{status:"open",localKey:t?(0,V.s)(t):null,sessionKey:i.sessionKey}})}))}async generateKeyIfNotExist(e){await(0,j.z)(this.getLocalKey(e))}async generate(){const{carbonStateList:e}=this.carbon.queries,t=await(0,j.z)(e({paths:["userSession.session.localKey"]}));if((0,I.hx)(t))throw new Error("Failure getting state list");const[r]=t.data;return"string"==typeof r?(0,_.u)(r):null}};Y=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[G._,B,P])],Y);var Q=r(32109);class q extends((0,b.Q)({persist:!0,codec:C.E,scope:o.F.Device,storage:{initialValue:{},schemaVersion:0,typeGuard:e=>"object"==typeof e&&null!==e&&(!("encryptionKey"in e)||"string"==typeof e.encryptionKey)},storeName:"exported-session-keys-crypto",capacity:T.Y._001KB})){}var $=r(34987),X=r(92258);let Z=class{constructor(e,t){this.store=e,this.keyGenerator=t}async updateAndSetEncryptionKey(){const e=await this.keyGenerator.generate();return await this.store.set({encryptionKey:(0,V.s)(e)}),e}getOrCreateEncryptionKey(){return this.store.state$.pipe((0,$.b)((async e=>e.encryptionKey?(0,g.R)(e.encryptionKey):await this.updateAndSetEncryptionKey())))}};Z=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[q,X.c])],Z);let J=class{constructor(e,t){this.cryptoManager=e,this.flexibleDecryptor=t}async import(e){const t=await(0,j.z)(this.cryptoManager.getOrCreateEncryptionKey()),r=await this.flexibleDecryptor.decrypt(t,(0,g.R)(e.content)),s=(new TextDecoder).decode(r),i=JSON.parse(s);return Promise.resolve(i)}};J=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[Z,h.a])],J);let ee=class{constructor(e,t,r,s,i){this.carbon=e,this.store=t,this.localKeyRepository=r,this.encryptor=s,this.importer=i}async execute({body:{sessionKey:e,email:t,personalSettings:r}}){const s="exported"===e.type?await this.importer.import(e):e,i=await this.localKeyRepository.generate(),o=i?await this.encryptor.encrypt(i,s,{derivation:(0,Q.P)(r.CryptoUserPayload),salt:r.CryptoFixedSalt}):null;return await z.runExclusive((async()=>{const e=await this.store.getState();if(t in e)return(0,I.Rn)(new K.X0);switch(s.type){case"mp":{await this.store.set({...e,[t]:{status:x.sM.Closed,encryptedLocalKey:o?(0,V.s)(o):null}});const r=await this.carbon.commands.openSessionWithMasterPassword({login:t,password:s.masterPassword,rememberPassword:!1,requiredPermissions:void 0,serverKey:s.secondaryKey,loginType:"MasterPassword"});if((0,I.hx)(r))throw new Error("Failed to create the session in carbon");return(0,I.Vp)(void 0)}case"sso":throw new Error("Creating a SSO session in session module is not supported");default:(0,y.U)(s)}}))}};ee=(0,s.__decorate)([(0,D.W)(K.lk),(0,s.__metadata)("design:paramtypes",[G._,B,Y,A,J])],ee);var te=r(81459);let re=class extends te.f{};re=(0,s.__decorate)([(0,m.GS)()],re);var se=r(66134),ie=r(86334),oe=r(69008);let ae=class{constructor(e,t){this.emitter=e,this.requestContextClient=t}async execute({body:{email:e}}){return await this.emitter.sendEvent("sessionClosing",void 0),await this.emitter.sendEvent("sessionClosed",{email:e,mode:se.K.Close}),await this.requestContextClient.commands.setActiveUser({userName:void 0}),Promise.resolve((0,I.Vp)(void 0))}};ae=(0,s.__decorate)([(0,D.W)(ie.V),(0,s.__metadata)("design:paramtypes",[re,oe.Q])],ae);var ne=r(37334);let ce=class{constructor(e,t,r,s){this.carbon=e,this.sessionStore=t,this.sessionKeyDecryptor=r,this.importer=s}async execute({body:{email:e,sessionKey:t,rememberPassword:r}}){const s="exported"===t.type?await this.importer.import(t):t;if("sso"===s.type)throw new Error("not implemented");const{sessionStore:i,carbon:o}=this;return await z.runExclusive((async()=>{const t=await i.getState();if(!(e in t))return(0,I.Rn)(new ne.aK);if(Object.values(t).some((e=>"open"===e.status)))return(0,I.Rn)(new ne.y9);const a=t[e];if("open"===a.status||"opening"===a.status)return(0,I.Rn)(new ne.mR);await i.set({...t,[e]:{status:"opening",sessionKey:s,localKey:a.encryptedLocalKey?(0,V.s)(await this.sessionKeyDecryptor.decrypt((0,g.R)(a.encryptedLocalKey),s)):null}});let n=!1;try{const t=await o.commands.openSessionWithMasterPassword({login:e,password:s.masterPassword,rememberPassword:r,requiredPermissions:void 0,serverKey:s.secondaryKey,loginType:"MasterPassword"});if(!(0,I.d6)(t))throw new Error("Failed to open session in carbon");return n=!0,(0,I.Vp)(void 0)}finally{n||await i.set(t)}}))}};ce=(0,s.__decorate)([(0,D.W)(ne.Dx),(0,s.__metadata)("design:paramtypes",[G._,B,S,J])],ce);var de=r(20754);let le=class{constructor(e){this.sessionsStateStore=e}execute({body:e}){const t=e.email;return this.sessionsStateStore.state$.pipe((0,O.U)((e=>{if(!(t in e))return(0,I.Vp)(x.sM.NotCreated);{const{status:r}=e[t];switch(r){case"open":return(0,I.Vp)(x.sM.Open);case"closed":case"opening":return(0,I.Vp)(x.sM.Closed);default:(0,y.U)(r)}}})))}};le=(0,s.__decorate)([(0,de.e)(x.ZP),(0,s.__metadata)("design:paramtypes",[B])],le);let ue=class{constructor(e){this.sessionsStateStore=e}execute(){return this.sessionsStateStore.state$.pipe((0,O.U)((e=>{const t={};for(const r in e)"open"===e[r].status?t[r]=x.XL.Open:t[r]=x.XL.Closed;return(0,I.Vp)(t)})))}};ue=(0,s.__decorate)([(0,de.e)(x.iH),(0,s.__metadata)("design:paramtypes",[B])],ue);var pe=r(6136),me=r(31839);let he=class{constructor(e){this.sessionsStateStore=e}execute(){return this.sessionsStateStore.state$.pipe((0,O.U)((e=>{let t;for(const r in e)e[r].status===x.sM.Open&&(t=r);return t})),(0,pe.x)(),(0,O.U)(I.Vp))}};he=(0,s.__decorate)([(0,de.e)(me._),(0,s.__metadata)("design:paramtypes",[B])],he);var ge=r(54703);let ve=class{execute(){return Promise.resolve((0,I.Vp)(void 0))}};ve=(0,s.__decorate)([(0,D.W)(ge.G)],ve);var _e=r(68307),ye=r(23326),Se=r(94805),Ee=r(19603);let fe=class{constructor(e,t,r,s,i,o,a,n,c){this.carbon=e,this.sessionsStateStore=t,this.sessionsCryptoSettingsStore=r,this.eventEmitter=s,this.randomValuesGetter=i,this.localKeyRepo=o,this.encryptor=a,this.settings=n,this.context=c}async getUserCryptoSettings(){const{getUserCryptoSettings:e}=this.carbon.queries,t=await(0,j.z)(e());if(!(0,I.d6)(t))throw new Error("Fail to fetch crypto settings from carbon");const{cryptoUserPayload:r,cryptoFixedSalt:s}=t.data;return{cryptoUserPayload:r,cryptoFixedSalt:s}}async getSessionKey(e){const{getMasterPasswordAndServerKey:t,getIsSSOUser:r}=this.carbon.queries,s=await(0,j.z)(r());if(!(0,I.d6)(s))throw new Error("Fail to fetch is sso user from carbon");if(s.data||e)return{type:"sso",ssoKey:""};const i=await(0,j.z)(t());if(!(0,I.d6)(i))throw new Error("Fail to fetch master password and server key from carbon");const{password:o,serverKey:a}=i.data;return{type:"mp",masterPassword:o,secondaryKey:a}}async handleLogin(e,t){await z.runExclusive((async()=>{const{cryptoUserPayload:r,cryptoFixedSalt:s}=await this.getUserCryptoSettings(),i=r?(0,Q.P)(r):Se.mr,o=s||(0,V.s)(this.randomValuesGetter.get(i.saltLength)),a=await this.sessionsCryptoSettingsStore.getState();this.sessionsCryptoSettingsStore.set({...a,[e]:{derivation:i,salt:o}});const n=await this.getSessionKey(t),c=await this.sessionsStateStore.getState(),d=await this.localKeyRepo.generate();if(e in c)await this.sessionsStateStore.set({...c,[e]:{status:"open",sessionKey:n,localKey:d?(0,V.s)(d):null}});else{const t={status:"open",sessionKey:n,localKey:d?(0,V.s)(d):null};await this.sessionsStateStore.set({...c,[e]:t})}})),await this.context.commands.setActiveUser({userName:e}),await this.eventEmitter.sendEvent("sessionOpening",void 0),await this.eventEmitter.sendEvent("sessionOpened",void 0)}async handleLogout(){const e=new Array;await z.runExclusive((async()=>{const t=await this.sessionsStateStore.getState(),r={};for(const[s,i]of Object.entries(t)){if("closed"===i.status){r[s]=i;continue}if("sso"===i.sessionKey.type){e.push(s);continue}const t=await(0,j.z)(this.settings.getConfig(s));if(!(0,I.d6)(t))throw new Error("Fail to get crypto settings");const o=t.data,a=i.localKey?(0,V.s)(await this.encryptor.encrypt((0,g.R)(i.localKey),i.sessionKey,o)):null;r[s]={status:"closed",encryptedLocalKey:a},e.push(s)}await this.sessionsStateStore.set(r)}));for(const t of e)await this.eventEmitter.sendEvent("sessionClosed",{mode:se.K.Close,email:t})}async handle(e){if("loginStatusChanged"===e.body.eventName){const t=e.body.eventData;t.loggedIn?await this.handleLogin(t.login,!!t.needsSSOMigration):await this.handleLogout()}"openSessionFailed"===e.body.eventName&&this.handleLogout()}};fe=(0,s.__decorate)([(0,_e.b)(ye.Dj),(0,s.__metadata)("design:paramtypes",[G._,B,R,re,Ee.Y,Y,A,P,oe.Q])],fe);var Ae=r(708);let Ie=class{constructor(e){this.flexibleVerifier=e}verify(e,t){const{flexibleVerifier:r}=this;let s;switch(t.type){case"sso":s=(0,g.R)(t.ssoKey);break;case"mp":s=(0,v.K)((0,_.u)(t.masterPassword),(0,g.R)(t.secondaryKey??""));break;default:(0,y.U)(t)}return r.verifySignature(s,e)}};Ie=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[Ae.y])],Ie);let Oe=class extends n.BD{constructor(e,t){super(),this.sessionsStateStore=e,this.verifier=t}async checkSessionKey(e,t){if("mp"!==t.type)return(0,I.Vp)(!0);const r=await(0,j.z)(this.sessionsStateStore.state$);if(!(e in r))return(0,I.Vp)(!0);const s=r[e];if("open"===s.status||"opening"===s.status)return(0,I.Vp)(function(e,t){switch(e.type){case"mp":return"mp"===t.type&&e.masterPassword===t.masterPassword&&e.secondaryKey===t.secondaryKey;case"sso":return"sso"===t.type&&e.ssoKey===t.ssoKey;default:(0,y.U)(e)}}(s.sessionKey,t));if(!s.encryptedLocalKey)return(0,I.Vp)(!0);const i=(0,g.R)(s.encryptedLocalKey);return(0,I.Vp)(await this.verifier.verify(i,t))}};Oe=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[B,Ie])],Oe);var be=r(45911),Te=r(162);let Ce=class{constructor(e){this.checker=e}execute({body:{email:e,sessionKey:t}}){return(0,Te.D)(this.checker.checkSessionKey(e,t))}};Ce=(0,s.__decorate)([(0,de.e)(be.Z),(0,s.__metadata)("design:paramtypes",[n.BD])],Ce);let we=class{constructor(e){this.store=e}async handle({body:{user:e}}){await z.runExclusive((async()=>{const t=await this.store.getState();delete t[e],await this.store.set(t)}))}};we=(0,s.__decorate)([(0,_e.b)(ye.E1),(0,s.__metadata)("design:paramtypes",[B])],we);var Re=r(90032);let Pe=class{constructor(e,t){this.store=e,this.importer=t}async execute({body:{email:e,sessionKey:t}}){const r="exported"===t.type?await this.importer.import(t):t;return await z.runExclusive((async()=>{const t=await this.store.getState();if(!(e in t))return(0,I.Rn)(new Re.pX);const s=t[e];return"closed"===s.status?(0,I.Rn)(new Re.nA):(t[e]={status:"open",localKey:s.localKey,sessionKey:r},await this.store.set(t),(0,I.Vp)(void 0))}))}};Pe=(0,s.__decorate)([(0,D.W)(Re.yt),(0,s.__metadata)("design:paramtypes",[B,J])],Pe);var De=r(22631);let Ne=class{constructor(e,t){this.carbonLegacyClient=e,this.conf=t}async run(){await this.carbonLegacyClient.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}async isRunnable(){const e=await(0,j.z)(this.carbonLegacyClient.queries.getPremiumStatus());if(!(0,I.d6)(e)||!e.data.spaces)return!1;const t=e.data.spaces.find((e=>"accepted"===e.status)),r=t?.info.forceAutomaticLogout;if(!r)return!1;return await this.conf.isUserIdle(60*r)}};Ne=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[G._,De.b])],Ne);let Ue=class{constructor(e,t){this.cryptoManager=e,this.flexibleEncryptor=t}async export(e){const t=JSON.stringify(e),r=(new TextEncoder).encode(t),s=await(0,j.z)(this.cryptoManager.getOrCreateEncryptionKey()),i=await this.flexibleEncryptor.encrypt(s,r,Se.oo,f.gO);return Promise.resolve({type:"exported",content:(0,V.s)(i)})}};Ue=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[Z,E._])],Ue);var Fe=r(74156);let Me=class{constructor(e,t){this.store=e,this.exporter=t}execute(){return this.store.state$.pipe((0,$.b)((async e=>{let t;for(const r in e)e[r].status===x.sM.Open&&(t=r);if(!t)throw new Error("No opened session");const r=e[t];if("open"!==r.status)throw new Error("No opened session");return(0,I.Vp)(await this.exporter.export(r.sessionKey))})))}};Me=(0,s.__decorate)([(0,de.e)(Fe.w),(0,s.__metadata)("design:paramtypes",[B,Ue])],Me);let Le=class{};Le=(0,s.__decorate)([(0,i.Yl)({api:a.Q,crons:[{handler:Ne,periodInMinutes:1,name:"close-session-idle-cron",scope:o.F.User}],handlers:{commands:{flushLocalData:F,prepareLocalDataFlush:L,closeUserSession:ae,createUserSession:ee,openUserSession:ce,deleteLocalSession:ve,updateUserSessionKey:Pe},events:{...(0,i.g4)(d.W,{carbonLegacy:fe,CarbonLegacyDeviceRemotelyDeleted:we})},queries:{createdSessionsState:ue,sessionState:le,selectedOpenedSession:he,checkSessionKey:Ce,exportSessionKey:Me}},providers:[re,l.t,u.n,p.Y,Y,S,A,Ie,P,W,{provide:n.BD,useClass:Oe},Ue,J,Z],exports:[l.t,u.n,p.Y,n.BD],stores:[B,R,q],imports:[c.D],configurations:{session:{token:De.b}}})],Le)},34513:(e,t,r)=>{r.d(t,{r:()=>z});var s,i=r(88802),o=r(99634),a=r(6903),n=r(65766),c=r(87065),d=r(20754),l=r(87279),u=r(57755),p=r(43978),m=r(69885),h=r(89618),g=r(85390),v=r(6136),_=r(57924),y=r(37920),S=r(89358),E=r(86252);!function(e){e.OneDeviceLimitReached="OneDeviceLimitReached",e.MultipleDevicesLimitReached="MultipleDevicesLimitReached",e.UnlinkingAndOpeningSession="UnlinkingAndOpeningSession",e.UnlinkingMultipleDevicesError="UnlinkingMultipleDevicesError",e.RefreshingDeviceLimitStatus="RefreshingDeviceLimitStatus",e.OpeningSessionAfterDeviceLimitRemoval="OpeningSessionAfterDeviceLimitRemoval",e.DeviceLimitDone="DeviceLimitDone"}(s||(s={}));const f=e=>!!e?.name&&e.name!==s.DeviceLimitDone&&e.name!==s.OpeningSessionAfterDeviceLimitRemoval;let A=class{constructor(e,t){this.carbon=e,this.exceptionLogger=t,this.name="device-limit"}check(){const{liveLoginDeviceLimitFlow:e}=this.carbon.queries;return e(void 0).pipe((0,c.U)((e=>{if(!(0,l.d6)(e))return console.log("loginDeviceLimitFlow query has failed"),this.exceptionLogger.captureException({message:"loginDeviceLimitFlow query has failed"},{useCaseName:"isAllowedQuery"}),[];return f(e.data)?[u.Oq.DeviceLimited]:[]})))}};A=(0,i.__decorate)([(0,_.GS)(),(0,i.__metadata)("design:paramtypes",[E._,y.v])],A);var I=r(67837),O=r(78443);class b extends((0,I.E)(O.j)){}(0,I.K)(O.j,b);const T={masterPassword:!1,invisibleMasterPassword:!0};let C=class{constructor(e,t,r){this.carbon=e,this.ark=t,this.exceptionLogger=r,this.name="enforce-ark"}check(e){if(!e)throw new Error("No user login provided");const{getAccountAuthenticationType:t}=this.carbon.queries,r=t(),s=this.ark.queries.accountRecoveryKeyStatus({login:e});return(0,g.a)({accountAuthenticationType:r,accountRecoveryKeyStatus:s}).pipe((0,c.U)((({accountAuthenticationType:e,accountRecoveryKeyStatus:t})=>{if(!(0,l.d6)(e)||!(0,l.d6)(t))return console.log("One of these queries has failed: [accountAuthenticationType, accountRecoveryKeyStatus]"),this.exceptionLogger.captureException({message:"One of these queries has failed: [accountAuthenticationType, accountRecoveryKeyStatus]"},{useCaseName:"isAllowedQuery"}),[];return T[e.data]&&!t.data.isEnabled?[u.Oq.RequiresSettingUpRecoveryKey]:[]})))}};C=(0,i.__decorate)([(0,_.GS)(),(0,i.__metadata)("design:paramtypes",[E._,b,y.v])],C);var w=r(42303);const R={masterPassword:!1,invisibleMasterPassword:!0};let P=class{constructor(e,t,r){this.carbon=e,this.pinCode=t,this.exceptionLogger=r,this.name="enforce-pin"}check(e){if(!e)throw new Error("No user login provided");const{getAccountAuthenticationType:t}=this.carbon.queries,r=t(),s=this.pinCode.queries.getCurrentUserStatus();return(0,g.a)({accountAuthenticationType:r,pinCodeStatus:s}).pipe((0,c.U)((({accountAuthenticationType:e,pinCodeStatus:t})=>{if(!(0,l.d6)(e)||!(0,l.d6)(t))return console.log("One of these queries has failed: [accountAuthenticationType, pinCodeStatus]"),this.exceptionLogger.captureException({message:"One of these queries has failed: [accountAuthenticationType, pinCodeStatus]"},{useCaseName:"isAllowedQuery"}),[];return R[e.data]&&!t.data.isPinCodeEnabled?[u.Oq.RequiresSettingUpPin]:[]})))}};P=(0,i.__decorate)([(0,_.GS)(),(0,i.__metadata)("design:paramtypes",[E._,w.u,y.v])],P);var D,N,U,F=r(41842);!function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(D||(D={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(N||(N={})),function(e){e.LOGIN="login",e.NEW_DEVICE="newDevice",e.DISABLED="disabled"}(U||(U={}));U.LOGIN,U.NEW_DEVICE;let M=class{constructor(e,t){this.carbon=e,this.exceptionLogger=t,this.name="enforce-two-factor-authentication"}check(){const{liveTwoFactorAuthenticationInfo:e}=this.carbon.queries;return e(void 0).pipe((0,F.h)((e=>!(0,l.d6)(e)||(e.data.status===N.READY||e.data.status===N.ERROR))),(0,c.U)((e=>{if(!(0,l.d6)(e))return console.log("twoFactorAuthenticationInfo query has failed"),this.exceptionLogger.captureException({message:"twoFactorAuthenticationInfo query has failed"},{useCaseName:"isAllowedQuery"}),[];return e.data.status===N.READY&&e.data.shouldEnforceTwoFactorAuthentication?[u.Oq.Requires2FAEnforcement]:[]})))}};M=(0,i.__decorate)([(0,_.GS)(),(0,i.__metadata)("design:paramtypes",[E._,y.v])],M);var L=r(36636),G=r(43956);const K={[G.vX.MP_TO_SSO]:u.Oq.RequiresMP2SSOMigration,[G.vX.MP_TO_SSO_WITH_INFO]:u.Oq.RequiresMP2SSOMigration,[G.vX.SSO_TO_MP]:u.Oq.RequiresSSO2MPMigration};let x=class{constructor(e,t){this.authentication=e,this.exceptionLogger=t,this.name="sso-migration"}check(){const{getProviderInfo:e}=this.authentication.queries;return e(void 0).pipe((0,c.U)((e=>(0,l.d6)(e)?void 0!==e.data.migrationType?[K[e.data.migrationType]]:[]:(console.log("ssoMigrationType query has failed"),this.exceptionLogger.captureException({message:"ssoMigrationType query has failed"},{useCaseName:"SsoMigrationCheckerService"}),[]))))}};x=(0,i.__decorate)([(0,_.GS)(),(0,i.__metadata)("design:paramtypes",[L.e,y.v])],x);const k={isAllowed:!0};let j=class{constructor(e,t,r,s,i,o,a){this.session=e,this.exceptionLogger=t,this.postLoginRequirements=[r,s,i,o,a]}execute(){const{selectedOpenedSession:e}=this.session.queries;return e(void 0).pipe((0,p.w)((e=>{if(!(0,l.d6)(e))throw new Error("Failed to get active user's login");if(!e.data)return(0,m.of)({isAllowed:!1,reasons:[u.Oq.NoActiveUser]});const t=this.postLoginRequirements.map((t=>t.check(e.data).pipe((0,h.V)({first:3e3,with:()=>(console.log(`${t.name} query has timed out`),this.exceptionLogger.captureException({message:`${t.name} query has timed out`},{useCaseName:"isAllowedQuery"}),[])}))));return(0,g.a)(t).pipe((0,c.U)((e=>{const t=e.flat();return t.length>0?{isAllowed:!1,reasons:t}:k})),(0,v.x)())})))}};j=(0,i.__decorate)([(0,_.GS)(),(0,i.__metadata)("design:paramtypes",[S.x,y.v,A,C,P,M,x])],j);let V=class{constructor(e){this.postLoginRequirementsChecker=e}execute(){return this.postLoginRequirementsChecker.execute().pipe((0,c.U)(l.Vp))}};V=(0,i.__decorate)([(0,d.e)(u.bY),(0,i.__metadata)("design:paramtypes",[j])],V);var W=r(49273);let B=class{constructor(e){this.carbon=e}execute(){const{liveLoginDeviceLimitFlow:e}=this.carbon.queries;return e(void 0).pipe((0,c.U)((e=>{if(!(0,l.d6)(e))throw new Error("liveLoginDeviceLimitFlow failed");return(0,l.Vp)({isLimited:f(e.data)})})))}};B=(0,i.__decorate)([(0,d.e)(W.X),(0,i.__metadata)("design:paramtypes",[E._])],B);let z=class{};z=(0,i.__decorate)([(0,o.Yl)({api:n.Y,handlers:{commands:{},events:{},queries:{isAllowed:V,deviceLimit:B}},providers:[A,j,A,M,C,P,x],imports:[a.G]})],z)},77007:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(86952),i=r(76471),o=r(56124);const a=(0,s.Q)({name:"enclaveSdkApi",commands:{createTeamInEnclave:i.f},events:{},queries:{GetTeamQuery:o.H}})},73321:(e,t,r)=>{r.d(t,{t:()=>o});var s=r(67837),i=r(77007);class o extends((0,s.E)(i.S)){}(0,s.K)(i.S,o)},76471:(e,t,r)=>{r.d(t,{f:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},56124:(e,t,r)=>{r.d(t,{H:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},64483:(e,t,r)=>{r.d(t,{m:()=>c});var s=r(86952),i=r(15181),o=r(75437),a=r(49540),n=r(76264);const c=(0,s.Q)({name:"scim",commands:{updateScimConfiguration:i.G,generateScimToken:o.S},events:{},queries:{scimConfiguration:a.I,scimEndpoint:n.v}})},75437:(e,t,r)=>{r.d(t,{S:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},15181:(e,t,r)=>{r.d(t,{G:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},49540:(e,t,r)=>{r.d(t,{I:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},76264:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},95082:(e,t,r)=>{r.d(t,{y:()=>E});var s=r(86952),i=r(85355),o=r(26758),a=r(2073),n=r(85031),c=r(41689),d=r(39118),l=r(80974),u=r(94603),p=r(50179),m=r(74746),h=r(82249),g=r(66012),v=r(26250),_=r(1434),y=r(21589),S=r(40447);const E=(0,s.Q)({name:"confidentialSSOApi",commands:{CheckDNSValidationCommand:i.o,ClearSettingsCommand:o.h,CreateTeamCommand:a.p,MigrateToConfidentialSsoCommand:n.Dt,DeleteDomainCommand:c.k,EnableSsoCommand:d.F,InitSsoProvisioningCommand:l.S,LoginUserWithEnclaveSSOCommand:u.B,ProvisionDomainCommand:p.p,TestLoginUserWithEnclaveSSOCommand:m.b,UpdateMetadataCommand:h.o,ValidateMetadataCommand:g.l,UpdateGroupProvisioningConfigurationCommand:v.Z5},events:{confidentialSsoSettingsReset:S.z},queries:{SsoProvisioningQuery:_._,GetGroupProvisioningConfigurationQuery:y.$}})},64532:(e,t,r)=>{r.d(t,{E:()=>o});var s=r(67837),i=r(95082);class o extends((0,s.E)(i.y)){}(0,s.K)(i.y,o)},85355:(e,t,r)=>{r.d(t,{o:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},26758:(e,t,r)=>{r.d(t,{h:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},2073:(e,t,r)=>{r.d(t,{p:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},41689:(e,t,r)=>{r.d(t,{k:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},39118:(e,t,r)=>{r.d(t,{F:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},80974:(e,t,r)=>{r.d(t,{S:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},94603:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},85031:(e,t,r)=>{r.d(t,{Dt:()=>d,Fw:()=>c,hw:()=>n});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.SSO_CONNECTOR_KEY_MISSING="SSO_CONNECTOR_KEY_MISSING",e.SSO_CONNECTOR_KEY_FORMAT_INVALID="SSO_CONNECTOR_KEY_FORMAT_INVALID"}(s||(s={}));const n=(0,a.Vj)(s.SSO_CONNECTOR_KEY_MISSING,"SSO Migration failed: SSO connector key is missing"),c=(0,a.Vj)(s.SSO_CONNECTOR_KEY_FORMAT_INVALID,"SSO Migration failed: SSO connector key format is invalid");class d extends((0,i.g)({scope:o.F.User})){}},50179:(e,t,r)=>{r.d(t,{p:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},74746:(e,t,r)=>{r.d(t,{b:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},26250:(e,t,r)=>{r.d(t,{B3:()=>d,HC:()=>c,Y3:()=>u,Z5:()=>p,b2:()=>l,gY:()=>n,hJ:()=>s});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.MISMATCHING_ADMIN_PROVISIONING_KEY="MISMATCHING_ADMIN_PROVISIONING_KEY",e.IDP_NOT_FOUND="IDP_NOT_FOUND",e.NO_IDP_CONFIGURATION_UPDATE="NO_IDP_CONFIGURATION_UPDATE"}(s||(s={}));const n=(0,a.Vj)(s.TEAM_NOT_FOUND,"Team not found"),c=(0,a.Vj)(s.MISMATCHING_ADMIN_PROVISIONING_KEY,"Mismatching admin provisioning key"),d=(0,a.Vj)(s.IDP_NOT_FOUND,"IDP not found"),l=(0,a.Vj)(s.NO_IDP_CONFIGURATION_UPDATE,"No IDP configuration update"),u=(0,a.Vj)(s.GENERIC_ERROR,"Generic error");class p extends((0,i.g)({scope:o.F.User})){}},82249:(e,t,r)=>{r.d(t,{o:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},66012:(e,t,r)=>{r.d(t,{l:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},40447:(e,t,r)=>{r.d(t,{z:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.User})){}},21589:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},1434:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},33258:(e,t,r)=>{r.d(t,{JU:()=>p,X5:()=>o,cZ:()=>i,qp:()=>c,s5:()=>d});var s=r(7165);s.z.object({groupProvisioningActivated:s.z.boolean()});const i=s.z.object({idpUuid:s.z.string().uuid(),certificates:s.z.array(s.z.string()),entrypoint:s.z.string(),groupProvisioningActivated:s.z.boolean().optional(),creationDateUnix:s.z.number(),updateDateUnix:s.z.number()}),o=s.z.enum(["valid","pending","expired","invalid"]),a=s.z.enum(["tokenNotFound","invalidToken"]),n=s.z.object({status:o.nullable(),verificationToken:s.z.string(),lastCheckDateUnix:s.z.number(),pendingReason:a.nullable(),expiryDateUnix:s.z.number()}),c=s.z.object({creationDateUnix:s.z.number(),dnsCheckStatus:n,domainName:s.z.string(),idpUuid:s.z.ostring(),updateDateUnix:s.z.number()}),d=s.z.enum(["NitroComplete","NitroIncomplete","SelfHostedComplete","SelfHostedIncomplete","SsoConnectorIncomplete","SsoConnectorComplete","SsoConnectorToSelfHostedMigration","None","Unknown"]),l=s.z.object({subdomainValue:s.z.string().nullable(),txtValue:s.z.string().nullable(),verificationStatus:o.nullable(),tokenFound:s.z.string().nullable(),pendingReason:a.nullable()}),u=s.z.array(s.z.object({domainName:s.z.string().url(),verificationStatus:o,idpUuid:s.z.string().optional().nullable()})),p=s.z.object({global:s.z.object({adminProvisioningKey:s.z.string().nullable(),isTeamProvisionedInNitro:s.z.boolean().nullable(),inferredSsoState:d,teamUuid:s.z.string().nullable(),ssoCapable:s.z.boolean().nullable(),ssoIsNitroProvider:s.z.boolean().nullable()}),idpApplication:s.z.object({entityId:s.z.string().nullable(),acsUrl:s.z.string().nullable(),signOnUrl:s.z.string().nullable()}),idpMetadata:s.z.object({metadataValue:s.z.string().nullable(),idpUuid:s.z.string().nullable(),groupProvisioningActivated:s.z.boolean().nullable()}),domainSetup:u,domainVerificationInfo:s.z.record(s.z.string().url(),l),enableSSO:s.z.object({ssoEnabled:s.z.boolean().nullable()})})},36577:(e,t,r)=>{r.d(t,{$m:()=>n,Ep:()=>a,N6:()=>o,xp:()=>i});const s=["local","staging","prod"];function i(e){return s.includes(e)}class o{constructor(e,t,r){this.cloudflareHeaders=e,this.enclaveUrl=t,this.environment=r}}const a=e=>"local"===e?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y=",n=e=>"local"===e?{0:"9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"}:"staging"===e?{3:"90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"}:{3:"dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16",8:"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"}},39577:(e,t,r)=>{r.d(t,{E:()=>R});var s,i=r(88802),o=r(99634),a=r(25504),n=r(43673),c=r(77007),d=r(63663),l=r(87279),u=r(86252),p=r(76471),m=r(31108),h=r(51973),g=r(7165);!function(e){e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_GET_TEAM="api/teams/GetTeam"}(s||(s={}));const v=g.z.object({adminProvisioningKey:g.z.string()});var _=r(53127),y=r(33229);let S=class{constructor(e,t,r){this.enclaveService=e,this.carbonClient=t,this.teamPlanClient=r}async execute(){let e;try{const i=await this.getTeamUuid(),o=await this.registerTeamDeviceWithAccount();e=o.deviceAccessKey;const a=(await(t={teamDeviceCredentials:{teamUuid:i,accessKey:o.deviceAccessKey,secretKey:o.deviceSecretKey,sharingPublicKey:o.devicePublicKey,sharingPrivateKey:o.devicePrivateKey}},r=this.enclaveService,r.callEnclaveEndpoint({endpoint:s.TEAMS_CREATE_TEAM,body:t,responseSchema:v}))).adminProvisioningKey;return await this.persistAdminProvisionningKey(a),(0,l.Vp)(void 0)}catch(t){switch(e&&await this.rollBackTeamCreation(e),t){case"TeamIdNotFound":return(0,l.Rn)({tag:"TeamIdNotFound"});case"RegisterTeamDeviceFailed":return(0,l.Rn)({tag:"RegisterTeamDeviceFailed"});default:return(0,l.Rn)({tag:"CreateTeamInEnclaveApiError"})}}var t,r}async getTeamUuid(){const e=await(0,y.I)(this.carbonClient);if((0,l.hx)(e))throw new Error("TeamIdNotFound");const{teamInfo:{uuid:t}}=e.data;if(!t)throw new Error("TeamIdNotFound");return t}async registerTeamDeviceWithAccount(){const e=await(0,h.k)(this.carbonClient);if((0,l.hx)(e))throw new Error("RegisterTeamDeviceFailed");return(0,l.db)(e)}async persistAdminProvisionningKey(e){await this.carbonClient.commands.persistAdminProvisioningKey({adminProvisioningKey:e})}async rollBackTeamCreation(e){await this.carbonClient.commands.deactivateTeamDevice({teamDeviceAccessKey:e})}};S=(0,i.__decorate)([(0,d.W)(p.f),(0,i.__metadata)("design:paramtypes",[_.d,u._,m.e])],S);var E=r(36577),f=r(162),A=r(87065),I=r(20754),O=r(33258),b=r(56124);const T=g.z.record(g.z.string(),O.qp),C=g.z.object({domains:T,idps:g.z.record(g.z.string(),O.cZ),updateDateUnix:g.z.number(),messageIntegrations:g.z.object({slackStatus:g.z.boolean()})});let w=class{constructor(e){this.enclaveService=e}execute({body:e}){return(0,f.D)(this.getTeam(e)).pipe((0,A.U)(l.Vp))}getTeam(e){return e.teamUuid&&e.adminProvisioningKey?this.enclaveService.callEnclaveEndpoint({endpoint:s.TEAMS_GET_TEAM,body:e,responseSchema:C}):Promise.resolve({domains:{},idps:{},updateDateUnix:0,messageIntegrations:{slackStatus:!1}})}};w=(0,i.__decorate)([(0,I.e)(b.H),(0,i.__metadata)("design:paramtypes",[_.d])],w);let R=class{};R=(0,i.__decorate)([(0,o.Yl)({api:c.S,imports:[a.X,n.i],providers:[_.d],exports:[_.d],configurations:{enclaveApiSettings:{token:E.N6}},handlers:{commands:{createTeamInEnclave:S},events:{},queries:{getTeam:w}}})],R)},53127:(e,t,r)=>{r.d(t,{d:()=>U});var s=r(88802),i=r(57924),o=r(73774),a=r(58895),n=r(36577),c=r(56695),d=r(96412),l=r(60399),u=r(87279),p=r(7165),m=r(7573);const h=p.z.object({data:p.z.object({attestation:p.z.string(),clientIdentifier:p.z.string()}),requestId:p.z.string()});class g{decode(e){const t=h.safeParse(e);if(!t.success)throw new Error("Invalid response format");return{attestation:(0,m.i)(t.data.data.attestation),clientIdentifier:t.data.data.clientIdentifier}}}const v=async(e,t)=>{const{headers:r,httpClient:s,publicKey:i}=t,o=await(async e=>(await c.ready,{clientPublicKey:c.to_hex(e)}))(i),a=await(0,l.z)(s.post(e,o,{observe:"body",responseType:"json",responseBodyDecoder:new g,withCredentials:!0,headers:r}));if((0,u.hx)(a))throw new Error("string"==typeof a.error?a.error:"HTTP Error");return a.data};var _=r(73155);const y=p.z.object({requestId:p.z.string(),errors:p.z.array(p.z.object({status:p.z.string(),code:p.z.string(),message:p.z.string()}))});class S{assertData(e){if(!e)throw new Error("toDecode expected to be truthy");if("[object Object]"!=`${e}`||Array.isArray(e))throw new Error("toDecode expected to be object");if(!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('toDecode expected to contain a "data" property');const t=e;if("string"!=typeof t.data)throw new Error("toDecode.data expected to be type string but was "+typeof t.data)}decode(e){return this.assertData(e),e.data}}var E=r(40767);const f=e=>{const t=(0,E.p)(new Uint8Array(e)),r=(s=t,Array.isArray(s)?s:s.value);var s;const[i,,o,a]=r;if(!i)throw new Error("parseSignedMessage: no protected header field");if(!o)throw new Error("parseSignedMessage: no payload field");if(!a)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(o).buffer,protectedHeaders:new Uint8Array(i).buffer,signature:new Uint8Array(a).buffer}};var A=r(89685),I=r(7502);const O=p.z.object({module_id:p.z.string(),timestamp:p.z.bigint(),digest:p.z.string(),pcrs:p.z.record(p.z.string(),p.z.instanceof(Uint8Array)),certificate:p.z.instanceof(Uint8Array),cabundle:p.z.array(p.z.instanceof(Uint8Array)),user_data:p.z.instanceof(Uint8Array),nonce:p.z.instanceof(Uint8Array).nullable()}),b=p.z.object({header:p.z.string(),publicKey:p.z.string()});var T=r(71833);var C=r(76746);var w=r(96303);const R=e=>(0,w.k)((e=>new Uint8Array(e).buffer)(e)),P=async e=>{const{attestation:t,rootCertBER:r,expectedPCRs:s}=e,{protectedHeaders:i,payload:o,signature:a}=f(t),n=(e=>{const t=(0,E.p)(e),r=O.safeParse(t);if(!r.success)throw new Error("failed to parse attestation document");const s=r.data,i=(0,A.v)(s.user_data),o=JSON.parse(i),a=b.safeParse(o);if(!a.success)throw new Error("failed to parse server crypto info");const n=a.data;return{moduleId:s.module_id,timestamp:s.timestamp,digest:s.digest,pcrs:s.pcrs,certificate:new Uint8Array(s.certificate).buffer,cabundle:(c=s.cabundle,c.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,I.R)(n.header),serverPublicKey:(0,I.R)(n.publicKey),nonce:null!==s.nonce?new Uint8Array(s.nonce).buffer:null};var c})(o),c=await(async(e,t,r)=>{const s=T.KBB.fromBER(e),i=t.map((e=>T.KBB.fromBER(e)));i.push(s);const o=[T.KBB.fromBER((0,I.R)(r))],a=new T.DMg({trustedCerts:o,certs:i});return(await a.verify()).result})(n.certificate,n.cabundle,r);if(!c)throw new Error("Invalid cert chain!");const d=await(async(e,t,r,s)=>{const i=T.KBB.fromBER(s),o=await i.getPublicKey(),a=["Signature1",t,new ArrayBuffer(0),r],n=(0,C.d)(a);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},o,e,n)})(a,i,o,n.certificate);if(!d)throw new Error("Invalid signature!");return((e,t)=>{for(const[r,s]of Object.entries(t))if(s!==R(e[Number(r)]))throw new Error("PCRs did not match")})(n.pcrs,s),{serverPublicKey:n.serverPublicKey,serverHeader:n.serverHeader}};var D;!function(e){e.CLIENT_HELLO="api/tunnel/ClientHello",e.TERMINATE_HELLO="api/tunnel/TerminateHello"}(D||(D={}));const N=async(e,t)=>{await c.ready;const{enclaveApiSettings:{cloudflareHeaders:r,enclaveUrl:s},rootCertBER:i,expectedPCRs:o,httpClient:a,platformInfo:n,data:p}=t,m={};m["dashlane-client-agent"]=JSON.stringify({platform:n.platformName,osversion:n.osVersion,version:n.appVersion}),r.accessKey&&r.secretKey&&(m["CF-Access-Client-Id"]=r.accessKey,m["CF-Access-Client-Secret"]=r.secretKey);const h=c.crypto_kx_keypair(),{clientHelloUrl:g,terminateHelloUrl:E,secureContentUrl:f}=((e,t)=>({clientHelloUrl:`${e}${D.CLIENT_HELLO}`,terminateHelloUrl:`${e}${D.TERMINATE_HELLO}`,secureContentUrl:`${e}${t}`}))(s,e),A=await v(g,{headers:m,httpClient:a,publicKey:h.publicKey}),{serverPublicKey:I,serverHeader:O}=await P({attestation:A.attestation,rootCertBER:i,expectedPCRs:o});(0,d.t)({url:s,name:"ClientIdentifier",value:A.clientIdentifier,expirationDate:(new Date).getTime()+15e5,sameSite:"strict",secure:!0});const b=await(async(e,t)=>{const{headers:r,clientKeyPair:s,httpClient:i,serverPublicKey:o}=t;await c.ready;const a=c.crypto_kx_client_session_keys(s.publicKey,s.privateKey,new Uint8Array(o)),n=c.crypto_secretstream_xchacha20poly1305_init_push(a.sharedRx),d=n.state,p=n.header,m={clientHeader:c.to_hex(p)},h=await(0,l.z)(i.post(e,m,{observe:"response",responseType:"json",withCredentials:!0,headers:r}));if((0,u.hx)(h))throw new Error("HTTP error");return{clientStateOut:d,sessionKeys:a}})(E,{headers:m,httpClient:a,clientKeyPair:h,serverPublicKey:I});return(async(e,t)=>{const{clientStateOut:r,serverHeader:s,sessionKeys:i,headers:o,httpClient:a}=t;await c.ready;const n=c.crypto_secretstream_xchacha20poly1305_push(r,c.from_string(t.data),null,c.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),d={data:c.to_hex(n)},p=await(0,l.z)(a.post(e,d,{observe:"body",responseType:"json",responseBodyDecoder:new S,withCredentials:!0,headers:o}));if((0,u.hx)(p)){if(p.error instanceof _.R){const e=await JSON.parse(await p.error.response.text()),t=y.safeParse(e);if(t.success){const e=t.data.errors[0];throw new Error(e.code)}}throw new Error("HTTP error")}const m=c.crypto_secretstream_xchacha20poly1305_init_pull(new Uint8Array(s),i.sharedTx),h=c.crypto_secretstream_xchacha20poly1305_pull(m,c.from_hex(p.data)).message;return{decryptedResponse:c.to_string(h)}})(f,{data:p,headers:m,httpClient:a,clientStateOut:b.clientStateOut,sessionKeys:b.sessionKeys,serverHeader:O})};let U=class{constructor(e,t,r){this.platformInfoService=e,this.httpClient=t,this.enclaveApiSettings=r}async callEnclaveEndpoint(e){const{body:t,endpoint:r,responseSchema:s}=e,i=JSON.stringify(t),o=await this.platformInfoService.getPlatformInfo(),a=(0,n.Ep)(this.enclaveApiSettings.environment),c=(0,n.$m)(this.enclaveApiSettings.environment),{decryptedResponse:d}=await N(r,{data:i,httpClient:this.httpClient,enclaveApiSettings:this.enclaveApiSettings,rootCertBER:a,expectedPCRs:c,platformInfo:o}),l=s.safeParse(JSON.parse(d));if(!l.success)throw new Error(`Enclave response parsing failed. Endpoint: ${r}.`);return l.data}getEnclaveApiSettings(){return this.enclaveApiSettings}};U=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.t,o.e,n.N6])],U)},18045:(e,t,r)=>{r.d(t,{i:()=>L});var s=r(88802),i=r(99634),o=r(37935),a=r(64483),n=r(25029),c=r(7165);c.z.enum(["NitroComplete","SelfHostedComplete","AdSyncComplete","None"]);const d=c.z.object({token:c.z.string(),active:c.z.boolean()}).optional();var l=r(95681),u=r(23347);const p=e=>d.safeParse(e).success;class m extends((0,l.Q)({persist:!1,capacity:u.Y._001KB,initialValue:undefined,scope:n.F.User,storeName:"confidential-scim-state",storeTypeGuard:p})){}var h=r(63663),g=r(87279),v=r(15181),_=r(57648);let y=class{constructor(e,t){this.confidentialScimService=e,this.confidentialScimStore=t}async execute({body:e}){const t=await this.confidentialScimStore.getState();try{const r={token:e.token??(t?.token||""),active:e.active??!!t?.active};return await this.confidentialScimStore.set({...r}),await this.confidentialScimService.setConfidentialScimConfig({...t,...e}),(0,g.Vp)(void 0)}catch(e){return await this.confidentialScimStore.set(t),(0,g.Rn)({tag:e.message})}}};y=(0,s.__decorate)([(0,h.W)(v.G),(0,s.__metadata)("design:paramtypes",[_.Z,m])],y);var S=r(75437),E=r(64532),f=r(31108),A=r(60399),I=r(77042);let O=class{constructor(e,t,r,s,i){this.confidentialScimStore=e,this.confidentialScimService=t,this.ssoClient=r,this.teamPlansClient=s,this.ssoProvisioningStore=i}async execute(){const e=await this.confidentialScimStore.getState(),{global:{ssoIsNitroProvider:t}}=await this.ssoProvisioningStore.getState();try{t||await this.createTeam();const e=crypto.randomUUID();return await this.confidentialScimStore.set({token:e,active:!1}),await this.confidentialScimService.setConfidentialScimConfig({token:e,active:!1}),(0,g.Vp)(void 0)}catch(t){return this.confidentialScimStore.set(e),(0,g.Rn)({tag:`Something wrong happened: ${t}`})}}async createTeam(){const e=await(0,A.z)(this.teamPlansClient.queries.getTeamId());if((0,g.hx)(e))throw new Error("TeamID not found, are you logged in?");await this.ssoClient.commands.initSsoProvisioning({teamId:`${e.data.teamId}`}),await this.ssoClient.commands.createTeam()}};O=(0,s.__decorate)([(0,h.W)(S.S),(0,s.__metadata)("design:paramtypes",[m,_.Z,E.E,f.e,I.M])],O);var b=r(43978),T=r(20754),C=r(49540);let w=class{constructor(e,t,r){this.confidentialScimStore=e,this.scimConfigurationService=t,this.scimStore=r}execute(){return this.confidentialScimStore.state$.pipe((0,b.w)((async e=>e?(0,g.Vp)(e):this.getInitState())))}async getInitState(){try{const e=await this.scimConfigurationService.getConfidentialScimConfig();return await this.scimStore.set(e),(0,g.Vp)(e)}catch(e){return(0,g.Vp)({active:!1,token:null})}}};w=(0,s.__decorate)([(0,T.e)(C.I),(0,s.__metadata)("design:paramtypes",[m,_.Z,m])],w);var R=r(39577),P=r(42674),D=r(37182),N=r(69885),U=r(76264),F=r(36577);let M=class{constructor(e,t,r){this.enclaveApiSettings=e,this.confidentialScimService=t,this.confidentialScimStore=r}execute(){return this.confidentialScimStore.state$.pipe((0,b.w)((async e=>{if(!e?.token)return(0,g.Rn)({tag:"Could not load team uuid"});const{teamUuid:t}=await this.confidentialScimService.getTeamIdentifiers();if(!t)return(0,g.Rn)({tag:"Could not load team uuid"});const r=new URL(`scim/${t}`,this.enclaveApiSettings.enclaveUrl);return(0,g.Vp)({endpoint:r.href})})),(0,D.K)((()=>(0,N.of)((0,g.Rn)({tag:"Could not load team uuid"})))))}};M=(0,s.__decorate)([(0,T.e)(U.v),(0,s.__metadata)("design:paramtypes",[F.N6,_.Z,m])],M);let L=class{};L=(0,s.__decorate)([(0,i.Yl)({api:a.m,imports:[R.E,o.D,P.D],handlers:{commands:{updateScimConfiguration:y,generateScimToken:O},events:{},queries:{scimConfiguration:w,scimEndpoint:M}},stores:[m],providers:[_.Z],exports:[_.Z]})],L)},57648:(e,t,r)=>{r.d(t,{Z:()=>_});var s=r(88802),i=r(7165),o=r(57924),a=r(53127),n=r(31108),c=r(86252),d=r(60399),l=r(87279),u=r(33229),p=r(13878);const m="api/scim/GetSCIMConfiguration",h="api/scim/SetSCIMConfiguration",g=i.z.object({token:i.z.string().nullable(),active:i.z.boolean()}),v=i.z.object({token:i.z.string(),active:i.z.boolean()});let _=class{constructor(e,t,r){this.enclaveService=e,this.teamPlansClient=t,this.carbonClient=r}async getConfidentialScimConfig(){const e={token:"",active:!1},{teamUuid:t,adminProvisioningKey:r}=await this.getTeamIdentifiers();if(!t)throw new Error("TeamIdNotFound");if(!r)throw new Error("AdminProvisioningKeyNotFound");const s=await this.enclaveService.callEnclaveEndpoint({endpoint:m,body:{teamUuid:t,adminProvisioningKey:r},responseSchema:g});return e.active=s.active,e.token=s.token??"",e}async setConfidentialScimConfig(e){const{teamUuid:t,adminProvisioningKey:r}=await this.getTeamIdentifiers();if(!t)throw new Error("TeamIdNotFound");if(!r)throw new Error("AdminProvisioningKeyNotFound");await this.enclaveService.callEnclaveEndpoint({endpoint:h,body:{teamUuid:t,adminProvisioningKey:r,...e},responseSchema:v})}async getTeamIdentifiers(){const[e,t]=await Promise.all([(0,d.z)(this.teamPlansClient.queries.getTeamId()),(0,u.I)(this.carbonClient)]);if((0,l.hx)(e)||(0,l.hx)(t))throw new Error("cannot get team info");const r=e.data.teamId??"",{uuid:s}=t.data.teamInfo;return{teamUuid:s,adminProvisioningKey:await(0,p.B)(r,this.carbonClient.queries.carbonState)}}};_=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[a.d,n.e,c._])],_)},13878:(e,t,r)=>{r.d(t,{B:()=>n});var s=r(7165),i=r(60399),o=r(48844);const a=s.z.object({adminProvisioningKey:s.z.object({adminProvisioningKey:s.z.ostring().nullable(),itemId:s.z.ostring().nullable()}).optional().nullable()}),n=(e,t)=>{const r=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,o.nb)({success:e=>{const t=a.safeParse(e);if(!t.success)throw t.error;return t.data.adminProvisioningKey?.adminProvisioningKey??null},failure:()=>""}));return(0,i.z)(r)}},51973:(e,t,r)=>{r.d(t,{k:()=>c});var s,i=r(7165);!function(e){e.SSO_CONNECTOR="sso_connector",e.ENCRYPTION_SERVICE="encryption_service",e.NITRO="nitro_encryption_service"}(s||(s={}));var o=r(87279);const a=i.z.object({data:i.z.object({deviceAccessKey:i.z.string(),deviceSecretKey:i.z.string()})}),n=i.z.object({data:i.z.object({devicePrivateKey:i.z.string(),devicePublicKey:i.z.string()})}),c=async e=>{const t=await e.commands.registerTeamDevice({platform:s.NITRO,deviceName:"Nitro Encryption Service"});if((0,o.hx)(t))return t;const{data:{deviceAccessKey:r,deviceSecretKey:i}}=a.parse((0,o.db)(t)),c=await e.commands.registerTeamDeviceAccount({deviceAccessKey:r,shouldGenerateDeviceKeyPair:!0});if((0,o.hx)(c))return c;const{data:{devicePrivateKey:d,devicePublicKey:l}}=n.parse((0,o.db)(c));return(0,o.Vp)({deviceAccessKey:r,deviceSecretKey:i,devicePrivateKey:d,devicePublicKey:l})}},33229:(e,t,r)=>{r.d(t,{I:()=>l});var s=r(7165),i=r(87279),o=r(22450);const a=s.z.object({enabled:s.z.boolean()}).optional(),n=s.z.object({teamInfo:s.z.object({uuid:s.z.ostring().nullable(),ssoEnabled:s.z.boolean(),ssoIsNitroProvider:s.z.boolean(),ssoServiceProviderUrl:s.z.ostring().nullable(),ssoIdpMetadata:s.z.ostring().nullable(),ssoIdpEntrypoint:s.z.ostring().nullable()}),capabilities:s.z.object({sso:a})}),c=s.z.object({data:n}),d=s.z.object({message:s.z.string(),reason:s.z.nativeEnum(o._V)}),l=async e=>{const{getTeamInfo:t}=e.commands,r=await t();if((0,i.hx)(r)){switch(d.parse(r.error).reason){case o._V.UNAUTHORIZED:return(0,i.Rn)({tag:"UserNotAuthorized"});case o._V.UNKNOWN_ERROR:return(0,i.Rn)({tag:"CouldNotGetTeamStatus"});default:throw new Error("An unexpected error happened while trying to retrieve team info")}}const{data:{teamInfo:s,capabilities:a}}=c.parse(r.data);return(0,i.Vp)({teamInfo:s,capabilities:a})}},42674:(e,t,r)=>{r.d(t,{D:()=>ke});var s=r(88802),i=r(99634),o=r(25504),a=r(43673),n=r(95082),c=r(39577);class d{}var l,u=r(63663),p=r(87279),m=r(94603),h=r(7165);!function(e){e.AUTH_CONFIRM_LOGIN="api/authentication/ConfirmLogin2",e.AUTH_REQUEST_LOGIN="api/authentication/RequestLogin2",e.AUTH_REQUEST_TEST_LOGIN="api/authentication/RequestTestLogin2",e.AUTH_CONFIRM_TEST_LOGIN="api/authentication/ConfirmTestLogin2",e.DOMAINS_CREATE_DOMAIN="api/domains/CreateDomain",e.DOMAINS_DELETE_DOMAIN="api/domains/DeleteDomain2",e.DOMAINS_UPDATE_DOMAIN="api/domains/UpdateDomain2",e.DOMAINS_CHECK_DNS_VALIDATION="api/domains/CheckDNSValidation2",e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_CREATE_TEAM_FOR_MIGRATION="api/teams/CreateTeamForMigration",e.TEAMS_GET_TEAM="api/teams/GetTeam",e.TEAMS_DELETE_TEAM="api/teams/DeleteTeam",e.IDPS_CREATE_IDP="api/idps/CreateIdp",e.IDPS_UPDATE_IDP="api/idps/UpdateIdp",e.IDPS_DELETE_IDP="api/idps/DeleteIdp",e.TEAMS_GET_TEAM_STATUS="api/teams/GetTeamStatus"}(l||(l={}));const g=h.z.object({idpAuthorizeUrl:h.z.string(),teamUuid:h.z.string(),spCallbackUrl:h.z.string(),domainName:h.z.string()}),v=h.z.object({exists:h.z.boolean(),ssoToken:h.z.string(),userServiceProviderKey:h.z.string(),currentAuthenticationMethods:h.z.string().array(),expectedAuthenticationMethods:h.z.string().array()});var _=r(86252),y=r(53127);let S=class{constructor(e,t,r){this.enclaveService=e,this.enclaveLoginContext=t,this.carbonLegacyClient=r}async execute(e){const t=e.body.userEmailAddress,r=t.slice(t.indexOf("@")+1),s=await(i=this.enclaveService,o={login:t},i.callEnclaveEndpoint({endpoint:l.AUTH_REQUEST_LOGIN,body:o,responseSchema:g}));var i,o;const{idpAuthorizeUrl:a,teamUuid:n}=s,{samlToken:c}=await this.enclaveLoginContext.getSamlFromLogin(a,!0,e.body.tabFocus),d=await((e,t)=>e.callEnclaveEndpoint({endpoint:l.AUTH_CONFIRM_LOGIN,body:t,responseSchema:v}))(this.enclaveService,{domainName:r,samlResponse:c,teamUuid:n}),u={...d,login:e.body.userEmailAddress};return await this.enclaveLoginContext.redirectUserIntoLoginFlow(u),(0,p.Vp)(void 0)}};S=(0,s.__decorate)([(0,u.W)(m.B),(0,s.__metadata)("design:paramtypes",[y.d,d,_._])],S);var E=r(21242),f=r(33258),A=r(50179),I=r(64718);const O=h.z.object({error:h.z.string()}),b=h.z.object({data:h.z.object({samlIdpEntryPoint:h.z.string(),samlIdpCertificate:h.z.string()})}),T=async(e,t)=>{if(null===t)return{samlIdpEntryPoint:"",samlIdpCertificate:""};let r="";if(new I.Y(t).isUrlValid()){const e=await fetch(t);r=await e.text()}else r=t;const{parseMetadataFields:s}=e.commands,i=await s({ssoIdpMetadata:r});if((0,p.d6)(i))return b.parse(i.data).data;throw new Error("failed to parse metadata, please validate first.")};var C=r(57924),w=r(77042);const R="_dashlane-challenge";let P=class{constructor(e){this.store=e}async reset(){await this.store.init({global:{adminProvisioningKey:null,teamUuid:null,ssoIsNitroProvider:null,isTeamProvisionedInNitro:null,inferredSsoState:f.s5.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}})}set(e){return this.store.set(e)}};P=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[w.M])],P);const D=h.z.object({dnsVerificationToken:h.z.string()});let N=class{constructor(e,t,r,s,i){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlipsClient=s,this.carbonLegacyClient=i}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,p.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,p.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,p.Rn)({tag:"DomainNameNotProvided"});const r=t.idpMetadata.metadataValue?await T(this.carbonLegacyClient,t.idpMetadata.metadataValue):null,s={domainName:e.domainName,adminProvisioningKey:t.global.adminProvisioningKey,idpMetadata:r?{certificate:r.samlIdpCertificate,entrypoint:r.samlIdpEntryPoint}:void 0,teamUuid:t.global.teamUuid},{dnsVerificationToken:i}=await((e,t)=>e.callEnclaveEndpoint({body:t,endpoint:l.DOMAINS_CREATE_DOMAIN,responseSchema:D}))(this.enclaveService,s),o=[...t.domainSetup,{idpUuid:t.idpMetadata.idpUuid,domainName:e.domainName,verificationStatus:f.X5.enum.pending}],a={...t.domainVerificationInfo,[e.domainName]:{txtValue:i,verificationStatus:f.X5.enum.pending,subdomainValue:R,pendingReason:null,tokenFound:null}};return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:o,domainVerificationInfo:{...t.domainVerificationInfo,...a}}),(0,p.Vp)(void 0)}};N=(0,s.__decorate)([(0,u.W)(A.p),(0,s.__metadata)("design:paramtypes",[y.d,P,w.M,E.P,_._])],N);var U=r(2073),F=r(73321),M=r(13878),L=r(31108),G=r(60399);let K=class{constructor(e,t,r,s,i,o){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.carbonClient=s,this.enclaveSdkClient=i,this.teamPlanDetailsClient=o,this.ssoServiceProviderUrl=new URL(this.enclaveService.getEnclaveApiSettings().enclaveUrl).origin}async execute(){const{global:e}=await this.ssoProvisioningStore.getState();if(!e.adminProvisioningKey){const e=await this.enclaveSdkClient.commands.createTeamInEnclave();if((0,p.hx)(e))return(0,p.Rn)({tag:"CreateTeamApiError"})}if(!e.ssoIsNitroProvider)try{await this.setupSsoConfidentialTeam()}catch{return(0,p.Rn)({tag:"CreateTeamApiError"})}return(0,p.Vp)(void 0)}async setupSsoConfidentialTeam(){const e=await this.ssoProvisioningStore.getState();await this.carbonClient.commands.updateTeamSettings({ssoServiceProviderUrl:this.ssoServiceProviderUrl});const t=await(0,G.z)(this.teamPlanDetailsClient.queries.getTeamId());if((0,p.hx)(t))throw new Error("Failed to get teamId");const{teamId:r}=(0,p.db)(t);if(!r)throw new Error("Failed to get teamId");const s=await(0,M.B)(r,this.carbonClient.queries.carbonState);await this.ssoProvisioningStoreUpdater.set({...e,global:{...e.global,adminProvisioningKey:s,ssoIsNitroProvider:!0,isTeamProvisionedInNitro:!0,inferredSsoState:f.s5.enum.NitroIncomplete}})}};K=(0,s.__decorate)([(0,u.W)(U.p),(0,s.__metadata)("design:paramtypes",[y.d,P,w.M,_._,F.t,L.e])],K);var x=r(28489),k=r(85031);const j=h.z.record(h.z.string(),f.qp),V=h.z.object({domains:j,idps:h.z.record(h.z.string(),f.cZ),updateDateUnix:h.z.number()}),W=h.z.object({adminProvisioningKey:h.z.string(),team:V});var B=r(51973);const z=h.z.enum(["sso_connector","encryption_service","nitro_encryption_service","command_line"]),H=[z.enum.encryption_service,z.enum.nitro_encryption_service,z.enum.sso_connector],Y=h.z.object({platform:z,accessKey:h.z.string(),deviceName:h.z.string().nullable(),activated:h.z.boolean(),creationDateUnix:h.z.number(),updateDateUnix:h.z.number()}),Q=h.z.object({data:h.z.object({teamDevices:h.z.array(Y)})}),q=async e=>{const{listTeamDevices:t}=e.commands,r=await t();if((0,p.hx)(r))throw new Error("Failed to get team devices");const{data:{teamDevices:s}}=Q.parse(r.data),i=s.filter((e=>H.includes(e.platform)&&e.activated)),o=e=>e.reduce(((e,t)=>!e||t.updateDateUnix>e.updateDateUnix?t:e),null),a=i.filter((e=>e.platform===z.enum.nitro_encryption_service)),n=i.filter((e=>e.platform===z.enum.encryption_service)),c=i.filter((e=>e.platform===z.enum.sso_connector));return n.length?o(n):c.length?o(c):o(a)};let $=class{constructor(e,t,r,s,i){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.carbonClient=s,this.teamPlanDetails=i,this.ssoServiceProviderUrl=new URL(this.enclaveService.getEnclaveApiSettings().enclaveUrl).origin}async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),r=t.global.teamUuid;if(!r)throw new Error("SSO Migration failed: TeamUuid is missing");if(t.global.inferredSsoState===f.s5.enum.SsoConnectorComplete){if(!e.ssoConnectorKey)return(0,p.Rn)((0,k.hw)());if(!new RegExp("^[0-9a-f]{8}[-]([0-9a-f]{4}[-]){3}[0-9a-f]{12}\\|[0-9a-zA-Z/+]{86}==$").test(e.ssoConnectorKey))return(0,p.Rn)((0,k.Fw)())}const s=e.ssoConnectorKey||await this.getSsoConnectorKey(),i=await this.getTeamDomains(),{samlIdpCertificate:o,ssoIdpEntrypoint:a}=await this.getIdpData(),n=await this.getTeamDeviceToMigrate(),c=await this.getScimToken(n.accessKey),d=await(0,B.k)(this.carbonClient);if((0,p.hx)(d))throw new Error("SSO Migration failed: Unable to register team device with account with error");const{deviceAccessKey:u,deviceSecretKey:m,devicePublicKey:h,devicePrivateKey:g}=(0,p.db)(d),{adminProvisioningKey:v,team:_}=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:l.TEAMS_CREATE_TEAM_FOR_MIGRATION,body:t,responseSchema:W}))(this.enclaveService,{teamDeviceCredentials:{teamUuid:r,accessKey:u,secretKey:m,sharingPublicKey:h,sharingPrivateKey:g},masterServiceProviderKey:s,domains:i,certificates:[o],entrypoint:a,scimToken:c});return await this.runSideEffects({currentState:t,adminProvisioningKey:v,teamDeviceToMigrate:n,team:_}),(0,p.Vp)(void 0)}async getTeamDomains(){const e=await this.carbonClient.commands.getTeamDomains();if((0,p.hx)(e))throw new Error("SSO Migration failed: Unable to retrieve team domains");const t=(0,p.db)(e);if(!t.success)throw new Error("SSO Migration failed: Unable to retrieve team domains");return t.domains.map((e=>e.name))}async getIdpData(){const e=await(0,G.z)(this.teamPlanDetails.queries.getTeamSsoInfo());if((0,p.hx)(e))throw new Error("SSO Migration failed: Cannot retrieve any SSO information");const{ssoIdpEntrypoint:t,ssoIdpMetadata:r}=(0,p.db)(e);if(!t||!r)throw new Error("SSO Migration failed: Cannot retrieve Idp info. ssoIdpEntrypoint or ssoIdpMetadata is missing");const{samlIdpCertificate:s}=await T(this.carbonClient,r);return{samlIdpCertificate:s,ssoIdpEntrypoint:t}}async getSsoConnectorKey(){const e=await(0,G.z)(this.teamPlanDetails.queries.getTeamId());if((0,p.hx)(e))throw new Error("SSO Migration failed: Unable to retrieve team id");const t=(0,p.db)(e).teamId??"",r=await(0,G.z)(this.carbonClient.queries.carbonState({path:"userSession.teamAdminData.teams"}));if((0,p.hx)(r))throw new Error("SSO Migration failed: Unable to retrieve teamAdminData");const s=h.z.record(h.z.string(),h.z.object({ssoConnectorKey:h.z.object({ssoConnectorKey:h.z.string()})})),i=(0,p.db)(r),o=s.safeParse(i);if(!o.success)throw new Error("SSO Migration failed: Unable to retrieve ssoConnectorKey");return o.data[t].ssoConnectorKey.ssoConnectorKey}async getScimToken(e){const t=await this.carbonClient.commands.getTeamDeviceEncryptedConfig({draft:!1,deviceAccessKey:e});if((0,p.hx)(t))throw new Error("SSO Migration failed: Unable to retrieve scim token");const r=(0,p.db)(t);if(r.success)return r.data?.configProperties.scimAuthToken||void 0}async getTeamDeviceToMigrate(){const e=await q(this.carbonClient);if(!e)throw new Error("SSO Migration failed: no active team device found");return e}getDomainInfoFromTeam(e){return Object.entries(e.domains).reduce(((e,[t,r])=>(e.domainSetup.push({domainName:t,verificationStatus:r.dnsCheckStatus.status??"pending"}),e.domainVerificationInfo[t]={txtValue:r.dnsCheckStatus.verificationToken,verificationStatus:f.X5.parse(r.dnsCheckStatus.status),subdomainValue:R,pendingReason:r.dnsCheckStatus.pendingReason,tokenFound:null},e)),{domainSetup:(0,x.Ay)([]),domainVerificationInfo:(0,x.Ay)({})})}async runSideEffects({currentState:e,adminProvisioningKey:t,teamDeviceToMigrate:r,team:s}){await this.carbonClient.commands.persistAdminProvisioningKey({adminProvisioningKey:t}),await this.carbonClient.commands.updateTeamSettings({ssoServiceProviderUrl:this.ssoServiceProviderUrl});const{domainSetup:i,domainVerificationInfo:o}=this.getDomainInfoFromTeam(s),a=Object.entries(s.idps).map((([e])=>e))[0];await this.ssoProvisioningStoreUpdater.set({...e,global:{...e.global,adminProvisioningKey:t,ssoIsNitroProvider:!0,isTeamProvisionedInNitro:!0,inferredSsoState:f.s5.enum.NitroIncomplete},idpMetadata:{...e.idpMetadata,idpUuid:a},domainSetup:i,domainVerificationInfo:o}),await this.carbonClient.commands.deactivateTeamDevice({teamDeviceAccessKey:r.accessKey})}};$=(0,s.__decorate)([(0,u.W)(k.Dt),(0,s.__metadata)("design:paramtypes",[y.d,P,w.M,_._,L.e])],$);var X=r(41689);h.z.object({domainName:h.z.string(),teamUuid:h.z.string(),adminProvisioningKey:h.z.string()});const Z=["DOMAIN_NOT_FOUND","DOMAIN_CONFIGURATION_NOT_FOUND"];let J=class{constructor(e,t,r,s){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlipsClient=s}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,p.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,p.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,p.Rn)({tag:"DomainNameNotProvided"});const r={domainName:e.domainName,teamUuid:t.global.teamUuid,adminProvisioningKey:t.global.adminProvisioningKey};try{await(async(e,t)=>{await e.callEnclaveEndpoint({endpoint:l.DOMAINS_DELETE_DOMAIN,body:t,responseSchema:h.z.object({})})})(this.enclaveService,r)}catch(e){const t=e instanceof Error?e.message:"Unable to delete domain.";if(!Z.includes(t))throw e}return await this.applyDeleteDomainOnState(t,e.domainName),(0,p.Vp)(void 0)}async applyDeleteDomainOnState(e,t){e.domainSetup=e.domainSetup.filter((e=>e.domainName!==t)),delete e.domainVerificationInfo[t],await this.ssoProvisioningStoreUpdater.set(e)}};J=(0,s.__decorate)([(0,u.W)(X.k),(0,s.__metadata)("design:paramtypes",[y.d,P,w.M,E.P])],J);var ee=r(58895),te=r(74746);const re=h.z.object({idpAuthorizeUrl:h.z.string(),spCallbackUrl:h.z.ostring()});var se=r(36577);let ie=class{constructor(e,t,r,s,i,o){this.enclaveService=e,this.enclaveLoginContext=t,this.enclaveApiSettings=r,this.platformInfoService=s,this.ssoProvisioningStore=i,this.featureFlips=o}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r,teamUuid:s},idpMetadata:{idpUuid:i}}=t,o=e.body.domainName;if(!(r&&o&&s&&i))return(0,p.Rn)({tag:"MissingCommandParameters"});try{const e=await(a=this.enclaveService,n={adminProvisioningKey:r,teamUuid:s,idpUuid:i},a.callEnclaveEndpoint({endpoint:l.AUTH_REQUEST_TEST_LOGIN,body:n,responseSchema:re})),{samlToken:t}=await this.enclaveLoginContext.getSamlFromLogin(e.idpAuthorizeUrl,!1);return await(async(e,t)=>{await e.callEnclaveEndpoint({endpoint:l.AUTH_CONFIRM_TEST_LOGIN,body:t,responseSchema:h.z.object({})})})(this.enclaveService,{domainName:o,samlResponse:t,adminProvisioningKey:r,teamUuid:s}),await this.enclaveLoginContext.cleanupTestLogin(),(0,p.Vp)(void 0)}catch{return(0,p.Rn)({tag:"FailedToLoginIntoSsoProvider"})}var a,n}};ie=(0,s.__decorate)([(0,u.W)(te.b),(0,s.__metadata)("design:paramtypes",[y.d,d,se.N6,ee.t,w.M,E.P])],ie);var oe=r(26457),ae=r(65255),ne=r(80974);const ce=h.z.object({}),de=(h.z.object({teamUuid:h.z.string().uuid(),adminProvisioningKey:h.z.string(),idpUuid:h.z.string().uuid()}),h.z.object({idpUuid:h.z.string().uuid()}));var le=r(33229),ue=r(87065);let pe=class{constructor(e,t,r,s,i,o){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.enclaveClient=r,this.carbonLegacyClient=s,this.featureFlipsClient=i,this.appLogger=o}async execute({body:{teamId:e}}){if(!e)return(0,p.Rn)({tag:"TeamIdNotFound"});try{await this.ssoProvisioningStoreUpdater.reset();const r=await this.fetchInitialStateInfo(e);if((0,p.hx)(r))return r;const{teamStatus:s,teamInfo:i,provisioningKey:o,capabilities:a,currentTeamDevice:n}=r.data;if(!i.uuid)return(0,p.Rn)({tag:"TeamIdNotFound"});let c;try{c=((e,t,r,s)=>{if(!r)return f.s5.enum.None;if(s&&r.platform===z.enum.sso_connector)return f.s5.enum.SsoConnectorToSelfHostedMigration;if(!t&&r.platform===z.enum.nitro_encryption_service)return f.s5.enum.None;switch(r.platform){case z.enum.sso_connector:return e?f.s5.enum.SsoConnectorComplete:f.s5.enum.SsoConnectorIncomplete;case z.enum.encryption_service:return e?f.s5.enum.SelfHostedComplete:f.s5.enum.SelfHostedIncomplete;case z.enum.nitro_encryption_service:return e?f.s5.enum.NitroComplete:f.s5.enum.NitroIncomplete}throw new Error("Invalid SSO state reached")})(i.ssoEnabled,i.ssoIsNitroProvider,n,!!await this._shouldUseSSOMigration())}catch{return(0,p.Rn)({tag:"InvalidSsoState"})}const d=Object.keys(s.idps)[0]??null;return await this.ssoProvisioningStoreUpdater.set({global:{adminProvisioningKey:o??null,isTeamProvisionedInNitro:!!o,ssoIsNitroProvider:i.ssoIsNitroProvider,inferredSsoState:c,ssoCapable:a.sso,teamUuid:i.uuid},idpApplication:{acsUrl:(t=this.enclaveService.getEnclaveApiSettings().enclaveUrl,t?`${new URL(t).origin}/saml/callback`:""),entityId:"dashlane-nitro-sso",signOnUrl:"https://app.dashlane.com"},idpMetadata:{idpUuid:d,metadataValue:i.ssoIdpMetadata??null,groupProvisioningActivated:d?s.idps[d].groupProvisioningActivated??null:null},domainSetup:this.getDomainSetupState(s.domains),domainVerificationInfo:this.getDomainVerificationInfo(s.domains),enableSSO:{ssoEnabled:i.ssoEnabled}}),(0,p.Vp)(void 0)}catch(e){return this.appLogger.error(e),(0,p.Rn)({tag:"GenericSsoError"})}var t}async fetchInitialStateInfo(e){const t=[(0,M.B)(e,this.carbonLegacyClient.queries.carbonState),(0,le.I)(this.carbonLegacyClient),q(this.carbonLegacyClient)],[r,s,i]=await Promise.all(t);if((0,p.hx)(s))return s;let o=this.makeGetTeamDecryptedResponse();const{teamInfo:a,capabilities:n}=s.data;r&&a.uuid&&(o=await this.performGetTeam(r,a.uuid));const c=this.extractCapabilities(n);return(0,p.Vp)({provisioningKey:r,teamInfo:a,teamStatus:o,capabilities:c,currentTeamDevice:i})}getDomainSetupState(e){return Object.entries(e).map((([e,t])=>({domainName:e,verificationStatus:t.dnsCheckStatus.status??"pending"})))}getDomainVerificationInfo(e){return Object.entries(e).reduce(((e,[t,r])=>(e[t]={txtValue:r.dnsCheckStatus.verificationToken,verificationStatus:f.X5.parse(r.dnsCheckStatus.status),subdomainValue:R,pendingReason:r.dnsCheckStatus.pendingReason,tokenFound:null},e)),{})}makeGetTeamDecryptedResponse(){return{domains:{},idps:{},updateDateUnix:0,messageIntegrations:{slackStatus:!1}}}fixTeamStatusDomains(e,t,r){const s=Object.values(e.idps);if(s.length<=1)return Promise.resolve(e);const i=s.sort(((e,t)=>e.updateDateUnix-t.updateDateUnix)).pop();return i?(Object.values(e.domains).reduce(((e,s)=>s.idpUuid!==i.idpUuid?e.then((()=>{return(e=this.enclaveService,o={domainName:s.domainName,adminProvisioningKey:t,teamUuid:r,idpUuid:i.idpUuid},e.callEnclaveEndpoint({endpoint:l.DOMAINS_UPDATE_DOMAIN,body:o,responseSchema:ce})).then((()=>(s.idpUuid=i.idpUuid,Promise.resolve())));var e,o})):Promise.resolve()),Promise.resolve()),s.reduce(((e,s)=>i.idpUuid!==s.idpUuid?e.then((()=>{return e=this.enclaveService,i={teamUuid:r,adminProvisioningKey:t,idpUuid:s.idpUuid},e.callEnclaveEndpoint({body:i,endpoint:l.IDPS_DELETE_IDP,responseSchema:de});var e,i})).then((()=>Promise.resolve())):Promise.resolve()),Promise.resolve()),e.idps={[i.idpUuid]:i},Promise.resolve(e)):Promise.resolve(e)}async performGetTeam(e,t){const r=await(0,G.z)(this.enclaveClient.queries.getTeam({adminProvisioningKey:e,teamUuid:t}));if((0,p.hx)(r))throw new Error("InitSsoProvisioning: "+r.error);return await this.fixTeamStatusDomains(r.data,e,t)}extractCapabilities(e){return Object.entries(e).reduce(((e,[t,r])=>({...e,[t]:r.enabled})),{})}_shouldUseSSOMigration(){return this._getFeatureFlip(ae.w.ItadminTacEncryptionserviceSSOmigrationReset)}_getFeatureFlip(e){const{userFeatureFlips:t}=this.featureFlipsClient.queries;return(0,G.z)(t().pipe((0,ue.U)((t=>{if((0,p.d6)(t)){return(0,p.db)(t)[e]}}))))}};pe=(0,s.__decorate)([(0,u.W)(ne.S),(0,s.__metadata)("design:paramtypes",[y.d,P,F.t,_._,E.P,oe.V])],pe);var me=r(66012);let he=class{constructor(e){this.carbonLegacy=e}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,r=await(async(e,t)=>{if(null===t)return;const r=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});return(0,p.d6)(r)?void 0:O.parse(r.error).error})(t,e.metadata);return r?(0,p.Rn)({tag:r}):(0,p.Vp)(void 0)}};he=(0,s.__decorate)([(0,u.W)(me.l),(0,s.__metadata)("design:paramtypes",[_._])],he);var ge=r(82249),ve=r(64532);h.z.object({teamUuid:h.z.string().uuid(),adminProvisioningKey:h.z.string(),idpMetadata:h.z.object({certificates:h.z.array(h.z.string()),entrypoint:h.z.string()})});const _e=h.z.object({idpUuid:h.z.string().uuid()}),ye=(h.z.object({teamUuid:h.z.string().uuid(),adminProvisioningKey:h.z.string(),idpMetadata:h.z.object({idpUuid:h.z.string(),certificates:h.z.array(h.z.string()),entrypoint:h.z.string()})}),h.z.object({})),Se=(h.z.object({idpUuid:h.z.string().uuid()}),async(e,t)=>{const{updateTeamSettings:r}=e.commands;await r({...t})});let Ee=class{constructor(e,t,r,s,i,o,a){this.enclaveService=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=s,this.ssoProvisioningStore=i,this.carbon=o,this.ssoClient=a}async execute({body:e}){try{await this.setupConfidentialTeam()}catch{return(0,p.Rn)({tag:"setup_confidential_team_failed"})}const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:r,teamUuid:s}=t.global;if(!r||!s)return(0,p.Rn)({tag:"internal_error"});const{metadata:i}=e;let o="",a="";try{const e=await T(this.carbon,i);a=e.samlIdpEntryPoint,o=e.samlIdpCertificate}catch{return(0,p.Rn)({tag:"invalid_metadata_content"})}try{const e=t.idpMetadata.idpUuid,n={adminProvisioningKey:r,teamUuid:s,idpMetadata:{certificates:[o],entrypoint:a}},c=e?await(async(e,t)=>(await e.callEnclaveEndpoint({endpoint:l.IDPS_UPDATE_IDP,body:t,responseSchema:ye}),{idpUuid:t.idpMetadata.idpUuid}))(this.enclaveService,{...n,idpMetadata:{...n.idpMetadata,idpUuid:e}}):await((e,t)=>e.callEnclaveEndpoint({endpoint:l.IDPS_CREATE_IDP,body:t,responseSchema:_e}))(this.enclaveService,n);await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,idpUuid:c.idpUuid,metadataValue:i}});try{await Se(this.carbon,{ssoIdpMetadata:i,ssoIdpEntrypoint:a})}catch(e){return(0,p.Rn)({tag:"save_metadata_failed"})}}catch(e){return(0,p.Rn)({tag:"domain_update_failed"})}return(0,p.Vp)(void 0)}async setupConfidentialTeam(){const{global:e}=await this.ssoProvisioningStore.getState(),{ssoIsNitroProvider:t,adminProvisioningKey:r}=e;return r&&t||await this.ssoClient.commands.createTeam(),(0,p.Vp)(void 0)}};Ee=(0,s.__decorate)([(0,u.W)(ge.o),(0,s.__metadata)("design:paramtypes",[y.d,se.N6,ee.t,P,w.M,_._,ve.E])],Ee);var fe=r(85355);const Ae=h.z.object({previousStatus:h.z.string(),status:h.z.enum(["valid","pending","expired","invalid"]),verificationToken:h.z.string(),lastCheckDateUnix:h.z.number(),pendingReason:h.z.enum(["tokenNotFound","invalidToken"]).nullable(),tokenFound:h.z.string().optional()});let Ie=class{constructor(e,t,r,s){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlips=s}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r},domainVerificationInfo:s,domainSetup:i}=t,o=e.body.domainName;if(!r)return(0,p.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!o)return(0,p.Rn)({tag:"DomainNameNotProvided"});let a;try{a=await(n=this.enclaveService,c={domainName:o,adminProvisioningKey:r,teamUuid:t.global.teamUuid??""},n.callEnclaveEndpoint({endpoint:l.DOMAINS_CHECK_DNS_VALIDATION,body:c,responseSchema:Ae}))}catch{return(0,p.Rn)({tag:"CouldNotVerifyDns"})}var n,c;const d=s[o];d.txtValue=a.verificationToken,d.verificationStatus=a.status,d.tokenFound=a.tokenFound??null,d.pendingReason=a.pendingReason;const u=i.map((e=>(e.domainName===o&&(e.verificationStatus=a.status),e)));return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:u,domainVerificationInfo:{...s,[o]:d}}),(0,p.Vp)(void 0)}};Ie=(0,s.__decorate)([(0,u.W)(fe.o),(0,s.__metadata)("design:paramtypes",[y.d,P,w.M,E.P])],Ie);var Oe=r(39118);let be=class{constructor(e,t,r){this.ssoProvisioningStoreUpdater=e,this.ssoProvisioningStore=t,this.carbonLegacy=r}async execute(){const e=await this.ssoProvisioningStore.getState();if(e.enableSSO.ssoEnabled)return(0,p.Rn)({tag:"SsoAlreadyEnabled"});const{commands:{carbon:t}}=this.carbonLegacy,r=await(async(e,{ssoEnabled:t})=>{const r=await e({name:"updateTeamSettings",args:[{ssoEnabled:t}]});return!(0,p.hx)(r)})(t,{ssoEnabled:!0});return r?(await this.ssoProvisioningStore.set({...e,global:{...e.global,inferredSsoState:f.s5.enum.NitroComplete},enableSSO:{...e.enableSSO,ssoEnabled:!0}}),(0,p.Vp)(void 0)):(0,p.Rn)({tag:"EnableSsoFailed"})}};be=(0,s.__decorate)([(0,u.W)(Oe.F),(0,s.__metadata)("design:paramtypes",[P,w.M,_._])],be);var Te=r(26758);const Ce=h.z.object({});var we=r(81459);let Re=class extends we.f{};Re=(0,s.__decorate)([(0,C.GS)()],Re);let Pe=class{constructor(e,t,r,s,i,o){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.appLogger=s,this.carbon=i,this.eventEmitter=o}async execute({body:{teamId:e}}){const t=await this.ssoProvisioningStore.getState(),r=await(0,M.B)(e,this.carbon.queries.carbonState);let s=null;const i=await(0,le.I)(this.carbon);if((0,p.d6)(i)&&i.data.teamInfo.uuid&&(s=i.data.teamInfo.uuid),!s)return this.appLogger.error((0,p.Rn)({tag:"TeamIdNotFound"})),(0,p.Rn)({tag:"TeamIdNotFound"});if(!r)return this.appLogger.error((0,p.Rn)({tag:"NitroTeamNotProvisioned"})),(0,p.Rn)({tag:"NitroTeamNotProvisioned"});try{await this.deleteCurrentTeam({...t,global:{...t.global,adminProvisioningKey:r,teamUuid:s}})}catch(e){const{message:t}=e;if("TEAM_NOT_FOUND"!==t&&"UNKNOWN_ERROR"!==t&&"MISMATCHING_ADMIN_PROVISIONING_KEY"!==t)return this.appLogger.error((0,p.Rn)({tag:"CouldNotDeleteNitroTeam"})),(0,p.Rn)({tag:"CouldNotDeleteNitroTeam"})}const o=await this.removeAdmingProvisioningKey();if((0,p.hx)(o))return this.appLogger.error(o),o;const a=await this.clearLegacyTeamSettings();return(0,p.hx)(a)?(0,p.Rn)({tag:"CouldNotClearLegacyTeamSettings"}):(await this.ssoProvisioningStoreUpdater.reset(),this.eventEmitter.sendEvent("confidentialSsoSettingsReset",void 0),(0,p.Vp)(void 0))}async deleteCurrentTeam(e){const{global:t}=e;if(!t.adminProvisioningKey)return(0,p.Rn)({tag:"NitroTeamNotProvisioned"});const r={teamUuid:t.teamUuid,adminProvisioningKey:t.adminProvisioningKey};var s,i;return await(s=this.enclaveService,i=r,s.callEnclaveEndpoint({endpoint:l.TEAMS_DELETE_TEAM,body:i,responseSchema:Ce})),(0,p.Vp)(void 0)}async clearLegacyTeamSettings(){try{await Se(this.carbon,{ssoServiceProviderUrl:null,ssoIdpMetadata:null,ssoIdpEntrypoint:null,ssoEnabled:!1})}catch{return(0,p.Rn)({tag:"CouldNotClearLegacyTeamSettings"})}return(0,p.Vp)(void 0)}async removeAdmingProvisioningKey(){try{const{removeAdminProvisioningKey:e}=this.carbon.commands;await e()}catch{return(0,p.Rn)({tag:"CouldNotDeleteAdminProvisioningKey"})}return(0,p.Vp)(void 0)}};Pe=(0,s.__decorate)([(0,u.W)(Te.h),(0,s.__metadata)("design:paramtypes",[y.d,P,w.M,oe.V,_._,Re])],Pe);var De=r(26250);const Ne=h.z.object({});let Ue=class{constructor(e,t,r){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r}async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:r,teamUuid:s}=t.global;if(!r||!s)return(0,p.Rn)((0,De.Y3)());const{groupProvisioningActivated:i}=e;try{await this.enclaveService.callEnclaveEndpoint({endpoint:l.IDPS_UPDATE_IDP,body:{adminProvisioningKey:r,teamUuid:s,idpMetadata:{idpUuid:t.idpMetadata.idpUuid,groupProvisioningActivated:i}},responseSchema:Ne}),await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,groupProvisioningActivated:i}})}catch(e){switch(e.message){case De.hJ.MISMATCHING_ADMIN_PROVISIONING_KEY:return Promise.reject((0,p.Rn)((0,De.HC)()));case De.hJ.TEAM_NOT_FOUND:return Promise.reject((0,p.Rn)((0,De.gY)()));case De.hJ.IDP_NOT_FOUND:return Promise.reject((0,p.Rn)((0,De.B3)()));case De.hJ.NO_IDP_CONFIGURATION_UPDATE:return Promise.reject((0,p.Rn)((0,De.b2)()));default:return Promise.reject((0,p.Rn)((0,De.Y3)()))}}return(0,p.Vp)(void 0)}};Ue=(0,s.__decorate)([(0,u.W)(De.Z5),(0,s.__metadata)("design:paramtypes",[y.d,P,w.M])],Ue);var Fe=r(20754),Me=r(73774),Le=r(1434);let Ge=class{constructor(e,t){this.httpClient=e,this.ssoProvisioningStore=t}execute(){return this.ssoProvisioningStore.state$.pipe((0,ue.U)((e=>(0,p.Vp)(e))))}};Ge=(0,s.__decorate)([(0,Fe.e)(Le._),(0,s.__metadata)("design:paramtypes",[Me.e,w.M])],Ge);var Ke=r(21589);let xe=class{constructor(e){this.ssoProvisioningStore=e}execute(){return this.ssoProvisioningStore.state$.pipe((0,ue.U)((e=>(0,p.Vp)({groupProvisioningActivated:e.idpMetadata.groupProvisioningActivated??!1}))))}};xe=(0,s.__decorate)([(0,Fe.e)(Ke.$),(0,s.__metadata)("design:paramtypes",[w.M])],xe);let ke=class{};ke=(0,s.__decorate)([(0,i.Yl)({api:n.y,handlers:{commands:{loginUserWithEnclaveSSO:S,provisionDomain:N,createTeam:K,migrateToConfidentialSso:$,deleteDomain:J,testLoginUserWithEnclaveSSO:ie,initSsoProvisioning:pe,validateMetadata:he,updateMetadata:Ee,checkDNSValidation:Ie,enableSso:be,clearSettings:Pe,updateGroupProvisioningConfiguration:Ue},events:{},queries:{ssoProvisioning:Ge,getGroupProvisioningConfiguration:xe}},configurations:{enclaveLoginContextInfrastructure:{token:d}},imports:[o.X,a.i,c.E],exports:[w.M],stores:[w.M],providers:[P,Re],requiredFeatureFlips:["itadmin_tac_encryptionservice_SSOmigration_reset","setup_rollout_reset_confidential_button","setup_rollout_web_ssoconnector_card","setup_rollout_confidential_migration"]})],ke)},77042:(e,t,r)=>{r.d(t,{M:()=>d});var s=r(25029),i=r(33258),o=r(95681),a=r(23347);const n=e=>i.JU.safeParse(e).success,c={global:{adminProvisioningKey:null,teamUuid:null,ssoIsNitroProvider:null,isTeamProvisionedInNitro:null,inferredSsoState:i.s5.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};class d extends((0,o.Q)({persist:!1,capacity:a.Y._010KB,initialValue:c,scope:s.F.User,storeName:"nitro-sso-provisioning-state",storeTypeGuard:n})){}},26667:(e,t,r)=>{r.d(t,{X:()=>g});var s=r(7165),i=r(56773),o=r(37298),a=r(2235),n=r(45599),c=r(31460),d=r(72733),l=r(24715),u=r(61222),p=r(92204),m=r(49259);const h=s.z.object({type:s.z.string(),saml:s.z.string()});class g{constructor(){this.interceptedTabId=void 0,this.originalTabId=void 0,this.samlReceived=!1;try{this.onMessageListener=new o.j(a.p,this.checkMessageType.bind(this))}catch{}}checkMessageType(e){return!this.samlReceived&&"SamlAssertionIntercepted"===e.type}interceptSamlFromTab(){return new Promise(((e,t)=>{if(!this.onMessageListener)return t(new Error("OnMessage event listener is not available in current context"));const r=n.$.addListener((e=>{e===this.interceptedTabId&&(n.$.removeListener(r),t(new Error("Intercepting SAML - tab closed unexpectedly")))}));this.onMessageListener.events$.pipe((0,i.P)()).subscribe((([s])=>{const i=h.safeParse(s);i.success?(this.samlReceived=!0,n.$.removeListener(r),e({samlToken:i.data.saml})):t(new Error("Intercepting SAML - received message could not be parsed"))}))}))}async redirectTabToUrl(e){if(this.interceptedTabId)return await(0,c.V)(this.interceptedTabId,{url:e});{const t=(await(0,d.T)({windowTypes:["normal"]})).id;return await(0,l.U)({windowId:t,url:e})}}async getActiveExtensionTabId(){const e=await(0,u.I)({currentWindow:!0,active:!0}),t=e.length>0?e[0]:null,r=(0,p.A)("");if(t?.id&&t.url?.includes(r))return t.id}getSamlFromLogin(e,t,r){this.samlReceived=!1,this.originalTabId=void 0,this.interceptedTabId&&((0,m.O)([this.interceptedTabId]),this.interceptedTabId=void 0);const s=async(t=!0)=>{const r=await(0,l.U)({url:e,active:t});return this.interceptedTabId=r.id,await this.interceptSamlFromTab()},i=async t=>{this.interceptedTabId=t;const r=this.interceptSamlFromTab();return await(0,c.V)(t,{url:e}),r};return t?this.getActiveExtensionTabId().then((e=>e?i(e):s(r))):this.getActiveExtensionTabId().then((e=>(this.originalTabId=e,s(r))))}async redirectUserIntoLoginFlow(e){const t={ssoToken:e.ssoToken,exists:e.exists,currentAuths:e.currentAuthenticationMethods,expectedAuths:e.expectedAuthenticationMethods,key:e.userServiceProviderKey,login:e.login},r=Object.entries(t).map((e=>`${e[0]}=${encodeURIComponent(e[1].toString())}`)).join("&"),s=(0,p.A)(`index.html#/sso?${r}`);await this.redirectTabToUrl(s)}async redirectUserToLoginPage(){const e=(0,p.A)("index.html#/login");await this.redirectTabToUrl(e)}async cleanupTestLogin(){this.interceptedTabId&&await(0,m.O)([this.interceptedTabId]),this.originalTabId&&(0,c.V)(this.originalTabId,{active:!0})}}},78443:(e,t,r)=>{r.d(t,{j:()=>I});var s=r(86952),i=r(22692),o=r(64261),a=r(97236),n=r(20715),c=r(88254),d=r(92043),l=r(31848),u=r(85986),p=r(22463),m=r(4842),h=r(92350),g=r(21382),v=r(38443),_=r(33608),y=r(37240),S=r(31856),E=r(74062),f=r(92253),A=r(74564);const I=(0,s.Q)({name:"accountRecoveryKey",commands:{goToActivationNextStep:i.Z,goToActivationPrevStep:o.H,requestActivation:a.e,resetActivationFlow:n.W,cancelGeneration:c.r,confirmActivation:d.W,confirmNewPassword:l.v,deactivate:u.E,submitRecoveryKey:p.Y,tryAgainRecovery:m.d,cancelRecoveryFlow:h.b,startRecoveryFlow:g.Q,clearWrongRecoveryKeyError:v.u,createPin:_.f,submitPin:y.W},queries:{activationFlowStatus:S.S,accountRecoveryKeyStatus:E.D,recoveryFlowStatus:f.y,recoveryMethodsInfo:A.V},events:{}})},88254:(e,t,r)=>{r.d(t,{r:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},92350:(e,t,r)=>{r.d(t,{b:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},38443:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},92043:(e,t,r)=>{r.d(t,{W:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},31848:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},33608:(e,t,r)=>{r.d(t,{f:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},85986:(e,t,r)=>{r.d(t,{E:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},22692:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},64261:(e,t,r)=>{r.d(t,{H:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},97236:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},20715:(e,t,r)=>{r.d(t,{W:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},21382:(e,t,r)=>{r.d(t,{Q:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},37240:(e,t,r)=>{r.d(t,{W:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},22463:(e,t,r)=>{r.d(t,{Y:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},4842:(e,t,r)=>{r.d(t,{d:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},74062:(e,t,r)=>{r.d(t,{D:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},31856:(e,t,r)=>{r.d(t,{S:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},92253:(e,t,r)=>{r.d(t,{y:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},74564:(e,t,r)=>{r.d(t,{V:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},14148:(e,t,r)=>{r.d(t,{D:()=>Pt});var s=r(88802),i=r(78443),o=r(11433),a=r(99634),n=r(38679),c=r(9671),d=r(93850),l=r(37935),u=r(90904),p=r(8362),m=r(87065),h=r(25029),g=r(95681);const v=e=>!0;class _ extends((0,g.Q)({initialValue:void 0,persist:!1,scope:h.F.Device,storeName:"activation-flow-machine",storeTypeGuard:v})){}var y=r(23347);const S=e=>!(!e||"object"!=typeof e)&&"isEnabled"in e;class E extends((0,g.Q)({initialValue:{isEnabled:void 0,login:void 0},persist:!1,scope:h.F.Device,storeName:"account-recovery-key",storeTypeGuard:S,capacity:y.Y._001KB})){}const f=e=>!0;class A extends((0,g.Q)({initialValue:void 0,persist:!1,scope:h.F.Device,storeName:"recovery-flow-machine",storeTypeGuard:f})){}var I=r(78065),O=r(24966),b=r(57924),T=r(53446),C=r(37294),w=r(65865),R=r(18275),P=r(87279);var D,N=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.NETWORK_ERROR="NETWORK_ERROR",e.PIN_MISMATCH_ERROR="PIN_MISMATCH_ERROR",e.INITIALIZE_MACHINE_ERROR="INITIALIZE_MACHINE_ERROR",e.WRONG_RECOVERY_KEY_ERROR="WRONG_RECOVERY_KEY_ERROR",e.CHANGE_MASTER_PASSWORD_ERROR="CHANGE_MASTER_PASSWORD_ERROR"}(D||(D={}));class U extends((0,N.Hu)("NETWORK_ERROR","There is an issue with your connection")){}var F=r(48038),M=r(60399),L=r(41842),G=r(86252),K=r(87113),x=r(48844),k=r(18533),j=r(20195);const V=["email_token","totp","duo_push","dashlane_authenticator"],W=e=>"object"==typeof e&&"type"in e;class B{getAuthTicketInfo(){const{carbonState:e}=this.carbon.queries;return(0,M.z)(e({path:"userSession.authTicketInfo"}).pipe((0,x.nb)({success:e=>e,failure:()=>{throw new Error("Failure getting auth ticket info")}})))}retrieveLocalAccounts(){const{carbonState:e}=this.carbon.queries;return(0,M.z)(e({path:"authentication.localAccounts"}).pipe((0,L.h)(P.d6),(0,L.h)((e=>e.data.accountsListInitialized)),(0,m.U)((e=>e.data.accountsList))))}async getCurrentPersonalSettings(){const{carbonStateList:e}=this.carbon.queries;return await(0,M.z)(e({paths:["userSession.personalSettings.AccountRecoveryKey","userSession.personalSettings.AccountRecoveryKeyId"]}).pipe((0,x.nb)({success:([e,t])=>({AccountRecoveryKey:e,AccountRecoveryKeyId:t}),failure:()=>{throw new Error("Failure getting state list")}})))}getLastAuthenticatedUserRecoveryData(){return this.store.state$.pipe((0,m.U)((e=>({isEnabled:e.isEnabled,login:e.login}))))}async updateLastAuthenticatedUserRecoveryStatus(e){if(!e)throw new Error("No user login provided");const t=await(0,M.z)(this.serverApiClient.v1.accountrecovery.getStatus({login:e}));if((0,P.hx)(t))throw new Error("Server call failed");await this.store.set({isEnabled:t.data.data.enabled,login:e})}async generateRecoveryKey(){const{carbon:e}=this.carbon.commands,t={length:28,digits:!0,letters:!0,avoidAmbiguous:!0,symbols:!1};return await e({name:"generatePassword",args:[{settings:t}]})}async setPersonalSettings(e){const{carbon:t}=this.carbon.commands;return await t({name:"updateAccountRecoveryKeyPersonalSettings",args:[e]})}async getAccountInfo(e){return await(0,M.z)(this.serverApiClient.v1.authentication.getAuthenticationMethodsForDevice({login:e,methods:V}).pipe((0,x.DZ)((e=>(0,k.EQ)(e,{BusinessError:()=>{throw new Error(D.GENERIC_ERROR)},FetchFailedError:()=>new U,InternalServerError:j.j,InvalidRequest:j.j,RateLimited:j.j,ServiceUnavailable:j.j,UnspecifiedBadStatus:j.j}))),(0,x.lk)((e=>{const t=e.data.verifications.find(W);if(t)return(0,P.Vp)({verificationMethod:t,accountType:e.data.accountType});throw new Error("Unsupported authentication method")}))))}async requestActivation(e){return await(0,M.z)(this.serverApiClient.v1.accountrecovery.requestActivation({encryptedVaultKey:e}).pipe((0,x.DZ)((e=>(0,k.EQ)(e,{BusinessError:()=>{throw new Error(D.GENERIC_ERROR)},FetchFailedError:()=>new U,UnspecifiedBadStatus:j.j,InternalServerError:j.j,InvalidRequest:j.j,RateLimited:j.j,ServiceUnavailable:j.j}))),(0,x.lk)((e=>{if(e.data.recoveryId)return(0,P.Vp)(e.data.recoveryId);throw new Error(D.GENERIC_ERROR)}))))}async confirmActivation(e){return await(0,M.z)(this.serverApiClient.v1.accountrecovery.confirmActivation({recoveryId:e}).pipe((0,x.DZ)((e=>(0,k.EQ)(e,{BusinessError:()=>{throw new Error(D.GENERIC_ERROR)},FetchFailedError:()=>new U,UnspecifiedBadStatus:j.j,InternalServerError:j.j,InvalidRequest:j.j,RateLimited:j.j,ServiceUnavailable:j.j}))),(0,x.lk)((()=>(0,P.Vp)(void 0)))))}async deactivate(e){return await(0,M.z)(this.serverApiClient.v1.accountrecovery.deactivate({reason:e}).pipe((0,x.DZ)((e=>(0,k.EQ)(e,{BusinessError:()=>{throw new Error(D.GENERIC_ERROR)},FetchFailedError:()=>new U,UnspecifiedBadStatus:j.j,InternalServerError:j.j,InvalidRequest:j.j,RateLimited:j.j,ServiceUnavailable:j.j}))),(0,x.lk)((()=>(0,P.Vp)(void 0)))))}async getEncryptedVaultKey(e,t){return await(0,M.z)(this.serverApiClient.v1.accountrecovery.getEncryptedVaultKey({login:e,authTicket:t}).pipe((0,x.DZ)((e=>(0,k.EQ)(e,{BusinessError:()=>{throw new Error(D.GENERIC_ERROR)},FetchFailedError:()=>new U,UnspecifiedBadStatus:j.j,InternalServerError:j.j,InvalidRequest:j.j,RateLimited:j.j,ServiceUnavailable:j.j}))),(0,x.lk)((e=>{const{encryptedVaultKey:t,recoveryId:r}=e.data;if(t&&r)return(0,P.Vp)({encryptedVaultKey:t,recoveryId:r});throw new Error(D.GENERIC_ERROR)}))))}constructor(e,t,r){this.store=e,this.serverApiClient=t,this.carbon=r}}B=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===E?Object:E,void 0===K.l?Object:K.l,void 0===G._?Object:G._])],B);class z{async execute(){try{const e=await(0,M.z)(this.recoveryKeyService.getLastAuthenticatedUserRecoveryData());return Promise.resolve({isFeatureEnabled:e.isEnabled,recoveryKey:"",recoveryId:"",encryptedVaultKey:""})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}constructor(e){this.recoveryKeyService=e}}z=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B])],z);var H=r(54066),Y=r(10370),Q=r(89685),q=r(56268),$=r(7502),X=r(94805),Z=r(16698);class J{makeDerivationConfig(e){const[,,t]=e.split("$");return"pbkdf2"===t?X.E1:X.mr}async getUserCryptoConfig(){const{carbonStateList:e}=this.carbon.queries;return await(0,M.z)(e({paths:["userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,x.nb)({success:([e,t])=>{if("string"!=typeof e)throw new Error("Fixed salt is not a string");if("string"!=typeof t)throw new Error("Marker is not a string");return{fixedSalt:e,derivationConfig:this.makeDerivationConfig(t)}},failure:()=>{throw new Error("Failure getting state list")}})))}async getUserMasterPassword(){const{carbonState:e}=this.carbon.queries;return await(0,M.z)(e({path:"userSession.session.masterPassword"}).pipe((0,m.U)((e=>{if(!(0,P.d6)(e))throw new Error("Error when fetching master password from session");const t=e.data;if("string"!=typeof t)throw new Error("Result data is not a string");return(new TextEncoder).encode(t)}))))}async encrypt(e){const t=await this.getUserMasterPassword(),{derivationConfig:r,fixedSalt:s}=await this.getUserCryptoConfig();return await this.flexibleEncryptor.encrypt(e,t,r,Z.Nw,{salt:(0,$.R)(s)})}constructor(e,t){this.carbon=e,this.flexibleEncryptor=t}}J=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G._?Object:G._,void 0===q._?Object:q._])],J);class ee{async executeWithParams(e){if(e.recoveryKey)return(0,P.Vp)({recoveryKey:e.recoveryKey,encryptedVaultKey:e.encryptedVaultKey,recoveryId:e.recoveryId});const t=await this.accountRecoveryKeyService.generateRecoveryKey();if((0,P.hx)(t))return(0,P.Rn)({tag:D.GENERIC_ERROR});const r=(0,H.u)(t.data.carbonResult.password.toUpperCase()),s=await this.recoveryKeyEncryptor.encrypt(r),i=(0,Y.s)(s),o=await this.accountRecoveryKeyService.requestActivation(i);return(0,P.hx)(o)?(0,P.Rn)({tag:o.error.tag}):(0,P.Vp)({recoveryKey:(0,Q.v)(r),encryptedVaultKey:i,recoveryId:o.data})}constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyEncryptor=t}}ee=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B,void 0===J?Object:J])],ee);var te=r(21877),re=r(90993),se=r(89358);class ie{async executeWithParams(e,t){const r=await this.accountRecoveryKeyService.getCurrentPersonalSettings(),s={AccountRecoveryKey:e,AccountRecoveryKeyId:t};if(await this.accountRecoveryKeyService.setPersonalSettings(s),(0,P.hx)(await this.syncService.waitForSync(te.Trigger.SettingsChange)))return await this.accountRecoveryKeyService.setPersonalSettings(r),(0,P.Rn)({tag:D.GENERIC_ERROR});const i=await this.accountRecoveryKeyService.confirmActivation(t);if((0,P.hx)(i))return await this.accountRecoveryKeyService.setPersonalSettings(r),(0,P.hx)(await this.syncService.waitForSync(te.Trigger.SettingsChange))?(0,P.Rn)({tag:D.GENERIC_ERROR}):(0,P.Rn)({tag:i.error.tag});const o=await(0,M.z)(this.session.queries.selectedOpenedSession());if(!(0,P.d6)(o)||!o.data)throw new Error("No users logged in");return await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(o.data),Promise.resolve((0,P.Vp)(void 0))}constructor(e,t,r){this.accountRecoveryKeyService=e,this.syncService=t,this.session=r}}ie=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B,void 0===re._?Object:re._,void 0===se.x?Object:se.x])],ie);class oe{desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"ActivationFlowMachine",context:{isFeatureEnabled:!1,recoveryKey:"",recoveryId:"",encryptedVaultKey:""},states:{Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"InitAccountRecoveryKeyActivation",cond:"isActivationFlow"},{actions:["assignInitialContext"],target:"GenerateNewAccountRecoveryKey"}]}},InitAccountRecoveryKeyActivation:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"}}},RequestingActivation:{invoke:{src:"requestActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{actions:["assignKeys"],target:"DisplayAccountRecoveryKey"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},DisplayAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"ConfirmAccountRecoveryKey"}}},ConfirmAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"FinalisingAccountRecoveryKeyActivation"},GO_TO_PREV_STEP:{target:"DisplayAccountRecoveryKey"}}},FinalisingAccountRecoveryKeyActivation:{invoke:{src:"confirmActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{target:"AccountRecoveryKeyActivationDone"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},AccountRecoveryKeyActivationDone:{},GenerateNewAccountRecoveryKey:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"},CANCEL_GENERATION:{target:"CancelNewAccountRecoveryKey"}}},CancelNewAccountRecoveryKey:{on:{GO_TO_PREV_STEP:{target:"GenerateNewAccountRecoveryKey"}}},AccountRecoveryKeyActivationError:{on:{GO_TO_PREV_STEP:{target:"RequestingActivation"}}}},on:{RESET_FLOW:{actions:["clearContext"],target:"Starting"}}},options:{actions:{assignInitialContext:(0,w.f0)({encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryKey:(e,t)=>t.data.recoveryKey,recoveryId:(e,t)=>t.data.recoveryId,isFeatureEnabled:(e,t)=>t.data.isFeatureEnabled}),assignKeys:(0,w.f0)({recoveryKey:(e,t)=>t.data.data.recoveryKey,encryptedVaultKey:(e,t)=>t.data.data.encryptedVaultKey,recoveryId:(e,t)=>t.data.data.recoveryId}),assignFunctionalError:(0,w.f0)({error:(e,t)=>t.data.error.tag}),assignGenericError:(0,w.f0)({error:()=>D.GENERIC_ERROR}),clearContext:(0,w.f0)({encryptedVaultKey:()=>"",recoveryKey:()=>"",recoveryId:()=>"",error:()=>{}})},services:{initializeMachine:()=>this.initializeMachineService.execute(),requestActivation:e=>this.requestActivationService.executeWithParams(e),confirmActivation:e=>this.confirmActivationService.executeWithParams(e.recoveryKey,e.recoveryId)},guards:{isActivationFlow:(e,t)=>function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.Starting")}(t)&&!t.data.isFeatureEnabled,isFunctionalError:(e,t)=>(function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.RequestingActivation")}(t)||function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.FinalisingAccountRecoveryKeyActivation")}(t))&&(0,P.hx)(t.data)}}};return e&&(0,F.G)(t.config),t}create(e=!1){const{config:t,options:r}=this.desc(e);return(0,R.C)(t,r)}constructor(e,t,r){this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=r,this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=r}}oe=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===z?Object:z,void 0===ee?Object:ee,void 0===ie?Object:ie])],oe);class ae{async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?p.ZM.create(JSON.parse(t)):void 0})(this.activationMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Activation] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Activation] Unable to start machine",e)}}ready(){return new O.X(!0)}continue(e){if(!this.interpreter)throw new Error("Activation flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}constructor(e,t,r,s){this.activationMachineStore=r,this.allowedToFail=s,this.activationMachineStore=r;const i=e.create(t);this.interpreter=I.kJ(i).onTransition((0,T.V)((e=>{this.allowedToFail.doOne((()=>{throw e}))}))).onEvent((0,C.V)((e=>{this.allowedToFail.doOne((()=>{throw e}))}))).onTransition((async()=>{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.activationMachineStore,e)}))}}ae=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===oe?Object:oe,Boolean,void 0===_?Object:_,void 0===c.J?Object:c.J])],ae);class ne{async executeWithParams(e){try{const{authTicket:t}=await this.recoveryKeyService.getAuthTicketInfo(),r=await this.recoveryKeyService.getAccountInfo(e);if((0,P.hx)(r))throw new Error("Unable to retrieve verifications methods for login");return Promise.resolve({authTiket:t??"",accountType:r.data.accountType,verificationMethod:r.data.verificationMethod})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}constructor(e){this.recoveryKeyService=e}}ne=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B])],ne);var ce,de,le,ue=r(25594);class pe{async decrypt(e,t){return(new TextDecoder).decode(await this.flexibleDecryptor.decrypt(e,t))}constructor(e){this.flexibleDecryptor=e}}pe=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ue.a?Object:ue.a])],pe);class me{async executeWithParams({login:e,authTicket:t,recoveryKey:r}){try{const s=await this.accountRecoveryKeyService.getEncryptedVaultKey(e,t);if((0,P.hx)(s))return Promise.reject(D.GENERIC_ERROR);const i=(0,H.u)(r),o=(0,$.R)(s.data.encryptedVaultKey),a=await this.recoveryKeyDecryptor.decrypt(i,o);return Promise.resolve({oldPassword:a})}catch(e){return(s=e)instanceof Error&&s.message.includes("Signature cannot be verified")?Promise.reject(D.WRONG_RECOVERY_KEY_ERROR):Promise.reject(D.GENERIC_ERROR)}var s}constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyDecryptor=t}}me=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B,void 0===pe?Object:pe])],me),function(e){e.USER_CHANGING_MP="USER_CHANGING_MP",e.MP_TO_SSO="MP_TO_SSO",e.SSO_TO_MP="SSO_TO_MP",e.TO_EMAIL_TOKEN="EMAIL_TOKEN",e.ADMIN_ASSISTED_RECOVERY="ADMIN_ASSISTED_RECOVERY",e.ACCOUNT_RECOVERY_KEY="ACCOUNT_RECOVERY_KEY"}(ce||(ce={})),function(e){e.FEATURE_BLOCKED="feature_blocked",e.INNACTIVE_SESSION="inactive_session",e.INVALID_TOKEN="invalid_token",e.OTP_PROBLEM="otp_problem",e.MP_ERROR="mp_error",e.MP_STRENGTH_ERROR="mp_strength_error",e.SUCCESS="success",e.SYNC_PROGRESS="sync_in_progress",e.UNKNOWN_ERROR="unknown_error",e.WRONG_PASSWORD="wrong_password",e.UNEXPECTED_STATE="unexpected_state"}(de||(de={})),function(e){e.DOWNLOAD="download",e.DECRYPTING="decrypting",e.ENCRYPTING="encrypting",e.UPLOADING="uploading",e.DONE="done",e.ERROR="error"}(le||(le={}));var he=r(25565);class ge{async executeWithParams(e){const{commands:t}=this.carbon;try{const{cleanRemotelyRemovedProfiles:r,registerDevice:s}=this.deviceRegistration.commands,{localAccounts:i}=this.deviceRegistration.queries;await r();const o=await(0,M.z)(i());if((0,P.hx)(o))return Promise.reject(new Error(`[ARK] - Error while fetching local accounts: ${o.error}`));o.data.localAccounts.some((t=>t.login===e.login))||await s({with:"authTicket",login:e.login,authTicket:e.authTicket});const a=await t.openSessionWithMasterPassword({login:e.login,password:e.oldPassword,rememberPassword:!1,requiredPermissions:void 0,loginType:"ARK"});if((0,P.hx)(a))return Promise.reject(new Error(`[ARK] - Error while trying to open session with deciphered recovery key: ${a.error}`));const n=await t.changeMasterPassword({newPassword:e.newPassword,currentPassword:e.oldPassword,flow:ce.ACCOUNT_RECOVERY_KEY});return(0,P.hx)(n)||!n.data.success?Promise.reject(new Error(`[ARK] - Error while changing user Master Password (${"failure"===n.tag?n.error:""})`)):Promise.resolve(void 0)}catch(e){return Promise.reject(new Error(`[ARK] - Unable to change user Master Password: ${e}`))}}constructor(e,t){this.carbon=e,this.deviceRegistration=t}}ge=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G._?Object:G._,void 0===he.z?Object:he.z])],ge);var ve=r(12436),_e=r(81822);class ye{executeWithParams(e,t){try{return this.identityVerification.commands.startIdentityVerification({login:e,verificationMethod:t.type}),Promise.resolve(void 0)}catch(e){return Promise.reject(new Error("Something went wrong..."))}}constructor(e){this.identityVerification=e,this.identityVerification=e}}ye=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ve||void 0===_e.l?Object:_e.l])],ye);var Se=r(42303),Ee=r(26457);class fe{async executeWithParams(e,t){const r=await this.accountRecoveryKeyService.deactivate(t);return(0,P.hx)(r)?(this.logger.trace("Deactivate ARK: "+r.error.message),(0,P.Rn)({tag:r.error.tag})):(await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(e),this.activationFlow.continue({type:"RESET_FLOW"}),await this.accountRecoveryKeyService.setPersonalSettings({AccountRecoveryKey:void 0,AccountRecoveryKeyId:void 0}),await this.allowedToFail.doOne((async()=>await this.syncService.waitForSync(te.Trigger.SettingsChange)),"waitForSync"),(0,P.Vp)(void 0))}constructor(e,t,r,s,i){this.accountRecoveryKeyService=e,this.activationFlow=t,this.syncService=r,this.logger=s,this.allowedToFail=i}}fe=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B,void 0===ae?Object:ae,void 0===re._?Object:re._,void 0===Ee.V?Object:Ee.V,void 0===c.J?Object:c.J])],fe);class Ae{async executeWithParams(e){const{commands:t,queries:r}=this.carbon;if(e.newPinCode!==e.confirmedPinCode)return Promise.reject(D.PIN_MISMATCH_ERROR);try{const{cleanRemotelyRemovedProfiles:r,registerDevice:s}=this.deviceRegistration.commands,{localAccounts:i}=this.deviceRegistration.queries;await r();const o=await(0,M.z)(i());if((0,P.hx)(o))return Promise.reject(new Error(`[ARK] - Error while fetching local accounts: ${o.error}`));o.data.localAccounts.some((t=>t.login===e.login))||await s({with:"authTicket",login:e.login,authTicket:e.authTicket});const a=await t.openSessionWithMasterPassword({login:e.login,password:e.oldPassword,rememberPassword:!1,requiredPermissions:void 0,loginType:"ARK"});if((0,P.hx)(a))return Promise.reject(new Error(`[ARK] - Error while trying to open session with deciphered recovery key: ${a.error}`));await this.pinCode.commands.activate({pinCode:e.newPinCode});const n=await this.deactivateArk.executeWithParams(e.login,"KEY_USED");return(0,P.hx)(n)?Promise.reject(D.GENERIC_ERROR):Promise.resolve(void 0)}catch(e){const s=await(0,M.z)(r.carbonState({path:"userSession.account.isAuthenticated"}));return(0,P.d6)(s)&&s.data&&await t.carbonLegacyLeeloo({name:"closeSession",arg:[{}]}),Promise.reject(D.GENERIC_ERROR)}}constructor(e,t,r,s){this.carbon=e,this.pinCode=t,this.deactivateArk=r,this.deviceRegistration=s}}Ae=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G._?Object:G._,void 0===Se.u?Object:Se.u,void 0===fe?Object:fe,void 0===he.z?Object:he.z])],Ae);class Ie{desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Idle",id:"RecoveryFlowMachine",context:{login:"",authTicket:"",newPassword:"",recoveryKey:"",oldPassword:"",encryptedVaultKey:"",newPinCode:"",confirmedPinCode:""},states:{Idle:{entry:["clearContext"],on:{START_RECOVERY_FLOW:{target:"Starting",actions:["assignAccountEmail"]}}},Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"IdentityVerification",cond:"isAuthTicketNeeded"},{actions:["assignInitialContext"],target:"EnterRecoveryKey"}]}},IdentityVerification:{entry:["triggerIdentityVerification"]},EnterRecoveryKey:{on:{SUBMIT_RECOVERY_KEY:{actions:["assignRecoveryKey"],target:"CheckAccountRecoveryKey"}}},CheckAccountRecoveryKey:{invoke:{src:"checkAccountRecoveryKey",onDone:[{actions:["assignOldPassword"],cond:"isPasswordlessUser",target:"EnterPin"},{actions:["assignOldPassword"],target:"ChangeMasterPassword"}],onError:[{actions:["assignError"],cond:"isWrongRecoveryKeyError",target:"EnterRecoveryKey"},{actions:["assignError"],target:"CheckAccountRecoveryKeyError"}]}},CheckAccountRecoveryKeyError:{on:{TRY_AGAIN:{actions:["clearError"],target:"EnterRecoveryKey"}}},EnterPin:{on:{CREATE_PIN:{actions:["assignNewPinCode"],target:"ConfirmPin"}}},ConfirmPin:{on:{SUBMIT_PIN:{actions:["assignConfirmedPinCode"],target:"OpenPasswordlessSession"}}},OpenPasswordlessSession:{invoke:{src:"openSession",onDone:{target:"RecoverySuccess"},onError:[{actions:["assignError"],cond:"isPinMismatchError",target:"ConfirmPin"},{actions:["assignError"],target:"ChangeMasterPasswordError"}]}},ChangeMasterPassword:{on:{CONFIRM_NEW_PASSWORD:{actions:["assignNewPassword"],target:"FinalisingRecovery"}}},FinalisingRecovery:{invoke:{src:"changeMasterPassword",onDone:{target:"RecoverySuccess"},onError:{actions:["assignError"],target:"ChangeMasterPasswordError"}}},ChangeMasterPasswordError:{on:{TRY_AGAIN:{target:"ChangeMasterPassword"}}},RecoverySuccess:{type:"final"}},on:{CLEAR_ERROR:{actions:["clearError"]},IDENTITY_VERIFICATION_COMPLETE:{actions:["assignAuthTicket"],target:"EnterRecoveryKey"},CANCEL_RECOVERY_FLOW:{actions:["clearError"],target:"Idle"}}},options:{actions:{assignAccountEmail:(0,w.f0)({login:(e,t)=>t.login}),assignInitialContext:(0,w.f0)({authTicket:(e,t)=>t.data.authTiket,accountType:(e,t)=>t.data.accountType,verificationMethod:(e,t)=>t.data.verificationMethod}),assignAuthTicket:(0,w.f0)({authTicket:(e,t)=>t.authTicket}),assignNewPassword:(0,w.f0)({newPassword:(e,t)=>t.password}),assignRecoveryKey:(0,w.f0)({recoveryKey:(e,t)=>t.recoveryKey}),assignOldPassword:(0,w.f0)({oldPassword:(e,t)=>t.data.oldPassword}),assignNewPinCode:(0,w.f0)({newPinCode:(e,t)=>t.pinCode}),assignConfirmedPinCode:(0,w.f0)({confirmedPinCode:(e,t)=>t.pinCode}),assignError:(0,w.f0)({error:(e,t)=>t.data}),clearError:(0,w.f0)({error:()=>{}}),triggerIdentityVerification:e=>{if(!e.verificationMethod)throw new Error("No verification method found, initialization went wrong");return this.triggerIdentityVerificationService.executeWithParams(e.login,e.verificationMethod)},clearContext:(0,w.f0)({login:()=>"",newPassword:()=>"",localAccounts:()=>[],recoveryKey:()=>"",oldPassword:()=>"",encryptedVaultKey:()=>"",authTicket:()=>""})},services:{initializeMachine:e=>this.initializeMachineService.executeWithParams(e.login),checkAccountRecoveryKey:e=>this.checkAccountRecoveryKeyService.executeWithParams(e),changeMasterPassword:e=>this.changeMasterPasswordService.executeWithParams(e),openSession:e=>this.openSessionPasswordLessService.executeWithParams(e)},guards:{isAuthTicketNeeded:(e,t)=>!t.data.authTiket,isPasswordlessUser:e=>"invisibleMasterPassword"===e.accountType,isWrongRecoveryKeyError:(e,t)=>t.data===D.WRONG_RECOVERY_KEY_ERROR,isPinMismatchError:(e,t)=>t.data===D.PIN_MISMATCH_ERROR}}};return e&&(0,F.G)(t.config),t}create(e=!1){const{config:t,options:r}=this.desc(e);return(0,R.C)(t,r)}constructor(e,t,r,s,i){this.initializeMachineService=e,this.checkAccountRecoveryKeyService=t,this.changeMasterPasswordService=r,this.triggerIdentityVerificationService=s,this.openSessionPasswordLessService=i}}Ie=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ne?Object:ne,void 0===me?Object:me,void 0===ge?Object:ge,void 0===ye?Object:ye,void 0===Ae?Object:Ae])],Ie);class Oe{async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?p.ZM.create(JSON.parse(t)):void 0})(this.recoveryMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Recovery] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Recovery] Unable to start machine",e)}}ready(){return new O.X(!0)}continue(e){if(!this.interpreter)throw new Error("Recovery flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}constructor(e,t,r,s){this.recoveryMachineStore=r,this.allowedToFail=s,this.recoveryMachineStore=r;const i=e.create(t);this.interpreter=I.kJ(i).onTransition((0,T.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onEvent((0,C.V)((e=>this.allowedToFail.doOne((()=>{throw e}))))).onTransition((async()=>{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.recoveryMachineStore,e)}))}}Oe=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ie?Object:Ie,Boolean,void 0===A?Object:A,void 0===c.J?Object:c.J])],Oe);var be=r(55300),Te=r(59894),Ce=r(63663),we=r(22692);class Re{execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.activationFlow=e}}Re=(0,s.__decorate)([(0,Ce.W)(we.Z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],Re);var Pe=r(64261);class De{execute(){return this.activationFlow.continue({type:"GO_TO_PREV_STEP"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.activationFlow=e}}De=(0,s.__decorate)([(0,Ce.W)(Pe.H),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],De);var Ne=r(97236);class Ue{execute(){return this.activationFlow.continue({type:"REQUEST_ACTIVATION"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.activationFlow=e}}Ue=(0,s.__decorate)([(0,Ce.W)(Ne.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],Ue);var Fe=r(20715);class Me{execute(){return this.activationFlow.continue({type:"RESET_FLOW"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.activationFlow=e}}Me=(0,s.__decorate)([(0,Ce.W)(Fe.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],Me);var Le=r(88254);class Ge{execute(){return this.activationFlow.continue({type:"CANCEL_GENERATION"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.activationFlow=e}}Ge=(0,s.__decorate)([(0,Ce.W)(Le.r),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],Ge);var Ke=r(92043);class xe{execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.activationFlow=e}}xe=(0,s.__decorate)([(0,Ce.W)(Ke.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae])],xe);var ke=r(31848);class je{execute(e){return this.recoveryFlow.continue({type:"CONFIRM_NEW_PASSWORD",password:e.body.password}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}je=(0,s.__decorate)([(0,Ce.W)(ke.v),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],je);var Ve=r(85986);class We{async execute(e){const{reason:t}=e.body,r=await this.accountRecoveryKeyService.deactivate(t);if((0,P.hx)(r))return this.logger.trace("Deactivate ARK: "+r.error.message),(0,P.Rn)({tag:r.error.tag});const s=await(0,M.z)(this.session.queries.selectedOpenedSession());return(0,P.hx)(s)||!s.data?(this.logger.trace("Deactivate ARK: No user login provided"),(0,P.Rn)({tag:D.GENERIC_ERROR})):(await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(s.data),this.activationFlow.continue({type:"RESET_FLOW"}),await this.accountRecoveryKeyService.setPersonalSettings({AccountRecoveryKey:void 0,AccountRecoveryKeyId:void 0}),await this.allowedToFail.doOne((async()=>await this.syncService.waitForSync(te.Trigger.SettingsChange)),"waitForSync"),(0,P.Vp)(void 0))}constructor(e,t,r,s,i,o){this.accountRecoveryKeyService=e,this.activationFlow=t,this.syncService=r,this.logger=s,this.allowedToFail=i,this.session=o}}We=(0,s.__decorate)([(0,Ce.W)(Ve.E),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B,void 0===ae?Object:ae,void 0===re._?Object:re._,void 0===Ee.V?Object:Ee.V,void 0===c.J?Object:c.J,void 0===se.x?Object:se.x])],We);var Be=r(22463);class ze{execute(e){return this.recoveryFlow.continue({type:"SUBMIT_RECOVERY_KEY",recoveryKey:e.body.recoveryKey}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.recoveryFlow=e}}ze=(0,s.__decorate)([(0,Ce.W)(Be.Y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],ze);var He=r(4842);class Ye{execute(){return this.recoveryFlow.continue({type:"TRY_AGAIN"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.recoveryFlow=e}}Ye=(0,s.__decorate)([(0,Ce.W)(He.d),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],Ye);var Qe=r(92350),qe=r(94189);class $e{execute(){return this.recoveryFlow.continue({type:"CANCEL_RECOVERY_FLOW"}),this.cqrsClient.getClient(o.i).commands.cancelIdentityVerification(),Promise.resolve((0,P.Vp)(void 0))}constructor(e,t){this.recoveryFlow=e,this.cqrsClient=t,this.recoveryFlow=e}}$e=(0,s.__decorate)([(0,Ce.W)(Qe.b),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe,void 0===qe.w?Object:qe.w])],$e);var Xe=r(21382);class Ze{execute(e){const{login:t}=e.body;return this.recoveryFlow.continue({type:"START_RECOVERY_FLOW",login:t}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}Ze=(0,s.__decorate)([(0,Ce.W)(Xe.Q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],Ze);var Je=r(38443);class et{execute(){return this.recoveryFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.recoveryFlow=e}}et=(0,s.__decorate)([(0,Ce.W)(Je.u),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],et);var tt=r(33608);class rt{execute(e){return this.recoveryFlow.continue({type:"CREATE_PIN",pinCode:e.body.pinCode}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}rt=(0,s.__decorate)([(0,Ce.W)(tt.f),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],rt);var st=r(37240);class it{execute(e){return this.recoveryFlow.continue({type:"SUBMIT_PIN",pinCode:e.body.pinCode}),Promise.resolve((0,P.Vp)(void 0))}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}it=(0,s.__decorate)([(0,Ce.W)(st.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],it);var ot=r(68307),at=r(13089);class nt{handle(e){const{authTicket:t}=e.body;return this.recoveryFlow.continue({type:"IDENTITY_VERIFICATION_COMPLETE",authTicket:t}),Promise.resolve()}constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}}nt=(0,s.__decorate)([(0,ot.b)(at.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe])],nt);var ct,dt,lt=r(85390),ut=r(6136),pt=r(20754),mt=r(31856),ht=r(69885),gt=r(6220);!function(e){e[e.InitActivation=0]="InitActivation",e[e.RequestActivation=1]="RequestActivation",e[e.DisplayKey=2]="DisplayKey",e[e.ConfirmKey=3]="ConfirmKey",e[e.FinaliseActivation=4]="FinaliseActivation",e[e.ActivationDone=5]="ActivationDone",e[e.ShowError=6]="ShowError",e[e.GenerateNewKey=7]="GenerateNewKey",e[e.CancelGenerateNewKey=8]="CancelGenerateNewKey"}(ct||(ct={})),function(e){e[e.InitRecovery=0]="InitRecovery",e[e.IdentityVerification=1]="IdentityVerification",e[e.EnterRecoveryKey=2]="EnterRecoveryKey",e[e.ChangeMasterPassword=3]="ChangeMasterPassword",e[e.EnterPin=4]="EnterPin",e[e.ConfirmPin=5]="ConfirmPin",e[e.Finalising=6]="Finalising",e[e.Success=7]="Success",e[e.Failure=8]="Failure"}(dt||(dt={}));const vt=e=>(0,ht.of)((0,P.Vp)(function(e){if(!e.matches("Starting"))return e.matches("InitAccountRecoveryKeyActivation")?{step:ct.InitActivation,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("RequestingActivation")?{step:ct.RequestActivation,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("DisplayAccountRecoveryKey")?{step:ct.DisplayKey,recoveryKey:e.context.recoveryKey,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("ConfirmAccountRecoveryKey")?{step:ct.ConfirmKey,recoveryKey:e.context.recoveryKey,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("FinalisingAccountRecoveryKeyActivation")?{step:ct.FinaliseActivation,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("AccountRecoveryKeyActivationDone")?{step:ct.ActivationDone,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("AccountRecoveryKeyActivationError")?{step:ct.ShowError,error:e.context.error,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("GenerateNewAccountRecoveryKey")?{step:ct.GenerateNewKey,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("CancelNewAccountRecoveryKey")?{step:ct.CancelGenerateNewKey,isFeatureEnabled:e.context.isFeatureEnabled}:void console.warn("[ARK Activation] - No view associated to state ",e.value)}(e))),_t=e=>e.pipe((0,gt.z)(vt));var yt=r(52800);const St=(e,t)=>{const r=t.matches(e.value),s=(0,yt.Z)(e.context,t.context);return r&&s};class Et{execute(){return(0,lt.a)([(e=this.activationFlowMachineStore,e.state$.pipe((0,m.U)((e=>e?p.ZM.create(JSON.parse(e)):void 0)))),this.activationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,L.h)(Boolean),(0,ut.x)(((e,t)=>St(e,t))),_t);var e}constructor(e,t){this.activationFlow=e,this.activationFlowMachineStore=t}}Et=(0,s.__decorate)([(0,pt.e)(mt.S),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ae?Object:ae,void 0===_?Object:_])],Et);var ft=r(43978),At=r(74062);class It{execute({body:e}){const{login:t}=e;return""===t?(0,ht.of)((0,P.Vp)({isEnabled:!1})):this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,ft.w)((async e=>(void 0!==e.isEnabled&&t===e.login||await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(t),e))),(0,m.U)((e=>(0,P.Vp)({isEnabled:e.isEnabled}))))}constructor(e){this.accountRecoveryKeyService=e}}It=(0,s.__decorate)([(0,pt.e)(At.D),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B])],It);var Ot=r(74564);class bt{execute(){const e=this.session.queries.selectedOpenedSession().pipe((0,ft.w)((e=>{if(!(0,P.d6)(e)||!e.data)throw new Error("no user provided ");return this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(e.data)})),(0,ft.w)((()=>this.carbonLegacyClient.queries.carbonState({path:"userSession.personalSettings.RecoveryOptIn"}))),(0,L.h)(P.d6),(0,m.U)((e=>"boolean"==typeof e.data&&e.data))),t=this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,m.U)((e=>void 0!==e.isEnabled&&e.isEnabled)));return(0,lt.a)([e,t]).pipe((0,m.U)((([e,t])=>(0,P.Vp)({adminAssistedRecovery:e,accountRecoveryKey:t}))))}constructor(e,t,r){this.accountRecoveryKeyService=e,this.carbonLegacyClient=t,this.session=r}}bt=(0,s.__decorate)([(0,pt.e)(Ot.V),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===B?Object:B,void 0===G._?Object:G._,void 0===se.x?Object:se.x])],bt);var Tt=r(92253);const Ct=e=>(0,ht.of)((0,P.Vp)(function(e){return e.matches("Starting")?{step:dt.InitRecovery,error:e.context.error}:e.matches("IdentityVerification")?{step:dt.IdentityVerification,login:e.context.login}:e.matches("EnterRecoveryKey")||e.matches("CheckAccountRecoveryKey")?{step:dt.EnterRecoveryKey,error:e.context.error,accountType:e.context.accountType}:e.matches("ChangeMasterPassword")?{step:dt.ChangeMasterPassword,error:e.context.error}:e.matches("EnterPin")?{step:dt.EnterPin,error:e.context.error}:e.matches("ConfirmPin")?{step:dt.ConfirmPin,error:e.context.error,pinCode:e.context.newPinCode}:e.matches("FinalisingRecovery")||e.matches("OpenPasswordlessSession")?{step:dt.Finalising}:e.matches("RecoverySuccess")?{step:dt.Success}:e.matches("CheckAccountRecoveryKeyError")||e.matches("ChangeMasterPasswordError")?{step:dt.Failure}:void console.warn("[ARK Recovery] - No view associated to state ",e.value)}(e))),wt=e=>e.pipe((0,gt.z)(Ct));class Rt{execute(){return(0,lt.a)([(e=this.recoveryFlowMachineStore,e.state$.pipe((0,m.U)((e=>e?p.ZM.create(JSON.parse(e)):void 0)))),this.recoveryFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,L.h)(Boolean),(0,ut.x)(((e,t)=>St(e,t))),wt);var e}constructor(e,t){this.recoveryFlow=e,this.recoveryFlowMachineStore=t}}Rt=(0,s.__decorate)([(0,pt.e)(Tt.y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe?Object:Oe,void 0===A?Object:A])],Rt);class Pt{}Pt=(0,s.__decorate)([(0,a.Yl)({api:i.j,stores:[_,A,E],imports:[d.n,l.D,u.R],handlers:{commands:{goToActivationNextStep:Re,goToActivationPrevStep:De,requestActivation:Ue,resetActivationFlow:Me,cancelGeneration:Ge,confirmActivation:xe,confirmNewPassword:je,deactivate:We,submitRecoveryKey:ze,tryAgainRecovery:Ye,cancelRecoveryFlow:$e,startRecoveryFlow:Ze,clearWrongRecoveryKeyError:et,createPin:rt,submitPin:it},events:{...(0,a.g4)(o.i,{identityVerificationCompleted:nt})},queries:{activationFlowStatus:Et,accountRecoveryKeyStatus:It,recoveryMethodsInfo:bt,recoveryFlowStatus:Rt}},providers:[...(0,n.H)(ae,{inject:[oe,_,be.c,c.J],asyncFactory:async(e,t,r,s)=>{let i=!1;const o=await(0,M.z)(r.queries.platformInfo());!(0,P.d6)(o)||o.data.buildType!==Te.P.DEV&&o.data.buildType!==Te.P.NIGHTLY||(i=!0);const a=new ae(e,i,t,s);return await a.prepare(),a}}),...(0,n.H)(Oe,{inject:[Ie,A,be.c,c.J],asyncFactory:async(e,t,r,s)=>{let i=!1;const o=await(0,M.z)(r.queries.platformInfo());!(0,P.d6)(o)||o.data.buildType!==Te.P.DEV&&o.data.buildType!==Te.P.NIGHTLY||(i=!0);const a=new Oe(e,i,t,s);return await a.prepare(),a}}),oe,Ie,z,ne,me,ye,B,ee,ie,pe,J,ge,Ae,fe]})],Pt)},11280:(e,t,r)=>{r.d(t,{X:()=>d});var s=r(86952),i=r(45315),o=r(2551),a=r(43179),n=r(95822),c=r(6641);const d=(0,s.Q)({name:"accountCreation",commands:{createPasswordlessAccount:i.ck,markMassDeployFirstInitDone:o.$,requestTeamInviteTokenSending:a.V},events:{},queries:{accountCreationMassDeployPolicies:n.d,inviteLinkData:c.$}})},45315:(e,t,r)=>{r.d(t,{G2:()=>o,ck:()=>a});var s=r(74354),i=r(25029);const o=(0,r(96168).Vj)("NetworkError","The user appears offline");class a extends((0,s.g)({scope:i.F.Device})){}},2551:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},43179:(e,t,r)=>{r.d(t,{V:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},95822:(e,t,r)=>{r.d(t,{d:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},6641:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},35936:(e,t,r)=>{r.d(t,{l:()=>n});var s=r(86952),i=r(32389),o=r(59020),a=r(75449);const n=(0,s.Q)({name:"accountReferral",commands:{inviteByEmail:i.P},events:{},queries:{getSharingLink:o.h,getInvitationsHistory:a.g}})},32389:(e,t,r)=>{r.d(t,{P:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},75449:(e,t,r)=>{r.d(t,{g:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},59020:(e,t,r)=>{r.d(t,{h:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},12892:(e,t,r)=>{r.d(t,{d:()=>c});var s=r(86952),i=r(84238),o=r(68817),a=r(81377),n=r(65104);const c=(0,s.Q)({name:"deleteOrResetAccount",commands:{completeFlow:i.I,initiateFlow:o.O},events:{},queries:{userAuthenticationMethod:a.c,isFlowCompleted:n.h}})},84238:(e,t,r)=>{r.d(t,{I:()=>n,O:()=>s});var s,i=r(74354),o=r(25029),a=r(7165);!function(e){e.INVALID_OTP_ALREADY_USED="INVALID_OTP_ALREADY_USED",e.INVALID_OTP_BLOCKED="INVALID_OTP_BLOCKED",e.VERIFICATION_FAILED="VERIFICATION_FAILED",e.ACCOUNT_BLOCKED_CONTACT_SUPPORT="ACCOUNT_BLOCKED_CONTACT_SUPPORT",e.VERIFICATION_REQUIRES_REQUEST="VERIFICATION_REQUIRES_REQUEST",e.VERIFICATION_TIMEOUT="VERIFICATION_TIMEOUT"}(s||(s={})),a.z.object({tag:a.z.nativeEnum(s)});class n extends((0,i.g)({scope:o.F.Device})){}},68817:(e,t,r)=>{r.d(t,{O:()=>n,U:()=>s});var s,i=r(74354),o=r(25029),a=r(7165);!function(e){e.UNKNOWN_USER="user_not_found",e.SSO_BLOCKED="SSO_BLOCKED"}(s||(s={})),a.z.object({tag:a.z.nativeEnum(s)});class n extends((0,i.g)({scope:o.F.Device})){}},65104:(e,t,r)=>{r.d(t,{h:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},81377:(e,t,r)=>{r.d(t,{c:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},63481:(e,t,r)=>{r.d(t,{Z:()=>Ee});var s=r(88802),i=r(11280),o=r(99634),a=r(93850),n=r(37935),c=r(15043);var d=r(87279),l=r(57924);class u{}class p extends u{async retrieveAccountCreationBrowserPolicies(){try{const e=await(0,c.U)();return void 0===e?(0,d.Vp)({teamKey:"",isExtensionMassDeployed:!1}):(0,d.Vp)({teamKey:e.team_key||"",isExtensionMassDeployed:e.is_extension_mass_deployed||!1})}catch{return(0,d.Vp)({teamKey:"",isExtensionMassDeployed:!1})}}}p=(0,s.__decorate)([(0,l.GS)()],p);var m=r(25029),h=r(95681),g=r(23347),v=r(10722);const _=e=>!(!e||"object"!=typeof e)&&("firstMassDeployOpening"in e&&"teamKey"in e);class y extends((0,h.Q)({codec:v.E,persist:!0,scope:m.F.Device,storeName:"account-creation-browser-policies-store",capacity:g.Y._001KB,storage:{schemaVersion:1,initialValue:{firstMassDeployOpening:!0,teamKey:""},typeGuard:_}})){}class S{async onFrameworkInit(){const{firstMassDeployOpening:e}=await this.acBrowserPoliciesStore.getState(),t=await this.massDeployBrowserPoliciesService.retrieveAccountCreationBrowserPolicies();(0,d.ty)(t,(({teamKey:t,isExtensionMassDeployed:r})=>{this.acBrowserPoliciesStore.set({teamKey:t,firstMassDeployOpening:e&&r})}))}constructor(e,t){this.acBrowserPoliciesStore=e,this.massDeployBrowserPoliciesService=t}}S=(0,s.__decorate)([(0,l.ar)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y?Object:y,void 0===u?Object:u])],S);var E,f,A=r(7165);!function(e){e.LOADING="loading",e.NOT_LOADED="not_loaded",e.READY="ready"}(E||(E={})),function(e){e.TEAM_DOES_NOT_EXIST="TEAM_DOES_NOT_EXIST",e.USER_NOT_PROPOSED_IN_TEAM="USER_NOT_PROPOSED_IN_TEAM",e.USER_TEAM_INVITE_TOKEN_NOT_FOUND="USER_TEAM_INVITE_TOKEN_NOT_FOUND"}(f||(f={})),A.z.object({tag:A.z.nativeEnum(f)});class I extends((0,h.Q)({persist:!1,scope:m.F.Device,storeName:"invite-link-store",initialValue:{status:E.NOT_LOADED},capacity:g.Y._001KB})){}var O=r(63663),b=r(45315),T=r(86252),C=r(18533),w=r(85465),R=r(60399),P=r(41842),D=r(89358),N=r(42303),U=r(55300),F=r(87113),M=r(19603),L=r(56268),G=r(40173),K=r(20195),x=r(78776);const k="ZZ";function j(e){return!e||e.length<2||e.length>5?k:e}const V="und";function W(e){return!e||e.length<2||e.length>5?V:e}const B="Device";function z(e){return e||B}function H(e){return e?e.replace(/https?:\/\//g," "):e}function Y(){return`{${(0,x.Z)().toUpperCase()}}`}var Q=r(10370),q=r(21131),$=r(86286),X=r(9034),Z=r(94805),J=r(16698),ee=r(25565);class te{async createAccount({login:e,accountType:t,password:r,consents:s,deviceName:i}){const o=await(0,R.z)(this.platformInfoClient.queries.platformInfo());if(!(0,d.d6)(o))throw new Error("failed to get platform info");const a=o.data,n=Math.round(Date.now()/1e3),c=this.random.get(16),l=function({AnonymousUserId:e,CryptoFixedSalt:t,CryptoUserPayload:r,UsagelogToken:s,accountCreationDatetime:i}){return`<?xml version="1.0" encoding="UTF-8"?>\n<root>\n    <KWSettingsManagerApp> \n        <KWDataItem key="AnonymousUserId"><![CDATA[${e}]]></KWDataItem>\n        <KWDataItem key="CryptoFixedSalt"><![CDATA[${t}]]></KWDataItem>\n        <KWDataItem key="CryptoUserPayload"><![CDATA[${r}]]></KWDataItem>  \n        <KWDataItem key="SyncBackup"><![CDATA[YES]]></KWDataItem>\n        <KWDataItem key="UsagelogToken"><![CDATA[${s}]]></KWDataItem>\n        <KWDataItem key="accountCreationDatetime"><![CDATA[${i}]]></KWDataItem>\n    </KWSettingsManagerApp>\n</root>`}({accountCreationDatetime:n,AnonymousUserId:Y(),CryptoFixedSalt:(0,Q.s)(c),CryptoUserPayload:"$1$argon2d$16$3$32768$2$aes256$cbchmac$16$",Login:e,UsagelogToken:Y()}),u=(0,q.n)((new TextEncoder).encode(l)),p=async e=>await this.flexibleEncryptor.encrypt((new TextEncoder).encode(r),e,Z.mr,J.Nw,{salt:c}),m=await p(u),{privateKey:h,publicKey:g}=await this.rsaKeyGenerator.generate(),v=(0,$.R)(h),_=(0,X.y)(g),y=await p((new TextEncoder).encode(v));if("server_carbon_unknown"===a.platformName)throw new Error("Invalid platform info");const S=await(0,R.z)(this.serverApiClient.v1.account.createUser({appVersion:a.appVersion,consents:[{consentType:"emailsOffersAndTips",status:s.offers},{consentType:"privacyPolicyAndToS",status:s.tosAndPrivacy}],country:j(a.country),deviceName:z(H(i)),language:W(a.lang),login:e,osCountry:j(a.country),osLanguage:W(a.lang),platform:a.platformName,settings:{time:n,content:(0,Q.s)(m)},sharingKeys:{publicKey:_,privateKey:(0,Q.s)(y)},temporaryDevice:!1,accountType:t,contactEmail:e}));if(!(0,d.d6)(S))return(0,C.EQ)(S.error,{BusinessError:()=>(0,K.j)("failed to create account"),FetchFailedError:()=>(0,d.Rn)((0,b.G2)()),InternalServerError:()=>(0,K.j)("failed to create account"),InvalidRequest:()=>(0,K.j)("failed to create account"),RateLimited:()=>(0,K.j)("failed to create account"),ServiceUnavailable:()=>(0,K.j)("failed to create account"),UnspecifiedBadStatus:()=>(0,K.j)("failed to create account")});const{deviceAccessKey:E,deviceSecretKey:f,userAnalyticsId:A}=S.data.data,I=await this.deviceRegistration.commands.registerDevice({with:"deviceKeys",deviceAccessKey:E,deviceSecretKey:f,login:e,settings:(0,Q.s)(m),userAnalyticsId:A,deviceName:i,ignoreAlreadyRegisteredError:!0});return(0,d.d6)(I)?(0,d.Vp)(void 0):(0,C.EQ)(I.error,{DeviceAlreadyRegistered:()=>(0,K.j)("failed to register device in carbon"),InvalidTokenError:()=>(0,K.j)("failed to register device in carbon"),NetworkError:()=>(0,d.Rn)((0,b.G2)())})}constructor(e,t,r,s,i,o){this.serverApiClient=e,this.platformInfoClient=t,this.random=r,this.flexibleEncryptor=s,this.rsaKeyGenerator=i,this.deviceRegistration=o}}te=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===F.l?Object:F.l,void 0===U.c?Object:U.c,void 0===M.Y?Object:M.Y,void 0===L._?Object:L._,void 0===G.e?Object:G.e,void 0===ee.z?Object:ee.z])],te);const re={avoidAmbiguous:!1,length:40,letters:!0,digits:!0,symbols:!0};class se{async execute({body:{consents:e,email:t,pinCode:r,deviceName:s}}){const i=(0,w.generate)(re),o=await this.creator.createAccount({accountType:"invisibleMasterPassword",login:t,consents:e,password:i,deviceName:s});if(!(0,d.d6)(o))return(0,C.EQ)(o.error,{NetworkError:e=>(0,d.Rn)(e)});const a=await this.carbon.commands.openSessionWithMasterPassword({login:t,password:i,rememberPassword:!1,requiredPermissions:void 0,loginType:"CreatedPasswordlessAccount"});if(!(0,d.d6)(a))throw new Error("failed to login in carbon");return await(0,R.z)(this.session.queries.selectedOpenedSession().pipe((0,P.h)((e=>(0,d.d6)(e)&&e.data===t)))),await this.pinCode.commands.activate({pinCode:r}),(0,d.Vp)(void 0)}constructor(e,t,r,s){this.creator=e,this.carbon=t,this.session=r,this.pinCode=s}}se=(0,s.__decorate)([(0,O.W)(b.ck),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===te?Object:te,void 0===T._?Object:T._,void 0===D.x?Object:D.x,void 0===N.u?Object:N.u])],se);var ie=r(2551);class oe{async execute(){const e=await this.acBrowserPoliciesStore.getState();return this.acBrowserPoliciesStore.set({...e,firstMassDeployOpening:!1}),(0,d.Vp)(void 0)}constructor(e){this.acBrowserPoliciesStore=e}}oe=(0,s.__decorate)([(0,O.W)(ie.$),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y?Object:y])],oe);var ae=r(43179),ne=r(48844);class ce{constructor(e,t){this.serverApiClient=e,this.inviteLinkStore=t,this.getFunctionalError=e=>{switch(e){case f.TEAM_DOES_NOT_EXIST:return{tag:f.TEAM_DOES_NOT_EXIST};case f.USER_NOT_PROPOSED_IN_TEAM:return{tag:f.USER_NOT_PROPOSED_IN_TEAM};case f.USER_TEAM_INVITE_TOKEN_NOT_FOUND:return{tag:f.USER_TEAM_INVITE_TOKEN_NOT_FOUND};default:throw new Error(`RequestTeamInviteToken: error ${e}`)}},this.loadInviteLinkData=async e=>{const t=await this.inviteLinkStore.getState();if(t.status===E.LOADING||t.status===E.READY&&e===t.teamKey)return;await this.inviteLinkStore.set({status:E.LOADING});const r=await(0,R.z)(this.serverApiClient.v1.teams.getTeamSignUpPage({teamKey:e}).pipe((0,ne.Qn)((({data:e})=>e))));if((0,d.hx)(r))return this.inviteLinkStore.set({status:E.NOT_LOADED});const{disabled:s,displayName:i,teamUuid:o}=r.data;return this.inviteLinkStore.set({teamKey:e,teamUuid:o,displayName:i,disabled:s,status:E.READY})},this.requestTeamInviteTokenSending=(e,t)=>(0,R.z)(this.serverApiClient.v1.teams.requestTeamInviteToken({login:e,teamUuid:t}).pipe((0,ne.DZ)((e=>(0,C.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},InternalServerError:K.j,InvalidRequest:K.j,RateLimited:K.j,ServiceUnavailable:K.j,UnspecifiedBadStatus:K.j}))),(0,ne.Qn)((({data:e})=>e))))}}ce=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===F.l?Object:F.l,void 0===I?Object:I])],ce);class de{async execute({body:e}){const{login:t,teamUuid:r}=e,s=await this.inviteLinkService.requestTeamInviteTokenSending(t,r);return(0,d.hx)(s)?Promise.resolve(s):(0,d.Vp)(void 0)}constructor(e){this.inviteLinkService=e}}de=(0,s.__decorate)([(0,O.W)(ae.V),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ce?Object:ce])],de);var le=r(6136),ue=r(87065),pe=r(62760),me=r(20754),he=r(95822);class ge{execute(){return this.acBrowserPoliciesStore.state$.pipe((0,le.x)(pe.shallowEqualObjects),(0,ue.U)(d.Vp))}constructor(e){this.acBrowserPoliciesStore=e}}ge=(0,s.__decorate)([(0,me.e)(he.d),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y?Object:y])],ge);var ve=r(69885),_e=r(25859),ye=r(6641);class Se{execute({body:e}){const{teamKey:t}=e;return""===t?(0,ve.of)((0,d.Vp)(null)):(0,_e.P)((()=>(this.inviteLinkService.loadInviteLinkData(t),this.inviteLinkStore.state$.pipe((0,ue.U)((e=>e.status!==E.READY?(0,d.Vp)(null):(0,d.Vp)({teamKey:e.teamKey,teamUuid:e.teamUuid,displayName:e.displayName,disabled:e.disabled})))))))}constructor(e,t){this.inviteLinkStore=e,this.inviteLinkService=t}}Se=(0,s.__decorate)([(0,me.e)(ye.$),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===I?Object:I,void 0===ce?Object:ce])],Se);class Ee{}Ee=(0,s.__decorate)([(0,o.Yl)({api:i.X,providers:[{provide:u,useClass:p},te,ce],exports:[u],onFrameworkInit:[S],stores:[y,I],handlers:{commands:{createPasswordlessAccount:se,markMassDeployFirstInitDone:oe,requestTeamInviteTokenSending:de},events:{},queries:{accountCreationMassDeployPolicies:ge,inviteLinkData:Se}},imports:[a.n,n.D]})],Ee)},12444:(e,t,r)=>{r.d(t,{o:()=>O});var s=r(88802),i=r(99634),o=r(35936),a=r(93850),n=r(60399),c=r(63663),d=r(32389),l=r(87113),u=r(87279),p=r(86252),m=r(87065),h=r(57924);class g{async getIsExistingLogin(e){const t=this.serverApiClient.v1.authentication.get2FaStatusUnauthenticated({login:e});return await(0,n.z)(t.pipe((0,m.U)((e=>(0,u.d6)(e)))))}constructor(e){this.serverApiClient=e}}g=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l])],g);class v{async execute({body:{email:e}}){try{const t=await(0,n.z)(this.carbon.queries.getSubscriptionCode());if(await this.accountExistsService.getIsExistingLogin(e)){const e="InviteByEmailCommand";return(0,u.Rn)({tag:e})}const r=await(0,n.z)(this.serverApiClient.v1.invitation.invite({userKey:(0,u.d6)(t)?t.data:"",identifiers:[e],type:"manual"}));if((0,u.hx)(r))throw new Error("InviteByEmailCommand failure: something went wrong in call to /invitation/invite");return(0,u.Vp)(void 0)}catch(e){throw new Error("InviteByEmailCommand failure: something went wrong in execute method")}}constructor(e,t,r){this.serverApiClient=e,this.carbon=t,this.accountExistsService=r}}v=(0,s.__decorate)([(0,c.W)(d.P),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l,void 0===p._?Object:p._,void 0===g?Object:g])],v);var _=r(34987),y=r(20754),S=r(59020),E=r(48844);class f{execute(){return this.carbon.queries.getSubscriptionCode().pipe((0,_.b)((e=>this.serverApiClient.v1.invitation.getSharingLink({userKey:"success"===e.tag?e.data:""}).pipe((0,E.Qn)((e=>e.data)),(0,E.DZ)((e=>{throw new Error(e.message)}))))))}constructor(e,t){this.serverApiClient=e,this.carbon=t}}f=(0,s.__decorate)([(0,y.e)(S.h),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l,void 0===p._?Object:p._])],f);var A=r(75449);class I{execute(){return this.serverApiClient.v1.invitation.getInvitationsHistory().pipe((0,E.Qn)((e=>e.data)),(0,E.DZ)((e=>(0,u.Rn)({tag:`GetInvitationsHistoryQueryHandler failure: ${e.message}`}))))}constructor(e){this.serverApiClient=e}}I=(0,s.__decorate)([(0,y.e)(A.g),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.l?Object:l.l])],I);class O{}O=(0,s.__decorate)([(0,i.Yl)({api:o.l,imports:[a.n],handlers:{commands:{inviteByEmail:v},events:{},queries:{getSharingLink:f,getInvitationsHistory:I}},providers:[g]})],O)},99813:(e,t,r)=>{r.d(t,{T:()=>D});var s=r(88802),i=r(99634),o=r(93850),a=r(12892),n=r(60399),c=r(87065),d=r(84238),l=r(68817),u=r(57924),p=r(87113),m=r(48844),h=r(18533),g=r(20195),v=r(87279);class _{getAuthenticationMethodsForReset(e){return this.serverApiClient.v1.authentication.getAuthenticationMethodsForReset({login:e,methods:["email_token","totp"]}).pipe((0,m.DZ)((e=>(0,h.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,m.Qn)((e=>{if(e.data.verifications.length>=1)return e.data.verifications[0].type;throw new Error("GetAuthenticationMethodsForReset: couldn't retrieve any method")})))}requestEmailTokenVerificationSending(e){return(0,n.z)(this.serverApiClient.v1.authentication.requestEmailTokenVerification({login:e}).pipe((0,c.U)((e=>(0,v.d6)(e)))))}getVerifyTokenFunctionalError(e){switch(e){case"invalid_otp_already_used":return{tag:d.O.INVALID_OTP_ALREADY_USED};case"invalid_otp_blocked":return{tag:d.O.INVALID_OTP_BLOCKED};case"verification_failed":return{tag:d.O.VERIFICATION_FAILED};case"account_blocked_contact_support":return{tag:d.O.ACCOUNT_BLOCKED_CONTACT_SUPPORT};case"verification_requires_request":return{tag:d.O.VERIFICATION_REQUIRES_REQUEST};case"verification_timeout":return{tag:d.O.VERIFICATION_TIMEOUT};default:throw new Error("performTokenVerification: Business error not handled")}}verifyTOTPToken(e,t){return(0,n.z)(this.serverApiClient.v1.authentication.performTotpVerification({login:e,otp:t,intent:"account_delete_or_reset"}).pipe((0,m.DZ)((e=>(0,h.EQ)(e,{BusinessError:e=>this.getVerifyTokenFunctionalError(e.code),FetchFailedError:g.j,BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,m.Qn)((e=>e.data.authTicket))))}verifyEmailToken(e,t){return(0,n.z)(this.serverApiClient.v1.authentication.performEmailTokenVerification({login:e,token:t,intent:"account_delete_or_reset"}).pipe((0,m.DZ)((e=>(0,h.EQ)(e,{BusinessError:e=>this.getVerifyTokenFunctionalError(e.code),FetchFailedError:g.j,BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,m.Qn)((e=>e.data.authTicket))))}deleteOrResetAccount(e,t,r=!0){return(0,n.z)(this.serverApiClient.v1.account.deleteOrResetAccount({authTicket:t,isDelete:r,login:e}).pipe((0,m.DZ)((e=>(0,h.EQ)(e,{BusinessError:g.j,FetchFailedError:g.j,BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,m.Qn)((()=>!0))))}constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case l.U.UNKNOWN_USER:return{tag:l.U.UNKNOWN_USER};case l.U.SSO_BLOCKED:return{tag:l.U.SSO_BLOCKED};default:throw new Error(`GetAuthenticationMethodsForReset: error ${e}`)}}}}_=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p.l?Object:p.l])],_);var y,S=r(25029),E=r(95681),f=r(23347);class A extends((0,E.Q)({persist:!1,scope:S.F.Device,storeName:"account-deletion",initialValue:{login:"",userAuthenticationMethod:null,isFlowCompleted:!1},capacity:f.Y._001KB})){}!function(e){e.EMAIL="EMAIL",e.TOTP="TOTP"}(y||(y={}));var I=r(63663);class O{async execute({body:e}){const{token:t,isDelete:r}=e,s=await this.deleteOrResetAccountStore.getState(),{userAuthenticationMethod:i,login:o}=s,a=i===y.EMAIL?await this.deleteOrResetAccountService.verifyEmailToken(o,t):await this.deleteOrResetAccountService.verifyTOTPToken(o,t);if((0,v.hx)(a))return Promise.resolve(a);const n=await this.deleteOrResetAccountService.deleteOrResetAccount(o,a.data,r);if((0,v.hx)(n))throw new Error("CompleteFlowCommand : error while deleting the account");return this.deleteOrResetAccountStore.set({...s,isFlowCompleted:!0}),Promise.resolve((0,v.Vp)(void 0))}constructor(e,t){this.deleteOrResetAccountStore=e,this.deleteOrResetAccountService=t}}O=(0,s.__decorate)([(0,I.W)(d.I),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A?Object:A,void 0===_?Object:_])],O);class b{async execute({body:e}){const{login:t}=e,r=await(0,n.z)(this.deleteOrResetAccountService.getAuthenticationMethodsForReset(t).pipe((0,m.Qn)((e=>"email_token"===e?y.EMAIL:y.TOTP))));if((0,v.hx)(r))return Promise.resolve(r);r.data===y.EMAIL&&this.deleteOrResetAccountService.requestEmailTokenVerificationSending(t);const s=await this.deleteOrResetAccountStore.getState();return await this.deleteOrResetAccountStore.set({...s,login:t,userAuthenticationMethod:r.data}),Promise.resolve((0,v.Vp)(void 0))}constructor(e,t){this.deleteOrResetAccountStore=e,this.deleteOrResetAccountService=t}}b=(0,s.__decorate)([(0,I.W)(l.O),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A?Object:A,void 0===_?Object:_])],b);var T=r(20754),C=r(81377);class w{execute(){return this.deleteOrResetAccountStore.state$.pipe((0,c.U)((e=>(0,v.Vp)(e.userAuthenticationMethod))))}constructor(e){this.deleteOrResetAccountStore=e}}w=(0,s.__decorate)([(0,T.e)(C.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A?Object:A])],w);var R=r(65104);class P{execute(){return this.deleteOrResetAccountStore.state$.pipe((0,c.U)((e=>(0,v.Vp)(e.isFlowCompleted))))}constructor(e){this.deleteOrResetAccountStore=e}}P=(0,s.__decorate)([(0,T.e)(R.h),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A?Object:A])],P);class D{}D=(0,s.__decorate)([(0,i.Yl)({api:a.d,handlers:{commands:{completeFlow:O,initiateFlow:b},events:{},queries:{userAuthenticationMethod:w,isFlowCompleted:P}},stores:[A],imports:[o.n],providers:[_]})],D)},11526:(e,t,r)=>{r.d(t,{D:()=>o});var s=r(86952),i=r(89689);const o=(0,s.Q)({name:"overrides",commands:{},events:{},queries:{OverridesQuery:i.N}})},89689:(e,t,r)=>{r.d(t,{N:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},49574:(e,t,r)=>{r.d(t,{x:()=>h});var s=r(88802),i=r(99634);var o=r(11526),a=r(31366),n=r(20754),c=r(89689),d=r(87279),l=r(76946),u=r(87065);class p{execute(){return this.rfuClient.streamFileUpdate().pipe((0,u.U)((e=>(0,d.Vp)({overrides:e}))))}constructor(e){this.rfuClient=e}}p=(0,s.__decorate)([(0,n.e)(c.N),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.w?Object:l.w])],p);const m=(0,a.Q)("overrides.json",(e=>null!=e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)&&e.every((e=>(e=>{if(!e||"object"!=typeof e)return!1;const t="type"in e&&void 0!==e.type&&("startsWith"===e.type||"regexp"===e.type),r="value"in e&&void 0!==e.value&&(Array.isArray(e.value)&&e.value.every((e=>"string"==typeof e))||"string"==typeof e.value),s="conditions"in e&&void 0!==e.conditions&&Array.isArray(e.conditions)&&e.conditions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("css"===e.type||"xpath"===e.type),r="selector"in e&&void 0!==e.selector&&"string"==typeof e.selector;return t&&r})(e))),i="actions"in e&&void 0!==e.actions&&Array.isArray(e.actions)&&e.actions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("set"===e.type||"ignore"===e.type),r="cssSelector"in e&&void 0!==e.cssSelector&&"string"==typeof e.cssSelector;return t&&r})(e)));return t&&r&&s&&i})(e)))))));class h{}h=(0,s.__decorate)([(0,i.Yl)({api:o.D,composes:[m],handlers:{commands:{},events:{},queries:{overrides:p}}})],h)},76347:(e,t,r)=>{r.d(t,{U:()=>W});var s=r(88802),i=r(99634),o=r(15403),a=r(87065),n=r(78364),c=r(57924),d=r(87279),l=r(48844),u=r(39431),p=r(29289),m=r(50879),h=r(22449);const g={[n.k.Address]:u.U.Address,[n.k.BankAccount]:u.U.BankAccount,[n.k.Company]:u.U.Company,[n.k.Credential]:u.U.Credential,[n.k.DriverLicense]:u.U.DriversLicense,[n.k.Email]:u.U.Email,[n.k.FiscalId]:u.U.FiscalId,[n.k.GeneratedPassword]:null,[n.k.IdCard]:u.U.IdCard,[n.k.Identity]:u.U.Identity,[n.k.Note]:u.U.SecureNote,[n.k.Passkey]:u.U.Passkey,[n.k.Passport]:u.U.Passport,[n.k.PaymentCard]:u.U.PaymentCard,[n.k.PersonalWebsite]:u.U.Website,[n.k.Phone]:u.U.Phone,[n.k.SocialSecurityId]:u.U.SocialSecurityId,[n.k.Secret]:u.U.Secret,[n.k.NoteCategory]:null};class v{getAutofillData(e,t,r,s){const i=g[e];if(!i)throw new Error("autofill-data.repository: bad vault item type in `getAutofillData`");return this.getVaultItem(i,t?[t]:void 0,r,s).pipe((0,a.U)((e=>{if((0,d.hx)(e))throw new Error("autofill-data.repository: the following error occured while requesting the vault API "+e.tag);if(t&&e.data[p.N[i]].matchCount<1)throw new Error("autofill-data.repository: no vault item corresponding to the provided id");return e})))}searchAutofillData(e,t,r){let s;return t?.length&&(s=t.map((e=>g[e])).filter((e=>!!e))),this.searchVaultItem(e,s,r).pipe((0,l.DZ)((e=>{throw new Error("autofill-data.repository: the following error occured while requesting the search vault API "+e)})))}getVaultItem(e,t,r,s){const{query:i}=this.vaultClient.queries;return i({vaultItemTypes:[e],ids:t,propertySorting:r,propertyFilters:s})}searchVaultItem(e,t,r){const{search:s}=this.searchClient.queries;return s({searchQuery:e,vaultItemTypes:t,propertySorting:r})}constructor(e,t){this.vaultClient=e,this.searchClient=t}}v=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.L?Object:m.L,void 0===h.T?Object:h.T])],v);var _,y=r(60399),S=r(72250),E=r(25146),f=r(13252),A=r(35594),I=r(64718),O=r(21877);!function(e){e.MainWebsite="MainWebsite",e.DashlaneDefinedLinkedWebsite="DashlaneDefinedLinkedWebsite",e.UserDefinedLinkedWebsite="UserDefinedLinkedWebsite",e.None="None"}(_||(_={}));const b=(e,t,r)=>{const s=((e,t,r)=>{if(!e)return"None";const s=new I.Y(e).getRootDomain();return s===new I.Y(t.URL).getRootDomain()?"MainWebsite":r.map((e=>new I.Y(e).getRootDomain())).includes(s)?"DashlaneDefinedLinkedWebsite":t.linkedURLs.map((e=>new I.Y(e).getRootDomain())).includes(s)?"UserDefinedLinkedWebsite":"None"})(e,t,r);switch(s){case"DashlaneDefinedLinkedWebsite":return O.MatchType.AssociatedWebsite;case"UserDefinedLinkedWebsite":return O.MatchType.UserAssociatedWebsite;default:return O.MatchType.Regular}},T=e=>new Date(1e3*e),C=e=>{if(!e)return null;const t=(e=>{if(!e)return 0;const[t,r,s]=e.split(/[-/]/).map((e=>Number.parseInt(e,10))),i=new Date;i.setUTCHours(0,0,0,0);const o=i.setUTCFullYear(t,r-1,s);return Math.floor(o/1e3)})(e);return Number.isNaN(t)?null:t},w=e=>{const t=new Date(0).getUTCFullYear(),r=T(C(e.birthDate)??0),s=new Date(Date.now()-r.getTime());return Math.abs(s.getUTCFullYear()-t)},R=e=>e??"",P=e=>e??0;class D{getAutofillViewForItems(e,{data:t},r){return this.mapVaultItemToAutofillView[e](t,r)}isCredentialsList(e){return e.length>0&&e[0].vaultType===n.k.Credential}isPasskeysList(e){return e.length>0&&e[0].vaultType===n.k.Passkey}baseItemAutofillView(e){return{id:e.id,lastUse:e.lastUse,localeFormat:e.localeFormat,spaceId:R(e.spaceId)}}addressAutofillView(e){return Promise.all(e.addressesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Address,addressFull:`${e.streetNumber} ${e.streetName}`.trim(),stateCode:R(e.stateNumber),addressName:R(e.itemName),streetTitle:R(e.streetName),building:R(e.building),city:R(e.city),country:R(e.country),zipCode:R(e.zipCode),streetName:R(e.streetName),streetNumber:R(e.streetNumber),state:R(e.state),stairs:R(e.stairs),digitCode:R(e.digitCode),stateLevel2:"",door:R(e.door),floor:R(e.floor)}))))}bankAccountAutofillView(e){return Promise.all(e.bankAccountsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.BankAccount,name:R(e.accountName),owner:R(e.ownerName),IBAN:R(e.IBAN),BIC:R(e.BIC),bank:"",bankCode:R(e.bankCode),country:R(e.country)}))))}companyAutofillView(e){return Promise.all(e.companiesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Company,name:R(e.companyName),jobTitle:R(e.jobTitle)}))))}filteredCredentials(e,t,r){const s=r.map((e=>new I.Y(e).getRootDomain()));return e.filter((e=>{const r=new I.Y(e.URL).getRootDomain();return r===t||(!!s.includes(r)||!!e.linkedURLs.map((e=>new I.Y(e).getRootDomain())).includes(t))}))}async credentialAutofillView(e,t){const{getDashlaneDefinedLinkedWebsites:r}=this.linkedWebsitesClient.queries,{getPreferencesForCredentials:s}=this.autofillSettings.queries,i=await(0,y.z)(r({url:t??""}));if((0,d.hx)(i))throw new Error("Failed to retrieve dashlane linked website for domain: "+i.error);const o=t?this.filteredCredentials(e.credentialsResult.items,t,i.data):e.credentialsResult.items,a=o.map((({id:e})=>e)),c=await(0,y.z)(s({credentialIds:a}));if((0,d.hx)(c))throw new Error("Failed to retrieve preferences result: "+c.error);const l=c.data;return Promise.all(o.map((async e=>{const s=l.find((({id:t})=>t===e.id)),i=await(0,y.z)(r({url:e.URL}));if(!s||(0,d.hx)(i))throw new Error("Failed to map Credential to autofill view");const o=await this.getSharingInfoForItem(e.id),{data:a}=i,{useAutoLogin:c,requireMasterPassword:u,onlyAutofillExactDomain:p}=s;return{...this.baseItemAutofillView(e),vaultType:n.k.Credential,title:R(e.itemName),url:R(e.URL),secondaryLogin:R(e.alternativeUsername),email:R(e.email),password:R(e.password),otpSecret:R(e.otpSecret),matchType:b(t??"",e,a),login:R(e.username),hasOtp:Boolean(e.otpURL)||Boolean(e.otpSecret),otpUrl:R(e.otpURL),autoLogin:c,autoProtected:u,subdomainOnly:p,userAddedLinkedWebsites:e.linkedURLs,sharingStatus:o}})))}async getSharingInfoForItem(e){const{getPermissionForItem:t}=this.sharingItemsClient.queries,r=await(0,y.z)(t({itemId:e}));if((0,d.hx)(r))throw new Error("Failed to get sharing info for item in `autofill-data.service`");const{permission:s}=r.data;return s?{isShared:!0,hasAdminPermission:s===f.y3.Admin}:{isShared:!1}}driverLicenseAutofillView(e){return Promise.all(e.driversLicensesResult.items.map((e=>{const t=T(P(C(e.expirationDate))),r=T(P(C(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:n.k.DriverLicense,expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:R(e.idNumber),issueDay:r.getDate(),issueMonth:r.getMonth()+1,issueYear:r.getFullYear(),issueDateFull:`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`,country:R(e.country),creationDate:P(e.creationDatetime),name:R(e.idName),state:R(e.state)}})))}emailAutofillView(e){return Promise.all(e.emailsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Email,email:R(e.emailAddress),name:R(e.itemName),type:e.type??"NO_TYPE"}))))}fiscalIdAutofillView(e){return Promise.all(e.fiscalIdsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.FiscalId,creationDate:P(e.creationDatetime),country:R(e.country),idNumber:R(e.fiscalNumber),teledeclarantNumber:R(e.teledeclarantNumber)}))))}identityAutofillView(e){return Promise.all(e.identitiesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Identity,age:w(e),birthDate:R(e.birthDate),birthPlace:R(e.birthPlace),firstName:R(e.firstName),lastName2:R(e.lastName2),lastName:R(e.lastName),middleName:R(e.middleName),middleNameInitial:R(e.middleName),pseudo:R(e.pseudo),title:R(e.title)}))))}idCardAutofillView(e){return Promise.all(e.idCardsResult.items.map((e=>{const t=T(P(C(e.expirationDate))),r=T(P(C(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:n.k.IdCard,country:R(e.country),creationDate:P(e.creationDatetime),expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:R(e.idNumber),issueDay:r.getDate(),issueMonth:r.getMonth()+1,issueYear:r.getFullYear(),issueDateFull:`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`,name:R(e.idName)}})))}noteAutofillView(e){return Promise.all(e.secureNotesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Note}))))}secretAutofillView(e){return Promise.all(e.secretsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Secret}))))}passportAutofillView(e){return Promise.all(e.passportsResult.items.map((e=>{const t=T(P(C(e.expirationDate))),r=T(P(C(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:n.k.Passport,country:e.country,creationDate:P(e.creationDatetime),deliveryPlace:e.issuePlace,expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:R(e.idNumber),issueDay:r.getDate(),issueMonth:r.getMonth()+1,issueYear:r.getFullYear(),issueDateFull:`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`,name:R(e.idName)}})))}paymentCardAutofillView(e){return Promise.all(e.paymentCardsResult.items.map((e=>{let t="";return e.cardNumber&&e.cardNumber.trim().length>0&&(t=e.cardNumber.trim().slice(-4)),{...this.baseItemAutofillView(e),vaultType:n.k.PaymentCard,bank:"",cardNumber:R(e.cardNumber),cardNumberLastDigits:t,color:e.color||"BLUE_1",expireMonth:R(e.expireMonth),expireYear:R(e.expireYear),name:R(e.itemName),ownerName:R(e.ownerName),securityCode:R(e.securityCode),type:"PAYMENT_TYPE_MASTERCARD"}})))}personalWebsiteAutofillView(e){return Promise.all(e.websitesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.PersonalWebsite,name:R(e.itemName),website:R(e.URL)}))))}phoneAutofillView(e){return Promise.all(e.phonesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Phone,name:R(e.itemName),numberInternational:R(e.numberInternational),number:R(e.phoneNumber),type:e.type}))))}socialSecurityIdAutofillView(e){return Promise.all(e.socialSecurityIdsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.SocialSecurityId,name:R(e.idName),idNumber:R(e.idNumber),country:R(e.country),creationDate:P(e.creationDatetime)}))))}filterPasskeys(e,t){return e.filter((e=>{const r=new I.Y(e.rpId).getHostname(),s=new I.Y(t).getHostname();return s===r||s.endsWith(`.${r}`)}))}passkeyAutofillView(e,t){const r=t?this.filterPasskeys(e.passkeysResult.items,t):e.passkeysResult.items;return Promise.all(r.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Passkey,credentialId:e.credentialId,rpId:e.rpId,rpName:e.rpName,userDisplayName:e.userDisplayName,userHandle:e.userHandle,counter:e.counter,keyAlgorithm:e.keyAlgorithm}))))}constructor(e,t,r){this.autofillSettings=e,this.linkedWebsitesClient=t,this.sharingItemsClient=r,this.mapVaultItemToAutofillView={[n.k.Address]:this.addressAutofillView.bind(this),[n.k.BankAccount]:this.bankAccountAutofillView.bind(this),[n.k.Company]:this.companyAutofillView.bind(this),[n.k.Credential]:this.credentialAutofillView.bind(this),[n.k.DriverLicense]:this.driverLicenseAutofillView.bind(this),[n.k.Email]:this.emailAutofillView.bind(this),[n.k.FiscalId]:this.fiscalIdAutofillView.bind(this),[n.k.GeneratedPassword]:()=>{},[n.k.IdCard]:this.idCardAutofillView.bind(this),[n.k.Identity]:this.identityAutofillView.bind(this),[n.k.Passkey]:this.passkeyAutofillView.bind(this),[n.k.Passport]:this.passportAutofillView.bind(this),[n.k.PaymentCard]:this.paymentCardAutofillView.bind(this),[n.k.Phone]:this.phoneAutofillView.bind(this),[n.k.Secret]:this.secretAutofillView.bind(this),[n.k.Note]:this.noteAutofillView.bind(this),[n.k.SocialSecurityId]:this.socialSecurityIdAutofillView.bind(this),[n.k.PersonalWebsite]:this.personalWebsiteAutofillView.bind(this),[n.k.NoteCategory]:()=>{}}}}D=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S.W?Object:S.W,void 0===E.X?Object:E.X,void 0===A.s?Object:A.s])],D);var N=r(41842),U=r(43978),F=r(21494),M=r(20754);class L{execute({body:{itemId:e,itemType:t,rootDomain:r}}){return this.autofillDataRepository.getAutofillData(t,e).pipe((0,N.h)((e=>(0,d.d6)(e))),(0,U.w)((e=>this.autofillDataService.getAutofillViewForItems(t,e,r))),(0,a.U)((e=>e[0])),(0,a.U)(d.Vp))}constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}}L=(0,s.__decorate)([(0,M.e)(F.a),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v?Object:v,void 0===D?Object:D])],L);var G=r(16433),K=r(37182),x=r(57655);class k{execute({body:{itemType:e,domain:t,sorting:r,filters:s}}){return this.autofillDataRepository.getAutofillData(e,void 0,r,s).pipe((0,N.h)((e=>(0,d.d6)(e))),(0,G.q)(1),(0,U.w)((r=>this.autofillDataService.getAutofillViewForItems(e,r,t))),(0,K.K)((e=>{throw new Error("get-multiple-autofill-data: error occured while mapping to autofill views: "+e)})),(0,a.U)(d.Vp))}constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}}k=(0,s.__decorate)([(0,M.e)(x.N),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v?Object:v,void 0===D?Object:D])],k);var j=r(24221);class V{execute({body:{searchQuery:e,itemTypes:t,domain:r,sorting:s}}){const i=t??[...Object.values(n.k).filter((e=>e!==n.k.GeneratedPassword&&e!==n.k.NoteCategory))];return this.autofillDataRepository.searchAutofillData(e,t,s).pipe((0,N.h)((e=>(0,d.d6)(e))),(0,U.w)((e=>Promise.all(i.map((t=>this.autofillDataService.getAutofillViewForItems(t,e,r)))))),(0,K.K)((e=>{throw new Error("search-autofill-data: error occured while mapping to autofill views: "+e)})),(0,a.U)((e=>e.flatMap((e=>e)))),(0,a.U)(d.Vp))}constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}}V=(0,s.__decorate)([(0,M.e)(j.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v?Object:v,void 0===D?Object:D])],V);class W{}W=(0,s.__decorate)([(0,i.Yl)({api:o.c,handlers:{commands:{},events:{},queries:{getSingleAutofillData:L,getMultipleAutofillData:k,searchAutofillData:V}},providers:[v,D]})],W)},32611:(e,t,r)=>{r.d(t,{V:()=>m});var s=r(88802),i=r(99634),o=r(92018),a=r(81459),n=r(57924);class c extends a.f{}c=(0,s.__decorate)([(0,n.GS)()],c);var d=r(63663),l=r(87279),u=r(73581);class p{execute({body:e}){const{credentialId:t}=e;return t&&this.autofillTrackingEventsEmitter.sendEvent("passwordAutofillPerformed",{credentialId:t}),Promise.resolve((0,l.Vp)(void 0))}constructor(e){this.autofillTrackingEventsEmitter=e}}p=(0,s.__decorate)([(0,d.W)(u.q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c?Object:c])],p);class m{}m=(0,s.__decorate)([(0,i.Yl)({api:o.Y,handlers:{commands:{temporaryEmitPasswordAutofillPerformedEvent:p},events:{},queries:{}},providers:[c]})],m)},93613:(e,t,r)=>{r.d(t,{J:()=>U});var s,i=r(88802),o=r(99634),a=r(46097),n=r(69885),c=r(87065),d=r(60399);!function(e){e.Manual="manual",e.Remember="remember"}(s||(s={}));var l=r(86252),u=r(64718),p=r(57924),m=r(87279),h=r(93843),g=r(48501),v=r(21543);const _=e=>Object.keys(e).map((t=>[t].concat(e[t]))),y=e=>[...e].sort();var S=r(2585),E=r(39431),f=r(50879);class A{getDashlaneDefinedLinkedWebsites$(e){return(0,n.of)(this._getDashlaneDefinedLinkedWebsites(e)).pipe((0,c.U)(m.Vp))}constructor(e,t){this.carbonLegacyClient=e,this.vaultItemsCrudClient=t,this.updateLinkedWebsites=async(e,t)=>{const r=await this.getCredentialById(t),s=this.getUserAddedLinkedWebsiteDomains(r),i=[...new Set(e)].filter(Boolean);var o,a;if(a=i,(o=s).length===a.length&&y(o).join("")===y(a).join(""))return;const n=0===i.length?[]:this.mergeLinkedWebsites(r,s,i),c={...r.LinkedServices,associated_domains:n},d=await this.carbonLegacyClient.commands.carbon({name:"updateCredential",args:[{id:t,update:{linkedServices:c}}]});if((0,m.hx)(d))throw new Error("Error when updating linked websites using updateCredential query from Carbon")},this.getCredentialByIdGraphene=e=>(0,d.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[E.U.Credential],ids:[e]}).pipe((0,c.U)((e=>(0,m.d6)(e)&&1===e.data.credentialsResult.matchCount?e.data.credentialsResult.items[0]:null)))),this.populateDashlaneDefinedLinkedWebsitesIndex=e=>{const t={};return e.forEach((e=>{e.forEach((r=>{t[r]=e}))})),t},this.mergeLinkedDomainsIntoList=(e,t)=>{const r=[],s=[];e.forEach((e=>{return i=t,e.some((e=>i.includes(e)))?r.push(e):s.push(e);var i}));const i=r.concat([t]).flat();return s.concat([i])},this.reduceLinkedDomainsLists=(e,t,r)=>e.concat(t,r).reduce(this.mergeLinkedDomainsIntoList,[]),this._getDashlaneDefinedLinkedWebsites=e=>{const t=new u.Y(e).getRootDomain();return t?this.allDashlaneDefinedLinkedWebsitesIndex[t]||[t]:[]},this.getCredentialById=e=>{const{carbonState:t}=this.carbonLegacyClient.queries;return(0,d.z)(t({path:"userSession.personalData.credentials"}).pipe((0,c.U)((t=>{if(!(0,m.d6)(t)||!(0,S.A)(t.data))throw new Error("Bad credential format");const r=t.data.find((t=>t.Id===e));if(r)return r;throw new Error("Cannot find credential")}))))},this.getUserAddedLinkedWebsiteDomains=e=>e.LinkedServices?.associated_domains?.flatMap((({domain:e})=>Boolean(e)?e:[]))??[],this.getNewLinkedWebsitesToAdd$=(e,t)=>t.filter((t=>!e.includes(t))).map(this.linkedWebsiteFormatter),this.linkedWebsiteFormatter=e=>({domain:e,source:s.Manual}),this.mergeLinkedWebsites=(e,t,r)=>[...(e.LinkedServices?.associated_domains??[]).filter((e=>r.includes(e.domain))),...this.getNewLinkedWebsitesToAdd$(t,r)],this.allDashlaneDefinedLinkedWebsitesIndex=this.populateDashlaneDefinedLinkedWebsitesIndex(this.reduceLinkedDomainsLists(h,_(v),_(g)).map((e=>[...new Set(e)])))}}A=(0,i.__decorate)([(0,p.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===l._?Object:l._,void 0===f.L?Object:f.L])],A);var I=r(63663),O=r(3535);class b{async execute({body:{credentialId:e,linkedWebsite:t}}){const r=await this.repository.getCredentialByIdGraphene(e);if(!r)return(0,m.Rn)((0,O.i6)());if(r.linkedURLs.find((e=>e===t)))return(0,m.Rn)((0,O.lD)());const s=await this.vaultItemsCrudClient.commands.updateVaultItem({vaultItemType:E.U.Credential,id:e,content:{linkedURLs:[...r.linkedURLs,t]}});return(0,m.hx)(s)?(0,m.Rn)((0,O.R6)()):(0,m.Vp)(void 0)}constructor(e,t){this.repository=e,this.vaultItemsCrudClient=t}}b=(0,i.__decorate)([(0,I.W)(O.vp),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===A?Object:A,void 0===f.L?Object:f.L])],b);var T=r(88026);class C{async execute({body:{credentialId:e,linkedWebsite:t}}){const r=await this.repository.getCredentialByIdGraphene(e);if(!r)return(0,m.Rn)((0,T.W4)());const s=await this.vaultItemsCrudClient.commands.updateVaultItem({vaultItemType:E.U.Credential,id:e,content:{linkedURLs:[...r.linkedURLs.filter((e=>e!==t))]}});return(0,m.hx)(s)?(0,m.Rn)((0,T.cQ)()):(0,m.Vp)(void 0)}constructor(e,t){this.repository=e,this.vaultItemsCrudClient=t}}C=(0,i.__decorate)([(0,I.W)(T.M7),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===A?Object:A,void 0===f.L?Object:f.L])],C);var w=r(9446);class R{async execute({body:{credentialId:e,updatedLinkedWebsitesList:t}}){try{return await this.linkedWebsites.updateLinkedWebsites(t,e),(0,m.Vp)(void 0)}catch(e){return(0,m.Rn)({tag:"",error:e instanceof Error?e:new Error("Update linked websites command failed")})}}constructor(e){this.linkedWebsites=e}}R=(0,i.__decorate)([(0,I.W)(w.A),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===A?Object:A])],R);var P=r(20754),D=r(66608);class N{execute({body:{url:e=""}}){return this.linkedWebsites.getDashlaneDefinedLinkedWebsites$(e)}constructor(e){this.linkedWebsites=e}}N=(0,i.__decorate)([(0,P.e)(D.J),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===A?Object:A])],N);class U{}U=(0,i.__decorate)([(0,o.Yl)({api:a.G,handlers:{commands:{addLinkedWebsite:b,removeLinkedWebsite:C,updateLinkedWebsites:R},events:{},queries:{getDashlaneDefinedLinkedWebsites:N}},providers:[A]})],U)},53183:(e,t,r)=>{r.d(t,{r:()=>I});var s=r(88802),i=r(45714),o=r(59325),a=r(99634),n=r(63663),c=r(87279),d=r(61933),l=r(57924),u=r(95681),p=r(23347),m=r(25029),h=r(10722);const g=e=>void 0!==e&&"boolean"==typeof e;class v extends((0,u.Q)({persist:!0,storage:{initialValue:!1,typeGuard:g,schemaVersion:1},scope:m.F.User,storeName:"autofill-disabled-notification",capacity:p.Y._001KB,codec:h.E})){}class _{get autofillDisabledOnLoginsAndFormsNotificationStatus(){return{get$:this._getAutofillDisabledOnLoginsAndFormsNotificationStatus$,set:this._setAutofillDisabledOnLoginsAndFormsNotificationStatus.bind(this)}}get _getAutofillDisabledOnLoginsAndFormsNotificationStatus$(){return this.store.state$}async _setAutofillDisabledOnLoginsAndFormsNotificationStatus(e){try{await this.store.set(e)}catch{throw new Error("SetAutofillDisabledOnLoginsAndFormsNotificationStatus command from autofill-core failed")}}constructor(e){this.store=e}}_=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v?Object:v])],_);class y{async execute({body:e}){const{status:t}=e;return await this.autofillDisabledNotificationRepository.autofillDisabledOnLoginsAndFormsNotificationStatus.set(t),(0,c.Vp)(void 0)}constructor(e){this.autofillDisabledNotificationRepository=e}}y=(0,s.__decorate)([(0,n.W)(d.a),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],y);var S=r(87065),E=r(20754),f=r(63208);class A{execute(){return this.repository.autofillDisabledOnLoginsAndFormsNotificationStatus.get$.pipe((0,S.U)(c.Vp))}constructor(e){this.repository=e}}A=(0,s.__decorate)([(0,E.e)(f.z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],A);class I{}I=(0,s.__decorate)([(0,a.Yl)({api:i._,handlers:{commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:y},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:A}},stores:[v],providers:[_],requiredFeatureFlips:Object.values(o.S)})],I)},39331:(e,t,r)=>{r.d(t,{k:()=>G});var s=r(88802),i=r(38554),o=r(59325),a=r(99634),n=r(63663),c=r(87279),d=r(94370),l=r(60399),u=r(57924),p=r(95681),m=r(23347),h=r(25029),g=r(10722);const v=e=>!!e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)))&&Object.keys(e).every((e=>"string"==typeof e));class _ extends((0,p.Q)({persist:!0,storage:{initialValue:{},typeGuard:v,schemaVersion:1},scope:h.F.User,storeName:"phishing-prevention-optouts",capacity:m.Y._010KB,codec:g.E})){}class y{get phishingPreventionOptOuts(){return{get$:this._getPhishingPreventionOptOuts$,set$:this._setPhishingPreventionOptOut.bind(this)}}async disablePhishingPreventionForUrl(e,t){const r=await(0,l.z)(this._getPhishingPreventionOptOuts$),s={...r,[e]:Array.from(new Set(r[e]??[]).add(t))};await this._setPhishingPreventionOptOut(s)}get _getPhishingPreventionOptOuts$(){return this.store.state$}async _setPhishingPreventionOptOut(e){try{await this.store.set(e)}catch{throw new Error("SetPhishingPreventionOptOut command from autofill-core has failed")}}constructor(e){this.store=e}}y=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],y);class S{async execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return await this.phishingPreventionRepository.disablePhishingPreventionForUrl(e,t),(0,c.Vp)(void 0)}constructor(e){this.phishingPreventionRepository=e}}S=(0,s.__decorate)([(0,n.W)(d.z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y?Object:y])],S);var E=r(20754),f=r(51730),A=r(87065),I=r(85390),O=r(69885),b=r(86252),T=r(78364),C=r(52434),w=r(2585);class R{getIsVaultItemProtected$(e,t){return this._isVaultItemProtected(e,t).pipe((0,A.U)(c.Vp))}getIsPhishingPreventionEnabled$(){return this._isPhishingPreventionEnabled().pipe((0,A.U)(c.Vp))}constructor(e){this.carbonLegacyClient=e,this.isUserSSO=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,A.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve premium status");return e.spaces})),(0,A.U)((e=>e?.[0].isSSOUser??!1)))},this.areProtectedItemsUnlocked=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return(0,I.a)([e({path:"userSession.session.lastMasterPasswordCheck"}),e({path:"userSession.account.login"})]).pipe((0,A.U)((([e,t])=>{if(!(0,c.d6)(e)||"number"!=typeof e.data)throw new Error("Cannot retrieve last master password check");if(!(0,c.d6)(t)||"string"!=typeof t.data)throw new Error("No active login");const r=e.data,s=t.data;return Date.now()-r<(/^kw_test_auto_fmpc_.*/.test(s)?5e3:3e5)})))},this.isItemUnlocked=()=>(0,I.a)([this.areProtectedItemsUnlocked(),this.isUserSSO()]).pipe((0,A.U)((([e,t])=>e||t))),this.isGlobalCredentialProtectionSettingOn=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.ProtectPasswords"}).pipe((0,A.U)((e=>{if(!(0,c.d6)(e)||"boolean"!=typeof e.data)throw new Error("No global setting found");return e.data})))},this.getCredentialProtectionStatus=e=>{const{carbonState:t}=this.carbonLegacyClient.queries;return t({path:"userSession.personalData.credentials"}).pipe((0,A.U)((t=>{if(!(0,c.d6)(t)||!(0,w.A)(t.data))throw new Error("Bad credential format");const r=t.data;return r.find((t=>t.Id===e))?.AutoProtected??!1})))},this.getIsMPRequiredForCreditCardOrSocialSecurityId=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.SecuredDataAutofillCreditcard"}).pipe((0,A.U)((e=>!(0,c.d6)(e)||"boolean"!=typeof e.data||e.data)))},this._isVaultItemProtected=(e,t)=>e===T.k.PaymentCard||e===T.k.SocialSecurityId?(0,I.a)([this.isItemUnlocked(),this.getIsMPRequiredForCreditCardOrSocialSecurityId()]).pipe((0,A.U)((([e,t])=>({disableMode:C.M.CannotDisable,isProtected:t&&!e})))):e===T.k.Credential?(0,I.a)([this.isItemUnlocked(),this.isGlobalCredentialProtectionSettingOn(),this.getCredentialProtectionStatus(t)]).pipe((0,A.U)((([e,t,r])=>t?{disableMode:C.M.DisableGeneralSetting,isProtected:!e}:{disableMode:C.M.DisableSpecificVaultItem,isProtected:r&&!e}))):(0,O.of)({disableMode:C.M.CannotDisable,isProtected:!1}),this._isPhishingPreventionEnabled=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.nodePremiumStatus"}).pipe((0,A.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve premium status");const t=e.data;return t.capabilities?.autofillWithPhishingPrevention.enabled??!1})))}}}R=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b._?Object:b._])],R);class P{execute({body:e}){const{vaultItemId:t,vaultType:r}=e;return this.autofillSecurity.getIsVaultItemProtected$(r,t)}constructor(e){this.autofillSecurity=e}}P=(0,s.__decorate)([(0,E.e)(f.u),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===R?Object:R])],P);var D=r(5282);class N{execute(){return this.autofillSecurity.getIsPhishingPreventionEnabled$()}constructor(e){this.autofillSecurity=e}}N=(0,s.__decorate)([(0,E.e)(D.i),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===R?Object:R])],N);var U=r(63212);class F{execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return this.phishingPreventionRepository.phishingPreventionOptOuts.get$.pipe((0,A.U)((r=>e in r&&(r[e]??[]).includes(t))),(0,A.U)(c.Vp))}constructor(e){this.phishingPreventionRepository=e}}F=(0,s.__decorate)([(0,E.e)(U.v),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y?Object:y])],F);var M=r(93555);class L{async execute(){const{carbon:e}=this.carbonLegacyClient.commands,t=await e({name:"resetProtectedItemAutofillTimer",args:[]});return(0,c.hx)(t)?(0,c.Rn)({tag:"ResetProtectedItemAutofillTimer command from autofill/security failed"}):(0,c.Vp)(void 0)}constructor(e){this.carbonLegacyClient=e}}L=(0,s.__decorate)([(0,n.W)(M.y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b._?Object:b._])],L);class G{}G=(0,s.__decorate)([(0,a.Yl)({api:i.V,handlers:{commands:{resetProtectedItemAutofillTimer:L,disablePhishingPreventionForUrl:S},events:{},queries:{getAutofillProtectionContext:P,isPhishingPreventionCapabilityEnabled:N,isPhishingPreventionDisabledForUrl:F}},stores:[_],providers:[R,y],requiredFeatureFlips:Object.values(o.S)})],G)},2585:(e,t,r)=>{r.d(t,{A:()=>i});var s=r(57789);const i=e=>Array.isArray(e)&&e.every((e=>null!==e&&"object"==typeof e&&"kwType"in e&&(0,s.G)(e)))},75644:(e,t,r)=>{r.d(t,{P:()=>Ee});var s=r(88802),i=r(69029),o=r(59325),a=r(99634),n=r(63663),c=r(87279),d=r(99682),l=r(60399),u=r(87065),p=r(97280),m=r(86252),h=r(57924),g=r(46154),v=r(28489);var _=r(2585),y=r(39431);class S{get credentialsPreferences(){return{getByIds:this._getPreferencesForCredentials$.bind(this),set:this._setCredentialPreferences.bind(this)}}get isAutofillDisabled(){return{get$:this._getIsAutofillDisabled$,set:this._setIsAutofillDisabled.bind(this)}}get isAutologinDisabled(){return{get$:this._getIsAutologinDisabled$,set:this._setIsAutologinDisabled.bind(this)}}get disabledDomains(){return{get$:this._getDisabledDomains$,set:this._setDisabledDomains.bind(this),add:this._addDisabledDomains.bind(this),remove:this._removeDisabledDomains.bind(this)}}get disabledSourceTypes(){return{get$:this._getDisabledSourceTypes$,set:this._setDisabledSourceTypes.bind(this),add:this._addDisabledSourceTypes.bind(this),remove:this._removeDisabledSourceTypes.bind(this)}}get isFollowUpNotificationEnabled(){return{get$:this._getIsFollowUpNotificationEnabled$,set:this._setIsFollowUpNotificationEnabled.bind(this)}}async _updateSettings(e){const t=e.isAutofillDisabled??await(0,l.z)(this._getIsAutofillDisabled$),r=e.isAutologinDisabled??await(0,l.z)(this._getIsAutologinDisabled$),s=e.disabledDomains??await(0,l.z)(this._getDisabledDomains$),i=e.disabledSourceTypes??await(0,l.z)(this._getDisabledSourceTypes$),o=e.isFollowUpNotificationEnabled??await(0,l.z)(this._getIsFollowUpNotificationEnabled$),a=await this.carbonLegacyClient.commands.carbon({name:"updateAutofillSettings",args:[{AutofillSettings:{disabledDomains:s,disabledSourceTypes:i,isAutofillDisabled:t,isAutologinDisabled:r,isFollowUpNotificationEnabled:o}}]});if((0,c.hx)(a))throw new Error("Error when updating autofill settings using updateAutofillSettings query from Carbon")}get _getAutofillSettings$(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.AutofillSettings"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e)||!(e=>!!e&&"object"==typeof e&&(0,v.l$)(e,"isAutofillDisabled")&&"boolean"==typeof e.isAutofillDisabled&&(0,v.l$)(e,"isAutologinDisabled")&&"boolean"==typeof e.isAutologinDisabled&&(0,v.l$)(e,"disabledSourceTypes")&&(0,g.rF)(e.disabledSourceTypes)&&(0,v.l$)(e,"disabledDomains")&&Array.isArray(e.disabledDomains)&&e.disabledDomains.every((e=>"string"==typeof e))&&(0,v.l$)(e,"isFollowUpNotificationEnabled")&&"boolean"==typeof e.isFollowUpNotificationEnabled)(e.data))throw new Error("AutofillSettings is not of the expected type");return e.data})),(0,p.d)(1))}async _setCredentialPreferences({credentialId:e,credentialUrl:t,onlyAutofillExactDomain:r,requireMasterPassword:s,useAutoLogin:i,shouldSkipSync:o}){const{carbonLegacyLeeloo:a}=this.carbonLegacyClient.commands,n=await a({name:"savePersonalDataItem",arg:[{kwType:y.U.Credential,origin:"MANUAL",content:{id:e,url:t,onlyForThisSubdomain:r,autoLogin:i,protectWithMasterPassword:s},shouldSkipSync:o}]});if((0,c.hx)(n))throw new Error(`Failed to update credential preferences for: ${e}`)}_getPreferencesForCredentials$(e){const{carbonState:t}=this.carbonLegacyClient.queries;return t({path:"userSession.personalData.credentials"}).pipe((0,u.U)((t=>{if((0,c.hx)(t)||!(0,_.A)(t.data))throw new Error("Bad credentials format when retrieving credential preferences");const r=e.length?t.data.filter((t=>e.includes(t.Id))):t.data;if(e.length&&r.length!==e.length)throw new Error("not able to find one or more credentials corresponding to the provided ids");return(0,c.Vp)(r.map((e=>({id:e.Id,useAutoLogin:Boolean(e.AutoLogin),onlyAutofillExactDomain:Boolean(e.SubdomainOnly),requireMasterPassword:Boolean(e.AutoProtected)}))))})))}get _getIsAutofillDisabled$(){return this._getAutofillSettings$.pipe((0,u.U)((({isAutofillDisabled:e})=>e)))}_setIsAutofillDisabled(e){return this._updateSettings({isAutofillDisabled:e})}get _getIsAutologinDisabled$(){return this._getAutofillSettings$.pipe((0,u.U)((({isAutologinDisabled:e})=>e)))}_setIsAutologinDisabled(e){return this._updateSettings({isAutologinDisabled:e})}_setIsFollowUpNotificationEnabled(e){return this._updateSettings({isFollowUpNotificationEnabled:e})}get _getDisabledDomains$(){return this._getAutofillSettings$.pipe((0,u.U)((({disabledDomains:e})=>e)))}_setDisabledDomains(e){return this._updateSettings({disabledDomains:e})}async _addDisabledDomains(e){const t=await(0,l.z)(this._getDisabledDomains$);return this._setDisabledDomains([...new Set([...t,...e])])}async _removeDisabledDomains(e){const t=await(0,l.z)(this._getDisabledDomains$);return this._setDisabledDomains(t.filter((t=>!e.includes(t))))}get _getDisabledSourceTypes$(){return this._getAutofillSettings$.pipe((0,u.U)((({disabledSourceTypes:e})=>e)))}_setDisabledSourceTypes(e){return this._updateSettings({disabledSourceTypes:e})}async _addDisabledSourceTypes(e){const t=await(0,l.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes([...new Set([...t,...e])])}async _removeDisabledSourceTypes(e){const t=await(0,l.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes(t.filter((t=>!e.includes(t))))}get _getIsFollowUpNotificationEnabled$(){return this._getAutofillSettings$.pipe((0,u.U)((({isFollowUpNotificationEnabled:e})=>e)))}constructor(e){this.carbonLegacyClient=e}}S=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._])],S);class E{async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.add(e),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}E=(0,s.__decorate)([(0,n.W)(d.g),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],E);var f=r(3909);class A{async execute(){return await this.settings.isAutofillDisabled.set(!0),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}A=(0,s.__decorate)([(0,n.W)(f.u),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],A);var I=r(65791);class O{async execute(){return await this.settings.disabledSourceTypes.add([...g.up]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}O=(0,s.__decorate)([(0,n.W)(I.t),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],O);var b=r(56e3);class T{async execute(){return await this.settings.disabledSourceTypes.add([...g.q_]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}T=(0,s.__decorate)([(0,n.W)(b.f),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],T);var C=r(34962);class w{async execute(){return await this.settings.isAutologinDisabled.set(!0),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}w=(0,s.__decorate)([(0,n.W)(C.T),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],w);var R=r(11232);class P{async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!1),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}P=(0,s.__decorate)([(0,n.W)(R.y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],P);var D=r(54405);class N{async execute(){return await this.settings.isAutofillDisabled.set(!1),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}N=(0,s.__decorate)([(0,n.W)(D.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],N);var U=r(38018);class F{async execute(){return await this.settings.disabledSourceTypes.remove([...g.up]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}F=(0,s.__decorate)([(0,n.W)(U.a),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],F);var M=r(69643);class L{async execute(){return await this.settings.disabledSourceTypes.remove([...g.q_]),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}L=(0,s.__decorate)([(0,n.W)(M.I),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],L);var G=r(4924);class K{async execute(){return await this.settings.isAutologinDisabled.set(!1),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}K=(0,s.__decorate)([(0,n.W)(G.i),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],K);var x=r(82796);class k{async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!0),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}k=(0,s.__decorate)([(0,n.W)(x.B),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],k);var j=r(46918);class V{async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.remove(e),(0,c.Vp)(void 0)}constructor(e){this.settings=e}}V=(0,s.__decorate)([(0,n.W)(j.v),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],V);var W=r(29641),B=r(3124),z=r(95681),H=r(23347),Y=r(25029),Q=r(10722);const q=e=>!!e&&(0,B.P)(e);class $ extends((0,z.Q)({persist:!0,storage:{initialValue:[],typeGuard:q,schemaVersion:1},scope:Y.F.Device,storeName:"user-autofill-corrections",capacity:H.Y._100KB,codec:Q.E})){}class X{get userAutofillCorrections(){return{get$:this._getUserAutofillCorrections$,set:this._setUserAutofillCorrections.bind(this)}}get _getUserAutofillCorrections$(){return this.store.state$}async _setUserAutofillCorrections(e){try{await this.store.set(e)}catch{throw new Error("SetUserAutofillCorrections command from core-autofill failed")}}constructor(e){this.store=e}}X=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===$?Object:$])],X);class Z{async execute({body:e}){const{corrections:t}=e;return await this.correctionsRepository.userAutofillCorrections.set(t),(0,c.Vp)(void 0)}constructor(e){this.correctionsRepository=e}}Z=(0,s.__decorate)([(0,n.W)(W.S),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===X?Object:X])],Z);var J=r(50163);class ee{async execute({body:e}){const{isAutofillEnabled:t,url:r}=e,{carbon:s}=this.carbonLegacyClient.commands,i=await s({name:"toggleDashlane",args:[{where:"site",autofill:t,autologin:t,url:r}]});if((0,c.hx)(i))throw new Error("Toggle Dashlane command from core-autofill failed");return(0,c.Vp)(void 0)}constructor(e){this.carbonLegacyClient=e}}ee=(0,s.__decorate)([(0,n.W)(J.r),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._])],ee);var te=r(15269);class re{async execute({body:e}){try{return await this.autofillSettings.credentialsPreferences.set(e),(0,c.Vp)(void 0)}catch(e){const t=e instanceof Error?e.message:"unable to update credential preferences";return(0,c.Rn)({tag:"error",errorMessage:t})}}constructor(e){this.autofillSettings=e}}re=(0,s.__decorate)([(0,n.W)(te.J),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],re);var se=r(85390),ie=r(43978),oe=r(20754),ae=r(64718),ne=r(68573);var ce,de,le;!function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(ce||(ce={})),function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(de||(de={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(le||(le={}));const ue=e=>{if(!(t=e)||"object"!=typeof t||!(0,v.l$)(t,"status")||"number"!=typeof t.status)throw new Error("twoFactorAuthentication is not of the expected type");var t;return 3===e.status&&e.shouldEnforceTwoFactorAuthentication},pe=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>"string"==typeof e));class me{execute({body:{url:e}}){const{carbonState:t}=this.carbonLegacyClient.queries,r=new ae.Y(e),s=r.getRootDomain(),i=r.getHost(),o=t({path:"device.killswitch.disableAutofill"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e)||!(e=>"boolean"==typeof e)(e.data))throw new Error("Error when fetching killswitch.disableAutofill");return e.data}))),a=(0,se.a)({isAutofillDisabled:this.settings.isAutofillDisabled.get$,disabledDomains:this.settings.disabledDomains.get$}).pipe((0,ie.w)((async({isAutofillDisabled:e,disabledDomains:t})=>e||t.includes(await s)))),n=t({path:"userSession.spaceData.spaces"}).pipe((0,ie.w)((async e=>{if(!(0,c.d6)(e)||!(e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>(0,v.l$)(e,"details")&&(0,v.l$)(e.details,"info"))))(e.data))throw new Error("Error when fetching spaceData.spaces");const t=e.data.reduce(((e,t)=>{const r=t.details.info.autologinDomainDisabledArray;return[...e,...pe(r)?r:[]]}),[]),r=await i;return t.some((e=>{const t=new ae.Y(e).getHost();return t===r||r.endsWith(`.${t}`)}))}))),d=t({path:"authentication.twoFactorAuthentication"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e))throw new Error("Error when fetching authentication.twoFactorAuthentication");return ue(e.data)})));return(0,se.a)({isAutofillDisabledByB2BAdmin:n,isAutofillDisabledByKillswitch:o,isAutofillDisabledByUser:a,isAutofillDisabledBy2FAEnforcement:d}).pipe((0,u.U)((({isAutofillDisabledBy2FAEnforcement:e,isAutofillDisabledByB2BAdmin:t,isAutofillDisabledByKillswitch:r,isAutofillDisabledByUser:s})=>{let i=ne._.ANALYSIS_ENABLED;return r?i=ne._.ANALYSIS_DISABLED_BY_KILLSWITCH:t?i=ne._.ANALYSIS_DISABLED_BY_B2B_ADMIN:s?i=ne._.ANALYSIS_DISABLED_BY_USER:e&&(i=ne._.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT),(0,c.Vp)({analysisStatus:i})})))}constructor(e,t){this.carbonLegacyClient=e,this.settings=t}}me=(0,s.__decorate)([(0,oe.e)(ne.h),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m._?Object:m._,void 0===S?Object:S])],me);var he=r(63267);class ge{execute(){return(0,se.a)({disabledDomains:this.settings.disabledDomains.get$,disabledSourceTypes:this.settings.disabledSourceTypes.get$,isAutofillDisabled:this.settings.isAutofillDisabled.get$,isAutologinDisabled:this.settings.isAutologinDisabled.get$,isFollowUpNotificationEnabled:this.settings.isFollowUpNotificationEnabled.get$}).pipe((0,u.U)(c.Vp))}constructor(e){this.settings=e}}ge=(0,s.__decorate)([(0,oe.e)(he.T),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],ge);var ve=r(3414);class _e{execute(){return this.settings.userAutofillCorrections.get$.pipe((0,u.U)(c.Vp))}constructor(e){this.settings=e}}_e=(0,s.__decorate)([(0,oe.e)(ve.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===X?Object:X])],_e);var ye=r(95371);class Se{execute({body:{credentialIds:e=[]}}){return this.autofillSettingsRepository.credentialsPreferences.getByIds(e)}constructor(e){this.autofillSettingsRepository=e}}Se=(0,s.__decorate)([(0,oe.e)(ye.g),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===S?Object:S])],Se);class Ee{}Ee=(0,s.__decorate)([(0,a.Yl)({api:i.I,handlers:{commands:{toggleDashlane:ee,enableAnalysis:N,enableAutologin:K,enableAutofillOnForms:F,enableAutofillOnLogins:L,enableFollowUpNotification:k,disableAnalysis:A,disableAutologin:w,disableAutofillOnForms:O,disableAutofillOnLogins:T,disableFollowUpNotification:P,addDisabledSourceTypes:E,removeDisabledSourceTypes:V,setUserAutofillCorrections:Z,updateCredentialPreferences:re},events:{},queries:{getAnalysisStatusOnUrl:me,getAutofillSettings:ge,getUserAutofillCorrections:_e,getPreferencesForCredentials:Se}},stores:[$],providers:[S,X],requiredFeatureFlips:Object.values(o.S)})],Ee)},11712:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(86952),i=r(43890);const o=(0,s.Q)({name:"notifications",commands:{},events:{},queries:{GetUserMessagesQuery:i.m}})},43890:(e,t,r)=>{r.d(t,{m:()=>a});var s,i=r(99059),o=r(25029);!function(e){e.DEFAULT="default",e.TRIAL_EXPIRED="trial_expired",e.WEB_STORE="web_store",e.DASHBOARD_UPGRADE="dashboard_upgrade",e.SHARING_CENTER_FAMILY="sharing_center_family",e.SHARING_CENTER_WORK="sharing_center_work"}(s||(s={}));class a extends((0,i.k)({scope:o.F.User})){}},32127:(e,t,r)=>{r.d(t,{F:()=>p});var s=r(88802),i=r(99634),o=r(11712),a=r(93850),n=r(20754),c=r(86252),d=r(43890),l=r(48844);class u{execute(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.userMessages"}).pipe((0,l.Qn)((e=>e)))}constructor(e){this.carbonLegacyClient=e}}u=(0,s.__decorate)([(0,n.e)(d.m),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c._?Object:c._])],u);class p{}p=(0,s.__decorate)([(0,i.Yl)({api:o.B,handlers:{commands:{},events:{},queries:{getUserMessages:u}},imports:[a.n],providers:[]})],p)},47071:(e,t,r)=>{r.d(t,{U:()=>l});var s=r(86952),i=r(46221),o=r(59771),a=r(50299),n=r(84119),c=r(74779),d=r(55267);const l=(0,s.Q)({name:"getStarted",commands:{dismissGetStarted:i.A,markAdminConsoleOpened:o.T},events:{},queries:{hasCompletedAutofillTutorial:a.G,hasCompletedCredentialTutorial:n.x,hasOpenedAdminConsole:c.s,isGetStartedDismissed:d.A}})},46221:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},59771:(e,t,r)=>{r.d(t,{T:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},50299:(e,t,r)=>{r.d(t,{G:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},84119:(e,t,r)=>{r.d(t,{x:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},74779:(e,t,r)=>{r.d(t,{s:()=>i});var s=r(99059);class i extends((0,s.k)()){}},55267:(e,t,r)=>{r.d(t,{A:()=>i});var s=r(99059);class i extends((0,s.k)()){}},39312:(e,t,r)=>{r.d(t,{$:()=>F});var s,i=r(88802),o=r(99634),a=r(47071);!function(e){e.OnboardingWebProfileNewUsers="onboarding_web_profileNewUsers_dev",e.OnboardingWebAdminVaultGetStartedGuide="onboarding_web_adminVaultGetStartedGuide",e.OnboardingWebConfirmSite="onboarding_web_onboarding",e.OnboardingWebExtensionInstallStaticBanner="onboarding_web_extensionInstallStaticBanner",e.OnboardingWebFirstInviteAndShare="onboarding_web_firstInviteAndShare",e.SaexOnboardingHubAddPasswords="saexOnboardingHubAddPasswords"}(s||(s={}));var n=r(25029),c=r(95681),d=r(23347),l=r(10722),u=r(7165);const p=u.z.object({hasOpenedAdminConsole:u.z.boolean(),isGetStartedDismissed:u.z.boolean()}),m=e=>p.safeParse(e).success;class h extends((0,c.Q)({storage:{schemaVersion:1,initialValue:{hasOpenedAdminConsole:!1,isGetStartedDismissed:!1},typeGuard:m},persist:!0,scope:n.F.User,storeName:"onboarding-get-started-store",capacity:d.Y._010KB,codec:l.E})){}var g=r(63663),v=r(87279),_=r(46221);class y{async execute(){const e=await this.store.getState();return await this.store.set({...e,isGetStartedDismissed:!0}),Promise.resolve((0,v.Vp)(void 0))}constructor(e){this.store=e}}y=(0,i.__decorate)([(0,g.W)(_.A),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===h?Object:h])],y);var S=r(59771);class E{async execute(){const e=await this.store.getState();return await this.store.set({...e,hasOpenedAdminConsole:!0}),Promise.resolve((0,v.Vp)(void 0))}constructor(e){this.store=e}}E=(0,i.__decorate)([(0,g.W)(S.T),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===h?Object:h])],E);var f=r(20754),A=r(50299),I=r(57924),O=r(86252),b=r(87065);class T{get(){return this.carbonLegacyClient.queries.getWebOnboardingMode().pipe((0,b.U)((e=>{if(!(0,v.d6)(e))throw new Error("Error while retrieving the legacy onboarding state");return e.data.completedSteps})))}getAutofillTaskCompletion(){return this.get().pipe((0,b.U)((e=>(0,v.Vp)(!!e?.tryAutofillOnWeb))))}getCredentialTaskCompletion(){return this.get().pipe((0,b.U)((e=>(0,v.Vp)(!!e?.saveCredentialOnWeb))))}constructor(e){this.carbonLegacyClient=e}}T=(0,i.__decorate)([(0,I.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===O._?Object:O._])],T);class C{execute(){return this.onboardingStateGetterService.getAutofillTaskCompletion()}constructor(e){this.onboardingStateGetterService=e}}C=(0,i.__decorate)([(0,f.e)(A.G),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===T?Object:T])],C);var w=r(84119);class R{execute(){return this.onboardingStateGetterService.getCredentialTaskCompletion()}constructor(e){this.onboardingStateGetterService=e}}R=(0,i.__decorate)([(0,f.e)(w.x),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===T?Object:T])],R);var P=r(74779);class D{execute(){return this.store.state$.pipe((0,b.U)((e=>(0,v.Vp)(e.hasOpenedAdminConsole))))}constructor(e){this.store=e}}D=(0,i.__decorate)([(0,f.e)(P.s),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===h?Object:h])],D);var N=r(55267);class U{execute(){return this.store.state$.pipe((0,b.U)((e=>(0,v.Vp)(e.isGetStartedDismissed))))}constructor(e){this.store=e}}U=(0,i.__decorate)([(0,f.e)(N.A),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===h?Object:h])],U);class F{}F=(0,i.__decorate)([(0,o.Yl)({api:a.U,stores:[h],handlers:{commands:{dismissGetStarted:y,markAdminConsoleOpened:E},events:{},queries:{hasCompletedAutofillTutorial:C,hasCompletedCredentialTutorial:R,hasOpenedAdminConsole:D,isGetStartedDismissed:U}},providers:[T],requiredFeatureFlips:Object.values(s)})],F)},25593:(e,t,r)=>{r.d(t,{J:()=>a});var s=r(86952),i=r(3100),o=r(17308);const a=(0,s.Q)({name:"antiphishing",commands:{addAutoRedirectedDomain:i.A},events:{},queries:{isAutoRedirectedDomain:o.U}})},3100:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},17308:(e,t,r)=>{r.d(t,{U:()=>i});var s=r(99059);class i extends((0,s.k)()){}},66706:(e,t,r)=>{r.d(t,{H:()=>c});var s=r(86952),i=r(87425),o=r(29362),a=r(60466),n=r(5202);const c=(0,s.Q)({name:"breaches",commands:{dismissBreach:i.n,markBreachAsSeen:o.Q},events:{},queries:{breach:a.i,unreadBreachesCount:n.L}})},71926:(e,t,r)=>{var s,i;r.d(t,{J:()=>s,K:()=>i}),function(e){e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED"}(s||(s={})),function(e){e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social"}(i||(i={}))},87425:(e,t,r)=>{r.d(t,{n:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},29362:(e,t,r)=>{r.d(t,{Q:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},60466:(e,t,r)=>{r.d(t,{i:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},5202:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},36282:(e,t,r)=>{r.d(t,{M:()=>d});var s=r(86952),i=r(92452),o=r(11959),a=r(49590),n=r(27655),c=r(43473);const d=(0,s.Q)({name:"emailMonitoring",commands:{dismissOnboardingNotification:i.n,optinEmail:o.P5,optoutEmail:a.Lc},events:{},queries:{emailList:n.dB,onboardingNotificationState:c.p}})},92452:(e,t,r)=>{r.d(t,{n:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},11959:(e,t,r)=>{r.d(t,{Dq:()=>a,Iy:()=>c,P5:()=>p,Qj:()=>l,XX:()=>n,pK:()=>d,tp:()=>u});var s=r(74354),i=r(25029),o=r(96168);const a="OK";var n;!function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.ALREADY_SUBSCRIBED="USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",e.TOO_MANY_SUBSCRIPTIONS="USER_HAS_TOO_MANY_SUBSCRIPTIONS",e.GENERIC_ERROR="GENERIC_ERROR"}(n||(n={}));const c=(0,o.Vj)("EMAIL_IS_INVALID",""),d=(0,o.Vj)("USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",""),l=(0,o.Vj)("USER_HAS_TOO_MANY_SUBSCRIPTIONS",""),u=(0,o.Vj)("GENERIC_ERROR","");class p extends((0,s.g)({scope:i.F.User})){}},49590:(e,t,r)=>{r.d(t,{KP:()=>n,Lc:()=>u,QS:()=>a,h1:()=>d,uD:()=>c,v4:()=>l});var s=r(74354),i=r(25029),o=r(96168);const a="OK";var n;!function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.NO_SUBSCRIPTION="USER_HAS_NO_SUBSCRIPTION",e.GENERIC_ERROR="GENERIC_ERROR"}(n||(n={}));class c extends((0,o.Hu)("EMAIL_IS_INVALID","")){}class d extends((0,o.Hu)("USER_HAS_NO_SUBSCRIPTION","")){}class l extends((0,o.Hu)("GENERIC_ERROR","")){}class u extends((0,s.g)({scope:i.F.User})){}},29987:(e,t,r)=>{var s;function i(e){return"UNKNOWN"===e||"SEEN"===e||"NOT_SEEN"===e}r.d(t,{M:()=>s,U:()=>i}),function(e){e.UNKNOWN="UNKNOWN",e.SEEN="SEEN",e.NOT_SEEN="NOT_SEEN"}(s||(s={}))},27655:(e,t,r)=>{r.d(t,{a2:()=>o,dB:()=>a,wp:()=>s});var s,i=r(99059);function o(e){return"pending"===e||"active"===e||"disabled"===e}!function(e){e.PENDING="pending",e.ACTIVE="active",e.DISABLED="disabled"}(s||(s={}));class a extends((0,i.k)()){}},43473:(e,t,r)=>{r.d(t,{p:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},77997:(e,t,r)=>{r.r(t),r.d(t,{AddAutoRedirectedDomainCommand:()=>F.A,BreachLeakedDataType:()=>g.K,BreachQuery:()=>m.i,BreachState:()=>g.J,CompromisedCredentialsIdsForBreachQuery:()=>I.A,CompromisedCredentialsQuery:()=>f.v,CorruptionDataSeverity:()=>w.bp,CorruptionDataStrength:()=>w.ub,CredentialHealthDataQuery:()=>_.w,DarkWebOnboardingState:()=>d.M,DataLeaksEmailStatus:()=>n.wp,DismissBreachCommand:()=>u.n,DismissOnboardingNotificationCommand:()=>i.n,EmailsListQuery:()=>n.dB,FilterCredentialsIdsQuery:()=>E.M,FilterCredentialsQuery:()=>S.Q,HealthFilter:()=>w._x,IsAutoRedirectedDomainQuery:()=>U.U,MarkBreachAsSeenCommand:()=>p.Q,OnboardingNotificationStateQuery:()=>c.p,OptinDataLeaksResultErrorCode:()=>o.XX,OptinDataLeaksResultOkCode:()=>o.Dq,OptinEmailCommand:()=>o.P5,OptoutDataLeaksResultErrorCode:()=>a.KP,OptoutDataLeaksResultOkCode:()=>a.QS,OptoutEmailCommand:()=>a.Lc,OptoutGenericError:()=>a.v4,OptoutInvalidEmailError:()=>a.uD,OptoutNoSubscriptionError:()=>a.h1,OtpCodeForSecretOrUrlGenerationError:()=>G.k,OtpCodeForSecretOrUrlQuery:()=>G.S,OtpCodeGenerationError:()=>L.c,OtpCodeQuery:()=>L.J,PasswordHealthClient:()=>R.L,PasswordHealthComputationFinishedEvent:()=>C.w,PasswordHealthFeatureFlips:()=>P.c,PasswordHealthReportQuery:()=>A.b,RecalculatePasswordHealthCommand:()=>T.t,RiskType:()=>w.gI,ScoreForPasswordQuery:()=>O.c,ScoreQuery:()=>y.e,SetupOtpCodeForCredentialCommand:()=>K.z,UnreadBreachesCountQuery:()=>h.L,UpdateIsCredentialExcludedCommand:()=>b.v,antiphishingApi:()=>N.J,breachesApi:()=>l.H,createOptinAlreadySubscribedError:()=>o.pK,createOptinGenericError:()=>o.tp,createOptinInvalidEmailError:()=>o.Iy,createOptinTooManySubscriptionsError:()=>o.Qj,emailMonitoringApi:()=>s.M,isDarkWebOnboardingState:()=>d.U,isDataLeaksEmailStatus:()=>n.a2,otpApi:()=>M.i,passwordHealthApi:()=>v.d,vaultReportApi:()=>D.f});var s=r(36282),i=r(92452),o=r(11959),a=r(49590),n=r(27655),c=r(43473),d=r(29987),l=r(66706),u=r(87425),p=r(29362),m=r(60466),h=r(5202),g=r(71926),v=r(68754),_=r(17430),y=r(25374),S=r(22231),E=r(44955),f=r(35642),A=r(61613),I=r(69134),O=r(94449),b=r(45101),T=r(52835),C=r(94388),w=r(20987),R=r(37109),P=r(29732),D=r(97203),N=r(25593),U=r(17308),F=r(3100),M=r(6538),L=r(85869),G=r(81721),K=r(34621)},6538:(e,t,r)=>{r.d(t,{i:()=>n});var s=r(86952),i=r(34621),o=r(85869),a=r(81721);const n=(0,s.Q)({name:"otp",commands:{setupOtpCodeForCredential:i.z},events:{},queries:{otpCode:o.J,otpCodeForSecretOrUrl:a.S}})},34621:(e,t,r)=>{r.d(t,{z:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},85869:(e,t,r)=>{r.d(t,{J:()=>n,c:()=>a});var s=r(99059),i=r(25029),o=r(96168);class a extends((0,o.Hu)("Cannot generate OTP code due to no OtpSecret or OtpUrl found for credential","")){}class n extends((0,s.k)({scope:i.F.User})){}},81721:(e,t,r)=>{r.d(t,{S:()=>n,k:()=>a});var s=r(99059),i=r(25029),o=r(96168);class a extends((0,o.Hu)("Cannot generate OTP code for secret or url","")){}class n extends((0,s.k)({scope:i.F.User})){}},68754:(e,t,r)=>{r.d(t,{d:()=>g});var s=r(86952),i=r(45101),o=r(52835),a=r(94388),n=r(17430),c=r(22231),d=r(44955),l=r(25374),u=r(35642),p=r(69134),m=r(61613),h=r(94449);const g=(0,s.Q)({name:"passwordHealth",commands:{updateIsCredentialExcluded:i.v,recalculatePasswordHealth:o.t},events:{passwordHealthComputationFinished:a.w},queries:{credentialHealthData:n.w,filterCredentials:c.Q,filterCredentialsIds:d.M,score:l.e,compromisedCredentials:u.v,compromisedCredentialsIdsForBreach:p.A,passwordHealthReport:m.b,scoreForPassword:h.c}})},45101:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},52835:(e,t,r)=>{r.d(t,{t:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},94388:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(88885),i=r(25029);class o extends((0,s.d)({scope:i.F.User})){}},29732:(e,t,r)=>{var s;r.d(t,{c:()=>s}),function(e){e.DisablePasswordHealth="web_disable_password_health",e.PasswordHealthPaginationDev="sharingVault_web_password_health_pagination_dev",e.PasswordHealthPaginationProd="sharingVault_web_password_health_pagination_prod",e.PasswordHealthHourlySyncDev="sharingVault_web_passwordHealthHourlySync_dev",e.PasswordHealthHourlySyncProd="sharingVault_web_passwordHealthHourlySync_prod"}(s||(s={}))},37109:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(67837),i=r(68754);class o extends((0,s.E)(i.d)){}(0,s.K)(i.d,o)},20987:(e,t,r)=>{var s,i,o,a;r.d(t,{_x:()=>i,bp:()=>a,gI:()=>s,ub:()=>o}),function(e){e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(s||(s={})),function(e){e.All="all",e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(i||(i={})),function(e){e.WEAK="weak",e.EXTREMELY_WEAK="extremely_weak"}(o||(o={})),function(e){e.COMMON="common",e.STRONG="strong"}(a||(a={}))},69134:(e,t,r)=>{r.d(t,{A:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},35642:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},17430:(e,t,r)=>{r.d(t,{w:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},44955:(e,t,r)=>{r.d(t,{M:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},22231:(e,t,r)=>{r.d(t,{Q:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},61613:(e,t,r)=>{r.d(t,{b:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},94449:(e,t,r)=>{r.d(t,{c:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},25374:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},97203:(e,t,r)=>{r.d(t,{f:()=>s});const s=(0,r(86952).Q)({name:"vaultReport",commands:{},events:{},queries:{}})},53195:(e,t,r)=>{r.d(t,{v:()=>A});var s=r(88802),i=r(99634),o=r(25593),a=r(25029),n=r(95681),c=r(23347),d=r(10722),l=r(7165);const u=l.z.object({autoredirection:l.z.record(l.z.boolean())}),p=e=>u.safeParse(e).success;class m extends((0,n.Q)({persist:!0,storage:{initialValue:{autoredirection:{}},typeGuard:p,schemaVersion:1},scope:a.F.Device,storeName:"antiphishing",codec:d.E,capacity:c.Y._001KB})){}var h=r(63663),g=r(87279),v=r(3100);class _{async execute({body:e}){const{domain:t}=e;if(t){const e=await this.antiphishingStore.getState();await this.antiphishingStore.set({...e,autoredirection:{...e.autoredirection,[t]:!0}})}return Promise.resolve((0,g.Vp)(void 0))}constructor(e){this.antiphishingStore=e}}_=(0,s.__decorate)([(0,h.W)(v.A),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m?Object:m])],_);var y=r(20754),S=r(17308),E=r(87065);class f{execute({body:e}){return this.antiphishingStore.state$.pipe((0,E.U)((t=>(0,g.Vp)(!!e.domain&&!!t.autoredirection[e.domain]))))}constructor(e){this.antiphishingStore=e}}f=(0,s.__decorate)([(0,y.e)(S.U),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m?Object:m])],f);class A{}A=(0,s.__decorate)([(0,i.Yl)({api:o.J,handlers:{commands:{addAutoRedirectedDomain:_},events:{},queries:{isAutoRedirectedDomain:f}},stores:[m]})],A)},99002:(e,t,r)=>{r.d(t,{b:()=>o});const s=e=>void 0===e||"string"==typeof e,i=e=>void 0===e||"number"==typeof e,o=e=>{if(!e||!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"string"==typeof t.Id&&i(t.LastBackupTime)&&s(t.kwType)&&s(t.BreachId)&&i(t.ContentRevision)}},89315:(e,t,r)=>{r.d(t,{T:()=>c,l:()=>n});var s=r(71926),i=r(70942);const o=({name:e,domains:t})=>{if(e)return e;if(t.length>0){const[e]=t;return e}return""},a=e=>(0,i.Tc)(e)?"private":"public",n=e=>[...e.reduce(((e,t)=>{const r=e.get(t.BreachId);return(!r||r.LastBackupTime&&t.LastBackupTime&&r.LastBackupTime<t.LastBackupTime)&&e.set(t.BreachId,t),e}),new Map).values()],c=(e,t)=>{const r=n(e.filter(i.rY)).find((e=>e.Id===t));if(!r)throw new Error("Breach not found");return(e=>{const t=e.Content,r=(0,i.Tc)(e)?e.Content.impactedEmails:[];return{breachId:e.BreachId,breachType:a(e),domains:t.domains,eventDate:t.eventDate,id:e.Id,impactedEmails:r,kwType:e.kwType??"KWSecurityBreach",leakedData:t.leakedData??[],leakedPasswords:e.LeakedPasswords??[],name:o(t),status:e.Status??s.J.PENDING}})(r)}},70942:(e,t,r)=>{r.d(t,{F7:()=>a,Tc:()=>n,rY:()=>o});const s=e=>"object"==typeof e,i=e=>(e=>s(e)&&"breachModelVersion"in e&&"number"==typeof e.breachModelVersion)(e)&&1===e.breachModelVersion&&"domains"in e&&Array.isArray(e.domains)&&"eventDate"in e&&"string"==typeof e.eventDate&&"id"in e&&"string"==typeof e.id,o=e=>{return s(t=e)&&"kwType"in t&&"string"==typeof t.kwType&&"KWSecurityBreach"===t.kwType&&i(e.Content);var t},a=e=>(e=>{const t=e;return"impactedEmails"in t&&Array.isArray(t.impactedEmails)})(e)&&e.impactedEmails.length>0,n=e=>o(e)&&a(e.Content)},24981:(e,t,r)=>{r.d(t,{t:()=>O});var s=r(88802),i=r(99634),o=r(66706),a=r(63663),n=r(87279),c=r(71926),d=r(87425),l=r(86252);class u{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateBreachStatus",args:[{id:e.id,status:c.J.ACKNOWLEDGED}]}),Promise.resolve((0,n.Vp)(void 0))}constructor(e){this.carbonLegacyClient=e}}u=(0,s.__decorate)([(0,a.W)(d.n),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l._?Object:l._])],u);var p=r(29362);class m{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateBreachStatus",args:[{id:e.id,status:c.J.VIEWED}]}),Promise.resolve((0,n.Vp)(void 0))}constructor(e){this.carbonLegacyClient=e}}m=(0,s.__decorate)([(0,a.W)(p.Q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l._?Object:l._])],m);var h=r(48844),g=r(20754),v=r(60466),_=r(89315),y=r(99002);class S{execute({body:e}){const{id:t}=e,{queries:{carbonState:r}}=this.carbonLegacyClient;return r({path:"userSession.personalData.securityBreaches"}).pipe((0,h.Qn)((e=>{if(!(0,y.b)(e))throw new Error("Bad Breaches format");return e})),(0,h.Qn)((e=>(0,_.T)(e,t))))}constructor(e){this.carbonLegacyClient=e}}S=(0,s.__decorate)([(0,g.e)(v.i),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l._?Object:l._])],S);var E=r(87065),f=r(5202),A=r(70942);class I{execute(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,h.Qn)((e=>{if(!(0,y.b)(e))throw new Error("Bad Breaches format");return e})),(0,E.U)((e=>{if((0,n.hx)(e))throw new Error("Error while fetching data");const t=(0,_.l)(e.data.filter(A.rY)).filter((e=>e.Status===c.J.PENDING&&(0,A.Tc)(e)));return(0,n.Vp)({count:t.length})})))}constructor(e){this.carbonLegacyClient=e}}I=(0,s.__decorate)([(0,g.e)(f.L),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l._?Object:l._])],I);class O{}O=(0,s.__decorate)([(0,i.Yl)({api:o.H,handlers:{commands:{dismissBreach:u,markBreachAsSeen:m},events:{},queries:{breach:S,unreadBreachesCount:I}}})],O)},77836:(e,t,r)=>{r.d(t,{S:()=>x});var s=r(88802),i=r(99634),o=r(36282),a=r(25029),n=r(95681),c=r(29987),d=r(10722);const l=e=>(e=>!(!e||"object"!=typeof e)&&"onboardingStatus"in e&&"emails"in e)(e)&&(0,c.U)(e.onboardingStatus)&&Array.isArray(e.emails);class u extends((0,n.Q)({persist:!0,storage:{schemaVersion:1,initialValue:{onboardingStatus:c.M.NOT_SEEN,emails:[]},typeGuard:l},scope:a.F.User,storeName:"email-monitoring-state",storeTypeGuard:l,codec:d.E,isCache:!0})){}var p=r(11959),m=r(27655),h=r(63663),g=r(48844),v=r(87279),_=r(87113),y=r(60399),S=r(82567);class E{async execute({body:{email:e}}){return await(0,y.z)(this.serverApiClient.v1.darkwebmonitoring.registerEmail({email:e}).pipe((0,g.DZ)((e=>{throw new Error(e.message)})),(0,g.lk)((e=>e.data.result===p.Dq?(0,v.Vp)(void 0):(0,v.Rn)((e=>{switch(e){case p.XX.INVALID_EMAIL:return(0,p.Iy)();case p.XX.ALREADY_SUBSCRIBED:return(0,p.pK)();case p.XX.TOO_MANY_SUBSCRIPTIONS:return(0,p.Qj)();default:return(0,p.tp)()}})(e.data.result)))),(0,S.b)((async t=>{(0,v.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails,{email:e,state:m.wp.PENDING}]})))}))))}constructor(e,t){this.serverApiClient=e,this.store=t}}E=(0,s.__decorate)([(0,h.W)(p.P5),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===u?Object:u])],E);var f=r(93850),A=r(49590);class I{async execute({body:{email:e}}){return await(0,y.z)(this.serverApiClient.v1.darkwebmonitoring.deregisterEmail({email:e}).pipe((0,g.DZ)((e=>{throw new Error(e.message)})),(0,g.lk)((e=>e.data.result===A.QS?(0,v.Vp)(void 0):(0,v.Rn)(this.getFunctionalError(e.data.result)))),(0,S.b)((async t=>{(0,v.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails.filter((t=>t.email!==e))]})))}))))}constructor(e,t){this.serverApiClient=e,this.store=t,this.getFunctionalError=e=>{switch(e){case A.KP.NO_SUBSCRIPTION:return new A.h1;case A.KP.INVALID_EMAIL:return new A.uD;case A.KP.GENERIC_ERROR:default:return new A.v4}}}}I=(0,s.__decorate)([(0,h.W)(A.Lc),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===u?Object:u])],I);var O=r(92452),b=r(57924);function T(e){return{...e,onboardingStatus:c.M.SEEN}}class C{async execute(){await this.store.update(T)}constructor(e){this.store=e}}C=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===u?Object:u])],C);class w{async execute(){return await this.dismissOnboardingNotificationService.execute(),Promise.resolve((0,v.Vp)(void 0))}constructor(e){this.dismissOnboardingNotificationService=e}}w=(0,s.__decorate)([(0,h.W)(O.n),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===C?Object:C])],w);var R=r(87065),P=r(6136),D=r(43978),N=r(90171),U=r(69885),F=r(20754);class M{constructor(e,t){this.serverApiClient=e,this.store=t,this.execute=()=>{this.serverApiClient.v1.darkwebmonitoring.listRegistrations({}).pipe((0,g.Qn)((({data:e})=>e.emails.map((e=>({email:e.email,state:(0,m.a2)(e.state)?e.state:m.wp.PENDING}))))),(0,g.Qn)((e=>{this.store.update((t=>({...t,emails:e})))})),(0,g.DZ)((e=>{throw e}))).subscribe()}}}M=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===u?Object:u])],M);class L{execute(){this.syncMonitoredEmails.execute();return this.store.state$.pipe((0,R.U)((e=>e.emails)),(0,P.x)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),(0,R.U)((e=>(0,v.Vp)(e)))).pipe((0,D.w)((e=>{const t=()=>(this.syncMonitoredEmails.execute(),e),r=e=>(0,N.H)(0,e).pipe((0,D.w)((()=>(0,U.of)(t()))));return(0,v.hx)(e)||e.data.some((e=>e.state===m.wp.PENDING))?r(3e4):(0,U.of)(e)})))}constructor(e,t){this.syncMonitoredEmails=e,this.store=t}}L=(0,s.__decorate)([(0,F.e)(m.dB),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===M?Object:M,void 0===u?Object:u])],L);var G=r(43473);class K{execute(){return this.store.state$.pipe((0,R.U)((e=>e.onboardingStatus)),(0,P.x)(),(0,R.U)(v.Vp))}constructor(e){this.store=e}}K=(0,s.__decorate)([(0,F.e)(G.p),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===u?Object:u])],K);class x{}x=(0,s.__decorate)([(0,i.Yl)({api:o.M,stores:[u],handlers:{commands:{dismissOnboardingNotification:w,optinEmail:E,optoutEmail:I},events:{},queries:{emailList:L,onboardingNotificationState:K}},imports:[f.n],providers:[C,M]})],x)},72481:(e,t,r)=>{r.d(t,{f:()=>z});var s=r(88802),i=r(99634),o=r(6538),a=r(87065),n=r(86252),c=r(57924),d=r(48844),l=r(87279);const u=e=>void 0===e||"string"==typeof e;class p{getById(e){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"state.userSession.personalData.credentials"}).pipe((0,d.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&u(t.OtpSecret)&&u(t.OtpUrl)}))))(e))throw new Error("Bad credential format");return e})),(0,a.U)((t=>{if((0,l.hx)(t))return(0,l.Vp)(null);const r=t.data.reduce(((t,r)=>r.Id===e?{Id:r.Id,OtpSecret:r.OtpSecret,OtpUrl:r.OtpUrl}:t),null);return(0,l.Vp)(r)})))}constructor(e){this.carbonLegacyClient=e}}p=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n._?Object:n._])],p);var m,h=r(20754),g=r(81721);!function(e){e.SHA1="SHA-1",e.SHA256="SHA-256",e.SHA384="SHA-384",e.SHA512="SHA-512"}(m||(m={}));const v=["totp","hotp"],_=e=>{const t=new URL(e),r=(e=>{const t=e.hostname?e.hostname:/\/\/([th]otp)\//.exec(e.pathname)?.[1]??"";return v.includes(t)?t:null})(t),s=t.searchParams.get("secret")?.toUpperCase();if(!r||!s)throw new Error("Corrupted OTP url");const i=t.searchParams.get("digits"),o=t.searchParams.get("counter"),a=t.searchParams.get("period"),n=t.searchParams.get("algorithm");return{secret:s,algorithm:n?m[n]:m.SHA1,counter:o?Number.parseInt(o,10):0,digits:i?Number.parseInt(i,10):6,period:a?Number.parseInt(a,10):30}},y=e=>({secret:e.toUpperCase(),algorithm:m.SHA1,counter:0,digits:6,period:30}),S=e=>{try{return _(e)}catch{return y(e)}},E=e=>{const{secret:t,algorithm:r,digits:s,period:i}=e;return`otpauth://totp/?secret=${t.toLowerCase()}&algorithm=${r.toUpperCase().replace("-","")}&digits=${s}&period=${i}&lock=false`};var f=r(90171),A=r(41842),I=r(43978),O=r(31222);var b=r(76884),T=r(97112);const C=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],w=async(e,t,r)=>{const s=(e=>{const t=new Uint8Array(e),r=15&t[t.length-1],s=t.slice(r,r+4).reduce(((e,t)=>e.concat(t.toString(16).toString().padStart(2,"0"))),"");return 2147483647&Number.parseInt(s,16)})(await e((0,T.n)(t)));return(s%(r<=9?C[r]:Math.pow(10,r))).toString().padStart(r,"0")};class R{async computeOtpCode({counter:e,digits:t,period:r}){const s=this.getStep(e,r);return await w(this.signer,s,t)}constructor(e,t){this.signer=e,this.getStep=t}}class P{createCodeGenerator({secret:e,algorithm:t}){try{const r=(0,b.K)(e);return new R((e=>this.hmacSigner.sign(r,e,t)),this.getStep)}catch(e){return null}}getNextOtpRefreshTimestamp(e,t){if(e)return(e=>{const t=1e3*e,r=Math.floor(Date.now()/t)*t;return new Date(r+t).getTime()})(t);throw new Error("Not supported for non time based OTP type")}constructor(e){this.hmacSigner=e}}class D extends P{getStep(e,t){return((e,t)=>Math.floor(e/t))(e||(new Date).getTime(),1e3*t)}constructor(e){super(e)}}D=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===O.q?Object:O.q])],D);class N{async withGeneratedCodeAndValidity(e,t){try{const r=await t.computeOtpCode(e),s=this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period);return(0,l.Vp)({code:r,validityEndDate:s,validityTime:1e3*e.period,url:E(e)})}catch{return(0,l.Rn)(void 0)}}otpCodes$(e,t){return(0,f.H)(0,1e3).pipe((0,A.h)((t=>{if(0===t)return!0;return((e,t)=>e-Date.now()>=1e3*t-1e3)(this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period),e.period)})),(0,I.w)((()=>this.withGeneratedCodeAndValidity(e,t))))}constructor(e){this.otpGeneratorService=e}}N=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===D?Object:D])],N);var U=r(69885);class F{execute({body:e}){const{secretOrUrl:t}=e;if(!t)return(0,U.of)((0,l.Rn)(new g.k));const r=S(t.replaceAll(" ","")),s=this.otpGeneratorService.createCodeGenerator(r);return null===s?(0,U.of)((0,l.Rn)(new g.k)):this.otpCodeService.otpCodes$(r,s).pipe((0,d.DZ)((()=>new g.k)))}constructor(e,t){this.otpGeneratorService=e,this.otpCodeService=t}}F=(0,s.__decorate)([(0,h.e)(g.S),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===D?Object:D,void 0===N?Object:N])],F);var M=r(63663),L=r(34621),G=r(39431),K=r(50879);class x{async execute({body:e}){const{updateVaultItem:t}=this.vaultCrudClient.commands,{credentialId:r,otpUrl:s}=e;return await t({vaultItemType:G.U.Credential,content:{otpSecret:"",otpURL:s},id:r}),(0,l.Vp)(void 0)}constructor(e){this.vaultCrudClient=e}}x=(0,s.__decorate)([(0,M.W)(L.z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===K.L?Object:K.L])],x);var k=r(85869);class j{withCodeGenerator(e){return{codeGenerator:this.otpGeneratorService.createCodeGenerator(e),params:e}}execute({body:e}){const{credentialId:t}=e;return this.credentialOTPGetter.getById(t).pipe((0,a.U)((e=>{if((0,l.hx)(e)||!e.data)throw new Error("Credential not found");return e.data})),(0,a.U)((e=>{if(!e.OtpUrl&&!e.OtpSecret)return{params:null,codeGenerator:null};const t=(e=>{const{OtpSecret:t,OtpUrl:r}=e;if(!t&&!r)throw new Error("Otp config missing for this credential");return r?S(r):y(t??"")})(e);return this.withCodeGenerator(t)})),(0,I.w)((({params:e,codeGenerator:t})=>null===e||null===t?(0,U.of)((0,l.Rn)(new k.c)):this.otpCodeService.otpCodes$(e,t).pipe((0,a.U)((e=>(0,l.hx)(e)?(0,l.Vp)({code:"",validityEndDate:Date.now(),validityTime:Date.now(),url:""}):e))))))}constructor(e,t,r){this.credentialOTPGetter=e,this.otpGeneratorService=t,this.otpCodeService=r}}j=(0,s.__decorate)([(0,h.e)(k.J),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p,void 0===D?Object:D,void 0===N?Object:N])],j);class V extends P{getStep(e,t){return e}constructor(e){super(e)}}V=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===O.q?Object:O.q])],V);var W=r(37935);class B{}B=(0,s.__decorate)([(0,i.Yl)({sharedModuleName:"otp-generator",providers:[D,V],exports:[D,V],imports:[W.D]})],B);class z{}z=(0,s.__decorate)([(0,i.Yl)({api:o.i,handlers:{commands:{setupOtpCodeForCredential:x},events:{},queries:{otpCode:j,otpCodeForSecretOrUrl:F}},imports:[B],providers:[p,N]})],z)},88559:(e,t,r)=>{r.d(t,{U:()=>l});var s=r(88802),i=r(86252),o=r(57924),a=r(48844),n=r(99002),c=r(89315),d=r(70942);class l{getSupportedBreaches(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,a.Qn)((e=>{if(!(0,n.b)(e))throw new Error("Bad Breaches format");return e})),(0,a.Qn)((e=>e.filter(d.rY))))}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,a.Qn)((e=>{if(!(0,n.b)(e))throw new Error("Bad Breaches format");return e})),(0,a.Qn)((e=>(0,c.l)(e.filter(d.rY)))))}constructor(e){this.carbonLegacyClient=e}}l=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i._?Object:i._])],l)},56836:(e,t,r)=>{r.d(t,{C:()=>Dt});var s=r(88802),i=r(68754),o=r(29732),a=r(93850),n=r(60733),c=r(99634),d=r(92018),l=r(70433),u=r(25029),p=r(95681),m=r(23347),h=r(10722),g=r(28489);const v=e=>"object"==typeof e&&null!==e&&(0,g.l$)(e,"credentialsAtRisk")&&(0,g.l$)(e,"index")&&"object"==typeof e.credentialsAtRisk&&"object"==typeof e.index;class _ extends((0,p.Q)({persist:!0,storage:{initialValue:{credentialsAtRisk:{},index:{}},typeGuard:v,schemaVersion:1},scope:u.F.User,storeName:"password-health-state",storeTypeGuard:v,codec:h.E,isCache:!0,capacity:m.Y.Unlimited})){}var y=r(86252),S=r(57924),E=r(48844),f=r(87279),A=r(64718),I=r(61076),O=r(87065);const b=e=>void 0===e||"string"==typeof e,T=e=>void 0===e||"string"==typeof e||"boolean"==typeof e;class C{vaultBooleanFormatter(e,t=!1){return void 0===e?t:"string"==typeof e?"true"===e.toLocaleLowerCase():e}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient,t=e({path:"state.userSession.spaceData.spaces"}).pipe((0,E.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.teamId&&"object"==typeof t.details&&"string"==typeof t.details.status}))))(e))throw new Error("Bad space item format");return new Set(e.filter((e=>"accepted"===e.details.status)).map((e=>e.teamId)))}))),r=e({path:"userSession.sharingData.items"}).pipe((0,E.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp}))))(e))throw new Error("Bad shared items format");return e.map((e=>e.itemId))})));return e({path:"state.userSession.personalData.credentials"}).pipe((0,E.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&T(t.AutoLogin)&&T(t.AutoProtected)&&b(t.Email)&&b(t.Login)&&b(t.OtpSecret)&&b(t.OtpUrl)&&b(t.Password)&&b(t.Title)&&b(t.Url)&&b(t.SpaceId)&&T(t.Checked)}))))(e))throw new Error("Bad credential format");return e})),(0,I.V)(r,t),(0,O.U)((([e,t,r])=>{const s={};return(0,f.hx)(e)||(0,f.hx)(r)||e.data.forEach((e=>{const i=new A.Y(e.Url).getRootDomain();var o;e.SpaceId&&""!==e.SpaceId&&!r.data.has(e.SpaceId)||(s[e.Id]={domains:i?[i]:[],autoLogin:this.vaultBooleanFormatter(e.AutoLogin),autoProtected:this.vaultBooleanFormatter(e.AutoProtected),email:e.Email??"",excluded:this.vaultBooleanFormatter(e.Checked),id:e.Id,login:e.Login??"",otpSecret:e.OtpSecret??"",otpUrl:e.OtpUrl??"",password:e.Password??"",spaceId:e.SpaceId??"",shared:(o=e.Id,!(0,f.hx)(t)&&t.data.includes(o)),title:e.Title??""})})),(0,f.Vp)(s)})))}constructor(e){this.carbonLegacyClient=e}}C=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y._?Object:y._])],C);var w=r(88559);const R=e=>{if(!e)return;const t=e;if(!((r=t.spaces)&&Array.isArray(r)&&0!==r.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r.find((e=>"accepted"===e.status)))))return;var r;const s=t.spaces.find((e=>"accepted"===e.status));return s?.teamId};class P{get(){const{queries:{carbonState:e}}=this.carbon;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,E.Qn)(R))}constructor(e){this.carbon=e}}P=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y._?Object:y._])],P);var D=r(67978),N=r(75994);class U extends D.K{loadResource(e){if(!(t=e)||!Array.isArray(t))throw new Error("Important domains file corrupted");var t;return new Set(e)}constructor(e){super("assets/domains/importantDomains.json",e)}}U=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===N.X?Object:N.X])],U);var F=r(94189),M=r(70493);var L=r(81459);class G extends L.f{}G=(0,s.__decorate)([(0,S.GS)()],G);var K=r(20987);const x=e=>{const t=e.risks.filter((e=>e.riskType===K.gI.Reused));return 1===t.length?t[0]:void 0},k=(e,t)=>e?.risks.find((e=>e.riskType===t)),j=(e,t)=>e.risks.filter((e=>e.riskType!==t)),V=(e,t,r)=>[...r,{riskType:K.gI.Reused,credentialIds:[...t.credentialIds].filter((t=>e!==t))}],W=(e,t)=>{const r=x(t);return{...t,risks:j(t,K.gI.Reused).concat([{riskType:K.gI.Reused,credentialIds:r?[...r.credentialIds].concat(e.id):[e.id]}])}},B=e=>({id:e.id,title:e.title,email:e.email,excluded:e.excluded,login:e.login,autoLogin:e.autoLogin,autoProtected:e.autoProtected,otpSecret:e.otpSecret,otpUrl:e.otpUrl,spaceId:e.spaceId,shared:e.shared,domains:e.domains}),z=e=>({...B(e),risks:[],isImportant:!1}),H=(e,t,r)=>{const s=j(t,K.gI.Reused),i=r&&r.length>0,o=s.length>0;return i||o?{...z(e),risks:i?s.concat([{riskType:K.gI.Reused,credentialIds:r}]):s}:void 0},Y=e=>!!k(e,K.gI.Weak),Q=e=>!!x(e),q=e=>!!k(e,K.gI.Compromised),$=e=>e.excluded,X=3,Z=5;function J(e,t,r=X,s=Z){if(!e||!t)return!1;const i=e.length,o=t.length;if(Math.abs(i-o)>r)return!1;if(i<s||o<s)return e===t;if(e===t)return!0;let a=new Array(o+1),n=new Array(o+1),c=!1;for(let e=0;e<o+1;e++)a[e]=e;for(let s=0;s<i;s++){n[0]=s+1,c=n[0]>r;for(let i=0;i<o;i++){const o=a[i+1]+1,d=n[i]+1;let l=a[i];e[s]!==t[i]&&l++,n[i+1]=Math.min(o,Math.min(d,l)),c=c&&n[i+1]>r}const i=a;if(a=n,n=i,c)break}return a[o]<=r}const ee=(e,t,r)=>{const s=((e,t)=>Object.keys(t).reduce(((r,s)=>J(s,e.password)?[...r,...t[s]]:r),[]))(e,r);if(!t&&0===s.length)return{};const i=(e=>{if(0!==e.length)return{riskType:K.gI.Compromised,breaches:e}})(s),o=t?j(t,K.gI.Compromised):[],a={...z(e),risks:i?o.concat(i):o};return{[e.id]:0===a.risks.length?void 0:a}},te=(e,t,r)=>{if(!r)return Promise.resolve({});const s=t[e.id]??z(e),i=s.risks.length>0,o=((e,t)=>Object.keys(t).map((e=>t[e])).filter((t=>t.id!==e.id&&J(t.password,e.password))).map((e=>e.id)))(e,r);if(0===o.length&&!i)return Promise.resolve({});const a=x(s)?.credentialIds??[],n=((e,t,r,s)=>{const i=r.filter((e=>!t.includes(e)));if(0===i.length)return{};const o={};for(const t of i){const r=s[t];if(!r)continue;const i=x(r);if(!i)continue;const a=j(r,K.gI.Reused);1===i.credentialIds.length&&0===a.length?o[t]=void 0:o[t]={...r,risks:1===i.credentialIds.length?a:V(e,i,a)}}return o})(e.id,o,a,t),c=((e,t,r,s,i)=>{const o=t.filter((e=>!r.includes(e)));if(0===o.length)return{};const a={};for(const t of o){const r=s[t];if(r)a[t]=W(e,r);else{const r=i[t];a[t]={...z(r),risks:[{riskType:K.gI.Reused,credentialIds:[e.id]}]}}}return a})(e,o,a,t,r),d=H(e,s,o);return Promise.resolve({...n,...c,[e.id]:d})};var re=r(85465);const se=async e=>{if(e)return await(async e=>(await(0,re.evaluate)(e)).score)(e)/25},ie=async(e,t)=>{const r=await se(e.password),s=t??z(e),i=j(s,K.gI.Weak),o=void 0!==r&&r<2;return o||0!==i.length?{[e.id]:{...s,...B(e),risks:o?i.concat([{riskType:K.gI.Weak,strength:r}]):i}}:{[e.id]:void 0}},oe=(e,t,r)=>{if(!t)return{};const s=e.domains.some((e=>r.has(e))),i={...t,isImportant:s};return{[t.id]:i}},ae=e=>{const t={};if(!Object.keys(e).length)return t;for(const r in e){if(!e[r])continue;const s=e[r]?.spaceId??"";void 0===t[s]&&(t[s]={[K.gI.Reused]:[],[K.gI.Weak]:[],[K.gI.Compromised]:[],[K.gI.Excluded]:[],corruptedCount:0,importantCorruptedCount:0}),e[r]?.excluded?t[s][K.gI.Excluded].push(r):(t[s].corruptedCount++,e[r]?.isImportant&&t[s].importantCorruptedCount++,e[r]?.risks.forEach((e=>t[s][e.riskType].push(r))))}return t},ne=e=>{const t={};return Object.keys(e).forEach((r=>{const s=e[r];s&&(t[r]=s)})),t},ce=async({credentialUpdates:e,allCredentials:t,breaches:r,importantDomains:s,hasUpdatedBreaches:i,healthState:o,deletedCredentialIds:a})=>{const n=(e=>{const t={};return e.forEach((e=>{e.LeakedPasswords&&e.LeakedPasswords.forEach((r=>{Object.prototype.hasOwnProperty.call(t,r)?t[r].push({breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}):t[r]=[{breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}]}))})),t})(r),c=0===e.length&&0===a.length&&!i,d={...o?.credentialsAtRisk??{}},l=e=>Object.keys(e).forEach((t=>d[t]=e[t]));a.length>0&&l(((e=[])=>e.reduce(((e,t)=>({...e,[t]:void 0})),{}))(a));const u={},p={};for(const e of Object.keys(t))t[e].excluded?u[e]=z(t[e]):p[e]=t[e];const m=[],h=[];for(const t of e)t.excluded?h.push(t):a.includes(t.id)||m.push(t);l(((e,t)=>{const r={};for(const s of Object.values(t)){if(!s)continue;const t=x(s);if(!t)continue;const i=t.credentialIds.filter((t=>!e.includes(t)));if(i.length!==t.credentialIds.length){const e=j(s,K.gI.Reused);0===i.length&&0===e.length?r[s.id]=void 0:r[s.id]={...s,risks:0===i.length?e:[...e,{...t,credentialIds:i}]}}}return r})([...Object.values(h).map((e=>e.id)),...a],d)),c&&l((e=>{const t={};for(let r=0;r<e.length;r++){const s=e[r],i=s.password,o=s.id,a=[];for(let n=r+1;n<e.length;n++){const r=e[n].id,c=e[n].password,d=e[n];if(J(i,c)){const e=t[r]??z(d),i=k(e,K.gI.Reused),n=i?.credentialIds??[];t[r]=H(s,e,n.concat(o)),a.push(r)}}const n=t[o]??z(s),c=k(n,K.gI.Reused),d=c?.credentialIds??[];t[o]=H(s,n,a.concat(d))}return t})(Object.values(p)));const g=c?Object.values(p):m;if(i)for await(const e of Object.values(p)){l(ee(e,d[e.id],n))}for await(const e of g){if(!i){l(ee(e,d[e.id],n))}if(!c){l(await te(e,d,p))}l(await ie(e,d[e.id])),l(oe(e,d[e.id],s))}return l(u),{credentialsAtRisk:ne(d),index:ae(d)}};var de=r(60399);class le{async run({updatedCredentialIds:e,deletedCredentialIds:t,hasUpdatedBreaches:r=!1}){const{userFeatureFlips:s}=this.client.getClient(M.cV).queries,i=await(0,de.z)(s());if((0,f.d6)(i)&&i.data[o.c.DisablePasswordHealth])return await this.store.set({credentialsAtRisk:{},index:{}}),void this.eventEmitter.sendEvent("passwordHealthComputationFinished",null);const a=await this.store.getState(),n=await(0,de.z)(this.credentialsGetter.get()),c=await(0,de.z)(this.breachesGetter.get()),d=await this.importantDomains.get();if((0,f.hx)(n)||(0,f.hx)(c))throw new Error("Failure getting vault data");const l=e?.length??0,u=t?.length??0,p=l>0||u>0||r,m=l+u<=50,h=p&&m?a:void 0,g=p?((e,t)=>e.reduce(((e,r)=>void 0===t[r]?e:[...e,t[r]]),[]))(e??[],n.data):[],v=await ce({hasUpdatedBreaches:r,credentialUpdates:m?g:[],allCredentials:n.data,breaches:c.data,importantDomains:d,healthState:h,deletedCredentialIds:m?[...t??[]]:[]});await this.store.set({...v}),this.eventEmitter.sendEvent("passwordHealthComputationFinished",null)}constructor(e,t,r,s,i,o){this.store=e,this.credentialsGetter=t,this.breachesGetter=r,this.importantDomains=s,this.eventEmitter=i,this.client=o}}le=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_,void 0===C?Object:C,void 0===w.U?Object:w.U,void 0===U?Object:U,void 0===G?Object:G,void 0===F.w?Object:F.w])],le);var ue=r(7165);const pe=ue.z.object({lastSentDate:ue.z.number()});ue.z.object({lastSentDate:ue.z.number(),lastHash:ue.z.string()});const me=e=>pe.safeParse(e).success;class he extends((0,p.Q)({persist:!0,storage:{initialValue:{lastSentDate:0,lastHash:""},typeGuard:me,schemaVersion:2,migrateStorageSchema:()=>({lastSentDate:0,lastHash:""})},scope:u.F.User,storeName:"user-activity-state",storeTypeGuard:me,codec:h.E,capacity:m.Y._001KB,isCache:!0})){}const ge=ue.z.object({isOutdated:ue.z.literal(!0),lastUpdateTimestamp:ue.z.number(),updatedCredentialIds:ue.z.record(ue.z.string()),deletedCredentialIds:ue.z.record(ue.z.string()),hasUpdatedBreaches:ue.z.boolean()}),ve=ue.z.object({isOutdated:ue.z.literal(!1),lastUpdateTimestamp:ue.z.number()}),_e=ue.z.discriminatedUnion("isOutdated",[ge,ve]),ye=e=>_e.safeParse(e).success;class Se extends((0,p.Q)({persist:!0,storage:{initialValue:{isOutdated:!1,lastUpdateTimestamp:0},typeGuard:ye,schemaVersion:1},scope:u.F.User,storeName:"health-cache-state",storeTypeGuard:ye,codec:h.E,isCache:!0,capacity:m.Y.Unlimited})){}var Ee=r(64987);const fe=new Ee.WU;class Ae{update(e){fe.runExclusive((async()=>{const t=await this.store.getState();this.store.set(((e,t)=>{const{isOutdated:r}=t;if(!r)return{isOutdated:!1,lastUpdateTimestamp:e.lastUpdateTimestamp};const{updatedCredentialIds:s,deletedCredentialIds:i,hasUpdatedBreaches:o}=t,a=e.isOutdated?{...e}:{isOutdated:!0,lastUpdateTimestamp:e.lastUpdateTimestamp,updatedCredentialIds:{},deletedCredentialIds:{},hasUpdatedBreaches:!1};return s&&(a.updatedCredentialIds={...a.updatedCredentialIds,...s.slice(0,51).reduce(((e,t)=>({...e,[t]:t})),{})}),i&&(a.deletedCredentialIds={...a.deletedCredentialIds,...i.slice(0,51).reduce(((e,t)=>({...e,[t]:t})),{})}),o&&(a.hasUpdatedBreaches=o),a})(t,e))}))}async updateHealthState(){await fe.runExclusive((async()=>{const e=await this.store.getState();(e.isOutdated||0===e.lastUpdateTimestamp||e.lastUpdateTimestamp+864e5<Date.now())&&(await this.passwordHealthCalculationService.run(this.prepCacheStateProps(e)),await this.markAsUpToDate())}))}prepCacheStateProps(e){return e.isOutdated?{updatedCredentialIds:Object.keys(e.updatedCredentialIds),deletedCredentialIds:Object.keys(e.deletedCredentialIds),hasUpdatedBreaches:e.hasUpdatedBreaches}:{}}async markAsUpToDate(){await this.store.set({isOutdated:!1,lastUpdateTimestamp:(new Date).getTime()})}constructor(e,t){this.store=e,this.passwordHealthCalculationService=t}}Ae=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Se?Object:Se,void 0===le?Object:le])],Ae);class Ie{async run(){await this.healthCacheUpdater.updateHealthState()}constructor(e){this.healthCacheUpdater=e}}Ie=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ae?Object:Ae])],Ie);var Oe=r(87113),be=r(96303),Te=r(54066),Ce=r(18969);const we=e=>null===e?null:Math.round(100*e),Re=0;function Pe(e){const t={};return Object.keys(e).forEach((r=>{const s=e[r].spaceId;void 0===t[s]?t[s]=1:t[s]++})),t}const De=e=>Math.floor(e/1e3);class Ne{async sendIfReportUpdated(){const e=await this.getTeamId();if(!e)return(0,f.Rn)("Missing team ID.");const t=await this.userActivityStore.getState(),{currentTime:r,relativeEnd:s,relativeStart:i}=this.getTimes(t.lastSentDate),o=await this.getTeamContent(e),a=(0,be.k)(this.md5Hasher.compute((0,Te.u)(JSON.stringify(o))));return t.lastHash===a?(0,f.Rn)("Health data has not changed from previous run."):(await this.createReport(e,r,s,i,o,a),(0,f.Vp)(void 0))}async sendReport(){const e=await this.getTeamId();if(!e)return(0,f.Rn)("Missing team ID.");const t=await this.userActivityStore.getState(),{currentTime:r,relativeEnd:s,relativeStart:i}=this.getTimes(t.lastSentDate),o=await this.getTeamContent(e);return await this.createReport(e,r,s,i,o,""),(0,f.Vp)(void 0)}getTimes(e){const t=Date.now();return{currentTime:t,relativeEnd:De(t),relativeStart:De(e||t)}}async getTeamContent(e){const t=await this.store.getState(),r=await this.getPerSpaceTotal();return function(e,t,r){const s=e[r],i=t[r]??0;return s?{checkedPasswords:s.excluded.length,compromisedPasswords:s.compromised.length,nbrPasswords:i,reused:s.reused.length,safePasswords:i-s.corruptedCount,securityIndex:we((0,Ce.R9)(s.corruptedCount,s.importantCorruptedCount,i-s.excluded.length))??Re,weakPasswords:s.weak.length}:{checkedPasswords:0,compromisedPasswords:0,nbrPasswords:i,reused:0,safePasswords:i,securityIndex:i<Ce.RG?Re:Ce.JK,weakPasswords:0}}(t.index,r,e)}async createReport(e,t,r,s,i,o){await(0,de.z)(this.serverApiClient.v1.useractivity.create({userActivity:{securityIndex:0},teamActivity:e?{teamId:parseInt(e,10),activity:i}:void 0,relativeEnd:r,relativeStart:s})),this.userActivityStore.set({lastSentDate:t,lastHash:o})}async getTeamId(){const e=await(0,de.z)(this.currentSpaceGetter.get());if(!(0,f.d6)(e))throw new Error("Error while retrieving current space for activity report");return(0,f.db)(e)}async getPerSpaceTotal(){const e=await(0,de.z)(this.credentialsGetter.get());if(!(0,f.d6)(e))throw new Error("Error while retrieving credentials");return Pe(e.data)}constructor(e,t,r,s,i,o){this.serverApiClient=e,this.userActivityStore=t,this.credentialsGetter=r,this.store=s,this.md5Hasher=i,this.currentSpaceGetter=o}}Ne=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Oe.l?Object:Oe.l,void 0===he?Object:he,void 0===C?Object:C,void 0===_?Object:_,void 0===n.f?Object:n.f,void 0===P?Object:P])],Ne);var Ue=r(82567);class Fe{constructor(e,t,r){this.store=e,this.cacheStore=t,this.healthCacheUpdater=r,this.state$=this.cacheStore.state$.pipe((0,I.V)(this.store.state$),(0,Ue.b)((()=>{this.healthCacheUpdater.updateHealthState()})),(0,O.U)((([e,t])=>t)))}}Fe=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_,void 0===Se?Object:Se,void 0===Ae?Object:Ae])],Fe);var Me=r(94449),Le=r(20754),Ge=r(162);class Ke{execute({body:e}){const{password:t}=e;return(0,Ge.D)(se(t)).pipe((0,O.U)((e=>(0,f.Vp)(e))))}constructor(){}}Ke=(0,s.__decorate)([(0,Le.e)(Me.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[])],Ke);var xe=r(44955);const ke=(e,t)=>t===K._x.All?[...new Set([...e[K.gI.Compromised],...e[K.gI.Reused],...e[K.gI.Weak],...e[K.gI.Excluded]])]:e[t],je=(e,t)=>{const r=((e,t)=>{if(0!==t.length)switch(e){case K._x.All:{const e={[K.gI.Compromised]:3,[K.gI.Weak]:2,[K.gI.Reused]:1,[K.gI.Excluded]:0};return t.reduce(((t,r)=>t?e[r.riskType]>e[t.riskType]?r:t:r),void 0)}case K._x.Compromised:return t.find((e=>e.riskType===K.gI.Compromised));case K._x.Weak:return t.find((e=>e.riskType===K.gI.Weak));case K._x.Reused:return t.find((e=>e.riskType===K.gI.Reused));default:return}})(e,t);if(!r)return;const s={severity:K.bp.COMMON};switch(r.riskType){case K.gI.Compromised:{const e=[...r.breaches].sort(((e,t)=>{const r=Date.parse(e.date),s=Date.parse(t.date);return r===s?0:r<s?1:-1}))[0];return{...s,riskType:K.gI.Compromised,date:e.date,domain:e.domains[0]??null,severity:K.bp.STRONG}}case K.gI.Reused:return{...s,riskType:K.gI.Reused,reuseCount:r.credentialIds.length};case K.gI.Weak:return{...s,riskType:K.gI.Weak,strength:r.strength>=1?K.ub.WEAK:K.ub.EXTREMELY_WEAK}}},Ve=(e,t,r,s,i)=>{let o;return o=null!==e?ke(t[e],r):r===K._x.All?Object.keys(s):Object.keys(t).reduce(((e,s)=>[...e,...ke(t[s],r)]),[]),i&&(o=o.filter((e=>i.includes(e)))),o.map((e=>((e,t)=>{const{id:r,title:s,login:i,email:o,autoProtected:a,shared:n,excluded:c,domains:d,risks:l}=e;return{id:r,title:s,login:i,email:o,autoProtected:a,shared:n,excluded:c,domainIcon:void 0,corruptionData:je(t,l),domain:d[0]}})(s[e],r)))};class We{execute({body:e}){const{credentialIds:t,spaceId:r,healthFilter:s}=e;return this.store.state$.pipe((0,O.U)((e=>null!==r&&void 0===e.index[r]?(0,f.Vp)([]):(0,f.Vp)(Ve(r,e.index,s||K._x.All,e.credentialsAtRisk,t)))))}constructor(e){this.store=e}}We=(0,s.__decorate)([(0,Le.e)(xe.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_])],We);var Be=r(21242),ze=r(16433);class He{isRunnable(){return(0,de.z)(this.isHourlyActivityReportEnabled())}async run(){await this.userActivitySenderService.sendReport()}isHourlyActivityReportEnabled(){return this.featureFlipsClient.queries.userFeatureFlips().pipe((0,O.U)((e=>{if((0,f.hx)(e))return!1;const t=!e.data[o.c.DisablePasswordHealth],r=e.data[o.c.PasswordHealthHourlySyncProd],s=e.data[o.c.PasswordHealthHourlySyncDev];return t&&(r||s)})),(0,O.U)((e=>e??!1)),(0,ze.q)(1))}constructor(e,t){this.userActivitySenderService=e,this.featureFlipsClient=t}}He=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ne?Object:Ne,void 0===Be.P?Object:Be.P])],He);var Ye=r(63663),Qe=r(45101);class qe{async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateCredential",args:[{id:e.credentialId,update:{isExcludedFromHealth:e.excluded}}]}),this.store.update((t=>{const r={...t.credentialsAtRisk[e.credentialId],excluded:e.excluded},s={...t};return s.credentialsAtRisk[e.credentialId]=r,s.index=ae(t.credentialsAtRisk),s})),Promise.resolve((0,f.Vp)(void 0))}constructor(e,t){this.store=e,this.carbonLegacyClient=t}}qe=(0,s.__decorate)([(0,Ye.W)(Qe.v),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_,void 0===y._?Object:y._])],qe);var $e=r(52835);class Xe{execute(){return this.healthCacheUpdaterService.update({isOutdated:!0}),Promise.resolve((0,f.Vp)(void 0))}constructor(e){this.healthCacheUpdaterService=e}}Xe=(0,s.__decorate)([(0,Ye.W)($e.t),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ae?Object:Ae])],Xe);var Ze=r(94388),Je=r(68307);class et{async handle(){const e=await this.isPasswordHealthEnabled(),t=await this.isHourlyActivityReportEnabled();e&&!t&&await this.userActivitySender.sendIfReportUpdated()}async isPasswordHealthEnabled(){const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,de.z)(e());return!!(0,f.hx)(t)||!(0,f.db)(t)[o.c.DisablePasswordHealth]}async isHourlyActivityReportEnabled(){const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,de.z)(e());if((0,f.hx)(t))return!1;const r=(0,f.db)(t),s=r[o.c.PasswordHealthHourlySyncProd],i=r[o.c.PasswordHealthHourlySyncDev];return s||i}constructor(e,t){this.featureFlips=e,this.userActivitySender=t}}et=(0,s.__decorate)([(0,Je.b)(Ze.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Be.P?Object:Be.P,void 0===Ne?Object:Ne])],et);var tt=r(20587),rt=r(11564),st=r(21877);class it{async handle({body:e}){const{credentialId:t}=e,{commands:{trackEvent:r}}=this.cqrsClient.getClient(tt.Yu),s=(e=>({is_excluded:!!e&&$(e),is_weak:!!e&&Y(e),is_reused:!!e&&Q(e),is_compromised:!!e&&q(e)}))((await(0,de.z)(this.store.state$)).credentialsAtRisk[t]);return r({event:new st.UserCredentialHealthReportEvent({credentialSecurityStatus:s,itemId:t})}),Promise.resolve(void 0)}constructor(e,t){this.store=e,this.cqrsClient=t}}it=(0,s.__decorate)([(0,Je.b)(rt.p),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Fe?Object:Fe,void 0===F.w?Object:F.w])],it);var ot=r(39431),at=r(34086);class nt{handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===ot.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}constructor(e){this.healthCacheUpdater=e}}nt=(0,s.__decorate)([(0,Je.b)(at.V),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ae?Object:Ae])],nt);var ct=r(25666);class dt{handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===ot.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}constructor(e){this.healthCacheUpdater=e}}dt=(0,s.__decorate)([(0,Je.b)(ct.J),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ae?Object:Ae])],dt);var lt=r(46578);class ut{handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===ot.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,deletedCredentialIds:t}),Promise.resolve(void 0)}constructor(e){this.healthCacheUpdater=e}}ut=(0,s.__decorate)([(0,Je.b)(lt.s),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ae?Object:Ae])],ut);var pt=r(17430);class mt{execute({body:e}){const{credentialId:t}=e;return this.store.state$.pipe((0,O.U)((e=>e.credentialsAtRisk[t]?(0,f.Vp)((e=>{const{excluded:t,risks:r}=e;return{excluded:t,corruptionData:je(K._x.All,r)}})(e.credentialsAtRisk[t])):(0,f.Vp)(null))))}constructor(e){this.store=e}}mt=(0,s.__decorate)([(0,Le.e)(pt.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Fe?Object:Fe])],mt);var ht=r(25374);const gt=(e,t)=>({total:t,excluded:e.excluded.length,compromised:e.compromised.length,reused:e.reused.length,weak:e.weak.length,score:we((0,Ce.R9)(e.corruptedCount,e.importantCorruptedCount,t-e.excluded.length))}),vt=(e,t)=>{const{compromised:r,reused:s,weak:i,corrupted:o,excluded:a,importantCorrupted:n}=Object.keys(e).reduce(((t,r)=>({compromised:t.compromised+e[r].compromised.length,reused:t.reused+e[r].reused.length,weak:t.weak+e[r].weak.length,corrupted:t.corrupted+e[r].corruptedCount,importantCorrupted:t.importantCorrupted+e[r].importantCorruptedCount,excluded:t.excluded+e[r].excluded.length})),{compromised:0,reused:0,weak:0,corrupted:0,importantCorrupted:0,excluded:0}),c=(0,Ce.R9)(o,n,t-a);return{compromised:r,reused:s,total:t,weak:i,score:we(c),excluded:a}};function _t(e,t){return(0,f.hx)(e)?0:Object.keys(e.data).filter((r=>e.data[r].spaceId===t)).length}class yt{execute({body:e}){const{spaceId:t=null}=e;return this.store.state$.pipe((0,I.V)(this.credentialsGetter.get(),this.cacheStateStore.state$),(0,O.U)((([e,r,s])=>{if(null!==t&&void 0===e.index[t]){const e=_t(r,t);return(0,f.Vp)({counters:{compromised:0,reused:0,score:100,total:e,weak:0,excluded:0},isInitialized:s.lastUpdateTimestamp>0})}if(null===t){const t=(0,f.hx)(r)?0:Object.keys(r.data).length;return(0,f.Vp)({counters:vt(e.index,t),isInitialized:s.lastUpdateTimestamp>0})}const i=_t(r,t);return(0,f.Vp)({counters:gt(e.index[t],i),isInitialized:s.lastUpdateTimestamp>0})})))}constructor(e,t,r){this.cacheStateStore=e,this.credentialsGetter=t,this.store=r}}yt=(0,s.__decorate)([(0,Le.e)(ht.e),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Se?Object:Se,void 0===C?Object:C,void 0===Fe?Object:Fe])],yt);var St=r(6136),Et=r(22231);const ft={[K.gI.Compromised]:1,[K.gI.Reused]:2,[K.gI.Weak]:3,[K.gI.Excluded]:4},At=e=>[...e].sort(((e,t)=>{const r=ft[e.corruptionData?.riskType??K.gI.Excluded],s=ft[t.corruptionData?.riskType??K.gI.Excluded];if(r===s){const r=((e,t)=>e?.riskType===K.gI.Compromised&&t?.riskType===K.gI.Compromised?Date.parse(t.date)-Date.parse(e.date):e?.riskType===K.gI.Reused&&t?.riskType===K.gI.Reused?t.reuseCount-e.reuseCount:e?.riskType===K.gI.Weak&&t?.riskType===K.gI.Weak?e.strength===t.strength?0:e.strength===K.ub.WEAK?1:-1:0)(e.corruptionData,t.corruptionData);return 0!==r?r:e.title.localeCompare(t.title)}return r-s})),It=20;class Ot{isPasswordHealthPaginationEnabled(){return this.featureFlipsClient.queries.userFeatureFlips().pipe((0,O.U)((e=>{if((0,f.hx)(e))return!1;const t=e.data[o.c.PasswordHealthPaginationProd],r=e.data[o.c.PasswordHealthPaginationDev];return t||r})),(0,ze.q)(1))}execute({body:e}){const{healthFilter:t,spaceId:r,pageNumber:s=1,pageSize:i=It}=e;return this.store.state$.pipe((0,O.U)((e=>{if(null!==r&&void 0===e.index[r])return[];return At(Ve(r,e.index,t||K._x.All,e.credentialsAtRisk))})),(0,I.V)(this.isPasswordHealthPaginationEnabled()),(0,O.U)((([e,t])=>{const r=e.length;let o=e;if(t){const t=i*s;o=e.slice(0,t)}return{items:o,matchCount:r}})),(0,St.x)(((e,t)=>{const r=0===e.matchCount&&0===t.matchCount,s=0===e.items.length&&0===t.items.length;return!(!r||!s)})),(0,O.U)(f.Vp))}constructor(e,t){this.store=e,this.featureFlipsClient=t}}Ot=(0,s.__decorate)([(0,Le.e)(Et.Q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Fe?Object:Fe,void 0===Be.P?Object:Be.P])],Ot);var bt=r(35642);class Tt{execute({body:e}){const{credentialIds:t}=e;return this.store.state$.pipe((0,O.U)((e=>(0,f.Vp)(((e,t)=>Object.keys(e).reduce(((t,r)=>[...t,...e[r].compromised]),[]).filter((e=>t.includes(e))))(e.index,t)))))}constructor(e){this.store=e}}Tt=(0,s.__decorate)([(0,Le.e)(bt.v),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Fe?Object:Fe])],Tt);var Ct=r(69134);class wt{execute({body:e}){const{breachId:t}=e;return this.store.state$.pipe((0,O.U)((e=>(0,f.Vp)(((e,t)=>Object.keys(e.index).reduce(((r,s)=>[...r,...e.index[s].compromised.filter((r=>{const s=k(e.credentialsAtRisk[r],K.gI.Compromised);return s?.breaches.some((e=>e.breachId===t))}))]),[]))(e,t)))))}constructor(e){this.store=e}}wt=(0,s.__decorate)([(0,Le.e)(Ct.A),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Fe?Object:Fe])],wt);var Rt=r(61613);class Pt{execute(){return this.store.state$.pipe((0,I.V)(this.credentialsGetter.get()),(0,O.U)((([e,t])=>{const r={};if(!(0,f.d6)(t))throw new Error("Error while retrieving credentials");const s=Pe(t.data),i=Object.keys(t.data).length,o=function(e){const t={};return Object.keys(e).forEach((r=>{const s=k(e[r],K.gI.Compromised),i=e[r].spaceId;if(void 0===s)return;void 0===t[i]&&(t[i]={breaches:new Set,compromisedByBreaches:{}});const o=s.breaches.map((e=>e.breachId));t[i].breaches=new Set([...t[i].breaches,...o]),t[i].compromisedByBreaches[r]=new Set(o)})),t}(e.credentialsAtRisk);let a=new Set([]),n={},c=0;return Object.keys(e.index).forEach((t=>{const i=e.index[t],d=gt(i,s[t]);r[t]={...d,breaches:o[t]?.breaches??new Set,compromisedByBreach:o[t]?.compromisedByBreaches??{},corrupted:i.corruptedCount},a=new Set([...a,...o[t]?.breaches??new Set]),n={...n,...o[t]?.compromisedByBreaches??{}},c+=i.corruptedCount})),r.global={...vt(e.index,i),breaches:a,compromisedByBreach:n,corrupted:c},(0,f.Vp)(r)})))}constructor(e,t){this.store=e,this.credentialsGetter=t}}Pt=(0,s.__decorate)([(0,Le.e)(Rt.b),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_?Object:_,void 0===C?Object:C])],Pt);class Dt{}Dt=(0,s.__decorate)([(0,c.Yl)({api:i.d,crons:[{handler:Ie,name:"health-cache",periodInMinutes:15,scope:u.F.User},{handler:He,name:"user-activity-report",periodInMinutes:60,scope:u.F.User}],handlers:{commands:{updateIsCredentialExcluded:qe,recalculatePasswordHealth:Xe},events:{...(0,c.g4)(i.d,{passwordHealthComputationFinished:et}),...(0,c.g4)(d.Y,{passwordAutofillPerformed:it}),...(0,c.g4)(l.L,{updated:nt,created:dt,deleted:ut})},queries:{credentialHealthData:mt,score:yt,filterCredentials:Ot,filterCredentialsIds:We,compromisedCredentials:Tt,compromisedCredentialsIdsForBreach:wt,passwordHealthReport:Pt,scoreForPassword:Ke}},imports:[a.n],stores:[_,he,Se],providers:[C,w.U,U,le,Ae,Ie,G,Ne,Fe,n.f,P,He],requiredFeatureFlips:[o.c.DisablePasswordHealth,o.c.PasswordHealthPaginationDev,o.c.PasswordHealthPaginationDev,o.c.PasswordHealthHourlySyncDev,o.c.PasswordHealthHourlySyncProd]})],Dt)},18969:(e,t,r)=>{r.d(t,{JK:()=>c,R9:()=>d,RG:()=>s});const s=5,i=.6,o=1,a=1,n=.2,c=100;function d(e,t,r){if(r<s)return null;const c=i*Math.pow(1-t/r,o),d=(1-i)*Math.pow(1-e/r,a);return n+(1-n)*(c+d)}},29292:(e,t,r)=>{r.d(t,{E:()=>z});var s=r(88802),i=r(99634),o=r(97203),a=r(68754),n=r(60399),c=r(72250),d=r(37109),l=r(57924),u=r(73512),p=r(87279),m=r(21877),h=r(20980),g=r(35594),v=r(39431),_=r(77802),y=r(50879),S=r(88559),E=r(25029),f=r(95681),A=r(23347),I=r(28489),O=r(10722);const b=e=>!(!e||"object"!=typeof e)&&((0,I.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class T extends((0,f.Q)({codec:O.E,persist:!0,storage:{initialValue:{lastSentDate:0},schemaVersion:1,typeGuard:b},scope:E.F.User,storeName:"vault-report",storeTypeGuard:b,capacity:A.Y._001KB,isCache:!0})){}const C="global",w={collectionsCount:-1,collectionsSharedCount:-1,multipleCollectionsCount:-1,multipleCollectionsSharedCount:-1,singleCollectionCount:-1,singleCollectionSharedCount:-1};function R(e){if(0===e.length)return 0;const t=e.flatMap((e=>e.vaultItems)),r=new Set(t.map((e=>e.id))).size;return Math.round(t.length/r)}function P(e){if(0===e.length)return 0;let t=0,r=0;for(const s of e)s.vaultItems.length>0&&(r+=s.vaultItems.length,t++);return Math.round(r/t)}function D(e){let t=0,r=0,s=0,i=0;const o=e.reduce(((e,t)=>(t.vaultItems.forEach((r=>{const s=r.id;e[s]?(e[s].all++,t.isShared&&e[s].shared++):e[s]={all:1,shared:t.isShared?1:0}})),e)),{});return Object.values(o).forEach((e=>{e.all>1?t++:1===e.all&&r++,e.shared>1?s++:1===e.shared&&i++})),{collectionsCount:e.length,collectionsSharedCount:e.filter((e=>e.isShared)).length,multipleCollectionsCount:t,multipleCollectionsSharedCount:s,singleCollectionCount:r,singleCollectionSharedCount:i}}var N=r(70942);const U=e=>e.reduce(((e,t)=>({...e,[t.id]:{...t}})),{});const F=(e,t=[])=>{const r={[C]:{totalCount:0,sharedCount:0}};return e.forEach((e=>{const s=e.spaceId;void 0===r[s]&&(r[s]={totalCount:0,sharedCount:0}),r[s].totalCount++,r[C].totalCount++,t.includes(e.id)&&(r[s].sharedCount++,r[C].sharedCount++)})),r};var M=r(18969);const L=(e,t)=>({total_count:t?.totalCount??0,shared_count:t?.sharedCount??0,collections_count:e?.collectionsCount??0,collections_shared_count:e?.collectionsSharedCount??0,multiple_collections_count:e?.multipleCollectionsCount??0,multiple_collections_shared_count:e?.multipleCollectionsSharedCount??0,single_collection_count:e?.singleCollectionCount??0,single_collection_shared_count:e?.singleCollectionSharedCount??0}),G=[v.U.Email,v.U.Address,v.U.Company,v.U.Phone,v.U.Website,v.U.Identity],K=[v.U.BankAccount,v.U.PaymentCard],x=[v.U.DriversLicense,v.U.FiscalId,v.U.IdCard,v.U.Passport,v.U.SocialSecurityId],k=[v.U.Credential,v.U.SecureNote,v.U.Secret,v.U.Passkey,...G,...K,...x];class j{getSpaceScope(e){switch(e){case"":return m.Scope.Personal;case C:return m.Scope.Global;default:return m.Scope.Team}}async send(){const e=await(0,n.z)(this.passwordHealth.queries.passwordHealthReport());if((0,p.hx)(e))return Promise.reject(new Error("Error while retrieving health report for creating the vault report"));const t=await(0,n.z)(this.breachesGetter.getSupportedBreaches());if((0,p.hx)(t))return Promise.reject(new Error("Error while retrieving breaches for creating the vault report"));const r=await(0,n.z)(this.vaultCrud.queries.query({vaultItemTypes:k}));if((0,p.hx)(r))return Promise.reject(new Error("Error while retrieving credentials for creating the vault report"));const s=(0,p.db)(r).credentialsResult,i=await(0,n.z)(this.autofillSettings.queries.getPreferencesForCredentials({}));if((0,p.hx)(i))return Promise.reject(new Error("Error while retrieving credential preferences for creating the vault report"));const o=await(0,n.z)(this.vault.queries.queryCollections({}));if((0,p.hx)(o))return Promise.reject(new Error("Error while retrieving collections for creating the vault report"));const a=await(0,n.z)(this.sharedCollections.queries.sharedCollectionsWithItems());if((0,p.hx)(a))return Promise.reject(new Error("Error while retrieving shared collections for creating the vault report"));const c=await(0,n.z)(this.sharedItems.queries.sharedItemsIds());if((0,p.hx)(c))return Promise.reject(new Error("Error while retrieving shared items ids for creating the vault report"));const d=function(e,t,r){const s=U(e),i=U(t),o={[C]:{domainsWithoutAutofillCount:0,totalCount:0,sharedCount:0,passwordsWithOtpCount:0,passwordsProtectedWithMasterPasswordCount:0}};return Object.keys(s).forEach((e=>{const t=s[e].spaceId;void 0===o[t]&&(o[t]={domainsWithoutAutofillCount:0,totalCount:0,sharedCount:0,passwordsWithOtpCount:0,passwordsProtectedWithMasterPasswordCount:0}),o[t].totalCount++,o[C].totalCount++,r.includes(e)&&(o[t].sharedCount++,o[C].sharedCount++),i[e].useAutoLogin||(o[t].domainsWithoutAutofillCount++,o[C].domainsWithoutAutofillCount++),(s[e].otpSecret||s[e].otpURL)&&(o[t].passwordsWithOtpCount++,o[C].passwordsWithOtpCount++),i[e].requireMasterPassword&&(o[t].passwordsProtectedWithMasterPasswordCount++,o[C].passwordsProtectedWithMasterPasswordCount++)})),o}(s.items,(0,p.db)(i),c.data),l=function(e,t){const r=new Set,s=new Set;e.forEach((e=>{(0,N.F7)(e.Content)?s.add(e.Id):r.add(e.Id)}));const i=new Set,o=new Set,a={global:{activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:s.size,publicBreachAlerts:r.size}};return Object.keys(t).forEach((e=>{if(e===C)return;const n=t[e];void 0===a[e]&&(a[e]={activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:s.size,publicBreachAlerts:r.size}),[...n.breaches].forEach((t=>{r.has(t)?(a[e].activePublicBreachAlerts++,i.add(t)):s.has(t)&&(a[e].activePrivateBreachAlerts++,o.add(t))})),Object.keys(n.compromisedByBreach).forEach((t=>{[...n.compromisedByBreach[t]].some((e=>s.has(e)))&&a[e].passwordsCompromisedThroughPrivateBreaches++})),a[C].passwordsCompromisedThroughPrivateBreaches+=a[e].passwordsCompromisedThroughPrivateBreaches})),a[C].activePrivateBreachAlerts=o.size,a[C].activePublicBreachAlerts=i.size,a}(t.data,e.data);return Object.keys(d).forEach((t=>{const s=e.data[t],i=function(e,t,r){const s=[...e,...t].filter((e=>r===C||r&&e.spaceId||!r&&!e.spaceId)),i=r?t.length:0,o=i+(r===C?e.length:e.filter((e=>r&&e.spaceId||!r&&!e.spaceId)).length);return{itemsPerCollectionAverageCount:P(s),collectionsPerItemAverageCount:R(s),ids:w,passwords:D(s),payments:w,personalInfo:w,secureNotes:w,collectionsSharedCount:i,collectionsTotalCount:o}}((0,p.db)(o).collections,a.data,t),n={scope:this.getSpaceScope(t),...i,...d[t],...l[t]},u=((e,t)=>e?{passwordsSafeCount:t.totalCount-e.corrupted,passwordsExcludedCount:e.excluded,passwordsCompromisedCount:e.compromised,passwordsReusedCount:e.reused,securityScore:e.score??void 0,passwordsWeakCount:e.weak}:{passwordsSafeCount:t.totalCount,passwordsExcludedCount:0,passwordsCompromisedCount:0,passwordsReusedCount:0,securityScore:t.totalCount<M.RG?void 0:M.JK,passwordsWeakCount:0})(s,d[t]),h=((e,t,r,s,i)=>{const o=F([...t.idCardsResult.items,...t.socialSecurityIdsResult.items,...t.driversLicensesResult.items,...t.fiscalIdsResult.items,...t.passportsResult.items]),a=F(t.secureNotesResult.items,i),n=F(t.secretsResult.items,i),c=F(t.passkeysResult.items,i),d=F([...t.paymentCardsResult.items,...t.bankAccountsResult.items]),l=F([...t.addressesResult.items,...t.emailsResult.items,...t.phonesResult.items,...t.websitesResult.items,...t.companiesResult.items,...t.identitiesResult.items]),{totalCount:u,sharedCount:p}=((e,t)=>t.reduce(((t,r)=>({totalCount:t.totalCount+(r[e]?.totalCount??0),sharedCount:t.sharedCount+(r[e]?.sharedCount??0)})),{totalCount:0,sharedCount:0}))(e,[r,o,l,d,n,a,c]);return{itemsTotalCount:u,itemsSharedCount:p,ids:L(s.ids,o[e]),personalInfo:L(s.personalInfo,l[e]),secureNotes:L(s.secureNotes,a[e]),secrets:L(void 0,n[e]),passkeys:L(void 0,c[e]),payments:L(s.payments,d[e]),passwords:L(s.passwords,r[e])}})(t,r.data,d,i,c.data),g=new m.UserVaultReportEvent({...n,...u,...h});this.analytics.commands.trackEvent({event:g})})),this.store.set({lastSentDate:Date.now()}),Promise.resolve()}async shouldBeSent(){return(await(0,n.z)(this.store.state$)).lastSentDate+864e5<Date.now()}constructor(e,t,r,s,i,o,a,n,c){this.autofillSettings=e,this.breachesGetter=t,this.store=r,this.analytics=s,this.passwordHealth=i,this.vault=o,this.vaultCrud=a,this.sharedCollections=n,this.sharedItems=c}}j=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.W?Object:c.W,void 0===S.U?Object:S.U,void 0===T?Object:T,void 0===u.R?Object:u.R,void 0===d.L?Object:d.L,void 0===_.C?Object:_.C,void 0===y.L?Object:y.L,void 0===h.L?Object:h.L,void 0===g.s?Object:g.s])],j);var V=r(94388),W=r(68307);class B{async handle(){await this.vaultReportSender.shouldBeSent()&&this.vaultReportSender.send()}constructor(e){this.vaultReportSender=e}}B=(0,s.__decorate)([(0,W.b)(V.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===j?Object:j])],B);class z{}z=(0,s.__decorate)([(0,i.Yl)({api:o.f,handlers:{commands:{},events:{...(0,i.g4)(a.d,{passwordHealthComputationFinished:B})},queries:{}},providers:[S.U,j],stores:[T]})],z)},4350:(e,t,r)=>{r.d(t,{v:()=>s});const s="ecommerce_cancel_flow_discounts"},77404:(e,t,r)=>{r.d(t,{c:()=>o});var s=r(86952),i=r(42616);const o=(0,s.Q)({name:"b2cPlansApi",commands:{},events:{},queries:{getB2CPlanPricing:i.W}})},42616:(e,t,r)=>{r.d(t,{W:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},14620:(e,t,r)=>{r.d(t,{X:()=>S});var s=r(88802),i=r(99634),o=r(77404),a=r(93850),n=r(57924),c=r(87113),d=r(48844),l=r(87279);class u{getPlanPricing({login:e,userKey:t,couponCode:r,language:s,hasEssentials:i}){return this.serverApiClient.v1.payments.getAccessibleWebOffers({login:e,userKey:t,couponCode:r,language:s,forceFamily:!0,hasEssentials:i}).pipe((0,d.DZ)((e=>{throw new Error(`GetPlanPricing failed with error: ${e}`)})),(0,d.lk)((e=>{const{plans:t,currency:r}=e.data,{family:s,premium:i}=t,{offers:o,...a}=s,{offers:n,...c}=i,d={plans:{family:{offers:o.map((({price:e,duration:t,...r})=>({price:.01*(e??0),billingPeriod:{periodicity:this.getPeriodicity(t.unit,t.value),value:t.value},...r}))),...a},premium:{offers:n.map((({price:e,duration:t,...r})=>({price:.01*(e??0),billingPeriod:{periodicity:this.getPeriodicity(t.unit,t.value),value:t.value},...r}))),...c}},currency:r};return(0,l.Vp)(d)})))}constructor(e){this.serverApiClient=e,this.getPeriodicity=(e,t)=>"d"===e&&t>=30||"M"===e&&1===t?"monthly":"y"===e&&1===t||"M"===e&&12===t?"yearly":"other"}}u=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.l?Object:c.l])],u);var p=r(41842),m=r(87065),h=r(43978),g=r(20754),v=r(86252),_=r(42616);class y{execute(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.account.login"}).pipe((0,p.h)(l.d6),(0,m.U)((e=>e.data)),(0,h.w)((e=>this.webOffersService.getPlanPricing({login:e}))))}constructor(e,t){this.carbonLegacyClient=e,this.webOffersService=t}}y=(0,s.__decorate)([(0,g.e)(_.W),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v._?Object:v._,void 0===u?Object:u])],y);class S{}S=(0,s.__decorate)([(0,i.Yl)({api:o.c,handlers:{commands:{},events:{},queries:{getB2CPlanPricing:y}},imports:[a.n],providers:[u]})],S)},58880:(e,t,r)=>{r.d(t,{Z:()=>j});var s=r(88802),i=r(99634),o=r(93850),a=r(89193),n=r(25029),c=r(95681),d=r(23347),l=r(10722);const u=e=>!(!e||"object"!=typeof e)&&("activityLogsQueue"in e&&Array.isArray(e.activityLogsQueue));class p extends((0,c.Q)({persist:!0,storage:{initialValue:{activityLogsQueue:[]},typeGuard:u,schemaVersion:1},scope:n.F.User,storeName:"activity-logs",storeTypeGuard:u,codec:l.E,capacity:d.Y._010KB})){}var m=r(64987),h=r(98976),g=r(63663),v=r(87279),_=r(60399),y=r(86252),S=r(57924),E=r(48844);class f{get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"state.userSession.spaceData.spaces"}).pipe((0,E.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t?.teamId&&"object"==typeof t?.details&&"string"==typeof t?.details.status}))))(e))throw new Error("Bad space item format");const t=e.find((e=>"accepted"===e.details.status)),r=t?.details.info.collectSensitiveDataAuditLogsEnabled;return Boolean(r)})))}constructor(e){this.carbonLegacyClient=e}}f=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===y._?Object:y._])],f);const A=new m.WU;class I{async execute({body:{activityLogs:e}}){const t=await(0,_.z)(this.sensitiveLogsEnabledGetter.get());if(!(0,v.d6)(t))throw new Error("Error while getting sensitive logs enabled data");const r=e.filter((e=>!e.is_sensitive||t.data));return r.length&&await this.updateActivityLogsState(r),Promise.resolve((0,v.Vp)(void 0))}async updateActivityLogsState(e){await A.runExclusive((async()=>{const t=await this.activityLogsStore.getState();await this.activityLogsStore.set({...t,activityLogsQueue:[...t.activityLogsQueue,...e]})}))}constructor(e,t){this.activityLogsStore=e,this.sensitiveLogsEnabledGetter=t}}I=(0,s.__decorate)([(0,g.W)(h.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p?Object:p,void 0===f?Object:f])],I);var O=r(9671),b=r(87113);class T{async sendLogs(e){return await(0,_.z)(this.serverApiClient.v1.teams.storeAuditLogs({auditLogs:e}).pipe((0,E.DZ)((()=>(0,v.Rn)("storeActivityLogs failed with an unknown HTTP error"))),(0,E.lk)((e=>e.data.invalidAuditLogs.length?(0,v.Vp)(this.serverToTechnicalSchemaErrorsMapper(e.data.invalidAuditLogs)):(0,v.Vp)(void 0)))))}serverToTechnicalSchemaErrorsMapper(e){return{invalidActivityLogs:e.map((e=>({uuid:e.uuid,error:h.W[e.error]})))}}startAuditLogQuery(e,t){return this.serverApiClient.v1.teams.startAuditLogsQuery({startDateRangeUnix:e,endDateRangeUnix:t}).pipe((0,E.DZ)((()=>{throw new Error("Error while starting audit log query")})),(0,E.Qn)((e=>e.data.queryExecutionId)))}getAuditLogQueryResults({queryExecutionId:e,nextToken:t,maxResults:r}){return this.serverApiClient.v1.teams.getAuditLogQueryResults({queryExecutionId:e,nextToken:t,maxResults:r??30}).pipe((0,E.DZ)((()=>{throw new Error("Error while retrieving audit log query result")})),(0,E.Qn)((e=>({state:e.data.state,nextToken:e.data.nextToken,logs:e.data.results.map((e=>JSON.parse(e)))}))))}constructor(e){this.serverApiClient=e}}T=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===b.l?Object:b.l])],T);class C{async isRunnable(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();return e.length>0}async run(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();await this.attemptSendLogsToServer(e)}async attemptSendLogsToServer(e){const t=[...e];for(;t.length>0;){const e=t.splice(0,40);await this.sendLogsToServer(e)}}async sendLogsToServer(e){const t=await this.activityLogsService.sendLogs(e);if((0,v.hx)(t))return;const r=e.map((e=>e.uuid));if(await this.removeSentLogsFromActivityLogsQueue(r),t.data?.invalidActivityLogs){const r=this.createLogsTypeMap(e),s=e=>()=>{const t=r.get(e.uuid);throw new Error(`An activity log with a log type of ${t} has been detected to have a technical/schema error. (${e.error})`)};await this.allowedToFail.do((t.data.invalidActivityLogs??[]).map(s))}}createLogsTypeMap(e){const t=new Map;return e.forEach((e=>{t.set(e.uuid,e.log_type)})),t}async removeSentLogsFromActivityLogsQueue(e){const{activityLogsQueue:t}=await this.activityLogsStore.getState(),r=t.filter((t=>!e.includes(t.uuid)));await this.activityLogsStore.set({activityLogsQueue:[...r]})}constructor(e,t,r){this.activityLogsService=e,this.allowedToFail=t,this.activityLogsStore=r}}C=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===T?Object:T,void 0===O.J?Object:O.J,void 0===p?Object:p])],C);var w=r(57571);class R extends((0,c.Q)({persist:!1,isCache:!0,scope:n.F.User,storeName:"activity-logs",initialValue:{status:w.Q.NOT_LOADED},capacity:d.Y._100KB})){}var P=r(56073);const D=(e,t)=>{if(!t)return e;const{categories:r,domain:s,logTypes:i,login:o}=t;return e.filter((e=>{if(o&&!e.properties?.author_login?.includes(o))return!1;if(r&&!r.some((t=>e.category===t)))return!1;if(i&&!i.some((t=>e.log_type===t)))return!1;if(s){const t=e.properties;if(!t.domain_url?.includes(s))return!1}return!0}))};class N{async execute(){const e=await this.logsStore.getState(),{queryInfo:t}=e;if(!t?.queryExecutionId||!t.nextToken)return Promise.resolve((0,v.Vp)(void 0));this.logsStore.set({...e,queryInfo:{...t,nextToken:void 0},status:w.Q.LOADING});const r=await(0,_.z)(this.activityLogService.getAuditLogQueryResults({queryExecutionId:t.queryExecutionId,nextToken:t.nextToken}));if((0,v.hx)(r))return this.logsStore.set({status:w.Q.ERROR}),Promise.resolve((0,v.Vp)(void 0));const{logs:s,nextToken:i}=r.data;return this.logsStore.set({...e,status:w.Q.READY,queryInfo:{...t,nextToken:i},logs:[...e.logs??[],...D(s,t.filters)]}),Promise.resolve((0,v.Vp)(void 0))}constructor(e,t){this.logsStore=e,this.activityLogService=t}}var U;N=(0,s.__decorate)([(0,g.W)(P.X),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===R?Object:R,void 0===T?Object:T])],N),function(e){e.TacFilterActivityLogs="webproduct_tac_filter_activity_logs"}(U||(U={}));var F=r(79448);class M{async execute({body:{startDate:e,endDate:t,filters:r}}){this.logsStore.set({status:w.Q.LOADING,queryInfo:{filters:r}});const s=await(0,_.z)(this.activityLogService.startAuditLogQuery(e,t));if((0,v.hx)(s))return this.logsStore.set({status:w.Q.ERROR}),Promise.resolve((0,v.Vp)(void 0));const{data:i}=s;let o=!1;do{const e=await(0,_.z)(this.activityLogService.getAuditLogQueryResults({queryExecutionId:i}));if((0,v.hx)(e)||"CANCELLED"===e.data.state||"FAILED"===e.data.state){this.logsStore.set({status:w.Q.ERROR});break}const{state:t,nextToken:s,logs:a}=e.data;"QUEUED"!==t&&"RUNNING"!==t?(this.logsStore.set({status:w.Q.READY,logs:D(a,r),queryInfo:{queryExecutionId:i,nextToken:s,filters:r}}),o=!0):await new Promise((e=>setTimeout((()=>e()),3e3)))}while(!o);return Promise.resolve((0,v.Vp)(void 0))}constructor(e,t){this.logsStore=e,this.activityLogService=t}}M=(0,s.__decorate)([(0,g.W)(F.b),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===R?Object:R,void 0===T?Object:T])],M);var L=r(20754),G=r(87065);class K{execute(){return this.logsStore.state$.pipe((0,G.U)((e=>(0,v.Vp)({logs:e.logs??[],hasMoreData:!!e.queryInfo?.nextToken,status:e.status}))))}constructor(e){this.logsStore=e}}K=(0,s.__decorate)([(0,L.e)(w.I),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===R?Object:R])],K);var x=r(60678);class k{execute(){return this.sensitiveLogsEnabledGetter.get()}constructor(e){this.sensitiveLogsEnabledGetter=e}}k=(0,s.__decorate)([(0,L.e)(x._),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===f?Object:f])],k);class j{}j=(0,s.__decorate)([(0,i.Yl)({api:a.g,imports:[o.n],providers:[T,f],stores:[p,R],crons:[{handler:C,periodInMinutes:1,name:"activity-logs-cron",scope:n.F.User}],handlers:{commands:{initiateActivityLogsRetrieval:M,loadNextActivityLogs:N,storeActivityLogs:I},events:{},queries:{activityLogs:K,areSensitiveLogsEnabled:k}},requiredFeatureFlips:Object.values(U)})],j)},11472:(e,t,r)=>{r.d(t,{a:()=>J});var s=r(88802),i=r(99634),o=r(37935),a=r(93850),n=r(30049),c=r(48847),d=r(56680),l=r(6453),u=r(60399),p=r(57924),m=r(87113),h=r(87279);class g{async check(e){const t=await this.passwordHasher.hash(e),r=await(0,u.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,h.hx)(r))throw new Error("Error while retrieving list of hashes for password leak check");return r.data.data.includes(t)}constructor(e,t){this.serverApiClient=e,this.passwordHasher=t}}g=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l,void 0===l.T?Object:l.T])],g);var v=r(48844),_=r(18533),y=r(20195),S=r(23035),E=r(15043);class f{generateMassDeploymentTeamKey(){return(0,u.z)(this.serverApiClient.v1.massdeployment.generateMassDeploymentTeamKey().pipe((0,v.DZ)((e=>(0,_.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:y.j,BadStatus:y.j,InternalServerError:y.j,InvalidRequest:y.j,RateLimited:y.j,ServiceUnavailable:y.j,UnspecifiedBadStatus:y.j}))),(0,v.Qn)((e=>e.data))))}async getMassDeploymentTeamKeyFromBrowserPolicies(){const e="MassDeployedTeamKey";try{const t=await(0,E.U)();if("object"==typeof t&&null!==t&&e in t&&"string"==typeof t[e]&&t[e].length)return{token:t[e],exception:void 0}}catch(e){return{token:null,exception:"Error trying to get Managed Storage."}}return{token:null,exception:void 0}}getFunctionalError(e){switch(e){case S.rI.TEAM_NOT_FOUND:return(0,S.o1)();case S.rI.VALID_MASS_DEPLOYMENT_TEAM_KEY_ALREADY_EXISTS_FOR_TEAM:return(0,S.$m)();default:throw new Error(`GenerateMassDeploymentTeamKey: error ${e}`)}}constructor(e){this.serverApiClient=e}}f=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l])],f);var A=r(46035),I=r(95681),O=r(23347),b=r(25029),T=r(7165);const C=T.z.object({active:T.z.boolean(),teamId:T.z.number().nullable(),configuration:T.z.nullable(T.z.object({}))}),w=e=>C.safeParse(e).success;class R extends((0,I.Q)({persist:!1,scope:b.F.User,storeName:"mass-deployment-security-monitoring-configuration",initialValue:{active:!1,teamId:null,configuration:{}},storeTypeGuard:w,capacity:O.Y._001KB})){}class P{async refreshState(){const e=await this.getMassDeploymentSecurityMonitoringConfiguration();return(0,h.d6)(e)&&this.massDeploymentSecurityConfigurationStore.set({...e.data}),e}async updateLoggedOutMonitoringActiveStatus(e){const t=await(0,u.z)(this.serverApiClient.v1.massdeployment.updateMassDeploymentSecurityMonitoringConfiguration({active:e}));return(0,h.hx)(t)?(0,h.Rn)((0,A.x)()):(this.refreshState(),(0,h.Vp)(void 0))}async getMassDeploymentSecurityMonitoringConfiguration(){const e=await(0,u.z)(this.serverApiClient.v1.massdeployment.getMassDeploymentSecurityMonitoringConfiguration());return(0,h.hx)(e)?(0,h.Rn)((0,A.x)()):(0,h.Vp)(e.data.data)}constructor(e,t){this.serverApiClient=e,this.massDeploymentSecurityConfigurationStore=t}}P=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m.l?Object:m.l,void 0===R?Object:R])],P);var D=r(86252),N=r(63663);class U{async execute(){const e=await this.massDeploymentTeamKeyService.generateMassDeploymentTeamKey();if((0,h.hx)(e))return e;const{massDeploymentTeamAccessKey:t,massDeploymentTeamSecretKey:r}=(0,h.db)(e);return await this.carbonLegacyClient.commands.persistMassDeploymentTeamKey({massDeploymentTeamAccessKey:t,massDeploymentTeamSecretKey:r}),(0,h.Vp)(void 0)}constructor(e,t){this.massDeploymentTeamKeyService=e,this.carbonLegacyClient=t}}U=(0,s.__decorate)([(0,N.W)(S.tv),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===f?Object:f,void 0===D._?Object:D._])],U);var F=r(67426);class M{async execute(){return(0,h.Vp)(void 0)}}M=(0,s.__decorate)([(0,N.W)(F.r)],M);var L=r(4087);class G{async execute({body:{active:e}}){return this.massDeploymentSecurityMonitoringConfigurationService.updateLoggedOutMonitoringActiveStatus(e)}constructor(e){this.massDeploymentSecurityMonitoringConfigurationService=e}}G=(0,s.__decorate)([(0,N.W)(L.a),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===P?Object:P])],G);var K=r(162),x=r(87065),k=r(20754),j=r(87954),V=r(85465);class W{execute({body:{password:e}}){const t=(e=>(0,V.evaluate)(e).score/25<3)(e);return(0,K.D)(this.checkPasswordCompromisedService.check(e)).pipe((0,x.U)((e=>(0,h.Vp)({isWeak:t,isCompromised:e}))))}constructor(e){this.checkPasswordCompromisedService=e}}W=(0,s.__decorate)([(0,k.e)(j.S),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g?Object:g])],W);var B=r(18154),z=r(57325);class H{execute(){return this.massDeploymentSecurityMonitoringConfigurationStore.state$.pipe((0,x.U)((e=>(e.teamId||this.massDeploymentSecurityMonitoringConfigurationService.refreshState(),e))),(0,B.n)((e=>!e.teamId)),(0,x.U)(h.Vp))}constructor(e,t){this.massDeploymentSecurityMonitoringConfigurationService=e,this.massDeploymentSecurityMonitoringConfigurationStore=t}}H=(0,s.__decorate)([(0,k.e)(z.g),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===P?Object:P,void 0===R?Object:R])],H);var Y=r(6136),Q=r(60093);class q{execute(){return this.carbonLegacyClient.queries.liveMassDeploymentTeamKey(void 0).pipe((0,x.U)((e=>{if((0,h.d6)(e)){const{massDeploymentTeamAccessKey:t,massDeploymentTeamSecretKey:r}=(0,h.db)(e);if(t&&r)return`${t}-${r}`}})),(0,Y.x)(),(0,x.U)((e=>(0,h.Vp)({massDeploymentTeamKey:e}))))}constructor(e){this.carbonLegacyClient=e}}q=(0,s.__decorate)([(0,k.e)(Q.w),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===D._?Object:D._])],q);var $=r(74484),X=r(18221);class Z{execute(){return(0,K.D)(this.massDeploymentTeamKeyService.getMassDeploymentTeamKeyFromBrowserPolicies()).pipe((0,x.U)((e=>e.exception?(0,h.Rn)((0,$.z)()):(0,h.Vp)({isEnabled:!!e.token}))))}constructor(e){this.massDeploymentTeamKeyService=e}}Z=(0,s.__decorate)([(0,k.e)(X.m),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===f?Object:f])],Z);class J{}J=(0,s.__decorate)([(0,i.Yl)({api:n.i,imports:[o.D,d.f,a.n],providers:[g,l.T,f,P],stores:[R],handlers:{commands:{generateMassDeploymentTeamKey:U,sendRiskyPasswordLoggedOutLog:M,updateLoggedOutMonitoringActiveStatus:G},events:{},queries:{analysePasswordForRisks:W,getMassDeploymentSecurityMonitoringConfiguration:H,getMassDeploymentTeamKey:q,isLoggedOutMonitoringEnabledForDevice:Z}},requiredFeatureFlips:Object.values(c.q)})],J)},11622:(e,t,r)=>{r.d(t,{g:()=>F});var s=r(88802),i=r(99634),o=r(55102),a=r(39577),n=r(18045),c=r(42674),d=r(95082),l=r(25029),u=r(95681),p=r(23347);const m={token:null,instanceURL:null,active:!1,siemType:null,isSelfSignedCertificateAllowed:!1};class h extends((0,u.Q)({initialValue:!1,persist:!1,scope:l.F.User,storeName:"siem-config",capacity:p.Y._001KB})){}var g=r(57924),v=r(53127),_=r(57648),y=r(42668),S=r(24170),E=r(7165);const f=E.z.object({token:E.z.string().nullable(),instanceURL:E.z.string().nullable(),active:E.z.boolean(),siemType:E.z.enum(["splunk"]).nullable(),isSelfSignedCertificateAllowed:E.z.boolean()}),A="api/siem/GetSIEMConfiguration",I="api/siem/SetSIEMConfiguration";class O{async getSiemConfiguration(){const{teamUuid:e,adminProvisioningKey:t}=await this.scimService.getTeamIdentifiers();if(!e)throw new Error("TeamIdNotFound");if(!t)throw new Error("AdminProvisioningKeyNotFound");try{return await this.enclaveService.callEnclaveEndpoint({endpoint:A,body:{teamUuid:e,adminProvisioningKey:t},responseSchema:f})}catch(e){return Promise.reject((0,y.Nv)())}}async setSiemConfiguration(e){const{teamUuid:t,adminProvisioningKey:r}=await this.scimService.getTeamIdentifiers();if(!t)throw new Error("TeamIdNotFound");if(!r)throw new Error("AdminProvisioningKeyNotFound");const s={...e,adminProvisioningKey:r,teamUuid:t};try{return await this.enclaveService.callEnclaveEndpoint({endpoint:I,body:s,responseSchema:f})}catch(e){switch(e.message){case S.M7.INVALID_URL:return Promise.reject((0,S.q0)());case S.M7.MISMATCHING_ADMIN_PROVISIONING_KEY:return Promise.reject((0,S.HC)());case S.M7.NO_SIEM_CONFIGURATION_UPDATE:return Promise.reject((0,S.$3)());case S.M7.TEAM_NOT_FOUND:return Promise.reject((0,S.gY)());default:return Promise.reject((0,S.SC)())}}}constructor(e,t){this.enclaveService=e,this.scimService=t}}O=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===v.d?Object:v.d,void 0===_.Z?Object:_.Z])],O);var b=r(20754),T=r(87279),C=r(43978);class w{execute(){return this.siemStore.state$.pipe((0,C.w)((async e=>{if(!e)try{const e=await this.siemService.getSiemConfiguration();return await this.siemStore.set(e),(0,T.Vp)(e)}catch(e){return(0,T.Vp)(m)}return(0,T.Vp)(e)})))}constructor(e,t){this.siemStore=e,this.siemService=t}}w=(0,s.__decorate)([(0,b.e)(y.pr),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===O?Object:O])],w);var R=r(63663);class P{async execute({body:e}){const{token:t,instanceURL:r,active:s,isSelfSignedCertificateAllowed:i}=e;try{const e=await this.siemService.setSiemConfiguration({active:s,instanceURL:r,token:t,siemType:"splunk",isSelfSignedCertificateAllowed:i});return this.siemConfigStore.set(e),(0,T.Vp)(void 0)}catch(e){return(0,T.Rn)(e)}}constructor(e,t){this.siemConfigStore=e,this.siemService=t}}P=(0,s.__decorate)([(0,R.W)(S.Qj),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h,void 0===O?Object:O])],P);var D=r(68307),N=r(40447);class U{async handle(){await this.siemConfigStore.clear()}constructor(e){this.siemConfigStore=e}}U=(0,s.__decorate)([(0,D.b)(N.z),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===h?Object:h])],U);class F{}F=(0,s.__decorate)([(0,i.Yl)({api:o.v,stores:[h],providers:[O],imports:[a.E,n.i,c.D],handlers:{commands:{setSiemConfiguration:P},events:{...(0,i.g4)(d.y,{confidentialSsoSettingsReset:U})},queries:{getSiemConfiguration:w}},requiredFeatureFlips:["setup_rollout_splunk_integration_prod","setup_rollout_siem_self_signed_certificate"]})],F)},13252:(e,t,r)=>{r.d(t,{IP:()=>l,Iy:()=>n,Uv:()=>d,bd:()=>c,dg:()=>u,i:()=>p,qb:()=>i,y$:()=>a,y3:()=>s});var s,i,o=r(7165);!function(e){e.Admin="admin",e.Limited="limited"}(s||(s={})),function(e){e.Pending="pending",e.Accepted="accepted",e.Refused="refused",e.Revoked="revoked"}(i||(i={}));const a=o.z.nativeEnum(i),n=o.z.nativeEnum(s),c=o.z.union([o.z.literal("noKey"),o.z.literal("publicKey"),o.z.literal("sharingKeys")]);var d,l;!function(e){e.User="user",e.UserGroup="group",e.CollectionUser="collectionUser",e.CollectionUserGroup="collectionUserGroup"}(d||(d={})),function(e){e.Group="group",e.Collection="collection",e.User="user"}(l||(l={}));const u=o.z.nativeEnum(d),p=o.z.nativeEnum(l)},74675:(e,t,r)=>{r.r(t),r.d(t,{ATTACHMENT_IN_COLLECTION:()=>X.Pf,AcceptCollectionInviteCommand:()=>T.cD,AcceptCollectionInviteFailedError:()=>T.nu,AcceptCollectionInviteResultErrorCode:()=>T.Ti,AcceptSharedItemInviteCommand:()=>C.C,AcceptUserGroupInviteCommand:()=>w.Q,AddItemsToCollectionsCommand:()=>$.k,CollectionUserAccessSchema:()=>O.v,CollectionUserGroupAccessSchema:()=>O.r8,CreateSharedCollectionCommand:()=>X.I4,DeleteSharedCollectionCommand:()=>Z.U,DirectAccessSchema:()=>O.eA,GetCollectionPermissionsForUserQuery:()=>W.y,GetCollectionRoleForGroupQuery:()=>B.L,GetCollectionsForUserOrGroupQuery:()=>z.Q,GetInvitesQuery:()=>U.q,GetIsLastAdminForItemQuery:()=>p.X,GetItemGroupIdForItemIdQuery:()=>c.C,GetItemIdsInSharedCollectionsQuery:()=>V.q,GetItemIdsInSharedCollectionsSchema:()=>ne.Po,GetPendingCollectionsQuery:()=>F.D,GetPermissionForItemQuery:()=>l.C,GetPermissionForItemsQuery:()=>u.R,GetSharedCollectionsCountQuery:()=>Y.C,GetSharedCollectionsQuery:()=>H.$,GetSharedItemsForItemIdsQuery:()=>n.z,GetSharingGroupsQuery:()=>le.f,GetSharingStatusForItemQuery:()=>d.S,GetSharingTeamLoginsQuery:()=>o.G,GetSharingUsersQuery:()=>ue.K,GetUserSharedVaultItemsQuery:()=>h.v,HasInvitesQuery:()=>M._,InviteCollectionMembersCommand:()=>J.Q,IsSharingAllowedQuery:()=>v.B,MoveCollectionItemsToBusinessSpaceCommand:()=>ae.g,PendingCollectionSchema:()=>G,PendingItemGroupSchema:()=>K,PendingUserGroupSchema:()=>x,Permission:()=>s.y3,PermissionSchema:()=>s.Iy,RecipientTypeSchema:()=>s.i,RecipientTypes:()=>s.IP,RefuseCollectionInviteCommand:()=>R.UC,RefuseCollectionInviteFailedError:()=>R.R$,RefuseCollectionInviteResultErrorCode:()=>R.eT,RefuseItemGroupInviteAuthorHasInvalidStatusError:()=>P.bp,RefuseItemGroupInviteCommand:()=>P.gm,RefuseItemGroupInviteGroupHasInvalidStatusError:()=>P.Xj,RefuseItemGroupInviteInvalidItemGroupRevisionError:()=>P.Ne,RefuseItemGroupInviteNotEnoughAdminsError:()=>P.Ix,RefuseItemGroupInviteNotFoundError:()=>P.fL,RefuseItemGroupInviteResultErrorCode:()=>P.dI,RefuseItemGroupInviteUserGroupIsNotInItemGroupError:()=>P.Te,RefuseItemGroupInviteUserIsNotInItemGroupError:()=>P.hp,RefuseItemGroupInviteUserIsNotInPendingStatusError:()=>P.gR,RefuseSharedItemCommand:()=>y.l,RefuseUserGroupInviteAuthorHasInvalidStatusError:()=>D.K8,RefuseUserGroupInviteCommand:()=>D.Fo,RefuseUserGroupInviteGroupHasInvalidStatusError:()=>D.kh,RefuseUserGroupInviteInsufficientPrivilegesError:()=>D.FO,RefuseUserGroupInviteInvalidItemGroupRevisionError:()=>D.Uf,RefuseUserGroupInviteInvalidTeamIdError:()=>D.Ix,RefuseUserGroupInviteNotFoundError:()=>D.i6,RefuseUserGroupInviteResultErrorCode:()=>D.xC,RefuseUserGroupInviteUserGroupIsNotFoundError:()=>D.U1,RefuseUserGroupInviteUserGroupUpdateConflictError:()=>D.Xp,RefuseUserGroupInviteUserIsNotInPendingStatusError:()=>D.PZ,RefuseUserGroupInviteUserIsNotInUserGroupError:()=>D.xz,RemoteControlSharedItemsCommand:()=>S.v,RemoveItemFromCollectionsCommand:()=>te.B,RenameCollectionCommand:()=>ee.r,RevokeCollectionMembersCommand:()=>re.q,RevokeSharedItemCommand:()=>f.V,RsaStatusSchema:()=>s.bd,RunSharingSyncCommand:()=>he.N,ShareItemFailureReason:()=>_.z,ShareItemsCommand:()=>E.S2,ShareItemsErrorType:()=>E.Mb,ShareItemsErrorsQuery:()=>_.f,ShareableCollectionSchema:()=>Q.JQ,ShareableCollectionVaultItemSchema:()=>Q.FN,SharedAccessForItemQuery:()=>m.v,SharedCollectionRole:()=>ne.Yt,SharedCollectionSchema:()=>ne.MX,SharedCollectionUserGroupSchema:()=>ne.yD,SharedCollectionUserOrGroupViewSchema:()=>ne.fg,SharedCollectionUserSchema:()=>ne.Me,SharedCollectionsWithItemsQuery:()=>Q.MO,SharedItemAccessLinkTypes:()=>s.Uv,SharedItemAccessLinkTypesSchema:()=>s.dg,SharedItemDecryptionLinkSchema:()=>O.I2,SharedItemRecipientIdsSchema:()=>O.QT,SharedItemSchema:()=>O.m$,SharedItemsIdsQuery:()=>g.c,SharingCollectionsClient:()=>ce.L,SharingDisabledReason:()=>ne.Hz,SharingEnabledQuery:()=>a.N,SharingInvitesClient:()=>k.h,SharingItemsClient:()=>I.s,SharingUserSchema:()=>pe.g,Status:()=>s.qb,StatusSchema:()=>s.y$,UpdateCollectionMembersCommand:()=>ie.c,UpdatePendingCollectionsCommand:()=>N.r,UpdatePermissionForCollectionItemCommand:()=>oe.a,UpdateSharedCollectionsCommand:()=>se.M,UpdateSharedItemPermissionCommand:()=>A.W,UserGroupAccessSchema:()=>O.Ho,UsersAndGroupsInCollectionQuery:()=>q.O,UsersAndGroupsInCollectionSchema:()=>ne.a7,createAttachmentInCollectionError:()=>X.LG,createLimitExceededError:()=>E.Kb,createPartialSuccessError:()=>E.$u,getRefuseItemGroupInviteFunctionalError:()=>P.fr,getRefuseUserGroupInviteFunctionalError:()=>D.cz,sharingCollectionsApi:()=>j.a,sharingInvitesApi:()=>b.t,sharingItemsApi:()=>i.X,sharingRecipientsApi:()=>de.A,sharingSyncApi:()=>me.k});var s=r(13252),i=r(61582),o=r(95008),a=r(36155),n=r(95803),c=r(66206),d=r(95038),l=r(46234),u=r(62176),p=r(11108),m=r(47670),h=r(39672),g=r(52715),v=r(54933),_=r(32725),y=r(24701),S=r(43656),E=r(33472),f=r(98721),A=r(2741),I=r(35594),O=r(88981),b=r(95940),T=r(64549),C=r(83405),w=r(27122),R=r(37210),P=r(51571),D=r(11050),N=r(97675),U=r(57885),F=r(5650),M=r(71763),L=r(7165);const G=L.z.object({uuid:L.z.string(),name:L.z.string(),referrer:L.z.string(),permission:L.z.nativeEnum(s.y3)}),K=L.z.object({itemGroupId:L.z.string(),referrer:L.z.string(),permission:L.z.enum(["admin","limited"]),items:L.z.array(L.z.any())}),x=L.z.object({groupId:L.z.string(),name:L.z.string(),referrer:L.z.string(),permission:L.z.enum(["admin","limited"])});var k=r(64978),j=r(62048),V=r(7134),W=r(13312),B=r(41869),z=r(10829),H=r(34282),Y=r(14947),Q=r(13575),q=r(54665),$=r(51607),X=r(53384),Z=r(21998),J=r(22210),ee=r(46733),te=r(94020),re=r(88621),se=r(76001),ie=r(31105),oe=r(63792),ae=r(91132),ne=r(11797),ce=r(20980),de=r(87581),le=r(70633),ue=r(53529),pe=r(35863),me=r(29390),he=r(76763)},62048:(e,t,r)=>{r.d(t,{a:()=>I});var s=r(86952),i=r(51607),o=r(53384),a=r(21998),n=r(22210),c=r(31105),d=r(94020),l=r(46733),u=r(88621),p=r(76001),m=r(63792),h=r(91132),g=r(10829),v=r(7134),_=r(34282),y=r(13312),S=r(41869),E=r(14947),f=r(13575),A=r(54665);const I=(0,s.Q)({name:"sharingCollections",commands:{addItemsToCollections:i.k,createSharedCollection:o.I4,deleteSharedCollection:a.U,inviteCollectionMembers:n.Q,updateCollectionMembers:c.c,removeItemFromCollections:d.B,renameCollection:l.r,revokeCollectionMembers:u.q,updateSharedCollections:p.M,updatePermissionForCollectionItem:m.a,moveCollectionItemsToBusinessSpace:h.g},events:{},queries:{getCollectionsForUserOrGroup:g.Q,getItemIdsInSharedCollections:v.q,getSharedCollections:_.$,getCollectionPermissionsForUser:y.y,getCollectionRoleForGroup:S.L,getSharedCollectionsCount:E.C,sharedCollectionsWithItems:f.MO,usersAndGroupsInCollection:A.O}})},51607:(e,t,r)=>{r.d(t,{k:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},53384:(e,t,r)=>{r.d(t,{I4:()=>c,LG:()=>n,Pf:()=>a});var s=r(74354),i=r(25029),o=r(96168);const a="ATTACHMENT_IN_COLLECTION",n=(0,o.Vj)(a,"Unable to share collections containing secure notes with attachments.");class c extends((0,s.g)({scope:i.F.User})){}},21998:(e,t,r)=>{r.d(t,{U:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},22210:(e,t,r)=>{r.d(t,{Q:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},91132:(e,t,r)=>{r.d(t,{g:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},94020:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},46733:(e,t,r)=>{r.d(t,{r:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},88621:(e,t,r)=>{r.d(t,{q:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},31105:(e,t,r)=>{r.d(t,{c:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},63792:(e,t,r)=>{r.d(t,{a:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},76001:(e,t,r)=>{r.d(t,{M:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},7134:(e,t,r)=>{r.d(t,{q:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},41869:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},13312:(e,t,r)=>{r.d(t,{y:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},10829:(e,t,r)=>{r.d(t,{Q:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},14947:(e,t,r)=>{r.d(t,{C:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},34282:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},13575:(e,t,r)=>{r.d(t,{FN:()=>a,JQ:()=>n,MO:()=>c});var s=r(7165),i=r(99059),o=r(25029);const a=s.z.object({id:s.z.string(),type:s.z.string(),url:s.z.optional(s.z.string())}),n=s.z.object({id:s.z.string(),name:s.z.string(),spaceId:s.z.string(),vaultItems:s.z.array(a),isShared:s.z.optional(s.z.boolean())});class c extends((0,i.k)({scope:o.F.User})){}},54665:(e,t,r)=>{r.d(t,{O:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},20980:(e,t,r)=>{r.d(t,{L:()=>o});var s=r(67837),i=r(62048);class o extends((0,s.E)(i.a)){}(0,s.K)(i.a,o)},11797:(e,t,r)=>{r.d(t,{Hz:()=>p,MX:()=>c,Me:()=>o,Po:()=>l,Yt:()=>u,a7:()=>d,fg:()=>n,yD:()=>a});var s=r(7165),i=r(13252);const o=s.z.object({acceptSignature:s.z.optional(s.z.nullable(s.z.string())),collectionKey:s.z.optional(s.z.nullable(s.z.string())),login:s.z.string(),permission:i.Iy,proposeSignature:s.z.optional(s.z.string()),proposeSignatureUsingAlias:s.z.optional(s.z.boolean()),referrer:s.z.string(),rsaStatus:s.z.optional(i.bd),status:i.y$}),a=s.z.object({acceptSignature:s.z.optional(s.z.nullable(s.z.string())),collectionKey:s.z.optional(s.z.nullable(s.z.string())),name:s.z.string(),permission:i.Iy,proposeSignature:s.z.optional(s.z.string()),referrer:s.z.optional(s.z.string()),status:i.y$,uuid:s.z.string()}),n=s.z.object({label:s.z.string(),status:i.y$,permission:i.Iy,id:s.z.string()}),c=s.z.object({name:s.z.string(),privateKey:s.z.string(),publicKey:s.z.string(),revision:s.z.number(),userGroups:s.z.optional(s.z.array(a)),users:s.z.optional(s.z.array(o)),uuid:s.z.string(),authorLogin:s.z.optional(s.z.string())}),d=s.z.object({userGroups:s.z.optional(s.z.array(n)),users:s.z.optional(s.z.array(n))}),l=s.z.array(s.z.string());var u,p;!function(e){e.Editor="editor",e.Manager="manager"}(u||(u={})),function(e){e.DisabledInTAC="disabledInTac",e.EditorRole="editorRole",e.LimitedRightItems="limitedRightItems"}(p||(p={}))},95940:(e,t,r)=>{r.d(t,{t:()=>h});var s=r(86952),i=r(27122),o=r(83405),a=r(64549),n=r(37210),c=r(51571),d=r(11050),l=r(97675),u=r(57885),p=r(5650),m=r(71763);const h=(0,s.Q)({name:"sharingInvites",commands:{AcceptUserGroupInviteCommand:i.Q,AcceptSharedItemInviteCommand:o.C,AcceptCollectionInviteCommand:a.cD,RefuseCollectionInviteCommand:n.UC,RefuseItemGroupInviteCommand:c.gm,RefuseUserGroupInviteCommand:d.Fo,UpdatePendingCollectionsCommand:l.r},events:{},queries:{GetInvitesQuery:u.q,GetPendingCollectionsQuery:p.D,HasInvitesQuery:m._}})},64549:(e,t,r)=>{r.d(t,{Ti:()=>s,cD:()=>c,nu:()=>n});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.AcceptFailed="AcceptFailed"}(s||(s={}));class n extends((0,a.Hu)("AcceptFailed","Failed to accept collection")){}class c extends((0,i.g)({scope:o.F.User})){}},83405:(e,t,r)=>{r.d(t,{C:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},27122:(e,t,r)=>{r.d(t,{Q:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},37210:(e,t,r)=>{r.d(t,{R$:()=>n,UC:()=>c,eT:()=>s});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.RefuseFailed="RefuseFailed"}(s||(s={}));class n extends((0,a.Hu)("RefuseFailed","Failed to refuse collection")){}class c extends((0,i.g)({scope:o.F.User})){}},51571:(e,t,r)=>{r.d(t,{Ix:()=>m,Ne:()=>p,Te:()=>u,Xj:()=>d,bp:()=>c,dI:()=>s,fL:()=>n,fr:()=>g,gR:()=>h,gm:()=>v,hp:()=>l});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.ItemGroupNotFound="ItemGroupNotFound",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.UserIsNotInItemGroup="UserIsNotInItemGroup",e.UserGroupIsNotInItemGroup="UserGroupIsNotInItemGroup",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.NotEnoughAdmins="NotEnoughAdmins",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus"}(s||(s={}));class n extends((0,a.Hu)("ItemGroupNotFound","Item Group not found")){}class c extends((0,a.Hu)("AuthorHasInvalidStatus","User is not in accepted/pending status (already refused or revoked)")){}class d extends((0,a.Hu)("GroupHasInvalidStatus","UserGroup is not in accepted/pending status (already refused or revoked)")){}class l extends((0,a.Hu)("UserIsNotInItemGroup","User is not part of item group")){}class u extends((0,a.Hu)("UserGroupIsNotInItemGroup","User group is not part of item group")){}class p extends((0,a.Hu)("InvalidItemGroupRevision","Item group revision is not valid")){}class m extends((0,a.Hu)("NotEnoughAdmins","The operation would let the item group with no admin")){}class h extends((0,a.Hu)("UserIsNotInPendingStatus",'User is not in "pending" status or not part of a group')){}function g(e){switch(e){case"AUTHOR_HAS_INVALID_STATUS":return new c;case"GROUP_HAS_INVALID_STATUS":return new d;case"USER_IS_NOT_IN_ITEM_GROUP":return new l;case"USER_GROUP_IS_NOT_IN_ITEM_GROUP":return new u;case"INVALID_ITEM_GROUP_REVISION":return new p;case"NOT_ENOUGH_ADMINS":return new m;case"USER_IS_NOT_IN_PENDING_STATUS":return new h;default:throw new Error("Unknown server error")}}class v extends((0,i.g)({scope:o.F.User})){}},11050:(e,t,r)=>{r.d(t,{FO:()=>p,Fo:()=>y,Ix:()=>c,K8:()=>v,PZ:()=>h,U1:()=>d,Uf:()=>l,Xp:()=>u,cz:()=>_,i6:()=>n,kh:()=>g,xC:()=>s,xz:()=>m});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.UserGroupNotFound="UserGroupNotFound",e.InvalidTeamId="InvalidTeamId",e.UserGroupIsNotFound="UserGroupIsNotFound",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.UserGroupUpdateConflict="UserGroupUpdateConflict",e.InsufficientPrivileges="InsufficientPrivileges",e.UserIsNotInUserGroup="UserIsNotInUserGroup",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus"}(s||(s={}));class n extends((0,a.Hu)("UserGroupNotFound","User Group not found")){}class c extends((0,a.Hu)("InvalidTeamId","Provided Team ID is not a number")){}class d extends((0,a.Hu)("UserGroupIsNotFound","User group for provided ID does not exist")){}class l extends((0,a.Hu)("InvalidItemGroupRevision","User group revision is not valid")){}class u extends((0,a.Hu)("UserGroupUpdateConflict","Conflict between users attempting to update the same user group")){}class p extends((0,a.Hu)("InsufficientPrivileges","The user does not have User Group permission to refuse the invitation")){}class m extends((0,a.Hu)("UserIsNotInUserGroup","User is not part of a group")){}class h extends((0,a.Hu)("UserIsNotInPendingStatus",'User is not in "pending" status or not part of a group')){}class g extends((0,a.Hu)("GroupHasInvalidStatus",'UserGroup is not in "accepted" or "pending" status (already refused or revoked)')){}class v extends((0,a.Hu)("AuthorHasInvalidStatus","User is not in accepted/pending status (already refused or revoked)")){}function _(e){switch(e){case"INVALID_TEAM_ID":return new c;case"USER_GROUP_IS_NOT_FOUND":return new d;case"INVALID_USER_GROUP_REVISION":return new l;case"USER_GROUP_UPDATE_CONFLICT":return new u;case"INSUFFICIENT_PRIVILEGES":return new p;case"USER_IS_NOT_IN_USER_GROUP":return new m;case"USER_IS_NOT_IN_PENDING_STATUS":return new h;case"GROUP_HAS_INVALID_STATUS":return new g;case"AUTHOR_HAS_INVALID_STATUS":return new v;default:throw new Error("Unknown server error")}}class y extends((0,i.g)({scope:o.F.User})){}},97675:(e,t,r)=>{r.d(t,{r:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},57885:(e,t,r)=>{r.d(t,{q:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},5650:(e,t,r)=>{r.d(t,{D:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},71763:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},64978:(e,t,r)=>{r.d(t,{h:()=>o});var s=r(67837),i=r(95940);class o extends((0,s.E)(i.t)){}(0,s.K)(i.t,o)},61582:(e,t,r)=>{r.d(t,{X:()=>A});var s=r(86952),i=r(2741),o=r(98721),a=r(24701),n=r(43656),c=r(33472),d=r(54933),l=r(95008),u=r(36155),p=r(66206),m=r(95803),h=r(95038),g=r(46234),v=r(62176),_=r(11108),y=r(47670),S=r(39672),E=r(52715),f=r(32725);const A=(0,s.Q)({name:"sharingItems",commands:{updateSharedItemPermission:i.W,revokeSharedItem:o.V,refuseSharedItem:a.l,remoteControlSharedItems:n.v,shareItems:c.S2},events:{},queries:{isSharingAllowed:d.B,getSharingTeamLogins:l.G,sharingEnabled:u.N,getItemGroupIdForItemId:p.C,getSharedItemsForItemIds:m.z,getSharingStatusForItem:h.S,getPermissionForItem:g.C,getPermissionForItems:v.R,getIsLastAdminForItem:_.X,sharedAccessForItem:y.v,getUserSharedVaultItems:S.v,sharedItemsIds:E.c,shareItemsErrors:f.f}})},24701:(e,t,r)=>{r.d(t,{l:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},43656:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},98721:(e,t,r)=>{r.d(t,{V:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},33472:(e,t,r)=>{r.d(t,{$u:()=>c,Kb:()=>n,Mb:()=>s,S2:()=>d});var s,i=r(74354),o=r(25029),a=r(96168);!function(e){e.LIMIT_EXCEEDED="LIMIT_EXCEEDED",e.PARTIAL_SUCCESS="PARTIAL_SUCCESS"}(s||(s={}));const n=(0,a.Vj)("LIMIT_EXCEEDED","Sharing limit exceeded"),c=(0,a.Vj)("PARTIAL_SUCCESS","Some items were shared successfully, but not all");class d extends((0,i.g)({scope:o.F.User})){}},2741:(e,t,r)=>{r.d(t,{W:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},11108:(e,t,r)=>{r.d(t,{X:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},66206:(e,t,r)=>{r.d(t,{C:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},46234:(e,t,r)=>{r.d(t,{C:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},62176:(e,t,r)=>{r.d(t,{R:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},95803:(e,t,r)=>{r.d(t,{z:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},95038:(e,t,r)=>{r.d(t,{S:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},95008:(e,t,r)=>{r.d(t,{G:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},39672:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},54933:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},32725:(e,t,r)=>{r.d(t,{f:()=>a,z:()=>s});var s,i=r(99059),o=r(25029);!function(e){e[e.ITEM_DOESNT_EXIST=0]="ITEM_DOESNT_EXIST",e[e.LIMIT_EXCEEDED=1]="LIMIT_EXCEEDED",e[e.ITEM_HAS_ATTACHMENTS=2]="ITEM_HAS_ATTACHMENTS",e[e.INVALID_REVISION=3]="INVALID_REVISION",e[e.SHARING_FAILED=4]="SHARING_FAILED"}(s||(s={}));class a extends((0,i.k)({scope:o.F.User})){}},47670:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},52715:(e,t,r)=>{r.d(t,{c:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},36155:(e,t,r)=>{r.d(t,{N:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},35594:(e,t,r)=>{r.d(t,{s:()=>o});var s=r(67837),i=r(61582);class o extends((0,s.E)(i.X)){}(0,s.K)(i.X,o)},88981:(e,t,r)=>{r.d(t,{Ho:()=>n,I2:()=>l,QT:()=>u,eA:()=>a,m$:()=>p,r8:()=>d,v:()=>c});var s=r(7165),i=r(13252);const o=s.z.object({permission:i.Iy,proposeSignature:s.z.optional(s.z.string()),acceptSignature:s.z.optional(s.z.nullable(s.z.string())),encryptedResourceKey:s.z.string(),accessType:i.dg}),a=o.extend({accessType:s.z.literal(i.Uv.User)}),n=o.extend({accessType:s.z.literal(i.Uv.UserGroup),groupEncryptedKey:s.z.optional(s.z.string()),groupPrivateKey:s.z.optional(s.z.string())}),c=o.extend({accessType:s.z.literal(i.Uv.CollectionUser),collectionEncryptedKey:s.z.optional(s.z.string()),collectionPrivateKey:s.z.optional(s.z.string())}),d=o.extend({accessType:s.z.literal(i.Uv.CollectionUserGroup),collectionEncryptedKey:s.z.optional(s.z.string()),collectionPrivateKey:s.z.optional(s.z.string()),groupEncryptedKey:s.z.optional(s.z.string()),groupPrivateKey:s.z.optional(s.z.string())}),l=s.z.union([a,n,c,d]),u=s.z.object({userIds:s.z.optional(s.z.nullable(s.z.array(s.z.string()))),collectionIds:s.z.optional(s.z.nullable(s.z.array(s.z.string()))),userGroupIds:s.z.optional(s.z.nullable(s.z.array(s.z.string())))}),p=s.z.object({accessLink:s.z.optional(l),sharedItemId:s.z.string(),itemId:s.z.string(),itemKey:s.z.string(),revision:s.z.number(),recipientIds:u,permission:i.Iy,isLastAdmin:s.z.boolean()})},87581:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(86952),i=r(53529),o=r(70633);const a=(0,s.Q)({name:"sharingRecipients",commands:{},events:{},queries:{getSharingUsersQuery:i.K,getSharingGroupsQuery:o.f}})},70633:(e,t,r)=>{r.d(t,{f:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},53529:(e,t,r)=>{r.d(t,{K:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.User})){}},35863:(e,t,r)=>{r.d(t,{g:()=>o});var s=r(7165),i=r(13252);const o=s.z.object({userId:s.z.string(),proposeSignature:s.z.optional(s.z.string()),acceptSignature:s.z.optional(s.z.nullable(s.z.string())),status:s.z.optional(i.y$),groupKey:s.z.optional(s.z.nullable(s.z.string()))})},29390:(e,t,r)=>{r.d(t,{k:()=>o});var s=r(86952),i=r(76763);const o=(0,s.Q)({name:"sharingSync",commands:{runSharingSync:i.N},events:{},queries:{}})},76763:(e,t,r)=>{r.d(t,{N:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.User})){}},14139:(e,t,r)=>{r.d(t,{y:()=>m});var s=r(88802),i=r(99634),o=r(44449),a=r(93986),n=r(51612),c=r(57452),d=r(35635),l=r(57865),u=r(15409),p=r(74929);class m{}m=(0,s.__decorate)([(0,i.Yl)({sharedModuleName:"sharing-carbon-helpers",providers:[a.E,n.J,c.n,d.a,o.V,l.H,u.F,p.B],exports:[a.E,n.J,c.n,d.a,o.V,l.H,u.F,p.B],imports:[]})],m)},51612:(e,t,r)=>{r.d(t,{J:()=>d});var s=r(88802),i=r(60399),o=r(57789),a=r(86252),n=r(57924),c=r(87279);class d{async getCarbonCredentialsByItemIds(e){const{queries:{carbonState:t}}=this.client,r=await(0,i.z)(t({path:"userSession.personalData.credentials"}));if((0,c.hx)(r))throw new Error("Unable to access credentials from carbon");const s=r.data;if(!s)throw new Error("No credentials found");if(a=s,!Array.isArray(a)||!a.every(o.G))throw new Error("Credentials are invalid");var a;const n=s.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in n&&e.push(n[t]),e)),[])}constructor(e){this.client=e}}d=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a._?Object:a._])],d)},57452:(e,t,r)=>{r.d(t,{n:()=>l});var s=r(88802),i=r(6136),o=r(10705),a=r(86252),n=r(57924),c=r(48844);const d=e=>{if(!e)return{teamId:"",isSharingEnabled:!1,isCollectionsSharingEnabled:!1,areSensitiveLogsEnabled:!1};const t=e;if(!((r=t.spaces)&&Array.isArray(r)&&0!==r.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r.find((e=>"accepted"===e.status)))))return{teamId:"",isSharingEnabled:!0,isCollectionsSharingEnabled:!1,areSensitiveLogsEnabled:!1};var r;const s=t.spaces.find((e=>"accepted"===e.status)),i=Boolean(t.capabilities?.collectionSharing.enabled),o=t.capabilities?.sharingLimit.info?.limit;return{teamId:s?.teamId??"",isSharingEnabled:Boolean(s&&!s.info.sharingDisabled),areSensitiveLogsEnabled:Boolean(s?.info.collectSensitiveDataAuditLogsEnabled),isCollectionsSharingEnabled:i,sharedItemsLimit:o}};class l{get(){const{getNodePremiumStatus:e}=this.carbon.queries;return e().pipe((0,c.Qn)(d),(0,i.x)(((e,t)=>(0,o.Z)(e,t))))}constructor(e){this.carbon=e}}l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a._?Object:a._])],l)},35635:(e,t,r)=>{r.d(t,{a:()=>c});var s=r(88802),i=r(60399),o=r(86252),a=r(57924),n=r(48844);class c{async getCurrentUserWithKeys(){const{queries:{carbonStateList:e}}=this.client;return await(0,i.z)(e({paths:["userSession.account.login","userSession.session.keyPair.publicKey","userSession.session.keyPair.privateKey"]}).pipe((0,n.nb)({success:([e,t,r])=>{if("string"!=typeof e||"string"!=typeof t||"string"!=typeof r)throw new Error("Invalid format of current user keys");return{login:e,publicKey:t,privateKey:r}},failure:()=>{throw new Error("Failure getting current user and key pair")}})))}constructor(e){this.client=e}}c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===o._?Object:o._])],c)},44449:(e,t,r)=>{r.d(t,{V:()=>c});var s=r(88802),i=r(86252),o=r(57924),a=r(48844),n=r(82181);class c{get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.sharingSync"}).pipe((0,a.Qn)((e=>{if(!(0,n.o)(e))throw new Error("Bad SharingSync format");return e})))}constructor(e){this.carbonLegacyClient=e}}c=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i._?Object:i._])],c)},93986:(e,t,r)=>{r.d(t,{E:()=>u});var s=r(88802),i=r(86252),o=r(57924),a=r(48844),n=r(63877);function c(e){switch(e){case"admin":return n.y3.Admin;case"limited":return n.y3.Limited}}function d(e){switch(e){case"pending":return n.qb.Pending;case"accepted":return n.qb.Accepted;case"refused":return n.qb.Refused;case"revoked":return n.qb.Revoked}}function l(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,items:e.items,users:e.users?[...e.users.map((e=>({...e,permission:c(e.permission),status:d(e.status)})))]:void 0,groups:e.groups?[...e.groups.map((e=>({...e,permission:c(e.permission),status:d(e.status)})))]:void 0,collections:e.collections?[...e.collections?.map((e=>({...e,permission:c(e.permission),status:d(e.status)})))??[]]:void 0}}class u{get(){const{queries:{carbonState:e}}=this.client;return e({path:"userSession.sharingData.itemGroups"}).pipe((0,a.Qn)((e=>e.map(l))))}getForItemId(e){return this.get().pipe((0,a.Qn)((t=>t.find((t=>t.items?.some((t=>e===t.itemId)))))))}getForItemGroupId(e){return this.get().pipe((0,a.Qn)((t=>t.find((t=>t.groupId===e)))))}getForItemsIds(e){return this.get().pipe((0,a.Qn)((t=>t.filter((t=>t.items?.some((t=>e.includes(t.itemId))))))))}getForCollectionId(e){return this.get().pipe((0,a.Qn)((t=>t.filter((t=>t.collections?.some((t=>e.includes(t.uuid))))))))}constructor(e){this.client=e}}u=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===i._?Object:i._])],u)},57865:(e,t,r)=>{r.d(t,{H:()=>d});var s=r(88802),i=r(60399);function o(e){return Boolean(e)&&"KWSecureNote"===e.kwType}var a=r(86252),n=r(57924),c=r(87279);class d{async getCarbonNotesByItemIds(e){const{queries:{carbonState:t}}=this.client,r=await(0,i.z)(t({path:"userSession.personalData.notes"}));if((0,c.hx)(r))throw new Error("Unable to access notes from carbon");const s=r.data;if(!s)throw new Error("No notes found");if(a=s,!Array.isArray(a)||!a.every(o))throw new Error("Notes are invalid");var a;const n=s.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in n&&e.push(n[t]),e)),[])}constructor(e){this.client=e}}d=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a._?Object:a._])],d)},15409:(e,t,r)=>{r.d(t,{F:()=>d});var s=r(88802),i=r(60399);function o(e){return Boolean(e)&&"KWSecret"===e.kwType}var a=r(86252),n=r(57924),c=r(87279);class d{async getCarbonSecretsByItemIds(e){const{queries:{carbonState:t}}=this.client,r=await(0,i.z)(t({path:"userSession.personalData.secrets"}));if((0,c.hx)(r))throw new Error("Unable to access secrets from carbon");const s=r.data;if(!s)throw new Error("No secrets found");if(a=s,!Array.isArray(a)||!a.every(o))throw new Error("Secrets are invalid");var a;const n=s.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in n&&e.push(n[t]),e)),[])}constructor(e){this.client=e}}d=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a._?Object:a._])],d)},74929:(e,t,r)=>{r.d(t,{B:()=>g});var s=r(88802),i=r(60399),o=r(87065),a=r(7165),n=r(86252),c=r(57924),d=r(87279),l=r(63877);function u(e){switch(e){case"admin":return l.y3.Admin;case"limited":return l.y3.Limited}}function p(e){switch(e){case"pending":return l.qb.Pending;case"accepted":return l.qb.Accepted;case"refused":return l.qb.Refused;case"revoked":return l.qb.Revoked}}function m(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,name:e.name,privateKey:e.privateKey,publicKey:e.publicKey,externalId:e.externalId,familyId:e.familyId,users:[...e.users.map((e=>({...e,permission:u(e.permission),status:p(e.status)})))]}}const h=a.z.array(a.z.object({groupId:a.z.string(),name:a.z.string(),externalId:a.z.string().nullable().optional(),teamId:a.z.number().optional(),type:a.z.enum(["users","teamAdmins"]),publicKey:a.z.string(),privateKey:a.z.string(),revision:a.z.number(),users:a.z.array(a.z.object({userId:a.z.string(),alias:a.z.string(),referrer:a.z.string(),groupKey:a.z.string().nullable().optional(),acceptSignature:a.z.string().nullable().optional(),permission:a.z.enum(["admin","limited"]),rsaStatus:a.z.enum(["noKey","publicKey","sharingKeys"]),status:a.z.enum(["pending","accepted","refused","revoked"]),proposeSignatureUsingAlias:a.z.boolean().optional(),proposeSignature:a.z.string().optional()}))}));class g{getRawCarbon$(){const{queries:{carbonState:e}}=this.client;return e({path:"userSession.sharingData.userGroups"})}async getRawCarbon(){const e=await(0,i.z)(this.getRawCarbon$());if((0,d.hx)(e))throw new Error("Failure getting user groups state from carbon sharing data");return e.data}async get(){const e=await this.getRawCarbon(),t=h.safeParse(e);if(!t.success)throw new Error("Invalid format of user group state");return t.data}async getForGroupIds(e){return(await this.get()).filter((t=>e.includes(t.groupId)))}getCarbonUserGroups$(){return this.getRawCarbon$().pipe((0,o.U)((e=>{if((0,d.hx)(e))throw new Error("Failure getting user groups state from carbon sharing data");const t=h.safeParse(e.data);if(!t.success)throw new Error("Failure parsing ser groups state from carbon sharing data");return t.data.map(m)})))}async getCarbonUserGroups(){return(await this.getRawCarbon()).map(m)}constructor(e){this.client=e}}g=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n._?Object:n._])],g)},32336:(e,t,r)=>{r.d(t,{T_:()=>h,cx:()=>p,oP:()=>s});var s,i=r(7165),o=r(13252),a=r(11797);!function(e){e.User="user",e.UserGroup="group"}(s||(s={}));const n=i.z.nativeEnum(s),c=i.z.object({permission:o.Iy,proposeSignature:i.z.optional(i.z.string()),acceptSignature:i.z.optional(i.z.nullable(i.z.string())),encryptedResourceKey:i.z.string(),accessType:n}),d=c.extend({accessType:i.z.literal("user")}),l=c.extend({accessType:i.z.literal("group"),groupEncryptedKey:i.z.optional(i.z.string()),groupPrivateKey:i.z.optional(i.z.string())}),u=i.z.union([d,l]),p=i.z.object({sharedCollections:i.z.array(a.MX)}),m=i.z.object({id:i.z.string(),name:i.z.string(),privateKey:i.z.string(),publicKey:i.z.string(),revision:i.z.number(),isAccepted:i.z.boolean(),permission:o.Iy,accessLink:i.z.optional(u),isLastAdmin:i.z.boolean()}),h=i.z.object({collections:i.z.record(m)})},5482:(e,t,r)=>{r.d(t,{U:()=>s});class s{}},71275:(e,t,r)=>{r.d(t,{G:()=>s});class s{}},77972:(e,t,r)=>{r.d(t,{a:()=>gt});var s=r(88802),i=r(99634),o=r(62048),a=r(93850),n=r(37935),c=r(95681),d=r(23347),l=r(25029),u=r(32336);const p=e=>u.cx.safeParse(e).success;class m extends((0,c.Q)({capacity:d.Y._010KB,persist:!1,scope:l.F.User,storeName:"collections-store",storeTypeGuard:p,initialValue:{sharedCollections:[]}})){}var h=r(57924);class g{}var v=r(44801),_=r(85337),y=r(6554),S=r(68173);class E{async createCollection(e,t,r,s,i,o){const a=await this.sharingCrypto.createResourceKey(),n={resourceKey:a,uuid:e},c=await this.sharingUsers.createSignedUserInvites(i,n),d=o.length>0?await this.sharingUserGroups.createSignedUserGroupInvites(o,n):void 0,{publicKey:l,privateKey:u}=await this.sharingCrypto.createRecipientKeyPair(a);return this.sharingCollectionsGateway.createCollection({collectionId:e,collectionName:r,publicKey:l,privateKey:u,users:c,userGroups:d,teamId:Number(t)})}async renameCollection(e,t){const{revision:r,uuid:s}=e;await this.sharingCollectionsGateway.renameCollection({collectionId:s,revision:r,updatedName:t})}async inviteCollectionMembers(e,t,r){const{revision:s,uuid:i}=e,o=await this.sharingDecryption.decryptCollectionKey(e);if(!o)throw new Error("Cannot decrypt collection key.");const a=t.length?this.sharingUsers.createSignedUserInvites(t,{resourceKey:o,uuid:e.uuid},!1):void 0,n=r.length?this.sharingUserGroups.createSignedUserGroupInvites(r,{resourceKey:o,uuid:e.uuid}):void 0,[c,d]=await Promise.all([a,n]);return await this.sharingCollectionsGateway.inviteCollectionMembers({revision:s,collectionId:i,users:c,userGroups:d})}async updateCollectionMembers(e,t,r){const{revision:s,uuid:i}=e;return await this.sharingCollectionsGateway.updateCollectionMembers({revision:s,collectionId:i,users:t,userGroups:r})}constructor(e,t,r,s,i){this.sharingCollectionsGateway=e,this.sharingCrypto=t,this.sharingDecryption=r,this.sharingUserGroups=s,this.sharingUsers=i}}E=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g?Object:g,void 0===S.O?Object:S.O,void 0===v.c?Object:v.c,void 0===_.o?Object:_.o,void 0===y.E?Object:y.E])],E);var f=r(60399),A=r(87279),I=r(13252),O=r(53384),b=r(35594),T=r(57865),C=r(7502),w=r(89685),R=r(91943),P=r(39431),D=r(50879),N=r(64718),U=r(92467),F=r(71996);class M{async getDomainForCredential(e){const t=await(0,f.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[P.U.Credential],ids:[e]}));if((0,A.hx)(t))throw new Error("Unable to find selected item");const r=t.data.credentialsResult.items[0];return new N.Y(r.URL).getRootDomain()}async createCollectionInvites(e,t,r){const s=await Promise.all(t.map((async t=>{const s=await this.sharingDecryption.decryptItemGroupKey(t);if(null===s)throw new Error("Unable to decrypt item group key");const i=await this.sharingDecryption.decryptCollectionKey(e);if(null===i)throw new Error("Unable to decrypt collection key");const o=await this.sharingCrypto.decryptSecureData(i,(0,C.R)(e.privateKey)),{proposeSignature:a,acceptSignature:n,resourceKey:c}=await this.sharingInvitesCrypto.createSignedInvite(e.uuid,{resourceKey:s,uuid:t.sharedItemId},e.publicKey,(0,w.v)(o));if(!c)throw new Error("Could not create resource key when generating user group invite for collection");if(!n)throw new Error("should not happen");const d=await(0,f.z)(this.activityLogs.queries.areSensitiveLogsEnabled());if((0,A.hx)(d))throw new Error("Unable find preferences");const l=await(0,f.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[P.U.Credential,P.U.SecureNote],ids:[t.itemId]}));if((0,A.hx)(l))throw new Error("Unable to find selected item");const u=l.data.credentialsResult.items.length?{domain:await this.getDomainForCredential(t.itemId),type:U.y.Credential}:void 0;return{id:t.sharedItemId,permission:r,resourceKey:c,proposeSignature:a,acceptSignature:n,auditLogData:u}})));return{collectionId:e.uuid,revision:e.revision,itemGroups:s}}constructor(e,t,r,s,i){this.sharingInvitesCrypto=e,this.sharingCrypto=t,this.sharingDecryption=r,this.vaultItemsCrudClient=s,this.activityLogs=i}}M=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===F.h?Object:F.h,void 0===S.O?Object:S.O,void 0===v.c?Object:v.c,void 0===D.L?Object:D.L,void 0===R._?Object:R._])],M);var L=r(40217),G=r(51612);class K{async addItemsToCollections(e,t,r){const s=await(0,f.z)(this.sharingItemsClient.queries.getSharedItemsForItemIds({itemIds:t}));if((0,A.hx)(s))throw new Error("Unable to find item groups for items");const i=(0,A.db)(s).sharedItems;if(!i.every((e=>e.permission===I.y3.Admin)))throw new Error("User does not have access to share selected items");const o=await this.credentialsGetter.getCarbonCredentialsByItemIds(t),a=await this.notesGetter.getCarbonNotesByItemIds(t),n=[...o,...a];if(a.some((e=>e.Attachments?.length)))return(0,A.Rn)((0,O.LG)());const c=[...n.filter((({Id:e})=>!i.some((t=>t.itemId===e))))],d=c.length>0?await this.sharingItemGroups.createMultipleItemGroups(c):[];return await Promise.all(e.map((async e=>{const t=await this.collectionInvitesService.createCollectionInvites(e,[...i,...d],r.find((t=>t.collectionId===e.uuid))?.permission??I.y3.Admin);await this.sharingCollectionsApi.addItemGroupsToCollection(t)}))),(0,A.Vp)(void 0)}constructor(e,t,r,s,i,o){this.collectionInvitesService=e,this.sharingItemGroups=t,this.sharingCollectionsApi=r,this.credentialsGetter=s,this.notesGetter=i,this.sharingItemsClient=o}}K=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===M?Object:M,void 0===L.k?Object:L.k,void 0===g?Object:g,void 0===G.J?Object:G.J,void 0===T.H?Object:T.H,void 0===b.s?Object:b.s])],K);var x=r(63663),k=r(51607);function j(e){return void 0!==e}var V=r(71275),W=r(80629);class B{async execute({body:e}){const{collectionPermissions:t,itemIds:r,shouldSkipSync:s}=e,i=await this.collectionsRepository.getCollectionsByIds(t.map((e=>e.collectionId)));if(i.length!==t.length)throw new Error("Unable to find some of the collections in the list");const o=await this.sharingCollectionItems.addItemsToCollections(i.filter(j),r,t);if((0,A.hx)(o))throw new Error("Failed adding an item to a list of collections");return s||await this.sharingSync.scheduleSync(),(0,A.Vp)(void 0)}constructor(e,t,r){this.sharingCollectionItems=e,this.sharingSync=t,this.collectionsRepository=r}}B=(0,s.__decorate)([(0,x.W)(k.k),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===K?Object:K,void 0===W.D?Object:W.D,void 0===V.G?Object:V.G])],B);var z=r(87065);class H{async getCollectionsByIds(e){return(await this.store.getState()).sharedCollections.filter((t=>e.includes(t.uuid)))}async getCollections(){return(await this.store.getState()).sharedCollections}collections$(){return this.store.state$.pipe((0,z.U)((e=>e.sharedCollections)))}collection$(e){return this.collections$().pipe((0,z.U)((t=>t.find((t=>t.uuid===e)))))}async getCollection(e){const t=(await this.store.getState()).sharedCollections.find((t=>t.uuid===e));if(t)return t}async updateCollections(e){await this.store.set({sharedCollections:[...e]})}constructor(e){this.store=e}}H=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===m?Object:m])],H);var Y=r(87113);const Q=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:o,permission:a})=>({login:e,collectionKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:o,permission:a}))),q=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,acceptSignature:s,permission:i})=>({groupUUID:e,collectionKey:t,proposeSignature:r,acceptSignature:s,permission:i})));var $=r(11819);class X{async createCollection(e){const t=await(0,f.z)(this.serverApiClient.v1.sharingUserdevice.createCollection((e=>{const{collectionId:t,collectionName:r,users:s,userGroups:i,publicKey:o,privateKey:a,teamId:n}=e;return{collectionUUID:t,collectionName:r,publicKey:o,privateKey:a,teamId:n,users:Q(s),userGroups:i?q(i):void 0}})(e)));if((0,A.hx)(t))throw new Error("Failed to create shared collection from private one");const r=(0,A.db)(t).data.collections?.find((t=>t.uuid===e.collectionId));if(!r)throw new Error("Unable to find collection");return r}async renameCollection(e){const{collectionId:t,revision:r,updatedName:s}=e,i=await(0,f.z)(this.serverApiClient.v1.sharingUserdevice.renameCollection({collectionUUID:t,revision:r,updatedName:s}));if((0,A.hx)(i))throw new Error("Failed to rename shared collection")}async addItemGroupsToCollection(e){const t=await(0,f.z)(this.serverApiClient.v1.sharingUserdevice.addItemGroupsToCollection({collectionUUID:e.collectionId,itemGroups:e.itemGroups.map((({id:e,proposeSignature:t,acceptSignature:r,permission:s,resourceKey:i,auditLogData:o})=>({uuid:e,proposeSignature:t,acceptSignature:r,permission:s,itemGroupKey:i,auditLogDetails:o?(0,$.B)(o):void 0}))),revision:e.revision}));if((0,A.hx)(t))throw new Error("Failed to add items to collection");if(0===((0,A.db)(t).data.collections||[]).length)throw new Error("Failed to add items to collection")}async deleteCollection(e,t){const r={collectionUUID:e,revision:t},s=await(0,f.z)(this.serverApiClient.v1.sharingUserdevice.deleteCollection(r));if((0,A.hx)(s))throw new Error("Failed to delete shared collection")}async inviteCollectionMembers({collectionId:e,revision:t,users:r,userGroups:s}){const i={collectionUUID:e,revision:t,users:r?Q(r):void 0,userGroups:s?q(s):void 0},o=this.serverApiClient.v1.sharingUserdevice.inviteCollectionMembers(i),a=await(0,f.z)(o);if((0,A.hx)(a)||!a.data.data.collections)throw new Error("Failed to add members to collection");return a.data.data.collections[0]}async updateCollectionMembers({collectionId:e,revision:t,users:r,userGroups:s}){const i={collectionUUID:e,revision:t,users:r,userGroups:s?.map((({groupId:e,permission:t})=>({groupUUID:e,permission:t})))},o=this.serverApiClient.v1.sharingUserdevice.updateCollectionMembers(i),a=await(0,f.z)(o);if((0,A.hx)(a)||!a.data.data.collections)throw new Error("Failed to update collection members");return a.data.data.collections[0]}async revokeCollectionMembers({collectionId:e,revision:t,userGroupIds:r,userLogins:s}){const i=this.serverApiClient.v1.sharingUserdevice.revokeCollectionMembers({collectionUUID:e,revision:t,userLogins:s,userGroupUUIDs:r}),o=await(0,f.z)(i);if((0,A.hx)(o)||!o.data.data.collections)throw new Error("Failed to revoke access to collection");return o.data.data.collections[0]}async removeItemGroupsFromCollection(e,t){const r=await(0,f.z)(this.serverApiClient.v1.sharingUserdevice.removeItemGroupsFromCollection({collectionUUID:e.uuid,itemGroupUUIDs:t,revision:e.revision}));if((0,A.hx)(r))throw new Error("Failure to remove items from collection")}async removeItemGroupCollectionAccess(e){const{collectionId:t,itemGroupId:r,itemGroupRevision:s,auditLogData:i}=e,o=await(0,f.z)(this.serverApiClient.v1.sharingUserdevice.revokeItemGroupMembers({revision:s,groupId:r,collections:[t],auditLogDetails:i?(0,$.B)(i):void 0}));if((0,A.hx)(o))throw new Error("Failure to remove collection member from an item group")}constructor(e){this.serverApiClient=e}}X=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Y.l?Object:Y.l])],X);var Z=r(31105),J=r(11797);const ee=e=>e===J.Yt.Manager?I.y3.Admin:I.y3.Limited,te=e=>({login:e.login,permission:ee(e.role)}),re=e=>({groupId:e.groupId,permission:ee(e.role)});class se{async execute({body:e}){const{collectionId:t,userRecipients:r,userGroupRecipients:s}=e,i=await this.collectionsRepository.getCollection(t);if(!i)throw new Error("Collection not found");const o=await this.sharingCollectionsService.updateCollectionMembers(i,r?.map(te),s?.map(re)),a=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==o.uuid));return await this.collectionsRepository.updateCollections([...a,o]),(0,A.Vp)(void 0)}constructor(e,t){this.sharingCollectionsService=e,this.collectionsRepository=t}}se=(0,s.__decorate)([(0,x.W)(Z.c),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===E?Object:E,void 0===V.G?Object:V.G])],se);var ie=r(61076),oe=r(69885),ae=r(21869),ne=r(48844),ce=r(74929);class de{getUserRoleInCollection$(e,t){const r=this.getCurrentUserLogin();return this.userGroupGetter.getCarbonUserGroups$().pipe((0,ie.V)(this.collectionsRepository.collection$(e)),(0,z.U)((([e,s])=>{if(!s)throw new Error("Shared collection not found");const i=t||r,o=s.users?.find((e=>e.login===i)),a=o?.permission===I.y3.Admin&&o.status===I.qb.Accepted,n=e.filter((e=>e.users.some((e=>e.userId===i&&e.status===I.qb.Accepted)))).map((e=>e.groupId)),c=s.userGroups?.filter((e=>n.includes(e.uuid))),d=c?.some((e=>e.permission===I.y3.Admin));return a||d?J.Yt.Manager:J.Yt.Editor})))}getGroupRoleInCollection$(e,t){return this.collectionsRepository.collection$(e).pipe((0,z.U)((e=>{if(!e)throw new Error("Shared collection not found");const r=e.userGroups?.find((e=>e.uuid===t));return r?.permission===I.y3.Admin?J.Yt.Manager:J.Yt.Editor})))}canShareItems(e){return 0===e.length?(0,oe.of)((0,A.Vp)(!0)):this.sharingItemsClient.queries.getSharedItemsForItemIds({itemIds:e}).pipe((0,ne.Qn)((e=>e.sharedItems.every((e=>e.permission===I.y3.Admin)))))}getCurrentUserLogin(){return this.context.get(ae.l.UserName)}constructor(e,t,r,s){this.userGroupGetter=e,this.collectionsRepository=t,this.context=r,this.sharingItemsClient=s}}de=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ce.B?Object:ce.B,void 0===V.G?Object:V.G,void 0===ae.f?Object:ae.f,void 0===b.s?Object:b.s])],de);var le=r(20754),ue=r(14947);class pe{execute(){const e=this.collectionsRepository.collections$(),t=this.getCurrentUserLogin();return e.pipe((0,z.U)((e=>{const r=e.filter((e=>e.authorLogin===t));return(0,A.Vp)(r.length)})))}getCurrentUserLogin(){return this.context.get(ae.l.UserName)}constructor(e,t){this.collectionsRepository=e,this.context=t}}pe=(0,s.__decorate)([(0,le.e)(ue.C),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===V.G?Object:V.G,void 0===ae.f?Object:ae.f])],pe);var me=r(63792),he=r(27790),ge=r(93986);class ve{async execute({body:e}){const{collection:t,groupId:r}=e,s=await(0,f.z)(this.itemGroupsGetter.getForItemGroupId(r));if((0,A.hx)(s)||!s.data)throw new Error("Item group to remove cannot be found");return await this.sharingCommon.updateItemGroupMembers({groupId:r,collections:[{collectionUUID:t.collectionId,permission:t.permission}],revision:s.data.revision}),await this.sharingSync.scheduleSync(),(0,A.Vp)(void 0)}constructor(e,t,r){this.itemGroupsGetter=e,this.sharingCommon=t,this.sharingSync=r}}ve=(0,s.__decorate)([(0,x.W)(me.a),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E,void 0===he.b_?Object:he.b_,void 0===W.D?Object:W.D])],ve);var _e=r(28489),ye=r(10722);const Se=e=>u.T_.safeParse(e).success;class Ee extends((0,c.Q)({persist:!0,scope:l.F.User,storeName:"collections-store",storeTypeGuard:Se,storage:{initialValue:{collections:(0,_e.Ay)({})},typeGuard:Se,schemaVersion:1},capacity:d.Y.Unlimited,codec:ye.E,isCache:!0})){}const fe=({id:e,name:t,revision:r,publicKey:s,privateKey:i})=>({uuid:e,name:t,revision:r,publicKey:s,privateKey:i});class Ae{async getCollectionsByIds(e){const t=await this.store.getState();return e.reduce(((e,r)=>{const s=t.collections[r];return s&&e.push(fe(s)),e}),(0,_e.Ay)([]))}async getCollections(){const e=await this.store.getState();return Object.values(e.collections).map((e=>fe(e)))}collections$(){return this.store.state$.pipe((0,z.U)((e=>Object.values(e.collections).map((e=>fe(e))))))}collection$(e){return this.collections$().pipe((0,z.U)((t=>t.find((t=>t.uuid===e)))))}async getCollection(e){const t=(await this.store.getState()).collections[e];if(t)return fe(t)}async updateCollections(){throw new Error("not supported")}constructor(e){this.store=e}}Ae=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ee?Object:Ee])],Ae);var Ie=r(162),Oe=r(43978),be=r(21242);class Te{async getCollectionsByIds(e){return(await this.getRepo()).getCollectionsByIds(e)}async getCollections(){return(await this.getRepo()).getCollections()}collections$(){return(0,Ie.D)(this.getRepo()).pipe((0,Oe.w)((e=>e.collections$())))}collection$(e){return(0,Ie.D)(this.getRepo()).pipe((0,Oe.w)((t=>t.collection$(e))))}async getCollection(e){return(await this.getRepo()).getCollection(e)}async updateCollections(e){return(await this.getRepo()).updateCollections(e)}async getRepo(){const{userFeatureFlip:e}=this.featureFlips.queries,t=await(0,f.z)(e({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}));return(0,A.hx)(t)?this.legacyRepo:(0,A.db)(t)?this.repo:this.legacyRepo}constructor(e,t,r){this.legacyRepo=e,this.repo=t,this.featureFlips=r}}Te=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===H?Object:H,void 0===Ae?Object:Ae,void 0===be.P?Object:be.P])],Te);var Ce=r(5482);class we{async getCollections(){const{collections:e}=await this.store.getState();return e}async setCollections(e){await this.store.set({collections:e.reduce(((e,t)=>(e[t.id]=t,e)),(0,_e.Ay)({}))})}constructor(e){this.store=e}}we=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===Ee?Object:Ee])],we);var Re=r(77802),Pe=r(50436);const De=e=>e.login,Ne=e=>e.groupId,Ue=e=>e.length>0?e.map(De):void 0;class Fe{async execute({body:e}){const{teamId:t,collectionName:r,privateCollectionId:s,users:i,groups:o,defaultItemPermissions:a,itemIds:n}=e,c=(0,Pe.R)(),d=await this.sharingCollections.createCollection(c,t,r,a,i.map(te),o.map(re)),l={collectionId:c,permission:a};if(n.length>0)try{const e=await this.sharingCollectionItems.addItemsToCollections([d],n,[l]);if((0,A.hx)(e))throw new Error(e.error.tag)}catch(e){const t=await this.sharingCollectionsGateway.revokeCollectionMembers({collectionId:d.uuid,revision:d.revision,userGroupIds:(u=o,u.length>0?u.map(Ne):void 0),userLogins:Ue(i)});if(await this.sharingCollectionsGateway.deleteCollection(t.uuid,t.revision),await this.sharingSync.scheduleSync(),e instanceof Error&&e.message===O.Pf)return(0,A.Rn)((0,O.LG)());throw e}var u;const{commands:p}=this.vaultClient;return s?await p.deleteCollection({id:s}):await this.sharingSync.scheduleSync(),(0,A.Vp)(void 0)}constructor(e,t,r,s,i){this.sharingCollections=e,this.sharingCollectionsGateway=t,this.sharingCollectionItems=r,this.vaultClient=s,this.sharingSync=i}}Fe=(0,s.__decorate)([(0,x.W)(O.I4),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===E?Object:E,void 0===g?Object:g,void 0===K?Object:K,void 0===Re.C?Object:Re.C,void 0===W.D?Object:W.D])],Fe);var Me=r(21998);class Le{async execute({body:e}){const{id:t}=e,r=await this.collectionsRepository.getCollection(t);if(!r)throw new Error("Failed to find collection revision");return await this.sharingCollectionsApi.deleteCollection(r.uuid,r.revision),await this.sharingSync.scheduleSync(),(0,A.Vp)(void 0)}constructor(e,t,r){this.sharingSync=e,this.collectionsRepository=t,this.sharingCollectionsApi=r}}Le=(0,s.__decorate)([(0,x.W)(Me.U),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===W.D?Object:W.D,void 0===V.G?Object:V.G,void 0===g?Object:g])],Le);var Ge=r(22210);class Ke{async execute({body:e}){const{collectionId:t,userRecipients:r,userGroupRecipients:s}=e,i=await this.collectionsRepository.getCollection(t);if(!i)throw new Error("Collection not found");const o=await this.sharingCollectionsService.inviteCollectionMembers(i,r?.map(te)||[],s?.map(re)||[]),a=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==o.uuid));return await this.collectionsRepository.updateCollections([...a,o]),(0,A.Vp)(void 0)}constructor(e,t){this.sharingCollectionsService=e,this.collectionsRepository=t}}Ke=(0,s.__decorate)([(0,x.W)(Ge.Q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===E?Object:E,void 0===V.G?Object:V.G])],Ke);var xe=r(94020),ke=r(57452);class je{async prepareAuditLogDetails(e){const{userFeatureFlips:t}=this.featureFlips.queries,r=await(0,f.z)(t().pipe((0,ne.Qn)((e=>e.audit_logs_sharing&&e.send_activity_log)))),s=!!(0,A.d6)(r)&&(r.data??!1),i=await(0,f.z)(this.currentSpaceGetter.get());if((0,A.hx)(i))throw new Error("Error fetching current space when moving shared collection items to business space");if(!i.data.areSensitiveLogsEnabled||!s)return;const o=await(0,f.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[P.U.Credential],ids:[e]}));if((0,A.hx)(o))throw new Error("Unable to find selected item");const a=(0,A.db)(o),n=a.credentialsResult.matchCount?a.credentialsResult.items[0]:void 0,c=n?new N.Y(n.URL).getRootDomain():"";return{domain:n?c:void 0,type:n?U.y.Credential:U.y.SecureNote}}async removeItemToCollection(e,t){const r=await(0,f.z)(this.itemGroupsGetter.getForItemId(e));if((0,A.hx)(r)||!r.data)throw new Error("Item group to be removed from collection cannot be found");const s=await this.prepareAuditLogDetails(e);await this.sharingCollectionsGateway.removeItemGroupCollectionAccess({collectionId:t,itemGroupId:r.data.groupId,itemGroupRevision:r.data.revision,auditLogData:s})}async execute({body:e}){const{collectionIds:t,itemId:r}=e;for(const e of t)await this.removeItemToCollection(r,e);return await this.sharingSync.scheduleSync(),(0,A.Vp)(void 0)}constructor(e,t,r,s,i,o){this.sharingCollectionsGateway=e,this.itemGroupsGetter=t,this.sharingSync=r,this.currentSpaceGetter=s,this.featureFlips=i,this.vaultItemsCrudClient=o}}je=(0,s.__decorate)([(0,x.W)(xe.B),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g?Object:g,void 0===ge.E?Object:ge.E,void 0===W.D?Object:W.D,void 0===ke.n?Object:ke.n,void 0===be.P?Object:be.P,void 0===D.L?Object:D.L])],je);var Ve=r(46733);class We{async execute({body:e}){const{collectionId:t,newName:r}=e,s=await this.collectionsRepository.getCollection(t);if(!s)throw new Error("Failed to find collection revision");return await this.sharingCollections.renameCollection(s,r),await this.sharingSync.scheduleSync(),(0,A.Vp)(void 0)}constructor(e,t,r){this.sharingCollections=e,this.collectionsRepository=t,this.sharingSync=r}}We=(0,s.__decorate)([(0,x.W)(Ve.r),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===E?Object:E,void 0===V.G?Object:V.G,void 0===W.D?Object:W.D])],We);var Be=r(88621);class ze{async execute({body:e}){const{collectionId:t,userGroupIds:r,userLogins:s}=e,i=await this.collectionsRepository.getCollection(t);if(!i)throw new Error("Cannot access the requested collection.");const{revision:o}=i,a=await this.sharingCollectionsGateway.revokeCollectionMembers({collectionId:t,revision:o,userGroupIds:r,userLogins:s}),n=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==a.uuid));return await this.collectionsRepository.updateCollections([...n,a]),(0,A.Vp)(void 0)}constructor(e,t){this.collectionsRepository=e,this.sharingCollectionsGateway=t}}ze=(0,s.__decorate)([(0,x.W)(Be.q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===V.G?Object:V.G,void 0===g?Object:g])],ze);var He=r(76001);class Ye{async execute({body:e}){return await this.collectionsRepository.updateCollections(e.collections),(0,A.Vp)(void 0)}constructor(e){this.collectionsRepository=e}}Ye=(0,s.__decorate)([(0,x.W)(He.M),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===V.G?Object:V.G])],Ye);var Qe=r(91132);class qe{async execute(){const e=await(0,f.z)(this.currentSpaceGetter.get());if((0,A.hx)(e))throw new Error("Error fetching current space when moving shared collection items to business space");const t=(0,A.db)(e).teamId;if(!t)return(0,A.Vp)(void 0);const r=await(0,f.z)(this.itemGroupsGetter.get());if((0,A.hx)(r))throw new Error("Error fetching shared collection items to move to business space");const s=(0,A.db)(r).reduce(((e,t)=>t.collections?.some((e=>e.status===I.qb.Accepted))&&t.items?.[0].itemId?[...e,t.items[0].itemId]:e),[]);if(s.length){if((await Promise.all(s.map((e=>this.moveItemToBusinessSpace(e,t))))).some(A.hx))throw new Error("Error when moving shared collection items to business space")}return(0,A.Vp)(void 0)}async moveItemToBusinessSpace(e,t){const{commands:r}=this.vaultItemsCrudClient,s=await(0,f.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[P.U.Credential,P.U.SecureNote],ids:[e]}));if((0,A.hx)(s))return Promise.resolve((0,A.Rn)(void 0));const i=(0,A.db)(s).credentialsResult,o=(0,A.db)(s).secureNotesResult,a=i.matchCount>0,n=o.matchCount>0;if(!a&&!n)return Promise.resolve((0,A.Vp)(void 0));return(a?i.items[0]:o.items[0]).spaceId===t?Promise.resolve((0,A.Vp)(void 0)):r.updateVaultItem({vaultItemType:a?P.U.Credential:P.U.SecureNote,id:e,content:{spaceId:t},shouldSkipSync:!0})}constructor(e,t,r){this.itemGroupsGetter=e,this.vaultItemsCrudClient=t,this.currentSpaceGetter=r}}qe=(0,s.__decorate)([(0,x.W)(Qe.g),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E,void 0===D.L?Object:D.L,void 0===ke.n?Object:ke.n])],qe);var $e=r(13312);class Xe{isCollectionsSharingEnabled(e){return e.isSharingEnabled&&e.isCollectionsSharingEnabled}execute({body:e}){const{collectionId:t,userId:r}=e,{queries:{queryCollections:s}}=this.vaultOrganization,{userFeatureFlip:i}=this.featureFlips.queries,o=i({featureFlip:"sharingVault_web_Share_Collections_with_limited_Rights_Items_dev"});return s({ids:[t]}).pipe((0,ie.V)(this.currentSpace.get()),(0,Oe.w)((([e,s])=>{if((0,A.hx)(e))throw new Error("Error accessing private collections");if((0,A.hx)(s))throw new Error("Error accessing current space info");const i=this.isCollectionsSharingEnabled((0,A.db)(s)),o=(0,A.db)(e).collections.find((({id:e})=>e===t));if(o){const e=o.vaultItems.map((({id:e})=>e));return(0,oe.of)({isCollectionsSharingEnabled:i,itemIds:e,role:J.Yt.Manager,isPrivateCollection:!0})}return this.sharingAccess.getUserRoleInCollection$(t,r).pipe((0,ie.V)(this.itemGroupsGetter.getForCollectionId(t)),(0,z.U)((([e,t])=>{if((0,A.hx)(t))throw new Error("Failed to retrieve item groups for shared collection permissions query");return{itemIds:(0,A.db)(t).map((e=>e.items?.[0]?.itemId)),role:e,isCollectionsSharingEnabled:i,isPrivateCollection:!1}})))})),(0,Oe.w)((({itemIds:e,role:t,isCollectionsSharingEnabled:r,isPrivateCollection:s})=>{const i=t===J.Yt.Manager;return o.pipe((0,Oe.w)((o=>{let a;return a=!(0,A.hx)(o)&&Boolean((0,A.db)(o)),r&&i?this.sharingAccess.canShareItems(e).pipe((0,z.U)((e=>{if((0,A.hx)(e))throw new Error("Error checking if user can share a collection");return(0,A.db)(e)?(0,A.Vp)({canShare:i,canEditRoles:i,canEdit:i,canDelete:i,role:t,sharingDisabledReason:s?J.Hz.LimitedRightItems:void 0}):(0,A.Vp)({canShare:!s&&a,canEditRoles:i,canEdit:i,canDelete:i,role:t,sharingDisabledReason:J.Hz.LimitedRightItems})}))):(0,oe.of)((0,A.Vp)({canShare:!1,canEditRoles:i,canEdit:i,canDelete:i,role:t,sharingDisabledReason:r?J.Hz.EditorRole:J.Hz.DisabledInTAC}))})))})))}constructor(e,t,r,s,i){this.sharingAccess=e,this.itemGroupsGetter=t,this.vaultOrganization=r,this.currentSpace=s,this.featureFlips=i}}Xe=(0,s.__decorate)([(0,le.e)($e.y),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===de?Object:de,void 0===ge.E?Object:ge.E,void 0===Re.C?Object:Re.C,void 0===ke.n?Object:ke.n,void 0===be.P?Object:be.P])],Xe);var Ze=r(41869);class Je{execute({body:e}){const{collectionId:t,groupId:r}=e;return this.sharingAccess.getGroupRoleInCollection$(t,r).pipe((0,z.U)((e=>(0,A.Vp)(e))))}constructor(e){this.sharingAccess=e}}Je=(0,s.__decorate)([(0,le.e)(Ze.L),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===de?Object:de])],Je);var et=r(10829);class tt{execute({body:e}){const{targetId:t}=e;return this.userGroupGetter.getCarbonUserGroups$().pipe((0,ie.V)(this.collectionsRepository.collections$()),(0,z.U)((([e,r])=>{const s=r.filter((r=>{const s=r.users?.some((e=>e.login===t));if(s)return!0;const i=r.userGroups,o=i?.some((e=>e.uuid===t));if(o)return!0;const a=e.filter((e=>e.users.some((e=>e.userId===t)))),n=i?.some((e=>a.some((t=>t.groupId===e.uuid))));return n}));return(0,A.Vp)({collections:s})})))}constructor(e,t){this.collectionsRepository=e,this.userGroupGetter=t}}tt=(0,s.__decorate)([(0,le.e)(et.Q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===V.G?Object:V.G,void 0===ce.B?Object:ce.B])],tt);var rt=r(7134),st=r(13575);const it=e=>{if(!e.items||1!==e.items.length)throw new Error("Corrupted item group");return{id:e.items[0].itemId,type:P.U.Credential}},ot=(e,t,r)=>{const s=((e,t,r)=>({name:e.name,id:e.uuid,spaceId:r,isShared:!0,vaultItems:t.filter((t=>t.collections?.some((t=>t.uuid===e.uuid)))).map(it)}))(e,t,r);if(st.JQ.safeParse(s).success)return s;throw new Error("Failure to convert shared collection")};class at{execute({body:e}){const{itemIds:t}=e;return this.collectionsRepository.collections$().pipe((0,ie.V)(this.currentSpaceGetter.get(),this.itemGroupsGetter.get()),(0,z.U)((([e,r,s])=>{if((0,A.hx)(r)||(0,A.hx)(s))throw new Error("Unable to access sharing data");const i=e.map((e=>ot(e,s.data,r.data.teamId))).flatMap((e=>e.vaultItems)),o=t.filter((e=>i.some((t=>t.id===e))));return(0,A.Vp)(o)})))}constructor(e,t,r){this.currentSpaceGetter=e,this.itemGroupsGetter=t,this.collectionsRepository=r}}at=(0,s.__decorate)([(0,le.e)(rt.q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===ke.n?Object:ke.n,void 0===ge.E?Object:ge.E,void 0===V.G?Object:V.G])],at);var nt=r(34282);class ct{execute({body:e}){const t=e.collectionIds?e.collectionIds:[];return this.collectionsRepository.collections$().pipe((0,z.U)((e=>(0,A.Vp)(e.filter((e=>!t.length||t.includes(e.uuid)))))))}constructor(e){this.collectionsRepository=e}}ct=(0,s.__decorate)([(0,le.e)(nt.$),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===V.G?Object:V.G])],ct);class dt{execute(){return this.collectionsRepository.collections$().pipe((0,ie.V)(this.currentSpaceGetter.get(),this.itemGroupsGetter.get()),(0,z.U)((([e,t,r])=>{if((0,A.hx)(t)||(0,A.hx)(r))throw new Error("Failed to load shared collections");return(0,A.Vp)(e.map((e=>ot(e,r.data,t.data.teamId))))})))}constructor(e,t,r){this.collectionsRepository=e,this.currentSpaceGetter=t,this.itemGroupsGetter=r}}dt=(0,s.__decorate)([(0,le.e)(st.MO),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===V.G?Object:V.G,void 0===ke.n?Object:ke.n,void 0===ge.E?Object:ge.E])],dt);var lt=r(54665);class ut{execute({body:e}){const{collectionIds:t}=e;return this.collectionsRepository.collections$().pipe((0,z.U)((e=>{const r=e.filter((e=>t.includes(e.uuid))),s=r.flatMap((e=>e.users?e.users:[])).map((e=>({id:e.login,label:e.login,status:e.status,permission:e.permission}))),i=r.flatMap((e=>e.userGroups?e.userGroups:[])).map((e=>({id:e.uuid,label:e.name,status:e.status,permission:e.permission})));return(0,A.Vp)({userGroups:i,users:s})})))}constructor(e){this.collectionsRepository=e}}ut=(0,s.__decorate)([(0,le.e)(lt.O),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===V.G?Object:V.G])],ut);var pt=r(13186),mt=r(75028),ht=r(14139);class gt{}gt=(0,s.__decorate)([(0,i.Yl)({api:o.a,stores:[Ee,m],providers:[E,M,de,K,H,Ae,{provide:g,useClass:X},{provide:V.G,useClass:Te},{provide:Ce.U,useClass:we}],exports:[V.G,Ce.U],handlers:{commands:{addItemsToCollections:B,createSharedCollection:Fe,deleteSharedCollection:Le,inviteCollectionMembers:Ke,updateCollectionMembers:se,removeItemFromCollections:je,renameCollection:We,revokeCollectionMembers:ze,updateSharedCollections:Ye,updatePermissionForCollectionItem:ve,moveCollectionItemsToBusinessSpace:qe},events:{},queries:{getCollectionPermissionsForUser:Xe,getCollectionRoleForGroup:Je,getCollectionsForUserOrGroup:tt,getItemIdsInSharedCollections:at,getSharedCollectionsCount:pe,getSharedCollections:ct,sharedCollectionsWithItems:dt,usersAndGroupsInCollection:ut}},imports:[a.n,n.D,mt.k,pt.I,ht.y],requiredFeatureFlips:["sharing_web_invalidSignatureAutoRevoke_prod","monetization_extension_starterRepackagingCollection","sharingVault_web_shareItemsGrapheneMigration_dev","sharingVault_web_sharingSyncGrapheneMigration_dev"]})],gt)},11819:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(92467);const i=e=>{switch(e){case s.y.Credential:return"AUTHENTIFIANT";case s.y.Secret:return"SECRET";default:return"SECURENOTE"}},o=({domain:e,type:t})=>({captureLog:!0,domain:e,type:i(t)})},13186:(e,t,r)=>{r.d(t,{I:()=>I});var s=r(88802),i=r(99634),o=r(60399),a=r(57924),n=r(87113),c=r(48844),d=r(87279);const l=/[<>]/g;var u=r(98798);function p(e,t){const r=(0,u.B)(e);return{type:r,name:t||`Untitled ${r}`}}const m=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:o,permission:a})=>({userId:e,groupKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:o,permission:a})));var h=r(27790);class g{async getPublicKeysForUsers(e){const t=await(0,o.z)(this.serverApiClient.v1.sharingUserdevice.getUsersPublicKey({logins:e}).pipe((0,c.DZ)((()=>{throw new Error("Cannot get public keys of requested users.")})),(0,c.lk)((e=>(0,d.Vp)(e.data)))));if((0,d.hx)(t))throw new Error("Cannot get public keys of requested users.");return t.data.data.map((e=>{return{login:e.login??(t=e.email,t.trim().toLowerCase().replace(l,"")),publicKey:e.publicKey};var t}))}async createItemGroup({users:e,item:t,itemTitle:r,groupId:s}){const i=await(0,o.z)(this.serverApiClient.v1.sharingUserdevice.createItemGroup({groupId:s,items:[t],users:m(e),itemsForEmailing:[p(t.itemType,r)]}));if((0,d.hx)(i))throw new Error("Failed to create item group");const a=(0,d.db)(i).data.itemGroups?.find((e=>e.groupId===s));if(!a)throw new Error("Error creating item group");return a}async createMultipleItemGroups(e){const t=e.map((({users:e,item:t,itemTitle:r,groupId:s})=>({groupId:s,items:[t],users:m(e),itemsForEmailing:[p(t.itemType,r)]}))),r=await(0,o.z)(this.serverApiClient.v1.sharingUserdevice.createMultipleItemGroups({itemgroups:t}));if((0,d.hx)(r))throw new Error("Failed to create multiple item groups");const s=(0,d.db)(r).data;if(s.itemGroupErrors?.length)throw new Error("Failed to create some of multiple item groups");if(!s.itemGroups?.length)throw new Error("No item groups have been created");return s.itemGroups}async updateItemGroupMembers(e){const{groupId:t,revision:r,users:s,groups:i,collections:a}=e,n=await(0,o.z)(this.serverApiClient.v1.sharingUserdevice.updateItemGroupMembers({groupId:t,revision:r,collections:a,groups:i,users:s}));if((0,d.hx)(n)){if("BusinessError"===n.error.tag&&n.error.code===h.wI)return(0,d.Rn)((0,h.ge)());throw new Error("Updating members of item groups have failed")}const c=(0,d.db)(n).data;return(0,d.Vp)(c.itemGroups)}async revokeItemGroupMembers(e){const{itemGroupId:t,revision:r,userLogins:s,collectionIds:i,userGroupIds:a}=e,n=await(0,o.z)(this.serverApiClient.v1.sharingUserdevice.revokeItemGroupMembers({groupId:t,revision:r,collections:i,users:s,groups:a}));if((0,d.hx)(n)){if("BusinessError"===n.error.tag&&n.error.code===h.wI)return(0,d.Rn)((0,h.ge)());throw new Error("Revoking members of item groups have failed")}const c=(0,d.db)(n).data;return(0,d.Vp)(c.itemGroups)}async refuseItemGroup(e){const{itemGroupId:t,revision:r}=e,s=await(0,o.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:t,revision:r}));if((0,d.hx)(s))throw new Error("Refusing item group have failed");const i=(0,d.db)(s).data;if(!i.itemGroups?.length)throw new Error("No members of item groups have been revoked");if(i.itemGroupErrors?.length)throw new Error("Revoking of some members of item groups failed");return i.itemGroups}constructor(e){this.serverApiClient=e}}g=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n.l?Object:n.l])],g);var v=r(40217),_=r(80629),y=r(85337),S=r(6554),E=r(93850),f=r(75028),A=r(14139);class I{}I=(0,s.__decorate)([(0,i.Yl)({sharedModuleName:"sharing-common",providers:[v.k,_.D,y.o,S.E,{provide:h.b_,useClass:g}],exports:[v.k,_.D,y.o,S.E,h.b_],imports:[f.k,E.n,A.y]})],I)},40217:(e,t,r)=>{r.d(t,{k:()=>p});var s=r(88802),i=r(57924),o=r(10370),a=r(13252),n=r(50436),c=r(68173),d=r(6554),l=r(27790),u=r(98798);class p{async prepareCreateItemGroupModel(e){const t=(0,n.R)(),r=await this.sharingCrypto.createResourceKey(),s=await this.sharingUsers.createSignedUserInvites([],{resourceKey:r,uuid:t}),i=await this.sharingCrypto.createResourceKey(),a=await this.sharingCrypto.encryptSecureData(r,i),c=await this.sharingCrypto.encryptSharingItem(i,e);return{groupId:t,item:{itemId:e.Id,itemType:(0,u.l)(e),itemKey:(0,o.s)(a),content:(0,o.s)(c)},itemTitle:e.Title,users:s}}convertToSharedItem(e){const t=e.items?.[0];if(!t)throw new Error("Newly created item group is missing an item");const r=e.users?.[0];if(!r)throw new Error("Newly created item group is missing an admin");const{itemKey:s,itemId:i}=t;if(!r.groupKey)throw new Error("Newly created item group is missing a resource key");return{isLastAdmin:!0,sharedItemId:e.groupId,itemKey:s,itemId:i,accessLink:{accessType:a.Uv.User,encryptedResourceKey:r.groupKey,permission:a.y3.Admin},permission:a.y3.Admin,recipientIds:{userIds:[r.userId],collectionIds:null,userGroupIds:null},revision:e.revision}}async createItemGroup(e){const t=await this.prepareCreateItemGroupModel(e);return this.sharingApi.createItemGroup(t)}async createMultipleItemGroups(e){const t=await Promise.all(e.map((e=>this.prepareCreateItemGroupModel(e))));return(await this.sharingApi.createMultipleItemGroups(t)).map(this.convertToSharedItem)}constructor(e,t,r){this.sharingApi=e,this.sharingCrypto=t,this.sharingUsers=r}}p=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.b_?Object:l.b_,void 0===c.O?Object:c.O,void 0===d.E?Object:d.E])],p)},80629:(e,t,r)=>{r.d(t,{D:()=>u});var s=r(88802),i=r(87279),o=r(60399),a=r(41842),n=r(57924),c=r(90993),d=r(4174),l=r(21877);class u{async scheduleSync(){const{commands:e}=this.syncClient;return await this.waitOnSyncToFinish(),await e.sync({trigger:l.Trigger.Sharing}),(0,i.Vp)(void 0)}async runSync(){return await this.scheduleSync(),await this.waitOnSyncToFinish(),(0,i.Vp)(void 0)}waitOnSyncToFinish(){return(0,o.z)(this.syncClient.queries.syncProgress().pipe((0,a.h)(i.d6),(0,a.h)((e=>e.data.status!==c.L.IN_PROGRESS))))}constructor(e){this.syncClient=e}}u=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.Q?Object:d.Q])],u)},85337:(e,t,r)=>{r.d(t,{o:()=>u});var s=r(88802),i=r(28489),o=r(57924),a=r(13252),n=r(68173),c=r(74929),d=r(71996),l=r(35635);class u{async createSignedUserGroupInvites(e,t){return(await this.createSignedUserGroupInvitesPerResource(e,[t]))[t.uuid]}async createSignedUserGroupInvitesPerResource(e,t){const r=await this.getUserGroupsWithKeys(e),s=await Promise.all(t.map((async e=>{const t=await Promise.all(r.map((t=>this.createInvite(t,e))));return{resource:e,invites:t}}))),i={};return s.forEach((({resource:e,invites:t})=>{i[e.uuid]=t})),i}async getUserGroupsWithKeys(e){const t=await this.currentUserGetter.getCurrentUserWithKeys(),r=await this.userGroupsGetter.getForGroupIds(e.map((e=>e.groupId)));return Promise.all(r.map((async r=>{const s=e.find((e=>e.groupId===r.groupId))?.permission??a.y3.Limited,i=r.users.find((e=>e.userId===t.login)),o=i?.groupKey;if(!o)throw new Error("Unable to get user group key.");const n=await this.sharingCrypto.decryptResourceKeyToClearText(t.privateKey,r.privateKey,o);return{permission:s,groupId:r.groupId,publicKey:r.publicKey,clearUserGroupPrivateKey:n}})))}async createInvite(e,t){const{groupId:r,publicKey:s,clearUserGroupPrivateKey:o,permission:a}=e,{proposeSignature:n,acceptSignature:c,resourceKey:d}=await this.sharingInvitesCrypto.createSignedInvite(r,t,s,o);if(!d)throw new Error("Could not create resource key when generating user group invite for shared item");return(0,i.Ay)({permission:a,proposeSignature:n,acceptSignature:c,id:r,resourceKey:d})}constructor(e,t,r,s){this.userGroupsGetter=e,this.sharingCrypto=t,this.sharingInvitesCrypto=r,this.currentUserGetter=s}}u=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.B?Object:c.B,void 0===n.O?Object:n.O,void 0===d.h?Object:d.h,void 0===l.a?Object:l.a])],u)},6554:(e,t,r)=>{r.d(t,{E:()=>d});var s=r(88802),i=r(57924),o=r(13252),a=r(27790),n=r(71996),c=r(35635);class d{async createSignedUserInvites(e,t,r=!0){const s=e.length?await this.sharingGateway.getPublicKeysForUsers(e.map((e=>e.login))):[],i=await this.currentUserGetter.getCurrentUserWithKeys(),a=[...r?[{login:i.login,publicKey:i.publicKey,permission:o.y3.Admin}]:[],...s.map((t=>({...t,permission:e.find((e=>e.login===t.login))?.permission??o.y3.Limited})))];return Promise.all(a.map((e=>this.createInvite(e,t,i))))}async createSignedUserInvitesPerResource(e,t){const r=e.length?await this.sharingGateway.getPublicKeysForUsers(e.map((e=>e.login))):[],s=r.map((e=>e.login)),i=e.filter((e=>!s.includes(e.login))).map((({login:e})=>({login:e,publicKey:null}))),a=[...r,...i].map((t=>({...t,permission:e.find((e=>e.login===t.login))?.permission??o.y3.Limited}))),n=await Promise.all(t.map((async e=>{const t=await Promise.all(a.map((t=>this.createInvite(t,e))));return{resource:e,invites:t}}))),c={};return n.forEach((({resource:e,invites:t})=>{c[e.uuid]=t})),c}async createInvite(e,t,r){const s=r?.login===e.login;return{...await this.invitesCryptoService.createSignedInvite(e.login,t,e.publicKey,s?r.privateKey:void 0),id:e.login,alias:e.login,permission:s?o.y3.Admin:e.permission}}constructor(e,t,r){this.currentUserGetter=e,this.invitesCryptoService=t,this.sharingGateway=r}}d=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.a?Object:c.a,void 0===n.h?Object:n.h,void 0===a.b_?Object:a.b_])],d)},27790:(e,t,r)=>{r.d(t,{b_:()=>a,ge:()=>o,wI:()=>i});var s=r(96168);const i="INVALID_ITEM_GROUP_REVISION",o=(0,s.Vj)(i,"Invalid revision when trying to update item group member");class a{}},92467:(e,t,r)=>{var s;r.d(t,{y:()=>s}),function(e){e.Secret="secret",e.Credential="password",e.SecureNote="note"}(s||(s={}))},75028:(e,t,r)=>{r.d(t,{k:()=>l});var s=r(88802),i=r(99634),o=r(68173),a=r(44801),n=r(71996),c=r(37935),d=r(14139);class l{}l=(0,s.__decorate)([(0,i.Yl)({sharedModuleName:"sharing-crypto",providers:[o.O,a.c,n.h],exports:[o.O,a.c,n.h],imports:[d.y,c.D]})],l)},68173:(e,t,r)=>{r.d(t,{O:()=>T});var s=r(88802),i=r(57924),o=r(31222),a=r(92258),n=r(40173),c=r(72580),d=r(83919),l=r(12554),u=r(77970),p=r(28008),m=r(47415),h=r(10370),g=r(54066),v=r(86286),_=r(9034),y=r(83168),S=r(4761),E=r(7502),f=r(89685),A=r(86252),I=r(43293),O=r(21131);var b=r(87279);class T{async createResourceKey(){return await this.keyGeneratorAes256.generate()}async encryptSecureData(e,t){return await this.kwc5Encryptor.encrypt(e,t)}async decryptSecureData(e,t){return await this.kwc5Decryptor.decrypt(e,t)}async createProposeSignature(e,t){const r=await this.hmacSigner.sign(e,t);return(0,h.s)(r)}async createRecipientKeyPair(e){const{publicKey:t,privateKey:r}=await this.rsaKeyPairGenerator.generate(),s=(0,g.u)((0,v.R)(r)),i=await this.encryptSecureData(e,s);return{publicKey:(0,_.y)(t),privateKey:(0,h.s)(i)}}async createAcceptSignature(e,t,r){const s=`${t}-accepted-${(0,h.s)(r)}`,i=(0,g.u)(s),o=await this.rsaSigner.sign((0,y.B)(e),i);return(0,h.s)(o)}async verifyAcceptSignature(e,t,r,s){const i=`${r}-accepted-${(0,h.s)(s)}`,o=(0,g.u)(i);return await this.rsaVerifier.verify((0,S.M)(e),(0,E.R)(t),o)}async encryptResourceKey(e,t){return await this.rsaEncryptor.encrypt(e,t)}async decryptResourceKey(e,t){return await this.rsaDecryptor.decrypt(e,t)}async decryptResourceKeyString(e,t){return await this.decryptResourceKey((0,y.B)(e),(0,E.R)(t))}async decryptResourceKeyToClearText(e,t,r){const s=await this.decryptResourceKey((0,y.B)(e),(0,E.R)(r)),i=await this.decryptSecureData(s,(0,E.R)(t));return(0,f.v)(i)}async encryptSharingItem(e,t){const{commands:{carbon:r}}=this.client,s=await r({name:"convertItemToDashlaneXml",args:[{item:t}]}),i=(o=s,(0,b.hx)(o)||"string"!=typeof o.data.carbonResult.xml?null:o.data.carbonResult.xml);var o;if(""===i||null===i)throw new Error("Unable to convert item to XML");const a=(e=>{const t=(0,I.N)(e),r=(0,g.u)(t);return(0,O.n)(r)})(i);return await this.encryptSecureData(e,a)}async decryptEncapsulatedPrivateKey(e,t,r){const s=await this.decryptResourceKey(e,(0,E.R)(t)),i=await this.decryptSecureData(s,(0,E.R)(r));return(0,y.B)((0,f.v)(i))}constructor(e,t,r,s,i,o,a,n,c,d){this.client=e,this.hmacSigner=t,this.keyGeneratorAes256=r,this.rsaKeyPairGenerator=s,this.kwc5Decryptor=i,this.kwc5Encryptor=o,this.rsaDecryptor=a,this.rsaEncryptor=n,this.rsaSigner=c,this.rsaVerifier=d}}T=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===A._?Object:A._,void 0===o.q?Object:o.q,void 0===a.c?Object:a.c,void 0===n.e?Object:n.e,void 0===c.$?Object:c.$,void 0===d.o?Object:d.o,void 0===l.g?Object:l.g,void 0===u.H?Object:u.H,void 0===p.k?Object:p.k,void 0===m.u?Object:m.u])],T)},44801:(e,t,r)=>{r.d(t,{c:()=>m});var s=r(88802),i=r(57924),o=r(63877),a=r(83168),n=r(7502),c=r(13252),d=r(68173),l=r(32336),u=r(35635),p=r(74929);class m{async decryptItemGroupKey(e){const t=await this.currentUserGetter.getCurrentUserWithKeys(),{accessLink:r}=e;return r?.accessType===c.Uv.User?this.decryptResourceKeyViaUserMember(r,t):r?.accessType===c.Uv.UserGroup?this.decryptViaGroupMember(r,t):r?.accessType===c.Uv.CollectionUser?this.decryptViaCollectionUserMember(r,t):r?.accessType===c.Uv.CollectionUserGroup?this.decryptViaCollectionUserGroupMember(r,t):null}async decryptSharedCollectionKey(e,t){const{accessLink:r}=e;return r?.accessType===l.oP.User?this.decryptResourceKeyViaUserMember(r,t):r?.accessType===l.oP.UserGroup?this.decryptViaGroupMember(r,t):void 0}async decryptResourceKeyViaUserMember(e,t){try{return await this.sharingCrypto.decryptResourceKey((0,a.B)(t.privateKey),(0,n.R)(e.encryptedResourceKey))}catch{return null}}async decryptUserGroupKey(e,t){return this.sharingCrypto.decryptResourceKey((0,a.B)(e.privateKey),(0,n.R)(t))}async decryptViaGroupMember(e,t){const{encryptedResourceKey:r,groupEncryptedKey:s,groupPrivateKey:i}=e;if(!s||!i)return null;try{const e=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),s,i);return await this.sharingCrypto.decryptResourceKey(e,(0,n.R)(r))}catch(e){return null}}async decryptViaCollectionUserMember(e,t){const{encryptedResourceKey:r,collectionEncryptedKey:s,collectionPrivateKey:i}=e;if(!s||!i)return null;const o=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),s,i);return await this.sharingCrypto.decryptResourceKey(o,(0,n.R)(r))}async decryptViaCollectionUserGroupMember(e,t){const{encryptedResourceKey:r,collectionEncryptedKey:s,collectionPrivateKey:i,groupEncryptedKey:o,groupPrivateKey:c}=e;if(!(s&&i&&o&&c))return null;const d=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),o,c),l=await this.sharingCrypto.decryptEncapsulatedPrivateKey(d,s,i);return await this.sharingCrypto.decryptResourceKey(l,(0,n.R)(r))}async decryptCollectionKey(e,t=o.qb.Accepted){const r=await this.currentUserGetter.getCurrentUserWithKeys(),s=e.users?.find((e=>e.login===r.login&&e.status===t&&e.collectionKey));if(s?.collectionKey)return await this.decryptCollectionKeyViaUserMember(s,r);const i=(await this.userGroupsGetter.getCarbonUserGroups()).filter((e=>e.users.some((e=>e.userId===r.login&&e.status===t&&!e.proposeSignatureUsingAlias&&e.groupKey)))),a=e.userGroups?.find((e=>i.some((t=>t.groupId===e.uuid))&&e.status===t&&e.collectionKey));return a?.collectionKey?await this.decryptCollectionKeyViaGroupMember(a,r,i):null}async decryptCollectionKeyViaUserMember(e,t){if(!e.collectionKey)return null;try{return await this.sharingCrypto.decryptResourceKey((0,a.B)(t.privateKey),(0,n.R)(e.collectionKey))}catch{return null}}async decryptCollectionKeyViaGroupMember(e,t,r){if(!e.collectionKey)return null;try{const s=r.find((({groupId:t})=>t===e.uuid)),i=s?.users.find((({userId:e})=>e===t.login));if(!i?.groupKey||!s)return null;const o=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,a.B)(t.privateKey),i.groupKey,s.privateKey);return await this.sharingCrypto.decryptResourceKey(o,(0,n.R)(e.collectionKey))}catch{return null}}constructor(e,t,r){this.sharingCrypto=e,this.currentUserGetter=t,this.userGroupsGetter=r}}m=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===d.O?Object:d.O,void 0===u.a?Object:u.a,void 0===p.B?Object:p.B])],m)},71996:(e,t,r)=>{r.d(t,{h:()=>d});var s=r(88802),i=r(57924),o=r(4761),a=r(10370),n=r(54066),c=r(68173);class d{async createSignedInvite(e,t,r,s){const i=r?await this.sharingCrypto.encryptResourceKey((0,o.M)(r),t.resourceKey):void 0,c=i?(0,a.s)(i):void 0,d=(0,n.u)(e);return{proposeSignature:await this.sharingCrypto.createProposeSignature(t.resourceKey,d),acceptSignature:s?await this.sharingCrypto.createAcceptSignature(s,t.uuid,t.resourceKey):void 0,resourceKey:c,proposeSignatureUsingAlias:!r}}constructor(e){this.sharingCrypto=e}}d=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===c.O?Object:c.O])],d)},82181:(e,t,r)=>{r.d(t,{o:()=>s});const s=e=>{if(!e)return!1;const t=e;return!!t.pendingItemGroups&&!!t.pendingUserGroups}},71737:(e,t,r)=>{r.d(t,{p:()=>he});var s=r(88802),i=r(99634),o=r(95940),a=r(93850),n=r(37935),c=r(7165),d=r(95681),l=r(23347),u=r(25029),p=r(11797);const m=c.z.object({pendingCollections:c.z.array(p.MX)}),h=e=>m.safeParse(e).success;class g extends((0,d.Q)({capacity:l.Y._010KB,persist:!1,scope:u.F.User,storeName:"pending-shared-collections-state",storeTypeGuard:h,initialValue:{pendingCollections:[]}})){}var v=r(63663),_=r(87113),y=r(87279),S=r(27122),E=r(60399),f=r(63877),A=r(44801),I=r(35635),O=r(68173),b=r(80629),T=r(74929);class C{async execute({body:e}){const{userGroupId:t}=e,r=await this.userGroupGetter.getForGroupIds([t]);if(!r.length)throw new Error(`Failed to retrieve user group for pending user group invite with id ${t}`);const s=await this.currentUserGetter.getCurrentUserWithKeys(),i=r[0].users.find((e=>e.userId===s.login)),o=i?.groupKey;if(!o)throw new Error("Unable to get user group key");const a=await this.sharingDecryption.decryptUserGroupKey(s,o),n=await this.sharingCrypto.createAcceptSignature(s.privateKey,t,a);return await(0,E.z)(this.serverApiClient.v1.sharingUserdevice.acceptUserGroup({acceptSignature:n,groupId:t,provisioningMethod:f.ET.USER,revision:r[0].revision})),await this.sharingSync.scheduleSync(),(0,y.Vp)(void 0)}constructor(e,t,r,s,i,o){this.serverApiClient=e,this.sharingDecryption=t,this.currentUserGetter=r,this.sharingCrypto=s,this.sharingSync=i,this.userGroupGetter=o}}C=(0,s.__decorate)([(0,v.W)(S.Q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===A.c?Object:A.c,void 0===I.a?Object:I.a,void 0===O.O?Object:O.O,void 0===b.D?Object:b.D,void 0===T.B?Object:T.B])],C);var w=r(64549);class R{async execute(e){const{body:{collectionId:t}}=e,r=(await this.pendingCollectionsStore.getState()).pendingCollections.find((({uuid:e})=>e===t));if(!r)throw new Error("Pending Collection not found");const s=await this.sharingDecryption.decryptCollectionKey(r,f.qb.Pending);if(!s)throw new Error("Unable to decrypt Collection Key for pending collection");const i=await this.currentUserGetter.getCurrentUserWithKeys(),o=await this.sharingCrypto.createAcceptSignature(i.privateKey,t,s),a=await(0,E.z)(this.serverApiClient.v1.sharingUserdevice.acceptCollection({collectionUUID:t,revision:r.revision,acceptSignature:o}));return(0,y.hx)(a)?(0,y.Rn)(new w.nu):(await this.sharingSync.scheduleSync(),(0,y.Vp)(void 0))}constructor(e,t,r,s,i,o){this.serverApiClient=e,this.sharingCrypto=t,this.sharingDecryption=r,this.pendingCollectionsStore=s,this.sharingSync=i,this.currentUserGetter=o}}R=(0,s.__decorate)([(0,v.W)(w.cD),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===O.O?Object:O.O,void 0===A.c?Object:A.c,void 0===g?Object:g,void 0===b.D?Object:b.D,void 0===I.a?Object:I.a])],R);var P=r(83405),D=r(44449),N=r(93986);class U{async execute({body:e}){const{itemGroupId:t}=e,r=await(0,E.z)(this.itemGroupsGetter.getForItemGroupId(t));if((0,y.hx)(r))throw new Error("Error fetching item groups when trying to accept shared item");const s=(0,y.db)(r);if(!s)throw new Error("Item group not found");const i=await this.currentUserGetter.getCurrentUserWithKeys(),o=s.users?.find((e=>e.userId===i.login));if(!o?.groupKey)throw new Error("Item group key not found");const a=await this.sharingDecryption.decryptResourceKeyViaUserMember({encryptedResourceKey:o.groupKey},i);if(!a)throw new Error("Failed to decrypt item group key");const n=await this.sharingCrypto.createAcceptSignature(i.privateKey,t,a);return await(0,E.z)(this.serverApiClient.v1.sharingUserdevice.acceptItemGroup({acceptSignature:n,groupId:t,revision:s.revision})),await this.sharingSync.scheduleSync(),(0,y.Vp)(void 0)}constructor(e,t,r,s,i,o,a){this.serverApiClient=e,this.inviteGetter=t,this.itemGroupsGetter=r,this.sharingDecryption=s,this.currentUserGetter=i,this.sharingCrypto=o,this.sharingSync=a}}U=(0,s.__decorate)([(0,v.W)(P.C),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===D.V?Object:D.V,void 0===N.E?Object:N.E,void 0===A.c?Object:A.c,void 0===I.a?Object:I.a,void 0===O.O?Object:O.O,void 0===b.D?Object:b.D])],U);var F=r(37210);class M{async execute(e){const{body:{collectionId:t}}=e,r=(await this.pendingCollectionsStore.getState()).pendingCollections.find((({uuid:e})=>e===t));if(!r)throw new Error("Pending Collection not found");const s=await(0,E.z)(this.serverApiClient.v1.sharingUserdevice.refuseCollection({collectionUUID:t,revision:r.revision}));return(0,y.hx)(s)?(0,y.Rn)(new F.R$):(0,y.Vp)(void 0)}constructor(e,t){this.serverApiClient=e,this.pendingCollectionsStore=t}}M=(0,s.__decorate)([(0,v.W)(F.UC),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===g?Object:g])],M);var L=r(82567),G=r(86252),K=r(21242),x=r(48844),k=r(51571),j=r(57789),V=r(64718),W=r(98798);const B=e=>{const t=(0,W.l)(e);return{type:(0,W.B)(t),name:e.Title}};class z{async execute(e){const{body:{itemGroupId:t}}=e,r=await(0,E.z)(this.itemGroupsGetter.getForItemGroupId(t));if((0,y.hx)(r))throw new Error("Failed to retrieve item group for pending item group with");const s=(0,y.db)(r);if(void 0===s)return(0,y.Rn)(new k.fL);const i=await this.getItemContent(t),o=await this.prepareAuditLogDetails(i);return(0,E.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:s.groupId,revision:s.revision,itemsForEmailing:[B(i)],auditLogDetails:o}).pipe((0,x.DZ)((e=>{if("BusinessError"===e.tag)return(0,k.fr)(e.code);throw new Error(e.message)})),(0,x.lk)((e=>{if(void 0===e.data.itemGroupErrors||0===e.data.itemGroupErrors.length)return(0,y.Vp)(void 0);if(e.data.itemGroupErrors.length>0)throw new Error("Error when refusing an item group invite");throw new Error("Unknown server error")})),(0,L.b)((async e=>{(0,y.d6)(e)&&await this.sharingSync.scheduleSync()}))))}async getItemContent(e){const t=this.inviteGetter.get().pipe((0,x.Qn)((t=>{const r=t.pendingItemGroups.find((t=>t.itemGroupId===e));if(!r)throw new Error("Pending item group not found when refusing invite");if(r.items.length<1)throw new Error("Missing item content for pending item group when refusing invite");return r.items[0]}))),r=await(0,E.z)(t);if((0,y.hx)(r))throw new Error("Failed to retrieve item content for pending item group when refusing invite");return r.data}async prepareAuditLogDetails(e){const{queries:{carbonState:t}}=this.carbonLegacyClient,r=t({path:"userSession.localSettings.premiumStatus"}).pipe((0,x.Qn)((e=>(e=>(e.spaces??[]).filter((e=>"accepted"===e.status)))(e)[0]))),{userFeatureFlips:s}=this.featureFlips.queries,i=await(0,E.z)(s().pipe((0,x.Qn)((e=>e.audit_logs_sharing&&e.send_activity_log))));if(!(!!(0,y.d6)(i)&&(i.data??!1)))return;const o=await(0,E.z)(r);if((0,y.hx)(o))return;const a=(0,y.db)(o)?.info.collectSensitiveDataAuditLogsEnabled;return a?((e,t)=>{const r=!!t?.SpaceId&&e,s=t&&(0,j.G)(t),i=s?new V.Y(t.Url).getRootDomain():"",o=s?i||"":void 0,a=(0,W.l)(t);return r?{captureLog:r,domain:o,type:a}:void 0})(a,e):void 0}constructor(e,t,r,s,i,o){this.carbonLegacyClient=e,this.serverApiClient=t,this.inviteGetter=r,this.itemGroupsGetter=s,this.featureFlips=i,this.sharingSync=o}}z=(0,s.__decorate)([(0,v.W)(k.gm),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G._?Object:G._,void 0===_.l?Object:_.l,void 0===D.V?Object:D.V,void 0===N.E?Object:N.E,void 0===K.P?Object:K.P,void 0===b.D?Object:b.D])],z);var H=r(11050);class Y{async execute(e){const{body:{userGroupId:t}}=e,r=await this.userGroupGetter.getForGroupIds([t]);if(0===r.length)throw new Error(`Failed to retrieve user group for pending user group with id ${t}`);const{groupId:s,revision:i}=r[0];return await(0,E.z)(this.serverApiClient.v1.sharingUserdevice.refuseUserGroup({groupId:s,revision:i,provisioningMethod:f.ET.USER}).pipe((0,x.DZ)((e=>{if("BusinessError"===e.tag)return(0,H.cz)(e.code);throw new Error(e.message)})),(0,x.lk)((e=>{if(void 0===e.data.userGroupErrors||0===e.data.userGroupErrors.length)return(0,y.Vp)(void 0);if(e.data.userGroupErrors.length>0)throw new Error(`Error for user group ${e.data.userGroupErrors[0].groupId}: ${e.data.userGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,L.b)((async e=>{(0,y.d6)(e)&&await this.sharingSync.scheduleSync()}))))}constructor(e,t,r){this.serverApiClient=e,this.userGroupGetter=t,this.sharingSync=r}}Y=(0,s.__decorate)([(0,v.W)(H.Fo),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===_.l?Object:_.l,void 0===T.B?Object:T.B,void 0===b.D?Object:b.D])],Y);var Q=r(21869),q=r(13252),$=r(97675);class X{execute({body:e}){const t=e,r=this.getCurrentUserLogin(),s=t.filter((e=>(e.users||[]).some((e=>e.login===r&&e.status===q.qb.Pending))));return this.store.set({pendingCollections:s}),Promise.resolve((0,y.Vp)(void 0))}getCurrentUserLogin(){return this.context.get(Q.l.UserName)}constructor(e,t){this.store=e,this.context=t}}X=(0,s.__decorate)([(0,v.W)($.r),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g?Object:g,void 0===Q.f?Object:Q.f])],X);var Z=r(85390),J=r(87065),ee=r(20754),te=r(57885);const re=e=>void 0!==e.referrer&&void 0!==e.permission,se=(e,t)=>e.map((e=>{const r=(e.users||[]).find((e=>e.login===t&&e.status===q.qb.Pending));return{uuid:e.uuid,name:e.name,referrer:r?.referrer,permission:r?.permission}})).filter(re);class ie{execute(){const e=this.inviteGetter.get(),t=this.store.state$,r=this.getCurrentUserLogin();return(0,Z.a)([e,t]).pipe((0,J.U)((([e,t])=>{const s=(0,y.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},i=r?se(t.pendingCollections,r):[];return(0,y.Vp)({pendingItemGroups:s.pendingItemGroups,pendingUserGroups:s.pendingUserGroups,pendingCollections:i})})))}getCurrentUserLogin(){return this.context.get(Q.l.UserName)}constructor(e,t,r){this.inviteGetter=e,this.store=t,this.context=r}}ie=(0,s.__decorate)([(0,ee.e)(te.q),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===D.V?Object:D.V,void 0===g?Object:g,void 0===Q.f?Object:Q.f])],ie);var oe=r(5650);class ae{execute(){const e=this.getCurrentUserLogin();if(void 0===e)throw new Error("Unable to get pending collections, user login not found");return this.store.state$.pipe((0,J.U)((t=>{const r=se(t.pendingCollections,e);return(0,y.Vp)(r)})))}getCurrentUserLogin(){return this.context.get(Q.l.UserName)}constructor(e,t){this.store=e,this.context=t}}ae=(0,s.__decorate)([(0,ee.e)(oe.D),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===g?Object:g,void 0===Q.f?Object:Q.f])],ae);var ne=r(6136),ce=r(71763),de=r(82181);class le{execute(){const{queries:{carbonState:e}}=this.carbonLegacyClient,t=e({path:"userSession.sharingSync"}).pipe((0,x.Qn)((e=>{if(!(0,de.o)(e))throw new Error("Bad SharingSync format");return e}))),r=this.store.state$;return(0,Z.a)([t,r]).pipe((0,J.U)((([e,t])=>{const r=(0,y.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},s=r.pendingItemGroups.length>0,i=r.pendingUserGroups.length>0,o=t.pendingCollections.length>0;return s||i||o})),(0,ne.x)(),(0,J.U)(y.Vp))}constructor(e,t){this.carbonLegacyClient=e,this.store=t}}le=(0,s.__decorate)([(0,ee.e)(ce._),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===G._?Object:G._,void 0===g?Object:g])],le);var ue=r(75028),pe=r(13186),me=r(14139);class he{}he=(0,s.__decorate)([(0,i.Yl)({api:o.t,stores:[g],handlers:{commands:{acceptUserGroupInvite:C,acceptCollectionInvite:R,acceptSharedItemInvite:U,refuseCollectionInvite:M,refuseItemGroupInvite:z,refuseUserGroupInvite:Y,updatePendingCollections:X},events:{},queries:{getInvites:ie,getPendingCollections:ae,hasInvites:le}},imports:[a.n,n.D,ue.k,pe.I,me.y],requiredFeatureFlips:["audit_logs_sharing","send_activity_log","sharingVault_web_Share_Collections_with_limited_Rights_Items_dev"],providers:[]})],he)},50520:(e,t,r)=>{r.d(t,{z:()=>s});class s{}},54096:(e,t,r)=>{r.d(t,{F:()=>ft});var s,i=r(88802),o=r(99634),a=r(93850),n=r(61582),c=r(50520);!function(e){e.SHARED_ITEM_IS_NOT_FOUND="ITEM_GROUP_IS_NOT_FOUND",e.INSUFFICIENT_PERMISSION_PRIVILEGES="INSUFFICIENT_PERMISSION_PRIVILEGES",e.INVALID_REVISION="INVALID_ITEM_GROUP_REVISION",e.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP="NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP",e.SHARING_DISABLED_BY_TEAM="SHARING_DISABLED_BY_TEAM",e.USER_IS_NOT_MEMBER_OF_TEAM="USER_IS_NOT_MEMBER_OF_TEAM",e.SERVER_ERROR="SERVER_ERROR"}(s||(s={}));class d{}var l=r(57924),u=r(87113),p=r(60399);const m=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:o,permission:a})=>({...t?{}:{proposeSignatureUsingAlias:!0},userId:e,groupKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:o,permission:a}))),h=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,acceptSignature:s,permission:i})=>({groupId:e,groupKey:t,proposeSignature:r,acceptSignature:s,permission:i}))),g=(e,t)=>({type:t,name:e||`Untitled ${t}`});var v=r(87279),_=r(11819);class y{async inviteMultipleItemGroupsMembers(e){const t=e.map((({sharedItem:e,users:t,userGroups:r})=>{const{sharedItemId:s,revision:i,auditLogData:o,itemType:a,title:n}=e;return{groupId:s,revision:i,users:t?.length?m(t):void 0,groups:r?.length?h(r):void 0,auditLogDetails:o?(0,_.B)(o):void 0,itemsForEmailing:[g(n,a)]}})),r=await(0,p.z)(this.serverApiClient.v1.sharingUserdevice.inviteMultipleItemGroupMembers({itemgroups:t}));if((0,v.hx)(r))throw new Error("Failed to add members to item group");const s=(0,v.db)(r).data,i=s.itemGroupErrors?.map((({groupId:e,message:t})=>({sharedItemId:e,error:this.mapServerError(t),revision:s.itemGroups?.find((t=>t.groupId===e))?.revision})));return(0,v.Vp)({errors:i})}mapServerError(e){switch(e){case s.USER_IS_NOT_MEMBER_OF_TEAM:return s.USER_IS_NOT_MEMBER_OF_TEAM;case s.INSUFFICIENT_PERMISSION_PRIVILEGES:return s.INSUFFICIENT_PERMISSION_PRIVILEGES;case s.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP:return s.NOT_A_MEMBER_CANNOT_SHARE_WITH_USER_GROUP;case s.SHARED_ITEM_IS_NOT_FOUND:return s.SHARED_ITEM_IS_NOT_FOUND;case s.INVALID_REVISION:return s.INVALID_REVISION;case s.SHARING_DISABLED_BY_TEAM:return s.SHARING_DISABLED_BY_TEAM;default:return s.SERVER_ERROR}}constructor(e){this.serverApiClient=e}}y=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===u.l?Object:u.l])],y);var S,E=r(50415);!function(e){e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW",e.AQ="AQ",e.AX="AX",e.BV="BV",e.CC="CC",e.CX="CX",e.EH="EH",e.GS="GS",e.HM="HM",e.PN="PN",e.SJ="SJ",e.UM="UM"}(S||(S={}));const f=(0,E.Enum)("KWAddress","KWAuthCategory","KWAuthentifiant","KWBankStatement","KWCollection","KWCompany","KWDataChangeHistory","KWDriverLicence","KWEmail","KWFiscalStatement","KWGeneratedPassword","KWIDCard","KWIdentity","KWMerchand","KWMiscData","KWPasskey","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWPurchaseAccount","KWPurchaseCategory","KWPurchasePaidBasket","KWPurchaseTrueArticle","KWSecret","KWSecureFileInfo","KWSecureNote","KWSecureNoteCategory","KWSecurityBreach","KWSettingsManagerApp","KWSocialSecurityStatement","KWWebSite"),A=(0,E.Enum)("ADDRESS","AUTHENTIFIANT","AUTH_CATEGORY","BANKACCESS","BANKACCOUNT","BANKCATEGORY","BANKINSTITUTION","BANKSITE","BANKSTATEMENT","BANKTRANSACTION","COLLECTION","COMPANY","DATA_CHANGE_HISTORY","DATA_USAGE_HISTORY","DEFAULT_AUTHENTIFIANT","DEFAULT_CONFIDENTIAL","DEFAULT_IDENTITY","DEFAULT_MISC","DEFAULT_PAYMENTMEANS","DEFAULT_REWARDCARD","DRIVERLICENCE","EMAIL","EMERGENCY_BUNDLE_FULL","EMERGENCY_BUNDLE_LITE","FULLBACKUP","FISCALSTATEMENT","GENERATED_PASSWORD","IDCARD","IDENTITY","INVOICEACCESS","INVOICEELEMENT","INVOICEINSTITUTION","MERCHANT","MISCDATA","PASSKEY","PASSPORT","PAYMENTMEANS_CREDITCARD","PAYMENTMEAN_PAYPAL","PERSONALWEBSITE","PHONE","POINTS","PURCHASEABANDONNEDBASKET","PURCHASEACCOUNT","PURCHASEARTICLE","PURCHASEBASKET","PURCHASEDELIVERYARTICLE","PURCHASEOPTIONARTICLE","PURCHASEPAIDBASKET","PURCHASE_CATEGORY","REWARDCARD","SECRET","SECUREFILEINFO","SECURENOTE","SECURENOTE_CATEGORY","SECURITYALERT","SECURITYALERTS","SECURITYBREACH","SETTINGS","SHARING_GROUP","SOCIALSECURITYSTATEMENT","WEBSITE"),I={KWAddress:A.ADDRESS,KWAuthCategory:A.AUTH_CATEGORY,KWAuthentifiant:A.AUTHENTIFIANT,KWCollection:A.COLLECTION,KWBankStatement:A.BANKSTATEMENT,KWCompany:A.COMPANY,KWDataChangeHistory:A.DATA_CHANGE_HISTORY,KWDriverLicence:A.DRIVERLICENCE,KWEmail:A.EMAIL,KWFiscalStatement:A.FISCALSTATEMENT,KWGeneratedPassword:A.GENERATED_PASSWORD,KWIDCard:A.IDCARD,KWIdentity:A.IDENTITY,KWMerchand:A.MERCHANT,KWMiscData:A.MISCDATA,KWPasskey:A.PASSKEY,KWPassport:A.PASSPORT,KWPaymentMean_creditCard:A.PAYMENTMEANS_CREDITCARD,KWPaymentMean_paypal:A.PAYMENTMEAN_PAYPAL,KWPersonalWebsite:A.PERSONALWEBSITE,KWPhone:A.PHONE,KWPurchaseAccount:A.PURCHASEACCOUNT,KWPurchaseCategory:A.PURCHASE_CATEGORY,KWPurchasePaidBasket:A.PURCHASEPAIDBASKET,KWPurchaseTrueArticle:A.PURCHASEARTICLE,KWSecret:A.SECRET,KWSecureFileInfo:A.SECUREFILEINFO,KWSecureNote:A.SECURENOTE,KWSecureNoteCategory:A.SECURENOTE_CATEGORY,KWSecurityBreach:A.SECURITYBREACH,KWSettingsManagerApp:A.SETTINGS,KWSocialSecurityStatement:A.SOCIALSECURITYSTATEMENT,KWWebSite:A.WEBSITE};Object.values(f).reduce(((e,t)=>(e[I[t]]=t,e)),{});E.Enum.keys(A),E.Enum.keys(f);var O=r(64718),b=r(32725),T=r(92467);const C=e=>{switch(e){case s.SHARED_ITEM_IS_NOT_FOUND:return b.z.ITEM_DOESNT_EXIST;case s.INVALID_REVISION:return b.z.INVALID_REVISION;default:return b.z.SHARING_FAILED}},w=(e,t,r)=>{const s=r.find((e=>e.Id===t));if(!s)throw new Error("Vault item not found when trying to share");const{Id:i,kwType:o,Title:a}=s,n={id:i,title:a,error:C(e)};if(o===f.KWAuthentifiant){const e=s,t=new O.Y(e.Url).getRootDomain();return{...n,type:T.y.Credential,domain:t,text:e.Email||e.Login}}return o===f.KWSecureNote?{...n,type:T.y.SecureNote,color:s.Type}:{...n,type:T.y.Secret}},R=(e,t)=>{const r=t.find((t=>t.Id===e.itemId));if(!r)throw new Error("Vault item not found when trying to share");const{kwType:s}=r,i=s===f.KWAuthentifiant?T.y.Credential:s===f.KWSecureNote?T.y.SecureNote:T.y.Secret,o=s===f.KWAuthentifiant?new O.Y(r.Url).getRootDomain():void 0,a=i===T.y.Credential?{type:i,domain:o}:void 0;return{itemType:i,sharedItemId:e.sharedItemId,revision:e.revision,title:r.Title,auditLogData:a}};var P=r(44801),D=r(85337),N=r(6554);class U{async inviteRecipients(e,t,r,s,i){const o=(await this.createItemsInvites(r,e.map((e=>({login:e,permission:i}))),t.map((e=>({groupId:e,permission:i}))))).map((({sharedItem:e,users:t,userGroups:r})=>({sharedItem:R(e,s),users:t,userGroups:r}))),a=await this.sharingItemsGateway.inviteMultipleItemGroupsMembers(o);if((0,v.hx)(a))throw new Error("Server error when sharing items");return(0,v.db)(a).errors?.map((({error:e,sharedItemId:t})=>{const i=r.find((e=>e.sharedItemId===t));if(!i)throw new Error("Error when creating invite params for sharing an item");return w(e,i.itemId,s)}))??[]}async createItemsInvites(e,t,r){const s=await Promise.all(e.map((async e=>{const t=await this.sharingDecryption.decryptItemGroupKey(e);if(null===t)throw new Error("Unable to decrypt item group key");return{resourceKey:t,uuid:e.sharedItemId}}))),i=await this.sharingUsers.createSignedUserInvitesPerResource(t,s),o=await this.sharingUserGroups.createSignedUserGroupInvitesPerResource(r,s);return e.map((e=>({sharedItem:e,users:i[e.sharedItemId],userGroups:o[e.sharedItemId]})))}constructor(e,t,r,s){this.sharingItemsGateway=e,this.sharingDecryption=t,this.sharingUserGroups=r,this.sharingUsers=s}}U=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===d?Object:d,void 0===P.c?Object:P.c,void 0===D.o?Object:D.o,void 0===N.E?Object:N.E])],U);var F=r(95681),M=r(25029);class L extends((0,F.Q)({storeName:"share-items-errors-state",scope:M.F.User,persist:!1,initialValue:{hasErrors:!1}})){}var G=r(87065),K=r(43978),x=r(69885),k=r(6136),j=r(57452);class V{get(){return this.currentSpaceGetter.get().pipe((0,G.U)((e=>{if((0,v.hx)(e))throw new Error("Problem retrieving current space information to assess sharing capacity");return(0,v.db)(e).sharedItemsLimit})),(0,K.w)((e=>void 0===e?(0,x.of)(!0):this.sharedItemsRepository.sharedItems$().pipe((0,G.U)((e=>e.length)),(0,k.x)(),(0,G.U)((t=>e-t))))))}constructor(e,t){this.currentSpaceGetter=e,this.sharedItemsRepository=t}}V=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===j.n?Object:j.n,void 0===c.z?Object:c.z])],V);var W=r(28489),B=r(13252),z=r(51612),H=r(57865),Y=r(15409);class Q{async get(e){const t=await this.credentialsGetter.getCarbonCredentialsByItemIds(e),{notes:r,notesErrors:s}=await this.getSharableNotes(e);return{credentials:t,notes:r,notesErrors:s,secrets:await this.secretsGetter.getCarbonSecretsByItemIds(e)}}async getSharableNotes(e){return(await this.notesGetter.getCarbonNotesByItemIds(e)).reduce(((e,t)=>(t.Attachments?.length?e.notesErrors.push((e=>{const{Id:t,Title:r}=e;return{id:t,title:r,error:b.z.ITEM_HAS_ATTACHMENTS,type:T.y.SecureNote,color:e.Type}})(t)):e.notes.push(t),e)),{notes:(0,W.Ay)([]),notesErrors:(0,W.Ay)([])})}constructor(e,t,r){this.credentialsGetter=e,this.notesGetter=t,this.secretsGetter=r}}Q=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===z.J?Object:z.J,void 0===H.H?Object:H.H,void 0===Y.F?Object:Y.F])],Q);var q=r(40217);class ${async run(e){const{vaultItemIds:t,permission:r,userLogins:s,userGroupIds:i}=e,{credentials:o,secrets:a,notes:n,notesErrors:c}=await this.shareableItems.get(t),d=[...n,...o,...a],{alreadySharedItems:l,alreadySharedItemsErrors:u,alreadySharedItemIds:m}=await(0,p.z)(this.getAlreadySharedItems(d,t)),h=d.filter((e=>!m.includes(e.Id))),g=[...l,...h.length?await this.sharingItemsService.createMultipleItemGroups(h):[]],v=[...c,...u,...g.length?await this.sharingItemsInvitesService.inviteRecipients(s,i,g,d,r):[]];return{hasChanges:g.length>0,errors:v}}getAlreadySharedItems(e,t){return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,G.U)((t=>t.reduce(((t,r)=>(r.permission===B.y3.Limited?t.alreadySharedItemsErrors.push(((e,t)=>w(s.INSUFFICIENT_PERMISSION_PRIVILEGES,e,t))(r.itemId,e)):t.alreadySharedItems.push(r),t.alreadySharedItemIds.push(r.itemId),t)),{alreadySharedItems:(0,W.Ay)([]),alreadySharedItemsErrors:(0,W.Ay)([]),alreadySharedItemIds:(0,W.Ay)([])}))))}constructor(e,t,r,s){this.sharingItemsInvitesService=e,this.sharingItemsService=t,this.sharedItemsRepository=r,this.shareableItems=s}}$=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===U?Object:U,void 0===q.k?Object:q.k,void 0===c.z?Object:c.z,void 0===Q?Object:Q])],$);var X=r(7165),Z=r(23347),J=r(10722),ee=r(88981);const te=X.z.object({indexPerVaultItemId:X.z.record(X.z.string()),sharedItems:X.z.record(ee.m$)}),re=e=>te.safeParse(e).success;class se extends((0,F.Q)({persist:!0,storage:{initialValue:{indexPerVaultItemId:{},sharedItems:{}},typeGuard:re,schemaVersion:1},scope:M.F.User,storeName:"shared-items-state",storeTypeGuard:re,codec:J.E,isCache:!0,capacity:Z.Y.Unlimited})){}var ie=r(162),oe=r(21242);class ae{async getSharedItemsIndex(){const{sharedItems:e}=await this.store.getState();return e}async setSharedItems(e){await this.store.set(e.reduce(((e,t)=>(e.sharedItems[t.sharedItemId]=t,e.indexPerVaultItemId[t.itemId]=t.sharedItemId,e)),(0,W.Ay)({sharedItems:{},indexPerVaultItemId:{}})))}sharedItems$(){return this.store.state$.pipe((0,G.U)((({sharedItems:e})=>Object.values(e))))}sharedItemsForIds$(e){return this.store.state$.pipe((0,G.U)((({sharedItems:t,indexPerVaultItemId:r})=>e.map((e=>t[r[e]])))))}sharedItemForId$(e){return this.store.state$.pipe((0,G.U)((({sharedItems:t,indexPerVaultItemId:r})=>t[r[e]])))}constructor(e){this.store=e}}ae=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===se?Object:se])],ae);var ne=r(61076),ce=r(86252),de=r(92936);const le=(e,t)=>e?.filter((e=>t.some((t=>t.uuid===e.uuid))&&e.status===B.qb.Accepted&&e.itemGroupKey)),ue=(...e)=>e.find((e=>e?.link))??e[0],pe=({permission:e,status:t})=>e===B.y3.Admin&&t===B.qb.Accepted,me=(e,t,r,s)=>{const i=((e,t)=>{const r=e.users?.filter((e=>e.userId===t&&e.status===B.qb.Accepted&&e.groupKey)),s=e.users?.some((({userId:e,permission:r,rsaStatus:s,status:i})=>e!==t&&r===B.y3.Admin&&"sharingKeys"===s&&i===B.qb.Accepted))??!1;if(r?.length){const e=r[0];if(e.groupKey){const{permission:t,acceptSignature:i,proposeSignature:o}=e;return{link:{permission:t,acceptSignature:i,proposeSignature:o,encryptedResourceKey:e.groupKey,accessType:B.Uv.User},permission:(0,de.u)(r),otherAdminsFound:s}}}return{permission:B.y3.Limited,otherAdminsFound:s}})(e,t),o=Boolean(i?.otherAdminsFound)||Boolean(e.groups?.some(pe))||Boolean(e.collections?.some(pe));if(null!==i&&i.permission===B.y3.Admin)return{...i,otherAdminsFound:o};const a=r.filter((e=>e.users.some((e=>e.userId===t&&e.status===B.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.groupKey)))),n=((e,t,r)=>{const s=e.groups?.filter((e=>r.some((t=>t.groupId===e.groupId))&&e.status===B.qb.Accepted&&e.groupKey));if(s?.length){const e=s[0],i=(0,de.u)(s);if(e.groupKey){const{permission:s,acceptSignature:o,proposeSignature:a}=e,n=r.find((t=>t.groupId===e.groupId)),c=n?.users.find((e=>e.userId===t));if(c?.groupKey)return{link:{permission:s,acceptSignature:o,proposeSignature:a,encryptedResourceKey:e.groupKey,groupEncryptedKey:c.groupKey,groupPrivateKey:n?.privateKey,accessType:B.Uv.UserGroup},permission:i}}}return null})(e,t,a);if(null!==n&&n.permission===B.y3.Admin)return{...ue(i,n),permission:B.y3.Admin,otherAdminsFound:o};const c=((e,t,r)=>{const s=r.filter((e=>e.users?.some((e=>e.login===t&&e.status===B.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.collectionKey)))),i=le(e.collections,s);if(i?.length){const e=i[0],r=(0,de.u)(i);if(e.itemGroupKey){const{permission:i,acceptSignature:o,proposeSignature:a}=e,n=s.find((t=>t.uuid===e.uuid)),c=n?.users?.find((e=>e.login===t));if(c&&n&&n.privateKey&&c.collectionKey)return{link:{permission:i,acceptSignature:o,proposeSignature:a,encryptedResourceKey:e.itemGroupKey,collectionEncryptedKey:c.collectionKey,collectionPrivateKey:n.privateKey,accessType:B.Uv.CollectionUser},permission:r}}}return null})(e,t,s);if(null!==c&&c.permission===B.y3.Admin)return{...ue(i,n,c),permission:B.y3.Admin,otherAdminsFound:o};const d=((e,t,r,s)=>{const i=s.filter((e=>e.userGroups?.some((e=>r.some((t=>t.groupId===e.uuid))&&e.status===B.qb.Accepted&&e.collectionKey)))),o=le(e.collections,i);if(o?.length){const e=o[0],s=(0,de.u)(o);if(e.itemGroupKey){const{permission:o,acceptSignature:a,proposeSignature:n}=e,c=i.find((t=>t.uuid===e.uuid)),d=c?.userGroups?.find((e=>r.some((t=>t.groupId===e.uuid))));if(!d)return null;const l=r.find((({groupId:e})=>e===d.uuid)),u=l?.users.find((({userId:e})=>e===t));if(d.collectionKey&&c&&u?.groupKey)return{link:{permission:o,acceptSignature:a,proposeSignature:n,encryptedResourceKey:e.itemGroupKey,collectionEncryptedKey:d.collectionKey,collectionPrivateKey:c.privateKey,groupPrivateKey:l?.privateKey,groupEncryptedKey:u.groupKey,accessType:B.Uv.CollectionUserGroup},permission:s}}}return null})(e,t,a,s);return{...ue(i,n,c,d),permission:d?.permission??B.y3.Limited,otherAdminsFound:o}},he=(e,t,r,s)=>{const{link:i,permission:o,otherAdminsFound:a}=me(e,s,t,r);if(!i)throw new Error("No access to a requested shared item");const{items:n,revision:c,groupId:d,groups:l,collections:u,users:p}=e,m=n?.[0];if(!m)throw new Error("No items associated with item group");const{itemId:h,itemKey:g}=m;return{permission:o,accessLink:i,itemId:h,itemKey:g,sharedItemId:d,revision:c,isLastAdmin:o===B.y3.Admin&&!a,recipientIds:{userIds:p?.map((({userId:e})=>e))??null,collectionIds:u?.map((({uuid:e})=>e))??null,userGroupIds:l?.map((({groupId:e})=>e))??null}}};var ge=r(93986),ve=r(74929),_e=r(71275);class ye{userId$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"state.userSession.account.login"}).pipe((0,G.U)((e=>{if((0,v.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))}combineWithCollectionsAndUserGroups(e,t){return e.pipe((0,ne.V)(this.userGroupsGetter.getCarbonUserGroups$(),this.collectionsRepository.collections$(),this.userId$()),(0,G.U)((([e,r,s,i])=>{if((0,v.hx)(e))throw new Error("Error when retrieving item groups");return t((0,v.db)(e),r,s,i)})))}sharedItems$(){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.get(),((e,t,r,s)=>e.map((e=>he(e,t,r,s)))))}sharedItemsForIds$(e){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.getForItemsIds(e),((e,t,r,s)=>e.map((e=>he(e,t,r,s)))))}sharedItemForId$(e){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.getForItemId(e),((e,t,r,s)=>e?he(e,t,r,s):null))}getSharedItemsIndex(){return Promise.reject(new Error("not supported"))}async setSharedItems(){throw new Error("not supported")}constructor(e,t,r,s){this.itemGroupsGetter=e,this.userGroupsGetter=t,this.collectionsRepository=r,this.carbonLegacyClient=s}}ye=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E,void 0===ve.B?Object:ve.B,void 0===_e.G?Object:_e.G,void 0===ce._?Object:ce._])],ye);class Se{sharedItems$(){return(0,ie.D)(this.getRepo()).pipe((0,K.w)((e=>e.sharedItems$())))}sharedItemForId$(e){return(0,ie.D)(this.getRepo()).pipe((0,K.w)((t=>t.sharedItemForId$(e))))}sharedItemsForIds$(e){return(0,ie.D)(this.getRepo()).pipe((0,K.w)((t=>t.sharedItemsForIds$(e))))}async getSharedItemsIndex(){return(await this.getRepo()).getSharedItemsIndex()}async setSharedItems(e){return(await this.getRepo()).setSharedItems(e)}async getRepo(){const{userFeatureFlip:e}=this.featureFlips.queries,t=await(0,p.z)(e({featureFlip:"sharingVault_web_sharingSyncGrapheneMigration_dev"}));return(0,v.hx)(t)?this.legacyRepo:(0,v.db)(t)?this.repo:this.legacyRepo}constructor(e,t,r){this.repo=e,this.legacyRepo=t,this.featureFlips=r}}Se=(0,i.__decorate)([(0,l.GS)(),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ae?Object:ae,void 0===ye?Object:ye,void 0===oe.P?Object:oe.P])],Se);var Ee=r(63663),fe=r(2741),Ae=r(27790),Ie=r(80629);class Oe{async execute({body:e}){const{groupId:t,revision:r,users:s,groups:i}=await this.getItemGroup(e),o=await this.commonGateway.updateItemGroupMembers({groupId:t,revision:r,users:s,groups:i});if((0,v.hx)(o)){if(o.error.tag===Ae.wI){await this.sharingSync.scheduleSync();const{groupId:t,revision:r}=await this.getItemGroup(e);return await this.commonGateway.updateItemGroupMembers({groupId:t,revision:r,users:s,groups:i}),(0,v.Vp)(void 0)}throw new Error("Revoke shared item failed after retry attempt")}return await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}async getItemGroup(e){const{vaultItemId:t,recipient:r,permission:s}=e,i=await(0,p.z)(this.itemGroupsGetter.getForItemId(t));if((0,v.hx)(i))throw new Error;if(!i.data)throw new Error("Failed to retrieve item group to revoke share item");const{groupId:o,revision:a}=i.data;return{groupId:o,revision:a,users:r.type===B.IP.User?[{userId:r.alias,permission:s}]:void 0,groups:r.type===B.IP.Group?[{groupId:r.groupId,permission:s}]:void 0}}constructor(e,t,r){this.itemGroupsGetter=e,this.sharingSync=t,this.commonGateway=r}}Oe=(0,i.__decorate)([(0,Ee.W)(fe.W),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E,void 0===Ie.D?Object:Ie.D,void 0===Ae.b_?Object:Ae.b_])],Oe);var be=r(98721);class Te{async execute({body:e}){const{revision:t,itemGroupId:r,userLogins:s,userGroupIds:i}=await this.getItemGroup(e),o=await this.commonGateway.revokeItemGroupMembers({revision:t,itemGroupId:r,userLogins:s,userGroupIds:i});if((0,v.hx)(o)){if(o.error.tag===Ae.wI){await this.sharingSync.scheduleSync();const{revision:t,itemGroupId:r}=await this.getItemGroup(e);return await this.commonGateway.revokeItemGroupMembers({revision:t,itemGroupId:r,userLogins:s,userGroupIds:i}),(0,v.Vp)(void 0)}throw new Error("Revoke shared item failed after retry attempt")}return await this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}async getItemGroup(e){const{vaultItemId:t,recipient:r}=e,s=await(0,p.z)(this.itemGroupsGetter.getForItemId(t));if((0,v.hx)(s))throw new Error("Failed to execute item group getter");if(!s.data)throw new Error("Failed to retrieve item group to revoke share item");const{groupId:i,revision:o}=s.data;return{revision:o,itemGroupId:i,userLogins:r.type===B.IP.User?[r.alias]:void 0,userGroupIds:r.type===B.IP.Group?[r.groupId]:void 0}}constructor(e,t,r){this.itemGroupsGetter=e,this.sharingSync=t,this.commonGateway=r}}Te=(0,i.__decorate)([(0,Ee.W)(be.V),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E,void 0===Ie.D?Object:Ie.D,void 0===Ae.b_?Object:Ae.b_])],Te);var Ce=r(24701);class we{async execute({body:e}){const{vaultItemId:t}=e,r=await(0,p.z)(this.itemGroupsGetter.getForItemId(t));if((0,v.hx)(r))throw new Error("Failed to retrieve item group for pending item group with");const s=(0,v.db)(r);if(void 0===s)throw new Error("Failed to retrieve item group for pending item group with");return await(0,p.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:s.groupId,revision:s.revision})),(0,v.Vp)(void 0)}constructor(e,t){this.serverApiClient=e,this.itemGroupsGetter=t}}we=(0,i.__decorate)([(0,Ee.W)(Ce.l),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===u.l?Object:u.l,void 0===ge.E?Object:ge.E])],we);var Re=r(41842),Pe=r(82567),De=r(89618),Ne=r(9671),Ue=r(89358),Fe=r(43656),Me=r(64978);const Le=async(e,t=2)=>{const r=[...e];let s=0;for(;r.length;){const e=r.splice(0,t).map((e=>e()));s+=(await Promise.all(e)).length}return s};class Ge{async execute(e){const{body:{vaultItemIds:t,pendingInvitesIds:r,shouldRunSync:s}}=e;if(!t.length&&!r.length)return s&&this.sharingSync.scheduleSync(),(0,v.Vp)(void 0);const i=await this.getCurrentUserLoginAfterGrapheneSessionOpening(),o=r.map((e=>()=>this.refusePendingInvite(e))),a=await Le(o),n=await this.getRevokeSharedItemsTasks(i,t),c=await Le(n);return(s||(a>0||c>0))&&this.sharingSync.scheduleSync(),(0,v.Vp)(void 0)}async refusePendingInvite(e){const{commands:{refuseItemGroupInvite:t}}=this.sharingInvitesClient,r=await t({itemGroupId:e});if((0,v.hx)(r))throw new Error("Failure to refuse pending invite for a force categorized item");return(0,v.db)(r)}async getRevokeSharedItemsTasks(e,t){if(!t.length)return[];return(await(0,p.z)(this.sharedItemsRepository.sharedItemsForIds$(t))).map((t=>()=>this.revokeSharedItem(t,e)))}async revokeSharedItem({isLastAdmin:e,revision:t,recipientIds:{userIds:r,collectionIds:s,userGroupIds:i},sharedItemId:o,itemId:a,permission:n},c){const d=r?.filter((e=>e!==c));if(e&&(d||s||i)){const e=await this.commonGateway.revokeItemGroupMembers({itemGroupId:o,revision:t,userLogins:d?.length?d:void 0,collectionIds:s??void 0,userGroupIds:i??void 0});if((0,v.hx)(e))throw new Error("Revoke shared item failed in remote control");return await this.sharingSync.scheduleSync(),(0,v.Vp)(e)}const l=await this.commonGateway.refuseItemGroup({itemGroupId:o,revision:t});return n===B.y3.Admin?this.duplicateVaultItem(a):l}async duplicateVaultItem(e){const{commands:{duplicateVaultItem:t}}=this.carbonClient,r=await t({vaultItemId:e});if((0,v.hx)(r))throw new Error("Failed to duplicate a shared item that is revoked because of forced catgorization");return(0,v.db)(r)}async getCurrentUserLoginAfterGrapheneSessionOpening(){return await(0,p.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,Re.h)(v.d6),(0,G.U)(v.db),(0,Pe.b)((e=>{e||this.allowedToFail.doOne((()=>{throw new Error("Unexpected user login value for remote control of shared items")}))})),(0,Re.h)((e=>"string"==typeof e&&""!==e)),(0,De.V)({first:3e3,with:()=>{throw new Error("Timeout retrieving user login after Graphene Session Opening for remote control of shared items")}})))}constructor(e,t,r,s,i,o,a){this.sharedItemsRepository=e,this.commonGateway=t,this.carbonClient=r,this.sessionClient=s,this.sharingSync=i,this.sharingInvitesClient=o,this.allowedToFail=a}}Ge=(0,i.__decorate)([(0,Ee.W)(Fe.v),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===c.z?Object:c.z,void 0===Ae.b_?Object:Ae.b_,void 0===ce._?Object:ce._,void 0===Ue.x?Object:Ue.x,void 0===Ie.D?Object:Ie.D,void 0===Me.h?Object:Me.h,void 0===Ne.J?Object:Ne.J])],Ge);var Ke=r(33472);class xe{async execute({body:e}){const{vaultItemIds:t}=e,r=await(0,p.z)(this.isSharingAllowedService.get());if("boolean"==typeof r?!r:t.length>r)return(0,v.Rn)((0,Ke.Kb)());let s=!1,i=null;const{hasChanges:o,errors:a}=await this.shareItemsService.run(e);if(s=o,i=a,this.hasInvalidRevisionErrors(a)){const{hasChanges:r,errors:o}=await this.runShareAttempt({...e,vaultItemIds:t.filter((e=>a.find((t=>t.id===e))))});i=o,s=s||r}return s&&this.sharingSync.scheduleSync(),i.length?(this.sharedItemsErrorsStore.set({hasErrors:!0,errors:i}),(0,v.Rn)((0,Ke.$u)())):(this.sharedItemsErrorsStore.set({hasErrors:!1}),(0,v.Vp)(void 0))}hasInvalidRevisionErrors(e){return e.find((({error:e})=>e===b.z.INVALID_REVISION))}async runShareAttempt(e){return await this.sharingSync.runSync(),this.shareItemsService.run(e)}constructor(e,t,r,s){this.isSharingAllowedService=e,this.sharedItemsErrorsStore=t,this.sharingSync=r,this.shareItemsService=s}}xe=(0,i.__decorate)([(0,Ee.W)(Ke.S2),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===V?Object:V,void 0===L?Object:L,void 0===Ie.D?Object:Ie.D,void 0===$?Object:$])],xe);var ke=r(20754),je=r(54933);class Ve{execute(){return this.isSharingAllowedService.get().pipe((0,G.U)((e=>(0,v.Vp)("boolean"==typeof e?e:e>0))))}constructor(e){this.isSharingAllowedService=e}}Ve=(0,i.__decorate)([(0,ke.e)(je.B),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===V?Object:V])],Ve);var We=r(48844),Be=r(95008);class ze{execute(){return this.premiumSpaceGetter.get().pipe((0,K.w)((e=>{if((0,v.hx)(e))throw new Error("Error retrieving space for user");return(0,v.db)(e).teamId?this.serverApiClient.v1.sharingUserdevice.getTeamLogins().pipe((0,We.Qn)((e=>({userLogins:e.data.teamLogins}))),(0,We.DZ)((e=>{throw e}))):(0,x.of)((0,v.Vp)({userLogins:[]}))})))}constructor(e,t){this.serverApiClient=e,this.premiumSpaceGetter=t}}ze=(0,i.__decorate)([(0,ke.e)(Be.G),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===u.l?Object:u.l,void 0===j.n?Object:j.n])],ze);var He=r(36155);class Ye{execute(){return this.currentSpaceGetter.get().pipe((0,We.Qn)((e=>e.isSharingEnabled)))}constructor(e){this.currentSpaceGetter=e}}Ye=(0,i.__decorate)([(0,ke.e)(He.N),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===j.n?Object:j.n])],Ye);var Qe=r(66206);class qe{execute({body:e}){const{itemId:t}=e;return this.itemGroupsGetter.getForItemId(t).pipe((0,We.Qn)((e=>({itemGroupId:e?.groupId}))))}constructor(e){this.itemGroupsGetter=e}}qe=(0,i.__decorate)([(0,ke.e)(Qe.C),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E])],qe);var $e=r(95803);class Xe{execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,G.U)((e=>(0,v.Vp)({sharedItems:e}))))}constructor(e){this.sharedItemsRepository=e}}Xe=(0,i.__decorate)([(0,ke.e)($e.z),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===c.z?Object:c.z])],Xe);var Ze=r(62760),Je=r(95038);class et{async getCurrentUserLogin(){return await(0,p.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,We.lk)((e=>(0,v.Vp)(e)))))}execute({body:e}){const{itemId:t}=e;return this.itemGroupGetter.getForItemId(t).pipe((0,ne.V)(this.userGroupsGetter.get(),this.getCurrentUserLogin()),(0,G.U)((([e,t,r])=>{if((0,v.hx)(e))throw new Error("Error when retrieving item group to check sharing status");const s=(0,v.db)(e);if(!s)return{isShared:!1,isSharedViaUserGroup:!1};if(!(0,v.d6)(r))throw new Error("Error when trying to get user login to check sharing status for item");const i=t.filter((({users:e})=>e.some((e=>e.userId===r.data&&e.status===B.qb.Accepted)))).map((({groupId:e})=>e));return{isShared:!0,isSharedViaUserGroup:s.groups?.some((({groupId:e,status:t})=>i.includes(e)&&"accepted"===t))??!1}})),(0,k.x)(Ze.shallowEqualObjects),(0,G.U)(v.Vp))}constructor(e,t,r){this.sessionClient=e,this.itemGroupGetter=t,this.userGroupsGetter=r}}et=(0,i.__decorate)([(0,ke.e)(Je.S),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===Ue.x?Object:Ue.x,void 0===ge.E?Object:ge.E,void 0===ve.B?Object:ve.B])],et);var tt=r(46234);class rt{execute({body:e}){const{itemId:t}=e;return this.sharedItemsRepository.sharedItemForId$(t).pipe((0,G.U)((e=>(0,v.Vp)({permission:e?.permission}))))}constructor(e){this.sharedItemsRepository=e}}rt=(0,i.__decorate)([(0,ke.e)(tt.C),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===c.z?Object:c.z])],rt);var st=r(62176);class it{execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,G.U)((e=>(0,v.Vp)(e.reduce(((e,t)=>(e[t.itemId]=t.permission,e)),{})))))}constructor(e){this.sharedItemsRepository=e}}it=(0,i.__decorate)([(0,ke.e)(st.R),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===c.z?Object:c.z])],it);var ot=r(11108);class at{execute({body:e}){const{itemId:t}=e;return this.sharedItemsRepository.sharedItemForId$(t).pipe((0,G.U)((e=>(0,v.Vp)({isLastAdmin:Boolean(e?.isLastAdmin)}))))}constructor(e){this.sharedItemsRepository=e}}at=(0,i.__decorate)([(0,ke.e)(ot.X),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===c.z?Object:c.z])],at);var nt=r(47670);class ct{execute({body:e}){const{itemId:t}=e;return this.itemGroupsGetter.getForItemId(t).pipe((0,G.U)((e=>{if((0,v.hx)(e))throw new Error("Error when retrieving item group for shared access");const t=(0,v.db)(e);if(!t)return;const r=t.users?.map((e=>({permission:e.permission,status:e.status,recipientId:e.userId,recipientName:e.alias,recipientType:B.IP.User}))).filter((e=>!["revoked","refused"].includes(e.status??""))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName))),s=t.groups?.map((e=>({permission:e.permission,status:e.status,recipientId:e.groupId,recipientName:e.name,recipientType:B.IP.Group}))).filter((e=>!["revoked","refused"].includes(e.status))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName))),i=t.collections?.map((e=>({permission:e.permission,status:e.status,recipientId:e.uuid,recipientName:e.name,recipientType:B.IP.Collection}))).filter((e=>!["revoked","refused"].includes(e.status))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName)));return{users:r??[],groups:s??[],collections:i??[],itemGroupId:t.groupId}})),(0,K.w)((e=>e?.groups.length?this.userGroupsGetter.getCarbonUserGroups$().pipe((0,G.U)((t=>({...e,groups:e.groups.map((e=>({...e,recipientName:t.find((t=>t.groupId===e.recipientId))?.name??e.recipientName})))})))):(0,x.of)(e))),(0,K.w)((e=>e?.collections.length?this.collectionsRepository.collections$().pipe((0,G.U)((t=>({...e,collections:e.collections.map((e=>({...e,recipientName:t.find((t=>t.uuid===e.recipientId))?.name??e.recipientName})))})))):(0,x.of)(e))),(0,G.U)((e=>(0,v.Vp)(e?{...e,count:e.users.length+e.groups.length+e.collections.length}:void 0))))}constructor(e,t,r){this.itemGroupsGetter=e,this.userGroupsGetter=t,this.collectionsRepository=r}}ct=(0,i.__decorate)([(0,ke.e)(nt.v),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E,void 0===ve.B?Object:ve.B,void 0===_e.G?Object:_e.G])],ct);var dt=r(39672),lt=r(39431),ut=r(22449);class pt{getVaultItems(e,t,r,s){return this.vaultClient.queries.search({searchQuery:r,vaultItemTypes:e,propertyFilters:null!==s?[{property:"spaceId",value:s}]:void 0,ids:t})}execute({body:e}){const{userId:t,groupId:r,query:s,spaceId:i}=e;if(!t&&!r)throw new Error("No userId and no groupId has been provided");return this.itemGroupGetter.get().pipe((0,K.w)((e=>{if(!(0,v.d6)(e))throw new Error("Incorrect type");const o=e.data.filter((e=>t?e.users?.filter((e=>e.userId===t)).length:r?e.groups?.filter((e=>e.groupId===r&&e.status!==B.qb.Revoked)).length:void 0)).flatMap((e=>e.items?.map((e=>e.itemId))||[]));return this.getVaultItems([lt.U.Credential,lt.U.SecureNote,lt.U.Secret],o,s,i).pipe((0,G.U)((e=>{if(!(0,v.d6)(e))throw new Error("Unable to retrieve vault items");const t=e.data.credentialsResult.items,r=e.data.secureNotesResult.items,s=e.data.secretsResult.items;return(0,v.Vp)({sharedCredentials:t,sharedSecureNotes:r,sharedSecrets:s})})))})))}constructor(e,t){this.vaultClient=e,this.itemGroupGetter=t}}pt=(0,i.__decorate)([(0,ke.e)(dt.v),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ut.T?Object:ut.T,void 0===ge.E?Object:ge.E])],pt);var mt=r(52715);class ht{execute(){return this.itemGroups.get().pipe((0,We.Qn)((e=>e.reduce(((e,t)=>[...e,...t.items?.map((e=>e.itemId))??[]]),[]))))}constructor(e){this.itemGroups=e}}ht=(0,i.__decorate)([(0,ke.e)(mt.c),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===ge.E?Object:ge.E])],ht);class gt{execute(){return this.store.state$.pipe((0,G.U)((e=>e.hasErrors?(0,v.Vp)(e.errors.reduce(((e,t)=>{const{id:r,type:s,title:i,error:o}=t,a={id:r,title:i,reason:o};switch(s){case T.y.Credential:e.credentialsErrors.push({...a,domain:t.domain,text:t.text});break;case T.y.SecureNote:e.notesErrors.push({...a,color:t.color});break;default:e.secretsErrors.push({...a})}return e}),{credentialsErrors:(0,W.Ay)([]),notesErrors:(0,W.Ay)([]),secretsErrors:(0,W.Ay)([])})):(0,v.Vp)({credentialsErrors:[],notesErrors:[],secretsErrors:[]}))))}constructor(e){this.store=e}}gt=(0,i.__decorate)([(0,ke.e)(b.f),(0,i.__metadata)("design:type",Function),(0,i.__metadata)("design:paramtypes",[void 0===L?Object:L])],gt);var vt=r(71737),_t=r(77972),yt=r(14139),St=r(13186),Et=r(75028);class ft{}ft=(0,i.__decorate)([(0,o.Yl)({api:n.X,providers:[U,V,$,Q,ye,ae,{provide:c.z,useClass:Se},{provide:d,useClass:y}],exports:[c.z],stores:[L,se],handlers:{commands:{updateSharedItemPermission:Oe,revokeSharedItem:Te,refuseSharedItem:we,remoteControlSharedItems:Ge,shareItems:xe},events:{},queries:{isSharingAllowed:Ve,getSharingTeamLogins:ze,sharingEnabled:Ye,getItemGroupIdForItemId:qe,getSharedItemsForItemIds:Xe,getSharingStatusForItem:et,getPermissionForItem:rt,getPermissionForItems:it,getIsLastAdminForItem:at,sharedAccessForItem:ct,getUserSharedVaultItems:pt,sharedItemsIds:ht,shareItemsErrors:gt}},imports:[a.n,yt.y,St.I,vt.p,_t.a,Et.k]})],ft)},54877:(e,t,r)=>{r.d(t,{u:()=>W});var s=r(88802),i=r(99634),o=r(87581),a=r(41842),n=r(43978),c=r(57924),d=r(87279),l=r(20980);class u{getUsersAndGroupsInCollectionsInSpace(e){const{sharedCollectionsWithItems:t,usersAndGroupsInCollection:r}=this.sharingCollectionsClient.queries;return t().pipe((0,a.h)(d.d6),(0,n.w)((t=>{const s=t.data.reduce(((t,r)=>(r.spaceId!==e&&null!==e||t.push(r.id),t)),[]);return r({collectionIds:s})})))}getUsersAndGroupsInCollections(){const{getSharedCollections:e,usersAndGroupsInCollection:t}=this.sharingCollectionsClient.queries;return e({}).pipe((0,a.h)(d.d6),(0,n.w)((e=>{const r=e.data.map((e=>e.uuid));return t({collectionIds:r})})))}constructor(e){this.sharingCollectionsClient=e}}u=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===l.L?Object:l.L])],u);var p=r(86252),m=r(162),h=r(61076),g=r(87065),v=r(39431),_=r(50879),y=r(22449),S=r(93986);class E{getForSpaceId(e){return this.itemGroupGetter.get().pipe((0,n.w)((t=>{if((0,d.hx)(t))throw new Error("Unable to find items in item group");const r=(0,d.db)(t).flatMap((e=>(e.items||[])[0]?.itemId)),s=this.vaultItemsCrud.queries.query({vaultItemTypes:[v.U.Credential,v.U.SecureNote,v.U.Secret],ids:r,propertyFilters:null!==e?[{property:"spaceId",value:e}]:void 0});return(0,m.D)(s)})),(0,h.V)(this.itemGroupGetter.get()),(0,g.U)((([e,t])=>{if((0,d.hx)(e)||(0,d.hx)(t))throw new Error("Unable to find items in item group");const r=(0,d.db)(e),s=(0,d.db)(t),i=[...r.credentialsResult.items,...r.secureNotesResult.items,...r.secretsResult.items];return s.filter((e=>i.some((t=>t.id===(e.items||[])[0]?.itemId))))})))}constructor(e,t,r,s){this.client=e,this.itemGroupGetter=t,this.vaultItemsCrud=r,this.vaultSearchClient=s}}E=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===p._?Object:p._,void 0===S.E?Object:S.E,void 0===_.L?Object:_.L,void 0===y.T?Object:y.T])],E);var f=r(7165),A=r(95681),I=r(23347),O=r(25029),b=r(10722),T=r(35863);const C=f.z.object({groupId:f.z.string(),name:f.z.string(),revision:f.z.number(),publicKey:f.z.string(),privateKey:f.z.string(),acceptedUsers:f.z.array(f.z.string()),allUsers:f.z.array(f.z.string())}),w=f.z.object({userGroups:f.z.record(C),users:f.z.record(T.g)}),R=e=>w.safeParse(e).success;class P extends((0,A.Q)({persist:!0,storage:{initialValue:{userGroups:{},users:{}},typeGuard:R,schemaVersion:1},scope:O.F.User,storeName:"sharing-user-groups-state",storeTypeGuard:R,codec:b.E,isCache:!0,capacity:I.Y.Unlimited})){}var D=r(89720),N=r(13252),U=r(28489);class F{async getUserGroups(){const{userGroups:e,users:t}=await this.userGroupsStore.getState();return Object.keys(e).reduce(((r,s)=>{const{groupId:i,name:o,revision:a,allUsers:n,privateKey:c,publicKey:d}=e[s];return r[s]={groupId:i,name:o,revision:a,privateKey:c,publicKey:d,users:n.map((e=>t[e]))},r}),(0,U.Ay)({}))}setUserGroups(e){const t=e.reduce(((e,{groupId:t,name:r,revision:s,users:i,privateKey:o,publicKey:a})=>(e.userGroups[t]={groupId:t,name:r,revision:s,acceptedUsers:i.reduce(((e,t)=>(t.status===N.qb.Accepted&&e.push(t.userId),e)),(0,U.Ay)([])),publicKey:a,privateKey:o,allUsers:i.map((e=>e.userId))},i.forEach((t=>e.users[t.userId]=t)),e)),{userGroups:(0,U.Ay)({}),users:(0,U.Ay)({})});this.userGroupsStore.set(t)}async getUserGroup(e){const{userGroups:t,users:r}=await this.userGroupsStore.getState(),s=t[e];if(!s)return null;const{groupId:i,name:o,revision:a,allUsers:n,privateKey:c,publicKey:d}=s;return{groupId:i,name:o,revision:a,privateKey:c,publicKey:d,users:n.map((e=>r[e]))}}async getUserGroupsForIds(e){const{userGroups:t,users:r}=await this.userGroupsStore.getState();return e.reduce(((e,s)=>{const i=t[s];if(i){const{groupId:t,name:s,revision:o,allUsers:a,privateKey:n,publicKey:c}=i;e.push({groupId:t,name:s,revision:o,privateKey:n,publicKey:c,users:a.map((e=>r[e]))})}return e}),(0,U.Ay)([]))}constructor(e){this.userGroupsStore=e}}F=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===P?Object:P])],F);var M=r(20754),L=r(89358),G=r(53529);class K{execute({body:e}){return this.itemGroupsGetter.getForSpaceId(e.spaceId).pipe((0,h.V)(this.getCurrentUserLogin(),this.recipientsInCollectionsService.getUsersAndGroupsInCollectionsInSpace(e.spaceId)),(0,g.U)((([t,r,s])=>{if((0,d.hx)(s))throw new Error("Error when retrieving users in collections");const i=new Map;t.forEach((e=>{e.users?.forEach((e=>{if(e.userId===r||!["accepted","pending"].includes(e.status??""))return;const t=i.has(e.userId)?i.get(e.userId).itemCount:0;i.set(e.userId,{id:e.userId,itemCount:t+1})}))}));((0,d.db)(s).users||[]).forEach((e=>{if(e.id===r||!["accepted","pending"].includes(e.status))return;const t=i.has(e.id)?i.get(e.id).itemCount:0;i.set(e.id,{id:e.id,itemCount:t+1})}));const o=Array.from(i.values()).sort(((t,r)=>"ascend"===e.sortDirection?t.id.localeCompare(r.id):r.id.localeCompare(r.id)));return(0,d.Vp)(o)})))}getCurrentUserLogin(){return this.sessionClient.queries.selectedOpenedSession().pipe((0,a.h)(d.d6),(0,g.U)(d.db))}constructor(e,t,r){this.itemGroupsGetter=e,this.recipientsInCollectionsService=t,this.sessionClient=r}}K=(0,s.__decorate)([(0,M.e)(G.K),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===E?Object:E,void 0===u?Object:u,void 0===L.x?Object:L.x])],K);var x=r(70633),k=r(74929);class j{execute({body:e}){return this.itemGroupsRecipientsGetter.getForSpaceId(e.spaceId).pipe((0,h.V)(this.getCurrentUserLogin(),this.userGroupsGetter.get(),this.recipientsInCollectionsService.getUsersAndGroupsInCollections()),(0,g.U)((([t,r,s,i])=>{if((0,d.hx)(i))throw new Error("Error when retrieving users in collections");const o=(0,d.db)(i).userGroups||[],a=s.filter((e=>"users"===e.type&&e.users.some((e=>e.userId===r&&"accepted"===e.status)))).map((e=>{const r=t.filter((t=>(t.groups||[]).some((t=>t.groupId===e.groupId&&"accepted"===t.status)))),s=o.filter((t=>t.id===e.groupId)),i=r.length+s.length,a=e.users.map((e=>({id:e.userId,permission:e.permission})));return{id:e.groupId,itemCount:i,name:e.name,users:a}})).sort(((t,r)=>"ascend"===e.sortDirection?t.name.localeCompare(r.name):r.name.localeCompare(r.name)));return(0,d.Vp)(a)})))}getCurrentUserLogin(){return this.sessionClient.queries.selectedOpenedSession().pipe((0,a.h)(d.d6),(0,g.U)(d.db))}constructor(e,t,r,s){this.itemGroupsRecipientsGetter=e,this.recipientsInCollectionsService=t,this.userGroupsGetter=r,this.sessionClient=s}}j=(0,s.__decorate)([(0,M.e)(x.f),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===E?Object:E,void 0===u?Object:u,void 0===k.B?Object:k.B,void 0===L.x?Object:L.x])],j);var V=r(14139);class W{}W=(0,s.__decorate)([(0,i.Yl)({api:o.A,providers:[E,u,{provide:D.x,useClass:F}],stores:[P],handlers:{commands:{},events:{},queries:{getSharingUsers:K,getSharingGroups:j}},imports:[V.y],exports:[D.x]})],W)},89720:(e,t,r)=>{r.d(t,{x:()=>s});class s{}},73179:(e,t,r)=>{r.d(t,{P:()=>L});var s=r(88802),i=r(60399),o=r(63663),a=r(87113),n=r(87279),c=r(13252),d=r(76763),l=r(89720),u=r(28489);const p=(e,t)=>e.reduce(((e,r)=>{const s=t[r.id];return s?s.revision<r.revision?e.updatedIds.push(r.id):e.unchanged.push(s):e.newIds.push(r.id),e}),{newIds:(0,u.Ay)([]),updatedIds:(0,u.Ay)([]),unchanged:(0,u.Ay)([])});var m=r(5482),h=r(92936),g=r(32336);const v=({permission:e,status:t})=>e===c.y3.Admin&&t===c.qb.Accepted,_=(e,t,r)=>{const s=((e,t)=>{const r=e.users?.filter((e=>e.login===t&&e.status===c.qb.Accepted&&e.collectionKey)),s=e.users?.some((({login:e,permission:r,rsaStatus:s,status:i})=>e!==t&&r===c.y3.Admin&&"sharingKeys"===s&&i===c.qb.Accepted))??!1;if(r?.length){const e=r[0];if(e.collectionKey){const{permission:t,acceptSignature:i,proposeSignature:o}=e;return{link:{permission:t,acceptSignature:i,proposeSignature:o,encryptedResourceKey:e.collectionKey,accessType:g.oP.User},permission:(0,h.u)(r),otherAdminsFound:s}}}return{permission:c.y3.Limited,otherAdminsFound:s}})(e,t),i=Boolean(s?.otherAdminsFound)||Boolean(e.userGroups?.some(v))||Boolean(e.users?.some(v));if(null!==s&&s.permission===c.y3.Admin)return{...s,otherAdminsFound:i};const o=r.filter((e=>e.users.some((e=>e.userId===t&&e.status===c.qb.Accepted&&e.groupKey)))),a=((e,t,r)=>{const s=e.userGroups?.filter((e=>r.some((t=>t.groupId===e.uuid))&&e.status===c.qb.Accepted&&e.collectionKey));if(s?.length){const e=s[0],i=(0,h.u)(s);if(e.collectionKey){const{permission:s,acceptSignature:o,proposeSignature:a}=e,n=r.find((t=>t.groupId===e.uuid)),c=n?.users.find((e=>e.userId===t));if(c?.groupKey)return{link:{permission:s,acceptSignature:o,proposeSignature:a,encryptedResourceKey:e.collectionKey,groupEncryptedKey:c.groupKey,groupPrivateKey:n?.privateKey,accessType:g.oP.UserGroup},permission:i}}}return null})(e,t,o);return{...s||a,permission:a?.permission===c.y3.Admin?c.y3.Admin:c.y3.Limited,otherAdminsFound:i}};var y=r(50520);const S=(e,t)=>{const r=((e,t)=>{const r={permission:c.y3.Limited};if(!e)return r;for(const s of e)if(s.status===c.qb.Accepted&&s.itemGroupKey){if(s.permission===c.y3.Admin&&(r.permission=c.y3.Admin),!r.collection||r.collection.accessLink?.accessType!==g.oP.User){const e=t.find((e=>e.id===s.uuid&&e.accessLink));e&&(r.collection=e)}if(r.permission===c.y3.Admin&&r.collection?.accessLink?.accessType===g.oP.User)break}return r})(e.collections,t);if(r.collection&&r.member){const{collection:e,member:t}=r,{permission:s,acceptSignature:i,proposeSignature:o,itemGroupKey:a}=t;if(a&&e.accessLink?.accessType===g.oP.User){const{encryptedResourceKey:t}=e.accessLink;if(t){return{link:{permission:s,acceptSignature:i,proposeSignature:o,encryptedResourceKey:a,collectionEncryptedKey:t,collectionPrivateKey:e.privateKey,accessType:c.Uv.CollectionUser},permission:r.permission}}}}return null},E=(...e)=>e.find((e=>e?.link))??e[0],f=({permission:e,status:t})=>e===c.y3.Admin&&t===c.qb.Accepted,A=(e,t,r,s)=>{const i=((e,t)=>{const r=e.users?.filter((e=>e.userId===t&&e.status===c.qb.Accepted&&e.groupKey)),s=e.users?.some((({userId:e,permission:r,rsaStatus:s,status:i})=>e!==t&&r===c.y3.Admin&&"sharingKeys"===s&&i===c.qb.Accepted))??!1;if(r?.length){const e=r[0];if(e.groupKey){const{permission:t,acceptSignature:i,proposeSignature:o}=e;return{link:{permission:t,acceptSignature:i,proposeSignature:o,encryptedResourceKey:e.groupKey,accessType:c.Uv.User},permission:(0,h.u)(r),otherAdminsFound:s}}}return{permission:c.y3.Limited,otherAdminsFound:s}})(e,t),o=Boolean(i?.otherAdminsFound)||Boolean(e.groups?.some(f))||Boolean(e.collections?.some(f));if(null!==i&&i.permission===c.y3.Admin)return{...i,otherAdminsFound:o};const a=((e,t,r)=>{const s=e.groups?.filter((e=>r.some((t=>t.groupId===e.groupId))&&e.status===c.qb.Accepted&&e.groupKey));if(s?.length){const e=s[0],i=(0,h.u)(s);if(e.groupKey){const{permission:s,acceptSignature:o,proposeSignature:a}=e,n=r.find((t=>t.groupId===e.groupId)),d=n?.users.find((e=>e.userId===t));if(d?.groupKey)return{link:{permission:s,acceptSignature:o,proposeSignature:a,encryptedResourceKey:e.groupKey,groupEncryptedKey:d.groupKey,groupPrivateKey:n?.privateKey,accessType:c.Uv.UserGroup},permission:i}}}return null})(e,t,r);if(null!==a&&a.permission===c.y3.Admin)return{...E(i,a),permission:c.y3.Admin,otherAdminsFound:o};const n=S(e,s);return{...E(i,a,n),permission:(0,h.u)([i,a,n]),otherAdminsFound:o}};var I=r(68173),O=r(44801),b=r(35635);const T=e=>e.filter((e=>null!==e));class C{async execute({body:e}){const{summary:t}=e,{collections:r,userGroups:s,itemGroups:o}=t,a=await this.currentUserGetter.getCurrentUserWithKeys(),d=await this.userGroupsRepo.getUserGroups(),l=await this.collectionsRepo.getCollections(),u=await this.sharedItemsRepo.getSharedItemsIndex(),{newIds:m,updatedIds:h,unchanged:g}=p(s,d),{newIds:v,updatedIds:y,unchanged:S}=p(r,l),{newIds:E,updatedIds:f,unchanged:I}=p(o,u),O=await(0,i.z)(this.serverApiClient.v1.sharingUserdevice.postSharingUserdevice({collectionIds:v.concat(y),userGroupIds:m.concat(h),itemGroupIds:E.concat(f)}));if((0,n.hx)(O))throw new Error("Error getting sharing updates");const{data:b}=(0,n.db)(O),{userGroups:C,collections:w,itemGroups:R}=b;let P=g;if(C?.length){const e=await Promise.all(C.map((async e=>await this.isUserGroupValid(e,a)?e:null)));e.length&&(P=P.concat(T(e)))}this.userGroupsRepo.setUserGroups(P);let D=S;if(w?.length){const e=w.map((e=>((e,t,r)=>{const{link:s,permission:i,otherAdminsFound:o}=_(e,r,t),a=i===c.y3.Admin&&!o,{name:n,privateKey:d,publicKey:l,revision:u,uuid:p}=e;return{id:p,name:n,privateKey:d,publicKey:l,revision:u,accessLink:s,isLastAdmin:a,isAccepted:!0,permission:i}})(e,P,a.login))),t=await Promise.all(e.map((async e=>await this.isCollectionValid(e,a)?e:null)));t.length&&(D=D.concat(T(t)))}this.collectionsRepo.setCollections(D);let N=I;if(R?.length){const e=R.map((e=>((e,t,r,s)=>{const i=A(e,s,t,r),{items:o,revision:a,groupId:n,groups:d,collections:l,users:u}=e,p=o?.[0];if(!p)throw new Error("No items associated with item group");const{itemId:m,itemKey:h}=p,g=i?.permission===c.y3.Admin&&!i.otherAdminsFound;return{permission:i?.permission??c.y3.Limited,accessLink:i?.link,itemId:m,itemKey:h,sharedItemId:n,revision:a,isLastAdmin:g,recipientIds:{userIds:u?.map((({userId:e})=>e))??null,collectionIds:l?.map((({uuid:e})=>e))??null,userGroupIds:d?.map((({groupId:e})=>e))??null}}})(e,P,D,a.login))),t=await Promise.all(e.map((async e=>await this.isSharedItemValid(e,a)?e:null)));t.length&&(N=N.concat(T(t)))}return this.sharedItemsRepo.setSharedItems(N),(0,n.Vp)(void 0)}async isUserGroupValid(e,t){const{publicKey:r,login:s}=t,i=e.users.find((e=>e.userId===s));if(!i?.groupKey?.length)return!1;if(i.status!==c.qb.Accepted)return!1;if(!i.acceptSignature)return!1;const o=await this.sharingDecryption.decryptResourceKeyViaUserMember({encryptedResourceKey:i.groupKey},t);return null!==o&&this.sharingCrypto.verifyAcceptSignature(r,i.acceptSignature,e.groupId,o)}async isCollectionValid(e,t){const{publicKey:r}=t;if(!e.accessLink)return!1;if(!e.accessLink.acceptSignature)return!1;const{acceptSignature:s}=e.accessLink,i=await this.sharingDecryption.decryptSharedCollectionKey(e,t);return!!i&&this.sharingCrypto.verifyAcceptSignature(r,s,e.id,i)}async isSharedItemValid(e,t){const{publicKey:r}=t;if(!e.accessLink)return!1;if(!e.accessLink.acceptSignature)return!1;const{acceptSignature:s}=e.accessLink,i=await this.sharingDecryption.decryptItemGroupKey(e);return!!i&&this.sharingCrypto.verifyAcceptSignature(r,s,e.sharedItemId,i)}constructor(e,t,r,s,i,o,a){this.serverApiClient=e,this.sharingCrypto=t,this.sharingDecryption=r,this.currentUserGetter=s,this.userGroupsRepo=i,this.collectionsRepo=o,this.sharedItemsRepo=a}}C=(0,s.__decorate)([(0,o.W)(d.N),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===a.l?Object:a.l,void 0===I.O?Object:I.O,void 0===O.c?Object:O.c,void 0===b.a?Object:b.a,void 0===l.x?Object:l.x,void 0===m.U?Object:m.U,void 0===y.z?Object:y.z])],C);var w=r(99634),R=r(93850),P=r(29390),D=r(54877),N=r(54096),U=r(14139),F=r(75028),M=r(77972);class L{}L=(0,s.__decorate)([(0,w.Yl)({api:P.k,handlers:{commands:{runSharingSync:C},events:{},queries:{}},imports:[R.n,U.y,F.k,D.u,M.a,N.F]})],L)},50436:(e,t,r)=>{r.d(t,{R:()=>i});var s=r(78776);const i=()=>`{${(0,s.Z)().toUpperCase()}}`},92936:(e,t,r)=>{r.d(t,{u:()=>o});var s=r(13252);const i=(e,t)=>t?.permission===s.y3.Admin?t.permission:e,o=e=>e.reduce(i,s.y3.Limited)},98798:(e,t,r)=>{function s(e){switch(e?.kwType){case"KWAuthentifiant":return"AUTHENTIFIANT";case"KWSecureNote":return"SECURENOTE";default:return"SECRET"}}function i(e){switch(e){case"AUTHENTIFIANT":return"password";case"SECURENOTE":return"note";default:return"secret"}}r.d(t,{B:()=>i,l:()=>s})},4174:(e,t,r)=>{r.d(t,{Q:()=>o});var s=r(67837),i=r(98768);class o extends((0,s.E)(i.r)){}(0,s.K)(i.r,o)},98768:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(86952),i=r(16541),o=r(74430);const a=(0,s.Q)({name:"sync",commands:{SyncCommand:i.t},queries:{SyncProgressQuery:o.F},events:{}})},16541:(e,t,r)=>{r.d(t,{t:()=>o});var s=r(74354),i=r(25029);class o extends((0,s.g)({scope:i.F.Device})){}},74430:(e,t,r)=>{r.d(t,{F:()=>o});var s=r(99059),i=r(25029);class o extends((0,s.k)({scope:i.F.Device})){}},90993:(e,t,r)=>{var s;r.d(t,{L:()=>s,_:()=>i}),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(s||(s={}));class i{}},90904:(e,t,r)=>{r.d(t,{R:()=>T});var s=r(88802),i=r(99634),o=r(25029),a=r(98768),n=r(90993),c=r(41842),d=r(60399),l=r(57924),u=r(86252),p=r(87279),m=r(48844);const h=e=>"object"==typeof e&&null!==e&&"status"in e&&Object.values(n.L).includes(e.status);var g=r(96168);class v extends((0,g.Hu)("SyncError","An error occoured while trying to sync the vault")){}class _{async attemptSync(e){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"sessionForceSync",arg:[{trigger:e}]})}async waitForSync(e){const t=this.getSyncState().pipe((0,c.h)((e=>!(!(0,p.d6)(e)||!h(e.data))&&[n.L.FAILURE,n.L.SUCCESS].includes(e.data.status))),(0,m.DZ)((()=>new v)),(0,m.lk)((e=>e.status===n.L.FAILURE?(0,p.Rn)({tag:"Sync failed"}):(0,p.Vp)(void 0))));return await this.attemptSync(e),(0,d.z)(t)}getSyncState(){return this.carbonLegacy.queries.carbonState({path:"userSession.sync"}).pipe((0,m.Qn)((e=>{if(!h(e))throw new Error("Bad sync state format");return{status:e.status}})))}constructor(e){this.carbonLegacy=e}}_=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===u._?Object:u._])],_);var y=r(21877);class S{async run(){return await this.syncService.attemptSync(y.Trigger.Periodic),Promise.resolve()}constructor(e){this.syncService=e}}S=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n._?Object:n._])],S);var E=r(63663),f=r(16541);class A{execute(e){const{trigger:t}=e.body;return this.syncService.attemptSync(t),Promise.resolve((0,p.Vp)(void 0))}constructor(e){this.syncService=e}}A=(0,s.__decorate)([(0,E.W)(f.t),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n._?Object:n._])],A);var I=r(20754),O=r(74430);class b{execute(){return this.syncService.getSyncState()}constructor(e){this.syncService=e}}b=(0,s.__decorate)([(0,I.e)(O.F),(0,s.__metadata)("design:type",Function),(0,s.__metadata)("design:paramtypes",[void 0===n._?Object:n._])],b);class T{}T=(0,s.__decorate)([(0,i.Yl)({api:a.r,handlers:{commands:{sync:A},events:{},queries:{syncProgress:b}},crons:[{handler:S,periodInMinutes:5,name:"periodic-sync-cron",scope:o.F.User}],providers:[{provide:n._,useClass:_}],exports:[n._]})],T)}}]);